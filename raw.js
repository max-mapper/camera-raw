
(function(e) {
    "use strict";
    var t = "addImage_", i = [ "jpeg", "jpg", "png" ];
    var n = function(e) {
        var t = this.internal.newObject(), i = this.internal.write, r = this.internal.putStream;
        e["n"] = t;
        i("<</Type /XObject");
        i("/Subtype /Image");
        i("/Width " + e["w"]);
        i("/Height " + e["h"]);
        if (e["cs"] === this.color_spaces.INDEXED) {
            i("/ColorSpace [/Indexed /DeviceRGB " + (e["pal"].length / 3 - 1) + " " + ("smask" in e ? t + 2 : t + 1) + " 0 R]");
        } else {
            i("/ColorSpace /" + e["cs"]);
            if (e["cs"] === this.color_spaces.DEVICE_CMYK) {
                i("/Decode [1 0 1 0 1 0 1 0]");
            }
        }
        i("/BitsPerComponent " + e["bpc"]);
        if ("f" in e) {
            i("/Filter /" + e["f"]);
        }
        if ("dp" in e) {
            i("/DecodeParms <<" + e["dp"] + ">>");
        }
        if ("trns" in e && e["trns"].constructor == Array) {
            var a = "", o = 0, s = e["trns"].length;
            for (;o < s; o++) a += e["trns"][o] + " " + e["trns"][o] + " ";
            i("/Mask [" + a + "]");
        }
        if ("smask" in e) {
            i("/SMask " + (t + 1) + " 0 R");
        }
        i("/Length " + e["data"].length + ">>");
        r(e["data"]);
        i("endobj");
        if ("smask" in e) {
            var l = "/Predictor 15 /Colors 1 /BitsPerComponent " + e["bpc"] + " /Columns " + e["w"];
            var c = {
                w: e["w"],
                h: e["h"],
                cs: "DeviceGray",
                bpc: e["bpc"],
                dp: l,
                data: e["smask"]
            };
            if ("f" in e) c.f = e["f"];
            n.call(this, c);
        }
        if (e["cs"] === this.color_spaces.INDEXED) {
            this.internal.newObject();
            i("<< /Length " + e["pal"].length + ">>");
            r(this.arrayBufferToBinaryString(new Uint8Array(e["pal"])));
            i("endobj");
        }
    }, r = function() {
        var e = this.internal.collections[t + "images"];
        for (var i in e) {
            n.call(this, e[i]);
        }
    }, a = function() {
        var e = this.internal.collections[t + "images"], i = this.internal.write, n;
        for (var r in e) {
            n = e[r];
            i("/I" + n["i"], n["n"], "0", "R");
        }
    }, o = function(t) {
        if (t && typeof t === "string") t = t.toUpperCase();
        return t in e.image_compression ? t : e.image_compression.NONE;
    }, s = function() {
        var e = this.internal.collections[t + "images"];
        if (!e) {
            this.internal.collections[t + "images"] = e = {};
            this.internal.events.subscribe("putResources", r);
            this.internal.events.subscribe("putXobjectDict", a);
        }
        return e;
    }, l = function(e) {
        var t = 0;
        if (e) {
            t = Object.keys ? Object.keys(e).length : function(e) {
                var t = 0;
                for (var i in e) {
                    if (e.hasOwnProperty(i)) {
                        t++;
                    }
                }
                return t;
            }(e);
        }
        return t;
    }, c = function(e) {
        return typeof e === "undefined" || e === null;
    }, u = function(t) {
        return typeof t === "string" && e.sHashCode(t);
    }, f = function(e) {
        return i.indexOf(e) === -1;
    }, d = function(t) {
        return typeof e["process" + t.toUpperCase()] !== "function";
    }, h = function(e) {
        return typeof e === "object" && e.nodeType === 1;
    }, p = function(e, t, i) {
        if (e.nodeName === "IMG" && e.hasAttribute("src")) {
            var n = "" + e.getAttribute("src");
            if (!i && n.indexOf("data:image/") === 0) return n;
            if (!t && /\.png(?:[?#].*)?$/i.test(n)) t = "png";
        }
        if (e.nodeName === "CANVAS") {
            var r = e;
        } else {
            var r = document.createElement("canvas");
            r.width = e.clientWidth || e.width;
            r.height = e.clientHeight || e.height;
            var a = r.getContext("2d");
            if (!a) {
                throw "addImage requires canvas to be supported by browser.";
            }
            if (i) {
                var o, s, l, c, u, f, d, h = Math.PI / 180, p;
                if (typeof i === "object") {
                    o = i.x;
                    s = i.y;
                    l = i.bg;
                    i = i.angle;
                }
                p = i * h;
                c = Math.abs(Math.cos(p));
                u = Math.abs(Math.sin(p));
                f = r.width;
                d = r.height;
                r.width = d * u + f * c;
                r.height = d * c + f * u;
                if (isNaN(o)) o = r.width / 2;
                if (isNaN(s)) s = r.height / 2;
                a.clearRect(0, 0, r.width, r.height);
                a.fillStyle = l || "white";
                a.fillRect(0, 0, r.width, r.height);
                a.save();
                a.translate(o, s);
                a.rotate(p);
                a.drawImage(e, -(f / 2), -(d / 2));
                a.rotate(-p);
                a.translate(-o, -s);
                a.restore();
            } else {
                a.drawImage(e, 0, 0, r.width, r.height);
            }
        }
        return r.toDataURL(("" + t).toLowerCase() == "png" ? "image/png" : "image/jpeg");
    }, g = function(e, t) {
        var i;
        if (t) {
            for (var n in t) {
                if (e === t[n].alias) {
                    i = t[n];
                    break;
                }
            }
        }
        return i;
    }, m = function(e, t, i) {
        if (!e && !t) {
            e = -96;
            t = -96;
        }
        if (e < 0) {
            e = -1 * i["w"] * 72 / e / this.internal.scaleFactor;
        }
        if (t < 0) {
            t = -1 * i["h"] * 72 / t / this.internal.scaleFactor;
        }
        if (e === 0) {
            e = t * i["w"] / i["h"];
        }
        if (t === 0) {
            t = e * i["h"] / i["w"];
        }
        return [ e, t ];
    }, v = function(e, t, i, n, r, a, o) {
        var s = m.call(this, i, n, r), l = this.internal.getCoordinateString, c = this.internal.getVerticalCoordinateString;
        i = s[0];
        n = s[1];
        o[a] = r;
        this.internal.write("q", l(i), "0 0", l(n), l(e), c(t + n), "cm /I" + r["i"], "Do Q");
    };
    e.color_spaces = {
        DEVICE_RGB: "DeviceRGB",
        DEVICE_GRAY: "DeviceGray",
        DEVICE_CMYK: "DeviceCMYK",
        CAL_GREY: "CalGray",
        CAL_RGB: "CalRGB",
        LAB: "Lab",
        ICC_BASED: "ICCBased",
        INDEXED: "Indexed",
        PATTERN: "Pattern",
        SEPERATION: "Seperation",
        DEVICE_N: "DeviceN"
    };
    e.decode = {
        DCT_DECODE: "DCTDecode",
        FLATE_DECODE: "FlateDecode",
        LZW_DECODE: "LZWDecode",
        JPX_DECODE: "JPXDecode",
        JBIG2_DECODE: "JBIG2Decode",
        ASCII85_DECODE: "ASCII85Decode",
        ASCII_HEX_DECODE: "ASCIIHexDecode",
        RUN_LENGTH_DECODE: "RunLengthDecode",
        CCITT_FAX_DECODE: "CCITTFaxDecode"
    };
    e.image_compression = {
        NONE: "NONE",
        FAST: "FAST",
        MEDIUM: "MEDIUM",
        SLOW: "SLOW"
    };
    e.sHashCode = function(e) {
        return Array.prototype.reduce && e.split("").reduce(function(e, t) {
            e = (e << 5) - e + t.charCodeAt(0);
            return e & e;
        }, 0);
    };
    e.isString = function(e) {
        return typeof e === "string";
    };
    e.extractInfoFromBase64DataURI = function(e) {
        return /^data:([\w]+?\/([\w]+?));base64,(.+?)$/g.exec(e);
    };
    e.supportsArrayBuffer = function() {
        return typeof ArrayBuffer !== "undefined" && typeof Uint8Array !== "undefined";
    };
    e.isArrayBuffer = function(e) {
        if (!this.supportsArrayBuffer()) return false;
        return e instanceof ArrayBuffer;
    };
    e.isArrayBufferView = function(e) {
        if (!this.supportsArrayBuffer()) return false;
        if (typeof Uint32Array === "undefined") return false;
        return e instanceof Int8Array || e instanceof Uint8Array || typeof Uint8ClampedArray !== "undefined" && e instanceof Uint8ClampedArray || e instanceof Int16Array || e instanceof Uint16Array || e instanceof Int32Array || e instanceof Uint32Array || e instanceof Float32Array || e instanceof Float64Array;
    };
    e.binaryStringToUint8Array = function(e) {
        var t = e.length;
        var i = new Uint8Array(t);
        for (var n = 0; n < t; n++) {
            i[n] = e.charCodeAt(n);
        }
        return i;
    };
    e.arrayBufferToBinaryString = function(e) {
        if ("TextDecoder" in window) {
            var t = new TextDecoder("ascii");
            return t.decode(e);
        }
        if (this.isArrayBuffer(e)) e = new Uint8Array(e);
        var i = "";
        var n = e.byteLength;
        for (var r = 0; r < n; r++) {
            i += String.fromCharCode(e[r]);
        }
        return i;
    };
    e.arrayBufferToBase64 = function(e) {
        var t = "";
        var i = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
        var n = new Uint8Array(e);
        var r = n.byteLength;
        var a = r % 3;
        var o = r - a;
        var s, l, c, u;
        var f;
        for (var d = 0; d < o; d = d + 3) {
            f = n[d] << 16 | n[d + 1] << 8 | n[d + 2];
            s = (f & 16515072) >> 18;
            l = (f & 258048) >> 12;
            c = (f & 4032) >> 6;
            u = f & 63;
            t += i[s] + i[l] + i[c] + i[u];
        }
        if (a == 1) {
            f = n[o];
            s = (f & 252) >> 2;
            l = (f & 3) << 4;
            t += i[s] + i[l] + "==";
        } else if (a == 2) {
            f = n[o] << 8 | n[o + 1];
            s = (f & 64512) >> 10;
            l = (f & 1008) >> 4;
            c = (f & 15) << 2;
            t += i[s] + i[l] + i[c] + "=";
        }
        return t;
    };
    e.createImageInfo = function(e, t, i, n, r, a, o, s, l, c, u, f) {
        var d = {
            alias: s,
            w: t,
            h: i,
            cs: n,
            bpc: r,
            i: o,
            data: e
        };
        if (a) d.f = a;
        if (l) d.dp = l;
        if (c) d.trns = c;
        if (u) d.pal = u;
        if (f) d.smask = f;
        return d;
    };
    e.addImage = function(e, t, n, r, a, m, y, b, w) {
        "use strict";
        if (typeof t !== "string") {
            var C = m;
            m = a;
            a = r;
            r = n;
            n = t;
            t = C;
        }
        if (typeof e === "object" && !h(e) && "imageData" in e) {
            var x = e;
            e = x.imageData;
            t = x.format || t;
            n = x.x || n || 0;
            r = x.y || r || 0;
            a = x.w || a;
            m = x.h || m;
            y = x.alias || y;
            b = x.compression || b;
            w = x.rotation || x.angle || w;
        }
        if (isNaN(n) || isNaN(r)) {
            console.error("jsPDF.addImage: Invalid coordinates", arguments);
            throw new Error("Invalid coordinates passed to jsPDF.addImage");
        }
        var _ = s.call(this), S;
        if (!(S = g(e, _))) {
            var k;
            if (h(e)) e = p(e, t, w);
            if (c(y)) y = u(e);
            if (!(S = g(y, _))) {
                if (this.isString(e)) {
                    var A = this.extractInfoFromBase64DataURI(e);
                    if (A) {
                        t = A[2];
                        e = atob(A[3]);
                    } else {
                        if (e.charCodeAt(0) === 137 && e.charCodeAt(1) === 80 && e.charCodeAt(2) === 78 && e.charCodeAt(3) === 71) t = "png";
                    }
                }
                t = (t || "JPEG").toLowerCase();
                if (f(t)) throw new Error("addImage currently only supports formats " + i + ", not '" + t + "'");
                if (d(t)) throw new Error("please ensure that the plugin for '" + t + "' support is added");
                if (this.supportsArrayBuffer()) {
                    if (!(e instanceof Uint8Array)) {
                        k = e;
                        e = this.binaryStringToUint8Array(e);
                    }
                }
                S = this["process" + t.toUpperCase()](e, l(_), y, o(b), k);
                if (!S) throw new Error("An unkwown error occurred whilst processing the image");
            }
        }
        v.call(this, n, r, a, m, S, S.i, _);
        return this;
    };
    var y = function(e) {
        "use strict";
        var t, i, n;
        if (!e.charCodeAt(0) === 255 || !e.charCodeAt(1) === 216 || !e.charCodeAt(2) === 255 || !e.charCodeAt(3) === 224 || !e.charCodeAt(6) === "J".charCodeAt(0) || !e.charCodeAt(7) === "F".charCodeAt(0) || !e.charCodeAt(8) === "I".charCodeAt(0) || !e.charCodeAt(9) === "F".charCodeAt(0) || !e.charCodeAt(10) === 0) {
            throw new Error("getJpegSize requires a binary string jpeg file");
        }
        var r = e.charCodeAt(4) * 256 + e.charCodeAt(5);
        var a = 4, o = e.length;
        while (a < o) {
            a += r;
            if (e.charCodeAt(a) !== 255) {
                throw new Error("getJpegSize could not find the size of the image");
            }
            if (e.charCodeAt(a + 1) === 192 || e.charCodeAt(a + 1) === 193 || e.charCodeAt(a + 1) === 194 || e.charCodeAt(a + 1) === 195 || e.charCodeAt(a + 1) === 196 || e.charCodeAt(a + 1) === 197 || e.charCodeAt(a + 1) === 198 || e.charCodeAt(a + 1) === 199) {
                i = e.charCodeAt(a + 5) * 256 + e.charCodeAt(a + 6);
                t = e.charCodeAt(a + 7) * 256 + e.charCodeAt(a + 8);
                n = e.charCodeAt(a + 9);
                return [ t, i, n ];
            } else {
                a += 2;
                r = e.charCodeAt(a) * 256 + e.charCodeAt(a + 1);
            }
        }
    }, b = function(e) {
        var t = e[0] << 8 | e[1];
        if (t !== 65496) throw new Error("Supplied data is not a JPEG");
        var i = e.length, n = (e[4] << 8) + e[5], r = 4, a, o, s, l;
        while (r < i) {
            r += n;
            a = w(e, r);
            n = (a[2] << 8) + a[3];
            if ((a[1] === 192 || a[1] === 194) && a[0] === 255 && n > 7) {
                a = w(e, r + 5);
                o = (a[2] << 8) + a[3];
                s = (a[0] << 8) + a[1];
                l = a[4];
                return {
                    width: o,
                    height: s,
                    numcomponents: l
                };
            }
            r += 2;
        }
        throw new Error("getJpegSizeFromBytes could not find the size of the image");
    }, w = function(e, t) {
        return e.subarray(t, t + 5);
    };
    e.processJPEG = function(e, t, i, n, r) {
        "use strict";
        var a = this.color_spaces.DEVICE_RGB, o = this.decode.DCT_DECODE, s = 8, l;
        if (this.isString(e)) {
            l = y(e);
            return this.createImageInfo(e, l[0], l[1], l[3] == 1 ? this.color_spaces.DEVICE_GRAY : a, s, o, t, i);
        }
        if (this.isArrayBuffer(e)) e = new Uint8Array(e);
        if (this.isArrayBufferView(e)) {
            l = b(e);
            e = r || this.arrayBufferToBinaryString(e);
            return this.createImageInfo(e, l.width, l.height, l.numcomponents == 1 ? this.color_spaces.DEVICE_GRAY : a, s, o, t, i);
        }
        return null;
    };
    e.processJPG = function() {
        return this.processJPEG.apply(this, arguments);
    };
})(jsPDF.API);

(function(e) {
    e.autoPrint = function() {
        "use strict";
        var e;
        this.internal.events.subscribe("postPutResources", function() {
            e = this.internal.newObject();
            this.internal.write("<< /S/Named /Type/Action /N/Print >>", "endobj");
        });
        this.internal.events.subscribe("putCatalog", function() {
            this.internal.write("/OpenAction " + e + " 0" + " R");
        });
        return this;
    };
})(jsPDF.API);

(function(e) {
    e.events.push([ "initialized", function() {
        this.canvas.pdf = this;
    } ]);
    e.canvas = {
        getContext: function(e) {
            return this.pdf.context2d;
        },
        style: {}
    };
    Object.defineProperty(e.canvas, "width", {
        get: function() {
            return this._width;
        },
        set: function(e) {
            this._width = e;
            this.getContext("2d").pageWrapX = e + 1;
        }
    });
    Object.defineProperty(e.canvas, "height", {
        get: function() {
            return this._height;
        },
        set: function(e) {
            this._height = e;
            this.getContext("2d").pageWrapY = e + 1;
        }
    });
    return this;
})(jsPDF.API);

(function(e) {
    e.events.push([ "initialized", function() {
        this.context2d.pdf = this;
        this.context2d.internal.pdf = this;
        this.context2d.ctx = new i();
        this.context2d.ctxStack = [];
        this.context2d.path = [];
    } ]);
    e.context2d = {
        pageWrapXEnabled: false,
        pageWrapYEnabled: true,
        pageWrapX: 9999999,
        pageWrapY: 9999999,
        f2: function(e) {
            return e.toFixed(2);
        },
        fillRect: function(e, t, i, n) {
            e = this._wrapX(e);
            t = this._wrapY(t);
            this.pdf.rect(e, t, i, n, "f");
        },
        strokeRect: function(e, t, i, n) {
            e = this._wrapX(e);
            t = this._wrapY(t);
            this.pdf.rect(e, t, i, n, "s");
        },
        clearRect: function(e, t, i, n) {
            e = this._wrapX(e);
            t = this._wrapY(t);
            this.save();
            this.setFillStyle("#ffffff");
            this.pdf.rect(e, t, i, n, "f");
            this.restore();
        },
        save: function() {
            this.ctx._fontSize = this.pdf.internal.getFontSize();
            var e = new i();
            e.copy(this.ctx);
            this.ctxStack.push(this.ctx);
            this.ctx = e;
        },
        restore: function() {
            this.ctx = this.ctxStack.pop();
            this.setFillStyle(this.ctx.fillStyle);
            this.setStrokeStyle(this.ctx.strokeStyle);
            this.setFont(this.ctx.font);
            this.pdf.setFontSize(this.ctx._fontSize);
            this.setLineCap(this.ctx.lineCap);
            this.setLineWidth(this.ctx.lineWidth);
            this.setLineJoin(this.ctx.lineJoin);
        },
        beginPath: function() {
            this.path = [];
        },
        closePath: function() {
            this.path.push({
                type: "close"
            });
        },
        setFillStyle: function(e) {
            var t, i, n, r;
            var a = this.internal.rxRgb.exec(e);
            if (a != null) {
                t = parseInt(a[1]);
                i = parseInt(a[2]);
                n = parseInt(a[3]);
            } else {
                a = this.internal.rxRgba.exec(e);
                if (a != null) {
                    t = parseInt(a[1]);
                    i = parseInt(a[2]);
                    n = parseInt(a[3]);
                    r = parseInt(a[4]);
                } else {
                    if (e.charAt(0) != "#") {
                        e = CssColors.colorNameToHex(e);
                        if (!e) {
                            e = "#000000";
                        }
                    } else {}
                    this.ctx.fillStyle = e;
                    if (e.length === 4) {
                        t = this.ctx.fillStyle.substring(1, 2);
                        t += t;
                        i = this.ctx.fillStyle.substring(2, 3);
                        i += i;
                        n = this.ctx.fillStyle.substring(3, 4);
                        n += n;
                    } else {
                        t = this.ctx.fillStyle.substring(1, 3);
                        i = this.ctx.fillStyle.substring(3, 5);
                        n = this.ctx.fillStyle.substring(5, 7);
                    }
                    t = parseInt(t, 16);
                    i = parseInt(i, 16);
                    n = parseInt(n, 16);
                }
            }
            this.pdf.setFillColor(t, i, n, {
                a: r
            });
            this.pdf.setTextColor(t, i, n, {
                a: r
            });
        },
        setStrokeStyle: function(e) {
            if (e.charAt(0) != "#") {
                e = CssColors.colorNameToHex(e);
                if (!e) {
                    e = "#000000";
                }
            }
            this.ctx.strokeStyle = e;
            var t = this.ctx.strokeStyle.substring(1, 3);
            t = parseInt(t, 16);
            var i = this.ctx.strokeStyle.substring(3, 5);
            i = parseInt(i, 16);
            var n = this.ctx.strokeStyle.substring(5, 7);
            n = parseInt(n, 16);
            this.pdf.setDrawColor(t, i, n);
        },
        fillText: function(e, t, i, n) {
            t = this._wrapX(t);
            i = this._wrapY(i);
            this.pdf.text(e, t, this._getBaseline(i));
        },
        strokeText: function(e, t, i, n) {
            t = this._wrapX(t);
            i = this._wrapY(i);
            this.pdf.text(e, t, this._getBaseline(i), {
                stroke: true
            });
        },
        setFont: function(e) {
            this.ctx.font = e;
            var t = /\s*(\w+)\s+(\w+)\s+(\w+)\s+([\d\.]+)(px|pt|em)\s+["']?(\w+)['"]?/;
            c = t.exec(e);
            if (c != null) {
                var i = c[1];
                var n = c[2];
                var r = c[3];
                var a = c[4];
                var o = c[5];
                var s = c[6];
                if ("px" === o) {
                    a = Math.floor(parseFloat(a));
                } else if ("em" === o) {
                    a = Math.floor(parseFloat(a) * this.pdf.getFontSize());
                } else {
                    a = Math.floor(parseFloat(a));
                }
                this.pdf.setFontSize(a);
                if (r === "bold" || r === "700") {
                    this.pdf.setFontStyle("bold");
                } else {
                    if (i === "italic") {
                        this.pdf.setFontStyle("italic");
                    } else {
                        this.pdf.setFontStyle("normal");
                    }
                }
                var l = s;
                this.pdf.setFont(l, d);
            } else {
                var t = /(\d+)(pt|px|em)\s+(\w+)\s*(\w+)?/;
                var c = t.exec(e);
                if (c != null) {
                    var u = c[1];
                    var f = c[2];
                    var l = c[3];
                    var d = c[4];
                    if (!d) {
                        d = "normal";
                    }
                    if ("em" === o) {
                        u = Math.floor(parseFloat(a) * this.pdf.getFontSize());
                    } else {
                        u = Math.floor(parseFloat(u));
                    }
                    this.pdf.setFontSize(u);
                    this.pdf.setFont(l, d);
                }
            }
        },
        setTextBaseline: function(e) {
            this.ctx.textBaseline = e;
        },
        getTextBaseline: function() {
            return this.ctx.textBaseline;
        },
        setLineWidth: function(e) {
            this.ctx.lineWidth = e;
            this.pdf.setLineWidth(e);
        },
        setLineCap: function(e) {
            this.ctx.lineCap = e;
            this.pdf.setLineCap(e);
        },
        setLineJoin: function(e) {
            this.ctx.lineJon = e;
            this.pdf.setLineJoin(e);
        },
        moveTo: function(e, t) {
            e = this._wrapX(e);
            t = this._wrapY(t);
            var i = {
                type: "mt",
                x: e,
                y: t
            };
            this.path.push(i);
        },
        _wrapX: function(e) {
            if (this.pageWrapXEnabled) {
                return e % this.pageWrapX;
            } else {
                return e;
            }
        },
        _wrapY: function(e) {
            if (this.pageWrapYEnabled) {
                this._gotoPage(this._page(e));
                return (e - this.lastBreak) % this.pageWrapY;
            } else {
                return e;
            }
        },
        lastBreak: 0,
        pageBreaks: [],
        _page: function(e) {
            if (this.pageWrapYEnabled) {
                this.lastBreak = 0;
                var t = 0;
                var i = 0;
                for (var n = 0; n < this.pageBreaks.length; n++) {
                    if (e >= this.pageBreaks[n]) {
                        t++;
                        if (this.lastBreak === 0) {
                            i++;
                        }
                        var r = this.pageBreaks[n] - this.lastBreak;
                        this.lastBreak = this.pageBreaks[n];
                        var a = Math.floor(r / this.pageWrapY);
                        i += a;
                    }
                }
                if (this.lastBreak === 0) {
                    var a = Math.floor(e / this.pageWrapY) + 1;
                    i += a;
                }
                return i + t;
            } else {
                return this.pdf.internal.getCurrentPageInfo().pageNumber;
            }
        },
        _gotoPage: function(e) {},
        lineTo: function(e, t) {
            e = this._wrapX(e);
            t = this._wrapY(t);
            var i = {
                type: "lt",
                x: e,
                y: t
            };
            this.path.push(i);
        },
        bezierCurveTo: function(e, t, i, n, r, a) {
            e = this._wrapX(e);
            t = this._wrapY(t);
            i = this._wrapX(i);
            n = this._wrapY(n);
            r = this._wrapX(r);
            a = this._wrapY(a);
            var o = {
                type: "bct",
                x1: e,
                y1: t,
                x2: i,
                y2: n,
                x: r,
                y: a
            };
            this.path.push(o);
        },
        quadraticCurveTo: function(e, t, i, n) {
            e = this._wrapX(e);
            t = this._wrapY(t);
            i = this._wrapX(i);
            n = this._wrapY(n);
            var r = {
                type: "qct",
                x1: e,
                y1: t,
                x: i,
                y: n
            };
            this.path.push(r);
        },
        arc: function(e, t, i, n, r, a) {
            e = this._wrapX(e);
            t = this._wrapY(t);
            var o = {
                type: "arc",
                x: e,
                y: t,
                radius: i,
                startAngle: n,
                endAngle: r,
                anticlockwise: a
            };
            this.path.push(o);
        },
        drawImage: function(e, t, i, n, r, a, o, s, l) {
            if (a !== undefined) {
                t = a;
                i = o;
                n = s;
                r = l;
            }
            t = this._wrapX(t);
            i = this._wrapY(i);
            var c;
            var u = /data:image\/(\w+).*/i;
            var f = u.exec(e);
            if (f != null) {
                c = f[1];
            } else {
                c = "png";
            }
            this.pdf.addImage(e, c, t, i, n, r);
        },
        stroke: function() {
            var e;
            var t = [];
            var i;
            var n = false;
            for (var r = 0; r < this.path.length; r++) {
                var a = this.path[r];
                switch (a.type) {
                  case "mt":
                    e = a;
                    if (typeof e != "undefined") {
                        this.pdf.lines(t, e.x, e.y, null, "s");
                        t = [];
                    }
                    break;

                  case "lt":
                    var o = [ a.x - this.path[r - 1].x, a.y - this.path[r - 1].y ];
                    t.push(o);
                    break;

                  case "bct":
                    var o = [ a.x1 - this.path[r - 1].x, a.y1 - this.path[r - 1].y, a.x2 - this.path[r - 1].x, a.y2 - this.path[r - 1].y, a.x - this.path[r - 1].x, a.y - this.path[r - 1].y ];
                    t.push(o);
                    break;

                  case "qct":
                    var s = this.path[r - 1].x + 2 / 3 * (a.x1 - this.path[r - 1].x);
                    var l = this.path[r - 1].y + 2 / 3 * (a.y1 - this.path[r - 1].y);
                    var c = a.x + 2 / 3 * (a.x1 - a.x);
                    var u = a.y + 2 / 3 * (a.y1 - a.y);
                    var f = a.x;
                    var d = a.y;
                    var o = [ s - this.path[r - 1].x, l - this.path[r - 1].y, c - this.path[r - 1].x, u - this.path[r - 1].y, f - this.path[r - 1].x, d - this.path[r - 1].y ];
                    t.push(o);
                    break;

                  case "close":
                    n = true;
                    break;
                }
            }
            if (typeof e != "undefined") {
                this.pdf.lines(t, e.x, e.y, null, "s", n);
            }
            for (var r = 0; r < this.path.length; r++) {
                var a = this.path[r];
                switch (a.type) {
                  case "arc":
                    var e = a.startAngle * 360 / (2 * Math.PI);
                    var h = a.endAngle * 360 / (2 * Math.PI);
                    this.internal.arc(a.x, a.y, a.radius, e, h, a.anticlockwise, "s");
                    break;
                }
            }
            this.path = [];
        },
        fill: function() {
            var e;
            var t = [];
            var i;
            for (var n = 0; n < this.path.length; n++) {
                var r = this.path[n];
                switch (r.type) {
                  case "mt":
                    e = r;
                    if (typeof e != "undefined") {
                        this.pdf.lines(t, e.x, e.y, null, "f");
                        t = [];
                    }
                    break;

                  case "lt":
                    var a = [ r.x - this.path[n - 1].x, r.y - this.path[n - 1].y ];
                    t.push(a);
                    break;

                  case "bct":
                    var a = [ r.x1 - this.path[n - 1].x, r.y1 - this.path[n - 1].y, r.x2 - this.path[n - 1].x, r.y2 - this.path[n - 1].y, r.x - this.path[n - 1].x, r.y - this.path[n - 1].y ];
                    t.push(a);
                    break;

                  case "qct":
                    var o = this.path[n - 1].x + 2 / 3 * (r.x1 - this.path[n - 1].x);
                    var s = this.path[n - 1].y + 2 / 3 * (r.y1 - this.path[n - 1].y);
                    var l = r.x + 2 / 3 * (r.x1 - r.x);
                    var c = r.y + 2 / 3 * (r.y1 - r.y);
                    var u = r.x;
                    var f = r.y;
                    var a = [ o - this.path[n - 1].x, s - this.path[n - 1].y, l - this.path[n - 1].x, c - this.path[n - 1].y, u - this.path[n - 1].x, f - this.path[n - 1].y ];
                    t.push(a);
                    break;
                }
            }
            if (typeof e != "undefined") {
                this.pdf.lines(t, e.x, e.y, null, "f");
            }
            for (var n = 0; n < this.path.length; n++) {
                var r = this.path[n];
                switch (r.type) {
                  case "arc":
                    var e = r.startAngle * 360 / (2 * Math.PI);
                    var d = r.endAngle * 360 / (2 * Math.PI);
                    this.internal.arc(r.x, r.y, r.radius, e, d, r.anticlockwise, "f");
                    break;

                  case "close":
                    this.pdf.internal.out("h");
                    break;
                }
            }
            this.path = [];
        },
        clip: function() {},
        translate: function(e, t) {
            this.ctx._translate = {
                x: e,
                y: t
            };
        },
        measureText: function(e) {
            var t = this.pdf;
            return {
                getWidth: function() {
                    var i = t.internal.getFontSize();
                    var n = t.getStringUnitWidth(e) * i / t.internal.scaleFactor;
                    return n;
                },
                get width() {
                    return this.getWidth(e);
                }
            };
        },
        _getBaseline: function(e) {
            var t = parseInt(this.pdf.internal.getFontSize());
            var i = t * .25;
            switch (this.ctx.textBaseline) {
              case "bottom":
                return e - i;

              case "top":
                return e + t;

              case "hanging":
                return e + t - i;

              case "middle":
                return e + t / 2 - i;

              case "ideographic":
                return e;

              case "alphabetic":
              default:
                return e;
            }
        }
    };
    var t = e.context2d;
    Object.defineProperty(t, "fillStyle", {
        set: function(e) {
            this.setFillStyle(e);
        },
        get: function() {
            return this.ctx.fillStyle;
        }
    });
    Object.defineProperty(t, "textBaseline", {
        set: function(e) {
            this.setTextBaseline(e);
        },
        get: function() {
            return this.getTextBaseline();
        }
    });
    Object.defineProperty(t, "font", {
        set: function(e) {
            this.setFont(e);
        },
        get: function() {
            return this.getFont();
        }
    });
    t.internal = {};
    t.internal.rxRgb = /rgb\s*\(\s*(\d+),\s*(\d+),\s*(\d+\s*)\)/;
    t.internal.rxRgba = /rgba\s*\(\s*(\d+),\s*(\d+),\s*(\d+),\s*(\d+)\s*\)/;
    t.internal.arc = function(e, t, i, n, r, a, o) {
        var s = this.pdf.internal.scaleFactor;
        var l = this.pdf.internal.pageSize.height;
        var c = this.pdf.internal.f2;
        var u = n * (Math.PI / 180);
        var f = r * (Math.PI / 180);
        var d = this.createArc(i, u, f, a);
        var h = null;
        for (var p = 0; p < d.length; p++) {
            var g = d[p];
            if (p == 0) {
                this.pdf.internal.out([ c((g.x1 + e) * s), c((l - (g.y1 + t)) * s), "m", c((g.x2 + e) * s), c((l - (g.y2 + t)) * s), c((g.x3 + e) * s), c((l - (g.y3 + t)) * s), c((g.x4 + e) * s), c((l - (g.y4 + t)) * s), "c" ].join(" "));
            } else {
                this.pdf.internal.out([ c((g.x2 + e) * s), c((l - (g.y2 + t)) * s), c((g.x3 + e) * s), c((l - (g.y3 + t)) * s), c((g.x4 + e) * s), c((l - (g.y4 + t)) * s), "c" ].join(" "));
            }
        }
        if (o !== null) {
            this.pdf.internal.out(this.pdf.internal.getStyle(o));
        }
    };
    t.internal.createArc = function(e, t, i, n) {
        var r = 1e-5;
        var a = Math.PI * 2;
        var o = t;
        if (o < a || o > a) {
            o = o % a;
        }
        var s = i;
        if (s < a || s > a) {
            s = s % a;
        }
        var l = [];
        var c = Math.PI / 2;
        var u = n ? -1 : +1;
        var f = t;
        for (var d = Math.min(a, Math.abs(s - o)); d > r; ) {
            var h = f + u * Math.min(d, c);
            l.push(this.createSmallArc(e, f, h));
            d -= Math.abs(h - f);
            f = h;
        }
        return l;
    };
    t.internal.createSmallArc = function(e, t, i) {
        var n = (i - t) / 2;
        var r = e * Math.cos(n);
        var a = e * Math.sin(n);
        var o = r;
        var s = -a;
        var l = o * o + s * s;
        var c = l + o * r + s * a;
        var u = 4 / 3 * (Math.sqrt(2 * l * c) - c) / (o * a - s * r);
        var f = o - u * s;
        var d = s + u * o;
        var h = f;
        var p = -d;
        var g = n + t;
        var m = Math.cos(g);
        var v = Math.sin(g);
        return {
            x1: e * Math.cos(t),
            y1: e * Math.sin(t),
            x2: f * m - d * v,
            y2: f * v + d * m,
            x3: h * m - p * v,
            y3: h * v + p * m,
            x4: e * Math.cos(i),
            y4: e * Math.sin(i)
        };
    };
    function i() {
        this.fillStyle = "#000000";
        this.strokeStyle = "#000000";
        this.font = "12pt times";
        this.textBaseline = "alphabetic";
        this.lineWidth = 1;
        this.lineJoin = "miter";
        this.lineCap = "butt";
        this._translate = {
            x: 0,
            y: 0
        };
        this.copy = function(e) {
            this.fillStyle = e.fillStyle;
            this.strokeStyle = e.strokeStyle;
            this.font = e.font;
            this.lineWidth = e.lineWidth;
            this.lineJoin = e.lineJoin;
            this.lineCap = e.lineCap;
            this.textBaseline = e.textBaseline;
            this._fontSize = e._fontSize;
            this._translate = {
                x: e._translate.x,
                y: e._translate.y
            };
        };
    }
    return this;
})(jsPDF.API);

(function(e) {
    e.events.push([ "postPutResources", function() {
        var e = this;
        var t = /^(\d+) 0 obj$/;
        if (this.outline.root.children.length > 0) {
            var i = e.outline.render().split(/\r\n/);
            for (var n = 0; n < i.length; n++) {
                var r = i[n];
                var a = t.exec(r);
                if (a != null) {
                    var o = a[1];
                    e.internal.newObjectDeferredBegin(o);
                }
                e.internal.write(r);
            }
        }
        if (this.outline.createNamedDestinations) {
            var s = this.internal.pages.length;
            var l = [];
            for (var n = 0; n < s; n++) {
                var c = e.internal.newObject();
                l.push(c);
                var u = e.internal.getPageInfo(n + 1);
                e.internal.write("<< /D[" + u.objId + " 0 R /XYZ null null null]>> endobj");
            }
            var f = e.internal.newObject();
            e.internal.write("<< /Names [ ");
            for (var n = 0; n < l.length; n++) {
                e.internal.write("(page_" + (n + 1) + ")" + l[n] + " 0 R");
            }
            e.internal.write(" ] >>", "endobj");
            namesOid = e.internal.newObject();
            e.internal.write("<< /Dests " + f + " 0 R");
            e.internal.write(">>", "endobj");
        }
    } ]);
    e.events.push([ "putCatalog", function() {
        var e = this;
        if (e.outline.root.children.length > 0) {
            e.internal.write("/Outlines", this.outline.makeRef(this.outline.root));
            if (this.outline.createNamedDestinations) {
                e.internal.write("/Names " + namesOid + " 0 R");
            }
        }
    } ]);
    e.events.push([ "initialized", function() {
        var e = this;
        e.outline = {
            createNamedDestinations: false,
            root: {
                children: []
            }
        };
        var t;
        var i = [];
        e.outline.add = function(e, t, i) {
            var n = {
                title: t,
                options: i,
                children: []
            };
            if (e == null) {
                e = this.root;
            }
            e.children.push(n);
            return n;
        };
        e.outline.render = function() {
            this.ctx = {};
            this.ctx.val = "";
            this.ctx.pdf = e;
            this.genIds_r(this.root);
            this.renderRoot(this.root);
            this.renderItems(this.root);
            return this.ctx.val;
        };
        e.outline.genIds_r = function(t) {
            t.id = e.internal.newObjectDeferred();
            for (var i = 0; i < t.children.length; i++) {
                this.genIds_r(t.children[i]);
            }
        };
        e.outline.renderRoot = function(e) {
            this.objStart(e);
            this.line("/Type /Outlines");
            if (e.children.length > 0) {
                this.line("/First " + this.makeRef(e.children[0]));
                this.line("/Last " + this.makeRef(e.children[e.children.length - 1]));
            }
            this.line("/Count " + this.count_r({
                count: 0
            }, e));
            this.objEnd();
        };
        e.outline.renderItems = function(t) {
            for (var i = 0; i < t.children.length; i++) {
                var n = t.children[i];
                this.objStart(n);
                this.line("/Title " + this.makeString(n.title));
                this.line("/Parent " + this.makeRef(t));
                if (i > 0) {
                    this.line("/Prev " + this.makeRef(t.children[i - 1]));
                }
                if (i < t.children.length - 1) {
                    this.line("/Next " + this.makeRef(t.children[i + 1]));
                }
                if (n.children.length > 0) {
                    this.line("/First " + this.makeRef(n.children[0]));
                    this.line("/Last " + this.makeRef(n.children[n.children.length - 1]));
                }
                var r = this.count = this.count_r({
                    count: 0
                }, n);
                if (r > 0) {
                    this.line("/Count " + r);
                }
                if (n.options) {
                    if (n.options.pageNumber) {
                        var a = e.internal.getPageInfo(n.options.pageNumber);
                        this.line("/Dest " + "[" + a.objId + " 0 R /XYZ 0 " + this.ctx.pdf.internal.pageSize.height + " 0]");
                    }
                }
                this.objEnd();
            }
            for (var i = 0; i < t.children.length; i++) {
                var n = t.children[i];
                this.renderItems(n);
            }
        };
        e.outline.line = function(e) {
            this.ctx.val += e + "\r\n";
        };
        e.outline.makeRef = function(e) {
            return e.id + " 0 R";
        };
        e.outline.makeString = function(t) {
            return "(" + e.internal.pdfEscape(t) + ")";
        };
        e.outline.objStart = function(e) {
            this.ctx.val += "\r\n" + e.id + " 0 obj" + "\r\n<<\r\n";
        };
        e.outline.objEnd = function(e) {
            this.ctx.val += ">> \r\n" + "endobj" + "\r\n";
        };
        e.outline.count_r = function(e, t) {
            for (var i = 0; i < t.children.length; i++) {
                e.count++;
                this.count_r(e, t.children[i]);
            }
            return e.count;
        };
    } ]);
    return this;
})(jsPDF.API);

(function(e) {
    "use strict";
    var t = function() {
        return typeof PNG !== "function" || typeof FlateStream !== "function";
    }, i = function(t) {
        return t !== e.image_compression.NONE && n();
    }, n = function() {
        var e = typeof Deflater === "function";
        if (!e) throw new Error("requires deflate.js for compression");
        return e;
    }, r = function(t, i, n, r) {
        var l = 5, h = u;
        switch (r) {
          case e.image_compression.FAST:
            l = 3;
            h = c;
            break;

          case e.image_compression.MEDIUM:
            l = 6;
            h = f;
            break;

          case e.image_compression.SLOW:
            l = 9;
            h = d;
            break;
        }
        t = s(t, i, n, h);
        var p = new Uint8Array(a(l));
        var g = o(t);
        var m = new Deflater(l);
        var v = m.append(t);
        var y = m.flush();
        var b = p.length + v.length + y.length;
        var w = new Uint8Array(b + 4);
        w.set(p);
        w.set(v, p.length);
        w.set(y, p.length + v.length);
        w[b++] = g >>> 24 & 255;
        w[b++] = g >>> 16 & 255;
        w[b++] = g >>> 8 & 255;
        w[b++] = g & 255;
        return e.arrayBufferToBinaryString(w);
    }, a = function(e, t) {
        var i = 8;
        var n = Math.LOG2E * Math.log(32768) - 8;
        var r = n << 4 | i;
        var a = r << 8;
        var o = Math.min(3, (t - 1 & 255) >> 1);
        a |= o << 6;
        a |= 0;
        a += 31 - a % 31;
        return [ r, a & 255 & 255 ];
    }, o = function(e, t) {
        var i = 1;
        var n = i & 65535, r = i >>> 16 & 65535;
        var a = e.length;
        var o;
        var s = 0;
        while (a > 0) {
            o = a > t ? t : a;
            a -= o;
            do {
                n += e[s++];
                r += n;
            } while (--o);
            n %= 65521;
            r %= 65521;
        }
        return (r << 16 | n) >>> 0;
    }, s = function(e, t, i, n) {
        var r = e.length / t, a = new Uint8Array(e.length + r), o = p(), s = 0, l, c, u;
        for (;s < r; s++) {
            u = s * t;
            l = e.subarray(u, u + t);
            if (n) {
                a.set(n(l, i, c), u + s);
            } else {
                var f = 0, d = o.length, h = [];
                for (;f < d; f++) h[f] = o[f](l, i, c);
                var m = g(h.concat());
                a.set(h[m], u + s);
            }
            c = l;
        }
        return a;
    }, l = function(e, t, i) {
        var n = Array.apply([], e);
        n.unshift(0);
        return n;
    }, c = function(e, t, i) {
        var n = [], r = 0, a = e.length, o;
        n[0] = 1;
        for (;r < a; r++) {
            o = e[r - t] || 0;
            n[r + 1] = e[r] - o + 256 & 255;
        }
        return n;
    }, u = function(e, t, i) {
        var n = [], r = 0, a = e.length, o;
        n[0] = 2;
        for (;r < a; r++) {
            o = i && i[r] || 0;
            n[r + 1] = e[r] - o + 256 & 255;
        }
        return n;
    }, f = function(e, t, i) {
        var n = [], r = 0, a = e.length, o, s;
        n[0] = 3;
        for (;r < a; r++) {
            o = e[r - t] || 0;
            s = i && i[r] || 0;
            n[r + 1] = e[r] + 256 - (o + s >>> 1) & 255;
        }
        return n;
    }, d = function(e, t, i) {
        var n = [], r = 0, a = e.length, o, s, l, c;
        n[0] = 4;
        for (;r < a; r++) {
            o = e[r - t] || 0;
            s = i && i[r] || 0;
            l = i && i[r - t] || 0;
            c = h(o, s, l);
            n[r + 1] = e[r] - c + 256 & 255;
        }
        return n;
    }, h = function(e, t, i) {
        var n = e + t - i, r = Math.abs(n - e), a = Math.abs(n - t), o = Math.abs(n - i);
        return r <= a && r <= o ? e : a <= o ? t : i;
    }, p = function() {
        return [ l, c, u, f, d ];
    }, g = function(e) {
        var t = 0, i = e.length, n, r, a;
        while (t < i) {
            n = m(e[t].slice(1));
            if (n < r || !r) {
                r = n;
                a = t;
            }
            t++;
        }
        return a;
    }, m = function(e) {
        var t = 0, i = e.length, n = 0;
        while (t < i) n += Math.abs(e[t++]);
        return n;
    }, v = function(e) {
        console.log("width: " + e.width);
        console.log("height: " + e.height);
        console.log("bits: " + e.bits);
        console.log("colorType: " + e.colorType);
        console.log("transparency:");
        console.log(e.transparency);
        console.log("text:");
        console.log(e.text);
        console.log("compressionMethod: " + e.compressionMethod);
        console.log("filterMethod: " + e.filterMethod);
        console.log("interlaceMethod: " + e.interlaceMethod);
        console.log("imgData:");
        console.log(e.imgData);
        console.log("palette:");
        console.log(e.palette);
        console.log("colors: " + e.colors);
        console.log("colorSpace: " + e.colorSpace);
        console.log("pixelBitlength: " + e.pixelBitlength);
        console.log("hasAlphaChannel: " + e.hasAlphaChannel);
    };
    e.processPNG = function(e, n, a, o, s) {
        "use strict";
        var l = this.color_spaces.DEVICE_RGB, c = this.decode.FLATE_DECODE, u = 8, f, d, h, p, g, m;
        if (this.isArrayBuffer(e)) e = new Uint8Array(e);
        if (this.isArrayBufferView(e)) {
            if (t()) throw new Error("PNG support requires png.js and zlib.js");
            f = new PNG(e);
            e = f.imgData;
            u = f.bits;
            l = f.colorSpace;
            p = f.colors;
            if ([ 4, 6 ].indexOf(f.colorType) !== -1) {
                if (f.bits === 8) {
                    var v = f.pixelBitlength == 32 ? new Uint32Array(f.decodePixels().buffer) : f.pixelBitlength == 16 ? new Uint16Array(f.decodePixels().buffer) : new Uint8Array(f.decodePixels().buffer), y = v.length, b = new Uint8Array(y * f.colors), w = new Uint8Array(y), C = f.pixelBitlength - f.bits, x = 0, _ = 0, S, k;
                    for (;x < y; x++) {
                        S = v[x];
                        k = 0;
                        while (k < C) {
                            b[_++] = S >>> k & 255;
                            k = k + f.bits;
                        }
                        w[x] = S >>> k & 255;
                    }
                }
                if (f.bits === 16) {
                    var v = new Uint32Array(f.decodePixels().buffer), y = v.length, b = new Uint8Array(y * (32 / f.pixelBitlength) * f.colors), w = new Uint8Array(y * (32 / f.pixelBitlength)), A = f.colors > 1, x = 0, _ = 0, E = 0, S;
                    while (x < y) {
                        S = v[x++];
                        b[_++] = S >>> 0 & 255;
                        if (A) {
                            b[_++] = S >>> 16 & 255;
                            S = v[x++];
                            b[_++] = S >>> 0 & 255;
                        }
                        w[E++] = S >>> 16 & 255;
                    }
                    u = 8;
                }
                if (i(o)) {
                    e = r(b, f.width * f.colors, f.colors, o);
                    m = r(w, f.width, 1, o);
                } else {
                    e = b;
                    m = w;
                    c = null;
                }
            }
            if (f.colorType === 3) {
                l = this.color_spaces.INDEXED;
                g = f.palette;
                if (f.transparency.indexed) {
                    var T = f.transparency.indexed;
                    var P = 0, x = 0, y = T.length;
                    for (;x < y; ++x) P += T[x];
                    P = P / 255;
                    if (P === y - 1 && T.indexOf(0) !== -1) {
                        h = [ T.indexOf(0) ];
                    } else if (P !== y) {
                        var v = f.decodePixels(), w = new Uint8Array(v.length), x = 0, y = v.length;
                        for (;x < y; x++) w[x] = T[v[x]];
                        m = r(w, f.width, 1);
                    }
                }
            }
            if (c === this.decode.FLATE_DECODE) d = "/Predictor 15 /Colors " + p + " /BitsPerComponent " + u + " /Columns " + f.width; else d = "/Colors " + p + " /BitsPerComponent " + u + " /Columns " + f.width;
            if (this.isArrayBuffer(e) || this.isArrayBufferView(e)) e = this.arrayBufferToBinaryString(e);
            if (m && this.isArrayBuffer(m) || this.isArrayBufferView(m)) m = this.arrayBufferToBinaryString(m);
            return this.createImageInfo(e, f.width, f.height, l, u, c, n, a, d, h, g, m);
        }
        throw new Error("Unsupported PNG image data, try using JPEG instead.");
    };
})(jsPDF.API);

(function(e) {
    "use strict";
    var t = e.getCharWidthsArray = function(e, t) {
        if (!t) {
            t = {};
        }
        var i = t.widths ? t.widths : this.internal.getFont().metadata.Unicode.widths, n = i.fof ? i.fof : 1, r = t.kerning ? t.kerning : this.internal.getFont().metadata.Unicode.kerning, a = r.fof ? r.fof : 1;
        var o, s, l, c = 0, u = i[0] || n, f = [];
        for (o = 0, s = e.length; o < s; o++) {
            l = e.charCodeAt(o);
            f.push((i[l] || u) / n + (r[l] && r[l][c] || 0) / a);
            c = l;
        }
        return f;
    };
    var i = function(e) {
        var t = e.length, i = 0;
        while (t) {
            t--;
            i += e[t];
        }
        return i;
    };
    var n = e.getStringUnitWidth = function(e, n) {
        return i(t.call(this, e, n));
    };
    var r = function(e, t, i, n) {
        var r = [];
        var a = 0, o = e.length, s = 0;
        while (a !== o && s + t[a] < i) {
            s += t[a];
            a++;
        }
        r.push(e.slice(0, a));
        var l = a;
        s = 0;
        while (a !== o) {
            if (s + t[a] > n) {
                r.push(e.slice(l, a));
                s = 0;
                l = a;
            }
            s += t[a];
            a++;
        }
        if (l !== a) {
            r.push(e.slice(l, a));
        }
        return r;
    };
    var a = function(e, a, o) {
        if (!o) {
            o = {};
        }
        var s = [], l = [ s ], c = o.textIndent || 0, u = 0, f = 0, d, h, p = e.split(" "), g = t(" ", o)[0], m, v, y, b;
        if (o.lineIndent === -1) {
            b = p[0].length + 2;
        } else {
            b = o.lineIndent || 0;
        }
        if (b) {
            var w = Array(b).join(" "), C = [];
            p.map(function(e) {
                e = e.split(/\s*\n/);
                if (e.length > 1) {
                    C = C.concat(e.map(function(e, t) {
                        return (t && e.length ? "\n" : "") + e;
                    }));
                } else {
                    C.push(e[0]);
                }
            });
            p = C;
            b = n(w, o);
        }
        for (m = 0, v = p.length; m < v; m++) {
            var x = 0;
            d = p[m];
            if (b && d[0] == "\n") {
                d = d.substr(1);
                x = 1;
            }
            h = t(d, o);
            f = i(h);
            if (c + u + f > a || x) {
                if (f > a) {
                    y = r(d, h, a - (c + u), a);
                    s.push(y.shift());
                    s = [ y.pop() ];
                    while (y.length) {
                        l.push([ y.shift() ]);
                    }
                    f = i(h.slice(d.length - s[0].length));
                } else {
                    s = [ d ];
                }
                l.push(s);
                c = f + b;
                u = g;
            } else {
                s.push(d);
                c += u + f;
                u = g;
            }
        }
        if (b) {
            var _ = function(e, t) {
                return (t ? w : "") + e.join(" ");
            };
        } else {
            var _ = function(e) {
                return e.join(" ");
            };
        }
        return l.map(_);
    };
    e.splitTextToSize = function(e, t, i) {
        "use strict";
        if (!i) {
            i = {};
        }
        var n = i.fontSize || this.internal.getFontSize(), r = function(e) {
            var t = {
                0: 1
            }, i = {};
            if (!e.widths || !e.kerning) {
                var n = this.internal.getFont(e.fontName, e.fontStyle), r = "Unicode";
                if (n.metadata[r]) {
                    return {
                        widths: n.metadata[r].widths || t,
                        kerning: n.metadata[r].kerning || i
                    };
                }
            } else {
                return {
                    widths: e.widths,
                    kerning: e.kerning
                };
            }
            return {
                widths: t,
                kerning: i
            };
        }.call(this, i);
        var o;
        if (Array.isArray(e)) {
            o = e;
        } else {
            o = e.split(/\r?\n/);
        }
        var s = 1 * this.internal.scaleFactor * t / n;
        r.textIndent = i.textIndent ? i.textIndent * 1 * this.internal.scaleFactor / n : 0;
        r.lineIndent = i.lineIndent;
        var l, c, u = [];
        for (l = 0, c = o.length; l < c; l++) {
            u = u.concat(a(o[l], s, r));
        }
        return u;
    };
})(jsPDF.API);

(function(e) {
    "use strict";
    var t = function(e) {
        var t = "0123456789abcdef", i = "klmnopqrstuvwxyz", n = {};
        for (var r = 0; r < i.length; r++) {
            n[i[r]] = t[r];
        }
        var a, o = {}, s = 1, l, c = o, u = [], f, d = "", h = "", p, g = e.length - 1, m;
        r = 1;
        while (r != g) {
            m = e[r];
            r += 1;
            if (m == "'") {
                if (l) {
                    p = l.join("");
                    l = a;
                } else {
                    l = [];
                }
            } else if (l) {
                l.push(m);
            } else if (m == "{") {
                u.push([ c, p ]);
                c = {};
                p = a;
            } else if (m == "}") {
                f = u.pop();
                f[0][f[1]] = c;
                p = a;
                c = f[0];
            } else if (m == "-") {
                s = -1;
            } else {
                if (p === a) {
                    if (n.hasOwnProperty(m)) {
                        d += n[m];
                        p = parseInt(d, 16) * s;
                        s = +1;
                        d = "";
                    } else {
                        d += m;
                    }
                } else {
                    if (n.hasOwnProperty(m)) {
                        h += n[m];
                        c[p] = parseInt(h, 16) * s;
                        s = +1;
                        p = a;
                        h = "";
                    } else {
                        h += m;
                    }
                }
            }
        }
        return o;
    };
    var i = {
        codePages: [ "WinAnsiEncoding" ],
        WinAnsiEncoding: t("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")
    }, n = {
        Unicode: {
            Courier: i,
            "Courier-Bold": i,
            "Courier-BoldOblique": i,
            "Courier-Oblique": i,
            Helvetica: i,
            "Helvetica-Bold": i,
            "Helvetica-BoldOblique": i,
            "Helvetica-Oblique": i,
            "Times-Roman": i,
            "Times-Bold": i,
            "Times-BoldItalic": i,
            "Times-Italic": i
        }
    }, r = {
        Unicode: {
            "Courier-Oblique": t("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),
            "Times-BoldItalic": t("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),
            "Helvetica-Bold": t("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),
            Courier: t("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),
            "Courier-BoldOblique": t("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),
            "Times-Bold": t("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),
            Helvetica: t("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),
            "Helvetica-BoldOblique": t("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),
            "Courier-Bold": t("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),
            "Times-Italic": t("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),
            "Times-Roman": t("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),
            "Helvetica-Oblique": t("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")
        }
    };
    e.events.push([ "addFonts", function(e) {
        var t, i, a, o, s = "Unicode", l;
        for (i in e.fonts) {
            if (e.fonts.hasOwnProperty(i)) {
                t = e.fonts[i];
                a = r[s][t.PostScriptName];
                if (a) {
                    if (t.metadata[s]) {
                        o = t.metadata[s];
                    } else {
                        o = t.metadata[s] = {};
                    }
                    o.widths = a.widths;
                    o.kerning = a.kerning;
                }
                l = n[s][t.PostScriptName];
                if (l) {
                    if (t.metadata[s]) {
                        o = t.metadata[s];
                    } else {
                        o = t.metadata[s] = {};
                    }
                    o.encoding = l;
                    if (l.codePages && l.codePages.length) {
                        t.encoding = l.codePages[0];
                    }
                }
            }
        }
    } ]);
})(jsPDF.API);

(function(e) {
    e.putTotalPages = function(e) {
        var t = new RegExp(e, "g");
        for (var i = 1; i <= this.internal.getNumberOfPages(); i++) {
            for (var n = 0; n < this.internal.pages[i].length; n++) this.internal.pages[i][n] = this.internal.pages[i][n].replace(t, this.internal.getNumberOfPages());
        }
        return this;
    };
})(jsPDF.API);

var CssColors = {};

CssColors._colorsTable = {
    aliceblue: "#f0f8ff",
    antiquewhite: "#faebd7",
    aqua: "#00ffff",
    aquamarine: "#7fffd4",
    azure: "#f0ffff",
    beige: "#f5f5dc",
    bisque: "#ffe4c4",
    black: "#000000",
    blanchedalmond: "#ffebcd",
    blue: "#0000ff",
    blueviolet: "#8a2be2",
    brown: "#a52a2a",
    burlywood: "#deb887",
    cadetblue: "#5f9ea0",
    chartreuse: "#7fff00",
    chocolate: "#d2691e",
    coral: "#ff7f50",
    cornflowerblue: "#6495ed",
    cornsilk: "#fff8dc",
    crimson: "#dc143c",
    cyan: "#00ffff",
    darkblue: "#00008b",
    darkcyan: "#008b8b",
    darkgoldenrod: "#b8860b",
    darkgray: "#a9a9a9",
    darkgreen: "#006400",
    darkkhaki: "#bdb76b",
    darkmagenta: "#8b008b",
    darkolivegreen: "#556b2f",
    darkorange: "#ff8c00",
    darkorchid: "#9932cc",
    darkred: "#8b0000",
    darksalmon: "#e9967a",
    darkseagreen: "#8fbc8f",
    darkslateblue: "#483d8b",
    darkslategray: "#2f4f4f",
    darkturquoise: "#00ced1",
    darkviolet: "#9400d3",
    deeppink: "#ff1493",
    deepskyblue: "#00bfff",
    dimgray: "#696969",
    dodgerblue: "#1e90ff",
    firebrick: "#b22222",
    floralwhite: "#fffaf0",
    forestgreen: "#228b22",
    fuchsia: "#ff00ff",
    gainsboro: "#dcdcdc",
    ghostwhite: "#f8f8ff",
    gold: "#ffd700",
    goldenrod: "#daa520",
    gray: "#808080",
    green: "#008000",
    greenyellow: "#adff2f",
    honeydew: "#f0fff0",
    hotpink: "#ff69b4",
    "indianred ": "#cd5c5c",
    indigo: "#4b0082",
    ivory: "#fffff0",
    khaki: "#f0e68c",
    lavender: "#e6e6fa",
    lavenderblush: "#fff0f5",
    lawngreen: "#7cfc00",
    lemonchiffon: "#fffacd",
    lightblue: "#add8e6",
    lightcoral: "#f08080",
    lightcyan: "#e0ffff",
    lightgoldenrodyellow: "#fafad2",
    lightgrey: "#d3d3d3",
    lightgreen: "#90ee90",
    lightpink: "#ffb6c1",
    lightsalmon: "#ffa07a",
    lightseagreen: "#20b2aa",
    lightskyblue: "#87cefa",
    lightslategray: "#778899",
    lightsteelblue: "#b0c4de",
    lightyellow: "#ffffe0",
    lime: "#00ff00",
    limegreen: "#32cd32",
    linen: "#faf0e6",
    magenta: "#ff00ff",
    maroon: "#800000",
    mediumaquamarine: "#66cdaa",
    mediumblue: "#0000cd",
    mediumorchid: "#ba55d3",
    mediumpurple: "#9370d8",
    mediumseagreen: "#3cb371",
    mediumslateblue: "#7b68ee",
    mediumspringgreen: "#00fa9a",
    mediumturquoise: "#48d1cc",
    mediumvioletred: "#c71585",
    midnightblue: "#191970",
    mintcream: "#f5fffa",
    mistyrose: "#ffe4e1",
    moccasin: "#ffe4b5",
    navajowhite: "#ffdead",
    navy: "#000080",
    oldlace: "#fdf5e6",
    olive: "#808000",
    olivedrab: "#6b8e23",
    orange: "#ffa500",
    orangered: "#ff4500",
    orchid: "#da70d6",
    palegoldenrod: "#eee8aa",
    palegreen: "#98fb98",
    paleturquoise: "#afeeee",
    palevioletred: "#d87093",
    papayawhip: "#ffefd5",
    peachpuff: "#ffdab9",
    peru: "#cd853f",
    pink: "#ffc0cb",
    plum: "#dda0dd",
    powderblue: "#b0e0e6",
    purple: "#800080",
    red: "#ff0000",
    rosybrown: "#bc8f8f",
    royalblue: "#4169e1",
    saddlebrown: "#8b4513",
    salmon: "#fa8072",
    sandybrown: "#f4a460",
    seagreen: "#2e8b57",
    seashell: "#fff5ee",
    sienna: "#a0522d",
    silver: "#c0c0c0",
    skyblue: "#87ceeb",
    slateblue: "#6a5acd",
    slategray: "#708090",
    snow: "#fffafa",
    springgreen: "#00ff7f",
    steelblue: "#4682b4",
    tan: "#d2b48c",
    teal: "#008080",
    thistle: "#d8bfd8",
    tomato: "#ff6347",
    turquoise: "#40e0d0",
    violet: "#ee82ee",
    wheat: "#f5deb3",
    white: "#ffffff",
    whitesmoke: "#f5f5f5",
    yellow: "#ffff00",
    yellowgreen: "#9acd32"
};

CssColors.colorNameToHex = function(e) {
    e = e.toLowerCase();
    if (typeof this._colorsTable[e] != "undefined") return this._colorsTable[e];
    return false;
};

var Deflater = function(e) {
    var t = 15;
    var i = 30;
    var n = 19;
    var r = 29;
    var a = 256;
    var o = a + 1 + r;
    var s = 2 * o + 1;
    var l = 256;
    var c = 7;
    var u = 16;
    var f = 17;
    var d = 18;
    var h = 8 * 2;
    var p = -1;
    var g = 1;
    var m = 2;
    var v = 0;
    var y = 0;
    var b = 1;
    var w = 3;
    var C = 4;
    var x = 0;
    var _ = 1;
    var S = 2;
    var k = -2;
    var A = -3;
    var E = -5;
    var T = [ 0, 1, 2, 3, 4, 4, 5, 5, 6, 6, 6, 6, 7, 7, 7, 7, 8, 8, 8, 8, 8, 8, 8, 8, 9, 9, 9, 9, 9, 9, 9, 9, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 0, 0, 16, 17, 18, 18, 19, 19, 20, 20, 20, 20, 21, 21, 21, 21, 22, 22, 22, 22, 22, 22, 22, 22, 23, 23, 23, 23, 23, 23, 23, 23, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29 ];
    function P() {
        var e = this;
        function i(i) {
            var n = e.dyn_tree;
            var r = e.stat_desc.static_tree;
            var a = e.stat_desc.extra_bits;
            var o = e.stat_desc.extra_base;
            var l = e.stat_desc.max_length;
            var c;
            var u, f;
            var d;
            var h;
            var p;
            var g = 0;
            for (d = 0; d <= t; d++) i.bl_count[d] = 0;
            n[i.heap[i.heap_max] * 2 + 1] = 0;
            for (c = i.heap_max + 1; c < s; c++) {
                u = i.heap[c];
                d = n[n[u * 2 + 1] * 2 + 1] + 1;
                if (d > l) {
                    d = l;
                    g++;
                }
                n[u * 2 + 1] = d;
                if (u > e.max_code) continue;
                i.bl_count[d]++;
                h = 0;
                if (u >= o) h = a[u - o];
                p = n[u * 2];
                i.opt_len += p * (d + h);
                if (r) i.static_len += p * (r[u * 2 + 1] + h);
            }
            if (g === 0) return;
            do {
                d = l - 1;
                while (i.bl_count[d] === 0) d--;
                i.bl_count[d]--;
                i.bl_count[d + 1] += 2;
                i.bl_count[l]--;
                g -= 2;
            } while (g > 0);
            for (d = l; d !== 0; d--) {
                u = i.bl_count[d];
                while (u !== 0) {
                    f = i.heap[--c];
                    if (f > e.max_code) continue;
                    if (n[f * 2 + 1] != d) {
                        i.opt_len += (d - n[f * 2 + 1]) * n[f * 2];
                        n[f * 2 + 1] = d;
                    }
                    u--;
                }
            }
        }
        function n(e, t) {
            var i = 0;
            do {
                i |= e & 1;
                e >>>= 1;
                i <<= 1;
            } while (--t > 0);
            return i >>> 1;
        }
        function r(e, i, r) {
            var a = [];
            var o = 0;
            var s;
            var l;
            var c;
            for (s = 1; s <= t; s++) {
                a[s] = o = o + r[s - 1] << 1;
            }
            for (l = 0; l <= i; l++) {
                c = e[l * 2 + 1];
                if (c === 0) continue;
                e[l * 2] = n(a[c]++, c);
            }
        }
        e.build_tree = function(t) {
            var n = e.dyn_tree;
            var a = e.stat_desc.static_tree;
            var o = e.stat_desc.elems;
            var l, c;
            var u = -1;
            var f;
            t.heap_len = 0;
            t.heap_max = s;
            for (l = 0; l < o; l++) {
                if (n[l * 2] !== 0) {
                    t.heap[++t.heap_len] = u = l;
                    t.depth[l] = 0;
                } else {
                    n[l * 2 + 1] = 0;
                }
            }
            while (t.heap_len < 2) {
                f = t.heap[++t.heap_len] = u < 2 ? ++u : 0;
                n[f * 2] = 1;
                t.depth[f] = 0;
                t.opt_len--;
                if (a) t.static_len -= a[f * 2 + 1];
            }
            e.max_code = u;
            for (l = Math.floor(t.heap_len / 2); l >= 1; l--) t.pqdownheap(n, l);
            f = o;
            do {
                l = t.heap[1];
                t.heap[1] = t.heap[t.heap_len--];
                t.pqdownheap(n, 1);
                c = t.heap[1];
                t.heap[--t.heap_max] = l;
                t.heap[--t.heap_max] = c;
                n[f * 2] = n[l * 2] + n[c * 2];
                t.depth[f] = Math.max(t.depth[l], t.depth[c]) + 1;
                n[l * 2 + 1] = n[c * 2 + 1] = f;
                t.heap[1] = f++;
                t.pqdownheap(n, 1);
            } while (t.heap_len >= 2);
            t.heap[--t.heap_max] = t.heap[1];
            i(t);
            r(n, e.max_code, t.bl_count);
        };
    }
    P._length_code = [ 0, 1, 2, 3, 4, 5, 6, 7, 8, 8, 9, 9, 10, 10, 11, 11, 12, 12, 12, 12, 13, 13, 13, 13, 14, 14, 14, 14, 15, 15, 15, 15, 16, 16, 16, 16, 16, 16, 16, 16, 17, 17, 17, 17, 17, 17, 17, 17, 18, 18, 18, 18, 18, 18, 18, 18, 19, 19, 19, 19, 19, 19, 19, 19, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 28 ];
    P.base_length = [ 0, 1, 2, 3, 4, 5, 6, 7, 8, 10, 12, 14, 16, 20, 24, 28, 32, 40, 48, 56, 64, 80, 96, 112, 128, 160, 192, 224, 0 ];
    P.base_dist = [ 0, 1, 2, 3, 4, 6, 8, 12, 16, 24, 32, 48, 64, 96, 128, 192, 256, 384, 512, 768, 1024, 1536, 2048, 3072, 4096, 6144, 8192, 12288, 16384, 24576 ];
    P.d_code = function(e) {
        return e < 256 ? T[e] : T[256 + (e >>> 7)];
    };
    P.extra_lbits = [ 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 0 ];
    P.extra_dbits = [ 0, 0, 0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9, 10, 10, 11, 11, 12, 12, 13, 13 ];
    P.extra_blbits = [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 3, 7 ];
    P.bl_order = [ 16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15 ];
    function I(e, t, i, n, r) {
        var a = this;
        a.static_tree = e;
        a.extra_bits = t;
        a.extra_base = i;
        a.elems = n;
        a.max_length = r;
    }
    I.static_ltree = [ 12, 8, 140, 8, 76, 8, 204, 8, 44, 8, 172, 8, 108, 8, 236, 8, 28, 8, 156, 8, 92, 8, 220, 8, 60, 8, 188, 8, 124, 8, 252, 8, 2, 8, 130, 8, 66, 8, 194, 8, 34, 8, 162, 8, 98, 8, 226, 8, 18, 8, 146, 8, 82, 8, 210, 8, 50, 8, 178, 8, 114, 8, 242, 8, 10, 8, 138, 8, 74, 8, 202, 8, 42, 8, 170, 8, 106, 8, 234, 8, 26, 8, 154, 8, 90, 8, 218, 8, 58, 8, 186, 8, 122, 8, 250, 8, 6, 8, 134, 8, 70, 8, 198, 8, 38, 8, 166, 8, 102, 8, 230, 8, 22, 8, 150, 8, 86, 8, 214, 8, 54, 8, 182, 8, 118, 8, 246, 8, 14, 8, 142, 8, 78, 8, 206, 8, 46, 8, 174, 8, 110, 8, 238, 8, 30, 8, 158, 8, 94, 8, 222, 8, 62, 8, 190, 8, 126, 8, 254, 8, 1, 8, 129, 8, 65, 8, 193, 8, 33, 8, 161, 8, 97, 8, 225, 8, 17, 8, 145, 8, 81, 8, 209, 8, 49, 8, 177, 8, 113, 8, 241, 8, 9, 8, 137, 8, 73, 8, 201, 8, 41, 8, 169, 8, 105, 8, 233, 8, 25, 8, 153, 8, 89, 8, 217, 8, 57, 8, 185, 8, 121, 8, 249, 8, 5, 8, 133, 8, 69, 8, 197, 8, 37, 8, 165, 8, 101, 8, 229, 8, 21, 8, 149, 8, 85, 8, 213, 8, 53, 8, 181, 8, 117, 8, 245, 8, 13, 8, 141, 8, 77, 8, 205, 8, 45, 8, 173, 8, 109, 8, 237, 8, 29, 8, 157, 8, 93, 8, 221, 8, 61, 8, 189, 8, 125, 8, 253, 8, 19, 9, 275, 9, 147, 9, 403, 9, 83, 9, 339, 9, 211, 9, 467, 9, 51, 9, 307, 9, 179, 9, 435, 9, 115, 9, 371, 9, 243, 9, 499, 9, 11, 9, 267, 9, 139, 9, 395, 9, 75, 9, 331, 9, 203, 9, 459, 9, 43, 9, 299, 9, 171, 9, 427, 9, 107, 9, 363, 9, 235, 9, 491, 9, 27, 9, 283, 9, 155, 9, 411, 9, 91, 9, 347, 9, 219, 9, 475, 9, 59, 9, 315, 9, 187, 9, 443, 9, 123, 9, 379, 9, 251, 9, 507, 9, 7, 9, 263, 9, 135, 9, 391, 9, 71, 9, 327, 9, 199, 9, 455, 9, 39, 9, 295, 9, 167, 9, 423, 9, 103, 9, 359, 9, 231, 9, 487, 9, 23, 9, 279, 9, 151, 9, 407, 9, 87, 9, 343, 9, 215, 9, 471, 9, 55, 9, 311, 9, 183, 9, 439, 9, 119, 9, 375, 9, 247, 9, 503, 9, 15, 9, 271, 9, 143, 9, 399, 9, 79, 9, 335, 9, 207, 9, 463, 9, 47, 9, 303, 9, 175, 9, 431, 9, 111, 9, 367, 9, 239, 9, 495, 9, 31, 9, 287, 9, 159, 9, 415, 9, 95, 9, 351, 9, 223, 9, 479, 9, 63, 9, 319, 9, 191, 9, 447, 9, 127, 9, 383, 9, 255, 9, 511, 9, 0, 7, 64, 7, 32, 7, 96, 7, 16, 7, 80, 7, 48, 7, 112, 7, 8, 7, 72, 7, 40, 7, 104, 7, 24, 7, 88, 7, 56, 7, 120, 7, 4, 7, 68, 7, 36, 7, 100, 7, 20, 7, 84, 7, 52, 7, 116, 7, 3, 8, 131, 8, 67, 8, 195, 8, 35, 8, 163, 8, 99, 8, 227, 8 ];
    I.static_dtree = [ 0, 5, 16, 5, 8, 5, 24, 5, 4, 5, 20, 5, 12, 5, 28, 5, 2, 5, 18, 5, 10, 5, 26, 5, 6, 5, 22, 5, 14, 5, 30, 5, 1, 5, 17, 5, 9, 5, 25, 5, 5, 5, 21, 5, 13, 5, 29, 5, 3, 5, 19, 5, 11, 5, 27, 5, 7, 5, 23, 5 ];
    I.static_l_desc = new I(I.static_ltree, P.extra_lbits, a + 1, o, t);
    I.static_d_desc = new I(I.static_dtree, P.extra_dbits, 0, i, t);
    I.static_bl_desc = new I(null, P.extra_blbits, 0, n, c);
    var O = 9;
    var D = 8;
    function R(e, t, i, n, r) {
        var a = this;
        a.good_length = e;
        a.max_lazy = t;
        a.nice_length = i;
        a.max_chain = n;
        a.func = r;
    }
    var L = 0;
    var F = 1;
    var M = 2;
    var N = [ new R(0, 0, 0, 0, L), new R(4, 4, 8, 4, F), new R(4, 5, 16, 8, F), new R(4, 6, 32, 32, F), new R(4, 4, 16, 16, M), new R(8, 16, 32, 32, M), new R(8, 16, 128, 128, M), new R(8, 32, 128, 256, M), new R(32, 128, 258, 1024, M), new R(32, 258, 258, 4096, M) ];
    var B = [ "need dictionary", "stream end", "", "", "stream error", "data error", "", "buffer error", "", "" ];
    var j = 0;
    var U = 1;
    var z = 2;
    var q = 3;
    var W = 32;
    var H = 42;
    var G = 113;
    var V = 666;
    var $ = 8;
    var Y = 0;
    var X = 1;
    var J = 2;
    var K = 3;
    var Q = 258;
    var Z = Q + K + 1;
    function et(e, t, i, n) {
        var r = e[t * 2];
        var a = e[i * 2];
        return r < a || r == a && n[t] <= n[i];
    }
    function tt() {
        var e = this;
        var t;
        var r;
        var s;
        var c;
        var T;
        var R;
        var tt;
        var it;
        var nt;
        var rt;
        var at;
        var ot;
        var st;
        var lt;
        var ct;
        var ut;
        var ft;
        var dt;
        var ht;
        var pt;
        var gt;
        var mt;
        var vt;
        var yt;
        var bt;
        var wt;
        var Ct;
        var xt;
        var _t;
        var St;
        var kt;
        var At;
        var Et;
        var Tt;
        var Pt = new P();
        var It = new P();
        var Ot = new P();
        e.depth = [];
        var Dt;
        var Rt;
        var Lt;
        var Ft;
        var Mt;
        var Nt;
        var Bt;
        var jt;
        e.bl_count = [];
        e.heap = [];
        At = [];
        Et = [];
        Tt = [];
        function Ut() {
            var e;
            rt = 2 * R;
            ot[lt - 1] = 0;
            for (e = 0; e < lt - 1; e++) {
                ot[e] = 0;
            }
            Ct = N[xt].max_lazy;
            St = N[xt].good_length;
            kt = N[xt].nice_length;
            wt = N[xt].max_chain;
            mt = 0;
            dt = 0;
            yt = 0;
            ht = bt = K - 1;
            gt = 0;
            st = 0;
        }
        function zt() {
            var t;
            for (t = 0; t < o; t++) At[t * 2] = 0;
            for (t = 0; t < i; t++) Et[t * 2] = 0;
            for (t = 0; t < n; t++) Tt[t * 2] = 0;
            At[l * 2] = 1;
            e.opt_len = e.static_len = 0;
            Lt = Mt = 0;
        }
        function qt() {
            Pt.dyn_tree = At;
            Pt.stat_desc = I.static_l_desc;
            It.dyn_tree = Et;
            It.stat_desc = I.static_d_desc;
            Ot.dyn_tree = Tt;
            Ot.stat_desc = I.static_bl_desc;
            Bt = 0;
            jt = 0;
            Nt = 8;
            zt();
        }
        e.pqdownheap = function(t, i) {
            var n = e.heap;
            var r = n[i];
            var a = i << 1;
            while (a <= e.heap_len) {
                if (a < e.heap_len && et(t, n[a + 1], n[a], e.depth)) {
                    a++;
                }
                if (et(t, r, n[a], e.depth)) break;
                n[i] = n[a];
                i = a;
                a <<= 1;
            }
            n[i] = r;
        };
        function Wt(e, t) {
            var i;
            var n = -1;
            var r;
            var a = e[0 * 2 + 1];
            var o = 0;
            var s = 7;
            var l = 4;
            if (a === 0) {
                s = 138;
                l = 3;
            }
            e[(t + 1) * 2 + 1] = 65535;
            for (i = 0; i <= t; i++) {
                r = a;
                a = e[(i + 1) * 2 + 1];
                if (++o < s && r == a) {
                    continue;
                } else if (o < l) {
                    Tt[r * 2] += o;
                } else if (r !== 0) {
                    if (r != n) Tt[r * 2]++;
                    Tt[u * 2]++;
                } else if (o <= 10) {
                    Tt[f * 2]++;
                } else {
                    Tt[d * 2]++;
                }
                o = 0;
                n = r;
                if (a === 0) {
                    s = 138;
                    l = 3;
                } else if (r == a) {
                    s = 6;
                    l = 3;
                } else {
                    s = 7;
                    l = 4;
                }
            }
        }
        function Ht() {
            var t;
            Wt(At, Pt.max_code);
            Wt(Et, It.max_code);
            Ot.build_tree(e);
            for (t = n - 1; t >= 3; t--) {
                if (Tt[P.bl_order[t] * 2 + 1] !== 0) break;
            }
            e.opt_len += 3 * (t + 1) + 5 + 5 + 4;
            return t;
        }
        function Gt(t) {
            e.pending_buf[e.pending++] = t;
        }
        function Vt(e) {
            Gt(e & 255);
            Gt(e >>> 8 & 255);
        }
        function $t(e) {
            Gt(e >> 8 & 255);
            Gt(e & 255 & 255);
        }
        function Yt(e, t) {
            var i, n = t;
            if (jt > h - n) {
                i = e;
                Bt |= i << jt & 65535;
                Vt(Bt);
                Bt = i >>> h - jt;
                jt += n - h;
            } else {
                Bt |= e << jt & 65535;
                jt += n;
            }
        }
        function Xt(e, t) {
            var i = e * 2;
            Yt(t[i] & 65535, t[i + 1] & 65535);
        }
        function Jt(e, t) {
            var i;
            var n = -1;
            var r;
            var a = e[0 * 2 + 1];
            var o = 0;
            var s = 7;
            var l = 4;
            if (a === 0) {
                s = 138;
                l = 3;
            }
            for (i = 0; i <= t; i++) {
                r = a;
                a = e[(i + 1) * 2 + 1];
                if (++o < s && r == a) {
                    continue;
                } else if (o < l) {
                    do {
                        Xt(r, Tt);
                    } while (--o !== 0);
                } else if (r !== 0) {
                    if (r != n) {
                        Xt(r, Tt);
                        o--;
                    }
                    Xt(u, Tt);
                    Yt(o - 3, 2);
                } else if (o <= 10) {
                    Xt(f, Tt);
                    Yt(o - 3, 3);
                } else {
                    Xt(d, Tt);
                    Yt(o - 11, 7);
                }
                o = 0;
                n = r;
                if (a === 0) {
                    s = 138;
                    l = 3;
                } else if (r == a) {
                    s = 6;
                    l = 3;
                } else {
                    s = 7;
                    l = 4;
                }
            }
        }
        function Kt(e, t, i) {
            var n;
            Yt(e - 257, 5);
            Yt(t - 1, 5);
            Yt(i - 4, 4);
            for (n = 0; n < i; n++) {
                Yt(Tt[P.bl_order[n] * 2 + 1], 3);
            }
            Jt(At, e - 1);
            Jt(Et, t - 1);
        }
        function Qt() {
            if (jt == 16) {
                Vt(Bt);
                Bt = 0;
                jt = 0;
            } else if (jt >= 8) {
                Gt(Bt & 255);
                Bt >>>= 8;
                jt -= 8;
            }
        }
        function Zt() {
            Yt(X << 1, 3);
            Xt(l, I.static_ltree);
            Qt();
            if (1 + Nt + 10 - jt < 9) {
                Yt(X << 1, 3);
                Xt(l, I.static_ltree);
                Qt();
            }
            Nt = 7;
        }
        function ei(t, n) {
            var r, o, s;
            e.pending_buf[Ft + Lt * 2] = t >>> 8 & 255;
            e.pending_buf[Ft + Lt * 2 + 1] = t & 255;
            e.pending_buf[Dt + Lt] = n & 255;
            Lt++;
            if (t === 0) {
                At[n * 2]++;
            } else {
                Mt++;
                t--;
                At[(P._length_code[n] + a + 1) * 2]++;
                Et[P.d_code(t) * 2]++;
            }
            if ((Lt & 8191) === 0 && xt > 2) {
                r = Lt * 8;
                o = mt - dt;
                for (s = 0; s < i; s++) {
                    r += Et[s * 2] * (5 + P.extra_dbits[s]);
                }
                r >>>= 3;
                if (Mt < Math.floor(Lt / 2) && r < Math.floor(o / 2)) return true;
            }
            return Lt == Rt - 1;
        }
        function ti(t, i) {
            var n;
            var r;
            var o = 0;
            var s;
            var c;
            if (Lt !== 0) {
                do {
                    n = e.pending_buf[Ft + o * 2] << 8 & 65280 | e.pending_buf[Ft + o * 2 + 1] & 255;
                    r = e.pending_buf[Dt + o] & 255;
                    o++;
                    if (n === 0) {
                        Xt(r, t);
                    } else {
                        s = P._length_code[r];
                        Xt(s + a + 1, t);
                        c = P.extra_lbits[s];
                        if (c !== 0) {
                            r -= P.base_length[s];
                            Yt(r, c);
                        }
                        n--;
                        s = P.d_code(n);
                        Xt(s, i);
                        c = P.extra_dbits[s];
                        if (c !== 0) {
                            n -= P.base_dist[s];
                            Yt(n, c);
                        }
                    }
                } while (o < Lt);
            }
            Xt(l, t);
            Nt = t[l * 2 + 1];
        }
        function ii() {
            if (jt > 8) {
                Vt(Bt);
            } else if (jt > 0) {
                Gt(Bt & 255);
            }
            Bt = 0;
            jt = 0;
        }
        function ni(t, i, n) {
            ii();
            Nt = 8;
            if (n) {
                Vt(i);
                Vt(~i);
            }
            e.pending_buf.set(nt.subarray(t, t + i), e.pending);
            e.pending += i;
        }
        function ri(e, t, i) {
            Yt((Y << 1) + (i ? 1 : 0), 3);
            ni(e, t, true);
        }
        function ai(t, i, n) {
            var r, a;
            var o = 0;
            if (xt > 0) {
                Pt.build_tree(e);
                It.build_tree(e);
                o = Ht();
                r = e.opt_len + 3 + 7 >>> 3;
                a = e.static_len + 3 + 7 >>> 3;
                if (a <= r) r = a;
            } else {
                r = a = i + 5;
            }
            if (i + 4 <= r && t != -1) {
                ri(t, i, n);
            } else if (a == r) {
                Yt((X << 1) + (n ? 1 : 0), 3);
                ti(I.static_ltree, I.static_dtree);
            } else {
                Yt((J << 1) + (n ? 1 : 0), 3);
                Kt(Pt.max_code + 1, It.max_code + 1, o + 1);
                ti(At, Et);
            }
            zt();
            if (n) {
                ii();
            }
        }
        function oi(e) {
            ai(dt >= 0 ? dt : -1, mt - dt, e);
            dt = mt;
            t.flush_pending();
        }
        function si() {
            var e, i;
            var n;
            var r;
            do {
                r = rt - yt - mt;
                if (r === 0 && mt === 0 && yt === 0) {
                    r = R;
                } else if (r == -1) {
                    r--;
                } else if (mt >= R + R - Z) {
                    nt.set(nt.subarray(R, R + R), 0);
                    vt -= R;
                    mt -= R;
                    dt -= R;
                    e = lt;
                    n = e;
                    do {
                        i = ot[--n] & 65535;
                        ot[n] = i >= R ? i - R : 0;
                    } while (--e !== 0);
                    e = R;
                    n = e;
                    do {
                        i = at[--n] & 65535;
                        at[n] = i >= R ? i - R : 0;
                    } while (--e !== 0);
                    r += R;
                }
                if (t.avail_in === 0) return;
                e = t.read_buf(nt, mt + yt, r);
                yt += e;
                if (yt >= K) {
                    st = nt[mt] & 255;
                    st = (st << ft ^ nt[mt + 1] & 255) & ut;
                }
            } while (yt < Z && t.avail_in !== 0);
        }
        function li(e) {
            var i = 65535;
            var n;
            if (i > s - 5) {
                i = s - 5;
            }
            while (true) {
                if (yt <= 1) {
                    si();
                    if (yt === 0 && e == y) return j;
                    if (yt === 0) break;
                }
                mt += yt;
                yt = 0;
                n = dt + i;
                if (mt === 0 || mt >= n) {
                    yt = mt - n;
                    mt = n;
                    oi(false);
                    if (t.avail_out === 0) return j;
                }
                if (mt - dt >= R - Z) {
                    oi(false);
                    if (t.avail_out === 0) return j;
                }
            }
            oi(e == C);
            if (t.avail_out === 0) return e == C ? z : j;
            return e == C ? q : U;
        }
        function ci(e) {
            var t = wt;
            var i = mt;
            var n;
            var r;
            var a = bt;
            var o = mt > R - Z ? mt - (R - Z) : 0;
            var s = kt;
            var l = it;
            var c = mt + Q;
            var u = nt[i + a - 1];
            var f = nt[i + a];
            if (bt >= St) {
                t >>= 2;
            }
            if (s > yt) s = yt;
            do {
                n = e;
                if (nt[n + a] != f || nt[n + a - 1] != u || nt[n] != nt[i] || nt[++n] != nt[i + 1]) continue;
                i += 2;
                n++;
                do {} while (nt[++i] == nt[++n] && nt[++i] == nt[++n] && nt[++i] == nt[++n] && nt[++i] == nt[++n] && nt[++i] == nt[++n] && nt[++i] == nt[++n] && nt[++i] == nt[++n] && nt[++i] == nt[++n] && i < c);
                r = Q - (c - i);
                i = c - Q;
                if (r > a) {
                    vt = e;
                    a = r;
                    if (r >= s) break;
                    u = nt[i + a - 1];
                    f = nt[i + a];
                }
            } while ((e = at[e & l] & 65535) > o && --t !== 0);
            if (a <= yt) return a;
            return yt;
        }
        function ui(e) {
            var i = 0;
            var n;
            while (true) {
                if (yt < Z) {
                    si();
                    if (yt < Z && e == y) {
                        return j;
                    }
                    if (yt === 0) break;
                }
                if (yt >= K) {
                    st = (st << ft ^ nt[mt + (K - 1)] & 255) & ut;
                    i = ot[st] & 65535;
                    at[mt & it] = ot[st];
                    ot[st] = mt;
                }
                if (i !== 0 && (mt - i & 65535) <= R - Z) {
                    if (_t != m) {
                        ht = ci(i);
                    }
                }
                if (ht >= K) {
                    n = ei(mt - vt, ht - K);
                    yt -= ht;
                    if (ht <= Ct && yt >= K) {
                        ht--;
                        do {
                            mt++;
                            st = (st << ft ^ nt[mt + (K - 1)] & 255) & ut;
                            i = ot[st] & 65535;
                            at[mt & it] = ot[st];
                            ot[st] = mt;
                        } while (--ht !== 0);
                        mt++;
                    } else {
                        mt += ht;
                        ht = 0;
                        st = nt[mt] & 255;
                        st = (st << ft ^ nt[mt + 1] & 255) & ut;
                    }
                } else {
                    n = ei(0, nt[mt] & 255);
                    yt--;
                    mt++;
                }
                if (n) {
                    oi(false);
                    if (t.avail_out === 0) return j;
                }
            }
            oi(e == C);
            if (t.avail_out === 0) {
                if (e == C) return z; else return j;
            }
            return e == C ? q : U;
        }
        function fi(e) {
            var i = 0;
            var n;
            var r;
            while (true) {
                if (yt < Z) {
                    si();
                    if (yt < Z && e == y) {
                        return j;
                    }
                    if (yt === 0) break;
                }
                if (yt >= K) {
                    st = (st << ft ^ nt[mt + (K - 1)] & 255) & ut;
                    i = ot[st] & 65535;
                    at[mt & it] = ot[st];
                    ot[st] = mt;
                }
                bt = ht;
                pt = vt;
                ht = K - 1;
                if (i !== 0 && bt < Ct && (mt - i & 65535) <= R - Z) {
                    if (_t != m) {
                        ht = ci(i);
                    }
                    if (ht <= 5 && (_t == g || ht == K && mt - vt > 4096)) {
                        ht = K - 1;
                    }
                }
                if (bt >= K && ht <= bt) {
                    r = mt + yt - K;
                    n = ei(mt - 1 - pt, bt - K);
                    yt -= bt - 1;
                    bt -= 2;
                    do {
                        if (++mt <= r) {
                            st = (st << ft ^ nt[mt + (K - 1)] & 255) & ut;
                            i = ot[st] & 65535;
                            at[mt & it] = ot[st];
                            ot[st] = mt;
                        }
                    } while (--bt !== 0);
                    gt = 0;
                    ht = K - 1;
                    mt++;
                    if (n) {
                        oi(false);
                        if (t.avail_out === 0) return j;
                    }
                } else if (gt !== 0) {
                    n = ei(0, nt[mt - 1] & 255);
                    if (n) {
                        oi(false);
                    }
                    mt++;
                    yt--;
                    if (t.avail_out === 0) return j;
                } else {
                    gt = 1;
                    mt++;
                    yt--;
                }
            }
            if (gt !== 0) {
                n = ei(0, nt[mt - 1] & 255);
                gt = 0;
            }
            oi(e == C);
            if (t.avail_out === 0) {
                if (e == C) return z; else return j;
            }
            return e == C ? q : U;
        }
        function di(t) {
            t.total_in = t.total_out = 0;
            t.msg = null;
            e.pending = 0;
            e.pending_out = 0;
            r = G;
            T = y;
            qt();
            Ut();
            return x;
        }
        e.deflateInit = function(t, i, n, r, a, o) {
            if (!r) r = $;
            if (!a) a = D;
            if (!o) o = v;
            t.msg = null;
            if (i == p) i = 6;
            if (a < 1 || a > O || r != $ || n < 9 || n > 15 || i < 0 || i > 9 || o < 0 || o > m) {
                return k;
            }
            t.dstate = e;
            tt = n;
            R = 1 << tt;
            it = R - 1;
            ct = a + 7;
            lt = 1 << ct;
            ut = lt - 1;
            ft = Math.floor((ct + K - 1) / K);
            nt = new Uint8Array(R * 2);
            at = [];
            ot = [];
            Rt = 1 << a + 6;
            e.pending_buf = new Uint8Array(Rt * 4);
            s = Rt * 4;
            Ft = Math.floor(Rt / 2);
            Dt = (1 + 2) * Rt;
            xt = i;
            _t = o;
            c = r & 255;
            return di(t);
        };
        e.deflateEnd = function() {
            if (r != H && r != G && r != V) {
                return k;
            }
            e.pending_buf = null;
            ot = null;
            at = null;
            nt = null;
            e.dstate = null;
            return r == G ? A : x;
        };
        e.deflateParams = function(e, t, i) {
            var n = x;
            if (t == p) {
                t = 6;
            }
            if (t < 0 || t > 9 || i < 0 || i > m) {
                return k;
            }
            if (N[xt].func != N[t].func && e.total_in !== 0) {
                n = e.deflate(b);
            }
            if (xt != t) {
                xt = t;
                Ct = N[xt].max_lazy;
                St = N[xt].good_length;
                kt = N[xt].nice_length;
                wt = N[xt].max_chain;
            }
            _t = i;
            return n;
        };
        e.deflateSetDictionary = function(e, t, i) {
            var n = i;
            var a, o = 0;
            if (!t || r != H) return k;
            if (n < K) return x;
            if (n > R - Z) {
                n = R - Z;
                o = i - n;
            }
            nt.set(t.subarray(o, o + n), 0);
            mt = n;
            dt = n;
            st = nt[0] & 255;
            st = (st << ft ^ nt[1] & 255) & ut;
            for (a = 0; a <= n - K; a++) {
                st = (st << ft ^ nt[a + (K - 1)] & 255) & ut;
                at[a & it] = ot[st];
                ot[st] = a;
            }
            return x;
        };
        e.deflate = function(i, n) {
            var a, o, s, l, c;
            if (n > C || n < 0) {
                return k;
            }
            if (!i.next_out || !i.next_in && i.avail_in !== 0 || r == V && n != C) {
                i.msg = B[S - k];
                return k;
            }
            if (i.avail_out === 0) {
                i.msg = B[S - E];
                return E;
            }
            t = i;
            l = T;
            T = n;
            if (r == H) {
                o = $ + (tt - 8 << 4) << 8;
                s = (xt - 1 & 255) >> 1;
                if (s > 3) s = 3;
                o |= s << 6;
                if (mt !== 0) o |= W;
                o += 31 - o % 31;
                r = G;
                $t(o);
            }
            if (e.pending !== 0) {
                t.flush_pending();
                if (t.avail_out === 0) {
                    T = -1;
                    return x;
                }
            } else if (t.avail_in === 0 && n <= l && n != C) {
                t.msg = B[S - E];
                return E;
            }
            if (r == V && t.avail_in !== 0) {
                i.msg = B[S - E];
                return E;
            }
            if (t.avail_in !== 0 || yt !== 0 || n != y && r != V) {
                c = -1;
                switch (N[xt].func) {
                  case L:
                    c = li(n);
                    break;

                  case F:
                    c = ui(n);
                    break;

                  case M:
                    c = fi(n);
                    break;

                  default:                }
                if (c == z || c == q) {
                    r = V;
                }
                if (c == j || c == z) {
                    if (t.avail_out === 0) {
                        T = -1;
                    }
                    return x;
                }
                if (c == U) {
                    if (n == b) {
                        Zt();
                    } else {
                        ri(0, 0, false);
                        if (n == w) {
                            for (a = 0; a < lt; a++) ot[a] = 0;
                        }
                    }
                    t.flush_pending();
                    if (t.avail_out === 0) {
                        T = -1;
                        return x;
                    }
                }
            }
            if (n != C) return x;
            return _;
        };
    }
    function it() {
        var e = this;
        e.next_in_index = 0;
        e.next_out_index = 0;
        e.avail_in = 0;
        e.total_in = 0;
        e.avail_out = 0;
        e.total_out = 0;
    }
    it.prototype = {
        deflateInit: function(e, i) {
            var n = this;
            n.dstate = new tt();
            if (!i) i = t;
            return n.dstate.deflateInit(n, e, i);
        },
        deflate: function(e) {
            var t = this;
            if (!t.dstate) {
                return k;
            }
            return t.dstate.deflate(t, e);
        },
        deflateEnd: function() {
            var e = this;
            if (!e.dstate) return k;
            var t = e.dstate.deflateEnd();
            e.dstate = null;
            return t;
        },
        deflateParams: function(e, t) {
            var i = this;
            if (!i.dstate) return k;
            return i.dstate.deflateParams(i, e, t);
        },
        deflateSetDictionary: function(e, t) {
            var i = this;
            if (!i.dstate) return k;
            return i.dstate.deflateSetDictionary(i, e, t);
        },
        read_buf: function(e, t, i) {
            var n = this;
            var r = n.avail_in;
            if (r > i) r = i;
            if (r === 0) return 0;
            n.avail_in -= r;
            e.set(n.next_in.subarray(n.next_in_index, n.next_in_index + r), t);
            n.next_in_index += r;
            n.total_in += r;
            return r;
        },
        flush_pending: function() {
            var e = this;
            var t = e.dstate.pending;
            if (t > e.avail_out) t = e.avail_out;
            if (t === 0) return;
            e.next_out.set(e.dstate.pending_buf.subarray(e.dstate.pending_out, e.dstate.pending_out + t), e.next_out_index);
            e.next_out_index += t;
            e.dstate.pending_out += t;
            e.total_out += t;
            e.avail_out -= t;
            e.dstate.pending -= t;
            if (e.dstate.pending === 0) {
                e.dstate.pending_out = 0;
            }
        }
    };
    return function nt(e) {
        var t = this;
        var i = new it();
        var n = 512;
        var r = y;
        var a = new Uint8Array(n);
        if (typeof e == "undefined") e = p;
        i.deflateInit(e);
        i.next_out = a;
        t.append = function(e, t) {
            var o, s = [], l = 0, c = 0, u = 0, f;
            if (!e.length) return;
            i.next_in_index = 0;
            i.next_in = e;
            i.avail_in = e.length;
            do {
                i.next_out_index = 0;
                i.avail_out = n;
                o = i.deflate(r);
                if (o != x) throw "deflating: " + i.msg;
                if (i.next_out_index) if (i.next_out_index == n) s.push(new Uint8Array(a)); else s.push(new Uint8Array(a.subarray(0, i.next_out_index)));
                u += i.next_out_index;
                if (t && i.next_in_index > 0 && i.next_in_index != l) {
                    t(i.next_in_index);
                    l = i.next_in_index;
                }
            } while (i.avail_in > 0 || i.avail_out === 0);
            f = new Uint8Array(u);
            s.forEach(function(e) {
                f.set(e, c);
                c += e.length;
            });
            return f;
        };
        t.flush = function() {
            var e, t = [], r = 0, o = 0, s;
            do {
                i.next_out_index = 0;
                i.avail_out = n;
                e = i.deflate(C);
                if (e != _ && e != x) throw "deflating: " + i.msg;
                if (n - i.avail_out > 0) t.push(new Uint8Array(a.subarray(0, i.next_out_index)));
                o += i.next_out_index;
            } while (i.avail_in > 0 || i.avail_out === 0);
            i.deflateEnd();
            s = new Uint8Array(o);
            t.forEach(function(e) {
                s.set(e, r);
                r += e.length;
            });
            return s;
        };
    };
}(this);

(function(e, t, i, n, r, a, o) {
    !function() {
        var i, n, a, o;
        !function() {
            var e = {}, t = {};
            i = function(t, i, n) {
                e[t] = {
                    deps: i,
                    callback: n
                };
            }, o = a = n = function(i) {
                function r(e) {
                    if ("." !== e.charAt(0)) return e;
                    for (var t = e.split("/"), n = i.split("/").slice(0, -1), r = 0, a = t.length; a > r; r++) {
                        var o = t[r];
                        if (".." === o) n.pop(); else {
                            if ("." === o) continue;
                            n.push(o);
                        }
                    }
                    return n.join("/");
                }
                if (o._eak_seen = e, t[i]) return t[i];
                if (t[i] = {}, !e[i]) throw new Error("Could not find module " + i);
                for (var a, s = e[i], l = s.deps, c = s.callback, u = [], f = 0, d = l.length; d > f; f++) "exports" === l[f] ? u.push(a = {}) : u.push(n(r(l[f])));
                var h = c.apply(this, u);
                return t[i] = a || h;
            };
        }(), i("promise/all", [ "./utils", "exports" ], function(e, t) {
            function i(e) {
                var t = this;
                if (!n(e)) throw new TypeError("You must pass an array to all.");
                return new t(function(t, i) {
                    function n(e) {
                        return function(t) {
                            a(e, t);
                        };
                    }
                    function a(e, i) {
                        s[e] = i, 0 === --l && t(s);
                    }
                    var o, s = [], l = e.length;
                    0 === l && t([]);
                    for (var c = 0; c < e.length; c++) o = e[c], o && r(o.then) ? o.then(n(c), i) : a(c, o);
                });
            }
            var n = e.isArray, r = e.isFunction;
            t.all = i;
        }), i("promise/asap", [ "exports" ], function(i) {
            function n() {
                return function() {
                    process.nextTick(s);
                };
            }
            function a() {
                var e = 0, i = new f(s), n = t.createTextNode("");
                return i.observe(n, {
                    characterData: !0
                }), function() {
                    n.data = e = ++e % 2;
                };
            }
            function o() {
                return function() {
                    d.setTimeout(s, 1);
                };
            }
            function s() {
                for (var e = 0; e < h.length; e++) {
                    var t = h[e], i = t[0], n = t[1];
                    i(n);
                }
                h = [];
            }
            function l(e, t) {
                var i = h.push([ e, t ]);
                1 === i && c();
            }
            var c, u = "undefined" != typeof e ? e : {}, f = u.MutationObserver || u.WebKitMutationObserver, d = "undefined" != typeof r ? r : this, h = [];
            c = "undefined" != typeof process && "[object process]" === {}.toString.call(process) ? n() : f ? a() : o(), 
            i.asap = l;
        }), i("promise/cast", [ "exports" ], function(e) {
            function t(e) {
                if (e && "object" == typeof e && e.constructor === this) return e;
                var t = this;
                return new t(function(t) {
                    t(e);
                });
            }
            e.cast = t;
        }), i("promise/config", [ "exports" ], function(e) {
            function t(e, t) {
                return 2 !== arguments.length ? i[e] : (i[e] = t, void 0);
            }
            var i = {
                instrument: !1
            };
            e.config = i, e.configure = t;
        }), i("promise/polyfill", [ "./promise", "./utils", "exports" ], function(t, i, n) {
            function r() {
                var t = "Promise" in e && "cast" in e.Promise && "resolve" in e.Promise && "reject" in e.Promise && "all" in e.Promise && "race" in e.Promise && function() {
                    var t;
                    return new e.Promise(function(e) {
                        t = e;
                    }), o(t);
                }();
                t || (e.Promise = a);
            }
            var a = t.Promise, o = i.isFunction;
            n.polyfill = r;
        }), i("promise/promise", [ "./config", "./utils", "./cast", "./all", "./race", "./resolve", "./reject", "./asap", "exports" ], function(e, t, i, n, r, a, o, s, l) {
            function c(e) {
                if (!x(e)) throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");
                if (!(this instanceof c)) throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");
                this._subscribers = [], u(e, this);
            }
            function u(e, t) {
                function i(e) {
                    g(t, e);
                }
                function n(e) {
                    v(t, e);
                }
                try {
                    e(i, n);
                } catch (r) {
                    n(r);
                }
            }
            function f(e, t, i, n) {
                var r, a, o, s, l = x(i);
                if (l) try {
                    r = i(n), o = !0;
                } catch (c) {
                    s = !0, a = c;
                } else r = n, o = !0;
                p(t, r) || (l && o ? g(t, r) : s ? v(t, a) : e === O ? g(t, r) : e === D && v(t, r));
            }
            function d(e, t, i, n) {
                var r = e._subscribers, a = r.length;
                r[a] = t, r[a + O] = i, r[a + D] = n;
            }
            function h(e, t) {
                for (var i, n, r = e._subscribers, a = e._detail, o = 0; o < r.length; o += 3) i = r[o], 
                n = r[o + t], f(t, i, n, a);
                e._subscribers = null;
            }
            function p(e, t) {
                var i, n = null;
                try {
                    if (e === t) throw new TypeError("A promises callback cannot return that same promise.");
                    if (C(t) && (n = t.then, x(n))) return n.call(t, function(n) {
                        return i ? !0 : (i = !0, t !== n ? g(e, n) : m(e, n), void 0);
                    }, function(t) {
                        return i ? !0 : (i = !0, v(e, t), void 0);
                    }), !0;
                } catch (r) {
                    return i ? !0 : (v(e, r), !0);
                }
                return !1;
            }
            function g(e, t) {
                e === t ? m(e, t) : p(e, t) || m(e, t);
            }
            function m(e, t) {
                e._state === P && (e._state = I, e._detail = t, w.async(y, e));
            }
            function v(e, t) {
                e._state === P && (e._state = I, e._detail = t, w.async(b, e));
            }
            function y(e) {
                h(e, e._state = O);
            }
            function b(e) {
                h(e, e._state = D);
            }
            var w = e.config, C = (e.configure, t.objectOrFunction), x = t.isFunction, _ = (t.now, 
            i.cast), S = n.all, k = r.race, A = a.resolve, E = o.reject, T = s.asap;
            w.async = T;
            var P = void 0, I = 0, O = 1, D = 2;
            c.prototype = {
                constructor: c,
                _state: void 0,
                _detail: void 0,
                _subscribers: void 0,
                then: function(e, t) {
                    var i = this, n = new this.constructor(function() {});
                    if (this._state) {
                        var r = arguments;
                        w.async(function() {
                            f(i._state, n, r[i._state - 1], i._detail);
                        });
                    } else d(this, n, e, t);
                    return n;
                },
                "catch": function(e) {
                    return this.then(null, e);
                }
            }, c.all = S, c.cast = _, c.race = k, c.resolve = A, c.reject = E, l.Promise = c;
        }), i("promise/race", [ "./utils", "exports" ], function(e, t) {
            function i(e) {
                var t = this;
                if (!n(e)) throw new TypeError("You must pass an array to race.");
                return new t(function(t, i) {
                    for (var n, r = 0; r < e.length; r++) n = e[r], n && "function" == typeof n.then ? n.then(t, i) : t(n);
                });
            }
            var n = e.isArray;
            t.race = i;
        }), i("promise/reject", [ "exports" ], function(e) {
            function t(e) {
                var t = this;
                return new t(function(t, i) {
                    i(e);
                });
            }
            e.reject = t;
        }), i("promise/resolve", [ "exports" ], function(e) {
            function t(e) {
                var t = this;
                return new t(function(t) {
                    t(e);
                });
            }
            e.resolve = t;
        }), i("promise/utils", [ "exports" ], function(e) {
            function t(e) {
                return i(e) || "object" == typeof e && null !== e;
            }
            function i(e) {
                return "function" == typeof e;
            }
            function n(e) {
                return "[object Array]" === Object.prototype.toString.call(e);
            }
            var r = Date.now || function() {
                return new Date().getTime();
            };
            e.objectOrFunction = t, e.isFunction = i, e.isArray = n, e.now = r;
        }), n("promise/polyfill").polyfill();
    }();
    if (typeof Object.create !== "function" || typeof t.createElement("canvas").getContext !== "function") {
        e.html2canvas = function() {
            return Promise.reject("No canvas support");
        };
        return;
    }
    (function(e) {
        var t = typeof n == "object" && n && !n.nodeType && n;
        var o = typeof i == "object" && i && !i.nodeType && i;
        var s = typeof r == "object" && r;
        if (s.global === s || s.window === s || s.self === s) {
            e = s;
        }
        var l, c = 2147483647, u = 36, f = 1, d = 26, h = 38, p = 700, g = 72, m = 128, v = "-", y = /^xn--/, b = /[^\x20-\x7E]/, w = /[\x2E\u3002\uFF0E\uFF61]/g, C = {
            overflow: "Overflow: input needs wider integers to process",
            "not-basic": "Illegal input >= 0x80 (not a basic code point)",
            "invalid-input": "Invalid input"
        }, x = u - f, _ = Math.floor, S = String.fromCharCode, k;
        function A(e) {
            throw RangeError(C[e]);
        }
        function E(e, t) {
            var i = e.length;
            var n = [];
            while (i--) {
                n[i] = t(e[i]);
            }
            return n;
        }
        function T(e, t) {
            var i = e.split("@");
            var n = "";
            if (i.length > 1) {
                n = i[0] + "@";
                e = i[1];
            }
            var r = e.split(w);
            var a = E(r, t).join(".");
            return n + a;
        }
        function P(e) {
            var t = [], i = 0, n = e.length, r, a;
            while (i < n) {
                r = e.charCodeAt(i++);
                if (r >= 55296 && r <= 56319 && i < n) {
                    a = e.charCodeAt(i++);
                    if ((a & 64512) == 56320) {
                        t.push(((r & 1023) << 10) + (a & 1023) + 65536);
                    } else {
                        t.push(r);
                        i--;
                    }
                } else {
                    t.push(r);
                }
            }
            return t;
        }
        function I(e) {
            return E(e, function(e) {
                var t = "";
                if (e > 65535) {
                    e -= 65536;
                    t += S(e >>> 10 & 1023 | 55296);
                    e = 56320 | e & 1023;
                }
                t += S(e);
                return t;
            }).join("");
        }
        function O(e) {
            if (e - 48 < 10) {
                return e - 22;
            }
            if (e - 65 < 26) {
                return e - 65;
            }
            if (e - 97 < 26) {
                return e - 97;
            }
            return u;
        }
        function D(e, t) {
            return e + 22 + 75 * (e < 26) - ((t != 0) << 5);
        }
        function R(e, t, i) {
            var n = 0;
            e = i ? _(e / p) : e >> 1;
            e += _(e / t);
            for (;e > x * d >> 1; n += u) {
                e = _(e / x);
            }
            return _(n + (x + 1) * e / (e + h));
        }
        function L(e) {
            var t = [], i = e.length, n, r = 0, a = m, o = g, s, l, h, p, y, b, w, C, x;
            s = e.lastIndexOf(v);
            if (s < 0) {
                s = 0;
            }
            for (l = 0; l < s; ++l) {
                if (e.charCodeAt(l) >= 128) {
                    A("not-basic");
                }
                t.push(e.charCodeAt(l));
            }
            for (h = s > 0 ? s + 1 : 0; h < i; ) {
                for (p = r, y = 1, b = u; ;b += u) {
                    if (h >= i) {
                        A("invalid-input");
                    }
                    w = O(e.charCodeAt(h++));
                    if (w >= u || w > _((c - r) / y)) {
                        A("overflow");
                    }
                    r += w * y;
                    C = b <= o ? f : b >= o + d ? d : b - o;
                    if (w < C) {
                        break;
                    }
                    x = u - C;
                    if (y > _(c / x)) {
                        A("overflow");
                    }
                    y *= x;
                }
                n = t.length + 1;
                o = R(r - p, n, p == 0);
                if (_(r / n) > c - a) {
                    A("overflow");
                }
                a += _(r / n);
                r %= n;
                t.splice(r++, 0, a);
            }
            return I(t);
        }
        function F(e) {
            var t, i, n, r, a, o, s, l, h, p, y, b = [], w, C, x, k;
            e = P(e);
            w = e.length;
            t = m;
            i = 0;
            a = g;
            for (o = 0; o < w; ++o) {
                y = e[o];
                if (y < 128) {
                    b.push(S(y));
                }
            }
            n = r = b.length;
            if (r) {
                b.push(v);
            }
            while (n < w) {
                for (s = c, o = 0; o < w; ++o) {
                    y = e[o];
                    if (y >= t && y < s) {
                        s = y;
                    }
                }
                C = n + 1;
                if (s - t > _((c - i) / C)) {
                    A("overflow");
                }
                i += (s - t) * C;
                t = s;
                for (o = 0; o < w; ++o) {
                    y = e[o];
                    if (y < t && ++i > c) {
                        A("overflow");
                    }
                    if (y == t) {
                        for (l = i, h = u; ;h += u) {
                            p = h <= a ? f : h >= a + d ? d : h - a;
                            if (l < p) {
                                break;
                            }
                            k = l - p;
                            x = u - p;
                            b.push(S(D(p + k % x, 0)));
                            l = _(k / x);
                        }
                        b.push(S(D(l, 0)));
                        a = R(i, C, n == r);
                        i = 0;
                        ++n;
                    }
                }
                ++i;
                ++t;
            }
            return b.join("");
        }
        function M(e) {
            return T(e, function(e) {
                return y.test(e) ? L(e.slice(4).toLowerCase()) : e;
            });
        }
        function N(e) {
            return T(e, function(e) {
                return b.test(e) ? "xn--" + F(e) : e;
            });
        }
        l = {
            version: "1.3.1",
            ucs2: {
                decode: P,
                encode: I
            },
            decode: L,
            encode: F,
            toASCII: N,
            toUnicode: M
        };
        if (typeof a == "function" && typeof a.amd == "object" && a.amd) {
            a("punycode", function() {
                return l;
            });
        } else if (t && o) {
            if (i.exports == t) {
                o.exports = l;
            } else {
                for (k in l) {
                    l.hasOwnProperty(k) && (t[k] = l[k]);
                }
            }
        } else {
            e.punycode = l;
        }
    })(this);
    var s = "data-html2canvas-node";
    var l = "data-html2canvas-canvas-clone";
    var c = 0;
    e.html2canvas = function(i, n) {
        n = n || {};
        if (n.logging) {
            e.html2canvas.logging = true;
            e.html2canvas.start = Date.now();
        }
        n.async = typeof n.async === "undefined" ? true : n.async;
        n.allowTaint = typeof n.allowTaint === "undefined" ? false : n.allowTaint;
        n.removeContainer = typeof n.removeContainer === "undefined" ? true : n.removeContainer;
        n.javascriptEnabled = typeof n.javascriptEnabled === "undefined" ? false : n.javascriptEnabled;
        n.imageTimeout = typeof n.imageTimeout === "undefined" ? 1e4 : n.imageTimeout;
        if (typeof i === "string") {
            if (typeof n.proxy !== "string") {
                return Promise.reject("Proxy must be used when rendering url");
            }
            return b(k(i), n.proxy, t, e.innerWidth, e.innerHeight, n).then(function(t) {
                return f(t.contentWindow.document.documentElement, t, n, e.innerWidth, e.innerHeight);
            });
        }
        var r = (i === o ? [ t.documentElement ] : i.length ? i : [ i ])[0];
        r.setAttribute(s, "true");
        return u(r.ownerDocument, n, r.ownerDocument.defaultView.innerWidth, r.ownerDocument.defaultView.innerHeight).then(function(e) {
            if (typeof n.onrendered === "function") {
                L("options.onrendered is deprecated, html2canvas returns a Promise containing the canvas");
                n.onrendered(e);
            }
            return e;
        });
    };
    e.html2canvas.punycode = this.punycode;
    e.html2canvas.proxy = {};
    function u(e, t, i, n) {
        return v(e, e, i, n, t).then(function(r) {
            L("Document cloned");
            var a = "[" + s + "='true']";
            e.querySelector(a).removeAttribute(s);
            var o = r.contentWindow;
            var l = o.document.querySelector(a);
            var c = typeof t.onclone === "function" ? Promise.resolve(t.onclone(o.document)) : Promise.resolve(true);
            return c.then(function() {
                return f(l, r, t, i, n);
            });
        });
    }
    function f(e, i, n, r, a) {
        var o = i.contentWindow;
        var s = new Ut(o.document);
        var l = new D(n, s);
        var c = q(e);
        var u = n.type === "view" ? r : p(o.document);
        var f = n.type === "view" ? a : g(o.document);
        var m = new Yt(u, f, l, n, t);
        var v = new H(e, m, s, l, n);
        return v.ready.then(function() {
            L("Finished rendering");
            var t;
            if (n.type === "view") {
                t = h(m.canvas, {
                    width: m.canvas.width,
                    height: m.canvas.height,
                    top: 0,
                    left: 0,
                    x: 0,
                    y: 0
                });
            } else if (e === o.document.body || e === o.document.documentElement || n.canvas != null) {
                t = m.canvas;
            } else {
                t = h(m.canvas, {
                    width: n.width != null ? n.width : c.width,
                    height: n.height != null ? n.height : c.height,
                    top: c.top,
                    left: c.left,
                    x: o.pageXOffset,
                    y: o.pageYOffset
                });
            }
            d(i, n);
            return t;
        });
    }
    function d(e, t) {
        if (t.removeContainer) {
            e.parentNode.removeChild(e);
            L("Cleaned up container");
        }
    }
    function h(e, i) {
        var n = t.createElement("canvas");
        var r = Math.min(e.width - 1, Math.max(0, i.left));
        var a = Math.min(e.width, Math.max(1, i.left + i.width));
        var o = Math.min(e.height - 1, Math.max(0, i.top));
        var s = Math.min(e.height, Math.max(1, i.top + i.height));
        n.width = i.width;
        n.height = i.height;
        L("Cropping canvas at:", "left:", i.left, "top:", i.top, "width:", a - r, "height:", s - o);
        L("Resulting crop with width", i.width, "and height", i.height, " with x", r, "and y", o);
        n.getContext("2d").drawImage(e, r, o, a - r, s - o, i.x, i.y, a - r, s - o);
        return n;
    }
    function p(e) {
        return Math.max(Math.max(e.body.scrollWidth, e.documentElement.scrollWidth), Math.max(e.body.offsetWidth, e.documentElement.offsetWidth), Math.max(e.body.clientWidth, e.documentElement.clientWidth));
    }
    function g(e) {
        return Math.max(Math.max(e.body.scrollHeight, e.documentElement.scrollHeight), Math.max(e.body.offsetHeight, e.documentElement.offsetHeight), Math.max(e.body.clientHeight, e.documentElement.clientHeight));
    }
    function m() {
        return "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";
    }
    function v(e, t, i, n, r) {
        C(e);
        var a = e.documentElement.cloneNode(true), o = t.createElement("iframe");
        o.className = "html2canvas-container";
        o.style.visibility = "hidden";
        o.style.position = "fixed";
        o.style.left = "-10000px";
        o.style.top = "0px";
        o.style.border = "0";
        o.width = i;
        o.height = n;
        o.scrolling = "no";
        t.body.appendChild(o);
        return new Promise(function(t) {
            var i = o.contentWindow.document;
            o.contentWindow.onload = o.onload = function() {
                var a = setInterval(function() {
                    if (i.body.childNodes.length > 0) {
                        x(e, i);
                        clearInterval(a);
                        if (r.type === "view") {
                            o.contentWindow.scrollTo(n, s);
                        }
                        t(o);
                    }
                }, 50);
            };
            var n = e.defaultView.pageXOffset;
            var s = e.defaultView.pageYOffset;
            i.open();
            i.write("<!DOCTYPE html><html></html>");
            y(e, n, s);
            i.replaceChild(r.javascriptEnabled === true ? i.adoptNode(a) : _(i.adoptNode(a)), i.documentElement);
            i.close();
        });
    }
    function y(e, t, i) {
        if (t !== e.defaultView.pageXOffset || i !== e.defaultView.pageYOffset) {
            e.defaultView.scrollTo(t, i);
        }
    }
    function b(t, i, n, r, a, o) {
        return new Tt(t, i, e.document).then(w(t)).then(function(e) {
            return v(e, n, r, a, o);
        });
    }
    function w(e) {
        return function(i) {
            var n = new DOMParser(), r;
            try {
                r = n.parseFromString(i, "text/html");
            } catch (a) {
                L("DOMParser not supported, falling back to createHTMLDocument");
                r = t.implementation.createHTMLDocument("");
                try {
                    r.open();
                    r.write(i);
                    r.close();
                } catch (o) {
                    L("createHTMLDocument write not supported, falling back to document.body.innerHTML");
                    r.body.innerHTML = i;
                }
            }
            var s = r.querySelector("base");
            if (!s || !s.href.host) {
                var l = r.createElement("base");
                l.href = e;
                r.head.insertBefore(l, r.head.firstChild);
            }
            return r;
        };
    }
    function C(e) {
        [].slice.call(e.querySelectorAll("canvas"), 0).forEach(function(e) {
            e.setAttribute(l, "canvas-" + c++);
        });
    }
    function x(e, t) {
        [].slice.call(e.querySelectorAll("[" + l + "]"), 0).forEach(function(e) {
            try {
                var i = t.querySelector("[" + l + '="' + e.getAttribute(l) + '"]');
                if (i) {
                    i.width = e.width;
                    i.height = e.height;
                    i.getContext("2d").putImageData(e.getContext("2d").getImageData(0, 0, e.width, e.height), 0, 0);
                }
            } catch (n) {
                L("Unable to copy canvas content from", e, n);
            }
            e.removeAttribute(l);
        });
    }
    function _(e) {
        [].slice.call(e.childNodes, 0).filter(S).forEach(function(t) {
            if (t.tagName === "SCRIPT") {
                e.removeChild(t);
            } else {
                _(t);
            }
        });
        return e;
    }
    function S(e) {
        return e.nodeType === Node.ELEMENT_NODE;
    }
    function k(e) {
        var i = t.createElement("a");
        i.href = e;
        i.href = i.href;
        return i;
    }
    function A(e) {
        this.src = e;
        L("DummyImageContainer for", e);
        if (!this.promise || !this.image) {
            L("Initiating DummyImageContainer");
            A.prototype.image = new Image();
            var t = this.image;
            A.prototype.promise = new Promise(function(e, i) {
                t.onload = e;
                t.onerror = i;
                t.src = m();
                if (t.complete === true) {
                    e(t);
                }
            });
        }
    }
    function E(e, i) {
        var n = t.createElement("div"), r = t.createElement("img"), a = t.createElement("span"), o = "Hidden Text", s, l;
        n.style.visibility = "hidden";
        n.style.fontFamily = e;
        n.style.fontSize = i;
        n.style.margin = 0;
        n.style.padding = 0;
        t.body.appendChild(n);
        r.src = m();
        r.width = 1;
        r.height = 1;
        r.style.margin = 0;
        r.style.padding = 0;
        r.style.verticalAlign = "baseline";
        a.style.fontFamily = e;
        a.style.fontSize = i;
        a.style.margin = 0;
        a.style.padding = 0;
        a.appendChild(t.createTextNode(o));
        n.appendChild(a);
        n.appendChild(r);
        s = r.offsetTop - a.offsetTop + 1;
        n.removeChild(a);
        n.appendChild(t.createTextNode(o));
        n.style.lineHeight = "normal";
        r.style.verticalAlign = "super";
        l = r.offsetTop - n.offsetTop + 1;
        t.body.removeChild(n);
        this.baseline = s;
        this.lineWidth = 1;
        this.middle = l;
    }
    function T() {
        this.data = {};
    }
    T.prototype.getMetrics = function(e, t) {
        if (this.data[e + "-" + t] === o) {
            this.data[e + "-" + t] = new E(e, t);
        }
        return this.data[e + "-" + t];
    };
    function P(e, t, i) {
        this.image = null;
        this.src = e;
        var n = this;
        var r = q(e);
        this.promise = (!t ? this.proxyLoad(i.proxy, r, i) : new Promise(function(t) {
            if (e.contentWindow.document.URL === "about:blank" || e.contentWindow.document.documentElement == null) {
                e.contentWindow.onload = e.onload = function() {
                    t(e);
                };
            } else {
                t(e);
            }
        })).then(function(e) {
            return html2canvas(e.contentWindow.document.documentElement, {
                type: "view",
                width: e.width,
                height: e.height,
                proxy: i.proxy,
                javascriptEnabled: i.javascriptEnabled,
                removeContainer: i.removeContainer,
                allowTaint: i.allowTaint,
                imageTimeout: i.imageTimeout / 2
            });
        }).then(function(e) {
            return n.image = e;
        });
    }
    P.prototype.proxyLoad = function(e, t, i) {
        var n = this.src;
        return b(n.src, e, n.ownerDocument, t.width, t.height, i);
    };
    function I(e) {
        this.src = e.value;
        this.colorStops = [];
        this.type = null;
        this.x0 = .5;
        this.y0 = .5;
        this.x1 = .5;
        this.y1 = .5;
        this.promise = Promise.resolve(true);
    }
    I.prototype.TYPES = {
        LINEAR: 1,
        RADIAL: 2
    };
    function O(e, t) {
        this.src = e;
        this.image = new Image();
        var i = this;
        this.tainted = null;
        this.promise = new Promise(function(n, r) {
            i.image.onload = n;
            i.image.onerror = r;
            if (t) {
                i.image.crossOrigin = "anonymous";
            }
            i.image.src = e;
            if (i.image.complete === true) {
                n(i.image);
            }
        });
    }
    function D(t, i) {
        this.link = null;
        this.options = t;
        this.support = i;
        this.origin = this.getOrigin(e.location.href);
    }
    D.prototype.findImages = function(e) {
        var t = [];
        e.reduce(function(e, t) {
            switch (t.node.nodeName) {
              case "IMG":
                return e.concat([ {
                    args: [ t.node.src ],
                    method: "url"
                } ]);

              case "svg":
              case "IFRAME":
                return e.concat([ {
                    args: [ t.node ],
                    method: t.node.nodeName
                } ]);
            }
            return e;
        }, []).forEach(this.addImage(t, this.loadImage), this);
        return t;
    };
    D.prototype.findBackgroundImage = function(e, t) {
        t.parseBackgroundImages().filter(this.hasImageBackground).forEach(this.addImage(e, this.loadImage), this);
        return e;
    };
    D.prototype.addImage = function(e, t) {
        return function(i) {
            i.args.forEach(function(n) {
                if (!this.imageExists(e, n)) {
                    e.splice(0, 0, t.call(this, i));
                    L("Added image #" + e.length, typeof n === "string" ? n.substring(0, 100) : n);
                }
            }, this);
        };
    };
    D.prototype.hasImageBackground = function(e) {
        return e.method !== "none";
    };
    D.prototype.loadImage = function(e) {
        if (e.method === "url") {
            var t = e.args[0];
            if (this.isSVG(t) && !this.support.svg && !this.options.allowTaint) {
                return new zt(t);
            } else if (t.match(/data:image\/.*;base64,/i)) {
                return new O(t.replace(/url\(['"]{0,}|['"]{0,}\)$/gi, ""), false);
            } else if (this.isSameOrigin(t) || this.options.allowTaint === true || this.isSVG(t)) {
                return new O(t, false);
            } else if (this.support.cors && !this.options.allowTaint && this.options.useCORS) {
                return new O(t, true);
            } else if (this.options.proxy) {
                return new Mt(t, this.options.proxy);
            } else {
                return new A(t);
            }
        } else if (e.method === "linear-gradient") {
            return new R(e);
        } else if (e.method === "gradient") {
            return new Vt(e);
        } else if (e.method === "svg") {
            return new Wt(e.args[0], this.support.svg);
        } else if (e.method === "IFRAME") {
            return new P(e.args[0], this.isSameOrigin(e.args[0].src), this.options);
        } else {
            return new A(e);
        }
    };
    D.prototype.isSVG = function(e) {
        return e.substring(e.length - 3).toLowerCase() === "svg" || zt.prototype.isInline(e);
    };
    D.prototype.imageExists = function(e, t) {
        return e.some(function(e) {
            return e.src === t;
        });
    };
    D.prototype.isSameOrigin = function(e) {
        return this.getOrigin(e) === this.origin;
    };
    D.prototype.getOrigin = function(e) {
        var i = this.link || (this.link = t.createElement("a"));
        i.href = e;
        i.href = i.href;
        return i.protocol + i.hostname + i.port;
    };
    D.prototype.getPromise = function(e) {
        return this.timeout(e, this.options.imageTimeout)["catch"](function() {
            var t = new A(e.src);
            return t.promise.then(function(t) {
                e.image = t;
            });
        });
    };
    D.prototype.get = function(e) {
        var t = null;
        return this.images.some(function(i) {
            return (t = i).src === e;
        }) ? t : null;
    };
    D.prototype.fetch = function(e) {
        this.images = e.reduce(bt(this.findBackgroundImage, this), this.findImages(e));
        this.images.forEach(function(e, t) {
            e.promise.then(function() {
                L("Succesfully loaded image #" + (t + 1), e);
            }, function(i) {
                L("Failed loading image #" + (t + 1), e, i);
            });
        });
        this.ready = Promise.all(this.images.map(this.getPromise, this));
        L("Finished searching images");
        return this;
    };
    D.prototype.timeout = function(e, t) {
        var i;
        return Promise.race([ e.promise, new Promise(function(n, r) {
            i = setTimeout(function() {
                L("Timed out loading image", e);
                r(e);
            }, t);
        }) ]).then(function(e) {
            clearTimeout(i);
            return e;
        });
    };
    function R(e) {
        I.apply(this, arguments);
        this.type = this.TYPES.LINEAR;
        var t = e.args[0].match(this.stepRegExp) === null;
        if (t) {
            e.args[0].split(" ").reverse().forEach(function(e) {
                switch (e) {
                  case "left":
                    this.x0 = 0;
                    this.x1 = 1;
                    break;

                  case "top":
                    this.y0 = 0;
                    this.y1 = 1;
                    break;

                  case "right":
                    this.x0 = 1;
                    this.x1 = 0;
                    break;

                  case "bottom":
                    this.y0 = 1;
                    this.y1 = 0;
                    break;

                  case "to":
                    var t = this.y0;
                    var i = this.x0;
                    this.y0 = this.y1;
                    this.x0 = this.x1;
                    this.x1 = i;
                    this.y1 = t;
                    break;
                }
            }, this);
        } else {
            this.y0 = 0;
            this.y1 = 1;
        }
        this.colorStops = e.args.slice(t ? 1 : 0).map(function(e) {
            var t = e.match(this.stepRegExp);
            return {
                color: t[1],
                stop: t[3] === "%" ? t[2] / 100 : null
            };
        }, this);
        if (this.colorStops[0].stop === null) {
            this.colorStops[0].stop = 0;
        }
        if (this.colorStops[this.colorStops.length - 1].stop === null) {
            this.colorStops[this.colorStops.length - 1].stop = 1;
        }
        this.colorStops.forEach(function(e, t) {
            if (e.stop === null) {
                this.colorStops.slice(t).some(function(i, n) {
                    if (i.stop !== null) {
                        e.stop = (i.stop - this.colorStops[t - 1].stop) / (n + 1) + this.colorStops[t - 1].stop;
                        return true;
                    } else {
                        return false;
                    }
                }, this);
            }
        }, this);
    }
    R.prototype = Object.create(I.prototype);
    R.prototype.stepRegExp = /((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%|px)?/;
    function L() {
        if (e.html2canvas.logging && e.console && e.console.log) {
            Function.prototype.bind.call(e.console.log, e.console).apply(e.console, [ Date.now() - e.html2canvas.start + "ms", "html2canvas:" ].concat([].slice.call(arguments, 0)));
        }
    }
    function F(e, t) {
        this.node = e;
        this.parent = t;
        this.stack = null;
        this.bounds = null;
        this.borders = null;
        this.clip = [];
        this.backgroundClip = [];
        this.offsetBounds = null;
        this.visible = null;
        this.computedStyles = null;
        this.styles = {};
        this.backgroundImages = null;
        this.transformData = null;
        this.transformMatrix = null;
        this.isPseudoElement = false;
        this.opacity = null;
    }
    F.prototype.cloneTo = function(e) {
        e.visible = this.visible;
        e.borders = this.borders;
        e.bounds = this.bounds;
        e.clip = this.clip;
        e.backgroundClip = this.backgroundClip;
        e.computedStyles = this.computedStyles;
        e.styles = this.styles;
        e.backgroundImages = this.backgroundImages;
        e.opacity = this.opacity;
    };
    F.prototype.getOpacity = function() {
        return this.opacity === null ? this.opacity = this.cssFloat("opacity") : this.opacity;
    };
    F.prototype.assignStack = function(e) {
        this.stack = e;
        e.children.push(this);
    };
    F.prototype.isElementVisible = function() {
        return this.node.nodeType === Node.TEXT_NODE ? this.parent.visible : this.css("display") !== "none" && this.css("visibility") !== "hidden" && !this.node.hasAttribute("data-html2canvas-ignore") && (this.node.nodeName !== "INPUT" || this.node.getAttribute("type") !== "hidden");
    };
    F.prototype.css = function(e) {
        if (!this.computedStyles) {
            this.computedStyles = this.isPseudoElement ? this.parent.computedStyle(this.before ? ":before" : ":after") : this.computedStyle(null);
        }
        return this.styles[e] || (this.styles[e] = this.computedStyles[e]);
    };
    F.prototype.prefixedCss = function(e) {
        var t = [ "webkit", "moz", "ms", "o" ];
        var i = this.css(e);
        if (i === o) {
            t.some(function(t) {
                i = this.css(t + e.substr(0, 1).toUpperCase() + e.substr(1));
                return i !== o;
            }, this);
        }
        return i === o ? null : i;
    };
    F.prototype.computedStyle = function(e) {
        return this.node.ownerDocument.defaultView.getComputedStyle(this.node, e);
    };
    F.prototype.cssInt = function(e) {
        var t = parseInt(this.css(e), 10);
        return isNaN(t) ? 0 : t;
    };
    F.prototype.cssFloat = function(e) {
        var t = parseFloat(this.css(e));
        return isNaN(t) ? 0 : t;
    };
    F.prototype.fontWeight = function() {
        var e = this.css("fontWeight");
        switch (parseInt(e, 10)) {
          case 401:
            e = "bold";
            break;

          case 400:
            e = "normal";
            break;
        }
        return e;
    };
    F.prototype.parseClip = function() {
        var e = this.css("clip").match(this.CLIP);
        if (e) {
            return {
                top: parseInt(e[1], 10),
                right: parseInt(e[2], 10),
                bottom: parseInt(e[3], 10),
                left: parseInt(e[4], 10)
            };
        }
        return null;
    };
    F.prototype.parseBackgroundImages = function() {
        return this.backgroundImages || (this.backgroundImages = j(this.css("backgroundImage")));
    };
    F.prototype.cssList = function(e, t) {
        var i = (this.css(e) || "").split(",");
        i = i[t || 0] || i[0] || "auto";
        i = i.trim().split(" ");
        if (i.length === 1) {
            i = [ i[0], i[0] ];
        }
        return i;
    };
    F.prototype.parseBackgroundSize = function(e, t, i) {
        var n = this.cssList("backgroundSize", i);
        var r, a;
        if (B(n[0])) {
            r = e.width * parseFloat(n[0]) / 100;
        } else if (/contain|cover/.test(n[0])) {
            var o = e.width / e.height, s = t.width / t.height;
            return o < s ^ n[0] === "contain" ? {
                width: e.height * s,
                height: e.height
            } : {
                width: e.width,
                height: e.width / s
            };
        } else {
            r = parseInt(n[0], 10);
        }
        if (n[0] === "auto" && n[1] === "auto") {
            a = t.height;
        } else if (n[1] === "auto") {
            a = r / t.width * t.height;
        } else if (B(n[1])) {
            a = e.height * parseFloat(n[1]) / 100;
        } else {
            a = parseInt(n[1], 10);
        }
        if (n[0] === "auto") {
            r = a / t.height * t.width;
        }
        return {
            width: r,
            height: a
        };
    };
    F.prototype.parseBackgroundPosition = function(e, t, i, n) {
        var r = this.cssList("backgroundPosition", i);
        var a, o;
        if (B(r[0])) {
            a = (e.width - (n || t).width) * (parseFloat(r[0]) / 100);
        } else {
            a = parseInt(r[0], 10);
        }
        if (r[1] === "auto") {
            o = a / t.width * t.height;
        } else if (B(r[1])) {
            o = (e.height - (n || t).height) * parseFloat(r[1]) / 100;
        } else {
            o = parseInt(r[1], 10);
        }
        if (r[0] === "auto") {
            a = o / t.height * t.width;
        }
        return {
            left: a,
            top: o
        };
    };
    F.prototype.parseBackgroundRepeat = function(e) {
        return this.cssList("backgroundRepeat", e)[0];
    };
    F.prototype.parseTextShadows = function() {
        var e = this.css("textShadow");
        var t = [];
        if (e && e !== "none") {
            var i = e.match(this.TEXT_SHADOW_PROPERTY);
            for (var n = 0; i && n < i.length; n++) {
                var r = i[n].match(this.TEXT_SHADOW_VALUES);
                t.push({
                    color: r[0],
                    offsetX: r[1] ? parseFloat(r[1].replace("px", "")) : 0,
                    offsetY: r[2] ? parseFloat(r[2].replace("px", "")) : 0,
                    blur: r[3] ? r[3].replace("px", "") : 0
                });
            }
        }
        return t;
    };
    F.prototype.parseTransform = function() {
        if (!this.transformData) {
            if (this.hasTransform()) {
                var e = this.parseBounds();
                var t = this.prefixedCss("transformOrigin").split(" ").map(U).map(z);
                t[0] += e.left;
                t[1] += e.top;
                this.transformData = {
                    origin: t,
                    matrix: this.parseTransformMatrix()
                };
            } else {
                this.transformData = {
                    origin: [ 0, 0 ],
                    matrix: [ 1, 0, 0, 1, 0, 0 ]
                };
            }
        }
        return this.transformData;
    };
    F.prototype.parseTransformMatrix = function() {
        if (!this.transformMatrix) {
            var e = this.prefixedCss("transform");
            var t = e ? N(e.match(this.MATRIX_PROPERTY)) : null;
            this.transformMatrix = t ? t : [ 1, 0, 0, 1, 0, 0 ];
        }
        return this.transformMatrix;
    };
    F.prototype.parseBounds = function() {
        return this.bounds || (this.bounds = this.hasTransform() ? W(this.node) : q(this.node));
    };
    F.prototype.hasTransform = function() {
        return this.parseTransformMatrix().join(",") !== "1,0,0,1,0,0" || this.parent && this.parent.hasTransform();
    };
    F.prototype.getValue = function() {
        var e = this.node.value || "";
        e = this.node.tagName === "SELECT" ? M(this.node) : e;
        return e.length === 0 ? this.node.placeholder || "" : e;
    };
    F.prototype.MATRIX_PROPERTY = /(matrix)\((.+)\)/;
    F.prototype.TEXT_SHADOW_PROPERTY = /((rgba|rgb)\([^\)]+\)(\s-?\d+px){0,})/g;
    F.prototype.TEXT_SHADOW_VALUES = /(-?\d+px)|(#.+)|(rgb\(.+\))|(rgba\(.+\))/g;
    F.prototype.CLIP = /^rect\((\d+)px,? (\d+)px,? (\d+)px,? (\d+)px\)$/;
    function M(e) {
        var t = e.options[e.selectedIndex || 0];
        return t ? t.text || "" : "";
    }
    function N(e) {
        if (e && e[1] === "matrix") {
            return e[2].split(",").map(function(e) {
                return parseFloat(e.trim());
            });
        }
    }
    function B(e) {
        return e.toString().indexOf("%") !== -1;
    }
    function j(e) {
        var t = " \r\n	", i, n, r, a, o, s = [], l = 0, c = 0, u, f;
        var d = function() {
            if (i) {
                if (n.substr(0, 1) === '"') {
                    n = n.substr(1, n.length - 2);
                }
                if (n) {
                    f.push(n);
                }
                if (i.substr(0, 1) === "-" && (a = i.indexOf("-", 1) + 1) > 0) {
                    r = i.substr(0, a);
                    i = i.substr(a);
                }
                s.push({
                    prefix: r,
                    method: i.toLowerCase(),
                    value: o,
                    args: f,
                    image: null
                });
            }
            f = [];
            i = r = n = o = "";
        };
        f = [];
        i = r = n = o = "";
        e.split("").forEach(function(e) {
            if (l === 0 && t.indexOf(e) > -1) {
                return;
            }
            switch (e) {
              case '"':
                if (!u) {
                    u = e;
                } else if (u === e) {
                    u = null;
                }
                break;

              case "(":
                if (u) {
                    break;
                } else if (l === 0) {
                    l = 1;
                    o += e;
                    return;
                } else {
                    c++;
                }
                break;

              case ")":
                if (u) {
                    break;
                } else if (l === 1) {
                    if (c === 0) {
                        l = 0;
                        o += e;
                        d();
                        return;
                    } else {
                        c--;
                    }
                }
                break;

              case ",":
                if (u) {
                    break;
                } else if (l === 0) {
                    d();
                    return;
                } else if (l === 1) {
                    if (c === 0 && !i.match(/^url$/i)) {
                        f.push(n);
                        n = "";
                        o += e;
                        return;
                    }
                }
                break;
            }
            o += e;
            if (l === 0) {
                i += e;
            } else {
                n += e;
            }
        });
        d();
        return s;
    }
    function U(e) {
        return e.replace("px", "");
    }
    function z(e) {
        return parseFloat(e);
    }
    function q(e) {
        if (e.getBoundingClientRect) {
            var t = e.getBoundingClientRect();
            var i = e.offsetWidth == null ? t.width : e.offsetWidth;
            return {
                top: t.top,
                bottom: t.bottom || t.top + t.height,
                right: t.left + i,
                left: t.left,
                width: i,
                height: e.offsetHeight == null ? t.height : e.offsetHeight
            };
        }
        return {};
    }
    function W(e) {
        var t = e.offsetParent ? W(e.offsetParent) : {
            top: 0,
            left: 0
        };
        return {
            top: e.offsetTop + t.top,
            bottom: e.offsetTop + e.offsetHeight + t.top,
            right: e.offsetLeft + t.left + e.offsetWidth,
            left: e.offsetLeft + t.left,
            width: e.offsetWidth,
            height: e.offsetHeight
        };
    }
    function H(e, t, i, n, r) {
        L("Starting NodeParser");
        this.renderer = t;
        this.options = r;
        this.range = null;
        this.support = i;
        this.renderQueue = [];
        this.stack = new jt(true, 1, e.ownerDocument, null);
        var a = new F(e, null);
        if (e === e.ownerDocument.documentElement) {
            var o = new F(this.renderer.isTransparent(a.css("backgroundColor")) ? e.ownerDocument.body : e.ownerDocument.documentElement, null);
            t.rectangle(0, 0, t.width, t.height, o.css("backgroundColor"));
        }
        a.visibile = a.isElementVisible();
        this.createPseudoHideStyles(e.ownerDocument);
        this.disableAnimations(e.ownerDocument);
        this.nodes = _t([ a ].concat(this.getChildren(a)).filter(function(e) {
            return e.visible = e.isElementVisible();
        }).map(this.getPseudoElements, this));
        this.fontMetrics = new T();
        L("Fetched nodes, total:", this.nodes.length);
        L("Calculate overflow clips");
        this.calculateOverflowClips();
        L("Start fetching images");
        this.images = n.fetch(this.nodes.filter(pt));
        this.ready = this.images.ready.then(bt(function() {
            L("Images loaded, starting parsing");
            L("Creating stacking contexts");
            this.createStackingContexts();
            L("Sorting stacking contexts");
            this.sortStackingContexts(this.stack);
            this.parse(this.stack);
            L("Render queue created with " + this.renderQueue.length + " items");
            return new Promise(bt(function(e) {
                if (!r.async) {
                    this.renderQueue.forEach(this.paint, this);
                    e();
                } else if (typeof r.async === "function") {
                    r.async.call(this, this.renderQueue, e);
                } else if (this.renderQueue.length > 0) {
                    this.renderIndex = 0;
                    this.asyncRenderer(this.renderQueue, e);
                } else {
                    e();
                }
            }, this));
        }, this));
    }
    H.prototype.calculateOverflowClips = function() {
        this.nodes.forEach(function(e) {
            if (pt(e)) {
                if (gt(e)) {
                    e.appendToDOM();
                }
                e.borders = this.parseBorders(e);
                var t = e.css("overflow") === "hidden" ? [ e.borders.clip ] : [];
                var i = e.parseClip();
                if (i && [ "absolute", "fixed" ].indexOf(e.css("position")) !== -1) {
                    t.push([ [ "rect", e.bounds.left + i.left, e.bounds.top + i.top, i.right - i.left, i.bottom - i.top ] ]);
                }
                e.clip = G(e) ? e.parent.clip.concat(t) : t;
                e.backgroundClip = e.css("overflow") !== "hidden" ? e.clip.concat([ e.borders.clip ]) : e.clip;
                if (gt(e)) {
                    e.cleanDOM();
                }
            } else if (mt(e)) {
                e.clip = G(e) ? e.parent.clip : [];
            }
            if (!gt(e)) {
                e.bounds = null;
            }
        }, this);
    };
    function G(e) {
        return e.parent && e.parent.clip.length;
    }
    H.prototype.asyncRenderer = function(e, t, i) {
        i = i || Date.now();
        this.paint(e[this.renderIndex++]);
        if (e.length === this.renderIndex) {
            t();
        } else if (i + 20 > Date.now()) {
            this.asyncRenderer(e, t, i);
        } else {
            setTimeout(bt(function() {
                this.asyncRenderer(e, t);
            }, this), 0);
        }
    };
    H.prototype.createPseudoHideStyles = function(e) {
        this.createStyles(e, "." + Nt.prototype.PSEUDO_HIDE_ELEMENT_CLASS_BEFORE + ':before { content: "" !important; display: none !important; }' + "." + Nt.prototype.PSEUDO_HIDE_ELEMENT_CLASS_AFTER + ':after { content: "" !important; display: none !important; }');
    };
    H.prototype.disableAnimations = function(e) {
        this.createStyles(e, "* { -webkit-animation: none !important; -moz-animation: none !important; -o-animation: none !important; animation: none !important; " + "-webkit-transition: none !important; -moz-transition: none !important; -o-transition: none !important; transition: none !important;}");
    };
    H.prototype.createStyles = function(e, t) {
        var i = e.createElement("style");
        i.innerHTML = t;
        e.body.appendChild(i);
    };
    H.prototype.getPseudoElements = function(e) {
        var t = [ [ e ] ];
        if (e.node.nodeType === Node.ELEMENT_NODE) {
            var i = this.getPseudoElement(e, ":before");
            var n = this.getPseudoElement(e, ":after");
            if (i) {
                t.push(i);
            }
            if (n) {
                t.push(n);
            }
        }
        return _t(t);
    };
    function V(e) {
        return e.replace(/(\-[a-z])/g, function(e) {
            return e.toUpperCase().replace("-", "");
        });
    }
    H.prototype.getPseudoElement = function(e, i) {
        var n = e.computedStyle(i);
        if (!n || !n.content || n.content === "none" || n.content === "-moz-alt-content" || n.display === "none") {
            return null;
        }
        var r = St(n.content);
        var a = r.substr(0, 3) === "url";
        var o = t.createElement(a ? "img" : "html2canvaspseudoelement");
        var s = new Nt(o, e, i);
        for (var l = n.length - 1; l >= 0; l--) {
            var c = V(n.item(l));
            o.style[c] = n[c];
        }
        o.className = Nt.prototype.PSEUDO_HIDE_ELEMENT_CLASS_BEFORE + " " + Nt.prototype.PSEUDO_HIDE_ELEMENT_CLASS_AFTER;
        if (a) {
            o.src = j(r)[0].args[0];
            return [ s ];
        } else {
            var u = t.createTextNode(r);
            o.appendChild(u);
            return [ s, new Ht(u, s) ];
        }
    };
    H.prototype.getChildren = function(e) {
        return _t([].filter.call(e.node.childNodes, lt).map(function(t) {
            var i = [ t.nodeType === Node.TEXT_NODE ? new Ht(t, e) : new F(t, e) ].filter(xt);
            return t.nodeType === Node.ELEMENT_NODE && i.length && t.tagName !== "TEXTAREA" ? i[0].isElementVisible() ? i.concat(this.getChildren(i[0])) : [] : i;
        }, this));
    };
    H.prototype.newStackingContext = function(e, t) {
        var i = new jt(t, e.getOpacity(), e.node, e.parent);
        e.cloneTo(i);
        var n = t ? i.getParentStack(this) : i.parent.stack;
        n.contexts.push(i);
        e.stack = i;
    };
    H.prototype.createStackingContexts = function() {
        this.nodes.forEach(function(e) {
            if (pt(e) && (this.isRootElement(e) || yt(e) || ct(e) || this.isBodyWithTransparentRoot(e) || e.hasTransform())) {
                this.newStackingContext(e, true);
            } else if (pt(e) && (ut(e) && it(e) || dt(e) || ft(e))) {
                this.newStackingContext(e, false);
            } else {
                e.assignStack(e.parent.stack);
            }
        }, this);
    };
    H.prototype.isBodyWithTransparentRoot = function(e) {
        return e.node.nodeName === "BODY" && this.renderer.isTransparent(e.parent.css("backgroundColor"));
    };
    H.prototype.isRootElement = function(e) {
        return e.parent === null;
    };
    H.prototype.sortStackingContexts = function(e) {
        e.contexts.sort(vt(e.contexts.slice(0)));
        e.contexts.forEach(this.sortStackingContexts, this);
    };
    H.prototype.parseTextBounds = function(e) {
        return function(t, i, n) {
            if (e.parent.css("textDecoration").substr(0, 4) !== "none" || t.trim().length !== 0) {
                if (this.support.rangeBounds && !e.parent.hasTransform()) {
                    var r = n.slice(0, i).join("").length;
                    return this.getRangeBounds(e.node, r, t.length);
                } else if (e.node && typeof e.node.data === "string") {
                    var a = e.node.splitText(t.length);
                    var o = this.getWrapperBounds(e.node, e.parent.hasTransform());
                    e.node = a;
                    return o;
                }
            } else if (!this.support.rangeBounds || e.parent.hasTransform()) {
                e.node = e.node.splitText(t.length);
            }
            return {};
        };
    };
    H.prototype.getWrapperBounds = function(e, t) {
        var i = e.ownerDocument.createElement("html2canvaswrapper");
        var n = e.parentNode, r = e.cloneNode(true);
        i.appendChild(e.cloneNode(true));
        n.replaceChild(i, e);
        var a = t ? W(i) : q(i);
        n.replaceChild(r, i);
        return a;
    };
    H.prototype.getRangeBounds = function(e, t, i) {
        var n = this.range || (this.range = e.ownerDocument.createRange());
        n.setStart(e, t);
        n.setEnd(e, t + i);
        return n.getBoundingClientRect();
    };
    function $() {}
    H.prototype.parse = function(e) {
        var t = e.contexts.filter(et);
        var i = e.children.filter(pt);
        var n = i.filter(ht(ft));
        var r = n.filter(ht(ut)).filter(ht(nt));
        var a = i.filter(ht(ut)).filter(ft);
        var o = n.filter(ht(ut)).filter(nt);
        var s = e.contexts.concat(n.filter(ut)).filter(it);
        var l = e.children.filter(mt).filter(at);
        var c = e.contexts.filter(tt);
        t.concat(r).concat(a).concat(o).concat(s).concat(l).concat(c).forEach(function(e) {
            this.renderQueue.push(e);
            if (rt(e)) {
                this.parse(e);
                this.renderQueue.push(new $());
            }
        }, this);
    };
    H.prototype.paint = function(e) {
        try {
            if (e instanceof $) {
                this.renderer.ctx.restore();
            } else if (mt(e)) {
                if (gt(e.parent)) {
                    e.parent.appendToDOM();
                }
                this.paintText(e);
                if (gt(e.parent)) {
                    e.parent.cleanDOM();
                }
            } else {
                this.paintNode(e);
            }
        } catch (t) {
            L(t);
        }
    };
    H.prototype.paintNode = function(e) {
        if (rt(e)) {
            this.renderer.setOpacity(e.opacity);
            this.renderer.ctx.save();
            if (e.hasTransform()) {
                this.renderer.setTransform(e.parseTransform());
            }
        }
        if (e.node.nodeName === "INPUT" && e.node.type === "checkbox") {
            this.paintCheckbox(e);
        } else if (e.node.nodeName === "INPUT" && e.node.type === "radio") {
            this.paintRadio(e);
        } else {
            if (e.css("page-break-before") === "always") {
                var t = this.options.canvas.getContext("2d");
                if (typeof t._pageBreakAt === "function") {
                    t._pageBreakAt(e.node.offsetTop);
                }
            }
            this.paintElement(e);
        }
        if (e.node.getAttribute) {
            var i = e.node.getAttribute("name");
            if (i === null) {
                var i = e.node.getAttribute("id");
            }
            if (i !== null) {
                var n = this.options.canvas.annotations;
                if (n) {
                    n.setName(i, e.bounds);
                }
            }
        }
    };
    H.prototype.paintElement = function(e) {
        var t = e.parseBounds();
        this.renderer.clip(e.backgroundClip, function() {
            this.renderer.renderBackground(e, t, e.borders.borders.map(Ct));
        }, this);
        this.renderer.clip(e.clip, function() {
            this.renderer.renderBorders(e.borders.borders);
        }, this);
        this.renderer.clip(e.backgroundClip, function() {
            switch (e.node.nodeName) {
              case "svg":
              case "IFRAME":
                var i = this.images.get(e.node);
                if (i) {
                    this.renderer.renderImage(e, t, e.borders, i);
                } else {
                    L("Error loading <" + e.node.nodeName + ">", e.node);
                }
                break;

              case "IMG":
                var n = this.images.get(e.node.src);
                if (n) {
                    this.renderer.renderImage(e, t, e.borders, n);
                } else {
                    L("Error loading <img>", e.node.src);
                }
                break;

              case "CANVAS":
                this.renderer.renderImage(e, t, e.borders, {
                    image: e.node
                });
                break;

              case "SELECT":
              case "INPUT":
              case "TEXTAREA":
                this.paintFormValue(e);
                break;
            }
        }, this);
    };
    H.prototype.paintCheckbox = function(e) {
        var t = e.parseBounds();
        var i = Math.min(t.width, t.height);
        var n = {
            width: i - 1,
            height: i - 1,
            top: t.top,
            left: t.left
        };
        var r = [ 3, 3 ];
        var a = [ r, r, r, r ];
        var o = [ 1, 1, 1, 1 ].map(function(e) {
            return {
                color: "#A5A5A5",
                width: e
            };
        });
        var s = J(n, a, o);
        this.renderer.clip(e.backgroundClip, function() {
            this.renderer.rectangle(n.left + 1, n.top + 1, n.width - 2, n.height - 2, "#DEDEDE");
            this.renderer.renderBorders(Y(o, n, s, a));
            if (e.node.checked) {
                this.renderer.font("#424242", "normal", "normal", "bold", i - 3 + "px", "arial");
                this.renderer.text("", n.left + i / 6, n.top + i - 1);
            }
        }, this);
    };
    H.prototype.paintRadio = function(e) {
        var t = e.parseBounds();
        var i = Math.min(t.width, t.height) - 2;
        this.renderer.clip(e.backgroundClip, function() {
            this.renderer.circleStroke(t.left + 1, t.top + 1, i, "#DEDEDE", 1, "#A5A5A5");
            if (e.node.checked) {
                this.renderer.circle(Math.ceil(t.left + i / 4) + 1, Math.ceil(t.top + i / 4) + 1, Math.floor(i / 2), "#424242");
            }
        }, this);
    };
    H.prototype.paintFormValue = function(e) {
        if (e.getValue().length > 0) {
            var t = e.node.ownerDocument;
            var i = t.createElement("html2canvaswrapper");
            var n = [ "lineHeight", "textAlign", "fontFamily", "fontWeight", "fontSize", "color", "paddingLeft", "paddingTop", "paddingRight", "paddingBottom", "width", "height", "borderLeftStyle", "borderTopStyle", "borderLeftWidth", "borderTopWidth", "boxSizing", "whiteSpace", "wordWrap" ];
            n.forEach(function(t) {
                try {
                    i.style[t] = e.css(t);
                } catch (n) {
                    L("html2canvas: Parse: Exception caught in renderFormValue: " + n.message);
                }
            });
            var r = e.parseBounds();
            i.style.position = "fixed";
            i.style.left = r.left + "px";
            i.style.top = r.top + "px";
            i.textContent = e.getValue();
            t.body.appendChild(i);
            this.paintText(new Ht(i.firstChild, e));
            t.body.removeChild(i);
        }
    };
    H.prototype.paintText = function(t) {
        t.applyTextTransform();
        var i = e.html2canvas.punycode.ucs2.decode(t.node.data);
        var n = (!this.options.letterRendering || ot(t)) && !Et(t.node.data) ? kt(i) : i.map(function(t) {
            return e.html2canvas.punycode.ucs2.encode([ t ]);
        });
        var r = t.parent.fontWeight();
        var a = t.parent.css("fontSize");
        var s = t.parent.css("fontFamily");
        var l = t.parent.parseTextShadows();
        this.renderer.font(t.parent.css("color"), t.parent.css("fontStyle"), t.parent.css("fontVariant"), r, a, s);
        if (l.length) {
            this.renderer.fontShadow(l[0].color, l[0].offsetX, l[0].offsetY, l[0].blur);
        } else {
            this.renderer.clearShadow();
        }
        this.renderer.clip(t.parent.clip, function() {
            n.map(this.parseTextBounds(t), this).forEach(function(e, i) {
                if (e) {
                    if (e.left === o) {
                        e.left = 0;
                    }
                    if (e.bottom === o) {
                        e.bottom = 0;
                    }
                    this.renderer.text(n[i], e.left, e.bottom);
                    this.renderTextDecoration(t.parent, e, this.fontMetrics.getMetrics(s, a));
                    if (i == 0 && t.parent.node.nodeName === "LI") {
                        this.renderBullet(t, e);
                    }
                    if (i == 0) {
                        this.renderAnnotation(t.parent, e);
                    }
                }
            }, this);
        }, this);
    };
    H.prototype.generateListNumber = {
        listAlpha: function(e) {
            var t = "", i;
            do {
                i = e % 26;
                t = String.fromCharCode(i + 64) + t;
                e = e / 26;
            } while (e * 26 > 26);
            return t;
        },
        listRoman: function(e) {
            var t = [ "M", "CM", "D", "CD", "C", "XC", "L", "XL", "X", "IX", "V", "IV", "I" ], i = [ 1e3, 900, 500, 400, 100, 90, 50, 40, 10, 9, 5, 4, 1 ], n = "", r, a = t.length;
            if (e <= 0 || e >= 4e3) {
                return e;
            }
            for (r = 0; r < a; r += 1) {
                while (e >= i[r]) {
                    e -= i[r];
                    n += t[r];
                }
            }
            return n;
        }
    };
    H.prototype.listItemText = function(e, t) {
        switch (e) {
          case "decimal-leading-zero":
            text = t.toString().length === 1 ? t = "0" + t.toString() : t.toString();
            break;

          case "upper-roman":
            text = this.generateListNumber.listRoman(t);
            break;

          case "lower-roman":
            text = this.generateListNumber.listRoman(t).toLowerCase();
            break;

          case "lower-alpha":
            text = this.generateListNumber.listAlpha(t).toLowerCase();
            break;

          case "upper-alpha":
            text = this.generateListNumber.listAlpha(t);
            break;

          case "decimal":
          default:
            text = t;
            break;
        }
        return text;
    };
    H.prototype.renderBullet = function(e, t) {
        var i = e.parent.css("listStyleType");
        if (i === "none") {
            return;
        }
        var n = t.top + (t.bottom - t.top) / 2;
        var r = this.renderer.canvas.getContext("2d");
        var a = r.measureText("M").width;
        var o = a / 4;
        var s = a * .75;
        var l = t.left - s;
        switch (i) {
          case "decimal":
          case "decimal-leading-zero":
          case "upper-alpha":
          case "lower-alpha":
          case "upper-roman":
          case "lower-roman":
            var c = e.parent;
            var u = c.parent;
            var f = Array.prototype.slice.call(u.node.children);
            var d = f.indexOf(c.node) + 1;
            var h = this.listItemText(i, d);
            h += ".";
            var p = t.left - s;
            p -= r.measureText(h).width;
            r.fillText(h, p, t.bottom);
            break;

          case "square":
            var o = a / 3;
            l -= o;
            n -= o / 2;
            r.fillRect(l, n, o, o);
            break;

          case "circle":
            var o = a / 6;
            l -= o;
            r.beginPath();
            r.arc(l, n, o, 0, Math.PI * 2);
            r.closePath();
            r.stroke();
            break;

          case "disc":
          default:
            var o = a / 6;
            l -= o;
            r.beginPath();
            r.arc(l, n, o, 0, Math.PI * 2);
            r.closePath();
            r.fill();
            break;
        }
    };
    H.prototype.renderTextDecoration = function(e, t, i) {
        switch (e.css("textDecoration").split(" ")[0]) {
          case "underline":
            this.renderer.rectangle(t.left, Math.round(t.top + i.baseline + i.lineWidth), t.width, 1, e.css("color"));
            break;

          case "overline":
            this.renderer.rectangle(t.left, Math.round(t.top), t.width, 1, e.css("color"));
            break;

          case "line-through":
            this.renderer.rectangle(t.left, Math.ceil(t.top + i.middle + i.lineWidth), t.width, 1, e.css("color"));
            break;
        }
    };
    H.prototype.renderAnnotation = function(e, t) {
        if (e.node.nodeName === "A") {
            var i = e.node.getAttribute("href");
            if (i) {
                var n = this.options.canvas.annotations;
                if (n) {
                    n.createAnnotation(i, e.bounds);
                }
            }
        }
    };
    H.prototype.parseBorders = function(e) {
        var t = e.parseBounds();
        var i = st(e);
        var n = [ "Top", "Right", "Bottom", "Left" ].map(function(t) {
            return {
                width: e.cssInt("border" + t + "Width"),
                color: e.css("border" + t + "Color"),
                args: null
            };
        });
        var r = J(t, i, n);
        return {
            clip: this.parseBackgroundClip(e, r, n, i, t),
            borders: Y(n, t, r, i)
        };
    };
    function Y(e, t, i, n) {
        return e.map(function(r, a) {
            if (r.width > 0) {
                var o = t.left;
                var s = t.top;
                var l = t.width;
                var c = t.height - e[2].width;
                switch (a) {
                  case 0:
                    c = e[0].width;
                    r.args = Q({
                        c1: [ o, s ],
                        c2: [ o + l, s ],
                        c3: [ o + l - e[1].width, s + c ],
                        c4: [ o + e[3].width, s + c ]
                    }, n[0], n[1], i.topLeftOuter, i.topLeftInner, i.topRightOuter, i.topRightInner);
                    break;

                  case 1:
                    o = t.left + t.width - e[1].width;
                    l = e[1].width;
                    r.args = Q({
                        c1: [ o + l, s ],
                        c2: [ o + l, s + c + e[2].width ],
                        c3: [ o, s + c ],
                        c4: [ o, s + e[0].width ]
                    }, n[1], n[2], i.topRightOuter, i.topRightInner, i.bottomRightOuter, i.bottomRightInner);
                    break;

                  case 2:
                    s = s + t.height - e[2].width;
                    c = e[2].width;
                    r.args = Q({
                        c1: [ o + l, s + c ],
                        c2: [ o, s + c ],
                        c3: [ o + e[3].width, s ],
                        c4: [ o + l - e[3].width, s ]
                    }, n[2], n[3], i.bottomRightOuter, i.bottomRightInner, i.bottomLeftOuter, i.bottomLeftInner);
                    break;

                  case 3:
                    l = e[3].width;
                    r.args = Q({
                        c1: [ o, s + c + e[2].width ],
                        c2: [ o, s ],
                        c3: [ o + l, s + e[0].width ],
                        c4: [ o + l, s + c ]
                    }, n[3], n[0], i.bottomLeftOuter, i.bottomLeftInner, i.topLeftOuter, i.topLeftInner);
                    break;
                }
            }
            return r;
        });
    }
    H.prototype.parseBackgroundClip = function(e, t, i, n, r) {
        var a = e.css("backgroundClip"), o = [];
        switch (a) {
          case "content-box":
          case "padding-box":
            Z(o, n[0], n[1], t.topLeftInner, t.topRightInner, r.left + i[3].width, r.top + i[0].width);
            Z(o, n[1], n[2], t.topRightInner, t.bottomRightInner, r.left + r.width - i[1].width, r.top + i[0].width);
            Z(o, n[2], n[3], t.bottomRightInner, t.bottomLeftInner, r.left + r.width - i[1].width, r.top + r.height - i[2].width);
            Z(o, n[3], n[0], t.bottomLeftInner, t.topLeftInner, r.left + i[3].width, r.top + r.height - i[2].width);
            break;

          default:
            Z(o, n[0], n[1], t.topLeftOuter, t.topRightOuter, r.left, r.top);
            Z(o, n[1], n[2], t.topRightOuter, t.bottomRightOuter, r.left + r.width, r.top);
            Z(o, n[2], n[3], t.bottomRightOuter, t.bottomLeftOuter, r.left + r.width, r.top + r.height);
            Z(o, n[3], n[0], t.bottomLeftOuter, t.topLeftOuter, r.left, r.top + r.height);
            break;
        }
        return o;
    };
    function X(e, t, i, n) {
        var r = 4 * ((Math.sqrt(2) - 1) / 3);
        var a = i * r, o = n * r, s = e + i, l = t + n;
        return {
            topLeft: K({
                x: e,
                y: l
            }, {
                x: e,
                y: l - o
            }, {
                x: s - a,
                y: t
            }, {
                x: s,
                y: t
            }),
            topRight: K({
                x: e,
                y: t
            }, {
                x: e + a,
                y: t
            }, {
                x: s,
                y: l - o
            }, {
                x: s,
                y: l
            }),
            bottomRight: K({
                x: s,
                y: t
            }, {
                x: s,
                y: t + o
            }, {
                x: e + a,
                y: l
            }, {
                x: e,
                y: l
            }),
            bottomLeft: K({
                x: s,
                y: l
            }, {
                x: s - a,
                y: l
            }, {
                x: e,
                y: t + o
            }, {
                x: e,
                y: t
            })
        };
    }
    function J(e, t, i) {
        var n = e.left, r = e.top, a = e.width, o = e.height, s = t[0][0], l = t[0][1], c = t[1][0], u = t[1][1], f = t[2][0], d = t[2][1], h = t[3][0], p = t[3][1];
        var g = a - c, m = o - d, v = a - f, y = o - p;
        return {
            topLeftOuter: X(n, r, s, l).topLeft.subdivide(.5),
            topLeftInner: X(n + i[3].width, r + i[0].width, Math.max(0, s - i[3].width), Math.max(0, l - i[0].width)).topLeft.subdivide(.5),
            topRightOuter: X(n + g, r, c, u).topRight.subdivide(.5),
            topRightInner: X(n + Math.min(g, a + i[3].width), r + i[0].width, g > a + i[3].width ? 0 : c - i[3].width, u - i[0].width).topRight.subdivide(.5),
            bottomRightOuter: X(n + v, r + m, f, d).bottomRight.subdivide(.5),
            bottomRightInner: X(n + Math.min(v, a - i[3].width), r + Math.min(m, o + i[0].width), Math.max(0, f - i[1].width), d - i[2].width).bottomRight.subdivide(.5),
            bottomLeftOuter: X(n, r + y, h, p).bottomLeft.subdivide(.5),
            bottomLeftInner: X(n + i[3].width, r + y, Math.max(0, h - i[3].width), p - i[2].width).bottomLeft.subdivide(.5)
        };
    }
    function K(e, t, i, n) {
        var r = function(e, t, i) {
            return {
                x: e.x + (t.x - e.x) * i,
                y: e.y + (t.y - e.y) * i
            };
        };
        return {
            start: e,
            startControl: t,
            endControl: i,
            end: n,
            subdivide: function(a) {
                var o = r(e, t, a), s = r(t, i, a), l = r(i, n, a), c = r(o, s, a), u = r(s, l, a), f = r(c, u, a);
                return [ K(e, o, c, f), K(f, u, l, n) ];
            },
            curveTo: function(e) {
                e.push([ "bezierCurve", t.x, t.y, i.x, i.y, n.x, n.y ]);
            },
            curveToReversed: function(n) {
                n.push([ "bezierCurve", i.x, i.y, t.x, t.y, e.x, e.y ]);
            }
        };
    }
    function Q(e, t, i, n, r, a, o) {
        var s = [];
        if (t[0] > 0 || t[1] > 0) {
            s.push([ "line", n[1].start.x, n[1].start.y ]);
            n[1].curveTo(s);
        } else {
            s.push([ "line", e.c1[0], e.c1[1] ]);
        }
        if (i[0] > 0 || i[1] > 0) {
            s.push([ "line", a[0].start.x, a[0].start.y ]);
            a[0].curveTo(s);
            s.push([ "line", o[0].end.x, o[0].end.y ]);
            o[0].curveToReversed(s);
        } else {
            s.push([ "line", e.c2[0], e.c2[1] ]);
            s.push([ "line", e.c3[0], e.c3[1] ]);
        }
        if (t[0] > 0 || t[1] > 0) {
            s.push([ "line", r[1].end.x, r[1].end.y ]);
            r[1].curveToReversed(s);
        } else {
            s.push([ "line", e.c4[0], e.c4[1] ]);
        }
        return s;
    }
    function Z(e, t, i, n, r, a, o) {
        if (t[0] > 0 || t[1] > 0) {
            e.push([ "line", n[0].start.x, n[0].start.y ]);
            n[0].curveTo(e);
            n[1].curveTo(e);
        } else {
            e.push([ "line", a, o ]);
        }
        if (i[0] > 0 || i[1] > 0) {
            e.push([ "line", r[0].start.x, r[0].start.y ]);
        }
    }
    function et(e) {
        return e.cssInt("zIndex") < 0;
    }
    function tt(e) {
        return e.cssInt("zIndex") > 0;
    }
    function it(e) {
        return e.cssInt("zIndex") === 0;
    }
    function nt(e) {
        return [ "inline", "inline-block", "inline-table" ].indexOf(e.css("display")) !== -1;
    }
    function rt(e) {
        return e instanceof jt;
    }
    function at(e) {
        return e.node.data.trim().length > 0;
    }
    function ot(e) {
        return /^(normal|none|0px)$/.test(e.parent.css("letterSpacing"));
    }
    function st(e) {
        return [ "TopLeft", "TopRight", "BottomRight", "BottomLeft" ].map(function(t) {
            var i = e.css("border" + t + "Radius");
            var n = i.split(" ");
            if (n.length <= 1) {
                n[1] = n[0];
            }
            return n.map(wt);
        });
    }
    function lt(e) {
        return e.nodeType === Node.TEXT_NODE || e.nodeType === Node.ELEMENT_NODE;
    }
    function ct(e) {
        var t = e.css("position");
        var i = [ "absolute", "relative", "fixed" ].indexOf(t) !== -1 ? e.css("zIndex") : "auto";
        return i !== "auto";
    }
    function ut(e) {
        return e.css("position") !== "static";
    }
    function ft(e) {
        return e.css("float") !== "none";
    }
    function dt(e) {
        return [ "inline-block", "inline-table" ].indexOf(e.css("display")) !== -1;
    }
    function ht(e) {
        var t = this;
        return function() {
            return !e.apply(t, arguments);
        };
    }
    function pt(e) {
        return e.node.nodeType === Node.ELEMENT_NODE;
    }
    function gt(e) {
        return e.isPseudoElement === true;
    }
    function mt(e) {
        return e.node.nodeType === Node.TEXT_NODE;
    }
    function vt(e) {
        return function(t, i) {
            return t.cssInt("zIndex") + e.indexOf(t) / e.length - (i.cssInt("zIndex") + e.indexOf(i) / e.length);
        };
    }
    function yt(e) {
        return e.getOpacity() < 1;
    }
    function bt(e, t) {
        return function() {
            return e.apply(t, arguments);
        };
    }
    function wt(e) {
        return parseInt(e, 10);
    }
    function Ct(e) {
        return e.width;
    }
    function xt(e) {
        return e.node.nodeType !== Node.ELEMENT_NODE || [ "SCRIPT", "HEAD", "TITLE", "OBJECT", "BR", "OPTION" ].indexOf(e.node.nodeName) === -1;
    }
    function _t(e) {
        return [].concat.apply([], e);
    }
    function St(e) {
        var t = e.substr(0, 1);
        return t === e.substr(e.length - 1) && t.match(/'|"/) ? e.substr(1, e.length - 2) : e;
    }
    function kt(t) {
        var i = [], n = 0, r = false, a;
        while (t.length) {
            if (At(t[n]) === r) {
                a = t.splice(0, n);
                if (a.length) {
                    i.push(e.html2canvas.punycode.ucs2.encode(a));
                }
                r = !r;
                n = 0;
            } else {
                n++;
            }
            if (n >= t.length) {
                a = t.splice(0, n);
                if (a.length) {
                    i.push(e.html2canvas.punycode.ucs2.encode(a));
                }
            }
        }
        return i;
    }
    function At(e) {
        return [ 32, 13, 10, 9, 45 ].indexOf(e) !== -1;
    }
    function Et(e) {
        return /[^\u0000-\u00ff]/.test(e);
    }
    function Tt(e, t, i) {
        var n = Lt(It);
        var r = Ft(t, e, n);
        return It ? $t(r) : Rt(i, r, n).then(function(e) {
            return qt(e.content);
        });
    }
    var Pt = 0;
    var It = "withCredentials" in new XMLHttpRequest();
    var Ot = "crossOrigin" in new Image();
    function Dt(e, t, i) {
        var n = Lt(Ot);
        var r = Ft(t, e, n);
        return Ot ? Promise.resolve(r) : Rt(i, r, n).then(function(e) {
            return "data:" + e.type + ";base64," + e.content;
        });
    }
    function Rt(t, i, n) {
        return new Promise(function(r, a) {
            var o = t.createElement("script");
            var s = function() {
                delete e.html2canvas.proxy[n];
                t.body.removeChild(o);
            };
            e.html2canvas.proxy[n] = function(e) {
                s();
                r(e);
            };
            o.src = i;
            o.onerror = function(e) {
                s();
                a(e);
            };
            t.body.appendChild(o);
        });
    }
    function Lt(e) {
        return !e ? "html2canvas_" + Date.now() + "_" + ++Pt + "_" + Math.round(Math.random() * 1e5) : "";
    }
    function Ft(e, t, i) {
        return e + "?url=" + encodeURIComponent(t) + (i.length ? "&callback=html2canvas.proxy." + i : "");
    }
    function Mt(e, i) {
        var n = t.createElement("script");
        var r = t.createElement("a");
        r.href = e;
        e = r.href;
        this.src = e;
        this.image = new Image();
        var a = this;
        this.promise = new Promise(function(n, r) {
            a.image.crossOrigin = "Anonymous";
            a.image.onload = n;
            a.image.onerror = r;
            new Dt(e, i, t).then(function(e) {
                a.image.src = e;
            })["catch"](r);
        });
    }
    function Nt(e, t, i) {
        F.call(this, e, t);
        this.isPseudoElement = true;
        this.before = i === ":before";
    }
    Nt.prototype.cloneTo = function(e) {
        Nt.prototype.cloneTo.call(this, e);
        e.isPseudoElement = true;
        e.before = this.before;
    };
    Nt.prototype = Object.create(F.prototype);
    Nt.prototype.appendToDOM = function() {
        if (this.before) {
            this.parent.node.insertBefore(this.node, this.parent.node.firstChild);
        } else {
            this.parent.node.appendChild(this.node);
        }
        this.parent.node.className += " " + this.getHideClass();
    };
    Nt.prototype.cleanDOM = function() {
        this.node.parentNode.removeChild(this.node);
        this.parent.node.className = this.parent.node.className.replace(this.getHideClass(), "");
    };
    Nt.prototype.getHideClass = function() {
        return this["PSEUDO_HIDE_ELEMENT_CLASS_" + (this.before ? "BEFORE" : "AFTER")];
    };
    Nt.prototype.PSEUDO_HIDE_ELEMENT_CLASS_BEFORE = "___html2canvas___pseudoelement_before";
    Nt.prototype.PSEUDO_HIDE_ELEMENT_CLASS_AFTER = "___html2canvas___pseudoelement_after";
    function Bt(e, t, i, n, r) {
        this.width = e;
        this.height = t;
        this.images = i;
        this.options = n;
        this.document = r;
    }
    Bt.prototype.renderImage = function(e, t, i, n) {
        var r = e.cssInt("paddingLeft"), a = e.cssInt("paddingTop"), o = e.cssInt("paddingRight"), s = e.cssInt("paddingBottom"), l = i.borders;
        var c = t.width - (l[1].width + l[3].width + r + o);
        var u = t.height - (l[0].width + l[2].width + a + s);
        this.drawImage(n, 0, 0, n.image.width || c, n.image.height || u, t.left + r + l[3].width, t.top + a + l[0].width, c, u);
    };
    Bt.prototype.renderBackground = function(e, t, i) {
        if (t.height > 0 && t.width > 0) {
            this.renderBackgroundColor(e, t);
            this.renderBackgroundImage(e, t, i);
        }
    };
    Bt.prototype.renderBackgroundColor = function(e, t) {
        var i = e.css("backgroundColor");
        if (!this.isTransparent(i)) {
            this.rectangle(t.left, t.top, t.width, t.height, e.css("backgroundColor"));
        }
    };
    Bt.prototype.renderBorders = function(e) {
        e.forEach(this.renderBorder, this);
    };
    Bt.prototype.renderBorder = function(e) {
        if (!this.isTransparent(e.color) && e.args !== null) {
            this.drawShape(e.args, e.color);
        }
    };
    Bt.prototype.renderBackgroundImage = function(e, t, i) {
        var n = e.parseBackgroundImages();
        n.reverse().forEach(function(n, r, a) {
            switch (n.method) {
              case "url":
                var o = this.images.get(n.args[0]);
                if (o) {
                    this.renderBackgroundRepeating(e, t, o, a.length - (r + 1), i);
                } else {
                    L("Error loading background-image", n.args[0]);
                }
                break;

              case "linear-gradient":
              case "gradient":
                var s = this.images.get(n.value);
                if (s) {
                    this.renderBackgroundGradient(s, t, i);
                } else {
                    L("Error loading background-image", n.args[0]);
                }
                break;

              case "none":
                break;

              default:
                L("Unknown background-image type", n.args[0]);
            }
        }, this);
    };
    Bt.prototype.renderBackgroundRepeating = function(e, t, i, n, r) {
        var a = e.parseBackgroundSize(t, i.image, n);
        var o = e.parseBackgroundPosition(t, i.image, n, a);
        var s = e.parseBackgroundRepeat(n);
        switch (s) {
          case "repeat-x":
          case "repeat no-repeat":
            this.backgroundRepeatShape(i, o, a, t, t.left + r[3], t.top + o.top + r[0], 99999, a.height, r);
            break;

          case "repeat-y":
          case "no-repeat repeat":
            this.backgroundRepeatShape(i, o, a, t, t.left + o.left + r[3], t.top + r[0], a.width, 99999, r);
            break;

          case "no-repeat":
            this.backgroundRepeatShape(i, o, a, t, t.left + o.left + r[3], t.top + o.top + r[0], a.width, a.height, r);
            break;

          default:
            this.renderBackgroundRepeat(i, o, a, {
                top: t.top,
                left: t.left
            }, r[3], r[0]);
            break;
        }
    };
    Bt.prototype.isTransparent = function(e) {
        return !e || e === "transparent" || e === "rgba(0, 0, 0, 0)";
    };
    function jt(e, t, i, n) {
        F.call(this, i, n);
        this.ownStacking = e;
        this.contexts = [];
        this.children = [];
        this.opacity = (this.parent ? this.parent.stack.opacity : 1) * t;
    }
    jt.prototype = Object.create(F.prototype);
    jt.prototype.getParentStack = function(e) {
        var t = this.parent ? this.parent.stack : null;
        return t ? t.ownStacking ? t : t.getParentStack(e) : e.stack;
    };
    function Ut(e) {
        this.rangeBounds = this.testRangeBounds(e);
        this.cors = this.testCORS();
        this.svg = this.testSVG();
    }
    Ut.prototype.testRangeBounds = function(e) {
        var t, i, n, r, a = false;
        if (e.createRange) {
            t = e.createRange();
            if (t.getBoundingClientRect) {
                i = e.createElement("boundtest");
                i.style.height = "123px";
                i.style.display = "block";
                e.body.appendChild(i);
                t.selectNode(i);
                n = t.getBoundingClientRect();
                r = n.height;
                if (r === 123) {
                    a = true;
                }
                e.body.removeChild(i);
            }
        }
        return a;
    };
    Ut.prototype.testCORS = function() {
        return typeof new Image().crossOrigin !== "undefined";
    };
    Ut.prototype.testSVG = function() {
        var e = new Image();
        var i = t.createElement("canvas");
        var n = i.getContext("2d");
        e.src = "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";
        try {
            n.drawImage(e, 0, 0);
            i.toDataURL();
        } catch (r) {
            return false;
        }
        return true;
    };
    function zt(e) {
        this.src = e;
        this.image = null;
        var t = this;
        this.promise = this.hasFabric().then(function() {
            return t.isInline(e) ? Promise.resolve(t.inlineFormatting(e)) : $t(e);
        }).then(function(e) {
            return new Promise(function(i) {
                html2canvas.fabric.loadSVGFromString(e, t.createCanvas.call(t, i));
            });
        });
    }
    zt.prototype.hasFabric = function() {
        return !html2canvas.fabric ? Promise.reject(new Error("html2canvas.svg.js is not loaded, cannot render svg")) : Promise.resolve();
    };
    zt.prototype.inlineFormatting = function(e) {
        return /^data:image\/svg\+xml;base64,/.test(e) ? this.decode64(this.removeContentType(e)) : this.removeContentType(e);
    };
    zt.prototype.removeContentType = function(e) {
        return e.replace(/^data:image\/svg\+xml(;base64)?,/, "");
    };
    zt.prototype.isInline = function(e) {
        return /^data:image\/svg\+xml/i.test(e);
    };
    zt.prototype.createCanvas = function(e) {
        var t = this;
        return function(i, n) {
            var r = new html2canvas.fabric.StaticCanvas("c");
            t.image = r.lowerCanvasEl;
            r.setWidth(n.width).setHeight(n.height).add(html2canvas.fabric.util.groupSVGElements(i, n)).renderAll();
            e(r.lowerCanvasEl);
        };
    };
    zt.prototype.decode64 = function(t) {
        return typeof e.atob === "function" ? e.atob(t) : qt(t);
    };
    function qt(e) {
        var t = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
        var i = e.length, n, r, a, o, s, l, c, u;
        var f = "";
        for (n = 0; n < i; n += 4) {
            r = t.indexOf(e[n]);
            a = t.indexOf(e[n + 1]);
            o = t.indexOf(e[n + 2]);
            s = t.indexOf(e[n + 3]);
            l = r << 2 | a >> 4;
            c = (a & 15) << 4 | o >> 2;
            u = (o & 3) << 6 | s;
            if (o === 64) {
                f += String.fromCharCode(l);
            } else if (s === 64 || s === -1) {
                f += String.fromCharCode(l, c);
            } else {
                f += String.fromCharCode(l, c, u);
            }
        }
        return f;
    }
    function Wt(e, t) {
        this.src = e;
        this.image = null;
        var i = this;
        this.promise = t ? new Promise(function(t, n) {
            i.image = new Image();
            i.image.onload = t;
            i.image.onerror = n;
            i.image.src = "data:image/svg+xml," + new XMLSerializer().serializeToString(e);
            if (i.image.complete === true) {
                t(i.image);
            }
        }) : this.hasFabric().then(function() {
            return new Promise(function(t) {
                html2canvas.fabric.parseSVGDocument(e, i.createCanvas.call(i, t));
            });
        });
    }
    Wt.prototype = Object.create(zt.prototype);
    function Ht(e, t) {
        F.call(this, e, t);
    }
    Ht.prototype = Object.create(F.prototype);
    Ht.prototype.applyTextTransform = function() {
        this.node.data = this.transform(this.parent.css("textTransform"));
    };
    Ht.prototype.transform = function(e) {
        var t = this.node.data;
        switch (e) {
          case "lowercase":
            return t.toLowerCase();

          case "capitalize":
            return t.replace(/(^|\s|:|-|\(|\))([a-z])/g, Gt);

          case "uppercase":
            return t.toUpperCase();

          default:
            return t;
        }
    };
    function Gt(e, t, i) {
        if (e.length > 0) {
            return t + i.toUpperCase();
        }
    }
    function Vt(e) {
        I.apply(this, arguments);
        this.type = e.args[0] === "linear" ? this.TYPES.LINEAR : this.TYPES.RADIAL;
    }
    Vt.prototype = Object.create(I.prototype);
    function $t(e) {
        return new Promise(function(t, i) {
            var n = new XMLHttpRequest();
            n.open("GET", e);
            n.onload = function() {
                if (n.status === 200) {
                    t(n.responseText);
                } else {
                    i(new Error(n.statusText));
                }
            };
            n.onerror = function() {
                i(new Error("Network Error"));
            };
            n.send();
        });
    }
    function Yt(e, t) {
        Bt.apply(this, arguments);
        this.canvas = this.options.canvas || this.document.createElement("canvas");
        if (!this.options.canvas) {
            this.canvas.width = e;
            this.canvas.height = t;
        }
        this.ctx = this.canvas.getContext("2d");
        if (this.options.background) {
            this.rectangle(0, 0, e, t, this.options.background);
        }
        this.taintCtx = this.document.createElement("canvas").getContext("2d");
        this.ctx.textBaseline = "bottom";
        this.variables = {};
        L("Initialized CanvasRenderer with size", e, "x", t);
    }
    Yt.prototype = Object.create(Bt.prototype);
    Yt.prototype.setFillStyle = function(e) {
        this.ctx.fillStyle = e;
        return this.ctx;
    };
    Yt.prototype.rectangle = function(e, t, i, n, r) {
        this.setFillStyle(r).fillRect(e, t, i, n);
    };
    Yt.prototype.circle = function(e, t, i, n) {
        this.setFillStyle(n);
        this.ctx.beginPath();
        this.ctx.arc(e + i / 2, t + i / 2, i / 2, 0, Math.PI * 2, true);
        this.ctx.closePath();
        this.ctx.fill();
    };
    Yt.prototype.circleStroke = function(e, t, i, n, r, a) {
        this.circle(e, t, i, n);
        this.ctx.strokeStyle = a;
        this.ctx.stroke();
    };
    Yt.prototype.drawShape = function(e, t) {
        this.shape(e);
        this.setFillStyle(t).fill();
    };
    Yt.prototype.taints = function(e) {
        if (e.tainted === null) {
            this.taintCtx.drawImage(e.image, 0, 0);
            try {
                this.taintCtx.getImageData(0, 0, 1, 1);
                e.tainted = false;
            } catch (i) {
                this.taintCtx = t.createElement("canvas").getContext("2d");
                e.tainted = true;
            }
        }
        return e.tainted;
    };
    Yt.prototype.drawImage = function(e, t, i, n, r, a, o, s, l) {
        if (!this.taints(e) || this.options.allowTaint) {
            this.ctx.drawImage(e.image, t, i, n, r, a, o, s, l);
        }
    };
    Yt.prototype.clip = function(e, t, i) {
        this.ctx.save();
        e.filter(Xt).forEach(function(e) {
            this.shape(e).clip();
        }, this);
        t.call(i);
        this.ctx.restore();
    };
    Yt.prototype.shape = function(e) {
        this.ctx.beginPath();
        e.forEach(function(e, t) {
            if (e[0] === "rect") {
                this.ctx.rect.apply(this.ctx, e.slice(1));
            } else {
                this.ctx[t === 0 ? "moveTo" : e[0] + "To"].apply(this.ctx, e.slice(1));
            }
        }, this);
        this.ctx.closePath();
        return this.ctx;
    };
    Yt.prototype.font = function(e, t, i, n, r, a) {
        this.setFillStyle(e).font = [ t, i, n, r, a ].join(" ").split(",")[0];
    };
    Yt.prototype.fontShadow = function(e, t, i, n) {
        this.setVariable("shadowColor", e).setVariable("shadowOffsetY", t).setVariable("shadowOffsetX", i).setVariable("shadowBlur", n);
    };
    Yt.prototype.clearShadow = function() {
        this.setVariable("shadowColor", "rgba(0,0,0,0)");
    };
    Yt.prototype.setOpacity = function(e) {
        this.ctx.globalAlpha = e;
    };
    Yt.prototype.setTransform = function(e) {
        this.ctx.translate(e.origin[0], e.origin[1]);
        this.ctx.transform.apply(this.ctx, e.matrix);
        this.ctx.translate(-e.origin[0], -e.origin[1]);
    };
    Yt.prototype.setVariable = function(e, t) {
        if (this.variables[e] !== t) {
            this.variables[e] = this.ctx[e] = t;
        }
        return this;
    };
    Yt.prototype.text = function(e, t, i) {
        this.ctx.fillText(e, t, i);
    };
    Yt.prototype.backgroundRepeatShape = function(e, t, i, n, r, a, o, s, l) {
        var c = [ [ "line", Math.round(r), Math.round(a) ], [ "line", Math.round(r + o), Math.round(a) ], [ "line", Math.round(r + o), Math.round(s + a) ], [ "line", Math.round(r), Math.round(s + a) ] ];
        this.clip([ c ], function() {
            this.renderBackgroundRepeat(e, t, i, n, l[3], l[0]);
        }, this);
    };
    Yt.prototype.renderBackgroundRepeat = function(e, t, i, n, r, a) {
        var o = Math.round(n.left + t.left + r), s = Math.round(n.top + t.top + a);
        this.setFillStyle(this.ctx.createPattern(this.resizeImage(e, i), "repeat"));
        this.ctx.translate(o, s);
        this.ctx.fill();
        this.ctx.translate(-o, -s);
    };
    Yt.prototype.renderBackgroundGradient = function(e, t) {
        if (e instanceof R) {
            var i = this.ctx.createLinearGradient(t.left + t.width * e.x0, t.top + t.height * e.y0, t.left + t.width * e.x1, t.top + t.height * e.y1);
            e.colorStops.forEach(function(e) {
                i.addColorStop(e.stop, e.color);
            });
            this.rectangle(t.left, t.top, t.width, t.height, i);
        }
    };
    Yt.prototype.resizeImage = function(e, i) {
        var n = e.image;
        if (n.width === i.width && n.height === i.height) {
            return n;
        }
        var r, a = t.createElement("canvas");
        a.width = i.width;
        a.height = i.height;
        r = a.getContext("2d");
        r.drawImage(n, 0, 0, n.width, n.height, 0, 0, i.width, i.height);
        return a;
    };
    function Xt(e) {
        return e.length > 0;
    }
}).call({}, window, document);

var html2canvasNodeAttribute = "data-html2canvas-node";

var html2canvasCanvasCloneAttribute = "data-html2canvas-canvas-clone";

var html2canvasCanvasCloneIndex = 0;

window.html2canvas = function(e, t) {
    t = t || {};
    if (t.logging) {
        window.html2canvas.logging = true;
        window.html2canvas.start = Date.now();
    }
    t.async = typeof t.async === "undefined" ? true : t.async;
    t.allowTaint = typeof t.allowTaint === "undefined" ? false : t.allowTaint;
    t.removeContainer = typeof t.removeContainer === "undefined" ? true : t.removeContainer;
    t.javascriptEnabled = typeof t.javascriptEnabled === "undefined" ? false : t.javascriptEnabled;
    t.imageTimeout = typeof t.imageTimeout === "undefined" ? 1e4 : t.imageTimeout;
    if (typeof e === "string") {
        if (typeof t.proxy !== "string") {
            return Promise.reject("Proxy must be used when rendering url");
        }
        return loadUrlDocument(absoluteUrl(e), t.proxy, document, window.innerWidth, window.innerHeight, t).then(function(e) {
            return renderWindow(e.contentWindow.document.documentElement, e, t, window.innerWidth, window.innerHeight);
        });
    }
    var i = (e === undefined ? [ document.documentElement ] : e.length ? e : [ e ])[0];
    i.setAttribute(html2canvasNodeAttribute, "true");
    return renderDocument(i.ownerDocument, t, i.ownerDocument.defaultView.innerWidth, i.ownerDocument.defaultView.innerHeight).then(function(e) {
        if (typeof t.onrendered === "function") {
            log("options.onrendered is deprecated, html2canvas returns a Promise containing the canvas");
            t.onrendered(e);
        }
        return e;
    });
};

window.html2canvas.punycode = this.punycode;

window.html2canvas.proxy = {};

function renderDocument(e, t, i, n) {
    return createWindowClone(e, e, i, n, t).then(function(r) {
        log("Document cloned");
        var a = "[" + html2canvasNodeAttribute + "='true']";
        e.querySelector(a).removeAttribute(html2canvasNodeAttribute);
        var o = r.contentWindow;
        var s = o.document.querySelector(a);
        var l = typeof t.onclone === "function" ? Promise.resolve(t.onclone(o.document)) : Promise.resolve(true);
        return l.then(function() {
            return renderWindow(s, r, t, i, n);
        });
    });
}

function renderWindow(e, t, i, n, r) {
    var a = t.contentWindow;
    var o = new Support(a.document);
    var s = new ImageLoader(i, o);
    var l = getBounds(e);
    var c = i.type === "view" ? n : documentWidth(a.document);
    var u = i.type === "view" ? r : documentHeight(a.document);
    var f = new CanvasRenderer(c, u, s, i, document);
    var d = new NodeParser(e, f, o, s, i);
    return d.ready.then(function() {
        log("Finished rendering");
        var n;
        if (i.type === "view") {
            n = crop(f.canvas, {
                width: f.canvas.width,
                height: f.canvas.height,
                top: 0,
                left: 0,
                x: 0,
                y: 0
            });
        } else if (e === a.document.body || e === a.document.documentElement || i.canvas != null) {
            n = f.canvas;
        } else {
            n = crop(f.canvas, {
                width: i.width != null ? i.width : l.width,
                height: i.height != null ? i.height : l.height,
                top: l.top,
                left: l.left,
                x: a.pageXOffset,
                y: a.pageYOffset
            });
        }
        cleanupContainer(t, i);
        return n;
    });
}

function cleanupContainer(e, t) {
    if (t.removeContainer) {
        e.parentNode.removeChild(e);
        log("Cleaned up container");
    }
}

function crop(e, t) {
    var i = document.createElement("canvas");
    var n = Math.min(e.width - 1, Math.max(0, t.left));
    var r = Math.min(e.width, Math.max(1, t.left + t.width));
    var a = Math.min(e.height - 1, Math.max(0, t.top));
    var o = Math.min(e.height, Math.max(1, t.top + t.height));
    i.width = t.width;
    i.height = t.height;
    log("Cropping canvas at:", "left:", t.left, "top:", t.top, "width:", r - n, "height:", o - a);
    log("Resulting crop with width", t.width, "and height", t.height, " with x", n, "and y", a);
    i.getContext("2d").drawImage(e, n, a, r - n, o - a, t.x, t.y, r - n, o - a);
    return i;
}

function documentWidth(e) {
    return Math.max(Math.max(e.body.scrollWidth, e.documentElement.scrollWidth), Math.max(e.body.offsetWidth, e.documentElement.offsetWidth), Math.max(e.body.clientWidth, e.documentElement.clientWidth));
}

function documentHeight(e) {
    return Math.max(Math.max(e.body.scrollHeight, e.documentElement.scrollHeight), Math.max(e.body.offsetHeight, e.documentElement.offsetHeight), Math.max(e.body.clientHeight, e.documentElement.clientHeight));
}

function smallImage() {
    return "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";
}

function createWindowClone(e, t, i, n, r) {
    labelCanvasElements(e);
    var a = e.documentElement.cloneNode(true), o = t.createElement("iframe");
    o.className = "html2canvas-container";
    o.style.visibility = "hidden";
    o.style.position = "fixed";
    o.style.left = "-10000px";
    o.style.top = "0px";
    o.style.border = "0";
    o.width = i;
    o.height = n;
    o.scrolling = "no";
    t.body.appendChild(o);
    return new Promise(function(t) {
        var i = o.contentWindow.document;
        o.contentWindow.onload = o.onload = function() {
            var a = setInterval(function() {
                if (i.body.childNodes.length > 0) {
                    cloneCanvasContents(e, i);
                    clearInterval(a);
                    if (r.type === "view") {
                        o.contentWindow.scrollTo(n, s);
                    }
                    t(o);
                }
            }, 50);
        };
        var n = e.defaultView.pageXOffset;
        var s = e.defaultView.pageYOffset;
        i.open();
        i.write("<!DOCTYPE html><html></html>");
        restoreOwnerScroll(e, n, s);
        i.replaceChild(r.javascriptEnabled === true ? i.adoptNode(a) : removeScriptNodes(i.adoptNode(a)), i.documentElement);
        i.close();
    });
}

function restoreOwnerScroll(e, t, i) {
    if (t !== e.defaultView.pageXOffset || i !== e.defaultView.pageYOffset) {
        e.defaultView.scrollTo(t, i);
    }
}

function loadUrlDocument(e, t, i, n, r, a) {
    return new Proxy(e, t, window.document).then(documentFromHTML(e)).then(function(e) {
        return createWindowClone(e, i, n, r, a);
    });
}

function documentFromHTML(e) {
    return function(t) {
        var i = new DOMParser(), n;
        try {
            n = i.parseFromString(t, "text/html");
        } catch (r) {
            log("DOMParser not supported, falling back to createHTMLDocument");
            n = document.implementation.createHTMLDocument("");
            try {
                n.open();
                n.write(t);
                n.close();
            } catch (a) {
                log("createHTMLDocument write not supported, falling back to document.body.innerHTML");
                n.body.innerHTML = t;
            }
        }
        var o = n.querySelector("base");
        if (!o || !o.href.host) {
            var s = n.createElement("base");
            s.href = e;
            n.head.insertBefore(s, n.head.firstChild);
        }
        return n;
    };
}

function labelCanvasElements(e) {
    [].slice.call(e.querySelectorAll("canvas"), 0).forEach(function(e) {
        e.setAttribute(html2canvasCanvasCloneAttribute, "canvas-" + html2canvasCanvasCloneIndex++);
    });
}

function cloneCanvasContents(e, t) {
    [].slice.call(e.querySelectorAll("[" + html2canvasCanvasCloneAttribute + "]"), 0).forEach(function(e) {
        try {
            var i = t.querySelector("[" + html2canvasCanvasCloneAttribute + '="' + e.getAttribute(html2canvasCanvasCloneAttribute) + '"]');
            if (i) {
                i.width = e.width;
                i.height = e.height;
                i.getContext("2d").putImageData(e.getContext("2d").getImageData(0, 0, e.width, e.height), 0, 0);
            }
        } catch (n) {
            log("Unable to copy canvas content from", e, n);
        }
        e.removeAttribute(html2canvasCanvasCloneAttribute);
    });
}

function removeScriptNodes(e) {
    [].slice.call(e.childNodes, 0).filter(isElementNode).forEach(function(t) {
        if (t.tagName === "SCRIPT") {
            e.removeChild(t);
        } else {
            removeScriptNodes(t);
        }
    });
    return e;
}

function isElementNode(e) {
    return e.nodeType === Node.ELEMENT_NODE;
}

function absoluteUrl(e) {
    var t = document.createElement("a");
    t.href = e;
    t.href = t.href;
    return t;
}

function DummyImageContainer(e) {
    this.src = e;
    log("DummyImageContainer for", e);
    if (!this.promise || !this.image) {
        log("Initiating DummyImageContainer");
        DummyImageContainer.prototype.image = new Image();
        var t = this.image;
        DummyImageContainer.prototype.promise = new Promise(function(e, i) {
            t.onload = e;
            t.onerror = i;
            t.src = smallImage();
            if (t.complete === true) {
                e(t);
            }
        });
    }
}

if (typeof Object.create !== "function" || typeof document.createElement("canvas").getContext !== "function") {
    window.html2canvas = function() {
        return Promise.reject("No canvas support");
    };
}

function Font(e, t) {
    var i = document.createElement("div"), n = document.createElement("img"), r = document.createElement("span"), a = "Hidden Text", o, s;
    i.style.visibility = "hidden";
    i.style.fontFamily = e;
    i.style.fontSize = t;
    i.style.margin = 0;
    i.style.padding = 0;
    document.body.appendChild(i);
    n.src = smallImage();
    n.width = 1;
    n.height = 1;
    n.style.margin = 0;
    n.style.padding = 0;
    n.style.verticalAlign = "baseline";
    r.style.fontFamily = e;
    r.style.fontSize = t;
    r.style.margin = 0;
    r.style.padding = 0;
    r.appendChild(document.createTextNode(a));
    i.appendChild(r);
    i.appendChild(n);
    o = n.offsetTop - r.offsetTop + 1;
    i.removeChild(r);
    i.appendChild(document.createTextNode(a));
    i.style.lineHeight = "normal";
    n.style.verticalAlign = "super";
    s = n.offsetTop - i.offsetTop + 1;
    document.body.removeChild(i);
    this.baseline = o;
    this.lineWidth = 1;
    this.middle = s;
}

function FontMetrics() {
    this.data = {};
}

FontMetrics.prototype.getMetrics = function(e, t) {
    if (this.data[e + "-" + t] === undefined) {
        this.data[e + "-" + t] = new Font(e, t);
    }
    return this.data[e + "-" + t];
};

function FrameContainer(e, t, i) {
    this.image = null;
    this.src = e;
    var n = this;
    var r = getBounds(e);
    this.promise = (!t ? this.proxyLoad(i.proxy, r, i) : new Promise(function(t) {
        if (e.contentWindow.document.URL === "about:blank" || e.contentWindow.document.documentElement == null) {
            e.contentWindow.onload = e.onload = function() {
                t(e);
            };
        } else {
            t(e);
        }
    })).then(function(e) {
        return html2canvas(e.contentWindow.document.documentElement, {
            type: "view",
            width: e.width,
            height: e.height,
            proxy: i.proxy,
            javascriptEnabled: i.javascriptEnabled,
            removeContainer: i.removeContainer,
            allowTaint: i.allowTaint,
            imageTimeout: i.imageTimeout / 2
        });
    }).then(function(e) {
        return n.image = e;
    });
}

FrameContainer.prototype.proxyLoad = function(e, t, i) {
    var n = this.src;
    return loadUrlDocument(n.src, e, n.ownerDocument, t.width, t.height, i);
};

function GradientContainer(e) {
    this.src = e.value;
    this.colorStops = [];
    this.type = null;
    this.x0 = .5;
    this.y0 = .5;
    this.x1 = .5;
    this.y1 = .5;
    this.promise = Promise.resolve(true);
}

GradientContainer.prototype.TYPES = {
    LINEAR: 1,
    RADIAL: 2
};

function ImageContainer(e, t) {
    this.src = e;
    this.image = new Image();
    var i = this;
    this.tainted = null;
    this.promise = new Promise(function(n, r) {
        i.image.onload = n;
        i.image.onerror = r;
        if (t) {
            i.image.crossOrigin = "anonymous";
        }
        i.image.src = e;
        if (i.image.complete === true) {
            n(i.image);
        }
    });
}

function ImageLoader(e, t) {
    this.link = null;
    this.options = e;
    this.support = t;
    this.origin = this.getOrigin(window.location.href);
}

ImageLoader.prototype.findImages = function(e) {
    var t = [];
    e.reduce(function(e, t) {
        switch (t.node.nodeName) {
          case "IMG":
            return e.concat([ {
                args: [ t.node.src ],
                method: "url"
            } ]);

          case "svg":
          case "IFRAME":
            return e.concat([ {
                args: [ t.node ],
                method: t.node.nodeName
            } ]);
        }
        return e;
    }, []).forEach(this.addImage(t, this.loadImage), this);
    return t;
};

ImageLoader.prototype.findBackgroundImage = function(e, t) {
    t.parseBackgroundImages().filter(this.hasImageBackground).forEach(this.addImage(e, this.loadImage), this);
    return e;
};

ImageLoader.prototype.addImage = function(e, t) {
    return function(i) {
        i.args.forEach(function(n) {
            if (!this.imageExists(e, n)) {
                e.splice(0, 0, t.call(this, i));
                log("Added image #" + e.length, typeof n === "string" ? n.substring(0, 100) : n);
            }
        }, this);
    };
};

ImageLoader.prototype.hasImageBackground = function(e) {
    return e.method !== "none";
};

ImageLoader.prototype.loadImage = function(e) {
    if (e.method === "url") {
        var t = e.args[0];
        if (this.isSVG(t) && !this.support.svg && !this.options.allowTaint) {
            return new SVGContainer(t);
        } else if (t.match(/data:image\/.*;base64,/i)) {
            return new ImageContainer(t.replace(/url\(['"]{0,}|['"]{0,}\)$/gi, ""), false);
        } else if (this.isSameOrigin(t) || this.options.allowTaint === true || this.isSVG(t)) {
            return new ImageContainer(t, false);
        } else if (this.support.cors && !this.options.allowTaint && this.options.useCORS) {
            return new ImageContainer(t, true);
        } else if (this.options.proxy) {
            return new ProxyImageContainer(t, this.options.proxy);
        } else {
            return new DummyImageContainer(t);
        }
    } else if (e.method === "linear-gradient") {
        return new LinearGradientContainer(e);
    } else if (e.method === "gradient") {
        return new WebkitGradientContainer(e);
    } else if (e.method === "svg") {
        return new SVGNodeContainer(e.args[0], this.support.svg);
    } else if (e.method === "IFRAME") {
        return new FrameContainer(e.args[0], this.isSameOrigin(e.args[0].src), this.options);
    } else {
        return new DummyImageContainer(e);
    }
};

ImageLoader.prototype.isSVG = function(e) {
    return e.substring(e.length - 3).toLowerCase() === "svg" || SVGContainer.prototype.isInline(e);
};

ImageLoader.prototype.imageExists = function(e, t) {
    return e.some(function(e) {
        return e.src === t;
    });
};

ImageLoader.prototype.isSameOrigin = function(e) {
    return this.getOrigin(e) === this.origin;
};

ImageLoader.prototype.getOrigin = function(e) {
    var t = this.link || (this.link = document.createElement("a"));
    t.href = e;
    t.href = t.href;
    return t.protocol + t.hostname + t.port;
};

ImageLoader.prototype.getPromise = function(e) {
    return this.timeout(e, this.options.imageTimeout)["catch"](function() {
        var t = new DummyImageContainer(e.src);
        return t.promise.then(function(t) {
            e.image = t;
        });
    });
};

ImageLoader.prototype.get = function(e) {
    var t = null;
    return this.images.some(function(i) {
        return (t = i).src === e;
    }) ? t : null;
};

ImageLoader.prototype.fetch = function(e) {
    this.images = e.reduce(bind(this.findBackgroundImage, this), this.findImages(e));
    this.images.forEach(function(e, t) {
        e.promise.then(function() {
            log("Succesfully loaded image #" + (t + 1), e);
        }, function(i) {
            log("Failed loading image #" + (t + 1), e, i);
        });
    });
    this.ready = Promise.all(this.images.map(this.getPromise, this));
    log("Finished searching images");
    return this;
};

ImageLoader.prototype.timeout = function(e, t) {
    var i;
    return Promise.race([ e.promise, new Promise(function(n, r) {
        i = setTimeout(function() {
            log("Timed out loading image", e);
            r(e);
        }, t);
    }) ]).then(function(e) {
        clearTimeout(i);
        return e;
    });
};

function LinearGradientContainer(e) {
    GradientContainer.apply(this, arguments);
    this.type = this.TYPES.LINEAR;
    var t = e.args[0].match(this.stepRegExp) === null;
    if (t) {
        e.args[0].split(" ").reverse().forEach(function(e) {
            switch (e) {
              case "left":
                this.x0 = 0;
                this.x1 = 1;
                break;

              case "top":
                this.y0 = 0;
                this.y1 = 1;
                break;

              case "right":
                this.x0 = 1;
                this.x1 = 0;
                break;

              case "bottom":
                this.y0 = 1;
                this.y1 = 0;
                break;

              case "to":
                var t = this.y0;
                var i = this.x0;
                this.y0 = this.y1;
                this.x0 = this.x1;
                this.x1 = i;
                this.y1 = t;
                break;
            }
        }, this);
    } else {
        this.y0 = 0;
        this.y1 = 1;
    }
    this.colorStops = e.args.slice(t ? 1 : 0).map(function(e) {
        var t = e.match(this.stepRegExp);
        return {
            color: t[1],
            stop: t[3] === "%" ? t[2] / 100 : null
        };
    }, this);
    if (this.colorStops[0].stop === null) {
        this.colorStops[0].stop = 0;
    }
    if (this.colorStops[this.colorStops.length - 1].stop === null) {
        this.colorStops[this.colorStops.length - 1].stop = 1;
    }
    this.colorStops.forEach(function(e, t) {
        if (e.stop === null) {
            this.colorStops.slice(t).some(function(i, n) {
                if (i.stop !== null) {
                    e.stop = (i.stop - this.colorStops[t - 1].stop) / (n + 1) + this.colorStops[t - 1].stop;
                    return true;
                } else {
                    return false;
                }
            }, this);
        }
    }, this);
}

LinearGradientContainer.prototype = Object.create(GradientContainer.prototype);

LinearGradientContainer.prototype.stepRegExp = /((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%|px)?/;

function log() {
    if (window.html2canvas.logging && window.console && window.console.log) {
        Function.prototype.bind.call(window.console.log, window.console).apply(window.console, [ Date.now() - window.html2canvas.start + "ms", "html2canvas:" ].concat([].slice.call(arguments, 0)));
    }
}

function NodeContainer(e, t) {
    this.node = e;
    this.parent = t;
    this.stack = null;
    this.bounds = null;
    this.borders = null;
    this.clip = [];
    this.backgroundClip = [];
    this.offsetBounds = null;
    this.visible = null;
    this.computedStyles = null;
    this.styles = {};
    this.backgroundImages = null;
    this.transformData = null;
    this.transformMatrix = null;
    this.isPseudoElement = false;
    this.opacity = null;
}

NodeContainer.prototype.cloneTo = function(e) {
    e.visible = this.visible;
    e.borders = this.borders;
    e.bounds = this.bounds;
    e.clip = this.clip;
    e.backgroundClip = this.backgroundClip;
    e.computedStyles = this.computedStyles;
    e.styles = this.styles;
    e.backgroundImages = this.backgroundImages;
    e.opacity = this.opacity;
};

NodeContainer.prototype.getOpacity = function() {
    return this.opacity === null ? this.opacity = this.cssFloat("opacity") : this.opacity;
};

NodeContainer.prototype.assignStack = function(e) {
    this.stack = e;
    e.children.push(this);
};

NodeContainer.prototype.isElementVisible = function() {
    return this.node.nodeType === Node.TEXT_NODE ? this.parent.visible : this.css("display") !== "none" && this.css("visibility") !== "hidden" && !this.node.hasAttribute("data-html2canvas-ignore") && (this.node.nodeName !== "INPUT" || this.node.getAttribute("type") !== "hidden");
};

NodeContainer.prototype.css = function(e) {
    if (!this.computedStyles) {
        this.computedStyles = this.isPseudoElement ? this.parent.computedStyle(this.before ? ":before" : ":after") : this.computedStyle(null);
    }
    return this.styles[e] || (this.styles[e] = this.computedStyles[e]);
};

NodeContainer.prototype.prefixedCss = function(e) {
    var t = [ "webkit", "moz", "ms", "o" ];
    var i = this.css(e);
    if (i === undefined) {
        t.some(function(t) {
            i = this.css(t + e.substr(0, 1).toUpperCase() + e.substr(1));
            return i !== undefined;
        }, this);
    }
    return i === undefined ? null : i;
};

NodeContainer.prototype.computedStyle = function(e) {
    return this.node.ownerDocument.defaultView.getComputedStyle(this.node, e);
};

NodeContainer.prototype.cssInt = function(e) {
    var t = parseInt(this.css(e), 10);
    return isNaN(t) ? 0 : t;
};

NodeContainer.prototype.cssFloat = function(e) {
    var t = parseFloat(this.css(e));
    return isNaN(t) ? 0 : t;
};

NodeContainer.prototype.fontWeight = function() {
    var e = this.css("fontWeight");
    switch (parseInt(e, 10)) {
      case 401:
        e = "bold";
        break;

      case 400:
        e = "normal";
        break;
    }
    return e;
};

NodeContainer.prototype.parseClip = function() {
    var e = this.css("clip").match(this.CLIP);
    if (e) {
        return {
            top: parseInt(e[1], 10),
            right: parseInt(e[2], 10),
            bottom: parseInt(e[3], 10),
            left: parseInt(e[4], 10)
        };
    }
    return null;
};

NodeContainer.prototype.parseBackgroundImages = function() {
    return this.backgroundImages || (this.backgroundImages = parseBackgrounds(this.css("backgroundImage")));
};

NodeContainer.prototype.cssList = function(e, t) {
    var i = (this.css(e) || "").split(",");
    i = i[t || 0] || i[0] || "auto";
    i = i.trim().split(" ");
    if (i.length === 1) {
        i = [ i[0], i[0] ];
    }
    return i;
};

NodeContainer.prototype.parseBackgroundSize = function(e, t, i) {
    var n = this.cssList("backgroundSize", i);
    var r, a;
    if (isPercentage(n[0])) {
        r = e.width * parseFloat(n[0]) / 100;
    } else if (/contain|cover/.test(n[0])) {
        var o = e.width / e.height, s = t.width / t.height;
        return o < s ^ n[0] === "contain" ? {
            width: e.height * s,
            height: e.height
        } : {
            width: e.width,
            height: e.width / s
        };
    } else {
        r = parseInt(n[0], 10);
    }
    if (n[0] === "auto" && n[1] === "auto") {
        a = t.height;
    } else if (n[1] === "auto") {
        a = r / t.width * t.height;
    } else if (isPercentage(n[1])) {
        a = e.height * parseFloat(n[1]) / 100;
    } else {
        a = parseInt(n[1], 10);
    }
    if (n[0] === "auto") {
        r = a / t.height * t.width;
    }
    return {
        width: r,
        height: a
    };
};

NodeContainer.prototype.parseBackgroundPosition = function(e, t, i, n) {
    var r = this.cssList("backgroundPosition", i);
    var a, o;
    if (isPercentage(r[0])) {
        a = (e.width - (n || t).width) * (parseFloat(r[0]) / 100);
    } else {
        a = parseInt(r[0], 10);
    }
    if (r[1] === "auto") {
        o = a / t.width * t.height;
    } else if (isPercentage(r[1])) {
        o = (e.height - (n || t).height) * parseFloat(r[1]) / 100;
    } else {
        o = parseInt(r[1], 10);
    }
    if (r[0] === "auto") {
        a = o / t.height * t.width;
    }
    return {
        left: a,
        top: o
    };
};

NodeContainer.prototype.parseBackgroundRepeat = function(e) {
    return this.cssList("backgroundRepeat", e)[0];
};

NodeContainer.prototype.parseTextShadows = function() {
    var e = this.css("textShadow");
    var t = [];
    if (e && e !== "none") {
        var i = e.match(this.TEXT_SHADOW_PROPERTY);
        for (var n = 0; i && n < i.length; n++) {
            var r = i[n].match(this.TEXT_SHADOW_VALUES);
            t.push({
                color: r[0],
                offsetX: r[1] ? parseFloat(r[1].replace("px", "")) : 0,
                offsetY: r[2] ? parseFloat(r[2].replace("px", "")) : 0,
                blur: r[3] ? r[3].replace("px", "") : 0
            });
        }
    }
    return t;
};

NodeContainer.prototype.parseTransform = function() {
    if (!this.transformData) {
        if (this.hasTransform()) {
            var e = this.parseBounds();
            var t = this.prefixedCss("transformOrigin").split(" ").map(removePx).map(asFloat);
            t[0] += e.left;
            t[1] += e.top;
            this.transformData = {
                origin: t,
                matrix: this.parseTransformMatrix()
            };
        } else {
            this.transformData = {
                origin: [ 0, 0 ],
                matrix: [ 1, 0, 0, 1, 0, 0 ]
            };
        }
    }
    return this.transformData;
};

NodeContainer.prototype.parseTransformMatrix = function() {
    if (!this.transformMatrix) {
        var e = this.prefixedCss("transform");
        var t = e ? parseMatrix(e.match(this.MATRIX_PROPERTY)) : null;
        this.transformMatrix = t ? t : [ 1, 0, 0, 1, 0, 0 ];
    }
    return this.transformMatrix;
};

NodeContainer.prototype.parseBounds = function() {
    return this.bounds || (this.bounds = this.hasTransform() ? offsetBounds(this.node) : getBounds(this.node));
};

NodeContainer.prototype.hasTransform = function() {
    return this.parseTransformMatrix().join(",") !== "1,0,0,1,0,0" || this.parent && this.parent.hasTransform();
};

NodeContainer.prototype.getValue = function() {
    var e = this.node.value || "";
    e = this.node.tagName === "SELECT" ? selectionValue(this.node) : e;
    return e.length === 0 ? this.node.placeholder || "" : e;
};

NodeContainer.prototype.MATRIX_PROPERTY = /(matrix)\((.+)\)/;

NodeContainer.prototype.TEXT_SHADOW_PROPERTY = /((rgba|rgb)\([^\)]+\)(\s-?\d+px){0,})/g;

NodeContainer.prototype.TEXT_SHADOW_VALUES = /(-?\d+px)|(#.+)|(rgb\(.+\))|(rgba\(.+\))/g;

NodeContainer.prototype.CLIP = /^rect\((\d+)px,? (\d+)px,? (\d+)px,? (\d+)px\)$/;

function selectionValue(e) {
    var t = e.options[e.selectedIndex || 0];
    return t ? t.text || "" : "";
}

function parseMatrix(e) {
    if (e && e[1] === "matrix") {
        return e[2].split(",").map(function(e) {
            return parseFloat(e.trim());
        });
    }
}

function isPercentage(e) {
    return e.toString().indexOf("%") !== -1;
}

function parseBackgrounds(e) {
    var t = " \r\n	", i, n, r, a, o, s = [], l = 0, c = 0, u, f;
    var d = function() {
        if (i) {
            if (n.substr(0, 1) === '"') {
                n = n.substr(1, n.length - 2);
            }
            if (n) {
                f.push(n);
            }
            if (i.substr(0, 1) === "-" && (a = i.indexOf("-", 1) + 1) > 0) {
                r = i.substr(0, a);
                i = i.substr(a);
            }
            s.push({
                prefix: r,
                method: i.toLowerCase(),
                value: o,
                args: f,
                image: null
            });
        }
        f = [];
        i = r = n = o = "";
    };
    f = [];
    i = r = n = o = "";
    e.split("").forEach(function(e) {
        if (l === 0 && t.indexOf(e) > -1) {
            return;
        }
        switch (e) {
          case '"':
            if (!u) {
                u = e;
            } else if (u === e) {
                u = null;
            }
            break;

          case "(":
            if (u) {
                break;
            } else if (l === 0) {
                l = 1;
                o += e;
                return;
            } else {
                c++;
            }
            break;

          case ")":
            if (u) {
                break;
            } else if (l === 1) {
                if (c === 0) {
                    l = 0;
                    o += e;
                    d();
                    return;
                } else {
                    c--;
                }
            }
            break;

          case ",":
            if (u) {
                break;
            } else if (l === 0) {
                d();
                return;
            } else if (l === 1) {
                if (c === 0 && !i.match(/^url$/i)) {
                    f.push(n);
                    n = "";
                    o += e;
                    return;
                }
            }
            break;
        }
        o += e;
        if (l === 0) {
            i += e;
        } else {
            n += e;
        }
    });
    d();
    return s;
}

function removePx(e) {
    return e.replace("px", "");
}

function asFloat(e) {
    return parseFloat(e);
}

function getBounds(e) {
    if (e.getBoundingClientRect) {
        var t = e.getBoundingClientRect();
        var i = e.offsetWidth == null ? t.width : e.offsetWidth;
        return {
            top: t.top,
            bottom: t.bottom || t.top + t.height,
            right: t.left + i,
            left: t.left,
            width: i,
            height: e.offsetHeight == null ? t.height : e.offsetHeight
        };
    }
    return {};
}

function offsetBounds(e) {
    var t = e.offsetParent ? offsetBounds(e.offsetParent) : {
        top: 0,
        left: 0
    };
    return {
        top: e.offsetTop + t.top,
        bottom: e.offsetTop + e.offsetHeight + t.top,
        right: e.offsetLeft + t.left + e.offsetWidth,
        left: e.offsetLeft + t.left,
        width: e.offsetWidth,
        height: e.offsetHeight
    };
}

function NodeParser(e, t, i, n, r) {
    log("Starting NodeParser");
    this.renderer = t;
    this.options = r;
    this.range = null;
    this.support = i;
    this.renderQueue = [];
    this.stack = new StackingContext(true, 1, e.ownerDocument, null);
    var a = new NodeContainer(e, null);
    if (e === e.ownerDocument.documentElement) {
        var o = new NodeContainer(this.renderer.isTransparent(a.css("backgroundColor")) ? e.ownerDocument.body : e.ownerDocument.documentElement, null);
        t.rectangle(0, 0, t.width, t.height, o.css("backgroundColor"));
    }
    a.visibile = a.isElementVisible();
    this.createPseudoHideStyles(e.ownerDocument);
    this.disableAnimations(e.ownerDocument);
    this.nodes = flatten([ a ].concat(this.getChildren(a)).filter(function(e) {
        return e.visible = e.isElementVisible();
    }).map(this.getPseudoElements, this));
    this.fontMetrics = new FontMetrics();
    log("Fetched nodes, total:", this.nodes.length);
    log("Calculate overflow clips");
    this.calculateOverflowClips();
    log("Start fetching images");
    this.images = n.fetch(this.nodes.filter(isElement));
    this.ready = this.images.ready.then(bind(function() {
        log("Images loaded, starting parsing");
        log("Creating stacking contexts");
        this.createStackingContexts();
        log("Sorting stacking contexts");
        this.sortStackingContexts(this.stack);
        this.parse(this.stack);
        log("Render queue created with " + this.renderQueue.length + " items");
        return new Promise(bind(function(e) {
            if (!r.async) {
                this.renderQueue.forEach(this.paint, this);
                e();
            } else if (typeof r.async === "function") {
                r.async.call(this, this.renderQueue, e);
            } else if (this.renderQueue.length > 0) {
                this.renderIndex = 0;
                this.asyncRenderer(this.renderQueue, e);
            } else {
                e();
            }
        }, this));
    }, this));
}

NodeParser.prototype.calculateOverflowClips = function() {
    this.nodes.forEach(function(e) {
        if (isElement(e)) {
            if (isPseudoElement(e)) {
                e.appendToDOM();
            }
            e.borders = this.parseBorders(e);
            var t = e.css("overflow") === "hidden" ? [ e.borders.clip ] : [];
            var i = e.parseClip();
            if (i && [ "absolute", "fixed" ].indexOf(e.css("position")) !== -1) {
                t.push([ [ "rect", e.bounds.left + i.left, e.bounds.top + i.top, i.right - i.left, i.bottom - i.top ] ]);
            }
            e.clip = hasParentClip(e) ? e.parent.clip.concat(t) : t;
            e.backgroundClip = e.css("overflow") !== "hidden" ? e.clip.concat([ e.borders.clip ]) : e.clip;
            if (isPseudoElement(e)) {
                e.cleanDOM();
            }
        } else if (isTextNode(e)) {
            e.clip = hasParentClip(e) ? e.parent.clip : [];
        }
        if (!isPseudoElement(e)) {
            e.bounds = null;
        }
    }, this);
};

function hasParentClip(e) {
    return e.parent && e.parent.clip.length;
}

NodeParser.prototype.asyncRenderer = function(e, t, i) {
    i = i || Date.now();
    this.paint(e[this.renderIndex++]);
    if (e.length === this.renderIndex) {
        t();
    } else if (i + 20 > Date.now()) {
        this.asyncRenderer(e, t, i);
    } else {
        setTimeout(bind(function() {
            this.asyncRenderer(e, t);
        }, this), 0);
    }
};

NodeParser.prototype.createPseudoHideStyles = function(e) {
    this.createStyles(e, "." + PseudoElementContainer.prototype.PSEUDO_HIDE_ELEMENT_CLASS_BEFORE + ':before { content: "" !important; display: none !important; }' + "." + PseudoElementContainer.prototype.PSEUDO_HIDE_ELEMENT_CLASS_AFTER + ':after { content: "" !important; display: none !important; }');
};

NodeParser.prototype.disableAnimations = function(e) {
    this.createStyles(e, "* { -webkit-animation: none !important; -moz-animation: none !important; -o-animation: none !important; animation: none !important; " + "-webkit-transition: none !important; -moz-transition: none !important; -o-transition: none !important; transition: none !important;}");
};

NodeParser.prototype.createStyles = function(e, t) {
    var i = e.createElement("style");
    i.innerHTML = t;
    e.body.appendChild(i);
};

NodeParser.prototype.getPseudoElements = function(e) {
    var t = [ [ e ] ];
    if (e.node.nodeType === Node.ELEMENT_NODE) {
        var i = this.getPseudoElement(e, ":before");
        var n = this.getPseudoElement(e, ":after");
        if (i) {
            t.push(i);
        }
        if (n) {
            t.push(n);
        }
    }
    return flatten(t);
};

function toCamelCase(e) {
    return e.replace(/(\-[a-z])/g, function(e) {
        return e.toUpperCase().replace("-", "");
    });
}

NodeParser.prototype.getPseudoElement = function(e, t) {
    var i = e.computedStyle(t);
    if (!i || !i.content || i.content === "none" || i.content === "-moz-alt-content" || i.display === "none") {
        return null;
    }
    var n = stripQuotes(i.content);
    var r = n.substr(0, 3) === "url";
    var a = document.createElement(r ? "img" : "html2canvaspseudoelement");
    var o = new PseudoElementContainer(a, e, t);
    for (var s = i.length - 1; s >= 0; s--) {
        var l = toCamelCase(i.item(s));
        a.style[l] = i[l];
    }
    a.className = PseudoElementContainer.prototype.PSEUDO_HIDE_ELEMENT_CLASS_BEFORE + " " + PseudoElementContainer.prototype.PSEUDO_HIDE_ELEMENT_CLASS_AFTER;
    if (r) {
        a.src = parseBackgrounds(n)[0].args[0];
        return [ o ];
    } else {
        var c = document.createTextNode(n);
        a.appendChild(c);
        return [ o, new TextContainer(c, o) ];
    }
};

NodeParser.prototype.getChildren = function(e) {
    return flatten([].filter.call(e.node.childNodes, renderableNode).map(function(t) {
        var i = [ t.nodeType === Node.TEXT_NODE ? new TextContainer(t, e) : new NodeContainer(t, e) ].filter(nonIgnoredElement);
        return t.nodeType === Node.ELEMENT_NODE && i.length && t.tagName !== "TEXTAREA" ? i[0].isElementVisible() ? i.concat(this.getChildren(i[0])) : [] : i;
    }, this));
};

NodeParser.prototype.newStackingContext = function(e, t) {
    var i = new StackingContext(t, e.getOpacity(), e.node, e.parent);
    e.cloneTo(i);
    var n = t ? i.getParentStack(this) : i.parent.stack;
    n.contexts.push(i);
    e.stack = i;
};

NodeParser.prototype.createStackingContexts = function() {
    this.nodes.forEach(function(e) {
        if (isElement(e) && (this.isRootElement(e) || hasOpacity(e) || isPositionedForStacking(e) || this.isBodyWithTransparentRoot(e) || e.hasTransform())) {
            this.newStackingContext(e, true);
        } else if (isElement(e) && (isPositioned(e) && zIndex0(e) || isInlineBlock(e) || isFloating(e))) {
            this.newStackingContext(e, false);
        } else {
            e.assignStack(e.parent.stack);
        }
    }, this);
};

NodeParser.prototype.isBodyWithTransparentRoot = function(e) {
    return e.node.nodeName === "BODY" && this.renderer.isTransparent(e.parent.css("backgroundColor"));
};

NodeParser.prototype.isRootElement = function(e) {
    return e.parent === null;
};

NodeParser.prototype.sortStackingContexts = function(e) {
    e.contexts.sort(zIndexSort(e.contexts.slice(0)));
    e.contexts.forEach(this.sortStackingContexts, this);
};

NodeParser.prototype.parseTextBounds = function(e) {
    return function(t, i, n) {
        if (e.parent.css("textDecoration").substr(0, 4) !== "none" || t.trim().length !== 0) {
            if (this.support.rangeBounds && !e.parent.hasTransform()) {
                var r = n.slice(0, i).join("").length;
                return this.getRangeBounds(e.node, r, t.length);
            } else if (e.node && typeof e.node.data === "string") {
                var a = e.node.splitText(t.length);
                var o = this.getWrapperBounds(e.node, e.parent.hasTransform());
                e.node = a;
                return o;
            }
        } else if (!this.support.rangeBounds || e.parent.hasTransform()) {
            e.node = e.node.splitText(t.length);
        }
        return {};
    };
};

NodeParser.prototype.getWrapperBounds = function(e, t) {
    var i = e.ownerDocument.createElement("html2canvaswrapper");
    var n = e.parentNode, r = e.cloneNode(true);
    i.appendChild(e.cloneNode(true));
    n.replaceChild(i, e);
    var a = t ? offsetBounds(i) : getBounds(i);
    n.replaceChild(r, i);
    return a;
};

NodeParser.prototype.getRangeBounds = function(e, t, i) {
    var n = this.range || (this.range = e.ownerDocument.createRange());
    n.setStart(e, t);
    n.setEnd(e, t + i);
    return n.getBoundingClientRect();
};

function ClearTransform() {}

NodeParser.prototype.parse = function(e) {
    var t = e.contexts.filter(negativeZIndex);
    var i = e.children.filter(isElement);
    var n = i.filter(not(isFloating));
    var r = n.filter(not(isPositioned)).filter(not(inlineLevel));
    var a = i.filter(not(isPositioned)).filter(isFloating);
    var o = n.filter(not(isPositioned)).filter(inlineLevel);
    var s = e.contexts.concat(n.filter(isPositioned)).filter(zIndex0);
    var l = e.children.filter(isTextNode).filter(hasText);
    var c = e.contexts.filter(positiveZIndex);
    t.concat(r).concat(a).concat(o).concat(s).concat(l).concat(c).forEach(function(e) {
        this.renderQueue.push(e);
        if (isStackingContext(e)) {
            this.parse(e);
            this.renderQueue.push(new ClearTransform());
        }
    }, this);
};

NodeParser.prototype.paint = function(e) {
    try {
        if (e instanceof ClearTransform) {
            this.renderer.ctx.restore();
        } else if (isTextNode(e)) {
            if (isPseudoElement(e.parent)) {
                e.parent.appendToDOM();
            }
            this.paintText(e);
            if (isPseudoElement(e.parent)) {
                e.parent.cleanDOM();
            }
        } else {
            this.paintNode(e);
        }
    } catch (t) {
        log(t);
    }
};

NodeParser.prototype.paintNode = function(e) {
    if (isStackingContext(e)) {
        this.renderer.setOpacity(e.opacity);
        this.renderer.ctx.save();
        if (e.hasTransform()) {
            this.renderer.setTransform(e.parseTransform());
        }
    }
    if (e.node.nodeName === "INPUT" && e.node.type === "checkbox") {
        this.paintCheckbox(e);
    } else if (e.node.nodeName === "INPUT" && e.node.type === "radio") {
        this.paintRadio(e);
    } else {
        this.paintElement(e);
    }
};

NodeParser.prototype.paintElement = function(e) {
    var t = e.parseBounds();
    this.renderer.clip(e.backgroundClip, function() {
        this.renderer.renderBackground(e, t, e.borders.borders.map(getWidth));
    }, this);
    this.renderer.clip(e.clip, function() {
        this.renderer.renderBorders(e.borders.borders);
    }, this);
    this.renderer.clip(e.backgroundClip, function() {
        switch (e.node.nodeName) {
          case "svg":
          case "IFRAME":
            var i = this.images.get(e.node);
            if (i) {
                this.renderer.renderImage(e, t, e.borders, i);
            } else {
                log("Error loading <" + e.node.nodeName + ">", e.node);
            }
            break;

          case "IMG":
            var n = this.images.get(e.node.src);
            if (n) {
                this.renderer.renderImage(e, t, e.borders, n);
            } else {
                log("Error loading <img>", e.node.src);
            }
            break;

          case "CANVAS":
            this.renderer.renderImage(e, t, e.borders, {
                image: e.node
            });
            break;

          case "SELECT":
          case "INPUT":
          case "TEXTAREA":
            this.paintFormValue(e);
            break;
        }
    }, this);
};

NodeParser.prototype.paintCheckbox = function(e) {
    var t = e.parseBounds();
    var i = Math.min(t.width, t.height);
    var n = {
        width: i - 1,
        height: i - 1,
        top: t.top,
        left: t.left
    };
    var r = [ 3, 3 ];
    var a = [ r, r, r, r ];
    var o = [ 1, 1, 1, 1 ].map(function(e) {
        return {
            color: "#A5A5A5",
            width: e
        };
    });
    var s = calculateCurvePoints(n, a, o);
    this.renderer.clip(e.backgroundClip, function() {
        this.renderer.rectangle(n.left + 1, n.top + 1, n.width - 2, n.height - 2, "#DEDEDE");
        this.renderer.renderBorders(calculateBorders(o, n, s, a));
        if (e.node.checked) {
            this.renderer.font("#424242", "normal", "normal", "bold", i - 3 + "px", "arial");
            this.renderer.text("", n.left + i / 6, n.top + i - 1);
        }
    }, this);
};

NodeParser.prototype.paintRadio = function(e) {
    var t = e.parseBounds();
    var i = Math.min(t.width, t.height) - 2;
    this.renderer.clip(e.backgroundClip, function() {
        this.renderer.circleStroke(t.left + 1, t.top + 1, i, "#DEDEDE", 1, "#A5A5A5");
        if (e.node.checked) {
            this.renderer.circle(Math.ceil(t.left + i / 4) + 1, Math.ceil(t.top + i / 4) + 1, Math.floor(i / 2), "#424242");
        }
    }, this);
};

NodeParser.prototype.paintFormValue = function(e) {
    if (e.getValue().length > 0) {
        var t = e.node.ownerDocument;
        var i = t.createElement("html2canvaswrapper");
        var n = [ "lineHeight", "textAlign", "fontFamily", "fontWeight", "fontSize", "color", "paddingLeft", "paddingTop", "paddingRight", "paddingBottom", "width", "height", "borderLeftStyle", "borderTopStyle", "borderLeftWidth", "borderTopWidth", "boxSizing", "whiteSpace", "wordWrap", "list-style-type" ];
        n.forEach(function(t) {
            try {
                i.style[t] = e.css(t);
            } catch (n) {
                log("html2canvas: Parse: Exception caught in renderFormValue: " + n.message);
            }
        });
        var r = e.parseBounds();
        i.style.position = "fixed";
        i.style.left = r.left + "px";
        i.style.top = r.top + "px";
        i.textContent = e.getValue();
        t.body.appendChild(i);
        this.paintText(new TextContainer(i.firstChild, e));
        t.body.removeChild(i);
    }
};

NodeParser.prototype.paintText = function(e) {
    e.applyTextTransform();
    var t = window.html2canvas.punycode.ucs2.decode(e.node.data);
    var i = (!this.options.letterRendering || noLetterSpacing(e)) && !hasUnicode(e.node.data) ? getWords(t) : t.map(function(e) {
        return window.html2canvas.punycode.ucs2.encode([ e ]);
    });
    var n = e.parent.fontWeight();
    var r = e.parent.css("fontSize");
    var a = e.parent.css("fontFamily");
    var o = e.parent.parseTextShadows();
    this.renderer.font(e.parent.css("color"), e.parent.css("fontStyle"), e.parent.css("fontVariant"), n, r, a);
    if (o.length) {
        this.renderer.fontShadow(o[0].color, o[0].offsetX, o[0].offsetY, o[0].blur);
    } else {
        this.renderer.clearShadow();
    }
    this.renderer.clip(e.parent.clip, function() {
        i.map(this.parseTextBounds(e), this).forEach(function(t, n) {
            if (t) {
                this.renderer.text(i[n], t.left, t.bottom);
                this.renderTextDecoration(e.parent, t, this.fontMetrics.getMetrics(a, r));
            }
        }, this);
    }, this);
};

NodeParser.prototype.renderTextDecoration = function(e, t, i) {
    switch (e.css("textDecoration").split(" ")[0]) {
      case "underline":
        this.renderer.rectangle(t.left, Math.round(t.top + i.baseline + i.lineWidth), t.width, 1, e.css("color"));
        break;

      case "overline":
        this.renderer.rectangle(t.left, Math.round(t.top), t.width, 1, e.css("color"));
        break;

      case "line-through":
        this.renderer.rectangle(t.left, Math.ceil(t.top + i.middle + i.lineWidth), t.width, 1, e.css("color"));
        break;
    }
};

NodeParser.prototype.parseBorders = function(e) {
    var t = e.parseBounds();
    var i = getBorderRadiusData(e);
    var n = [ "Top", "Right", "Bottom", "Left" ].map(function(t) {
        return {
            width: e.cssInt("border" + t + "Width"),
            color: e.css("border" + t + "Color"),
            args: null
        };
    });
    var r = calculateCurvePoints(t, i, n);
    return {
        clip: this.parseBackgroundClip(e, r, n, i, t),
        borders: calculateBorders(n, t, r, i)
    };
};

function calculateBorders(e, t, i, n) {
    return e.map(function(r, a) {
        if (r.width > 0) {
            var o = t.left;
            var s = t.top;
            var l = t.width;
            var c = t.height - e[2].width;
            switch (a) {
              case 0:
                c = e[0].width;
                r.args = drawSide({
                    c1: [ o, s ],
                    c2: [ o + l, s ],
                    c3: [ o + l - e[1].width, s + c ],
                    c4: [ o + e[3].width, s + c ]
                }, n[0], n[1], i.topLeftOuter, i.topLeftInner, i.topRightOuter, i.topRightInner);
                break;

              case 1:
                o = t.left + t.width - e[1].width;
                l = e[1].width;
                r.args = drawSide({
                    c1: [ o + l, s ],
                    c2: [ o + l, s + c + e[2].width ],
                    c3: [ o, s + c ],
                    c4: [ o, s + e[0].width ]
                }, n[1], n[2], i.topRightOuter, i.topRightInner, i.bottomRightOuter, i.bottomRightInner);
                break;

              case 2:
                s = s + t.height - e[2].width;
                c = e[2].width;
                r.args = drawSide({
                    c1: [ o + l, s + c ],
                    c2: [ o, s + c ],
                    c3: [ o + e[3].width, s ],
                    c4: [ o + l - e[3].width, s ]
                }, n[2], n[3], i.bottomRightOuter, i.bottomRightInner, i.bottomLeftOuter, i.bottomLeftInner);
                break;

              case 3:
                l = e[3].width;
                r.args = drawSide({
                    c1: [ o, s + c + e[2].width ],
                    c2: [ o, s ],
                    c3: [ o + l, s + e[0].width ],
                    c4: [ o + l, s + c ]
                }, n[3], n[0], i.bottomLeftOuter, i.bottomLeftInner, i.topLeftOuter, i.topLeftInner);
                break;
            }
        }
        return r;
    });
}

NodeParser.prototype.parseBackgroundClip = function(e, t, i, n, r) {
    var a = e.css("backgroundClip"), o = [];
    switch (a) {
      case "content-box":
      case "padding-box":
        parseCorner(o, n[0], n[1], t.topLeftInner, t.topRightInner, r.left + i[3].width, r.top + i[0].width);
        parseCorner(o, n[1], n[2], t.topRightInner, t.bottomRightInner, r.left + r.width - i[1].width, r.top + i[0].width);
        parseCorner(o, n[2], n[3], t.bottomRightInner, t.bottomLeftInner, r.left + r.width - i[1].width, r.top + r.height - i[2].width);
        parseCorner(o, n[3], n[0], t.bottomLeftInner, t.topLeftInner, r.left + i[3].width, r.top + r.height - i[2].width);
        break;

      default:
        parseCorner(o, n[0], n[1], t.topLeftOuter, t.topRightOuter, r.left, r.top);
        parseCorner(o, n[1], n[2], t.topRightOuter, t.bottomRightOuter, r.left + r.width, r.top);
        parseCorner(o, n[2], n[3], t.bottomRightOuter, t.bottomLeftOuter, r.left + r.width, r.top + r.height);
        parseCorner(o, n[3], n[0], t.bottomLeftOuter, t.topLeftOuter, r.left, r.top + r.height);
        break;
    }
    return o;
};

function getCurvePoints(e, t, i, n) {
    var r = 4 * ((Math.sqrt(2) - 1) / 3);
    var a = i * r, o = n * r, s = e + i, l = t + n;
    return {
        topLeft: bezierCurve({
            x: e,
            y: l
        }, {
            x: e,
            y: l - o
        }, {
            x: s - a,
            y: t
        }, {
            x: s,
            y: t
        }),
        topRight: bezierCurve({
            x: e,
            y: t
        }, {
            x: e + a,
            y: t
        }, {
            x: s,
            y: l - o
        }, {
            x: s,
            y: l
        }),
        bottomRight: bezierCurve({
            x: s,
            y: t
        }, {
            x: s,
            y: t + o
        }, {
            x: e + a,
            y: l
        }, {
            x: e,
            y: l
        }),
        bottomLeft: bezierCurve({
            x: s,
            y: l
        }, {
            x: s - a,
            y: l
        }, {
            x: e,
            y: t + o
        }, {
            x: e,
            y: t
        })
    };
}

function calculateCurvePoints(e, t, i) {
    var n = e.left, r = e.top, a = e.width, o = e.height, s = t[0][0], l = t[0][1], c = t[1][0], u = t[1][1], f = t[2][0], d = t[2][1], h = t[3][0], p = t[3][1];
    var g = a - c, m = o - d, v = a - f, y = o - p;
    return {
        topLeftOuter: getCurvePoints(n, r, s, l).topLeft.subdivide(.5),
        topLeftInner: getCurvePoints(n + i[3].width, r + i[0].width, Math.max(0, s - i[3].width), Math.max(0, l - i[0].width)).topLeft.subdivide(.5),
        topRightOuter: getCurvePoints(n + g, r, c, u).topRight.subdivide(.5),
        topRightInner: getCurvePoints(n + Math.min(g, a + i[3].width), r + i[0].width, g > a + i[3].width ? 0 : c - i[3].width, u - i[0].width).topRight.subdivide(.5),
        bottomRightOuter: getCurvePoints(n + v, r + m, f, d).bottomRight.subdivide(.5),
        bottomRightInner: getCurvePoints(n + Math.min(v, a - i[3].width), r + Math.min(m, o + i[0].width), Math.max(0, f - i[1].width), d - i[2].width).bottomRight.subdivide(.5),
        bottomLeftOuter: getCurvePoints(n, r + y, h, p).bottomLeft.subdivide(.5),
        bottomLeftInner: getCurvePoints(n + i[3].width, r + y, Math.max(0, h - i[3].width), p - i[2].width).bottomLeft.subdivide(.5)
    };
}

function bezierCurve(e, t, i, n) {
    var r = function(e, t, i) {
        return {
            x: e.x + (t.x - e.x) * i,
            y: e.y + (t.y - e.y) * i
        };
    };
    return {
        start: e,
        startControl: t,
        endControl: i,
        end: n,
        subdivide: function(a) {
            var o = r(e, t, a), s = r(t, i, a), l = r(i, n, a), c = r(o, s, a), u = r(s, l, a), f = r(c, u, a);
            return [ bezierCurve(e, o, c, f), bezierCurve(f, u, l, n) ];
        },
        curveTo: function(e) {
            e.push([ "bezierCurve", t.x, t.y, i.x, i.y, n.x, n.y ]);
        },
        curveToReversed: function(n) {
            n.push([ "bezierCurve", i.x, i.y, t.x, t.y, e.x, e.y ]);
        }
    };
}

function drawSide(e, t, i, n, r, a, o) {
    var s = [];
    if (t[0] > 0 || t[1] > 0) {
        s.push([ "line", n[1].start.x, n[1].start.y ]);
        n[1].curveTo(s);
    } else {
        s.push([ "line", e.c1[0], e.c1[1] ]);
    }
    if (i[0] > 0 || i[1] > 0) {
        s.push([ "line", a[0].start.x, a[0].start.y ]);
        a[0].curveTo(s);
        s.push([ "line", o[0].end.x, o[0].end.y ]);
        o[0].curveToReversed(s);
    } else {
        s.push([ "line", e.c2[0], e.c2[1] ]);
        s.push([ "line", e.c3[0], e.c3[1] ]);
    }
    if (t[0] > 0 || t[1] > 0) {
        s.push([ "line", r[1].end.x, r[1].end.y ]);
        r[1].curveToReversed(s);
    } else {
        s.push([ "line", e.c4[0], e.c4[1] ]);
    }
    return s;
}

function parseCorner(e, t, i, n, r, a, o) {
    if (t[0] > 0 || t[1] > 0) {
        e.push([ "line", n[0].start.x, n[0].start.y ]);
        n[0].curveTo(e);
        n[1].curveTo(e);
    } else {
        e.push([ "line", a, o ]);
    }
    if (i[0] > 0 || i[1] > 0) {
        e.push([ "line", r[0].start.x, r[0].start.y ]);
    }
}

function negativeZIndex(e) {
    return e.cssInt("zIndex") < 0;
}

function positiveZIndex(e) {
    return e.cssInt("zIndex") > 0;
}

function zIndex0(e) {
    return e.cssInt("zIndex") === 0;
}

function inlineLevel(e) {
    return [ "inline", "inline-block", "inline-table" ].indexOf(e.css("display")) !== -1;
}

function isStackingContext(e) {
    return e instanceof StackingContext;
}

function hasText(e) {
    return e.node.data.trim().length > 0;
}

function noLetterSpacing(e) {
    return /^(normal|none|0px)$/.test(e.parent.css("letterSpacing"));
}

function getBorderRadiusData(e) {
    return [ "TopLeft", "TopRight", "BottomRight", "BottomLeft" ].map(function(t) {
        var i = e.css("border" + t + "Radius");
        var n = i.split(" ");
        if (n.length <= 1) {
            n[1] = n[0];
        }
        return n.map(asInt);
    });
}

function renderableNode(e) {
    return e.nodeType === Node.TEXT_NODE || e.nodeType === Node.ELEMENT_NODE;
}

function isPositionedForStacking(e) {
    var t = e.css("position");
    var i = [ "absolute", "relative", "fixed" ].indexOf(t) !== -1 ? e.css("zIndex") : "auto";
    return i !== "auto";
}

function isPositioned(e) {
    return e.css("position") !== "static";
}

function isFloating(e) {
    return e.css("float") !== "none";
}

function isInlineBlock(e) {
    return [ "inline-block", "inline-table" ].indexOf(e.css("display")) !== -1;
}

function not(e) {
    var t = this;
    return function() {
        return !e.apply(t, arguments);
    };
}

function isElement(e) {
    return e.node.nodeType === Node.ELEMENT_NODE;
}

function isPseudoElement(e) {
    return e.isPseudoElement === true;
}

function isTextNode(e) {
    return e.node.nodeType === Node.TEXT_NODE;
}

function zIndexSort(e) {
    return function(t, i) {
        return t.cssInt("zIndex") + e.indexOf(t) / e.length - (i.cssInt("zIndex") + e.indexOf(i) / e.length);
    };
}

function hasOpacity(e) {
    return e.getOpacity() < 1;
}

function bind(e, t) {
    return function() {
        return e.apply(t, arguments);
    };
}

function asInt(e) {
    return parseInt(e, 10);
}

function getWidth(e) {
    return e.width;
}

function nonIgnoredElement(e) {
    return e.node.nodeType !== Node.ELEMENT_NODE || [ "SCRIPT", "HEAD", "TITLE", "OBJECT", "BR", "OPTION" ].indexOf(e.node.nodeName) === -1;
}

function flatten(e) {
    return [].concat.apply([], e);
}

function stripQuotes(e) {
    var t = e.substr(0, 1);
    return t === e.substr(e.length - 1) && t.match(/'|"/) ? e.substr(1, e.length - 2) : e;
}

function getWords(e) {
    var t = [], i = 0, n = false, r;
    while (e.length) {
        if (isWordBoundary(e[i]) === n) {
            r = e.splice(0, i);
            if (r.length) {
                t.push(window.html2canvas.punycode.ucs2.encode(r));
            }
            n = !n;
            i = 0;
        } else {
            i++;
        }
        if (i >= e.length) {
            r = e.splice(0, i);
            if (r.length) {
                t.push(window.html2canvas.punycode.ucs2.encode(r));
            }
        }
    }
    return t;
}

function isWordBoundary(e) {
    return [ 32, 13, 10, 9, 45 ].indexOf(e) !== -1;
}

function hasUnicode(e) {
    return /[^\u0000-\u00ff]/.test(e);
}

!function() {
    var e, t, i, n;
    !function() {
        var r = {}, a = {};
        e = function(e, t, i) {
            r[e] = {
                deps: t,
                callback: i
            };
        }, n = i = t = function(e) {
            function i(t) {
                if ("." !== t.charAt(0)) return t;
                for (var i = t.split("/"), n = e.split("/").slice(0, -1), r = 0, a = i.length; a > r; r++) {
                    var o = i[r];
                    if (".." === o) n.pop(); else {
                        if ("." === o) continue;
                        n.push(o);
                    }
                }
                return n.join("/");
            }
            if (n._eak_seen = r, a[e]) return a[e];
            if (a[e] = {}, !r[e]) throw new Error("Could not find module " + e);
            for (var o, s = r[e], l = s.deps, c = s.callback, u = [], f = 0, d = l.length; d > f; f++) "exports" === l[f] ? u.push(o = {}) : u.push(t(i(l[f])));
            var h = c.apply(this, u);
            return a[e] = o || h;
        };
    }(), e("promise/all", [ "./utils", "exports" ], function(e, t) {
        function i(e) {
            var t = this;
            if (!n(e)) throw new TypeError("You must pass an array to all.");
            return new t(function(t, i) {
                function n(e) {
                    return function(t) {
                        a(e, t);
                    };
                }
                function a(e, i) {
                    s[e] = i, 0 === --l && t(s);
                }
                var o, s = [], l = e.length;
                0 === l && t([]);
                for (var c = 0; c < e.length; c++) o = e[c], o && r(o.then) ? o.then(n(c), i) : a(c, o);
            });
        }
        var n = e.isArray, r = e.isFunction;
        t.all = i;
    }), e("promise/asap", [ "exports" ], function(e) {
        function t() {
            return function() {
                process.nextTick(r);
            };
        }
        function i() {
            var e = 0, t = new l(r), i = document.createTextNode("");
            return t.observe(i, {
                characterData: !0
            }), function() {
                i.data = e = ++e % 2;
            };
        }
        function n() {
            return function() {
                c.setTimeout(r, 1);
            };
        }
        function r() {
            for (var e = 0; e < u.length; e++) {
                var t = u[e], i = t[0], n = t[1];
                i(n);
            }
            u = [];
        }
        function a(e, t) {
            var i = u.push([ e, t ]);
            1 === i && o();
        }
        var o, s = "undefined" != typeof window ? window : {}, l = s.MutationObserver || s.WebKitMutationObserver, c = "undefined" != typeof global ? global : this, u = [];
        o = "undefined" != typeof process && "[object process]" === {}.toString.call(process) ? t() : l ? i() : n(), 
        e.asap = a;
    }), e("promise/cast", [ "exports" ], function(e) {
        function t(e) {
            if (e && "object" == typeof e && e.constructor === this) return e;
            var t = this;
            return new t(function(t) {
                t(e);
            });
        }
        e.cast = t;
    }), e("promise/config", [ "exports" ], function(e) {
        function t(e, t) {
            return 2 !== arguments.length ? i[e] : (i[e] = t, void 0);
        }
        var i = {
            instrument: !1
        };
        e.config = i, e.configure = t;
    }), e("promise/polyfill", [ "./promise", "./utils", "exports" ], function(e, t, i) {
        function n() {
            var e = "Promise" in window && "cast" in window.Promise && "resolve" in window.Promise && "reject" in window.Promise && "all" in window.Promise && "race" in window.Promise && function() {
                var e;
                return new window.Promise(function(t) {
                    e = t;
                }), a(e);
            }();
            e || (window.Promise = r);
        }
        var r = e.Promise, a = t.isFunction;
        i.polyfill = n;
    }), e("promise/promise", [ "./config", "./utils", "./cast", "./all", "./race", "./resolve", "./reject", "./asap", "exports" ], function(e, t, i, n, r, a, o, s, l) {
        function c(e) {
            if (!x(e)) throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");
            if (!(this instanceof c)) throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");
            this._subscribers = [], u(e, this);
        }
        function u(e, t) {
            function i(e) {
                g(t, e);
            }
            function n(e) {
                v(t, e);
            }
            try {
                e(i, n);
            } catch (r) {
                n(r);
            }
        }
        function f(e, t, i, n) {
            var r, a, o, s, l = x(i);
            if (l) try {
                r = i(n), o = !0;
            } catch (c) {
                s = !0, a = c;
            } else r = n, o = !0;
            p(t, r) || (l && o ? g(t, r) : s ? v(t, a) : e === O ? g(t, r) : e === D && v(t, r));
        }
        function d(e, t, i, n) {
            var r = e._subscribers, a = r.length;
            r[a] = t, r[a + O] = i, r[a + D] = n;
        }
        function h(e, t) {
            for (var i, n, r = e._subscribers, a = e._detail, o = 0; o < r.length; o += 3) i = r[o], 
            n = r[o + t], f(t, i, n, a);
            e._subscribers = null;
        }
        function p(e, t) {
            var i, n = null;
            try {
                if (e === t) throw new TypeError("A promises callback cannot return that same promise.");
                if (C(t) && (n = t.then, x(n))) return n.call(t, function(n) {
                    return i ? !0 : (i = !0, t !== n ? g(e, n) : m(e, n), void 0);
                }, function(t) {
                    return i ? !0 : (i = !0, v(e, t), void 0);
                }), !0;
            } catch (r) {
                return i ? !0 : (v(e, r), !0);
            }
            return !1;
        }
        function g(e, t) {
            e === t ? m(e, t) : p(e, t) || m(e, t);
        }
        function m(e, t) {
            e._state === P && (e._state = I, e._detail = t, w.async(y, e));
        }
        function v(e, t) {
            e._state === P && (e._state = I, e._detail = t, w.async(b, e));
        }
        function y(e) {
            h(e, e._state = O);
        }
        function b(e) {
            h(e, e._state = D);
        }
        var w = e.config, C = (e.configure, t.objectOrFunction), x = t.isFunction, _ = (t.now, 
        i.cast), S = n.all, k = r.race, A = a.resolve, E = o.reject, T = s.asap;
        w.async = T;
        var P = void 0, I = 0, O = 1, D = 2;
        c.prototype = {
            constructor: c,
            _state: void 0,
            _detail: void 0,
            _subscribers: void 0,
            then: function(e, t) {
                var i = this, n = new this.constructor(function() {});
                if (this._state) {
                    var r = arguments;
                    w.async(function() {
                        f(i._state, n, r[i._state - 1], i._detail);
                    });
                } else d(this, n, e, t);
                return n;
            },
            "catch": function(e) {
                return this.then(null, e);
            }
        }, c.all = S, c.cast = _, c.race = k, c.resolve = A, c.reject = E, l.Promise = c;
    }), e("promise/race", [ "./utils", "exports" ], function(e, t) {
        function i(e) {
            var t = this;
            if (!n(e)) throw new TypeError("You must pass an array to race.");
            return new t(function(t, i) {
                for (var n, r = 0; r < e.length; r++) n = e[r], n && "function" == typeof n.then ? n.then(t, i) : t(n);
            });
        }
        var n = e.isArray;
        t.race = i;
    }), e("promise/reject", [ "exports" ], function(e) {
        function t(e) {
            var t = this;
            return new t(function(t, i) {
                i(e);
            });
        }
        e.reject = t;
    }), e("promise/resolve", [ "exports" ], function(e) {
        function t(e) {
            var t = this;
            return new t(function(t) {
                t(e);
            });
        }
        e.resolve = t;
    }), e("promise/utils", [ "exports" ], function(e) {
        function t(e) {
            return i(e) || "object" == typeof e && null !== e;
        }
        function i(e) {
            return "function" == typeof e;
        }
        function n(e) {
            return "[object Array]" === Object.prototype.toString.call(e);
        }
        var r = Date.now || function() {
            return new Date().getTime();
        };
        e.objectOrFunction = t, e.isFunction = i, e.isArray = n, e.now = r;
    }), t("promise/polyfill").polyfill();
}();

function Proxy(e, t, i) {
    var n = createCallback(supportsCORS);
    var r = createProxyUrl(t, e, n);
    return supportsCORS ? XHR(r) : jsonp(i, r, n).then(function(e) {
        return decode64(e.content);
    });
}

var proxyCount = 0;

var supportsCORS = "withCredentials" in new XMLHttpRequest();

var supportsCORSImage = "crossOrigin" in new Image();

function ProxyURL(e, t, i) {
    var n = createCallback(supportsCORSImage);
    var r = createProxyUrl(t, e, n);
    return supportsCORSImage ? Promise.resolve(r) : jsonp(i, r, n).then(function(e) {
        return "data:" + e.type + ";base64," + e.content;
    });
}

function jsonp(e, t, i) {
    return new Promise(function(n, r) {
        var a = e.createElement("script");
        var o = function() {
            delete window.html2canvas.proxy[i];
            e.body.removeChild(a);
        };
        window.html2canvas.proxy[i] = function(e) {
            o();
            n(e);
        };
        a.src = t;
        a.onerror = function(e) {
            o();
            r(e);
        };
        e.body.appendChild(a);
    });
}

function createCallback(e) {
    return !e ? "html2canvas_" + Date.now() + "_" + ++proxyCount + "_" + Math.round(Math.random() * 1e5) : "";
}

function createProxyUrl(e, t, i) {
    return e + "?url=" + encodeURIComponent(t) + (i.length ? "&callback=html2canvas.proxy." + i : "");
}

function ProxyImageContainer(e, t) {
    var i = document.createElement("script");
    var n = document.createElement("a");
    n.href = e;
    e = n.href;
    this.src = e;
    this.image = new Image();
    var r = this;
    this.promise = new Promise(function(i, n) {
        r.image.crossOrigin = "Anonymous";
        r.image.onload = i;
        r.image.onerror = n;
        new ProxyURL(e, t, document).then(function(e) {
            r.image.src = e;
        })["catch"](n);
    });
}

function PseudoElementContainer(e, t, i) {
    NodeContainer.call(this, e, t);
    this.isPseudoElement = true;
    this.before = i === ":before";
}

PseudoElementContainer.prototype.cloneTo = function(e) {
    PseudoElementContainer.prototype.cloneTo.call(this, e);
    e.isPseudoElement = true;
    e.before = this.before;
};

PseudoElementContainer.prototype = Object.create(NodeContainer.prototype);

PseudoElementContainer.prototype.appendToDOM = function() {
    if (this.before) {
        this.parent.node.insertBefore(this.node, this.parent.node.firstChild);
    } else {
        this.parent.node.appendChild(this.node);
    }
    this.parent.node.className += " " + this.getHideClass();
};

PseudoElementContainer.prototype.cleanDOM = function() {
    this.node.parentNode.removeChild(this.node);
    this.parent.node.className = this.parent.node.className.replace(this.getHideClass(), "");
};

PseudoElementContainer.prototype.getHideClass = function() {
    return this["PSEUDO_HIDE_ELEMENT_CLASS_" + (this.before ? "BEFORE" : "AFTER")];
};

PseudoElementContainer.prototype.PSEUDO_HIDE_ELEMENT_CLASS_BEFORE = "___html2canvas___pseudoelement_before";

PseudoElementContainer.prototype.PSEUDO_HIDE_ELEMENT_CLASS_AFTER = "___html2canvas___pseudoelement_after";

function Renderer(e, t, i, n, r) {
    this.width = e;
    this.height = t;
    this.images = i;
    this.options = n;
    this.document = r;
}

Renderer.prototype.renderImage = function(e, t, i, n) {
    var r = e.cssInt("paddingLeft"), a = e.cssInt("paddingTop"), o = e.cssInt("paddingRight"), s = e.cssInt("paddingBottom"), l = i.borders;
    var c = t.width - (l[1].width + l[3].width + r + o);
    var u = t.height - (l[0].width + l[2].width + a + s);
    this.drawImage(n, 0, 0, n.image.width || c, n.image.height || u, t.left + r + l[3].width, t.top + a + l[0].width, c, u);
};

Renderer.prototype.renderBackground = function(e, t, i) {
    if (t.height > 0 && t.width > 0) {
        this.renderBackgroundColor(e, t);
        this.renderBackgroundImage(e, t, i);
    }
};

Renderer.prototype.renderBackgroundColor = function(e, t) {
    var i = e.css("backgroundColor");
    if (!this.isTransparent(i)) {
        this.rectangle(t.left, t.top, t.width, t.height, e.css("backgroundColor"));
    }
};

Renderer.prototype.renderBorders = function(e) {
    e.forEach(this.renderBorder, this);
};

Renderer.prototype.renderBorder = function(e) {
    if (!this.isTransparent(e.color) && e.args !== null) {
        this.drawShape(e.args, e.color);
    }
};

Renderer.prototype.renderBackgroundImage = function(e, t, i) {
    var n = e.parseBackgroundImages();
    n.reverse().forEach(function(n, r, a) {
        switch (n.method) {
          case "url":
            var o = this.images.get(n.args[0]);
            if (o) {
                this.renderBackgroundRepeating(e, t, o, a.length - (r + 1), i);
            } else {
                log("Error loading background-image", n.args[0]);
            }
            break;

          case "linear-gradient":
          case "gradient":
            var s = this.images.get(n.value);
            if (s) {
                this.renderBackgroundGradient(s, t, i);
            } else {
                log("Error loading background-image", n.args[0]);
            }
            break;

          case "none":
            break;

          default:
            log("Unknown background-image type", n.args[0]);
        }
    }, this);
};

Renderer.prototype.renderBackgroundRepeating = function(e, t, i, n, r) {
    var a = e.parseBackgroundSize(t, i.image, n);
    var o = e.parseBackgroundPosition(t, i.image, n, a);
    var s = e.parseBackgroundRepeat(n);
    switch (s) {
      case "repeat-x":
      case "repeat no-repeat":
        this.backgroundRepeatShape(i, o, a, t, t.left + r[3], t.top + o.top + r[0], 99999, a.height, r);
        break;

      case "repeat-y":
      case "no-repeat repeat":
        this.backgroundRepeatShape(i, o, a, t, t.left + o.left + r[3], t.top + r[0], a.width, 99999, r);
        break;

      case "no-repeat":
        this.backgroundRepeatShape(i, o, a, t, t.left + o.left + r[3], t.top + o.top + r[0], a.width, a.height, r);
        break;

      default:
        this.renderBackgroundRepeat(i, o, a, {
            top: t.top,
            left: t.left
        }, r[3], r[0]);
        break;
    }
};

Renderer.prototype.isTransparent = function(e) {
    return !e || e === "transparent" || e === "rgba(0, 0, 0, 0)";
};

function StackingContext(e, t, i, n) {
    NodeContainer.call(this, i, n);
    this.ownStacking = e;
    this.contexts = [];
    this.children = [];
    this.opacity = (this.parent ? this.parent.stack.opacity : 1) * t;
}

StackingContext.prototype = Object.create(NodeContainer.prototype);

StackingContext.prototype.getParentStack = function(e) {
    var t = this.parent ? this.parent.stack : null;
    return t ? t.ownStacking ? t : t.getParentStack(e) : e.stack;
};

function Support(e) {
    this.rangeBounds = this.testRangeBounds(e);
    this.cors = this.testCORS();
    this.svg = this.testSVG();
}

Support.prototype.testRangeBounds = function(e) {
    var t, i, n, r, a = false;
    if (e.createRange) {
        t = e.createRange();
        if (t.getBoundingClientRect) {
            i = e.createElement("boundtest");
            i.style.height = "123px";
            i.style.display = "block";
            e.body.appendChild(i);
            t.selectNode(i);
            n = t.getBoundingClientRect();
            r = n.height;
            if (r === 123) {
                a = true;
            }
            e.body.removeChild(i);
        }
    }
    return a;
};

Support.prototype.testCORS = function() {
    return typeof new Image().crossOrigin !== "undefined";
};

Support.prototype.testSVG = function() {
    var e = new Image();
    var t = document.createElement("canvas");
    var i = t.getContext("2d");
    e.src = "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";
    try {
        i.drawImage(e, 0, 0);
        t.toDataURL();
    } catch (n) {
        return false;
    }
    return true;
};

function SVGContainer(e) {
    this.src = e;
    this.image = null;
    var t = this;
    this.promise = this.hasFabric().then(function() {
        return t.isInline(e) ? Promise.resolve(t.inlineFormatting(e)) : XHR(e);
    }).then(function(e) {
        return new Promise(function(i) {
            html2canvas.fabric.loadSVGFromString(e, t.createCanvas.call(t, i));
        });
    });
}

SVGContainer.prototype.hasFabric = function() {
    return !html2canvas.fabric ? Promise.reject(new Error("html2canvas.svg.js is not loaded, cannot render svg")) : Promise.resolve();
};

SVGContainer.prototype.inlineFormatting = function(e) {
    return /^data:image\/svg\+xml;base64,/.test(e) ? this.decode64(this.removeContentType(e)) : this.removeContentType(e);
};

SVGContainer.prototype.removeContentType = function(e) {
    return e.replace(/^data:image\/svg\+xml(;base64)?,/, "");
};

SVGContainer.prototype.isInline = function(e) {
    return /^data:image\/svg\+xml/i.test(e);
};

SVGContainer.prototype.createCanvas = function(e) {
    var t = this;
    return function(i, n) {
        var r = new html2canvas.fabric.StaticCanvas("c");
        t.image = r.lowerCanvasEl;
        r.setWidth(n.width).setHeight(n.height).add(html2canvas.fabric.util.groupSVGElements(i, n)).renderAll();
        e(r.lowerCanvasEl);
    };
};

SVGContainer.prototype.decode64 = function(e) {
    return typeof window.atob === "function" ? window.atob(e) : decode64(e);
};

function decode64(e) {
    var t = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
    var i = e.length, n, r, a, o, s, l, c, u;
    var f = "";
    for (n = 0; n < i; n += 4) {
        r = t.indexOf(e[n]);
        a = t.indexOf(e[n + 1]);
        o = t.indexOf(e[n + 2]);
        s = t.indexOf(e[n + 3]);
        l = r << 2 | a >> 4;
        c = (a & 15) << 4 | o >> 2;
        u = (o & 3) << 6 | s;
        if (o === 64) {
            f += String.fromCharCode(l);
        } else if (s === 64 || s === -1) {
            f += String.fromCharCode(l, c);
        } else {
            f += String.fromCharCode(l, c, u);
        }
    }
    return f;
}

function SVGNodeContainer(e, t) {
    this.src = e;
    this.image = null;
    var i = this;
    this.promise = t ? new Promise(function(t, n) {
        i.image = new Image();
        i.image.onload = t;
        i.image.onerror = n;
        i.image.src = "data:image/svg+xml," + new XMLSerializer().serializeToString(e);
        if (i.image.complete === true) {
            t(i.image);
        }
    }) : this.hasFabric().then(function() {
        return new Promise(function(t) {
            html2canvas.fabric.parseSVGDocument(e, i.createCanvas.call(i, t));
        });
    });
}

SVGNodeContainer.prototype = Object.create(SVGContainer.prototype);

function TextContainer(e, t) {
    NodeContainer.call(this, e, t);
}

TextContainer.prototype = Object.create(NodeContainer.prototype);

TextContainer.prototype.applyTextTransform = function() {
    this.node.data = this.transform(this.parent.css("textTransform"));
};

TextContainer.prototype.transform = function(e) {
    var t = this.node.data;
    switch (e) {
      case "lowercase":
        return t.toLowerCase();

      case "capitalize":
        return t.replace(/(^|\s|:|-|\(|\))([a-z])/g, capitalize);

      case "uppercase":
        return t.toUpperCase();

      default:
        return t;
    }
};

function capitalize(e, t, i) {
    if (e.length > 0) {
        return t + i.toUpperCase();
    }
}

function WebkitGradientContainer(e) {
    GradientContainer.apply(this, arguments);
    this.type = e.args[0] === "linear" ? this.TYPES.LINEAR : this.TYPES.RADIAL;
}

WebkitGradientContainer.prototype = Object.create(GradientContainer.prototype);

function XHR(e) {
    return new Promise(function(t, i) {
        var n = new XMLHttpRequest();
        n.open("GET", e);
        n.onload = function() {
            if (n.status === 200) {
                t(n.responseText);
            } else {
                i(new Error(n.statusText));
            }
        };
        n.onerror = function() {
            i(new Error("Network Error"));
        };
        n.send();
    });
}

function html2pdf(e, t, i) {
    var n = t.canvas;
    if (!n) {
        alert("jsPDF canvas plugin not installed");
        return;
    }
    n.pdf = t;
    t.annotations = {
        _nameMap: [],
        createAnnotation: function(e, i) {
            var n = t.context2d._wrapX(i.left);
            var r = t.context2d._wrapY(i.top);
            var a = t.context2d._page(i.top);
            var o;
            var s = e.indexOf("#");
            if (s >= 0) {
                o = {
                    name: e.substring(s + 1)
                };
            } else {
                o = {
                    url: e
                };
            }
            t.link(n, r, i.right - i.left, i.bottom - i.top, o);
        },
        setName: function(e, i) {
            var n = t.context2d._wrapX(i.left);
            var r = t.context2d._wrapY(i.top);
            var a = t.context2d._page(i.top);
            this._nameMap[e] = {
                page: a,
                x: n,
                y: r
            };
        }
    };
    n.annotations = t.annotations;
    t.context2d._pageBreakAt = function(e) {
        this.pageBreaks.push(e);
    };
    t.context2d._gotoPage = function(e) {
        while (t.internal.getNumberOfPages() < e) {
            t.addPage();
        }
        t.setPage(e);
    };
    if (typeof e === "string") {
        e = e.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, "");
        var r = document.createElement("iframe");
        document.body.appendChild(r);
        var a;
        a = r.contentDocument;
        if (a == undefined || a == null) {
            a = r.contentWindow.document;
        }
        a.open();
        a.write(e);
        a.close();
        var o = html2canvas(a.body, {
            canvas: n,
            onrendered: function(e) {
                if (i) {
                    if (r) {
                        r.parentElement.removeChild(r);
                    }
                    i(t);
                }
            }
        });
    } else {
        var s = e;
        var o = html2canvas(s, {
            canvas: n,
            onrendered: function(e) {
                if (i) {
                    if (r) {
                        r.parentElement.removeChild(r);
                    }
                    i(t);
                }
            }
        });
    }
}

(function(e) {
    var t;
    t = function() {
        var t, i, n, r, a, o, s, l;
        c.load = function(e, t, i) {
            var n, r = this;
            if (typeof t === "function") {
                i = t;
            }
            n = new XMLHttpRequest();
            n.open("GET", e, true);
            n.responseType = "arraybuffer";
            n.onload = function() {
                var e, r;
                e = new Uint8Array(n.response || n.mozResponseArrayBuffer);
                r = new c(e);
                if (typeof (t != null ? t.getContext : void 0) === "function") {
                    r.render(t);
                }
                return typeof i === "function" ? i(r) : void 0;
            };
            return n.send(null);
        };
        r = 0;
        n = 1;
        a = 2;
        i = 0;
        t = 1;
        function c(e) {
            var t, i, n, r, a, o, s, l, c, u, f, d, h, p, g;
            this.data = e;
            this.pos = 8;
            this.palette = [];
            this.imgData = [];
            this.transparency = {};
            this.animation = null;
            this.text = {};
            o = null;
            while (true) {
                t = this.readUInt32();
                u = function() {
                    var e, t;
                    t = [];
                    for (s = e = 0; e < 4; s = ++e) {
                        t.push(String.fromCharCode(this.data[this.pos++]));
                    }
                    return t;
                }.call(this).join("");
                switch (u) {
                  case "IHDR":
                    this.width = this.readUInt32();
                    this.height = this.readUInt32();
                    this.bits = this.data[this.pos++];
                    this.colorType = this.data[this.pos++];
                    this.compressionMethod = this.data[this.pos++];
                    this.filterMethod = this.data[this.pos++];
                    this.interlaceMethod = this.data[this.pos++];
                    break;

                  case "acTL":
                    this.animation = {
                        numFrames: this.readUInt32(),
                        numPlays: this.readUInt32() || Infinity,
                        frames: []
                    };
                    break;

                  case "PLTE":
                    this.palette = this.read(t);
                    break;

                  case "fcTL":
                    if (o) {
                        this.animation.frames.push(o);
                    }
                    this.pos += 4;
                    o = {
                        width: this.readUInt32(),
                        height: this.readUInt32(),
                        xOffset: this.readUInt32(),
                        yOffset: this.readUInt32()
                    };
                    a = this.readUInt16();
                    r = this.readUInt16() || 100;
                    o.delay = 1e3 * a / r;
                    o.disposeOp = this.data[this.pos++];
                    o.blendOp = this.data[this.pos++];
                    o.data = [];
                    break;

                  case "IDAT":
                  case "fdAT":
                    if (u === "fdAT") {
                        this.pos += 4;
                        t -= 4;
                    }
                    e = (o != null ? o.data : void 0) || this.imgData;
                    for (s = h = 0; 0 <= t ? h < t : h > t; s = 0 <= t ? ++h : --h) {
                        e.push(this.data[this.pos++]);
                    }
                    break;

                  case "tRNS":
                    this.transparency = {};
                    switch (this.colorType) {
                      case 3:
                        n = this.palette.length / 3;
                        this.transparency.indexed = this.read(t);
                        if (this.transparency.indexed.length > n) throw new Error("More transparent colors than palette size");
                        f = n - this.transparency.indexed.length;
                        if (f > 0) {
                            for (s = p = 0; 0 <= f ? p < f : p > f; s = 0 <= f ? ++p : --p) {
                                this.transparency.indexed.push(255);
                            }
                        }
                        break;

                      case 0:
                        this.transparency.grayscale = this.read(t)[0];
                        break;

                      case 2:
                        this.transparency.rgb = this.read(t);
                    }
                    break;

                  case "tEXt":
                    d = this.read(t);
                    l = d.indexOf(0);
                    c = String.fromCharCode.apply(String, d.slice(0, l));
                    this.text[c] = String.fromCharCode.apply(String, d.slice(l + 1));
                    break;

                  case "IEND":
                    if (o) {
                        this.animation.frames.push(o);
                    }
                    this.colors = function() {
                        switch (this.colorType) {
                          case 0:
                          case 3:
                          case 4:
                            return 1;

                          case 2:
                          case 6:
                            return 3;
                        }
                    }.call(this);
                    this.hasAlphaChannel = (g = this.colorType) === 4 || g === 6;
                    i = this.colors + (this.hasAlphaChannel ? 1 : 0);
                    this.pixelBitlength = this.bits * i;
                    this.colorSpace = function() {
                        switch (this.colors) {
                          case 1:
                            return "DeviceGray";

                          case 3:
                            return "DeviceRGB";
                        }
                    }.call(this);
                    this.imgData = new Uint8Array(this.imgData);
                    return;

                  default:
                    this.pos += t;
                }
                this.pos += 4;
                if (this.pos > this.data.length) {
                    throw new Error("Incomplete or corrupt PNG file");
                }
            }
            return;
        }
        c.prototype.read = function(e) {
            var t, i, n;
            n = [];
            for (t = i = 0; 0 <= e ? i < e : i > e; t = 0 <= e ? ++i : --i) {
                n.push(this.data[this.pos++]);
            }
            return n;
        };
        c.prototype.readUInt32 = function() {
            var e, t, i, n;
            e = this.data[this.pos++] << 24;
            t = this.data[this.pos++] << 16;
            i = this.data[this.pos++] << 8;
            n = this.data[this.pos++];
            return e | t | i | n;
        };
        c.prototype.readUInt16 = function() {
            var e, t;
            e = this.data[this.pos++] << 8;
            t = this.data[this.pos++];
            return e | t;
        };
        c.prototype.decodePixels = function(e) {
            var t, i, n, r, a, o, s, l, c, u, f, d, h, p, g, m, v, y, b, w, C, x, _;
            if (e == null) {
                e = this.imgData;
            }
            if (e.length === 0) {
                return new Uint8Array(0);
            }
            e = new FlateStream(e);
            e = e.getBytes();
            d = this.pixelBitlength / 8;
            m = d * this.width;
            h = new Uint8Array(m * this.height);
            o = e.length;
            g = 0;
            p = 0;
            i = 0;
            while (p < o) {
                switch (e[p++]) {
                  case 0:
                    for (r = b = 0; b < m; r = b += 1) {
                        h[i++] = e[p++];
                    }
                    break;

                  case 1:
                    for (r = w = 0; w < m; r = w += 1) {
                        t = e[p++];
                        a = r < d ? 0 : h[i - d];
                        h[i++] = (t + a) % 256;
                    }
                    break;

                  case 2:
                    for (r = C = 0; C < m; r = C += 1) {
                        t = e[p++];
                        n = (r - r % d) / d;
                        v = g && h[(g - 1) * m + n * d + r % d];
                        h[i++] = (v + t) % 256;
                    }
                    break;

                  case 3:
                    for (r = x = 0; x < m; r = x += 1) {
                        t = e[p++];
                        n = (r - r % d) / d;
                        a = r < d ? 0 : h[i - d];
                        v = g && h[(g - 1) * m + n * d + r % d];
                        h[i++] = (t + Math.floor((a + v) / 2)) % 256;
                    }
                    break;

                  case 4:
                    for (r = _ = 0; _ < m; r = _ += 1) {
                        t = e[p++];
                        n = (r - r % d) / d;
                        a = r < d ? 0 : h[i - d];
                        if (g === 0) {
                            v = y = 0;
                        } else {
                            v = h[(g - 1) * m + n * d + r % d];
                            y = n && h[(g - 1) * m + (n - 1) * d + r % d];
                        }
                        s = a + v - y;
                        l = Math.abs(s - a);
                        u = Math.abs(s - v);
                        f = Math.abs(s - y);
                        if (l <= u && l <= f) {
                            c = a;
                        } else if (u <= f) {
                            c = v;
                        } else {
                            c = y;
                        }
                        h[i++] = (t + c) % 256;
                    }
                    break;

                  default:
                    throw new Error("Invalid filter algorithm: " + e[p - 1]);
                }
                g++;
            }
            return h;
        };
        c.prototype.decodePalette = function() {
            var e, t, i, n, r, a, o, s, l, c;
            n = this.palette;
            o = this.transparency.indexed || [];
            a = new Uint8Array((o.length || 0) + n.length);
            r = 0;
            i = n.length;
            e = 0;
            for (t = s = 0, l = n.length; s < l; t = s += 3) {
                a[r++] = n[t];
                a[r++] = n[t + 1];
                a[r++] = n[t + 2];
                a[r++] = (c = o[e++]) != null ? c : 255;
            }
            return a;
        };
        c.prototype.copyToImageData = function(e, t) {
            var i, n, r, a, o, s, l, c, u, f, d;
            n = this.colors;
            u = null;
            i = this.hasAlphaChannel;
            if (this.palette.length) {
                u = (d = this._decodedPalette) != null ? d : this._decodedPalette = this.decodePalette();
                n = 4;
                i = true;
            }
            r = e.data || e;
            c = r.length;
            o = u || t;
            a = s = 0;
            if (n === 1) {
                while (a < c) {
                    l = u ? t[a / 4] * 4 : s;
                    f = o[l++];
                    r[a++] = f;
                    r[a++] = f;
                    r[a++] = f;
                    r[a++] = i ? o[l++] : 255;
                    s = l;
                }
            } else {
                while (a < c) {
                    l = u ? t[a / 4] * 4 : s;
                    r[a++] = o[l++];
                    r[a++] = o[l++];
                    r[a++] = o[l++];
                    r[a++] = i ? o[l++] : 255;
                    s = l;
                }
            }
        };
        c.prototype.decode = function() {
            var e;
            e = new Uint8Array(this.width * this.height * 4);
            this.copyToImageData(e, this.decodePixels());
            return e;
        };
        try {
            s = e.document.createElement("canvas");
            l = s.getContext("2d");
        } catch (u) {
            return -1;
        }
        o = function(e) {
            var t;
            l.width = e.width;
            l.height = e.height;
            l.clearRect(0, 0, e.width, e.height);
            l.putImageData(e, 0, 0);
            t = new Image();
            t.src = s.toDataURL();
            return t;
        };
        c.prototype.decodeFrames = function(e) {
            var t, i, n, r, a, s, l, c;
            if (!this.animation) {
                return;
            }
            l = this.animation.frames;
            c = [];
            for (i = a = 0, s = l.length; a < s; i = ++a) {
                t = l[i];
                n = e.createImageData(t.width, t.height);
                r = this.decodePixels(new Uint8Array(t.data));
                this.copyToImageData(n, r);
                t.imageData = n;
                c.push(t.image = o(n));
            }
            return c;
        };
        c.prototype.renderFrame = function(e, t) {
            var r, o, s;
            o = this.animation.frames;
            r = o[t];
            s = o[t - 1];
            if (t === 0) {
                e.clearRect(0, 0, this.width, this.height);
            }
            if ((s != null ? s.disposeOp : void 0) === n) {
                e.clearRect(s.xOffset, s.yOffset, s.width, s.height);
            } else if ((s != null ? s.disposeOp : void 0) === a) {
                e.putImageData(s.imageData, s.xOffset, s.yOffset);
            }
            if (r.blendOp === i) {
                e.clearRect(r.xOffset, r.yOffset, r.width, r.height);
            }
            return e.drawImage(r.image, r.xOffset, r.yOffset);
        };
        c.prototype.animate = function(e) {
            var t, i, n, r, a, o, s = this;
            i = 0;
            o = this.animation, r = o.numFrames, n = o.frames, a = o.numPlays;
            return (t = function() {
                var o, l;
                o = i++ % r;
                l = n[o];
                s.renderFrame(e, o);
                if (r > 1 && i / r < a) {
                    return s.animation._timeout = setTimeout(t, l.delay);
                }
            })();
        };
        c.prototype.stopAnimation = function() {
            var e;
            return clearTimeout((e = this.animation) != null ? e._timeout : void 0);
        };
        c.prototype.render = function(e) {
            var t, i;
            if (e._png) {
                e._png.stopAnimation();
            }
            e._png = this;
            e.width = this.width;
            e.height = this.height;
            t = e.getContext("2d");
            if (this.animation) {
                this.decodeFrames(t);
                return this.animate(t);
            } else {
                i = t.createImageData(this.width, this.height);
                this.copyToImageData(i, this.decodePixels());
                return t.putImageData(i, 0, 0);
            }
        };
        return c;
    }();
    e.PNG = t;
})(typeof window !== "undefined" && window || this);

var DecodeStream = function() {
    function e() {
        this.pos = 0;
        this.bufferLength = 0;
        this.eof = false;
        this.buffer = null;
    }
    e.prototype = {
        ensureBuffer: function t(e) {
            var t = this.buffer;
            var i = t ? t.byteLength : 0;
            if (e < i) return t;
            var n = 512;
            while (n < e) n <<= 1;
            var r = new Uint8Array(n);
            for (var a = 0; a < i; ++a) r[a] = t[a];
            return this.buffer = r;
        },
        getByte: function i() {
            var e = this.pos;
            while (this.bufferLength <= e) {
                if (this.eof) return null;
                this.readBlock();
            }
            return this.buffer[this.pos++];
        },
        getBytes: function n(e) {
            var t = this.pos;
            if (e) {
                this.ensureBuffer(t + e);
                var i = t + e;
                while (!this.eof && this.bufferLength < i) this.readBlock();
                var n = this.bufferLength;
                if (i > n) i = n;
            } else {
                while (!this.eof) this.readBlock();
                var i = this.bufferLength;
            }
            this.pos = i;
            return this.buffer.subarray(t, i);
        },
        lookChar: function r() {
            var e = this.pos;
            while (this.bufferLength <= e) {
                if (this.eof) return null;
                this.readBlock();
            }
            return String.fromCharCode(this.buffer[this.pos]);
        },
        getChar: function a() {
            var e = this.pos;
            while (this.bufferLength <= e) {
                if (this.eof) return null;
                this.readBlock();
            }
            return String.fromCharCode(this.buffer[this.pos++]);
        },
        makeSubStream: function o(e, t, i) {
            var n = e + t;
            while (this.bufferLength <= n && !this.eof) this.readBlock();
            return new Stream(this.buffer, e, t, i);
        },
        skip: function s(e) {
            if (!e) e = 1;
            this.pos += e;
        },
        reset: function l() {
            this.pos = 0;
        }
    };
    return e;
}();

var FlateStream = function() {
    if (typeof Uint32Array === "undefined") {
        return undefined;
    }
    var e = new Uint32Array([ 16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15 ]);
    var t = new Uint32Array([ 3, 4, 5, 6, 7, 8, 9, 10, 65547, 65549, 65551, 65553, 131091, 131095, 131099, 131103, 196643, 196651, 196659, 196667, 262211, 262227, 262243, 262259, 327811, 327843, 327875, 327907, 258, 258, 258 ]);
    var i = new Uint32Array([ 1, 2, 3, 4, 65541, 65543, 131081, 131085, 196625, 196633, 262177, 262193, 327745, 327777, 393345, 393409, 459009, 459137, 524801, 525057, 590849, 591361, 657409, 658433, 724993, 727041, 794625, 798721, 868353, 876545 ]);
    var n = [ new Uint32Array([ 459008, 524368, 524304, 524568, 459024, 524400, 524336, 590016, 459016, 524384, 524320, 589984, 524288, 524416, 524352, 590048, 459012, 524376, 524312, 589968, 459028, 524408, 524344, 590032, 459020, 524392, 524328, 59e4, 524296, 524424, 524360, 590064, 459010, 524372, 524308, 524572, 459026, 524404, 524340, 590024, 459018, 524388, 524324, 589992, 524292, 524420, 524356, 590056, 459014, 524380, 524316, 589976, 459030, 524412, 524348, 590040, 459022, 524396, 524332, 590008, 524300, 524428, 524364, 590072, 459009, 524370, 524306, 524570, 459025, 524402, 524338, 590020, 459017, 524386, 524322, 589988, 524290, 524418, 524354, 590052, 459013, 524378, 524314, 589972, 459029, 524410, 524346, 590036, 459021, 524394, 524330, 590004, 524298, 524426, 524362, 590068, 459011, 524374, 524310, 524574, 459027, 524406, 524342, 590028, 459019, 524390, 524326, 589996, 524294, 524422, 524358, 590060, 459015, 524382, 524318, 589980, 459031, 524414, 524350, 590044, 459023, 524398, 524334, 590012, 524302, 524430, 524366, 590076, 459008, 524369, 524305, 524569, 459024, 524401, 524337, 590018, 459016, 524385, 524321, 589986, 524289, 524417, 524353, 590050, 459012, 524377, 524313, 589970, 459028, 524409, 524345, 590034, 459020, 524393, 524329, 590002, 524297, 524425, 524361, 590066, 459010, 524373, 524309, 524573, 459026, 524405, 524341, 590026, 459018, 524389, 524325, 589994, 524293, 524421, 524357, 590058, 459014, 524381, 524317, 589978, 459030, 524413, 524349, 590042, 459022, 524397, 524333, 590010, 524301, 524429, 524365, 590074, 459009, 524371, 524307, 524571, 459025, 524403, 524339, 590022, 459017, 524387, 524323, 589990, 524291, 524419, 524355, 590054, 459013, 524379, 524315, 589974, 459029, 524411, 524347, 590038, 459021, 524395, 524331, 590006, 524299, 524427, 524363, 590070, 459011, 524375, 524311, 524575, 459027, 524407, 524343, 590030, 459019, 524391, 524327, 589998, 524295, 524423, 524359, 590062, 459015, 524383, 524319, 589982, 459031, 524415, 524351, 590046, 459023, 524399, 524335, 590014, 524303, 524431, 524367, 590078, 459008, 524368, 524304, 524568, 459024, 524400, 524336, 590017, 459016, 524384, 524320, 589985, 524288, 524416, 524352, 590049, 459012, 524376, 524312, 589969, 459028, 524408, 524344, 590033, 459020, 524392, 524328, 590001, 524296, 524424, 524360, 590065, 459010, 524372, 524308, 524572, 459026, 524404, 524340, 590025, 459018, 524388, 524324, 589993, 524292, 524420, 524356, 590057, 459014, 524380, 524316, 589977, 459030, 524412, 524348, 590041, 459022, 524396, 524332, 590009, 524300, 524428, 524364, 590073, 459009, 524370, 524306, 524570, 459025, 524402, 524338, 590021, 459017, 524386, 524322, 589989, 524290, 524418, 524354, 590053, 459013, 524378, 524314, 589973, 459029, 524410, 524346, 590037, 459021, 524394, 524330, 590005, 524298, 524426, 524362, 590069, 459011, 524374, 524310, 524574, 459027, 524406, 524342, 590029, 459019, 524390, 524326, 589997, 524294, 524422, 524358, 590061, 459015, 524382, 524318, 589981, 459031, 524414, 524350, 590045, 459023, 524398, 524334, 590013, 524302, 524430, 524366, 590077, 459008, 524369, 524305, 524569, 459024, 524401, 524337, 590019, 459016, 524385, 524321, 589987, 524289, 524417, 524353, 590051, 459012, 524377, 524313, 589971, 459028, 524409, 524345, 590035, 459020, 524393, 524329, 590003, 524297, 524425, 524361, 590067, 459010, 524373, 524309, 524573, 459026, 524405, 524341, 590027, 459018, 524389, 524325, 589995, 524293, 524421, 524357, 590059, 459014, 524381, 524317, 589979, 459030, 524413, 524349, 590043, 459022, 524397, 524333, 590011, 524301, 524429, 524365, 590075, 459009, 524371, 524307, 524571, 459025, 524403, 524339, 590023, 459017, 524387, 524323, 589991, 524291, 524419, 524355, 590055, 459013, 524379, 524315, 589975, 459029, 524411, 524347, 590039, 459021, 524395, 524331, 590007, 524299, 524427, 524363, 590071, 459011, 524375, 524311, 524575, 459027, 524407, 524343, 590031, 459019, 524391, 524327, 589999, 524295, 524423, 524359, 590063, 459015, 524383, 524319, 589983, 459031, 524415, 524351, 590047, 459023, 524399, 524335, 590015, 524303, 524431, 524367, 590079 ]), 9 ];
    var r = [ new Uint32Array([ 327680, 327696, 327688, 327704, 327684, 327700, 327692, 327708, 327682, 327698, 327690, 327706, 327686, 327702, 327694, 0, 327681, 327697, 327689, 327705, 327685, 327701, 327693, 327709, 327683, 327699, 327691, 327707, 327687, 327703, 327695, 0 ]), 5 ];
    function a(e) {
        throw new Error(e);
    }
    function o(e) {
        var t = 0;
        var i = e[t++];
        var n = e[t++];
        if (i == -1 || n == -1) a("Invalid header in flate stream");
        if ((i & 15) != 8) a("Unknown compression method in flate stream");
        if (((i << 8) + n) % 31 != 0) a("Bad FCHECK in flate stream");
        if (n & 32) a("FDICT bit set in flate stream");
        this.bytes = e;
        this.bytesPos = t;
        this.codeSize = 0;
        this.codeBuf = 0;
        DecodeStream.call(this);
    }
    o.prototype = Object.create(DecodeStream.prototype);
    o.prototype.getBits = function(e) {
        var t = this.codeSize;
        var i = this.codeBuf;
        var n = this.bytes;
        var r = this.bytesPos;
        var o;
        while (t < e) {
            if (typeof (o = n[r++]) == "undefined") a("Bad encoding in flate stream");
            i |= o << t;
            t += 8;
        }
        o = i & (1 << e) - 1;
        this.codeBuf = i >> e;
        this.codeSize = t -= e;
        this.bytesPos = r;
        return o;
    };
    o.prototype.getCode = function(e) {
        var t = e[0];
        var i = e[1];
        var n = this.codeSize;
        var r = this.codeBuf;
        var o = this.bytes;
        var s = this.bytesPos;
        while (n < i) {
            var l;
            if (typeof (l = o[s++]) == "undefined") a("Bad encoding in flate stream");
            r |= l << n;
            n += 8;
        }
        var c = t[r & (1 << i) - 1];
        var u = c >> 16;
        var f = c & 65535;
        if (n == 0 || n < u || u == 0) a("Bad encoding in flate stream");
        this.codeBuf = r >> u;
        this.codeSize = n - u;
        this.bytesPos = s;
        return f;
    };
    o.prototype.generateHuffmanTable = function(e) {
        var t = e.length;
        var i = 0;
        for (var n = 0; n < t; ++n) {
            if (e[n] > i) i = e[n];
        }
        var r = 1 << i;
        var a = new Uint32Array(r);
        for (var o = 1, s = 0, l = 2; o <= i; ++o, s <<= 1, l <<= 1) {
            for (var c = 0; c < t; ++c) {
                if (e[c] == o) {
                    var u = 0;
                    var f = s;
                    for (var n = 0; n < o; ++n) {
                        u = u << 1 | f & 1;
                        f >>= 1;
                    }
                    for (var n = u; n < r; n += l) a[n] = o << 16 | c;
                    ++s;
                }
            }
        }
        return [ a, i ];
    };
    o.prototype.readBlock = function() {
        function o(e, t, i, n, r) {
            var a = e.getBits(i) + n;
            while (a-- > 0) t[_++] = r;
        }
        var s = this.getBits(3);
        if (s & 1) this.eof = true;
        s >>= 1;
        if (s == 0) {
            var l = this.bytes;
            var c = this.bytesPos;
            var u;
            if (typeof (u = l[c++]) == "undefined") a("Bad block header in flate stream");
            var f = u;
            if (typeof (u = l[c++]) == "undefined") a("Bad block header in flate stream");
            f |= u << 8;
            if (typeof (u = l[c++]) == "undefined") a("Bad block header in flate stream");
            var d = u;
            if (typeof (u = l[c++]) == "undefined") a("Bad block header in flate stream");
            d |= u << 8;
            if (d != (~f & 65535)) a("Bad uncompressed block length in flate stream");
            this.codeBuf = 0;
            this.codeSize = 0;
            var h = this.bufferLength;
            var p = this.ensureBuffer(h + f);
            var g = h + f;
            this.bufferLength = g;
            for (var m = h; m < g; ++m) {
                if (typeof (u = l[c++]) == "undefined") {
                    this.eof = true;
                    break;
                }
                p[m] = u;
            }
            this.bytesPos = c;
            return;
        }
        var v;
        var y;
        if (s == 1) {
            v = n;
            y = r;
        } else if (s == 2) {
            var b = this.getBits(5) + 257;
            var w = this.getBits(5) + 1;
            var C = this.getBits(4) + 4;
            var x = Array(e.length);
            var _ = 0;
            while (_ < C) x[e[_++]] = this.getBits(3);
            var S = this.generateHuffmanTable(x);
            var k = 0;
            var _ = 0;
            var A = b + w;
            var E = new Array(A);
            while (_ < A) {
                var T = this.getCode(S);
                if (T == 16) {
                    o(this, E, 2, 3, k);
                } else if (T == 17) {
                    o(this, E, 3, 3, k = 0);
                } else if (T == 18) {
                    o(this, E, 7, 11, k = 0);
                } else {
                    E[_++] = k = T;
                }
            }
            v = this.generateHuffmanTable(E.slice(0, b));
            y = this.generateHuffmanTable(E.slice(b, A));
        } else {
            a("Unknown block type in flate stream");
        }
        var p = this.buffer;
        var P = p ? p.length : 0;
        var I = this.bufferLength;
        while (true) {
            var O = this.getCode(v);
            if (O < 256) {
                if (I + 1 >= P) {
                    p = this.ensureBuffer(I + 1);
                    P = p.length;
                }
                p[I++] = O;
                continue;
            }
            if (O == 256) {
                this.bufferLength = I;
                return;
            }
            O -= 257;
            O = t[O];
            var D = O >> 16;
            if (D > 0) D = this.getBits(D);
            var k = (O & 65535) + D;
            O = this.getCode(y);
            O = i[O];
            D = O >> 16;
            if (D > 0) D = this.getBits(D);
            var R = (O & 65535) + D;
            if (I + k >= P) {
                p = this.ensureBuffer(I + k);
                P = p.length;
            }
            for (var L = 0; L < k; ++L, ++I) p[I] = p[I - R];
        }
    };
    return o;
}();

(function(e) {
    var t = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";
    if (typeof e.btoa === "undefined") {
        e.btoa = function(e) {
            var i, n, r, a, o, s, l, c, u = 0, f = 0, d = "", h = [];
            if (!e) {
                return e;
            }
            do {
                i = e.charCodeAt(u++);
                n = e.charCodeAt(u++);
                r = e.charCodeAt(u++);
                c = i << 16 | n << 8 | r;
                a = c >> 18 & 63;
                o = c >> 12 & 63;
                s = c >> 6 & 63;
                l = c & 63;
                h[f++] = t.charAt(a) + t.charAt(o) + t.charAt(s) + t.charAt(l);
            } while (u < e.length);
            d = h.join("");
            var p = e.length % 3;
            return (p ? d.slice(0, p - 3) : d) + "===".slice(p || 3);
        };
    }
    if (typeof e.atob === "undefined") {
        e.atob = function(e) {
            var i, n, r, a, o, s, l, c, u = 0, f = 0, d = "", h = [];
            if (!e) {
                return e;
            }
            e += "";
            do {
                a = t.indexOf(e.charAt(u++));
                o = t.indexOf(e.charAt(u++));
                s = t.indexOf(e.charAt(u++));
                l = t.indexOf(e.charAt(u++));
                c = a << 18 | o << 12 | s << 6 | l;
                i = c >> 16 & 255;
                n = c >> 8 & 255;
                r = c & 255;
                if (s == 64) {
                    h[f++] = String.fromCharCode(i);
                } else if (l == 64) {
                    h[f++] = String.fromCharCode(i, n);
                } else {
                    h[f++] = String.fromCharCode(i, n, r);
                }
            } while (u < e.length);
            d = h.join("");
            return d;
        };
    }
    if (!Array.prototype.map) {
        Array.prototype.map = function(e) {
            if (this === void 0 || this === null || typeof e !== "function") throw new TypeError();
            var t = Object(this), i = t.length >>> 0, n = new Array(i);
            var r = arguments.length > 1 ? arguments[1] : void 0;
            for (var a = 0; a < i; a++) {
                if (a in t) n[a] = e.call(r, t[a], a, t);
            }
            return n;
        };
    }
    if (!Array.isArray) {
        Array.isArray = function(e) {
            return Object.prototype.toString.call(e) === "[object Array]";
        };
    }
    if (!Array.prototype.forEach) {
        Array.prototype.forEach = function(e, t) {
            if (this === void 0 || this === null || typeof e !== "function") throw new TypeError();
            var i = Object(this), n = i.length >>> 0;
            for (var r = 0; r < n; r++) {
                if (r in i) e.call(t, i[r], r, i);
            }
        };
    }
    if (!Object.keys) {
        Object.keys = function() {
            var e = Object.prototype.hasOwnProperty, t = !{
                toString: null
            }.propertyIsEnumerable("toString"), i = [ "toString", "toLocaleString", "valueOf", "hasOwnProperty", "isPrototypeOf", "propertyIsEnumerable", "constructor" ], n = i.length;
            return function(r) {
                if (typeof r !== "object" && (typeof r !== "function" || r === null)) {
                    throw new TypeError();
                }
                var a = [], o, s;
                for (o in r) {
                    if (e.call(r, o)) {
                        a.push(o);
                    }
                }
                if (t) {
                    for (s = 0; s < n; s++) {
                        if (e.call(r, i[s])) {
                            a.push(i[s]);
                        }
                    }
                }
                return a;
            };
        }();
    }
    if (!String.prototype.trim) {
        String.prototype.trim = function() {
            return this.replace(/^\s+|\s+$/g, "");
        };
    }
    if (!String.prototype.trimLeft) {
        String.prototype.trimLeft = function() {
            return this.replace(/^\s+/g, "");
        };
    }
    if (!String.prototype.trimRight) {
        String.prototype.trimRight = function() {
            return this.replace(/\s+$/g, "");
        };
    }
})(typeof self !== "undefined" && self || typeof window !== "undefined" && window || this);

if (typeof require === "object") {
    if (typeof require_baseUrl_override === "undefined") {
        require_baseUrl_override = "../";
    }
    require.config({
        baseUrl: require_baseUrl_override,
        shim: {
            "plugins/standard_fonts_metrics": {
                deps: [ "jspdf" ]
            },
            "plugins/split_text_to_size": {
                deps: [ "jspdf" ]
            },
            "plugins/annotations": {
                deps: [ "jspdf", "plugins/standard_fonts_metrics", "plugins/split_text_to_size" ]
            },
            "plugins/outline": {
                deps: [ "jspdf" ]
            },
            "plugins/addimage": {
                deps: [ "jspdf" ]
            },
            "plugins/png_support": {
                deps: [ "jspdf", "libs/png_support/png", "libs/png_support/zlib" ]
            },
            "plugins/from_html": {
                deps: [ "jspdf" ]
            },
            "plugins/context2d": {
                deps: [ "jspdf", "plugins/png_support", "plugins/addimage", "libs/css_colors" ]
            },
            "libs/html2canvas/dist/html2canvas": {
                deps: [ "jspdf" ]
            },
            "plugins/canvas": {
                deps: [ "jspdf" ]
            },
            html2pdf: {
                deps: [ "jspdf", "plugins/standard_fonts_metrics", "plugins/split_text_to_size", "plugins/png_support", "plugins/context2d", "plugins/canvas", "plugins/annotations", "libs/html2canvas/dist/html2canvas" ]
            },
            "test/test_harness": {
                deps: [ "jspdf", "jspdf.plugin.standard_fonts_metrics", "jspdf.plugin.split_text_to_size" ]
            }
        },
        paths: {
            html2pdf: "libs/html2pdf"
        }
    });
}

var requirejs, require, define;

(function(global) {
    var req, s, head, baseElement, dataMain, src, interactiveScript, currentlyAddingScript, mainScript, subPath, version = "2.1.15", commentRegExp = /(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm, cjsRequireRegExp = /[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g, jsSuffixRegExp = /\.js$/, currDirRegExp = /^\.\//, op = Object.prototype, ostring = op.toString, hasOwn = op.hasOwnProperty, ap = Array.prototype, apsp = ap.splice, isBrowser = !!(typeof window !== "undefined" && typeof navigator !== "undefined" && window.document), isWebWorker = !isBrowser && typeof importScripts !== "undefined", readyRegExp = isBrowser && navigator.platform === "PLAYSTATION 3" ? /^complete$/ : /^(complete|loaded)$/, defContextName = "_", isOpera = typeof opera !== "undefined" && opera.toString() === "[object Opera]", contexts = {}, cfg = {}, globalDefQueue = [], useInteractive = false;
    function isFunction(e) {
        return ostring.call(e) === "[object Function]";
    }
    function isArray(e) {
        return ostring.call(e) === "[object Array]";
    }
    function each(e, t) {
        if (e) {
            var i;
            for (i = 0; i < e.length; i += 1) {
                if (e[i] && t(e[i], i, e)) {
                    break;
                }
            }
        }
    }
    function eachReverse(e, t) {
        if (e) {
            var i;
            for (i = e.length - 1; i > -1; i -= 1) {
                if (e[i] && t(e[i], i, e)) {
                    break;
                }
            }
        }
    }
    function hasProp(e, t) {
        return hasOwn.call(e, t);
    }
    function getOwn(e, t) {
        return hasProp(e, t) && e[t];
    }
    function eachProp(e, t) {
        var i;
        for (i in e) {
            if (hasProp(e, i)) {
                if (t(e[i], i)) {
                    break;
                }
            }
        }
    }
    function mixin(e, t, i, n) {
        if (t) {
            eachProp(t, function(t, r) {
                if (i || !hasProp(e, r)) {
                    if (n && typeof t === "object" && t && !isArray(t) && !isFunction(t) && !(t instanceof RegExp)) {
                        if (!e[r]) {
                            e[r] = {};
                        }
                        mixin(e[r], t, i, n);
                    } else {
                        e[r] = t;
                    }
                }
            });
        }
        return e;
    }
    function bind(e, t) {
        return function() {
            return t.apply(e, arguments);
        };
    }
    function scripts() {
        return document.getElementsByTagName("script");
    }
    function defaultOnError(e) {
        throw e;
    }
    function getGlobal(e) {
        if (!e) {
            return e;
        }
        var t = global;
        each(e.split("."), function(e) {
            t = t[e];
        });
        return t;
    }
    function makeError(e, t, i, n) {
        var r = new Error(t + "\nhttp://requirejs.org/docs/errors.html#" + e);
        r.requireType = e;
        r.requireModules = n;
        if (i) {
            r.originalError = i;
        }
        return r;
    }
    if (typeof define !== "undefined") {
        return;
    }
    if (typeof requirejs !== "undefined") {
        if (isFunction(requirejs)) {
            return;
        }
        cfg = requirejs;
        requirejs = undefined;
    }
    if (typeof require !== "undefined" && !isFunction(require)) {
        cfg = require;
        require = undefined;
    }
    function newContext(e) {
        var t, i, n, r, a, o = {
            waitSeconds: 7,
            baseUrl: "./",
            paths: {},
            bundles: {},
            pkgs: {},
            shim: {},
            config: {}
        }, s = {}, l = {}, c = {}, u = [], f = {}, d = {}, h = {}, p = 1, g = 1;
        function m(e) {
            var t, i;
            for (t = 0; t < e.length; t++) {
                i = e[t];
                if (i === ".") {
                    e.splice(t, 1);
                    t -= 1;
                } else if (i === "..") {
                    if (t === 0 || t == 1 && e[2] === ".." || e[t - 1] === "..") {
                        continue;
                    } else if (t > 0) {
                        e.splice(t - 1, 2);
                        t -= 2;
                    }
                }
            }
        }
        function v(e, t, i) {
            var n, r, a, s, l, c, u, f, d, h, p, g, v = t && t.split("/"), y = o.map, b = y && y["*"];
            if (e) {
                e = e.split("/");
                u = e.length - 1;
                if (o.nodeIdCompat && jsSuffixRegExp.test(e[u])) {
                    e[u] = e[u].replace(jsSuffixRegExp, "");
                }
                if (e[0].charAt(0) === "." && v) {
                    g = v.slice(0, v.length - 1);
                    e = g.concat(e);
                }
                m(e);
                e = e.join("/");
            }
            if (i && y && (v || b)) {
                a = e.split("/");
                e: for (s = a.length; s > 0; s -= 1) {
                    c = a.slice(0, s).join("/");
                    if (v) {
                        for (l = v.length; l > 0; l -= 1) {
                            r = getOwn(y, v.slice(0, l).join("/"));
                            if (r) {
                                r = getOwn(r, c);
                                if (r) {
                                    f = r;
                                    d = s;
                                    break e;
                                }
                            }
                        }
                    }
                    if (!h && b && getOwn(b, c)) {
                        h = getOwn(b, c);
                        p = s;
                    }
                }
                if (!f && h) {
                    f = h;
                    d = p;
                }
                if (f) {
                    a.splice(0, d, f);
                    e = a.join("/");
                }
            }
            n = getOwn(o.pkgs, e);
            return n ? n : e;
        }
        function y(e) {
            if (isBrowser) {
                each(scripts(), function(t) {
                    if (t.getAttribute("data-requiremodule") === e && t.getAttribute("data-requirecontext") === n.contextName) {
                        t.parentNode.removeChild(t);
                        return true;
                    }
                });
            }
        }
        function b(e) {
            var t = getOwn(o.paths, e);
            if (t && isArray(t) && t.length > 1) {
                t.shift();
                n.require.undef(e);
                n.makeRequire(null, {
                    skipMap: true
                })([ e ]);
                return true;
            }
        }
        function w(e) {
            var t, i = e ? e.indexOf("!") : -1;
            if (i > -1) {
                t = e.substring(0, i);
                e = e.substring(i + 1, e.length);
            }
            return [ t, e ];
        }
        function C(e, t, i, r) {
            var a, o, s, l, c = null, u = t ? t.name : null, d = e, h = true, m = "";
            if (!e) {
                h = false;
                e = "_@r" + (p += 1);
            }
            l = w(e);
            c = l[0];
            e = l[1];
            if (c) {
                c = v(c, u, r);
                o = getOwn(f, c);
            }
            if (e) {
                if (c) {
                    if (o && o.normalize) {
                        m = o.normalize(e, function(e) {
                            return v(e, u, r);
                        });
                    } else {
                        m = e.indexOf("!") === -1 ? v(e, u, r) : e;
                    }
                } else {
                    m = v(e, u, r);
                    l = w(m);
                    c = l[0];
                    m = l[1];
                    i = true;
                    a = n.nameToUrl(m);
                }
            }
            s = c && !o && !i ? "_unnormalized" + (g += 1) : "";
            return {
                prefix: c,
                name: m,
                parentMap: t,
                unnormalized: !!s,
                url: a,
                originalName: d,
                isDefine: h,
                id: (c ? c + "!" + m : m) + s
            };
        }
        function x(e) {
            var t = e.id, i = getOwn(s, t);
            if (!i) {
                i = s[t] = new n.Module(e);
            }
            return i;
        }
        function _(e, t, i) {
            var n = e.id, r = getOwn(s, n);
            if (hasProp(f, n) && (!r || r.defineEmitComplete)) {
                if (t === "defined") {
                    i(f[n]);
                }
            } else {
                r = x(e);
                if (r.error && t === "error") {
                    i(r.error);
                } else {
                    r.on(t, i);
                }
            }
        }
        function S(e, t) {
            var i = e.requireModules, n = false;
            if (t) {
                t(e);
            } else {
                each(i, function(t) {
                    var i = getOwn(s, t);
                    if (i) {
                        i.error = e;
                        if (i.events.error) {
                            n = true;
                            i.emit("error", e);
                        }
                    }
                });
                if (!n) {
                    req.onError(e);
                }
            }
        }
        function k() {
            if (globalDefQueue.length) {
                apsp.apply(u, [ u.length, 0 ].concat(globalDefQueue));
                globalDefQueue = [];
            }
        }
        r = {
            require: function(e) {
                if (e.require) {
                    return e.require;
                } else {
                    return e.require = n.makeRequire(e.map);
                }
            },
            exports: function(e) {
                e.usingExports = true;
                if (e.map.isDefine) {
                    if (e.exports) {
                        return f[e.map.id] = e.exports;
                    } else {
                        return e.exports = f[e.map.id] = {};
                    }
                }
            },
            module: function(e) {
                if (e.module) {
                    return e.module;
                } else {
                    return e.module = {
                        id: e.map.id,
                        uri: e.map.url,
                        config: function() {
                            return getOwn(o.config, e.map.id) || {};
                        },
                        exports: e.exports || (e.exports = {})
                    };
                }
            }
        };
        function A(e) {
            delete s[e];
            delete l[e];
        }
        function E(e, t, i) {
            var n = e.map.id;
            if (e.error) {
                e.emit("error", e.error);
            } else {
                t[n] = true;
                each(e.depMaps, function(n, r) {
                    var a = n.id, o = getOwn(s, a);
                    if (o && !e.depMatched[r] && !i[a]) {
                        if (getOwn(t, a)) {
                            e.defineDep(r, f[a]);
                            e.check();
                        } else {
                            E(o, t, i);
                        }
                    }
                });
                i[n] = true;
            }
        }
        function T() {
            var e, i, r = o.waitSeconds * 1e3, s = r && n.startTime + r < new Date().getTime(), c = [], u = [], f = false, d = true;
            if (t) {
                return;
            }
            t = true;
            eachProp(l, function(e) {
                var t = e.map, n = t.id;
                if (!e.enabled) {
                    return;
                }
                if (!t.isDefine) {
                    u.push(e);
                }
                if (!e.error) {
                    if (!e.inited && s) {
                        if (b(n)) {
                            i = true;
                            f = true;
                        } else {
                            c.push(n);
                            y(n);
                        }
                    } else if (!e.inited && e.fetched && t.isDefine) {
                        f = true;
                        if (!t.prefix) {
                            return d = false;
                        }
                    }
                }
            });
            if (s && c.length) {
                e = makeError("timeout", "Load timeout for modules: " + c, null, c);
                e.contextName = n.contextName;
                return S(e);
            }
            if (d) {
                each(u, function(e) {
                    E(e, {}, {});
                });
            }
            if ((!s || i) && f) {
                if ((isBrowser || isWebWorker) && !a) {
                    a = setTimeout(function() {
                        a = 0;
                        T();
                    }, 50);
                }
            }
            t = false;
        }
        i = function(e) {
            this.events = getOwn(c, e.id) || {};
            this.map = e;
            this.shim = getOwn(o.shim, e.id);
            this.depExports = [];
            this.depMaps = [];
            this.depMatched = [];
            this.pluginMaps = {};
            this.depCount = 0;
        };
        i.prototype = {
            init: function(e, t, i, n) {
                n = n || {};
                if (this.inited) {
                    return;
                }
                this.factory = t;
                if (i) {
                    this.on("error", i);
                } else if (this.events.error) {
                    i = bind(this, function(e) {
                        this.emit("error", e);
                    });
                }
                this.depMaps = e && e.slice(0);
                this.errback = i;
                this.inited = true;
                this.ignore = n.ignore;
                if (n.enabled || this.enabled) {
                    this.enable();
                } else {
                    this.check();
                }
            },
            defineDep: function(e, t) {
                if (!this.depMatched[e]) {
                    this.depMatched[e] = true;
                    this.depCount -= 1;
                    this.depExports[e] = t;
                }
            },
            fetch: function() {
                if (this.fetched) {
                    return;
                }
                this.fetched = true;
                n.startTime = new Date().getTime();
                var e = this.map;
                if (this.shim) {
                    n.makeRequire(this.map, {
                        enableBuildCallback: true
                    })(this.shim.deps || [], bind(this, function() {
                        return e.prefix ? this.callPlugin() : this.load();
                    }));
                } else {
                    return e.prefix ? this.callPlugin() : this.load();
                }
            },
            load: function() {
                var e = this.map.url;
                if (!d[e]) {
                    d[e] = true;
                    n.load(this.map.id, e);
                }
            },
            check: function() {
                if (!this.enabled || this.enabling) {
                    return;
                }
                var e, t, i = this.map.id, r = this.depExports, a = this.exports, o = this.factory;
                if (!this.inited) {
                    this.fetch();
                } else if (this.error) {
                    this.emit("error", this.error);
                } else if (!this.defining) {
                    this.defining = true;
                    if (this.depCount < 1 && !this.defined) {
                        if (isFunction(o)) {
                            if (this.events.error && this.map.isDefine || req.onError !== defaultOnError) {
                                try {
                                    a = n.execCb(i, o, r, a);
                                } catch (s) {
                                    e = s;
                                }
                            } else {
                                a = n.execCb(i, o, r, a);
                            }
                            if (this.map.isDefine && a === undefined) {
                                t = this.module;
                                if (t) {
                                    a = t.exports;
                                } else if (this.usingExports) {
                                    a = this.exports;
                                }
                            }
                            if (e) {
                                e.requireMap = this.map;
                                e.requireModules = this.map.isDefine ? [ this.map.id ] : null;
                                e.requireType = this.map.isDefine ? "define" : "require";
                                return S(this.error = e);
                            }
                        } else {
                            a = o;
                        }
                        this.exports = a;
                        if (this.map.isDefine && !this.ignore) {
                            f[i] = a;
                            if (req.onResourceLoad) {
                                req.onResourceLoad(n, this.map, this.depMaps);
                            }
                        }
                        A(i);
                        this.defined = true;
                    }
                    this.defining = false;
                    if (this.defined && !this.defineEmitted) {
                        this.defineEmitted = true;
                        this.emit("defined", this.exports);
                        this.defineEmitComplete = true;
                    }
                }
            },
            callPlugin: function() {
                var e = this.map, t = e.id, i = C(e.prefix);
                this.depMaps.push(i);
                _(i, "defined", bind(this, function(i) {
                    var r, a, l, c = getOwn(h, this.map.id), u = this.map.name, f = this.map.parentMap ? this.map.parentMap.name : null, d = n.makeRequire(e.parentMap, {
                        enableBuildCallback: true
                    });
                    if (this.map.unnormalized) {
                        if (i.normalize) {
                            u = i.normalize(u, function(e) {
                                return v(e, f, true);
                            }) || "";
                        }
                        a = C(e.prefix + "!" + u, this.map.parentMap);
                        _(a, "defined", bind(this, function(e) {
                            this.init([], function() {
                                return e;
                            }, null, {
                                enabled: true,
                                ignore: true
                            });
                        }));
                        l = getOwn(s, a.id);
                        if (l) {
                            this.depMaps.push(a);
                            if (this.events.error) {
                                l.on("error", bind(this, function(e) {
                                    this.emit("error", e);
                                }));
                            }
                            l.enable();
                        }
                        return;
                    }
                    if (c) {
                        this.map.url = n.nameToUrl(c);
                        this.load();
                        return;
                    }
                    r = bind(this, function(e) {
                        this.init([], function() {
                            return e;
                        }, null, {
                            enabled: true
                        });
                    });
                    r.error = bind(this, function(e) {
                        this.inited = true;
                        this.error = e;
                        e.requireModules = [ t ];
                        eachProp(s, function(e) {
                            if (e.map.id.indexOf(t + "_unnormalized") === 0) {
                                A(e.map.id);
                            }
                        });
                        S(e);
                    });
                    r.fromText = bind(this, function(i, a) {
                        var s = e.name, l = C(s), c = useInteractive;
                        if (a) {
                            i = a;
                        }
                        if (c) {
                            useInteractive = false;
                        }
                        x(l);
                        if (hasProp(o.config, t)) {
                            o.config[s] = o.config[t];
                        }
                        try {
                            req.exec(i);
                        } catch (u) {
                            return S(makeError("fromtexteval", "fromText eval for " + t + " failed: " + u, u, [ t ]));
                        }
                        if (c) {
                            useInteractive = true;
                        }
                        this.depMaps.push(l);
                        n.completeLoad(s);
                        d([ s ], r);
                    });
                    i.load(e.name, d, r, o);
                }));
                n.enable(i, this);
                this.pluginMaps[i.id] = i;
            },
            enable: function() {
                l[this.map.id] = this;
                this.enabled = true;
                this.enabling = true;
                each(this.depMaps, bind(this, function(e, t) {
                    var i, a, o;
                    if (typeof e === "string") {
                        e = C(e, this.map.isDefine ? this.map : this.map.parentMap, false, !this.skipMap);
                        this.depMaps[t] = e;
                        o = getOwn(r, e.id);
                        if (o) {
                            this.depExports[t] = o(this);
                            return;
                        }
                        this.depCount += 1;
                        _(e, "defined", bind(this, function(e) {
                            this.defineDep(t, e);
                            this.check();
                        }));
                        if (this.errback) {
                            _(e, "error", bind(this, this.errback));
                        }
                    }
                    i = e.id;
                    a = s[i];
                    if (!hasProp(r, i) && a && !a.enabled) {
                        n.enable(e, this);
                    }
                }));
                eachProp(this.pluginMaps, bind(this, function(e) {
                    var t = getOwn(s, e.id);
                    if (t && !t.enabled) {
                        n.enable(e, this);
                    }
                }));
                this.enabling = false;
                this.check();
            },
            on: function(e, t) {
                var i = this.events[e];
                if (!i) {
                    i = this.events[e] = [];
                }
                i.push(t);
            },
            emit: function(e, t) {
                each(this.events[e], function(e) {
                    e(t);
                });
                if (e === "error") {
                    delete this.events[e];
                }
            }
        };
        function P(e) {
            if (!hasProp(f, e[0])) {
                x(C(e[0], null, true)).init(e[1], e[2]);
            }
        }
        function I(e, t, i, n) {
            if (e.detachEvent && !isOpera) {
                if (n) {
                    e.detachEvent(n, t);
                }
            } else {
                e.removeEventListener(i, t, false);
            }
        }
        function O(e) {
            var t = e.currentTarget || e.srcElement;
            I(t, n.onScriptLoad, "load", "onreadystatechange");
            I(t, n.onScriptError, "error");
            return {
                node: t,
                id: t && t.getAttribute("data-requiremodule")
            };
        }
        function D() {
            var e;
            k();
            while (u.length) {
                e = u.shift();
                if (e[0] === null) {
                    return S(makeError("mismatch", "Mismatched anonymous define() module: " + e[e.length - 1]));
                } else {
                    P(e);
                }
            }
        }
        n = {
            config: o,
            contextName: e,
            registry: s,
            defined: f,
            urlFetched: d,
            defQueue: u,
            Module: i,
            makeModuleMap: C,
            nextTick: req.nextTick,
            onError: S,
            configure: function(e) {
                if (e.baseUrl) {
                    if (e.baseUrl.charAt(e.baseUrl.length - 1) !== "/") {
                        e.baseUrl += "/";
                    }
                }
                var t = o.shim, i = {
                    paths: true,
                    bundles: true,
                    config: true,
                    map: true
                };
                eachProp(e, function(e, t) {
                    if (i[t]) {
                        if (!o[t]) {
                            o[t] = {};
                        }
                        mixin(o[t], e, true, true);
                    } else {
                        o[t] = e;
                    }
                });
                if (e.bundles) {
                    eachProp(e.bundles, function(e, t) {
                        each(e, function(e) {
                            if (e !== t) {
                                h[e] = t;
                            }
                        });
                    });
                }
                if (e.shim) {
                    eachProp(e.shim, function(e, i) {
                        if (isArray(e)) {
                            e = {
                                deps: e
                            };
                        }
                        if ((e.exports || e.init) && !e.exportsFn) {
                            e.exportsFn = n.makeShimExports(e);
                        }
                        t[i] = e;
                    });
                    o.shim = t;
                }
                if (e.packages) {
                    each(e.packages, function(e) {
                        var t, i;
                        e = typeof e === "string" ? {
                            name: e
                        } : e;
                        i = e.name;
                        t = e.location;
                        if (t) {
                            o.paths[i] = e.location;
                        }
                        o.pkgs[i] = e.name + "/" + (e.main || "main").replace(currDirRegExp, "").replace(jsSuffixRegExp, "");
                    });
                }
                eachProp(s, function(e, t) {
                    if (!e.inited && !e.map.unnormalized) {
                        e.map = C(t);
                    }
                });
                if (e.deps || e.callback) {
                    n.require(e.deps || [], e.callback);
                }
            },
            makeShimExports: function(e) {
                function t() {
                    var t;
                    if (e.init) {
                        t = e.init.apply(global, arguments);
                    }
                    return t || e.exports && getGlobal(e.exports);
                }
                return t;
            },
            makeRequire: function(t, i) {
                i = i || {};
                function a(o, l, c) {
                    var u, d, h;
                    if (i.enableBuildCallback && l && isFunction(l)) {
                        l.__requireJsBuild = true;
                    }
                    if (typeof o === "string") {
                        if (isFunction(l)) {
                            return S(makeError("requireargs", "Invalid require call"), c);
                        }
                        if (t && hasProp(r, o)) {
                            return r[o](s[t.id]);
                        }
                        if (req.get) {
                            return req.get(n, o, t, a);
                        }
                        d = C(o, t, false, true);
                        u = d.id;
                        if (!hasProp(f, u)) {
                            return S(makeError("notloaded", 'Module name "' + u + '" has not been loaded yet for context: ' + e + (t ? "" : ". Use require([])")));
                        }
                        return f[u];
                    }
                    D();
                    n.nextTick(function() {
                        D();
                        h = x(C(null, t));
                        h.skipMap = i.skipMap;
                        h.init(o, l, c, {
                            enabled: true
                        });
                        T();
                    });
                    return a;
                }
                mixin(a, {
                    isBrowser: isBrowser,
                    toUrl: function(e) {
                        var i, r = e.lastIndexOf("."), a = e.split("/")[0], o = a === "." || a === "..";
                        if (r !== -1 && (!o || r > 1)) {
                            i = e.substring(r, e.length);
                            e = e.substring(0, r);
                        }
                        return n.nameToUrl(v(e, t && t.id, true), i, true);
                    },
                    defined: function(e) {
                        return hasProp(f, C(e, t, false, true).id);
                    },
                    specified: function(e) {
                        e = C(e, t, false, true).id;
                        return hasProp(f, e) || hasProp(s, e);
                    }
                });
                if (!t) {
                    a.undef = function(e) {
                        k();
                        var i = C(e, t, true), n = getOwn(s, e);
                        y(e);
                        delete f[e];
                        delete d[i.url];
                        delete c[e];
                        eachReverse(u, function(t, i) {
                            if (t[0] === e) {
                                u.splice(i, 1);
                            }
                        });
                        if (n) {
                            if (n.events.defined) {
                                c[e] = n.events;
                            }
                            A(e);
                        }
                    };
                }
                return a;
            },
            enable: function(e) {
                var t = getOwn(s, e.id);
                if (t) {
                    x(e).enable();
                }
            },
            completeLoad: function(e) {
                var t, i, n, r = getOwn(o.shim, e) || {}, a = r.exports;
                k();
                while (u.length) {
                    i = u.shift();
                    if (i[0] === null) {
                        i[0] = e;
                        if (t) {
                            break;
                        }
                        t = true;
                    } else if (i[0] === e) {
                        t = true;
                    }
                    P(i);
                }
                n = getOwn(s, e);
                if (!t && !hasProp(f, e) && n && !n.inited) {
                    if (o.enforceDefine && (!a || !getGlobal(a))) {
                        if (b(e)) {
                            return;
                        } else {
                            return S(makeError("nodefine", "No define call for " + e, null, [ e ]));
                        }
                    } else {
                        P([ e, r.deps || [], r.exportsFn ]);
                    }
                }
                T();
            },
            nameToUrl: function(e, t, i) {
                var r, a, s, l, c, u, f, d = getOwn(o.pkgs, e);
                if (d) {
                    e = d;
                }
                f = getOwn(h, e);
                if (f) {
                    return n.nameToUrl(f, t, i);
                }
                if (req.jsExtRegExp.test(e)) {
                    c = e + (t || "");
                } else {
                    r = o.paths;
                    a = e.split("/");
                    for (s = a.length; s > 0; s -= 1) {
                        l = a.slice(0, s).join("/");
                        u = getOwn(r, l);
                        if (u) {
                            if (isArray(u)) {
                                u = u[0];
                            }
                            a.splice(0, s, u);
                            break;
                        }
                    }
                    c = a.join("/");
                    c += t || (/^data\:|\?/.test(c) || i ? "" : ".js");
                    c = (c.charAt(0) === "/" || c.match(/^[\w\+\.\-]+:/) ? "" : o.baseUrl) + c;
                }
                return o.urlArgs ? c + ((c.indexOf("?") === -1 ? "?" : "&") + o.urlArgs) : c;
            },
            load: function(e, t) {
                req.load(n, e, t);
            },
            execCb: function(e, t, i, n) {
                return t.apply(n, i);
            },
            onScriptLoad: function(e) {
                if (e.type === "load" || readyRegExp.test((e.currentTarget || e.srcElement).readyState)) {
                    interactiveScript = null;
                    var t = O(e);
                    n.completeLoad(t.id);
                }
            },
            onScriptError: function(e) {
                var t = O(e);
                if (!b(t.id)) {
                    return S(makeError("scripterror", "Script error for: " + t.id, e, [ t.id ]));
                }
            }
        };
        n.require = n.makeRequire();
        return n;
    }
    req = requirejs = function(e, t, i, n) {
        var r, a, o = defContextName;
        if (!isArray(e) && typeof e !== "string") {
            a = e;
            if (isArray(t)) {
                e = t;
                t = i;
                i = n;
            } else {
                e = [];
            }
        }
        if (a && a.context) {
            o = a.context;
        }
        r = getOwn(contexts, o);
        if (!r) {
            r = contexts[o] = req.s.newContext(o);
        }
        if (a) {
            r.configure(a);
        }
        return r.require(e, t, i);
    };
    req.config = function(e) {
        return req(e);
    };
    req.nextTick = typeof setTimeout !== "undefined" ? function(e) {
        setTimeout(e, 4);
    } : function(e) {
        e();
    };
    if (!require) {
        require = req;
    }
    req.version = version;
    req.jsExtRegExp = /^\/|:|\?|\.js$/;
    req.isBrowser = isBrowser;
    s = req.s = {
        contexts: contexts,
        newContext: newContext
    };
    req({});
    each([ "toUrl", "undef", "defined", "specified" ], function(e) {
        req[e] = function() {
            var t = contexts[defContextName];
            return t.require[e].apply(t, arguments);
        };
    });
    if (isBrowser) {
        head = s.head = document.getElementsByTagName("head")[0];
        baseElement = document.getElementsByTagName("base")[0];
        if (baseElement) {
            head = s.head = baseElement.parentNode;
        }
    }
    req.onError = defaultOnError;
    req.createNode = function(e, t, i) {
        var n = e.xhtml ? document.createElementNS("http://www.w3.org/1999/xhtml", "html:script") : document.createElement("script");
        n.type = e.scriptType || "text/javascript";
        n.charset = "utf-8";
        n.async = true;
        return n;
    };
    req.load = function(e, t, i) {
        var n = e && e.config || {}, r;
        if (isBrowser) {
            r = req.createNode(n, t, i);
            r.setAttribute("data-requirecontext", e.contextName);
            r.setAttribute("data-requiremodule", t);
            if (r.attachEvent && !(r.attachEvent.toString && r.attachEvent.toString().indexOf("[native code") < 0) && !isOpera) {
                useInteractive = true;
                r.attachEvent("onreadystatechange", e.onScriptLoad);
            } else {
                r.addEventListener("load", e.onScriptLoad, false);
                r.addEventListener("error", e.onScriptError, false);
            }
            r.src = i;
            currentlyAddingScript = r;
            if (baseElement) {
                head.insertBefore(r, baseElement);
            } else {
                head.appendChild(r);
            }
            currentlyAddingScript = null;
            return r;
        } else if (isWebWorker) {
            try {
                importScripts(i);
                e.completeLoad(t);
            } catch (a) {
                e.onError(makeError("importscripts", "importScripts failed for " + t + " at " + i, a, [ t ]));
            }
        }
    };
    function getInteractiveScript() {
        if (interactiveScript && interactiveScript.readyState === "interactive") {
            return interactiveScript;
        }
        eachReverse(scripts(), function(e) {
            if (e.readyState === "interactive") {
                return interactiveScript = e;
            }
        });
        return interactiveScript;
    }
    if (isBrowser && !cfg.skipDataMain) {
        eachReverse(scripts(), function(e) {
            if (!head) {
                head = e.parentNode;
            }
            dataMain = e.getAttribute("data-main");
            if (dataMain) {
                mainScript = dataMain;
                if (!cfg.baseUrl) {
                    src = mainScript.split("/");
                    mainScript = src.pop();
                    subPath = src.length ? src.join("/") + "/" : "./";
                    cfg.baseUrl = subPath;
                }
                mainScript = mainScript.replace(jsSuffixRegExp, "");
                if (req.jsExtRegExp.test(mainScript)) {
                    mainScript = dataMain;
                }
                cfg.deps = cfg.deps ? cfg.deps.concat(mainScript) : [ mainScript ];
                return true;
            }
        });
    }
    define = function(e, t, i) {
        var n, r;
        if (typeof e !== "string") {
            i = t;
            t = e;
            e = null;
        }
        if (!isArray(t)) {
            i = t;
            t = null;
        }
        if (!t && isFunction(i)) {
            t = [];
            if (i.length) {
                i.toString().replace(commentRegExp, "").replace(cjsRequireRegExp, function(e, i) {
                    t.push(i);
                });
                t = (i.length === 1 ? [ "require" ] : [ "require", "exports", "module" ]).concat(t);
            }
        }
        if (useInteractive) {
            n = currentlyAddingScript || getInteractiveScript();
            if (n) {
                if (!e) {
                    e = n.getAttribute("data-requiremodule");
                }
                r = contexts[n.getAttribute("data-requirecontext")];
            }
        }
        (r ? r.defQueue : globalDefQueue).push([ e, t, i ]);
    };
    define.amd = {
        jQuery: true
    };
    req.exec = function(text) {
        return eval(text);
    };
    req(cfg);
})(this);

define("jspdf", function(e) {
    return function() {
        var t, i;
        return t || e.jsPDF;
    };
}(this));

define("localeConfigurator", [], function() {
    require.config({
        locale: window && window.location && window.location.pathname && window.location.pathname.replace(/\//gi, "") || navigator.language || navigator.userLanguage,
        i18n: {
            nls: "localization"
        }
    });
});

(function(e, t) {
    var i, n, r = typeof t, a = e.location, o = e.document, s = o.documentElement, l = e.jQuery, c = e.$, u = {}, f = [], d = "2.0.3", h = f.concat, p = f.push, g = f.slice, m = f.indexOf, v = u.toString, y = u.hasOwnProperty, b = d.trim, w = function(e, t) {
        return new w.fn.init(e, t, i);
    }, C = /[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source, x = /\S+/g, _ = /^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/, S = /^<(\w+)\s*\/?>(?:<\/\1>|)$/, k = /^-ms-/, A = /-([\da-z])/gi, E = function(e, t) {
        return t.toUpperCase();
    }, T = function() {
        o.removeEventListener("DOMContentLoaded", T, false);
        e.removeEventListener("load", T, false);
        w.ready();
    };
    w.fn = w.prototype = {
        jquery: d,
        constructor: w,
        init: function(e, i, n) {
            var r, a;
            if (!e) {
                return this;
            }
            if (typeof e === "string") {
                if (e.charAt(0) === "<" && e.charAt(e.length - 1) === ">" && e.length >= 3) {
                    r = [ null, e, null ];
                } else {
                    r = _.exec(e);
                }
                if (r && (r[1] || !i)) {
                    if (r[1]) {
                        i = i instanceof w ? i[0] : i;
                        w.merge(this, w.parseHTML(r[1], i && i.nodeType ? i.ownerDocument || i : o, true));
                        if (S.test(r[1]) && w.isPlainObject(i)) {
                            for (r in i) {
                                if (w.isFunction(this[r])) {
                                    this[r](i[r]);
                                } else {
                                    this.attr(r, i[r]);
                                }
                            }
                        }
                        return this;
                    } else {
                        a = o.getElementById(r[2]);
                        if (a && a.parentNode) {
                            this.length = 1;
                            this[0] = a;
                        }
                        this.context = o;
                        this.selector = e;
                        return this;
                    }
                } else if (!i || i.jquery) {
                    return (i || n).find(e);
                } else {
                    return this.constructor(i).find(e);
                }
            } else if (e.nodeType) {
                this.context = this[0] = e;
                this.length = 1;
                return this;
            } else if (w.isFunction(e)) {
                return n.ready(e);
            }
            if (e.selector !== t) {
                this.selector = e.selector;
                this.context = e.context;
            }
            return w.makeArray(e, this);
        },
        selector: "",
        length: 0,
        toArray: function() {
            return g.call(this);
        },
        get: function(e) {
            return e == null ? this.toArray() : e < 0 ? this[this.length + e] : this[e];
        },
        pushStack: function(e) {
            var t = w.merge(this.constructor(), e);
            t.prevObject = this;
            t.context = this.context;
            return t;
        },
        each: function(e, t) {
            return w.each(this, e, t);
        },
        ready: function(e) {
            w.ready.promise().done(e);
            return this;
        },
        slice: function() {
            return this.pushStack(g.apply(this, arguments));
        },
        first: function() {
            return this.eq(0);
        },
        last: function() {
            return this.eq(-1);
        },
        eq: function(e) {
            var t = this.length, i = +e + (e < 0 ? t : 0);
            return this.pushStack(i >= 0 && i < t ? [ this[i] ] : []);
        },
        map: function(e) {
            return this.pushStack(w.map(this, function(t, i) {
                return e.call(t, i, t);
            }));
        },
        end: function() {
            return this.prevObject || this.constructor(null);
        },
        push: p,
        sort: [].sort,
        splice: [].splice
    };
    w.fn.init.prototype = w.fn;
    w.extend = w.fn.extend = function() {
        var e, i, n, r, a, o, s = arguments[0] || {}, l = 1, c = arguments.length, u = false;
        if (typeof s === "boolean") {
            u = s;
            s = arguments[1] || {};
            l = 2;
        }
        if (typeof s !== "object" && !w.isFunction(s)) {
            s = {};
        }
        if (c === l) {
            s = this;
            --l;
        }
        for (;l < c; l++) {
            if ((e = arguments[l]) != null) {
                for (i in e) {
                    n = s[i];
                    r = e[i];
                    if (s === r) {
                        continue;
                    }
                    if (u && r && (w.isPlainObject(r) || (a = w.isArray(r)))) {
                        if (a) {
                            a = false;
                            o = n && w.isArray(n) ? n : [];
                        } else {
                            o = n && w.isPlainObject(n) ? n : {};
                        }
                        s[i] = w.extend(u, o, r);
                    } else if (r !== t) {
                        s[i] = r;
                    }
                }
            }
        }
        return s;
    };
    w.extend({
        expando: "jQuery" + (d + Math.random()).replace(/\D/g, ""),
        noConflict: function(t) {
            if (e.$ === w) {
                e.$ = c;
            }
            if (t && e.jQuery === w) {
                e.jQuery = l;
            }
            return w;
        },
        isReady: false,
        readyWait: 1,
        holdReady: function(e) {
            if (e) {
                w.readyWait++;
            } else {
                w.ready(true);
            }
        },
        ready: function(e) {
            if (e === true ? --w.readyWait : w.isReady) {
                return;
            }
            w.isReady = true;
            if (e !== true && --w.readyWait > 0) {
                return;
            }
            n.resolveWith(o, [ w ]);
            if (w.fn.trigger) {
                w(o).trigger("ready").off("ready");
            }
        },
        isFunction: function(e) {
            return w.type(e) === "function";
        },
        isArray: Array.isArray,
        isWindow: function(e) {
            return e != null && e === e.window;
        },
        isNumeric: function(e) {
            return !isNaN(parseFloat(e)) && isFinite(e);
        },
        type: function(e) {
            if (e == null) {
                return String(e);
            }
            return typeof e === "object" || typeof e === "function" ? u[v.call(e)] || "object" : typeof e;
        },
        isPlainObject: function(e) {
            if (w.type(e) !== "object" || e.nodeType || w.isWindow(e)) {
                return false;
            }
            try {
                if (e.constructor && !y.call(e.constructor.prototype, "isPrototypeOf")) {
                    return false;
                }
            } catch (t) {
                return false;
            }
            return true;
        },
        isEmptyObject: function(e) {
            var t;
            for (t in e) {
                return false;
            }
            return true;
        },
        error: function(e) {
            throw new Error(e);
        },
        parseHTML: function(e, t, i) {
            if (!e || typeof e !== "string") {
                return null;
            }
            if (typeof t === "boolean") {
                i = t;
                t = false;
            }
            t = t || o;
            var n = S.exec(e), r = !i && [];
            if (n) {
                return [ t.createElement(n[1]) ];
            }
            n = w.buildFragment([ e ], t, r);
            if (r) {
                w(r).remove();
            }
            return w.merge([], n.childNodes);
        },
        parseJSON: JSON.parse,
        parseXML: function(e) {
            var i, n;
            if (!e || typeof e !== "string") {
                return null;
            }
            try {
                n = new DOMParser();
                i = n.parseFromString(e, "text/xml");
            } catch (r) {
                i = t;
            }
            if (!i || i.getElementsByTagName("parsererror").length) {
                w.error("Invalid XML: " + e);
            }
            return i;
        },
        noop: function() {},
        globalEval: function(e) {
            var t, i = eval;
            e = w.trim(e);
            if (e) {
                if (e.indexOf("use strict") === 1) {
                    t = o.createElement("script");
                    t.text = e;
                    o.head.appendChild(t).parentNode.removeChild(t);
                } else {
                    i(e);
                }
            }
        },
        camelCase: function(e) {
            return e.replace(k, "ms-").replace(A, E);
        },
        nodeName: function(e, t) {
            return e.nodeName && e.nodeName.toLowerCase() === t.toLowerCase();
        },
        each: function(e, t, i) {
            var n, r = 0, a = e.length, o = P(e);
            if (i) {
                if (o) {
                    for (;r < a; r++) {
                        n = t.apply(e[r], i);
                        if (n === false) {
                            break;
                        }
                    }
                } else {
                    for (r in e) {
                        n = t.apply(e[r], i);
                        if (n === false) {
                            break;
                        }
                    }
                }
            } else {
                if (o) {
                    for (;r < a; r++) {
                        n = t.call(e[r], r, e[r]);
                        if (n === false) {
                            break;
                        }
                    }
                } else {
                    for (r in e) {
                        n = t.call(e[r], r, e[r]);
                        if (n === false) {
                            break;
                        }
                    }
                }
            }
            return e;
        },
        trim: function(e) {
            return e == null ? "" : b.call(e);
        },
        makeArray: function(e, t) {
            var i = t || [];
            if (e != null) {
                if (P(Object(e))) {
                    w.merge(i, typeof e === "string" ? [ e ] : e);
                } else {
                    p.call(i, e);
                }
            }
            return i;
        },
        inArray: function(e, t, i) {
            return t == null ? -1 : m.call(t, e, i);
        },
        merge: function(e, i) {
            var n = i.length, r = e.length, a = 0;
            if (typeof n === "number") {
                for (;a < n; a++) {
                    e[r++] = i[a];
                }
            } else {
                while (i[a] !== t) {
                    e[r++] = i[a++];
                }
            }
            e.length = r;
            return e;
        },
        grep: function(e, t, i) {
            var n, r = [], a = 0, o = e.length;
            i = !!i;
            for (;a < o; a++) {
                n = !!t(e[a], a);
                if (i !== n) {
                    r.push(e[a]);
                }
            }
            return r;
        },
        map: function(e, t, i) {
            var n, r = 0, a = e.length, o = P(e), s = [];
            if (o) {
                for (;r < a; r++) {
                    n = t(e[r], r, i);
                    if (n != null) {
                        s[s.length] = n;
                    }
                }
            } else {
                for (r in e) {
                    n = t(e[r], r, i);
                    if (n != null) {
                        s[s.length] = n;
                    }
                }
            }
            return h.apply([], s);
        },
        guid: 1,
        proxy: function(e, i) {
            var n, r, a;
            if (typeof i === "string") {
                n = e[i];
                i = e;
                e = n;
            }
            if (!w.isFunction(e)) {
                return t;
            }
            r = g.call(arguments, 2);
            a = function() {
                return e.apply(i || this, r.concat(g.call(arguments)));
            };
            a.guid = e.guid = e.guid || w.guid++;
            return a;
        },
        access: function(e, i, n, r, a, o, s) {
            var l = 0, c = e.length, u = n == null;
            if (w.type(n) === "object") {
                a = true;
                for (l in n) {
                    w.access(e, i, l, n[l], true, o, s);
                }
            } else if (r !== t) {
                a = true;
                if (!w.isFunction(r)) {
                    s = true;
                }
                if (u) {
                    if (s) {
                        i.call(e, r);
                        i = null;
                    } else {
                        u = i;
                        i = function(e, t, i) {
                            return u.call(w(e), i);
                        };
                    }
                }
                if (i) {
                    for (;l < c; l++) {
                        i(e[l], n, s ? r : r.call(e[l], l, i(e[l], n)));
                    }
                }
            }
            return a ? e : u ? i.call(e) : c ? i(e[0], n) : o;
        },
        now: Date.now,
        swap: function(e, t, i, n) {
            var r, a, o = {};
            for (a in t) {
                o[a] = e.style[a];
                e.style[a] = t[a];
            }
            r = i.apply(e, n || []);
            for (a in t) {
                e.style[a] = o[a];
            }
            return r;
        }
    });
    w.ready.promise = function(t) {
        if (!n) {
            n = w.Deferred();
            if (o.readyState === "complete") {
                setTimeout(w.ready);
            } else {
                o.addEventListener("DOMContentLoaded", T, false);
                e.addEventListener("load", T, false);
            }
        }
        return n.promise(t);
    };
    w.each("Boolean Number String Function Array Date RegExp Object Error".split(" "), function(e, t) {
        u["[object " + t + "]"] = t.toLowerCase();
    });
    function P(e) {
        var t = e.length, i = w.type(e);
        if (w.isWindow(e)) {
            return false;
        }
        if (e.nodeType === 1 && t) {
            return true;
        }
        return i === "array" || i !== "function" && (t === 0 || typeof t === "number" && t > 0 && t - 1 in e);
    }
    i = w(o);
    (function(e, t) {
        var i, n, r, a, o, s, l, c, u, f, d, h, p, g, m, v, y, b = "sizzle" + -new Date(), C = e.document, x = 0, _ = 0, S = st(), k = st(), A = st(), E = false, T = function(e, t) {
            if (e === t) {
                E = true;
                return 0;
            }
            return 0;
        }, P = typeof t, I = 1 << 31, O = {}.hasOwnProperty, D = [], R = D.pop, L = D.push, F = D.push, M = D.slice, N = D.indexOf || function(e) {
            var t = 0, i = this.length;
            for (;t < i; t++) {
                if (this[t] === e) {
                    return t;
                }
            }
            return -1;
        }, B = "checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped", j = "[\\x20\\t\\r\\n\\f]", U = "(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+", z = U.replace("w", "w#"), q = "\\[" + j + "*(" + U + ")" + j + "*(?:([*^$|!~]?=)" + j + "*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|(" + z + ")|)|)" + j + "*\\]", W = ":(" + U + ")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|" + q.replace(3, 8) + ")*)|.*)\\)|)", H = new RegExp("^" + j + "+|((?:^|[^\\\\])(?:\\\\.)*)" + j + "+$", "g"), G = new RegExp("^" + j + "*," + j + "*"), V = new RegExp("^" + j + "*([>+~]|" + j + ")" + j + "*"), $ = new RegExp(j + "*[+~]"), Y = new RegExp("=" + j + "*([^\\]'\"]*)" + j + "*\\]", "g"), X = new RegExp(W), J = new RegExp("^" + z + "$"), K = {
            ID: new RegExp("^#(" + U + ")"),
            CLASS: new RegExp("^\\.(" + U + ")"),
            TAG: new RegExp("^(" + U.replace("w", "w*") + ")"),
            ATTR: new RegExp("^" + q),
            PSEUDO: new RegExp("^" + W),
            CHILD: new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\(" + j + "*(even|odd|(([+-]|)(\\d*)n|)" + j + "*(?:([+-]|)" + j + "*(\\d+)|))" + j + "*\\)|)", "i"),
            bool: new RegExp("^(?:" + B + ")$", "i"),
            needsContext: new RegExp("^" + j + "*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\(" + j + "*((?:-\\d)?\\d*)" + j + "*\\)|)(?=[^-]|$)", "i")
        }, Q = /^[^{]+\{\s*\[native \w/, Z = /^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/, et = /^(?:input|select|textarea|button)$/i, tt = /^h\d$/i, it = /'|\\/g, nt = new RegExp("\\\\([\\da-f]{1,6}" + j + "?|(" + j + ")|.)", "ig"), rt = function(e, t, i) {
            var n = "0x" + t - 65536;
            return n !== n || i ? t : n < 0 ? String.fromCharCode(n + 65536) : String.fromCharCode(n >> 10 | 55296, n & 1023 | 56320);
        };
        try {
            F.apply(D = M.call(C.childNodes), C.childNodes);
            D[C.childNodes.length].nodeType;
        } catch (at) {
            F = {
                apply: D.length ? function(e, t) {
                    L.apply(e, M.call(t));
                } : function(e, t) {
                    var i = e.length, n = 0;
                    while (e[i++] = t[n++]) {}
                    e.length = i - 1;
                }
            };
        }
        function ot(e, t, i, r) {
            var a, o, s, l, c, u, h, m, v, w;
            if ((t ? t.ownerDocument || t : C) !== d) {
                f(t);
            }
            t = t || d;
            i = i || [];
            if (!e || typeof e !== "string") {
                return i;
            }
            if ((l = t.nodeType) !== 1 && l !== 9) {
                return [];
            }
            if (p && !r) {
                if (a = Z.exec(e)) {
                    if (s = a[1]) {
                        if (l === 9) {
                            o = t.getElementById(s);
                            if (o && o.parentNode) {
                                if (o.id === s) {
                                    i.push(o);
                                    return i;
                                }
                            } else {
                                return i;
                            }
                        } else {
                            if (t.ownerDocument && (o = t.ownerDocument.getElementById(s)) && y(t, o) && o.id === s) {
                                i.push(o);
                                return i;
                            }
                        }
                    } else if (a[2]) {
                        F.apply(i, t.getElementsByTagName(e));
                        return i;
                    } else if ((s = a[3]) && n.getElementsByClassName && t.getElementsByClassName) {
                        F.apply(i, t.getElementsByClassName(s));
                        return i;
                    }
                }
                if (n.qsa && (!g || !g.test(e))) {
                    m = h = b;
                    v = t;
                    w = l === 9 && e;
                    if (l === 1 && t.nodeName.toLowerCase() !== "object") {
                        u = mt(e);
                        if (h = t.getAttribute("id")) {
                            m = h.replace(it, "\\$&");
                        } else {
                            t.setAttribute("id", m);
                        }
                        m = "[id='" + m + "'] ";
                        c = u.length;
                        while (c--) {
                            u[c] = m + vt(u[c]);
                        }
                        v = $.test(e) && t.parentNode || t;
                        w = u.join(",");
                    }
                    if (w) {
                        try {
                            F.apply(i, v.querySelectorAll(w));
                            return i;
                        } catch (x) {} finally {
                            if (!h) {
                                t.removeAttribute("id");
                            }
                        }
                    }
                }
            }
            return kt(e.replace(H, "$1"), t, i, r);
        }
        function st() {
            var e = [];
            function t(i, n) {
                if (e.push(i += " ") > a.cacheLength) {
                    delete t[e.shift()];
                }
                return t[i] = n;
            }
            return t;
        }
        function lt(e) {
            e[b] = true;
            return e;
        }
        function ct(e) {
            var t = d.createElement("div");
            try {
                return !!e(t);
            } catch (i) {
                return false;
            } finally {
                if (t.parentNode) {
                    t.parentNode.removeChild(t);
                }
                t = null;
            }
        }
        function ut(e, t) {
            var i = e.split("|"), n = e.length;
            while (n--) {
                a.attrHandle[i[n]] = t;
            }
        }
        function ft(e, t) {
            var i = t && e, n = i && e.nodeType === 1 && t.nodeType === 1 && (~t.sourceIndex || I) - (~e.sourceIndex || I);
            if (n) {
                return n;
            }
            if (i) {
                while (i = i.nextSibling) {
                    if (i === t) {
                        return -1;
                    }
                }
            }
            return e ? 1 : -1;
        }
        function dt(e) {
            return function(t) {
                var i = t.nodeName.toLowerCase();
                return i === "input" && t.type === e;
            };
        }
        function ht(e) {
            return function(t) {
                var i = t.nodeName.toLowerCase();
                return (i === "input" || i === "button") && t.type === e;
            };
        }
        function pt(e) {
            return lt(function(t) {
                t = +t;
                return lt(function(i, n) {
                    var r, a = e([], i.length, t), o = a.length;
                    while (o--) {
                        if (i[r = a[o]]) {
                            i[r] = !(n[r] = i[r]);
                        }
                    }
                });
            });
        }
        s = ot.isXML = function(e) {
            var t = e && (e.ownerDocument || e).documentElement;
            return t ? t.nodeName !== "HTML" : false;
        };
        n = ot.support = {};
        f = ot.setDocument = function(e) {
            var t = e ? e.ownerDocument || e : C, i = t.defaultView;
            if (t === d || t.nodeType !== 9 || !t.documentElement) {
                return d;
            }
            d = t;
            h = t.documentElement;
            p = !s(t);
            if (i && i.attachEvent && i !== i.top) {
                i.attachEvent("onbeforeunload", function() {
                    f();
                });
            }
            n.attributes = ct(function(e) {
                e.className = "i";
                return !e.getAttribute("className");
            });
            n.getElementsByTagName = ct(function(e) {
                e.appendChild(t.createComment(""));
                return !e.getElementsByTagName("*").length;
            });
            n.getElementsByClassName = ct(function(e) {
                e.innerHTML = "<div class='a'></div><div class='a i'></div>";
                e.firstChild.className = "i";
                return e.getElementsByClassName("i").length === 2;
            });
            n.getById = ct(function(e) {
                h.appendChild(e).id = b;
                return !t.getElementsByName || !t.getElementsByName(b).length;
            });
            if (n.getById) {
                a.find["ID"] = function(e, t) {
                    if (typeof t.getElementById !== P && p) {
                        var i = t.getElementById(e);
                        return i && i.parentNode ? [ i ] : [];
                    }
                };
                a.filter["ID"] = function(e) {
                    var t = e.replace(nt, rt);
                    return function(e) {
                        return e.getAttribute("id") === t;
                    };
                };
            } else {
                delete a.find["ID"];
                a.filter["ID"] = function(e) {
                    var t = e.replace(nt, rt);
                    return function(e) {
                        var i = typeof e.getAttributeNode !== P && e.getAttributeNode("id");
                        return i && i.value === t;
                    };
                };
            }
            a.find["TAG"] = n.getElementsByTagName ? function(e, t) {
                if (typeof t.getElementsByTagName !== P) {
                    return t.getElementsByTagName(e);
                }
            } : function(e, t) {
                var i, n = [], r = 0, a = t.getElementsByTagName(e);
                if (e === "*") {
                    while (i = a[r++]) {
                        if (i.nodeType === 1) {
                            n.push(i);
                        }
                    }
                    return n;
                }
                return a;
            };
            a.find["CLASS"] = n.getElementsByClassName && function(e, t) {
                if (typeof t.getElementsByClassName !== P && p) {
                    return t.getElementsByClassName(e);
                }
            };
            m = [];
            g = [];
            if (n.qsa = Q.test(t.querySelectorAll)) {
                ct(function(e) {
                    e.innerHTML = "<select><option selected=''></option></select>";
                    if (!e.querySelectorAll("[selected]").length) {
                        g.push("\\[" + j + "*(?:value|" + B + ")");
                    }
                    if (!e.querySelectorAll(":checked").length) {
                        g.push(":checked");
                    }
                });
                ct(function(e) {
                    var i = t.createElement("input");
                    i.setAttribute("type", "hidden");
                    e.appendChild(i).setAttribute("t", "");
                    if (e.querySelectorAll("[t^='']").length) {
                        g.push("[*^$]=" + j + "*(?:''|\"\")");
                    }
                    if (!e.querySelectorAll(":enabled").length) {
                        g.push(":enabled", ":disabled");
                    }
                    e.querySelectorAll("*,:x");
                    g.push(",.*:");
                });
            }
            if (n.matchesSelector = Q.test(v = h.webkitMatchesSelector || h.mozMatchesSelector || h.oMatchesSelector || h.msMatchesSelector)) {
                ct(function(e) {
                    n.disconnectedMatch = v.call(e, "div");
                    v.call(e, "[s!='']:x");
                    m.push("!=", W);
                });
            }
            g = g.length && new RegExp(g.join("|"));
            m = m.length && new RegExp(m.join("|"));
            y = Q.test(h.contains) || h.compareDocumentPosition ? function(e, t) {
                var i = e.nodeType === 9 ? e.documentElement : e, n = t && t.parentNode;
                return e === n || !!(n && n.nodeType === 1 && (i.contains ? i.contains(n) : e.compareDocumentPosition && e.compareDocumentPosition(n) & 16));
            } : function(e, t) {
                if (t) {
                    while (t = t.parentNode) {
                        if (t === e) {
                            return true;
                        }
                    }
                }
                return false;
            };
            T = h.compareDocumentPosition ? function(e, i) {
                if (e === i) {
                    E = true;
                    return 0;
                }
                var r = i.compareDocumentPosition && e.compareDocumentPosition && e.compareDocumentPosition(i);
                if (r) {
                    if (r & 1 || !n.sortDetached && i.compareDocumentPosition(e) === r) {
                        if (e === t || y(C, e)) {
                            return -1;
                        }
                        if (i === t || y(C, i)) {
                            return 1;
                        }
                        return u ? N.call(u, e) - N.call(u, i) : 0;
                    }
                    return r & 4 ? -1 : 1;
                }
                return e.compareDocumentPosition ? -1 : 1;
            } : function(e, i) {
                var n, r = 0, a = e.parentNode, o = i.parentNode, s = [ e ], l = [ i ];
                if (e === i) {
                    E = true;
                    return 0;
                } else if (!a || !o) {
                    return e === t ? -1 : i === t ? 1 : a ? -1 : o ? 1 : u ? N.call(u, e) - N.call(u, i) : 0;
                } else if (a === o) {
                    return ft(e, i);
                }
                n = e;
                while (n = n.parentNode) {
                    s.unshift(n);
                }
                n = i;
                while (n = n.parentNode) {
                    l.unshift(n);
                }
                while (s[r] === l[r]) {
                    r++;
                }
                return r ? ft(s[r], l[r]) : s[r] === C ? -1 : l[r] === C ? 1 : 0;
            };
            return t;
        };
        ot.matches = function(e, t) {
            return ot(e, null, null, t);
        };
        ot.matchesSelector = function(e, t) {
            if ((e.ownerDocument || e) !== d) {
                f(e);
            }
            t = t.replace(Y, "='$1']");
            if (n.matchesSelector && p && (!m || !m.test(t)) && (!g || !g.test(t))) {
                try {
                    var i = v.call(e, t);
                    if (i || n.disconnectedMatch || e.document && e.document.nodeType !== 11) {
                        return i;
                    }
                } catch (r) {}
            }
            return ot(t, d, null, [ e ]).length > 0;
        };
        ot.contains = function(e, t) {
            if ((e.ownerDocument || e) !== d) {
                f(e);
            }
            return y(e, t);
        };
        ot.attr = function(e, i) {
            if ((e.ownerDocument || e) !== d) {
                f(e);
            }
            var r = a.attrHandle[i.toLowerCase()], o = r && O.call(a.attrHandle, i.toLowerCase()) ? r(e, i, !p) : t;
            return o === t ? n.attributes || !p ? e.getAttribute(i) : (o = e.getAttributeNode(i)) && o.specified ? o.value : null : o;
        };
        ot.error = function(e) {
            throw new Error("Syntax error, unrecognized expression: " + e);
        };
        ot.uniqueSort = function(e) {
            var t, i = [], r = 0, a = 0;
            E = !n.detectDuplicates;
            u = !n.sortStable && e.slice(0);
            e.sort(T);
            if (E) {
                while (t = e[a++]) {
                    if (t === e[a]) {
                        r = i.push(a);
                    }
                }
                while (r--) {
                    e.splice(i[r], 1);
                }
            }
            return e;
        };
        o = ot.getText = function(e) {
            var t, i = "", n = 0, r = e.nodeType;
            if (!r) {
                for (;t = e[n]; n++) {
                    i += o(t);
                }
            } else if (r === 1 || r === 9 || r === 11) {
                if (typeof e.textContent === "string") {
                    return e.textContent;
                } else {
                    for (e = e.firstChild; e; e = e.nextSibling) {
                        i += o(e);
                    }
                }
            } else if (r === 3 || r === 4) {
                return e.nodeValue;
            }
            return i;
        };
        a = ot.selectors = {
            cacheLength: 50,
            createPseudo: lt,
            match: K,
            attrHandle: {},
            find: {},
            relative: {
                ">": {
                    dir: "parentNode",
                    first: true
                },
                " ": {
                    dir: "parentNode"
                },
                "+": {
                    dir: "previousSibling",
                    first: true
                },
                "~": {
                    dir: "previousSibling"
                }
            },
            preFilter: {
                ATTR: function(e) {
                    e[1] = e[1].replace(nt, rt);
                    e[3] = (e[4] || e[5] || "").replace(nt, rt);
                    if (e[2] === "~=") {
                        e[3] = " " + e[3] + " ";
                    }
                    return e.slice(0, 4);
                },
                CHILD: function(e) {
                    e[1] = e[1].toLowerCase();
                    if (e[1].slice(0, 3) === "nth") {
                        if (!e[3]) {
                            ot.error(e[0]);
                        }
                        e[4] = +(e[4] ? e[5] + (e[6] || 1) : 2 * (e[3] === "even" || e[3] === "odd"));
                        e[5] = +(e[7] + e[8] || e[3] === "odd");
                    } else if (e[3]) {
                        ot.error(e[0]);
                    }
                    return e;
                },
                PSEUDO: function(e) {
                    var i, n = !e[5] && e[2];
                    if (K["CHILD"].test(e[0])) {
                        return null;
                    }
                    if (e[3] && e[4] !== t) {
                        e[2] = e[4];
                    } else if (n && X.test(n) && (i = mt(n, true)) && (i = n.indexOf(")", n.length - i) - n.length)) {
                        e[0] = e[0].slice(0, i);
                        e[2] = n.slice(0, i);
                    }
                    return e.slice(0, 3);
                }
            },
            filter: {
                TAG: function(e) {
                    var t = e.replace(nt, rt).toLowerCase();
                    return e === "*" ? function() {
                        return true;
                    } : function(e) {
                        return e.nodeName && e.nodeName.toLowerCase() === t;
                    };
                },
                CLASS: function(e) {
                    var t = S[e + " "];
                    return t || (t = new RegExp("(^|" + j + ")" + e + "(" + j + "|$)")) && S(e, function(e) {
                        return t.test(typeof e.className === "string" && e.className || typeof e.getAttribute !== P && e.getAttribute("class") || "");
                    });
                },
                ATTR: function(e, t, i) {
                    return function(n) {
                        var r = ot.attr(n, e);
                        if (r == null) {
                            return t === "!=";
                        }
                        if (!t) {
                            return true;
                        }
                        r += "";
                        return t === "=" ? r === i : t === "!=" ? r !== i : t === "^=" ? i && r.indexOf(i) === 0 : t === "*=" ? i && r.indexOf(i) > -1 : t === "$=" ? i && r.slice(-i.length) === i : t === "~=" ? (" " + r + " ").indexOf(i) > -1 : t === "|=" ? r === i || r.slice(0, i.length + 1) === i + "-" : false;
                    };
                },
                CHILD: function(e, t, i, n, r) {
                    var a = e.slice(0, 3) !== "nth", o = e.slice(-4) !== "last", s = t === "of-type";
                    return n === 1 && r === 0 ? function(e) {
                        return !!e.parentNode;
                    } : function(t, i, l) {
                        var c, u, f, d, h, p, g = a !== o ? "nextSibling" : "previousSibling", m = t.parentNode, v = s && t.nodeName.toLowerCase(), y = !l && !s;
                        if (m) {
                            if (a) {
                                while (g) {
                                    f = t;
                                    while (f = f[g]) {
                                        if (s ? f.nodeName.toLowerCase() === v : f.nodeType === 1) {
                                            return false;
                                        }
                                    }
                                    p = g = e === "only" && !p && "nextSibling";
                                }
                                return true;
                            }
                            p = [ o ? m.firstChild : m.lastChild ];
                            if (o && y) {
                                u = m[b] || (m[b] = {});
                                c = u[e] || [];
                                h = c[0] === x && c[1];
                                d = c[0] === x && c[2];
                                f = h && m.childNodes[h];
                                while (f = ++h && f && f[g] || (d = h = 0) || p.pop()) {
                                    if (f.nodeType === 1 && ++d && f === t) {
                                        u[e] = [ x, h, d ];
                                        break;
                                    }
                                }
                            } else if (y && (c = (t[b] || (t[b] = {}))[e]) && c[0] === x) {
                                d = c[1];
                            } else {
                                while (f = ++h && f && f[g] || (d = h = 0) || p.pop()) {
                                    if ((s ? f.nodeName.toLowerCase() === v : f.nodeType === 1) && ++d) {
                                        if (y) {
                                            (f[b] || (f[b] = {}))[e] = [ x, d ];
                                        }
                                        if (f === t) {
                                            break;
                                        }
                                    }
                                }
                            }
                            d -= r;
                            return d === n || d % n === 0 && d / n >= 0;
                        }
                    };
                },
                PSEUDO: function(e, t) {
                    var i, n = a.pseudos[e] || a.setFilters[e.toLowerCase()] || ot.error("unsupported pseudo: " + e);
                    if (n[b]) {
                        return n(t);
                    }
                    if (n.length > 1) {
                        i = [ e, e, "", t ];
                        return a.setFilters.hasOwnProperty(e.toLowerCase()) ? lt(function(e, i) {
                            var r, a = n(e, t), o = a.length;
                            while (o--) {
                                r = N.call(e, a[o]);
                                e[r] = !(i[r] = a[o]);
                            }
                        }) : function(e) {
                            return n(e, 0, i);
                        };
                    }
                    return n;
                }
            },
            pseudos: {
                not: lt(function(e) {
                    var t = [], i = [], n = l(e.replace(H, "$1"));
                    return n[b] ? lt(function(e, t, i, r) {
                        var a, o = n(e, null, r, []), s = e.length;
                        while (s--) {
                            if (a = o[s]) {
                                e[s] = !(t[s] = a);
                            }
                        }
                    }) : function(e, r, a) {
                        t[0] = e;
                        n(t, null, a, i);
                        return !i.pop();
                    };
                }),
                has: lt(function(e) {
                    return function(t) {
                        return ot(e, t).length > 0;
                    };
                }),
                contains: lt(function(e) {
                    return function(t) {
                        return (t.textContent || t.innerText || o(t)).indexOf(e) > -1;
                    };
                }),
                lang: lt(function(e) {
                    if (!J.test(e || "")) {
                        ot.error("unsupported lang: " + e);
                    }
                    e = e.replace(nt, rt).toLowerCase();
                    return function(t) {
                        var i;
                        do {
                            if (i = p ? t.lang : t.getAttribute("xml:lang") || t.getAttribute("lang")) {
                                i = i.toLowerCase();
                                return i === e || i.indexOf(e + "-") === 0;
                            }
                        } while ((t = t.parentNode) && t.nodeType === 1);
                        return false;
                    };
                }),
                target: function(t) {
                    var i = e.location && e.location.hash;
                    return i && i.slice(1) === t.id;
                },
                root: function(e) {
                    return e === h;
                },
                focus: function(e) {
                    return e === d.activeElement && (!d.hasFocus || d.hasFocus()) && !!(e.type || e.href || ~e.tabIndex);
                },
                enabled: function(e) {
                    return e.disabled === false;
                },
                disabled: function(e) {
                    return e.disabled === true;
                },
                checked: function(e) {
                    var t = e.nodeName.toLowerCase();
                    return t === "input" && !!e.checked || t === "option" && !!e.selected;
                },
                selected: function(e) {
                    if (e.parentNode) {
                        e.parentNode.selectedIndex;
                    }
                    return e.selected === true;
                },
                empty: function(e) {
                    for (e = e.firstChild; e; e = e.nextSibling) {
                        if (e.nodeName > "@" || e.nodeType === 3 || e.nodeType === 4) {
                            return false;
                        }
                    }
                    return true;
                },
                parent: function(e) {
                    return !a.pseudos["empty"](e);
                },
                header: function(e) {
                    return tt.test(e.nodeName);
                },
                input: function(e) {
                    return et.test(e.nodeName);
                },
                button: function(e) {
                    var t = e.nodeName.toLowerCase();
                    return t === "input" && e.type === "button" || t === "button";
                },
                text: function(e) {
                    var t;
                    return e.nodeName.toLowerCase() === "input" && e.type === "text" && ((t = e.getAttribute("type")) == null || t.toLowerCase() === e.type);
                },
                first: pt(function() {
                    return [ 0 ];
                }),
                last: pt(function(e, t) {
                    return [ t - 1 ];
                }),
                eq: pt(function(e, t, i) {
                    return [ i < 0 ? i + t : i ];
                }),
                even: pt(function(e, t) {
                    var i = 0;
                    for (;i < t; i += 2) {
                        e.push(i);
                    }
                    return e;
                }),
                odd: pt(function(e, t) {
                    var i = 1;
                    for (;i < t; i += 2) {
                        e.push(i);
                    }
                    return e;
                }),
                lt: pt(function(e, t, i) {
                    var n = i < 0 ? i + t : i;
                    for (;--n >= 0; ) {
                        e.push(n);
                    }
                    return e;
                }),
                gt: pt(function(e, t, i) {
                    var n = i < 0 ? i + t : i;
                    for (;++n < t; ) {
                        e.push(n);
                    }
                    return e;
                })
            }
        };
        a.pseudos["nth"] = a.pseudos["eq"];
        for (i in {
            radio: true,
            checkbox: true,
            file: true,
            password: true,
            image: true
        }) {
            a.pseudos[i] = dt(i);
        }
        for (i in {
            submit: true,
            reset: true
        }) {
            a.pseudos[i] = ht(i);
        }
        function gt() {}
        gt.prototype = a.filters = a.pseudos;
        a.setFilters = new gt();
        function mt(e, t) {
            var i, n, r, o, s, l, c, u = k[e + " "];
            if (u) {
                return t ? 0 : u.slice(0);
            }
            s = e;
            l = [];
            c = a.preFilter;
            while (s) {
                if (!i || (n = G.exec(s))) {
                    if (n) {
                        s = s.slice(n[0].length) || s;
                    }
                    l.push(r = []);
                }
                i = false;
                if (n = V.exec(s)) {
                    i = n.shift();
                    r.push({
                        value: i,
                        type: n[0].replace(H, " ")
                    });
                    s = s.slice(i.length);
                }
                for (o in a.filter) {
                    if ((n = K[o].exec(s)) && (!c[o] || (n = c[o](n)))) {
                        i = n.shift();
                        r.push({
                            value: i,
                            type: o,
                            matches: n
                        });
                        s = s.slice(i.length);
                    }
                }
                if (!i) {
                    break;
                }
            }
            return t ? s.length : s ? ot.error(e) : k(e, l).slice(0);
        }
        function vt(e) {
            var t = 0, i = e.length, n = "";
            for (;t < i; t++) {
                n += e[t].value;
            }
            return n;
        }
        function yt(e, t, i) {
            var n = t.dir, a = i && n === "parentNode", o = _++;
            return t.first ? function(t, i, r) {
                while (t = t[n]) {
                    if (t.nodeType === 1 || a) {
                        return e(t, i, r);
                    }
                }
            } : function(t, i, s) {
                var l, c, u, f = x + " " + o;
                if (s) {
                    while (t = t[n]) {
                        if (t.nodeType === 1 || a) {
                            if (e(t, i, s)) {
                                return true;
                            }
                        }
                    }
                } else {
                    while (t = t[n]) {
                        if (t.nodeType === 1 || a) {
                            u = t[b] || (t[b] = {});
                            if ((c = u[n]) && c[0] === f) {
                                if ((l = c[1]) === true || l === r) {
                                    return l === true;
                                }
                            } else {
                                c = u[n] = [ f ];
                                c[1] = e(t, i, s) || r;
                                if (c[1] === true) {
                                    return true;
                                }
                            }
                        }
                    }
                }
            };
        }
        function bt(e) {
            return e.length > 1 ? function(t, i, n) {
                var r = e.length;
                while (r--) {
                    if (!e[r](t, i, n)) {
                        return false;
                    }
                }
                return true;
            } : e[0];
        }
        function wt(e, t, i, n, r) {
            var a, o = [], s = 0, l = e.length, c = t != null;
            for (;s < l; s++) {
                if (a = e[s]) {
                    if (!i || i(a, n, r)) {
                        o.push(a);
                        if (c) {
                            t.push(s);
                        }
                    }
                }
            }
            return o;
        }
        function Ct(e, t, i, n, r, a) {
            if (n && !n[b]) {
                n = Ct(n);
            }
            if (r && !r[b]) {
                r = Ct(r, a);
            }
            return lt(function(a, o, s, l) {
                var c, u, f, d = [], h = [], p = o.length, g = a || St(t || "*", s.nodeType ? [ s ] : s, []), m = e && (a || !t) ? wt(g, d, e, s, l) : g, v = i ? r || (a ? e : p || n) ? [] : o : m;
                if (i) {
                    i(m, v, s, l);
                }
                if (n) {
                    c = wt(v, h);
                    n(c, [], s, l);
                    u = c.length;
                    while (u--) {
                        if (f = c[u]) {
                            v[h[u]] = !(m[h[u]] = f);
                        }
                    }
                }
                if (a) {
                    if (r || e) {
                        if (r) {
                            c = [];
                            u = v.length;
                            while (u--) {
                                if (f = v[u]) {
                                    c.push(m[u] = f);
                                }
                            }
                            r(null, v = [], c, l);
                        }
                        u = v.length;
                        while (u--) {
                            if ((f = v[u]) && (c = r ? N.call(a, f) : d[u]) > -1) {
                                a[c] = !(o[c] = f);
                            }
                        }
                    }
                } else {
                    v = wt(v === o ? v.splice(p, v.length) : v);
                    if (r) {
                        r(null, o, v, l);
                    } else {
                        F.apply(o, v);
                    }
                }
            });
        }
        function xt(e) {
            var t, i, n, r = e.length, o = a.relative[e[0].type], s = o || a.relative[" "], l = o ? 1 : 0, u = yt(function(e) {
                return e === t;
            }, s, true), f = yt(function(e) {
                return N.call(t, e) > -1;
            }, s, true), d = [ function(e, i, n) {
                return !o && (n || i !== c) || ((t = i).nodeType ? u(e, i, n) : f(e, i, n));
            } ];
            for (;l < r; l++) {
                if (i = a.relative[e[l].type]) {
                    d = [ yt(bt(d), i) ];
                } else {
                    i = a.filter[e[l].type].apply(null, e[l].matches);
                    if (i[b]) {
                        n = ++l;
                        for (;n < r; n++) {
                            if (a.relative[e[n].type]) {
                                break;
                            }
                        }
                        return Ct(l > 1 && bt(d), l > 1 && vt(e.slice(0, l - 1).concat({
                            value: e[l - 2].type === " " ? "*" : ""
                        })).replace(H, "$1"), i, l < n && xt(e.slice(l, n)), n < r && xt(e = e.slice(n)), n < r && vt(e));
                    }
                    d.push(i);
                }
            }
            return bt(d);
        }
        function _t(e, t) {
            var i = 0, n = t.length > 0, o = e.length > 0, s = function(s, l, u, f, h) {
                var p, g, m, v = [], y = 0, b = "0", w = s && [], C = h != null, _ = c, S = s || o && a.find["TAG"]("*", h && l.parentNode || l), k = x += _ == null ? 1 : Math.random() || .1;
                if (C) {
                    c = l !== d && l;
                    r = i;
                }
                for (;(p = S[b]) != null; b++) {
                    if (o && p) {
                        g = 0;
                        while (m = e[g++]) {
                            if (m(p, l, u)) {
                                f.push(p);
                                break;
                            }
                        }
                        if (C) {
                            x = k;
                            r = ++i;
                        }
                    }
                    if (n) {
                        if (p = !m && p) {
                            y--;
                        }
                        if (s) {
                            w.push(p);
                        }
                    }
                }
                y += b;
                if (n && b !== y) {
                    g = 0;
                    while (m = t[g++]) {
                        m(w, v, l, u);
                    }
                    if (s) {
                        if (y > 0) {
                            while (b--) {
                                if (!(w[b] || v[b])) {
                                    v[b] = R.call(f);
                                }
                            }
                        }
                        v = wt(v);
                    }
                    F.apply(f, v);
                    if (C && !s && v.length > 0 && y + t.length > 1) {
                        ot.uniqueSort(f);
                    }
                }
                if (C) {
                    x = k;
                    c = _;
                }
                return w;
            };
            return n ? lt(s) : s;
        }
        l = ot.compile = function(e, t) {
            var i, n = [], r = [], a = A[e + " "];
            if (!a) {
                if (!t) {
                    t = mt(e);
                }
                i = t.length;
                while (i--) {
                    a = xt(t[i]);
                    if (a[b]) {
                        n.push(a);
                    } else {
                        r.push(a);
                    }
                }
                a = A(e, _t(r, n));
            }
            return a;
        };
        function St(e, t, i) {
            var n = 0, r = t.length;
            for (;n < r; n++) {
                ot(e, t[n], i);
            }
            return i;
        }
        function kt(e, t, i, r) {
            var o, s, c, u, f, d = mt(e);
            if (!r) {
                if (d.length === 1) {
                    s = d[0] = d[0].slice(0);
                    if (s.length > 2 && (c = s[0]).type === "ID" && n.getById && t.nodeType === 9 && p && a.relative[s[1].type]) {
                        t = (a.find["ID"](c.matches[0].replace(nt, rt), t) || [])[0];
                        if (!t) {
                            return i;
                        }
                        e = e.slice(s.shift().value.length);
                    }
                    o = K["needsContext"].test(e) ? 0 : s.length;
                    while (o--) {
                        c = s[o];
                        if (a.relative[u = c.type]) {
                            break;
                        }
                        if (f = a.find[u]) {
                            if (r = f(c.matches[0].replace(nt, rt), $.test(s[0].type) && t.parentNode || t)) {
                                s.splice(o, 1);
                                e = r.length && vt(s);
                                if (!e) {
                                    F.apply(i, r);
                                    return i;
                                }
                                break;
                            }
                        }
                    }
                }
            }
            l(e, d)(r, t, !p, i, $.test(e));
            return i;
        }
        n.sortStable = b.split("").sort(T).join("") === b;
        n.detectDuplicates = E;
        f();
        n.sortDetached = ct(function(e) {
            return e.compareDocumentPosition(d.createElement("div")) & 1;
        });
        if (!ct(function(e) {
            e.innerHTML = "<a href='#'></a>";
            return e.firstChild.getAttribute("href") === "#";
        })) {
            ut("type|href|height|width", function(e, t, i) {
                if (!i) {
                    return e.getAttribute(t, t.toLowerCase() === "type" ? 1 : 2);
                }
            });
        }
        if (!n.attributes || !ct(function(e) {
            e.innerHTML = "<input/>";
            e.firstChild.setAttribute("value", "");
            return e.firstChild.getAttribute("value") === "";
        })) {
            ut("value", function(e, t, i) {
                if (!i && e.nodeName.toLowerCase() === "input") {
                    return e.defaultValue;
                }
            });
        }
        if (!ct(function(e) {
            return e.getAttribute("disabled") == null;
        })) {
            ut(B, function(e, t, i) {
                var n;
                if (!i) {
                    return (n = e.getAttributeNode(t)) && n.specified ? n.value : e[t] === true ? t.toLowerCase() : null;
                }
            });
        }
        w.find = ot;
        w.expr = ot.selectors;
        w.expr[":"] = w.expr.pseudos;
        w.unique = ot.uniqueSort;
        w.text = ot.getText;
        w.isXMLDoc = ot.isXML;
        w.contains = ot.contains;
    })(e);
    var I = {};
    function O(e) {
        var t = I[e] = {};
        w.each(e.match(x) || [], function(e, i) {
            t[i] = true;
        });
        return t;
    }
    w.Callbacks = function(e) {
        e = typeof e === "string" ? I[e] || O(e) : w.extend({}, e);
        var i, n, r, a, o, s, l = [], c = !e.once && [], u = function(t) {
            i = e.memory && t;
            n = true;
            s = a || 0;
            a = 0;
            o = l.length;
            r = true;
            for (;l && s < o; s++) {
                if (l[s].apply(t[0], t[1]) === false && e.stopOnFalse) {
                    i = false;
                    break;
                }
            }
            r = false;
            if (l) {
                if (c) {
                    if (c.length) {
                        u(c.shift());
                    }
                } else if (i) {
                    l = [];
                } else {
                    f.disable();
                }
            }
        }, f = {
            add: function() {
                if (l) {
                    var t = l.length;
                    (function n(t) {
                        w.each(t, function(t, i) {
                            var r = w.type(i);
                            if (r === "function") {
                                if (!e.unique || !f.has(i)) {
                                    l.push(i);
                                }
                            } else if (i && i.length && r !== "string") {
                                n(i);
                            }
                        });
                    })(arguments);
                    if (r) {
                        o = l.length;
                    } else if (i) {
                        a = t;
                        u(i);
                    }
                }
                return this;
            },
            remove: function() {
                if (l) {
                    w.each(arguments, function(e, t) {
                        var i;
                        while ((i = w.inArray(t, l, i)) > -1) {
                            l.splice(i, 1);
                            if (r) {
                                if (i <= o) {
                                    o--;
                                }
                                if (i <= s) {
                                    s--;
                                }
                            }
                        }
                    });
                }
                return this;
            },
            has: function(e) {
                return e ? w.inArray(e, l) > -1 : !!(l && l.length);
            },
            empty: function() {
                l = [];
                o = 0;
                return this;
            },
            disable: function() {
                l = c = i = t;
                return this;
            },
            disabled: function() {
                return !l;
            },
            lock: function() {
                c = t;
                if (!i) {
                    f.disable();
                }
                return this;
            },
            locked: function() {
                return !c;
            },
            fireWith: function(e, t) {
                if (l && (!n || c)) {
                    t = t || [];
                    t = [ e, t.slice ? t.slice() : t ];
                    if (r) {
                        c.push(t);
                    } else {
                        u(t);
                    }
                }
                return this;
            },
            fire: function() {
                f.fireWith(this, arguments);
                return this;
            },
            fired: function() {
                return !!n;
            }
        };
        return f;
    };
    w.extend({
        Deferred: function(e) {
            var t = [ [ "resolve", "done", w.Callbacks("once memory"), "resolved" ], [ "reject", "fail", w.Callbacks("once memory"), "rejected" ], [ "notify", "progress", w.Callbacks("memory") ] ], i = "pending", n = {
                state: function() {
                    return i;
                },
                always: function() {
                    r.done(arguments).fail(arguments);
                    return this;
                },
                then: function() {
                    var e = arguments;
                    return w.Deferred(function(i) {
                        w.each(t, function(t, a) {
                            var o = a[0], s = w.isFunction(e[t]) && e[t];
                            r[a[1]](function() {
                                var e = s && s.apply(this, arguments);
                                if (e && w.isFunction(e.promise)) {
                                    e.promise().done(i.resolve).fail(i.reject).progress(i.notify);
                                } else {
                                    i[o + "With"](this === n ? i.promise() : this, s ? [ e ] : arguments);
                                }
                            });
                        });
                        e = null;
                    }).promise();
                },
                promise: function(e) {
                    return e != null ? w.extend(e, n) : n;
                }
            }, r = {};
            n.pipe = n.then;
            w.each(t, function(e, a) {
                var o = a[2], s = a[3];
                n[a[1]] = o.add;
                if (s) {
                    o.add(function() {
                        i = s;
                    }, t[e ^ 1][2].disable, t[2][2].lock);
                }
                r[a[0]] = function() {
                    r[a[0] + "With"](this === r ? n : this, arguments);
                    return this;
                };
                r[a[0] + "With"] = o.fireWith;
            });
            n.promise(r);
            if (e) {
                e.call(r, r);
            }
            return r;
        },
        when: function(e) {
            var t = 0, i = g.call(arguments), n = i.length, r = n !== 1 || e && w.isFunction(e.promise) ? n : 0, a = r === 1 ? e : w.Deferred(), o = function(e, t, i) {
                return function(n) {
                    t[e] = this;
                    i[e] = arguments.length > 1 ? g.call(arguments) : n;
                    if (i === s) {
                        a.notifyWith(t, i);
                    } else if (!--r) {
                        a.resolveWith(t, i);
                    }
                };
            }, s, l, c;
            if (n > 1) {
                s = new Array(n);
                l = new Array(n);
                c = new Array(n);
                for (;t < n; t++) {
                    if (i[t] && w.isFunction(i[t].promise)) {
                        i[t].promise().done(o(t, c, i)).fail(a.reject).progress(o(t, l, s));
                    } else {
                        --r;
                    }
                }
            }
            if (!r) {
                a.resolveWith(c, i);
            }
            return a.promise();
        }
    });
    w.support = function(t) {
        var i = o.createElement("input"), n = o.createDocumentFragment(), r = o.createElement("div"), a = o.createElement("select"), s = a.appendChild(o.createElement("option"));
        if (!i.type) {
            return t;
        }
        i.type = "checkbox";
        t.checkOn = i.value !== "";
        t.optSelected = s.selected;
        t.reliableMarginRight = true;
        t.boxSizingReliable = true;
        t.pixelPosition = false;
        i.checked = true;
        t.noCloneChecked = i.cloneNode(true).checked;
        a.disabled = true;
        t.optDisabled = !s.disabled;
        i = o.createElement("input");
        i.value = "t";
        i.type = "radio";
        t.radioValue = i.value === "t";
        i.setAttribute("checked", "t");
        i.setAttribute("name", "t");
        n.appendChild(i);
        t.checkClone = n.cloneNode(true).cloneNode(true).lastChild.checked;
        t.focusinBubbles = "onfocusin" in e;
        r.style.backgroundClip = "content-box";
        r.cloneNode(true).style.backgroundClip = "";
        t.clearCloneStyle = r.style.backgroundClip === "content-box";
        w(function() {
            var i, n, a = "padding:0;margin:0;border:0;display:block;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box", s = o.getElementsByTagName("body")[0];
            if (!s) {
                return;
            }
            i = o.createElement("div");
            i.style.cssText = "border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px";
            s.appendChild(i).appendChild(r);
            r.innerHTML = "";
            r.style.cssText = "-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%";
            w.swap(s, s.style.zoom != null ? {
                zoom: 1
            } : {}, function() {
                t.boxSizing = r.offsetWidth === 4;
            });
            if (e.getComputedStyle) {
                t.pixelPosition = (e.getComputedStyle(r, null) || {}).top !== "1%";
                t.boxSizingReliable = (e.getComputedStyle(r, null) || {
                    width: "4px"
                }).width === "4px";
                n = r.appendChild(o.createElement("div"));
                n.style.cssText = r.style.cssText = a;
                n.style.marginRight = n.style.width = "0";
                r.style.width = "1px";
                t.reliableMarginRight = !parseFloat((e.getComputedStyle(n, null) || {}).marginRight);
            }
            s.removeChild(i);
        });
        return t;
    }({});
    var D, R, L = /(?:\{[\s\S]*\}|\[[\s\S]*\])$/, F = /([A-Z])/g;
    function M() {
        Object.defineProperty(this.cache = {}, 0, {
            get: function() {
                return {};
            }
        });
        this.expando = w.expando + Math.random();
    }
    M.uid = 1;
    M.accepts = function(e) {
        return e.nodeType ? e.nodeType === 1 || e.nodeType === 9 : true;
    };
    M.prototype = {
        key: function(e) {
            if (!M.accepts(e)) {
                return 0;
            }
            var t = {}, i = e[this.expando];
            if (!i) {
                i = M.uid++;
                try {
                    t[this.expando] = {
                        value: i
                    };
                    Object.defineProperties(e, t);
                } catch (n) {
                    t[this.expando] = i;
                    w.extend(e, t);
                }
            }
            if (!this.cache[i]) {
                this.cache[i] = {};
            }
            return i;
        },
        set: function(e, t, i) {
            var n, r = this.key(e), a = this.cache[r];
            if (typeof t === "string") {
                a[t] = i;
            } else {
                if (w.isEmptyObject(a)) {
                    w.extend(this.cache[r], t);
                } else {
                    for (n in t) {
                        a[n] = t[n];
                    }
                }
            }
            return a;
        },
        get: function(e, i) {
            var n = this.cache[this.key(e)];
            return i === t ? n : n[i];
        },
        access: function(e, i, n) {
            var r;
            if (i === t || i && typeof i === "string" && n === t) {
                r = this.get(e, i);
                return r !== t ? r : this.get(e, w.camelCase(i));
            }
            this.set(e, i, n);
            return n !== t ? n : i;
        },
        remove: function(e, i) {
            var n, r, a, o = this.key(e), s = this.cache[o];
            if (i === t) {
                this.cache[o] = {};
            } else {
                if (w.isArray(i)) {
                    r = i.concat(i.map(w.camelCase));
                } else {
                    a = w.camelCase(i);
                    if (i in s) {
                        r = [ i, a ];
                    } else {
                        r = a;
                        r = r in s ? [ r ] : r.match(x) || [];
                    }
                }
                n = r.length;
                while (n--) {
                    delete s[r[n]];
                }
            }
        },
        hasData: function(e) {
            return !w.isEmptyObject(this.cache[e[this.expando]] || {});
        },
        discard: function(e) {
            if (e[this.expando]) {
                delete this.cache[e[this.expando]];
            }
        }
    };
    D = new M();
    R = new M();
    w.extend({
        acceptData: M.accepts,
        hasData: function(e) {
            return D.hasData(e) || R.hasData(e);
        },
        data: function(e, t, i) {
            return D.access(e, t, i);
        },
        removeData: function(e, t) {
            D.remove(e, t);
        },
        _data: function(e, t, i) {
            return R.access(e, t, i);
        },
        _removeData: function(e, t) {
            R.remove(e, t);
        }
    });
    w.fn.extend({
        data: function(e, i) {
            var n, r, a = this[0], o = 0, s = null;
            if (e === t) {
                if (this.length) {
                    s = D.get(a);
                    if (a.nodeType === 1 && !R.get(a, "hasDataAttrs")) {
                        n = a.attributes;
                        for (;o < n.length; o++) {
                            r = n[o].name;
                            if (r.indexOf("data-") === 0) {
                                r = w.camelCase(r.slice(5));
                                N(a, r, s[r]);
                            }
                        }
                        R.set(a, "hasDataAttrs", true);
                    }
                }
                return s;
            }
            if (typeof e === "object") {
                return this.each(function() {
                    D.set(this, e);
                });
            }
            return w.access(this, function(i) {
                var n, r = w.camelCase(e);
                if (a && i === t) {
                    n = D.get(a, e);
                    if (n !== t) {
                        return n;
                    }
                    n = D.get(a, r);
                    if (n !== t) {
                        return n;
                    }
                    n = N(a, r, t);
                    if (n !== t) {
                        return n;
                    }
                    return;
                }
                this.each(function() {
                    var n = D.get(this, r);
                    D.set(this, r, i);
                    if (e.indexOf("-") !== -1 && n !== t) {
                        D.set(this, e, i);
                    }
                });
            }, null, i, arguments.length > 1, null, true);
        },
        removeData: function(e) {
            return this.each(function() {
                D.remove(this, e);
            });
        }
    });
    function N(e, i, n) {
        var r;
        if (n === t && e.nodeType === 1) {
            r = "data-" + i.replace(F, "-$1").toLowerCase();
            n = e.getAttribute(r);
            if (typeof n === "string") {
                try {
                    n = n === "true" ? true : n === "false" ? false : n === "null" ? null : +n + "" === n ? +n : L.test(n) ? JSON.parse(n) : n;
                } catch (a) {}
                D.set(e, i, n);
            } else {
                n = t;
            }
        }
        return n;
    }
    w.extend({
        queue: function(e, t, i) {
            var n;
            if (e) {
                t = (t || "fx") + "queue";
                n = R.get(e, t);
                if (i) {
                    if (!n || w.isArray(i)) {
                        n = R.access(e, t, w.makeArray(i));
                    } else {
                        n.push(i);
                    }
                }
                return n || [];
            }
        },
        dequeue: function(e, t) {
            t = t || "fx";
            var i = w.queue(e, t), n = i.length, r = i.shift(), a = w._queueHooks(e, t), o = function() {
                w.dequeue(e, t);
            };
            if (r === "inprogress") {
                r = i.shift();
                n--;
            }
            if (r) {
                if (t === "fx") {
                    i.unshift("inprogress");
                }
                delete a.stop;
                r.call(e, o, a);
            }
            if (!n && a) {
                a.empty.fire();
            }
        },
        _queueHooks: function(e, t) {
            var i = t + "queueHooks";
            return R.get(e, i) || R.access(e, i, {
                empty: w.Callbacks("once memory").add(function() {
                    R.remove(e, [ t + "queue", i ]);
                })
            });
        }
    });
    w.fn.extend({
        queue: function(e, i) {
            var n = 2;
            if (typeof e !== "string") {
                i = e;
                e = "fx";
                n--;
            }
            if (arguments.length < n) {
                return w.queue(this[0], e);
            }
            return i === t ? this : this.each(function() {
                var t = w.queue(this, e, i);
                w._queueHooks(this, e);
                if (e === "fx" && t[0] !== "inprogress") {
                    w.dequeue(this, e);
                }
            });
        },
        dequeue: function(e) {
            return this.each(function() {
                w.dequeue(this, e);
            });
        },
        delay: function(e, t) {
            e = w.fx ? w.fx.speeds[e] || e : e;
            t = t || "fx";
            return this.queue(t, function(t, i) {
                var n = setTimeout(t, e);
                i.stop = function() {
                    clearTimeout(n);
                };
            });
        },
        clearQueue: function(e) {
            return this.queue(e || "fx", []);
        },
        promise: function(e, i) {
            var n, r = 1, a = w.Deferred(), o = this, s = this.length, l = function() {
                if (!--r) {
                    a.resolveWith(o, [ o ]);
                }
            };
            if (typeof e !== "string") {
                i = e;
                e = t;
            }
            e = e || "fx";
            while (s--) {
                n = R.get(o[s], e + "queueHooks");
                if (n && n.empty) {
                    r++;
                    n.empty.add(l);
                }
            }
            l();
            return a.promise(i);
        }
    });
    var B, j, U = /[\t\r\n\f]/g, z = /\r/g, q = /^(?:input|select|textarea|button)$/i;
    w.fn.extend({
        attr: function(e, t) {
            return w.access(this, w.attr, e, t, arguments.length > 1);
        },
        removeAttr: function(e) {
            return this.each(function() {
                w.removeAttr(this, e);
            });
        },
        prop: function(e, t) {
            return w.access(this, w.prop, e, t, arguments.length > 1);
        },
        removeProp: function(e) {
            return this.each(function() {
                delete this[w.propFix[e] || e];
            });
        },
        addClass: function(e) {
            var t, i, n, r, a, o = 0, s = this.length, l = typeof e === "string" && e;
            if (w.isFunction(e)) {
                return this.each(function(t) {
                    w(this).addClass(e.call(this, t, this.className));
                });
            }
            if (l) {
                t = (e || "").match(x) || [];
                for (;o < s; o++) {
                    i = this[o];
                    n = i.nodeType === 1 && (i.className ? (" " + i.className + " ").replace(U, " ") : " ");
                    if (n) {
                        a = 0;
                        while (r = t[a++]) {
                            if (n.indexOf(" " + r + " ") < 0) {
                                n += r + " ";
                            }
                        }
                        i.className = w.trim(n);
                    }
                }
            }
            return this;
        },
        removeClass: function(e) {
            var t, i, n, r, a, o = 0, s = this.length, l = arguments.length === 0 || typeof e === "string" && e;
            if (w.isFunction(e)) {
                return this.each(function(t) {
                    w(this).removeClass(e.call(this, t, this.className));
                });
            }
            if (l) {
                t = (e || "").match(x) || [];
                for (;o < s; o++) {
                    i = this[o];
                    n = i.nodeType === 1 && (i.className ? (" " + i.className + " ").replace(U, " ") : "");
                    if (n) {
                        a = 0;
                        while (r = t[a++]) {
                            while (n.indexOf(" " + r + " ") >= 0) {
                                n = n.replace(" " + r + " ", " ");
                            }
                        }
                        i.className = e ? w.trim(n) : "";
                    }
                }
            }
            return this;
        },
        toggleClass: function(e, t) {
            var i = typeof e;
            if (typeof t === "boolean" && i === "string") {
                return t ? this.addClass(e) : this.removeClass(e);
            }
            if (w.isFunction(e)) {
                return this.each(function(i) {
                    w(this).toggleClass(e.call(this, i, this.className, t), t);
                });
            }
            return this.each(function() {
                if (i === "string") {
                    var t, n = 0, a = w(this), o = e.match(x) || [];
                    while (t = o[n++]) {
                        if (a.hasClass(t)) {
                            a.removeClass(t);
                        } else {
                            a.addClass(t);
                        }
                    }
                } else if (i === r || i === "boolean") {
                    if (this.className) {
                        R.set(this, "__className__", this.className);
                    }
                    this.className = this.className || e === false ? "" : R.get(this, "__className__") || "";
                }
            });
        },
        hasClass: function(e) {
            var t = " " + e + " ", i = 0, n = this.length;
            for (;i < n; i++) {
                if (this[i].nodeType === 1 && (" " + this[i].className + " ").replace(U, " ").indexOf(t) >= 0) {
                    return true;
                }
            }
            return false;
        },
        val: function(e) {
            var i, n, r, a = this[0];
            if (!arguments.length) {
                if (a) {
                    i = w.valHooks[a.type] || w.valHooks[a.nodeName.toLowerCase()];
                    if (i && "get" in i && (n = i.get(a, "value")) !== t) {
                        return n;
                    }
                    n = a.value;
                    return typeof n === "string" ? n.replace(z, "") : n == null ? "" : n;
                }
                return;
            }
            r = w.isFunction(e);
            return this.each(function(n) {
                var a;
                if (this.nodeType !== 1) {
                    return;
                }
                if (r) {
                    a = e.call(this, n, w(this).val());
                } else {
                    a = e;
                }
                if (a == null) {
                    a = "";
                } else if (typeof a === "number") {
                    a += "";
                } else if (w.isArray(a)) {
                    a = w.map(a, function(e) {
                        return e == null ? "" : e + "";
                    });
                }
                i = w.valHooks[this.type] || w.valHooks[this.nodeName.toLowerCase()];
                if (!i || !("set" in i) || i.set(this, a, "value") === t) {
                    this.value = a;
                }
            });
        }
    });
    w.extend({
        valHooks: {
            option: {
                get: function(e) {
                    var t = e.attributes.value;
                    return !t || t.specified ? e.value : e.text;
                }
            },
            select: {
                get: function(e) {
                    var t, i, n = e.options, r = e.selectedIndex, a = e.type === "select-one" || r < 0, o = a ? null : [], s = a ? r + 1 : n.length, l = r < 0 ? s : a ? r : 0;
                    for (;l < s; l++) {
                        i = n[l];
                        if ((i.selected || l === r) && (w.support.optDisabled ? !i.disabled : i.getAttribute("disabled") === null) && (!i.parentNode.disabled || !w.nodeName(i.parentNode, "optgroup"))) {
                            t = w(i).val();
                            if (a) {
                                return t;
                            }
                            o.push(t);
                        }
                    }
                    return o;
                },
                set: function(e, t) {
                    var i, n, r = e.options, a = w.makeArray(t), o = r.length;
                    while (o--) {
                        n = r[o];
                        if (n.selected = w.inArray(w(n).val(), a) >= 0) {
                            i = true;
                        }
                    }
                    if (!i) {
                        e.selectedIndex = -1;
                    }
                    return a;
                }
            }
        },
        attr: function(e, i, n) {
            var a, o, s = e.nodeType;
            if (!e || s === 3 || s === 8 || s === 2) {
                return;
            }
            if (typeof e.getAttribute === r) {
                return w.prop(e, i, n);
            }
            if (s !== 1 || !w.isXMLDoc(e)) {
                i = i.toLowerCase();
                a = w.attrHooks[i] || (w.expr.match.bool.test(i) ? j : B);
            }
            if (n !== t) {
                if (n === null) {
                    w.removeAttr(e, i);
                } else if (a && "set" in a && (o = a.set(e, n, i)) !== t) {
                    return o;
                } else {
                    e.setAttribute(i, n + "");
                    return n;
                }
            } else if (a && "get" in a && (o = a.get(e, i)) !== null) {
                return o;
            } else {
                o = w.find.attr(e, i);
                return o == null ? t : o;
            }
        },
        removeAttr: function(e, t) {
            var i, n, r = 0, a = t && t.match(x);
            if (a && e.nodeType === 1) {
                while (i = a[r++]) {
                    n = w.propFix[i] || i;
                    if (w.expr.match.bool.test(i)) {
                        e[n] = false;
                    }
                    e.removeAttribute(i);
                }
            }
        },
        attrHooks: {
            type: {
                set: function(e, t) {
                    if (!w.support.radioValue && t === "radio" && w.nodeName(e, "input")) {
                        var i = e.value;
                        e.setAttribute("type", t);
                        if (i) {
                            e.value = i;
                        }
                        return t;
                    }
                }
            }
        },
        propFix: {
            "for": "htmlFor",
            "class": "className"
        },
        prop: function(e, i, n) {
            var r, a, o, s = e.nodeType;
            if (!e || s === 3 || s === 8 || s === 2) {
                return;
            }
            o = s !== 1 || !w.isXMLDoc(e);
            if (o) {
                i = w.propFix[i] || i;
                a = w.propHooks[i];
            }
            if (n !== t) {
                return a && "set" in a && (r = a.set(e, n, i)) !== t ? r : e[i] = n;
            } else {
                return a && "get" in a && (r = a.get(e, i)) !== null ? r : e[i];
            }
        },
        propHooks: {
            tabIndex: {
                get: function(e) {
                    return e.hasAttribute("tabindex") || q.test(e.nodeName) || e.href ? e.tabIndex : -1;
                }
            }
        }
    });
    j = {
        set: function(e, t, i) {
            if (t === false) {
                w.removeAttr(e, i);
            } else {
                e.setAttribute(i, i);
            }
            return i;
        }
    };
    w.each(w.expr.match.bool.source.match(/\w+/g), function(e, i) {
        var n = w.expr.attrHandle[i] || w.find.attr;
        w.expr.attrHandle[i] = function(e, i, r) {
            var a = w.expr.attrHandle[i], o = r ? t : (w.expr.attrHandle[i] = t) != n(e, i, r) ? i.toLowerCase() : null;
            w.expr.attrHandle[i] = a;
            return o;
        };
    });
    if (!w.support.optSelected) {
        w.propHooks.selected = {
            get: function(e) {
                var t = e.parentNode;
                if (t && t.parentNode) {
                    t.parentNode.selectedIndex;
                }
                return null;
            }
        };
    }
    w.each([ "tabIndex", "readOnly", "maxLength", "cellSpacing", "cellPadding", "rowSpan", "colSpan", "useMap", "frameBorder", "contentEditable" ], function() {
        w.propFix[this.toLowerCase()] = this;
    });
    w.each([ "radio", "checkbox" ], function() {
        w.valHooks[this] = {
            set: function(e, t) {
                if (w.isArray(t)) {
                    return e.checked = w.inArray(w(e).val(), t) >= 0;
                }
            }
        };
        if (!w.support.checkOn) {
            w.valHooks[this].get = function(e) {
                return e.getAttribute("value") === null ? "on" : e.value;
            };
        }
    });
    var W = /^key/, H = /^(?:mouse|contextmenu)|click/, G = /^(?:focusinfocus|focusoutblur)$/, V = /^([^.]*)(?:\.(.+)|)$/;
    function $() {
        return true;
    }
    function Y() {
        return false;
    }
    function X() {
        try {
            return o.activeElement;
        } catch (e) {}
    }
    w.event = {
        global: {},
        add: function(e, i, n, a, o) {
            var s, l, c, u, f, d, h, p, g, m, v, y = R.get(e);
            if (!y) {
                return;
            }
            if (n.handler) {
                s = n;
                n = s.handler;
                o = s.selector;
            }
            if (!n.guid) {
                n.guid = w.guid++;
            }
            if (!(u = y.events)) {
                u = y.events = {};
            }
            if (!(l = y.handle)) {
                l = y.handle = function(e) {
                    return typeof w !== r && (!e || w.event.triggered !== e.type) ? w.event.dispatch.apply(l.elem, arguments) : t;
                };
                l.elem = e;
            }
            i = (i || "").match(x) || [ "" ];
            f = i.length;
            while (f--) {
                c = V.exec(i[f]) || [];
                g = v = c[1];
                m = (c[2] || "").split(".").sort();
                if (!g) {
                    continue;
                }
                h = w.event.special[g] || {};
                g = (o ? h.delegateType : h.bindType) || g;
                h = w.event.special[g] || {};
                d = w.extend({
                    type: g,
                    origType: v,
                    data: a,
                    handler: n,
                    guid: n.guid,
                    selector: o,
                    needsContext: o && w.expr.match.needsContext.test(o),
                    namespace: m.join(".")
                }, s);
                if (!(p = u[g])) {
                    p = u[g] = [];
                    p.delegateCount = 0;
                    if (!h.setup || h.setup.call(e, a, m, l) === false) {
                        if (e.addEventListener) {
                            e.addEventListener(g, l, false);
                        }
                    }
                }
                if (h.add) {
                    h.add.call(e, d);
                    if (!d.handler.guid) {
                        d.handler.guid = n.guid;
                    }
                }
                if (o) {
                    p.splice(p.delegateCount++, 0, d);
                } else {
                    p.push(d);
                }
                w.event.global[g] = true;
            }
            e = null;
        },
        remove: function(e, t, i, n, r) {
            var a, o, s, l, c, u, f, d, h, p, g, m = R.hasData(e) && R.get(e);
            if (!m || !(l = m.events)) {
                return;
            }
            t = (t || "").match(x) || [ "" ];
            c = t.length;
            while (c--) {
                s = V.exec(t[c]) || [];
                h = g = s[1];
                p = (s[2] || "").split(".").sort();
                if (!h) {
                    for (h in l) {
                        w.event.remove(e, h + t[c], i, n, true);
                    }
                    continue;
                }
                f = w.event.special[h] || {};
                h = (n ? f.delegateType : f.bindType) || h;
                d = l[h] || [];
                s = s[2] && new RegExp("(^|\\.)" + p.join("\\.(?:.*\\.|)") + "(\\.|$)");
                o = a = d.length;
                while (a--) {
                    u = d[a];
                    if ((r || g === u.origType) && (!i || i.guid === u.guid) && (!s || s.test(u.namespace)) && (!n || n === u.selector || n === "**" && u.selector)) {
                        d.splice(a, 1);
                        if (u.selector) {
                            d.delegateCount--;
                        }
                        if (f.remove) {
                            f.remove.call(e, u);
                        }
                    }
                }
                if (o && !d.length) {
                    if (!f.teardown || f.teardown.call(e, p, m.handle) === false) {
                        w.removeEvent(e, h, m.handle);
                    }
                    delete l[h];
                }
            }
            if (w.isEmptyObject(l)) {
                delete m.handle;
                R.remove(e, "events");
            }
        },
        trigger: function(i, n, r, a) {
            var s, l, c, u, f, d, h, p = [ r || o ], g = y.call(i, "type") ? i.type : i, m = y.call(i, "namespace") ? i.namespace.split(".") : [];
            l = c = r = r || o;
            if (r.nodeType === 3 || r.nodeType === 8) {
                return;
            }
            if (G.test(g + w.event.triggered)) {
                return;
            }
            if (g.indexOf(".") >= 0) {
                m = g.split(".");
                g = m.shift();
                m.sort();
            }
            f = g.indexOf(":") < 0 && "on" + g;
            i = i[w.expando] ? i : new w.Event(g, typeof i === "object" && i);
            i.isTrigger = a ? 2 : 3;
            i.namespace = m.join(".");
            i.namespace_re = i.namespace ? new RegExp("(^|\\.)" + m.join("\\.(?:.*\\.|)") + "(\\.|$)") : null;
            i.result = t;
            if (!i.target) {
                i.target = r;
            }
            n = n == null ? [ i ] : w.makeArray(n, [ i ]);
            h = w.event.special[g] || {};
            if (!a && h.trigger && h.trigger.apply(r, n) === false) {
                return;
            }
            if (!a && !h.noBubble && !w.isWindow(r)) {
                u = h.delegateType || g;
                if (!G.test(u + g)) {
                    l = l.parentNode;
                }
                for (;l; l = l.parentNode) {
                    p.push(l);
                    c = l;
                }
                if (c === (r.ownerDocument || o)) {
                    p.push(c.defaultView || c.parentWindow || e);
                }
            }
            s = 0;
            while ((l = p[s++]) && !i.isPropagationStopped()) {
                i.type = s > 1 ? u : h.bindType || g;
                d = (R.get(l, "events") || {})[i.type] && R.get(l, "handle");
                if (d) {
                    d.apply(l, n);
                }
                d = f && l[f];
                if (d && w.acceptData(l) && d.apply && d.apply(l, n) === false) {
                    i.preventDefault();
                }
            }
            i.type = g;
            if (!a && !i.isDefaultPrevented()) {
                if ((!h._default || h._default.apply(p.pop(), n) === false) && w.acceptData(r)) {
                    if (f && w.isFunction(r[g]) && !w.isWindow(r)) {
                        c = r[f];
                        if (c) {
                            r[f] = null;
                        }
                        w.event.triggered = g;
                        r[g]();
                        w.event.triggered = t;
                        if (c) {
                            r[f] = c;
                        }
                    }
                }
            }
            return i.result;
        },
        dispatch: function(e) {
            e = w.event.fix(e);
            var i, n, r, a, o, s = [], l = g.call(arguments), c = (R.get(this, "events") || {})[e.type] || [], u = w.event.special[e.type] || {};
            l[0] = e;
            e.delegateTarget = this;
            if (u.preDispatch && u.preDispatch.call(this, e) === false) {
                return;
            }
            s = w.event.handlers.call(this, e, c);
            i = 0;
            while ((a = s[i++]) && !e.isPropagationStopped()) {
                e.currentTarget = a.elem;
                n = 0;
                while ((o = a.handlers[n++]) && !e.isImmediatePropagationStopped()) {
                    if (!e.namespace_re || e.namespace_re.test(o.namespace)) {
                        e.handleObj = o;
                        e.data = o.data;
                        r = ((w.event.special[o.origType] || {}).handle || o.handler).apply(a.elem, l);
                        if (r !== t) {
                            if ((e.result = r) === false) {
                                e.preventDefault();
                                e.stopPropagation();
                            }
                        }
                    }
                }
            }
            if (u.postDispatch) {
                u.postDispatch.call(this, e);
            }
            return e.result;
        },
        handlers: function(e, i) {
            var n, r, a, o, s = [], l = i.delegateCount, c = e.target;
            if (l && c.nodeType && (!e.button || e.type !== "click")) {
                for (;c !== this; c = c.parentNode || this) {
                    if (c.disabled !== true || e.type !== "click") {
                        r = [];
                        for (n = 0; n < l; n++) {
                            o = i[n];
                            a = o.selector + " ";
                            if (r[a] === t) {
                                r[a] = o.needsContext ? w(a, this).index(c) >= 0 : w.find(a, this, null, [ c ]).length;
                            }
                            if (r[a]) {
                                r.push(o);
                            }
                        }
                        if (r.length) {
                            s.push({
                                elem: c,
                                handlers: r
                            });
                        }
                    }
                }
            }
            if (l < i.length) {
                s.push({
                    elem: this,
                    handlers: i.slice(l)
                });
            }
            return s;
        },
        props: "altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),
        fixHooks: {},
        keyHooks: {
            props: "char charCode key keyCode".split(" "),
            filter: function(e, t) {
                if (e.which == null) {
                    e.which = t.charCode != null ? t.charCode : t.keyCode;
                }
                return e;
            }
        },
        mouseHooks: {
            props: "button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),
            filter: function(e, i) {
                var n, r, a, s = i.button;
                if (e.pageX == null && i.clientX != null) {
                    n = e.target.ownerDocument || o;
                    r = n.documentElement;
                    a = n.body;
                    e.pageX = i.clientX + (r && r.scrollLeft || a && a.scrollLeft || 0) - (r && r.clientLeft || a && a.clientLeft || 0);
                    e.pageY = i.clientY + (r && r.scrollTop || a && a.scrollTop || 0) - (r && r.clientTop || a && a.clientTop || 0);
                }
                if (!e.which && s !== t) {
                    e.which = s & 1 ? 1 : s & 2 ? 3 : s & 4 ? 2 : 0;
                }
                return e;
            }
        },
        fix: function(e) {
            if (e[w.expando]) {
                return e;
            }
            var t, i, n, r = e.type, a = e, s = this.fixHooks[r];
            if (!s) {
                this.fixHooks[r] = s = H.test(r) ? this.mouseHooks : W.test(r) ? this.keyHooks : {};
            }
            n = s.props ? this.props.concat(s.props) : this.props;
            e = new w.Event(a);
            t = n.length;
            while (t--) {
                i = n[t];
                e[i] = a[i];
            }
            if (!e.target) {
                e.target = o;
            }
            if (e.target.nodeType === 3) {
                e.target = e.target.parentNode;
            }
            return s.filter ? s.filter(e, a) : e;
        },
        special: {
            load: {
                noBubble: true
            },
            focus: {
                trigger: function() {
                    if (this !== X() && this.focus) {
                        this.focus();
                        return false;
                    }
                },
                delegateType: "focusin"
            },
            blur: {
                trigger: function() {
                    if (this === X() && this.blur) {
                        this.blur();
                        return false;
                    }
                },
                delegateType: "focusout"
            },
            click: {
                trigger: function() {
                    if (this.type === "checkbox" && this.click && w.nodeName(this, "input")) {
                        this.click();
                        return false;
                    }
                },
                _default: function(e) {
                    return w.nodeName(e.target, "a");
                }
            },
            beforeunload: {
                postDispatch: function(e) {
                    if (e.result !== t) {
                        e.originalEvent.returnValue = e.result;
                    }
                }
            }
        },
        simulate: function(e, t, i, n) {
            var r = w.extend(new w.Event(), i, {
                type: e,
                isSimulated: true,
                originalEvent: {}
            });
            if (n) {
                w.event.trigger(r, null, t);
            } else {
                w.event.dispatch.call(t, r);
            }
            if (r.isDefaultPrevented()) {
                i.preventDefault();
            }
        }
    };
    w.removeEvent = function(e, t, i) {
        if (e.removeEventListener) {
            e.removeEventListener(t, i, false);
        }
    };
    w.Event = function(e, t) {
        if (!(this instanceof w.Event)) {
            return new w.Event(e, t);
        }
        if (e && e.type) {
            this.originalEvent = e;
            this.type = e.type;
            this.isDefaultPrevented = e.defaultPrevented || e.getPreventDefault && e.getPreventDefault() ? $ : Y;
        } else {
            this.type = e;
        }
        if (t) {
            w.extend(this, t);
        }
        this.timeStamp = e && e.timeStamp || w.now();
        this[w.expando] = true;
    };
    w.Event.prototype = {
        isDefaultPrevented: Y,
        isPropagationStopped: Y,
        isImmediatePropagationStopped: Y,
        preventDefault: function() {
            var e = this.originalEvent;
            this.isDefaultPrevented = $;
            if (e && e.preventDefault) {
                e.preventDefault();
            }
        },
        stopPropagation: function() {
            var e = this.originalEvent;
            this.isPropagationStopped = $;
            if (e && e.stopPropagation) {
                e.stopPropagation();
            }
        },
        stopImmediatePropagation: function() {
            this.isImmediatePropagationStopped = $;
            this.stopPropagation();
        }
    };
    w.each({
        mouseenter: "mouseover",
        mouseleave: "mouseout"
    }, function(e, t) {
        w.event.special[e] = {
            delegateType: t,
            bindType: t,
            handle: function(e) {
                var i, n = this, r = e.relatedTarget, a = e.handleObj;
                if (!r || r !== n && !w.contains(n, r)) {
                    e.type = a.origType;
                    i = a.handler.apply(this, arguments);
                    e.type = t;
                }
                return i;
            }
        };
    });
    if (!w.support.focusinBubbles) {
        w.each({
            focus: "focusin",
            blur: "focusout"
        }, function(e, t) {
            var i = 0, n = function(e) {
                w.event.simulate(t, e.target, w.event.fix(e), true);
            };
            w.event.special[t] = {
                setup: function() {
                    if (i++ === 0) {
                        o.addEventListener(e, n, true);
                    }
                },
                teardown: function() {
                    if (--i === 0) {
                        o.removeEventListener(e, n, true);
                    }
                }
            };
        });
    }
    w.fn.extend({
        on: function(e, i, n, r, a) {
            var o, s;
            if (typeof e === "object") {
                if (typeof i !== "string") {
                    n = n || i;
                    i = t;
                }
                for (s in e) {
                    this.on(s, i, n, e[s], a);
                }
                return this;
            }
            if (n == null && r == null) {
                r = i;
                n = i = t;
            } else if (r == null) {
                if (typeof i === "string") {
                    r = n;
                    n = t;
                } else {
                    r = n;
                    n = i;
                    i = t;
                }
            }
            if (r === false) {
                r = Y;
            } else if (!r) {
                return this;
            }
            if (a === 1) {
                o = r;
                r = function(e) {
                    w().off(e);
                    return o.apply(this, arguments);
                };
                r.guid = o.guid || (o.guid = w.guid++);
            }
            return this.each(function() {
                w.event.add(this, e, r, n, i);
            });
        },
        one: function(e, t, i, n) {
            return this.on(e, t, i, n, 1);
        },
        off: function(e, i, n) {
            var r, a;
            if (e && e.preventDefault && e.handleObj) {
                r = e.handleObj;
                w(e.delegateTarget).off(r.namespace ? r.origType + "." + r.namespace : r.origType, r.selector, r.handler);
                return this;
            }
            if (typeof e === "object") {
                for (a in e) {
                    this.off(a, i, e[a]);
                }
                return this;
            }
            if (i === false || typeof i === "function") {
                n = i;
                i = t;
            }
            if (n === false) {
                n = Y;
            }
            return this.each(function() {
                w.event.remove(this, e, n, i);
            });
        },
        trigger: function(e, t) {
            return this.each(function() {
                w.event.trigger(e, t, this);
            });
        },
        triggerHandler: function(e, t) {
            var i = this[0];
            if (i) {
                return w.event.trigger(e, t, i, true);
            }
        }
    });
    var J = /^.[^:#\[\.,]*$/, K = /^(?:parents|prev(?:Until|All))/, Q = w.expr.match.needsContext, Z = {
        children: true,
        contents: true,
        next: true,
        prev: true
    };
    w.fn.extend({
        find: function(e) {
            var t, i = [], n = this, r = n.length;
            if (typeof e !== "string") {
                return this.pushStack(w(e).filter(function() {
                    for (t = 0; t < r; t++) {
                        if (w.contains(n[t], this)) {
                            return true;
                        }
                    }
                }));
            }
            for (t = 0; t < r; t++) {
                w.find(e, n[t], i);
            }
            i = this.pushStack(r > 1 ? w.unique(i) : i);
            i.selector = this.selector ? this.selector + " " + e : e;
            return i;
        },
        has: function(e) {
            var t = w(e, this), i = t.length;
            return this.filter(function() {
                var e = 0;
                for (;e < i; e++) {
                    if (w.contains(this, t[e])) {
                        return true;
                    }
                }
            });
        },
        not: function(e) {
            return this.pushStack(tt(this, e || [], true));
        },
        filter: function(e) {
            return this.pushStack(tt(this, e || [], false));
        },
        is: function(e) {
            return !!tt(this, typeof e === "string" && Q.test(e) ? w(e) : e || [], false).length;
        },
        closest: function(e, t) {
            var i, n = 0, r = this.length, a = [], o = Q.test(e) || typeof e !== "string" ? w(e, t || this.context) : 0;
            for (;n < r; n++) {
                for (i = this[n]; i && i !== t; i = i.parentNode) {
                    if (i.nodeType < 11 && (o ? o.index(i) > -1 : i.nodeType === 1 && w.find.matchesSelector(i, e))) {
                        i = a.push(i);
                        break;
                    }
                }
            }
            return this.pushStack(a.length > 1 ? w.unique(a) : a);
        },
        index: function(e) {
            if (!e) {
                return this[0] && this[0].parentNode ? this.first().prevAll().length : -1;
            }
            if (typeof e === "string") {
                return m.call(w(e), this[0]);
            }
            return m.call(this, e.jquery ? e[0] : e);
        },
        add: function(e, t) {
            var i = typeof e === "string" ? w(e, t) : w.makeArray(e && e.nodeType ? [ e ] : e), n = w.merge(this.get(), i);
            return this.pushStack(w.unique(n));
        },
        addBack: function(e) {
            return this.add(e == null ? this.prevObject : this.prevObject.filter(e));
        }
    });
    function et(e, t) {
        while ((e = e[t]) && e.nodeType !== 1) {}
        return e;
    }
    w.each({
        parent: function(e) {
            var t = e.parentNode;
            return t && t.nodeType !== 11 ? t : null;
        },
        parents: function(e) {
            return w.dir(e, "parentNode");
        },
        parentsUntil: function(e, t, i) {
            return w.dir(e, "parentNode", i);
        },
        next: function(e) {
            return et(e, "nextSibling");
        },
        prev: function(e) {
            return et(e, "previousSibling");
        },
        nextAll: function(e) {
            return w.dir(e, "nextSibling");
        },
        prevAll: function(e) {
            return w.dir(e, "previousSibling");
        },
        nextUntil: function(e, t, i) {
            return w.dir(e, "nextSibling", i);
        },
        prevUntil: function(e, t, i) {
            return w.dir(e, "previousSibling", i);
        },
        siblings: function(e) {
            return w.sibling((e.parentNode || {}).firstChild, e);
        },
        children: function(e) {
            return w.sibling(e.firstChild);
        },
        contents: function(e) {
            return e.contentDocument || w.merge([], e.childNodes);
        }
    }, function(e, t) {
        w.fn[e] = function(i, n) {
            var r = w.map(this, t, i);
            if (e.slice(-5) !== "Until") {
                n = i;
            }
            if (n && typeof n === "string") {
                r = w.filter(n, r);
            }
            if (this.length > 1) {
                if (!Z[e]) {
                    w.unique(r);
                }
                if (K.test(e)) {
                    r.reverse();
                }
            }
            return this.pushStack(r);
        };
    });
    w.extend({
        filter: function(e, t, i) {
            var n = t[0];
            if (i) {
                e = ":not(" + e + ")";
            }
            return t.length === 1 && n.nodeType === 1 ? w.find.matchesSelector(n, e) ? [ n ] : [] : w.find.matches(e, w.grep(t, function(e) {
                return e.nodeType === 1;
            }));
        },
        dir: function(e, i, n) {
            var r = [], a = n !== t;
            while ((e = e[i]) && e.nodeType !== 9) {
                if (e.nodeType === 1) {
                    if (a && w(e).is(n)) {
                        break;
                    }
                    r.push(e);
                }
            }
            return r;
        },
        sibling: function(e, t) {
            var i = [];
            for (;e; e = e.nextSibling) {
                if (e.nodeType === 1 && e !== t) {
                    i.push(e);
                }
            }
            return i;
        }
    });
    function tt(e, t, i) {
        if (w.isFunction(t)) {
            return w.grep(e, function(e, n) {
                return !!t.call(e, n, e) !== i;
            });
        }
        if (t.nodeType) {
            return w.grep(e, function(e) {
                return e === t !== i;
            });
        }
        if (typeof t === "string") {
            if (J.test(t)) {
                return w.filter(t, e, i);
            }
            t = w.filter(t, e);
        }
        return w.grep(e, function(e) {
            return m.call(t, e) >= 0 !== i;
        });
    }
    var it = /<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi, nt = /<([\w:]+)/, rt = /<|&#?\w+;/, at = /<(?:script|style|link)/i, ot = /^(?:checkbox|radio)$/i, st = /checked\s*(?:[^=]|=\s*.checked.)/i, lt = /^$|\/(?:java|ecma)script/i, ct = /^true\/(.*)/, ut = /^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g, ft = {
        option: [ 1, "<select multiple='multiple'>", "</select>" ],
        thead: [ 1, "<table>", "</table>" ],
        col: [ 2, "<table><colgroup>", "</colgroup></table>" ],
        tr: [ 2, "<table><tbody>", "</tbody></table>" ],
        td: [ 3, "<table><tbody><tr>", "</tr></tbody></table>" ],
        _default: [ 0, "", "" ]
    };
    ft.optgroup = ft.option;
    ft.tbody = ft.tfoot = ft.colgroup = ft.caption = ft.thead;
    ft.th = ft.td;
    w.fn.extend({
        text: function(e) {
            return w.access(this, function(e) {
                return e === t ? w.text(this) : this.empty().append((this[0] && this[0].ownerDocument || o).createTextNode(e));
            }, null, e, arguments.length);
        },
        append: function() {
            return this.domManip(arguments, function(e) {
                if (this.nodeType === 1 || this.nodeType === 11 || this.nodeType === 9) {
                    var t = dt(this, e);
                    t.appendChild(e);
                }
            });
        },
        prepend: function() {
            return this.domManip(arguments, function(e) {
                if (this.nodeType === 1 || this.nodeType === 11 || this.nodeType === 9) {
                    var t = dt(this, e);
                    t.insertBefore(e, t.firstChild);
                }
            });
        },
        before: function() {
            return this.domManip(arguments, function(e) {
                if (this.parentNode) {
                    this.parentNode.insertBefore(e, this);
                }
            });
        },
        after: function() {
            return this.domManip(arguments, function(e) {
                if (this.parentNode) {
                    this.parentNode.insertBefore(e, this.nextSibling);
                }
            });
        },
        remove: function(e, t) {
            var i, n = e ? w.filter(e, this) : this, r = 0;
            for (;(i = n[r]) != null; r++) {
                if (!t && i.nodeType === 1) {
                    w.cleanData(vt(i));
                }
                if (i.parentNode) {
                    if (t && w.contains(i.ownerDocument, i)) {
                        gt(vt(i, "script"));
                    }
                    i.parentNode.removeChild(i);
                }
            }
            return this;
        },
        empty: function() {
            var e, t = 0;
            for (;(e = this[t]) != null; t++) {
                if (e.nodeType === 1) {
                    w.cleanData(vt(e, false));
                    e.textContent = "";
                }
            }
            return this;
        },
        clone: function(e, t) {
            e = e == null ? false : e;
            t = t == null ? e : t;
            return this.map(function() {
                return w.clone(this, e, t);
            });
        },
        html: function(e) {
            return w.access(this, function(e) {
                var i = this[0] || {}, n = 0, r = this.length;
                if (e === t && i.nodeType === 1) {
                    return i.innerHTML;
                }
                if (typeof e === "string" && !at.test(e) && !ft[(nt.exec(e) || [ "", "" ])[1].toLowerCase()]) {
                    e = e.replace(it, "<$1></$2>");
                    try {
                        for (;n < r; n++) {
                            i = this[n] || {};
                            if (i.nodeType === 1) {
                                w.cleanData(vt(i, false));
                                i.innerHTML = e;
                            }
                        }
                        i = 0;
                    } catch (a) {}
                }
                if (i) {
                    this.empty().append(e);
                }
            }, null, e, arguments.length);
        },
        replaceWith: function() {
            var e = w.map(this, function(e) {
                return [ e.nextSibling, e.parentNode ];
            }), t = 0;
            this.domManip(arguments, function(i) {
                var n = e[t++], r = e[t++];
                if (r) {
                    if (n && n.parentNode !== r) {
                        n = this.nextSibling;
                    }
                    w(this).remove();
                    r.insertBefore(i, n);
                }
            }, true);
            return t ? this : this.remove();
        },
        detach: function(e) {
            return this.remove(e, true);
        },
        domManip: function(e, t, i) {
            e = h.apply([], e);
            var n, r, a, o, s, l, c = 0, u = this.length, f = this, d = u - 1, p = e[0], g = w.isFunction(p);
            if (g || !(u <= 1 || typeof p !== "string" || w.support.checkClone || !st.test(p))) {
                return this.each(function(n) {
                    var r = f.eq(n);
                    if (g) {
                        e[0] = p.call(this, n, r.html());
                    }
                    r.domManip(e, t, i);
                });
            }
            if (u) {
                n = w.buildFragment(e, this[0].ownerDocument, false, !i && this);
                r = n.firstChild;
                if (n.childNodes.length === 1) {
                    n = r;
                }
                if (r) {
                    a = w.map(vt(n, "script"), ht);
                    o = a.length;
                    for (;c < u; c++) {
                        s = n;
                        if (c !== d) {
                            s = w.clone(s, true, true);
                            if (o) {
                                w.merge(a, vt(s, "script"));
                            }
                        }
                        t.call(this[c], s, c);
                    }
                    if (o) {
                        l = a[a.length - 1].ownerDocument;
                        w.map(a, pt);
                        for (c = 0; c < o; c++) {
                            s = a[c];
                            if (lt.test(s.type || "") && !R.access(s, "globalEval") && w.contains(l, s)) {
                                if (s.src) {
                                    w._evalUrl(s.src);
                                } else {
                                    w.globalEval(s.textContent.replace(ut, ""));
                                }
                            }
                        }
                    }
                }
            }
            return this;
        }
    });
    w.each({
        appendTo: "append",
        prependTo: "prepend",
        insertBefore: "before",
        insertAfter: "after",
        replaceAll: "replaceWith"
    }, function(e, t) {
        w.fn[e] = function(e) {
            var i, n = [], r = w(e), a = r.length - 1, o = 0;
            for (;o <= a; o++) {
                i = o === a ? this : this.clone(true);
                w(r[o])[t](i);
                p.apply(n, i.get());
            }
            return this.pushStack(n);
        };
    });
    w.extend({
        clone: function(e, t, i) {
            var n, r, a, o, s = e.cloneNode(true), l = w.contains(e.ownerDocument, e);
            if (!w.support.noCloneChecked && (e.nodeType === 1 || e.nodeType === 11) && !w.isXMLDoc(e)) {
                o = vt(s);
                a = vt(e);
                for (n = 0, r = a.length; n < r; n++) {
                    yt(a[n], o[n]);
                }
            }
            if (t) {
                if (i) {
                    a = a || vt(e);
                    o = o || vt(s);
                    for (n = 0, r = a.length; n < r; n++) {
                        mt(a[n], o[n]);
                    }
                } else {
                    mt(e, s);
                }
            }
            o = vt(s, "script");
            if (o.length > 0) {
                gt(o, !l && vt(e, "script"));
            }
            return s;
        },
        buildFragment: function(e, t, i, n) {
            var r, a, o, s, l, c, u = 0, f = e.length, d = t.createDocumentFragment(), h = [];
            for (;u < f; u++) {
                r = e[u];
                if (r || r === 0) {
                    if (w.type(r) === "object") {
                        w.merge(h, r.nodeType ? [ r ] : r);
                    } else if (!rt.test(r)) {
                        h.push(t.createTextNode(r));
                    } else {
                        a = a || d.appendChild(t.createElement("div"));
                        o = (nt.exec(r) || [ "", "" ])[1].toLowerCase();
                        s = ft[o] || ft._default;
                        a.innerHTML = s[1] + r.replace(it, "<$1></$2>") + s[2];
                        c = s[0];
                        while (c--) {
                            a = a.lastChild;
                        }
                        w.merge(h, a.childNodes);
                        a = d.firstChild;
                        a.textContent = "";
                    }
                }
            }
            d.textContent = "";
            u = 0;
            while (r = h[u++]) {
                if (n && w.inArray(r, n) !== -1) {
                    continue;
                }
                l = w.contains(r.ownerDocument, r);
                a = vt(d.appendChild(r), "script");
                if (l) {
                    gt(a);
                }
                if (i) {
                    c = 0;
                    while (r = a[c++]) {
                        if (lt.test(r.type || "")) {
                            i.push(r);
                        }
                    }
                }
            }
            return d;
        },
        cleanData: function(e) {
            var i, n, r, a, o, s, l = w.event.special, c = 0;
            for (;(n = e[c]) !== t; c++) {
                if (M.accepts(n)) {
                    o = n[R.expando];
                    if (o && (i = R.cache[o])) {
                        r = Object.keys(i.events || {});
                        if (r.length) {
                            for (s = 0; (a = r[s]) !== t; s++) {
                                if (l[a]) {
                                    w.event.remove(n, a);
                                } else {
                                    w.removeEvent(n, a, i.handle);
                                }
                            }
                        }
                        if (R.cache[o]) {
                            delete R.cache[o];
                        }
                    }
                }
                delete D.cache[n[D.expando]];
            }
        },
        _evalUrl: function(e) {
            return w.ajax({
                url: e,
                type: "GET",
                dataType: "script",
                async: false,
                global: false,
                "throws": true
            });
        }
    });
    function dt(e, t) {
        return w.nodeName(e, "table") && w.nodeName(t.nodeType === 1 ? t : t.firstChild, "tr") ? e.getElementsByTagName("tbody")[0] || e.appendChild(e.ownerDocument.createElement("tbody")) : e;
    }
    function ht(e) {
        e.type = (e.getAttribute("type") !== null) + "/" + e.type;
        return e;
    }
    function pt(e) {
        var t = ct.exec(e.type);
        if (t) {
            e.type = t[1];
        } else {
            e.removeAttribute("type");
        }
        return e;
    }
    function gt(e, t) {
        var i = e.length, n = 0;
        for (;n < i; n++) {
            R.set(e[n], "globalEval", !t || R.get(t[n], "globalEval"));
        }
    }
    function mt(e, t) {
        var i, n, r, a, o, s, l, c;
        if (t.nodeType !== 1) {
            return;
        }
        if (R.hasData(e)) {
            a = R.access(e);
            o = R.set(t, a);
            c = a.events;
            if (c) {
                delete o.handle;
                o.events = {};
                for (r in c) {
                    for (i = 0, n = c[r].length; i < n; i++) {
                        w.event.add(t, r, c[r][i]);
                    }
                }
            }
        }
        if (D.hasData(e)) {
            s = D.access(e);
            l = w.extend({}, s);
            D.set(t, l);
        }
    }
    function vt(e, i) {
        var n = e.getElementsByTagName ? e.getElementsByTagName(i || "*") : e.querySelectorAll ? e.querySelectorAll(i || "*") : [];
        return i === t || i && w.nodeName(e, i) ? w.merge([ e ], n) : n;
    }
    function yt(e, t) {
        var i = t.nodeName.toLowerCase();
        if (i === "input" && ot.test(e.type)) {
            t.checked = e.checked;
        } else if (i === "input" || i === "textarea") {
            t.defaultValue = e.defaultValue;
        }
    }
    w.fn.extend({
        wrapAll: function(e) {
            var t;
            if (w.isFunction(e)) {
                return this.each(function(t) {
                    w(this).wrapAll(e.call(this, t));
                });
            }
            if (this[0]) {
                t = w(e, this[0].ownerDocument).eq(0).clone(true);
                if (this[0].parentNode) {
                    t.insertBefore(this[0]);
                }
                t.map(function() {
                    var e = this;
                    while (e.firstElementChild) {
                        e = e.firstElementChild;
                    }
                    return e;
                }).append(this);
            }
            return this;
        },
        wrapInner: function(e) {
            if (w.isFunction(e)) {
                return this.each(function(t) {
                    w(this).wrapInner(e.call(this, t));
                });
            }
            return this.each(function() {
                var t = w(this), i = t.contents();
                if (i.length) {
                    i.wrapAll(e);
                } else {
                    t.append(e);
                }
            });
        },
        wrap: function(e) {
            var t = w.isFunction(e);
            return this.each(function(i) {
                w(this).wrapAll(t ? e.call(this, i) : e);
            });
        },
        unwrap: function() {
            return this.parent().each(function() {
                if (!w.nodeName(this, "body")) {
                    w(this).replaceWith(this.childNodes);
                }
            }).end();
        }
    });
    var bt, wt, Ct = /^(none|table(?!-c[ea]).+)/, xt = /^margin/, _t = new RegExp("^(" + C + ")(.*)$", "i"), St = new RegExp("^(" + C + ")(?!px)[a-z%]+$", "i"), kt = new RegExp("^([+-])=(" + C + ")", "i"), At = {
        BODY: "block"
    }, Et = {
        position: "absolute",
        visibility: "hidden",
        display: "block"
    }, Tt = {
        letterSpacing: 0,
        fontWeight: 400
    }, Pt = [ "Top", "Right", "Bottom", "Left" ], It = [ "Webkit", "O", "Moz", "ms" ];
    function Ot(e, t) {
        if (t in e) {
            return t;
        }
        var i = t.charAt(0).toUpperCase() + t.slice(1), n = t, r = It.length;
        while (r--) {
            t = It[r] + i;
            if (t in e) {
                return t;
            }
        }
        return n;
    }
    function Dt(e, t) {
        e = t || e;
        return w.css(e, "display") === "none" || !w.contains(e.ownerDocument, e);
    }
    function Rt(t) {
        return e.getComputedStyle(t, null);
    }
    function Lt(e, t) {
        var i, n, r, a = [], o = 0, s = e.length;
        for (;o < s; o++) {
            n = e[o];
            if (!n.style) {
                continue;
            }
            a[o] = R.get(n, "olddisplay");
            i = n.style.display;
            if (t) {
                if (!a[o] && i === "none") {
                    n.style.display = "";
                }
                if (n.style.display === "" && Dt(n)) {
                    a[o] = R.access(n, "olddisplay", Bt(n.nodeName));
                }
            } else {
                if (!a[o]) {
                    r = Dt(n);
                    if (i && i !== "none" || !r) {
                        R.set(n, "olddisplay", r ? i : w.css(n, "display"));
                    }
                }
            }
        }
        for (o = 0; o < s; o++) {
            n = e[o];
            if (!n.style) {
                continue;
            }
            if (!t || n.style.display === "none" || n.style.display === "") {
                n.style.display = t ? a[o] || "" : "none";
            }
        }
        return e;
    }
    w.fn.extend({
        css: function(e, i) {
            return w.access(this, function(e, i, n) {
                var r, a, o = {}, s = 0;
                if (w.isArray(i)) {
                    r = Rt(e);
                    a = i.length;
                    for (;s < a; s++) {
                        o[i[s]] = w.css(e, i[s], false, r);
                    }
                    return o;
                }
                return n !== t ? w.style(e, i, n) : w.css(e, i);
            }, e, i, arguments.length > 1);
        },
        show: function() {
            return Lt(this, true);
        },
        hide: function() {
            return Lt(this);
        },
        toggle: function(e) {
            if (typeof e === "boolean") {
                return e ? this.show() : this.hide();
            }
            return this.each(function() {
                if (Dt(this)) {
                    w(this).show();
                } else {
                    w(this).hide();
                }
            });
        }
    });
    w.extend({
        cssHooks: {
            opacity: {
                get: function(e, t) {
                    if (t) {
                        var i = bt(e, "opacity");
                        return i === "" ? "1" : i;
                    }
                }
            }
        },
        cssNumber: {
            columnCount: true,
            fillOpacity: true,
            fontWeight: true,
            lineHeight: true,
            opacity: true,
            order: true,
            orphans: true,
            widows: true,
            zIndex: true,
            zoom: true
        },
        cssProps: {
            "float": "cssFloat"
        },
        style: function(e, i, n, r) {
            if (!e || e.nodeType === 3 || e.nodeType === 8 || !e.style) {
                return;
            }
            var a, o, s, l = w.camelCase(i), c = e.style;
            i = w.cssProps[l] || (w.cssProps[l] = Ot(c, l));
            s = w.cssHooks[i] || w.cssHooks[l];
            if (n !== t) {
                o = typeof n;
                if (o === "string" && (a = kt.exec(n))) {
                    n = (a[1] + 1) * a[2] + parseFloat(w.css(e, i));
                    o = "number";
                }
                if (n == null || o === "number" && isNaN(n)) {
                    return;
                }
                if (o === "number" && !w.cssNumber[l]) {
                    n += "px";
                }
                if (!w.support.clearCloneStyle && n === "" && i.indexOf("background") === 0) {
                    c[i] = "inherit";
                }
                if (!s || !("set" in s) || (n = s.set(e, n, r)) !== t) {
                    c[i] = n;
                }
            } else {
                if (s && "get" in s && (a = s.get(e, false, r)) !== t) {
                    return a;
                }
                return c[i];
            }
        },
        css: function(e, i, n, r) {
            var a, o, s, l = w.camelCase(i);
            i = w.cssProps[l] || (w.cssProps[l] = Ot(e.style, l));
            s = w.cssHooks[i] || w.cssHooks[l];
            if (s && "get" in s) {
                a = s.get(e, true, n);
            }
            if (a === t) {
                a = bt(e, i, r);
            }
            if (a === "normal" && i in Tt) {
                a = Tt[i];
            }
            if (n === "" || n) {
                o = parseFloat(a);
                return n === true || w.isNumeric(o) ? o || 0 : a;
            }
            return a;
        }
    });
    bt = function(e, i, n) {
        var r, a, o, s = n || Rt(e), l = s ? s.getPropertyValue(i) || s[i] : t, c = e.style;
        if (s) {
            if (l === "" && !w.contains(e.ownerDocument, e)) {
                l = w.style(e, i);
            }
            if (St.test(l) && xt.test(i)) {
                r = c.width;
                a = c.minWidth;
                o = c.maxWidth;
                c.minWidth = c.maxWidth = c.width = l;
                l = s.width;
                c.width = r;
                c.minWidth = a;
                c.maxWidth = o;
            }
        }
        return l;
    };
    function Ft(e, t, i) {
        var n = _t.exec(t);
        return n ? Math.max(0, n[1] - (i || 0)) + (n[2] || "px") : t;
    }
    function Mt(e, t, i, n, r) {
        var a = i === (n ? "border" : "content") ? 4 : t === "width" ? 1 : 0, o = 0;
        for (;a < 4; a += 2) {
            if (i === "margin") {
                o += w.css(e, i + Pt[a], true, r);
            }
            if (n) {
                if (i === "content") {
                    o -= w.css(e, "padding" + Pt[a], true, r);
                }
                if (i !== "margin") {
                    o -= w.css(e, "border" + Pt[a] + "Width", true, r);
                }
            } else {
                o += w.css(e, "padding" + Pt[a], true, r);
                if (i !== "padding") {
                    o += w.css(e, "border" + Pt[a] + "Width", true, r);
                }
            }
        }
        return o;
    }
    function Nt(e, t, i) {
        var n = true, r = t === "width" ? e.offsetWidth : e.offsetHeight, a = Rt(e), o = w.support.boxSizing && w.css(e, "boxSizing", false, a) === "border-box";
        if (r <= 0 || r == null) {
            r = bt(e, t, a);
            if (r < 0 || r == null) {
                r = e.style[t];
            }
            if (St.test(r)) {
                return r;
            }
            n = o && (w.support.boxSizingReliable || r === e.style[t]);
            r = parseFloat(r) || 0;
        }
        return r + Mt(e, t, i || (o ? "border" : "content"), n, a) + "px";
    }
    function Bt(e) {
        var t = o, i = At[e];
        if (!i) {
            i = jt(e, t);
            if (i === "none" || !i) {
                wt = (wt || w("<iframe frameborder='0' width='0' height='0'/>").css("cssText", "display:block !important")).appendTo(t.documentElement);
                t = (wt[0].contentWindow || wt[0].contentDocument).document;
                t.write("<!doctype html><html><body>");
                t.close();
                i = jt(e, t);
                wt.detach();
            }
            At[e] = i;
        }
        return i;
    }
    function jt(e, t) {
        var i = w(t.createElement(e)).appendTo(t.body), n = w.css(i[0], "display");
        i.remove();
        return n;
    }
    w.each([ "height", "width" ], function(e, t) {
        w.cssHooks[t] = {
            get: function(e, i, n) {
                if (i) {
                    return e.offsetWidth === 0 && Ct.test(w.css(e, "display")) ? w.swap(e, Et, function() {
                        return Nt(e, t, n);
                    }) : Nt(e, t, n);
                }
            },
            set: function(e, i, n) {
                var r = n && Rt(e);
                return Ft(e, i, n ? Mt(e, t, n, w.support.boxSizing && w.css(e, "boxSizing", false, r) === "border-box", r) : 0);
            }
        };
    });
    w(function() {
        if (!w.support.reliableMarginRight) {
            w.cssHooks.marginRight = {
                get: function(e, t) {
                    if (t) {
                        return w.swap(e, {
                            display: "inline-block"
                        }, bt, [ e, "marginRight" ]);
                    }
                }
            };
        }
        if (!w.support.pixelPosition && w.fn.position) {
            w.each([ "top", "left" ], function(e, t) {
                w.cssHooks[t] = {
                    get: function(e, i) {
                        if (i) {
                            i = bt(e, t);
                            return St.test(i) ? w(e).position()[t] + "px" : i;
                        }
                    }
                };
            });
        }
    });
    if (w.expr && w.expr.filters) {
        w.expr.filters.hidden = function(e) {
            return e.offsetWidth <= 0 && e.offsetHeight <= 0;
        };
        w.expr.filters.visible = function(e) {
            return !w.expr.filters.hidden(e);
        };
    }
    w.each({
        margin: "",
        padding: "",
        border: "Width"
    }, function(e, t) {
        w.cssHooks[e + t] = {
            expand: function(i) {
                var n = 0, r = {}, a = typeof i === "string" ? i.split(" ") : [ i ];
                for (;n < 4; n++) {
                    r[e + Pt[n] + t] = a[n] || a[n - 2] || a[0];
                }
                return r;
            }
        };
        if (!xt.test(e)) {
            w.cssHooks[e + t].set = Ft;
        }
    });
    var Ut = /%20/g, zt = /\[\]$/, qt = /\r?\n/g, Wt = /^(?:submit|button|image|reset|file)$/i, Ht = /^(?:input|select|textarea|keygen)/i;
    w.fn.extend({
        serialize: function() {
            return w.param(this.serializeArray());
        },
        serializeArray: function() {
            return this.map(function() {
                var e = w.prop(this, "elements");
                return e ? w.makeArray(e) : this;
            }).filter(function() {
                var e = this.type;
                return this.name && !w(this).is(":disabled") && Ht.test(this.nodeName) && !Wt.test(e) && (this.checked || !ot.test(e));
            }).map(function(e, t) {
                var i = w(this).val();
                return i == null ? null : w.isArray(i) ? w.map(i, function(e) {
                    return {
                        name: t.name,
                        value: e.replace(qt, "\r\n")
                    };
                }) : {
                    name: t.name,
                    value: i.replace(qt, "\r\n")
                };
            }).get();
        }
    });
    w.param = function(e, i) {
        var n, r = [], a = function(e, t) {
            t = w.isFunction(t) ? t() : t == null ? "" : t;
            r[r.length] = encodeURIComponent(e) + "=" + encodeURIComponent(t);
        };
        if (i === t) {
            i = w.ajaxSettings && w.ajaxSettings.traditional;
        }
        if (w.isArray(e) || e.jquery && !w.isPlainObject(e)) {
            w.each(e, function() {
                a(this.name, this.value);
            });
        } else {
            for (n in e) {
                Gt(n, e[n], i, a);
            }
        }
        return r.join("&").replace(Ut, "+");
    };
    function Gt(e, t, i, n) {
        var r;
        if (w.isArray(t)) {
            w.each(t, function(t, r) {
                if (i || zt.test(e)) {
                    n(e, r);
                } else {
                    Gt(e + "[" + (typeof r === "object" ? t : "") + "]", r, i, n);
                }
            });
        } else if (!i && w.type(t) === "object") {
            for (r in t) {
                Gt(e + "[" + r + "]", t[r], i, n);
            }
        } else {
            n(e, t);
        }
    }
    w.each(("blur focus focusin focusout load resize scroll unload click dblclick " + "mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave " + "change select submit keydown keypress keyup error contextmenu").split(" "), function(e, t) {
        w.fn[t] = function(e, i) {
            return arguments.length > 0 ? this.on(t, null, e, i) : this.trigger(t);
        };
    });
    w.fn.extend({
        hover: function(e, t) {
            return this.mouseenter(e).mouseleave(t || e);
        },
        bind: function(e, t, i) {
            return this.on(e, null, t, i);
        },
        unbind: function(e, t) {
            return this.off(e, null, t);
        },
        delegate: function(e, t, i, n) {
            return this.on(t, e, i, n);
        },
        undelegate: function(e, t, i) {
            return arguments.length === 1 ? this.off(e, "**") : this.off(t, e || "**", i);
        }
    });
    var Vt, $t, Yt = w.now(), Xt = /\?/, Jt = /#.*$/, Kt = /([?&])_=[^&]*/, Qt = /^(.*?):[ \t]*([^\r\n]*)$/gm, Zt = /^(?:about|app|app-storage|.+-extension|file|res|widget):$/, ei = /^(?:GET|HEAD)$/, ti = /^\/\//, ii = /^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/, ni = w.fn.load, ri = {}, ai = {}, oi = "*/".concat("*");
    try {
        $t = a.href;
    } catch (si) {
        $t = o.createElement("a");
        $t.href = "";
        $t = $t.href;
    }
    Vt = ii.exec($t.toLowerCase()) || [];
    function li(e) {
        return function(t, i) {
            if (typeof t !== "string") {
                i = t;
                t = "*";
            }
            var n, r = 0, a = t.toLowerCase().match(x) || [];
            if (w.isFunction(i)) {
                while (n = a[r++]) {
                    if (n[0] === "+") {
                        n = n.slice(1) || "*";
                        (e[n] = e[n] || []).unshift(i);
                    } else {
                        (e[n] = e[n] || []).push(i);
                    }
                }
            }
        };
    }
    function ci(e, t, i, n) {
        var r = {}, a = e === ai;
        function o(s) {
            var l;
            r[s] = true;
            w.each(e[s] || [], function(e, s) {
                var c = s(t, i, n);
                if (typeof c === "string" && !a && !r[c]) {
                    t.dataTypes.unshift(c);
                    o(c);
                    return false;
                } else if (a) {
                    return !(l = c);
                }
            });
            return l;
        }
        return o(t.dataTypes[0]) || !r["*"] && o("*");
    }
    function ui(e, i) {
        var n, r, a = w.ajaxSettings.flatOptions || {};
        for (n in i) {
            if (i[n] !== t) {
                (a[n] ? e : r || (r = {}))[n] = i[n];
            }
        }
        if (r) {
            w.extend(true, e, r);
        }
        return e;
    }
    w.fn.load = function(e, i, n) {
        if (typeof e !== "string" && ni) {
            return ni.apply(this, arguments);
        }
        var r, a, o, s = this, l = e.indexOf(" ");
        if (l >= 0) {
            r = e.slice(l);
            e = e.slice(0, l);
        }
        if (w.isFunction(i)) {
            n = i;
            i = t;
        } else if (i && typeof i === "object") {
            a = "POST";
        }
        if (s.length > 0) {
            w.ajax({
                url: e,
                type: a,
                dataType: "html",
                data: i
            }).done(function(e) {
                o = arguments;
                s.html(r ? w("<div>").append(w.parseHTML(e)).find(r) : e);
            }).complete(n && function(e, t) {
                s.each(n, o || [ e.responseText, t, e ]);
            });
        }
        return this;
    };
    w.each([ "ajaxStart", "ajaxStop", "ajaxComplete", "ajaxError", "ajaxSuccess", "ajaxSend" ], function(e, t) {
        w.fn[t] = function(e) {
            return this.on(t, e);
        };
    });
    w.extend({
        active: 0,
        lastModified: {},
        etag: {},
        ajaxSettings: {
            url: $t,
            type: "GET",
            isLocal: Zt.test(Vt[1]),
            global: true,
            processData: true,
            async: true,
            contentType: "application/x-www-form-urlencoded; charset=UTF-8",
            accepts: {
                "*": oi,
                text: "text/plain",
                html: "text/html",
                xml: "application/xml, text/xml",
                json: "application/json, text/javascript"
            },
            contents: {
                xml: /xml/,
                html: /html/,
                json: /json/
            },
            responseFields: {
                xml: "responseXML",
                text: "responseText",
                json: "responseJSON"
            },
            converters: {
                "* text": String,
                "text html": true,
                "text json": w.parseJSON,
                "text xml": w.parseXML
            },
            flatOptions: {
                url: true,
                context: true
            }
        },
        ajaxSetup: function(e, t) {
            return t ? ui(ui(e, w.ajaxSettings), t) : ui(w.ajaxSettings, e);
        },
        ajaxPrefilter: li(ri),
        ajaxTransport: li(ai),
        ajax: function(e, i) {
            if (typeof e === "object") {
                i = e;
                e = t;
            }
            i = i || {};
            var n, r, a, o, s, l, c, u, f = w.ajaxSetup({}, i), d = f.context || f, h = f.context && (d.nodeType || d.jquery) ? w(d) : w.event, p = w.Deferred(), g = w.Callbacks("once memory"), m = f.statusCode || {}, v = {}, y = {}, b = 0, C = "canceled", _ = {
                readyState: 0,
                getResponseHeader: function(e) {
                    var t;
                    if (b === 2) {
                        if (!o) {
                            o = {};
                            while (t = Qt.exec(a)) {
                                o[t[1].toLowerCase()] = t[2];
                            }
                        }
                        t = o[e.toLowerCase()];
                    }
                    return t == null ? null : t;
                },
                getAllResponseHeaders: function() {
                    return b === 2 ? a : null;
                },
                setRequestHeader: function(e, t) {
                    var i = e.toLowerCase();
                    if (!b) {
                        e = y[i] = y[i] || e;
                        v[e] = t;
                    }
                    return this;
                },
                overrideMimeType: function(e) {
                    if (!b) {
                        f.mimeType = e;
                    }
                    return this;
                },
                statusCode: function(e) {
                    var t;
                    if (e) {
                        if (b < 2) {
                            for (t in e) {
                                m[t] = [ m[t], e[t] ];
                            }
                        } else {
                            _.always(e[_.status]);
                        }
                    }
                    return this;
                },
                abort: function(e) {
                    var t = e || C;
                    if (n) {
                        n.abort(t);
                    }
                    k(0, t);
                    return this;
                }
            };
            p.promise(_).complete = g.add;
            _.success = _.done;
            _.error = _.fail;
            f.url = ((e || f.url || $t) + "").replace(Jt, "").replace(ti, Vt[1] + "//");
            f.type = i.method || i.type || f.method || f.type;
            f.dataTypes = w.trim(f.dataType || "*").toLowerCase().match(x) || [ "" ];
            if (f.crossDomain == null) {
                l = ii.exec(f.url.toLowerCase());
                f.crossDomain = !!(l && (l[1] !== Vt[1] || l[2] !== Vt[2] || (l[3] || (l[1] === "http:" ? "80" : "443")) !== (Vt[3] || (Vt[1] === "http:" ? "80" : "443"))));
            }
            if (f.data && f.processData && typeof f.data !== "string") {
                f.data = w.param(f.data, f.traditional);
            }
            ci(ri, f, i, _);
            if (b === 2) {
                return _;
            }
            c = f.global;
            if (c && w.active++ === 0) {
                w.event.trigger("ajaxStart");
            }
            f.type = f.type.toUpperCase();
            f.hasContent = !ei.test(f.type);
            r = f.url;
            if (!f.hasContent) {
                if (f.data) {
                    r = f.url += (Xt.test(r) ? "&" : "?") + f.data;
                    delete f.data;
                }
                if (f.cache === false) {
                    f.url = Kt.test(r) ? r.replace(Kt, "$1_=" + Yt++) : r + (Xt.test(r) ? "&" : "?") + "_=" + Yt++;
                }
            }
            if (f.ifModified) {
                if (w.lastModified[r]) {
                    _.setRequestHeader("If-Modified-Since", w.lastModified[r]);
                }
                if (w.etag[r]) {
                    _.setRequestHeader("If-None-Match", w.etag[r]);
                }
            }
            if (f.data && f.hasContent && f.contentType !== false || i.contentType) {
                _.setRequestHeader("Content-Type", f.contentType);
            }
            _.setRequestHeader("Accept", f.dataTypes[0] && f.accepts[f.dataTypes[0]] ? f.accepts[f.dataTypes[0]] + (f.dataTypes[0] !== "*" ? ", " + oi + "; q=0.01" : "") : f.accepts["*"]);
            for (u in f.headers) {
                _.setRequestHeader(u, f.headers[u]);
            }
            if (f.beforeSend && (f.beforeSend.call(d, _, f) === false || b === 2)) {
                return _.abort();
            }
            C = "abort";
            for (u in {
                success: 1,
                error: 1,
                complete: 1
            }) {
                _[u](f[u]);
            }
            n = ci(ai, f, i, _);
            if (!n) {
                k(-1, "No Transport");
            } else {
                _.readyState = 1;
                if (c) {
                    h.trigger("ajaxSend", [ _, f ]);
                }
                if (f.async && f.timeout > 0) {
                    s = setTimeout(function() {
                        _.abort("timeout");
                    }, f.timeout);
                }
                try {
                    b = 1;
                    n.send(v, k);
                } catch (S) {
                    if (b < 2) {
                        k(-1, S);
                    } else {
                        throw S;
                    }
                }
            }
            function k(e, i, o, l) {
                var u, v, y, C, x, S = i;
                if (b === 2) {
                    return;
                }
                b = 2;
                if (s) {
                    clearTimeout(s);
                }
                n = t;
                a = l || "";
                _.readyState = e > 0 ? 4 : 0;
                u = e >= 200 && e < 300 || e === 304;
                if (o) {
                    C = fi(f, _, o);
                }
                C = di(f, C, _, u);
                if (u) {
                    if (f.ifModified) {
                        x = _.getResponseHeader("Last-Modified");
                        if (x) {
                            w.lastModified[r] = x;
                        }
                        x = _.getResponseHeader("etag");
                        if (x) {
                            w.etag[r] = x;
                        }
                    }
                    if (e === 204 || f.type === "HEAD") {
                        S = "nocontent";
                    } else if (e === 304) {
                        S = "notmodified";
                    } else {
                        S = C.state;
                        v = C.data;
                        y = C.error;
                        u = !y;
                    }
                } else {
                    y = S;
                    if (e || !S) {
                        S = "error";
                        if (e < 0) {
                            e = 0;
                        }
                    }
                }
                _.status = e;
                _.statusText = (i || S) + "";
                if (u) {
                    p.resolveWith(d, [ v, S, _ ]);
                } else {
                    p.rejectWith(d, [ _, S, y ]);
                }
                _.statusCode(m);
                m = t;
                if (c) {
                    h.trigger(u ? "ajaxSuccess" : "ajaxError", [ _, f, u ? v : y ]);
                }
                g.fireWith(d, [ _, S ]);
                if (c) {
                    h.trigger("ajaxComplete", [ _, f ]);
                    if (!--w.active) {
                        w.event.trigger("ajaxStop");
                    }
                }
            }
            return _;
        },
        getJSON: function(e, t, i) {
            return w.get(e, t, i, "json");
        },
        getScript: function(e, i) {
            return w.get(e, t, i, "script");
        }
    });
    w.each([ "get", "post" ], function(e, i) {
        w[i] = function(e, n, r, a) {
            if (w.isFunction(n)) {
                a = a || r;
                r = n;
                n = t;
            }
            return w.ajax({
                url: e,
                type: i,
                dataType: a,
                data: n,
                success: r
            });
        };
    });
    function fi(e, i, n) {
        var r, a, o, s, l = e.contents, c = e.dataTypes;
        while (c[0] === "*") {
            c.shift();
            if (r === t) {
                r = e.mimeType || i.getResponseHeader("Content-Type");
            }
        }
        if (r) {
            for (a in l) {
                if (l[a] && l[a].test(r)) {
                    c.unshift(a);
                    break;
                }
            }
        }
        if (c[0] in n) {
            o = c[0];
        } else {
            for (a in n) {
                if (!c[0] || e.converters[a + " " + c[0]]) {
                    o = a;
                    break;
                }
                if (!s) {
                    s = a;
                }
            }
            o = o || s;
        }
        if (o) {
            if (o !== c[0]) {
                c.unshift(o);
            }
            return n[o];
        }
    }
    function di(e, t, i, n) {
        var r, a, o, s, l, c = {}, u = e.dataTypes.slice();
        if (u[1]) {
            for (o in e.converters) {
                c[o.toLowerCase()] = e.converters[o];
            }
        }
        a = u.shift();
        while (a) {
            if (e.responseFields[a]) {
                i[e.responseFields[a]] = t;
            }
            if (!l && n && e.dataFilter) {
                t = e.dataFilter(t, e.dataType);
            }
            l = a;
            a = u.shift();
            if (a) {
                if (a === "*") {
                    a = l;
                } else if (l !== "*" && l !== a) {
                    o = c[l + " " + a] || c["* " + a];
                    if (!o) {
                        for (r in c) {
                            s = r.split(" ");
                            if (s[1] === a) {
                                o = c[l + " " + s[0]] || c["* " + s[0]];
                                if (o) {
                                    if (o === true) {
                                        o = c[r];
                                    } else if (c[r] !== true) {
                                        a = s[0];
                                        u.unshift(s[1]);
                                    }
                                    break;
                                }
                            }
                        }
                    }
                    if (o !== true) {
                        if (o && e["throws"]) {
                            t = o(t);
                        } else {
                            try {
                                t = o(t);
                            } catch (f) {
                                return {
                                    state: "parsererror",
                                    error: o ? f : "No conversion from " + l + " to " + a
                                };
                            }
                        }
                    }
                }
            }
        }
        return {
            state: "success",
            data: t
        };
    }
    w.ajaxSetup({
        accepts: {
            script: "text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"
        },
        contents: {
            script: /(?:java|ecma)script/
        },
        converters: {
            "text script": function(e) {
                w.globalEval(e);
                return e;
            }
        }
    });
    w.ajaxPrefilter("script", function(e) {
        if (e.cache === t) {
            e.cache = false;
        }
        if (e.crossDomain) {
            e.type = "GET";
        }
    });
    w.ajaxTransport("script", function(e) {
        if (e.crossDomain) {
            var t, i;
            return {
                send: function(n, r) {
                    t = w("<script>").prop({
                        async: true,
                        charset: e.scriptCharset,
                        src: e.url
                    }).on("load error", i = function(e) {
                        t.remove();
                        i = null;
                        if (e) {
                            r(e.type === "error" ? 404 : 200, e.type);
                        }
                    });
                    o.head.appendChild(t[0]);
                },
                abort: function() {
                    if (i) {
                        i();
                    }
                }
            };
        }
    });
    var hi = [], pi = /(=)\?(?=&|$)|\?\?/;
    w.ajaxSetup({
        jsonp: "callback",
        jsonpCallback: function() {
            var e = hi.pop() || w.expando + "_" + Yt++;
            this[e] = true;
            return e;
        }
    });
    w.ajaxPrefilter("json jsonp", function(i, n, r) {
        var a, o, s, l = i.jsonp !== false && (pi.test(i.url) ? "url" : typeof i.data === "string" && !(i.contentType || "").indexOf("application/x-www-form-urlencoded") && pi.test(i.data) && "data");
        if (l || i.dataTypes[0] === "jsonp") {
            a = i.jsonpCallback = w.isFunction(i.jsonpCallback) ? i.jsonpCallback() : i.jsonpCallback;
            if (l) {
                i[l] = i[l].replace(pi, "$1" + a);
            } else if (i.jsonp !== false) {
                i.url += (Xt.test(i.url) ? "&" : "?") + i.jsonp + "=" + a;
            }
            i.converters["script json"] = function() {
                if (!s) {
                    w.error(a + " was not called");
                }
                return s[0];
            };
            i.dataTypes[0] = "json";
            o = e[a];
            e[a] = function() {
                s = arguments;
            };
            r.always(function() {
                e[a] = o;
                if (i[a]) {
                    i.jsonpCallback = n.jsonpCallback;
                    hi.push(a);
                }
                if (s && w.isFunction(o)) {
                    o(s[0]);
                }
                s = o = t;
            });
            return "script";
        }
    });
    w.ajaxSettings.xhr = function() {
        try {
            return new XMLHttpRequest();
        } catch (e) {}
    };
    var gi = w.ajaxSettings.xhr(), mi = {
        0: 200,
        1223: 204
    }, vi = 0, yi = {};
    if (e.ActiveXObject) {
        w(e).on("unload", function() {
            for (var e in yi) {
                yi[e]();
            }
            yi = t;
        });
    }
    w.support.cors = !!gi && "withCredentials" in gi;
    w.support.ajax = gi = !!gi;
    w.ajaxTransport(function(e) {
        var i;
        if (w.support.cors || gi && !e.crossDomain) {
            return {
                send: function(n, r) {
                    var a, o, s = e.xhr();
                    s.open(e.type, e.url, e.async, e.username, e.password);
                    if (e.xhrFields) {
                        for (a in e.xhrFields) {
                            s[a] = e.xhrFields[a];
                        }
                    }
                    if (e.mimeType && s.overrideMimeType) {
                        s.overrideMimeType(e.mimeType);
                    }
                    if (!e.crossDomain && !n["X-Requested-With"]) {
                        n["X-Requested-With"] = "XMLHttpRequest";
                    }
                    for (a in n) {
                        s.setRequestHeader(a, n[a]);
                    }
                    i = function(e) {
                        return function() {
                            if (i) {
                                delete yi[o];
                                i = s.onload = s.onerror = null;
                                if (e === "abort") {
                                    s.abort();
                                } else if (e === "error") {
                                    r(s.status || 404, s.statusText);
                                } else {
                                    r(mi[s.status] || s.status, s.statusText, typeof s.responseText === "string" ? {
                                        text: s.responseText
                                    } : t, s.getAllResponseHeaders());
                                }
                            }
                        };
                    };
                    s.onload = i();
                    s.onerror = i("error");
                    i = yi[o = vi++] = i("abort");
                    s.send(e.hasContent && e.data || null);
                },
                abort: function() {
                    if (i) {
                        i();
                    }
                }
            };
        }
    });
    var bi, wi, Ci = /^(?:toggle|show|hide)$/, xi = new RegExp("^(?:([+-])=|)(" + C + ")([a-z%]*)$", "i"), _i = /queueHooks$/, Si = [ Ii ], ki = {
        "*": [ function(e, t) {
            var i = this.createTween(e, t), n = i.cur(), r = xi.exec(t), a = r && r[3] || (w.cssNumber[e] ? "" : "px"), o = (w.cssNumber[e] || a !== "px" && +n) && xi.exec(w.css(i.elem, e)), s = 1, l = 20;
            if (o && o[3] !== a) {
                a = a || o[3];
                r = r || [];
                o = +n || 1;
                do {
                    s = s || ".5";
                    o = o / s;
                    w.style(i.elem, e, o + a);
                } while (s !== (s = i.cur() / n) && s !== 1 && --l);
            }
            if (r) {
                o = i.start = +o || +n || 0;
                i.unit = a;
                i.end = r[1] ? o + (r[1] + 1) * r[2] : +r[2];
            }
            return i;
        } ]
    };
    function Ai() {
        setTimeout(function() {
            bi = t;
        });
        return bi = w.now();
    }
    function Ei(e, t, i) {
        var n, r = (ki[t] || []).concat(ki["*"]), a = 0, o = r.length;
        for (;a < o; a++) {
            if (n = r[a].call(i, t, e)) {
                return n;
            }
        }
    }
    function Ti(e, t, i) {
        var n, r, a = 0, o = Si.length, s = w.Deferred().always(function() {
            delete l.elem;
        }), l = function() {
            if (r) {
                return false;
            }
            var t = bi || Ai(), i = Math.max(0, c.startTime + c.duration - t), n = i / c.duration || 0, a = 1 - n, o = 0, l = c.tweens.length;
            for (;o < l; o++) {
                c.tweens[o].run(a);
            }
            s.notifyWith(e, [ c, a, i ]);
            if (a < 1 && l) {
                return i;
            } else {
                s.resolveWith(e, [ c ]);
                return false;
            }
        }, c = s.promise({
            elem: e,
            props: w.extend({}, t),
            opts: w.extend(true, {
                specialEasing: {}
            }, i),
            originalProperties: t,
            originalOptions: i,
            startTime: bi || Ai(),
            duration: i.duration,
            tweens: [],
            createTween: function(t, i) {
                var n = w.Tween(e, c.opts, t, i, c.opts.specialEasing[t] || c.opts.easing);
                c.tweens.push(n);
                return n;
            },
            stop: function(t) {
                var i = 0, n = t ? c.tweens.length : 0;
                if (r) {
                    return this;
                }
                r = true;
                for (;i < n; i++) {
                    c.tweens[i].run(1);
                }
                if (t) {
                    s.resolveWith(e, [ c, t ]);
                } else {
                    s.rejectWith(e, [ c, t ]);
                }
                return this;
            }
        }), u = c.props;
        Pi(u, c.opts.specialEasing);
        for (;a < o; a++) {
            n = Si[a].call(c, e, u, c.opts);
            if (n) {
                return n;
            }
        }
        w.map(u, Ei, c);
        if (w.isFunction(c.opts.start)) {
            c.opts.start.call(e, c);
        }
        w.fx.timer(w.extend(l, {
            elem: e,
            anim: c,
            queue: c.opts.queue
        }));
        return c.progress(c.opts.progress).done(c.opts.done, c.opts.complete).fail(c.opts.fail).always(c.opts.always);
    }
    function Pi(e, t) {
        var i, n, r, a, o;
        for (i in e) {
            n = w.camelCase(i);
            r = t[n];
            a = e[i];
            if (w.isArray(a)) {
                r = a[1];
                a = e[i] = a[0];
            }
            if (i !== n) {
                e[n] = a;
                delete e[i];
            }
            o = w.cssHooks[n];
            if (o && "expand" in o) {
                a = o.expand(a);
                delete e[n];
                for (i in a) {
                    if (!(i in e)) {
                        e[i] = a[i];
                        t[i] = r;
                    }
                }
            } else {
                t[n] = r;
            }
        }
    }
    w.Animation = w.extend(Ti, {
        tweener: function(e, t) {
            if (w.isFunction(e)) {
                t = e;
                e = [ "*" ];
            } else {
                e = e.split(" ");
            }
            var i, n = 0, r = e.length;
            for (;n < r; n++) {
                i = e[n];
                ki[i] = ki[i] || [];
                ki[i].unshift(t);
            }
        },
        prefilter: function(e, t) {
            if (t) {
                Si.unshift(e);
            } else {
                Si.push(e);
            }
        }
    });
    function Ii(e, i, n) {
        var r, a, o, s, l, c, u = this, f = {}, d = e.style, h = e.nodeType && Dt(e), p = R.get(e, "fxshow");
        if (!n.queue) {
            l = w._queueHooks(e, "fx");
            if (l.unqueued == null) {
                l.unqueued = 0;
                c = l.empty.fire;
                l.empty.fire = function() {
                    if (!l.unqueued) {
                        c();
                    }
                };
            }
            l.unqueued++;
            u.always(function() {
                u.always(function() {
                    l.unqueued--;
                    if (!w.queue(e, "fx").length) {
                        l.empty.fire();
                    }
                });
            });
        }
        if (e.nodeType === 1 && ("height" in i || "width" in i)) {
            n.overflow = [ d.overflow, d.overflowX, d.overflowY ];
            if (w.css(e, "display") === "inline" && w.css(e, "float") === "none") {
                d.display = "inline-block";
            }
        }
        if (n.overflow) {
            d.overflow = "hidden";
            u.always(function() {
                d.overflow = n.overflow[0];
                d.overflowX = n.overflow[1];
                d.overflowY = n.overflow[2];
            });
        }
        for (r in i) {
            a = i[r];
            if (Ci.exec(a)) {
                delete i[r];
                o = o || a === "toggle";
                if (a === (h ? "hide" : "show")) {
                    if (a === "show" && p && p[r] !== t) {
                        h = true;
                    } else {
                        continue;
                    }
                }
                f[r] = p && p[r] || w.style(e, r);
            }
        }
        if (!w.isEmptyObject(f)) {
            if (p) {
                if ("hidden" in p) {
                    h = p.hidden;
                }
            } else {
                p = R.access(e, "fxshow", {});
            }
            if (o) {
                p.hidden = !h;
            }
            if (h) {
                w(e).show();
            } else {
                u.done(function() {
                    w(e).hide();
                });
            }
            u.done(function() {
                var t;
                R.remove(e, "fxshow");
                for (t in f) {
                    w.style(e, t, f[t]);
                }
            });
            for (r in f) {
                s = Ei(h ? p[r] : 0, r, u);
                if (!(r in p)) {
                    p[r] = s.start;
                    if (h) {
                        s.end = s.start;
                        s.start = r === "width" || r === "height" ? 1 : 0;
                    }
                }
            }
        }
    }
    function Oi(e, t, i, n, r) {
        return new Oi.prototype.init(e, t, i, n, r);
    }
    w.Tween = Oi;
    Oi.prototype = {
        constructor: Oi,
        init: function(e, t, i, n, r, a) {
            this.elem = e;
            this.prop = i;
            this.easing = r || "swing";
            this.options = t;
            this.start = this.now = this.cur();
            this.end = n;
            this.unit = a || (w.cssNumber[i] ? "" : "px");
        },
        cur: function() {
            var e = Oi.propHooks[this.prop];
            return e && e.get ? e.get(this) : Oi.propHooks._default.get(this);
        },
        run: function(e) {
            var t, i = Oi.propHooks[this.prop];
            if (this.options.duration) {
                this.pos = t = w.easing[this.easing](e, this.options.duration * e, 0, 1, this.options.duration);
            } else {
                this.pos = t = e;
            }
            this.now = (this.end - this.start) * t + this.start;
            if (this.options.step) {
                this.options.step.call(this.elem, this.now, this);
            }
            if (i && i.set) {
                i.set(this);
            } else {
                Oi.propHooks._default.set(this);
            }
            return this;
        }
    };
    Oi.prototype.init.prototype = Oi.prototype;
    Oi.propHooks = {
        _default: {
            get: function(e) {
                var t;
                if (e.elem[e.prop] != null && (!e.elem.style || e.elem.style[e.prop] == null)) {
                    return e.elem[e.prop];
                }
                t = w.css(e.elem, e.prop, "");
                return !t || t === "auto" ? 0 : t;
            },
            set: function(e) {
                if (w.fx.step[e.prop]) {
                    w.fx.step[e.prop](e);
                } else if (e.elem.style && (e.elem.style[w.cssProps[e.prop]] != null || w.cssHooks[e.prop])) {
                    w.style(e.elem, e.prop, e.now + e.unit);
                } else {
                    e.elem[e.prop] = e.now;
                }
            }
        }
    };
    Oi.propHooks.scrollTop = Oi.propHooks.scrollLeft = {
        set: function(e) {
            if (e.elem.nodeType && e.elem.parentNode) {
                e.elem[e.prop] = e.now;
            }
        }
    };
    w.each([ "toggle", "show", "hide" ], function(e, t) {
        var i = w.fn[t];
        w.fn[t] = function(e, n, r) {
            return e == null || typeof e === "boolean" ? i.apply(this, arguments) : this.animate(Di(t, true), e, n, r);
        };
    });
    w.fn.extend({
        fadeTo: function(e, t, i, n) {
            return this.filter(Dt).css("opacity", 0).show().end().animate({
                opacity: t
            }, e, i, n);
        },
        animate: function(e, t, i, n) {
            var r = w.isEmptyObject(e), a = w.speed(t, i, n), o = function() {
                var t = Ti(this, w.extend({}, e), a);
                if (r || R.get(this, "finish")) {
                    t.stop(true);
                }
            };
            o.finish = o;
            return r || a.queue === false ? this.each(o) : this.queue(a.queue, o);
        },
        stop: function(e, i, n) {
            var r = function(e) {
                var t = e.stop;
                delete e.stop;
                t(n);
            };
            if (typeof e !== "string") {
                n = i;
                i = e;
                e = t;
            }
            if (i && e !== false) {
                this.queue(e || "fx", []);
            }
            return this.each(function() {
                var t = true, i = e != null && e + "queueHooks", a = w.timers, o = R.get(this);
                if (i) {
                    if (o[i] && o[i].stop) {
                        r(o[i]);
                    }
                } else {
                    for (i in o) {
                        if (o[i] && o[i].stop && _i.test(i)) {
                            r(o[i]);
                        }
                    }
                }
                for (i = a.length; i--; ) {
                    if (a[i].elem === this && (e == null || a[i].queue === e)) {
                        a[i].anim.stop(n);
                        t = false;
                        a.splice(i, 1);
                    }
                }
                if (t || !n) {
                    w.dequeue(this, e);
                }
            });
        },
        finish: function(e) {
            if (e !== false) {
                e = e || "fx";
            }
            return this.each(function() {
                var t, i = R.get(this), n = i[e + "queue"], r = i[e + "queueHooks"], a = w.timers, o = n ? n.length : 0;
                i.finish = true;
                w.queue(this, e, []);
                if (r && r.stop) {
                    r.stop.call(this, true);
                }
                for (t = a.length; t--; ) {
                    if (a[t].elem === this && a[t].queue === e) {
                        a[t].anim.stop(true);
                        a.splice(t, 1);
                    }
                }
                for (t = 0; t < o; t++) {
                    if (n[t] && n[t].finish) {
                        n[t].finish.call(this);
                    }
                }
                delete i.finish;
            });
        }
    });
    function Di(e, t) {
        var i, n = {
            height: e
        }, r = 0;
        t = t ? 1 : 0;
        for (;r < 4; r += 2 - t) {
            i = Pt[r];
            n["margin" + i] = n["padding" + i] = e;
        }
        if (t) {
            n.opacity = n.width = e;
        }
        return n;
    }
    w.each({
        slideDown: Di("show"),
        slideUp: Di("hide"),
        slideToggle: Di("toggle"),
        fadeIn: {
            opacity: "show"
        },
        fadeOut: {
            opacity: "hide"
        },
        fadeToggle: {
            opacity: "toggle"
        }
    }, function(e, t) {
        w.fn[e] = function(e, i, n) {
            return this.animate(t, e, i, n);
        };
    });
    w.speed = function(e, t, i) {
        var n = e && typeof e === "object" ? w.extend({}, e) : {
            complete: i || !i && t || w.isFunction(e) && e,
            duration: e,
            easing: i && t || t && !w.isFunction(t) && t
        };
        n.duration = w.fx.off ? 0 : typeof n.duration === "number" ? n.duration : n.duration in w.fx.speeds ? w.fx.speeds[n.duration] : w.fx.speeds._default;
        if (n.queue == null || n.queue === true) {
            n.queue = "fx";
        }
        n.old = n.complete;
        n.complete = function() {
            if (w.isFunction(n.old)) {
                n.old.call(this);
            }
            if (n.queue) {
                w.dequeue(this, n.queue);
            }
        };
        return n;
    };
    w.easing = {
        linear: function(e) {
            return e;
        },
        swing: function(e) {
            return .5 - Math.cos(e * Math.PI) / 2;
        }
    };
    w.timers = [];
    w.fx = Oi.prototype.init;
    w.fx.tick = function() {
        var e, i = w.timers, n = 0;
        bi = w.now();
        for (;n < i.length; n++) {
            e = i[n];
            if (!e() && i[n] === e) {
                i.splice(n--, 1);
            }
        }
        if (!i.length) {
            w.fx.stop();
        }
        bi = t;
    };
    w.fx.timer = function(e) {
        if (e() && w.timers.push(e)) {
            w.fx.start();
        }
    };
    w.fx.interval = 13;
    w.fx.start = function() {
        if (!wi) {
            wi = setInterval(w.fx.tick, w.fx.interval);
        }
    };
    w.fx.stop = function() {
        clearInterval(wi);
        wi = null;
    };
    w.fx.speeds = {
        slow: 600,
        fast: 200,
        _default: 400
    };
    w.fx.step = {};
    if (w.expr && w.expr.filters) {
        w.expr.filters.animated = function(e) {
            return w.grep(w.timers, function(t) {
                return e === t.elem;
            }).length;
        };
    }
    w.fn.offset = function(e) {
        if (arguments.length) {
            return e === t ? this : this.each(function(t) {
                w.offset.setOffset(this, e, t);
            });
        }
        var i, n, a = this[0], o = {
            top: 0,
            left: 0
        }, s = a && a.ownerDocument;
        if (!s) {
            return;
        }
        i = s.documentElement;
        if (!w.contains(i, a)) {
            return o;
        }
        if (typeof a.getBoundingClientRect !== r) {
            o = a.getBoundingClientRect();
        }
        n = Ri(s);
        return {
            top: o.top + n.pageYOffset - i.clientTop,
            left: o.left + n.pageXOffset - i.clientLeft
        };
    };
    w.offset = {
        setOffset: function(e, t, i) {
            var n, r, a, o, s, l, c, u = w.css(e, "position"), f = w(e), d = {};
            if (u === "static") {
                e.style.position = "relative";
            }
            s = f.offset();
            a = w.css(e, "top");
            l = w.css(e, "left");
            c = (u === "absolute" || u === "fixed") && (a + l).indexOf("auto") > -1;
            if (c) {
                n = f.position();
                o = n.top;
                r = n.left;
            } else {
                o = parseFloat(a) || 0;
                r = parseFloat(l) || 0;
            }
            if (w.isFunction(t)) {
                t = t.call(e, i, s);
            }
            if (t.top != null) {
                d.top = t.top - s.top + o;
            }
            if (t.left != null) {
                d.left = t.left - s.left + r;
            }
            if ("using" in t) {
                t.using.call(e, d);
            } else {
                f.css(d);
            }
        }
    };
    w.fn.extend({
        position: function() {
            if (!this[0]) {
                return;
            }
            var e, t, i = this[0], n = {
                top: 0,
                left: 0
            };
            if (w.css(i, "position") === "fixed") {
                t = i.getBoundingClientRect();
            } else {
                e = this.offsetParent();
                t = this.offset();
                if (!w.nodeName(e[0], "html")) {
                    n = e.offset();
                }
                n.top += w.css(e[0], "borderTopWidth", true);
                n.left += w.css(e[0], "borderLeftWidth", true);
            }
            return {
                top: t.top - n.top - w.css(i, "marginTop", true),
                left: t.left - n.left - w.css(i, "marginLeft", true)
            };
        },
        offsetParent: function() {
            return this.map(function() {
                var e = this.offsetParent || s;
                while (e && (!w.nodeName(e, "html") && w.css(e, "position") === "static")) {
                    e = e.offsetParent;
                }
                return e || s;
            });
        }
    });
    w.each({
        scrollLeft: "pageXOffset",
        scrollTop: "pageYOffset"
    }, function(i, n) {
        var r = "pageYOffset" === n;
        w.fn[i] = function(a) {
            return w.access(this, function(i, a, o) {
                var s = Ri(i);
                if (o === t) {
                    return s ? s[n] : i[a];
                }
                if (s) {
                    s.scrollTo(!r ? o : e.pageXOffset, r ? o : e.pageYOffset);
                } else {
                    i[a] = o;
                }
            }, i, a, arguments.length, null);
        };
    });
    function Ri(e) {
        return w.isWindow(e) ? e : e.nodeType === 9 && e.defaultView;
    }
    w.each({
        Height: "height",
        Width: "width"
    }, function(e, i) {
        w.each({
            padding: "inner" + e,
            content: i,
            "": "outer" + e
        }, function(n, r) {
            w.fn[r] = function(r, a) {
                var o = arguments.length && (n || typeof r !== "boolean"), s = n || (r === true || a === true ? "margin" : "border");
                return w.access(this, function(i, n, r) {
                    var a;
                    if (w.isWindow(i)) {
                        return i.document.documentElement["client" + e];
                    }
                    if (i.nodeType === 9) {
                        a = i.documentElement;
                        return Math.max(i.body["scroll" + e], a["scroll" + e], i.body["offset" + e], a["offset" + e], a["client" + e]);
                    }
                    return r === t ? w.css(i, n, s) : w.style(i, n, r, s);
                }, i, o ? r : t, o, null);
            };
        });
    });
    w.fn.size = function() {
        return this.length;
    };
    w.fn.andSelf = w.fn.addBack;
    if (typeof module === "object" && module && typeof module.exports === "object") {
        module.exports = w;
    } else {
        if (typeof define === "function" && define.amd) {
            define("jquery", [], function() {
                return w;
            });
        }
    }
    if (typeof e === "object" && typeof e.document === "object") {
        e.jQuery = e.$ = w;
    }
})(window);

(function() {
    var e = this, t = e._, i = {}, n = Array.prototype, r = Object.prototype, a = Function.prototype, o = n.push, s = n.slice, l = n.concat, c = r.toString, u = r.hasOwnProperty, f = n.forEach, d = n.map, h = n.reduce, p = n.reduceRight, g = n.filter, m = n.every, v = n.some, y = n.indexOf, b = n.lastIndexOf, w = Array.isArray, C = Object.keys, x = a.bind, _ = function(e) {
        return e instanceof _ ? e : this instanceof _ ? (this._wrapped = e, void 0) : new _(e);
    };
    "undefined" != typeof exports ? ("undefined" != typeof module && module.exports && (exports = module.exports = _), 
    exports._ = _) : e._ = _, _.VERSION = "1.5.2";
    var S = _.each = _.forEach = function(e, t, n) {
        if (null != e) if (f && e.forEach === f) e.forEach(t, n); else if (e.length === +e.length) {
            for (var r = 0, a = e.length; a > r; r++) if (t.call(n, e[r], r, e) === i) return;
        } else for (var o = _.keys(e), r = 0, a = o.length; a > r; r++) if (t.call(n, e[o[r]], o[r], e) === i) return;
    };
    _.map = _.collect = function(e, t, i) {
        var n = [];
        return null == e ? n : d && e.map === d ? e.map(t, i) : (S(e, function(e, r, a) {
            n.push(t.call(i, e, r, a));
        }), n);
    };
    var k = "Reduce of empty array with no initial value";
    _.reduce = _.foldl = _.inject = function(e, t, i, n) {
        var r = arguments.length > 2;
        if (null == e && (e = []), h && e.reduce === h) return n && (t = _.bind(t, n)), 
        r ? e.reduce(t, i) : e.reduce(t);
        if (S(e, function(e, a, o) {
            r ? i = t.call(n, i, e, a, o) : (i = e, r = !0);
        }), !r) throw new TypeError(k);
        return i;
    }, _.reduceRight = _.foldr = function(e, t, i, n) {
        var r = arguments.length > 2;
        if (null == e && (e = []), p && e.reduceRight === p) return n && (t = _.bind(t, n)), 
        r ? e.reduceRight(t, i) : e.reduceRight(t);
        var a = e.length;
        if (a !== +a) {
            var o = _.keys(e);
            a = o.length;
        }
        if (S(e, function(s, l, c) {
            l = o ? o[--a] : --a, r ? i = t.call(n, i, e[l], l, c) : (i = e[l], r = !0);
        }), !r) throw new TypeError(k);
        return i;
    }, _.find = _.detect = function(e, t, i) {
        var n;
        return A(e, function(e, r, a) {
            return t.call(i, e, r, a) ? (n = e, !0) : void 0;
        }), n;
    }, _.filter = _.select = function(e, t, i) {
        var n = [];
        return null == e ? n : g && e.filter === g ? e.filter(t, i) : (S(e, function(e, r, a) {
            t.call(i, e, r, a) && n.push(e);
        }), n);
    }, _.reject = function(e, t, i) {
        return _.filter(e, function(e, n, r) {
            return !t.call(i, e, n, r);
        }, i);
    }, _.every = _.all = function(e, t, n) {
        t || (t = _.identity);
        var r = !0;
        return null == e ? r : m && e.every === m ? e.every(t, n) : (S(e, function(e, a, o) {
            return (r = r && t.call(n, e, a, o)) ? void 0 : i;
        }), !!r);
    };
    var A = _.some = _.any = function(e, t, n) {
        t || (t = _.identity);
        var r = !1;
        return null == e ? r : v && e.some === v ? e.some(t, n) : (S(e, function(e, a, o) {
            return r || (r = t.call(n, e, a, o)) ? i : void 0;
        }), !!r);
    };
    _.contains = _.include = function(e, t) {
        return null == e ? !1 : y && e.indexOf === y ? e.indexOf(t) != -1 : A(e, function(e) {
            return e === t;
        });
    }, _.invoke = function(e, t) {
        var i = s.call(arguments, 2), n = _.isFunction(t);
        return _.map(e, function(e) {
            return (n ? t : e[t]).apply(e, i);
        });
    }, _.pluck = function(e, t) {
        return _.map(e, function(e) {
            return e[t];
        });
    }, _.where = function(e, t, i) {
        return _.isEmpty(t) ? i ? void 0 : [] : _[i ? "find" : "filter"](e, function(e) {
            for (var i in t) if (t[i] !== e[i]) return !1;
            return !0;
        });
    }, _.findWhere = function(e, t) {
        return _.where(e, t, !0);
    }, _.max = function(e, t, i) {
        if (!t && _.isArray(e) && e[0] === +e[0] && e.length < 65535) return Math.max.apply(Math, e);
        if (!t && _.isEmpty(e)) return -1 / 0;
        var n = {
            computed: -1 / 0,
            value: -1 / 0
        };
        return S(e, function(e, r, a) {
            var o = t ? t.call(i, e, r, a) : e;
            o > n.computed && (n = {
                value: e,
                computed: o
            });
        }), n.value;
    }, _.min = function(e, t, i) {
        if (!t && _.isArray(e) && e[0] === +e[0] && e.length < 65535) return Math.min.apply(Math, e);
        if (!t && _.isEmpty(e)) return 1 / 0;
        var n = {
            computed: 1 / 0,
            value: 1 / 0
        };
        return S(e, function(e, r, a) {
            var o = t ? t.call(i, e, r, a) : e;
            o < n.computed && (n = {
                value: e,
                computed: o
            });
        }), n.value;
    }, _.shuffle = function(e) {
        var t, i = 0, n = [];
        return S(e, function(e) {
            t = _.random(i++), n[i - 1] = n[t], n[t] = e;
        }), n;
    }, _.sample = function(e, t, i) {
        return arguments.length < 2 || i ? e[_.random(e.length - 1)] : _.shuffle(e).slice(0, Math.max(0, t));
    };
    var E = function(e) {
        return _.isFunction(e) ? e : function(t) {
            return t[e];
        };
    };
    _.sortBy = function(e, t, i) {
        var n = E(t);
        return _.pluck(_.map(e, function(e, t, r) {
            return {
                value: e,
                index: t,
                criteria: n.call(i, e, t, r)
            };
        }).sort(function(e, t) {
            var i = e.criteria, n = t.criteria;
            if (i !== n) {
                if (i > n || i === void 0) return 1;
                if (n > i || n === void 0) return -1;
            }
            return e.index - t.index;
        }), "value");
    };
    var T = function(e) {
        return function(t, i, n) {
            var r = {}, a = null == i ? _.identity : E(i);
            return S(t, function(i, o) {
                var s = a.call(n, i, o, t);
                e(r, s, i);
            }), r;
        };
    };
    _.groupBy = T(function(e, t, i) {
        (_.has(e, t) ? e[t] : e[t] = []).push(i);
    }), _.indexBy = T(function(e, t, i) {
        e[t] = i;
    }), _.countBy = T(function(e, t) {
        _.has(e, t) ? e[t]++ : e[t] = 1;
    }), _.sortedIndex = function(e, t, i, n) {
        i = null == i ? _.identity : E(i);
        for (var r = i.call(n, t), a = 0, o = e.length; o > a; ) {
            var s = a + o >>> 1;
            i.call(n, e[s]) < r ? a = s + 1 : o = s;
        }
        return a;
    }, _.toArray = function(e) {
        return e ? _.isArray(e) ? s.call(e) : e.length === +e.length ? _.map(e, _.identity) : _.values(e) : [];
    }, _.size = function(e) {
        return null == e ? 0 : e.length === +e.length ? e.length : _.keys(e).length;
    }, _.first = _.head = _.take = function(e, t, i) {
        return null == e ? void 0 : null == t || i ? e[0] : s.call(e, 0, t);
    }, _.initial = function(e, t, i) {
        return s.call(e, 0, e.length - (null == t || i ? 1 : t));
    }, _.last = function(e, t, i) {
        return null == e ? void 0 : null == t || i ? e[e.length - 1] : s.call(e, Math.max(e.length - t, 0));
    }, _.rest = _.tail = _.drop = function(e, t, i) {
        return s.call(e, null == t || i ? 1 : t);
    }, _.compact = function(e) {
        return _.filter(e, _.identity);
    };
    var P = function(e, t, i) {
        return t && _.every(e, _.isArray) ? l.apply(i, e) : (S(e, function(e) {
            _.isArray(e) || _.isArguments(e) ? t ? o.apply(i, e) : P(e, t, i) : i.push(e);
        }), i);
    };
    _.flatten = function(e, t) {
        return P(e, t, []);
    }, _.without = function(e) {
        return _.difference(e, s.call(arguments, 1));
    }, _.uniq = _.unique = function(e, t, i, n) {
        _.isFunction(t) && (n = i, i = t, t = !1);
        var r = i ? _.map(e, i, n) : e, a = [], o = [];
        return S(r, function(i, n) {
            (t ? n && o[o.length - 1] === i : _.contains(o, i)) || (o.push(i), a.push(e[n]));
        }), a;
    }, _.union = function() {
        return _.uniq(_.flatten(arguments, !0));
    }, _.intersection = function(e) {
        var t = s.call(arguments, 1);
        return _.filter(_.uniq(e), function(e) {
            return _.every(t, function(t) {
                return _.indexOf(t, e) >= 0;
            });
        });
    }, _.difference = function(e) {
        var t = l.apply(n, s.call(arguments, 1));
        return _.filter(e, function(e) {
            return !_.contains(t, e);
        });
    }, _.zip = function() {
        for (var e = _.max(_.pluck(arguments, "length").concat(0)), t = new Array(e), i = 0; e > i; i++) t[i] = _.pluck(arguments, "" + i);
        return t;
    }, _.object = function(e, t) {
        if (null == e) return {};
        for (var i = {}, n = 0, r = e.length; r > n; n++) t ? i[e[n]] = t[n] : i[e[n][0]] = e[n][1];
        return i;
    }, _.indexOf = function(e, t, i) {
        if (null == e) return -1;
        var n = 0, r = e.length;
        if (i) {
            if ("number" != typeof i) return n = _.sortedIndex(e, t), e[n] === t ? n : -1;
            n = 0 > i ? Math.max(0, r + i) : i;
        }
        if (y && e.indexOf === y) return e.indexOf(t, i);
        for (;r > n; n++) if (e[n] === t) return n;
        return -1;
    }, _.lastIndexOf = function(e, t, i) {
        if (null == e) return -1;
        var n = null != i;
        if (b && e.lastIndexOf === b) return n ? e.lastIndexOf(t, i) : e.lastIndexOf(t);
        for (var r = n ? i : e.length; r--; ) if (e[r] === t) return r;
        return -1;
    }, _.range = function(e, t, i) {
        arguments.length <= 1 && (t = e || 0, e = 0), i = arguments[2] || 1;
        for (var n = Math.max(Math.ceil((t - e) / i), 0), r = 0, a = new Array(n); n > r; ) a[r++] = e, 
        e += i;
        return a;
    };
    var I = function() {};
    _.bind = function(e, t) {
        var i, n;
        if (x && e.bind === x) return x.apply(e, s.call(arguments, 1));
        if (!_.isFunction(e)) throw new TypeError();
        return i = s.call(arguments, 2), n = function() {
            if (!(this instanceof n)) return e.apply(t, i.concat(s.call(arguments)));
            I.prototype = e.prototype;
            var r = new I();
            I.prototype = null;
            var a = e.apply(r, i.concat(s.call(arguments)));
            return Object(a) === a ? a : r;
        };
    }, _.partial = function(e) {
        var t = s.call(arguments, 1);
        return function() {
            return e.apply(this, t.concat(s.call(arguments)));
        };
    }, _.bindAll = function(e) {
        var t = s.call(arguments, 1);
        if (0 === t.length) throw new Error("bindAll must be passed function names");
        return S(t, function(t) {
            e[t] = _.bind(e[t], e);
        }), e;
    }, _.memoize = function(e, t) {
        var i = {};
        return t || (t = _.identity), function() {
            var n = t.apply(this, arguments);
            return _.has(i, n) ? i[n] : i[n] = e.apply(this, arguments);
        };
    }, _.delay = function(e, t) {
        var i = s.call(arguments, 2);
        return setTimeout(function() {
            return e.apply(null, i);
        }, t);
    }, _.defer = function(e) {
        return _.delay.apply(_, [ e, 1 ].concat(s.call(arguments, 1)));
    }, _.throttle = function(e, t, i) {
        var n, r, a, o = null, s = 0;
        i || (i = {});
        var l = function() {
            s = i.leading === !1 ? 0 : new Date(), o = null, a = e.apply(n, r);
        };
        return function() {
            var c = new Date();
            s || i.leading !== !1 || (s = c);
            var u = t - (c - s);
            return n = this, r = arguments, 0 >= u ? (clearTimeout(o), o = null, s = c, a = e.apply(n, r)) : o || i.trailing === !1 || (o = setTimeout(l, u)), 
            a;
        };
    }, _.debounce = function(e, t, i) {
        var n, r, a, o, s;
        return function() {
            a = this, r = arguments, o = new Date();
            var l = function() {
                var c = new Date() - o;
                t > c ? n = setTimeout(l, t - c) : (n = null, i || (s = e.apply(a, r)));
            }, c = i && !n;
            return n || (n = setTimeout(l, t)), c && (s = e.apply(a, r)), s;
        };
    }, _.once = function(e) {
        var t, i = !1;
        return function() {
            return i ? t : (i = !0, t = e.apply(this, arguments), e = null, t);
        };
    }, _.wrap = function(e, t) {
        return function() {
            var i = [ e ];
            return o.apply(i, arguments), t.apply(this, i);
        };
    }, _.compose = function() {
        var e = arguments;
        return function() {
            for (var t = arguments, i = e.length - 1; i >= 0; i--) t = [ e[i].apply(this, t) ];
            return t[0];
        };
    }, _.after = function(e, t) {
        return function() {
            return --e < 1 ? t.apply(this, arguments) : void 0;
        };
    }, _.keys = C || function(e) {
        if (e !== Object(e)) throw new TypeError("Invalid object");
        var t = [];
        for (var i in e) _.has(e, i) && t.push(i);
        return t;
    }, _.values = function(e) {
        for (var t = _.keys(e), i = t.length, n = new Array(i), r = 0; i > r; r++) n[r] = e[t[r]];
        return n;
    }, _.pairs = function(e) {
        for (var t = _.keys(e), i = t.length, n = new Array(i), r = 0; i > r; r++) n[r] = [ t[r], e[t[r]] ];
        return n;
    }, _.invert = function(e) {
        for (var t = {}, i = _.keys(e), n = 0, r = i.length; r > n; n++) t[e[i[n]]] = i[n];
        return t;
    }, _.functions = _.methods = function(e) {
        var t = [];
        for (var i in e) _.isFunction(e[i]) && t.push(i);
        return t.sort();
    }, _.extend = function(e) {
        return S(s.call(arguments, 1), function(t) {
            if (t) for (var i in t) e[i] = t[i];
        }), e;
    }, _.pick = function(e) {
        var t = {}, i = l.apply(n, s.call(arguments, 1));
        return S(i, function(i) {
            i in e && (t[i] = e[i]);
        }), t;
    }, _.omit = function(e) {
        var t = {}, i = l.apply(n, s.call(arguments, 1));
        for (var r in e) _.contains(i, r) || (t[r] = e[r]);
        return t;
    }, _.defaults = function(e) {
        return S(s.call(arguments, 1), function(t) {
            if (t) for (var i in t) e[i] === void 0 && (e[i] = t[i]);
        }), e;
    }, _.clone = function(e) {
        return _.isObject(e) ? _.isArray(e) ? e.slice() : _.extend({}, e) : e;
    }, _.tap = function(e, t) {
        return t(e), e;
    };
    var O = function(e, t, i, n) {
        if (e === t) return 0 !== e || 1 / e == 1 / t;
        if (null == e || null == t) return e === t;
        e instanceof _ && (e = e._wrapped), t instanceof _ && (t = t._wrapped);
        var r = c.call(e);
        if (r != c.call(t)) return !1;
        switch (r) {
          case "[object String]":
            return e == String(t);

          case "[object Number]":
            return e != +e ? t != +t : 0 == e ? 1 / e == 1 / t : e == +t;

          case "[object Date]":
          case "[object Boolean]":
            return +e == +t;

          case "[object RegExp]":
            return e.source == t.source && e.global == t.global && e.multiline == t.multiline && e.ignoreCase == t.ignoreCase;
        }
        if ("object" != typeof e || "object" != typeof t) return !1;
        for (var a = i.length; a--; ) if (i[a] == e) return n[a] == t;
        var o = e.constructor, s = t.constructor;
        if (o !== s && !(_.isFunction(o) && o instanceof o && _.isFunction(s) && s instanceof s)) return !1;
        i.push(e), n.push(t);
        var l = 0, u = !0;
        if ("[object Array]" == r) {
            if (l = e.length, u = l == t.length) for (;l-- && (u = O(e[l], t[l], i, n)); ) ;
        } else {
            for (var f in e) if (_.has(e, f) && (l++, !(u = _.has(t, f) && O(e[f], t[f], i, n)))) break;
            if (u) {
                for (f in t) if (_.has(t, f) && !l--) break;
                u = !l;
            }
        }
        return i.pop(), n.pop(), u;
    };
    _.isEqual = function(e, t) {
        return O(e, t, [], []);
    }, _.isEmpty = function(e) {
        if (null == e) return !0;
        if (_.isArray(e) || _.isString(e)) return 0 === e.length;
        for (var t in e) if (_.has(e, t)) return !1;
        return !0;
    }, _.isElement = function(e) {
        return !(!e || 1 !== e.nodeType);
    }, _.isArray = w || function(e) {
        return "[object Array]" == c.call(e);
    }, _.isObject = function(e) {
        return e === Object(e);
    }, S([ "Arguments", "Function", "String", "Number", "Date", "RegExp" ], function(e) {
        _["is" + e] = function(t) {
            return c.call(t) == "[object " + e + "]";
        };
    }), _.isArguments(arguments) || (_.isArguments = function(e) {
        return !(!e || !_.has(e, "callee"));
    }), "function" != typeof /./ && (_.isFunction = function(e) {
        return "function" == typeof e;
    }), _.isFinite = function(e) {
        return isFinite(e) && !isNaN(parseFloat(e));
    }, _.isNaN = function(e) {
        return _.isNumber(e) && e != +e;
    }, _.isBoolean = function(e) {
        return e === !0 || e === !1 || "[object Boolean]" == c.call(e);
    }, _.isNull = function(e) {
        return null === e;
    }, _.isUndefined = function(e) {
        return e === void 0;
    }, _.has = function(e, t) {
        return u.call(e, t);
    }, _.noConflict = function() {
        return e._ = t, this;
    }, _.identity = function(e) {
        return e;
    }, _.times = function(e, t, i) {
        for (var n = Array(Math.max(0, e)), r = 0; e > r; r++) n[r] = t.call(i, r);
        return n;
    }, _.random = function(e, t) {
        return null == t && (t = e, e = 0), e + Math.floor(Math.random() * (t - e + 1));
    };
    var D = {
        escape: {
            "&": "&amp;",
            "<": "&lt;",
            ">": "&gt;",
            '"': "&quot;",
            "'": "&#x27;"
        }
    };
    D.unescape = _.invert(D.escape);
    var R = {
        escape: new RegExp("[" + _.keys(D.escape).join("") + "]", "g"),
        unescape: new RegExp("(" + _.keys(D.unescape).join("|") + ")", "g")
    };
    _.each([ "escape", "unescape" ], function(e) {
        _[e] = function(t) {
            return null == t ? "" : ("" + t).replace(R[e], function(t) {
                return D[e][t];
            });
        };
    }), _.result = function(e, t) {
        if (null == e) return void 0;
        var i = e[t];
        return _.isFunction(i) ? i.call(e) : i;
    }, _.mixin = function(e) {
        S(_.functions(e), function(t) {
            var i = _[t] = e[t];
            _.prototype[t] = function() {
                var e = [ this._wrapped ];
                return o.apply(e, arguments), B.call(this, i.apply(_, e));
            };
        });
    };
    var L = 0;
    _.uniqueId = function(e) {
        var t = ++L + "";
        return e ? e + t : t;
    }, _.templateSettings = {
        evaluate: /<%([\s\S]+?)%>/g,
        interpolate: /<%=([\s\S]+?)%>/g,
        escape: /<%-([\s\S]+?)%>/g
    };
    var F = /(.)^/, M = {
        "'": "'",
        "\\": "\\",
        "\r": "r",
        "\n": "n",
        "	": "t",
        "\u2028": "u2028",
        "\u2029": "u2029"
    }, N = /\\|'|\r|\n|\t|\u2028|\u2029/g;
    _.template = function(e, t, i) {
        var n;
        i = _.defaults({}, i, _.templateSettings);
        var r = new RegExp([ (i.escape || F).source, (i.interpolate || F).source, (i.evaluate || F).source ].join("|") + "|$", "g"), a = 0, o = "__p+='";
        e.replace(r, function(t, i, n, r, s) {
            return o += e.slice(a, s).replace(N, function(e) {
                return "\\" + M[e];
            }), i && (o += "'+\n((__t=(" + i + "))==null?'':_.escape(__t))+\n'"), n && (o += "'+\n((__t=(" + n + "))==null?'':__t)+\n'"), 
            r && (o += "';\n" + r + "\n__p+='"), a = s + t.length, t;
        }), o += "';\n", i.variable || (o = "with(obj||{}){\n" + o + "}\n"), o = "var __t,__p='',__j=Array.prototype.join," + "print=function(){__p+=__j.call(arguments,'');};\n" + o + "return __p;\n";
        try {
            n = new Function(i.variable || "obj", "_", o);
        } catch (s) {
            throw s.source = o, s;
        }
        if (t) return n(t, _);
        var l = function(e) {
            return n.call(this, e, _);
        };
        return l.source = "function(" + (i.variable || "obj") + "){\n" + o + "}", l;
    }, _.chain = function(e) {
        return _(e).chain();
    };
    var B = function(e) {
        return this._chain ? _(e).chain() : e;
    };
    _.mixin(_), S([ "pop", "push", "reverse", "shift", "sort", "splice", "unshift" ], function(e) {
        var t = n[e];
        _.prototype[e] = function() {
            var i = this._wrapped;
            return t.apply(i, arguments), "shift" != e && "splice" != e || 0 !== i.length || delete i[0], 
            B.call(this, i);
        };
    }), S([ "concat", "join", "slice" ], function(e) {
        var t = n[e];
        _.prototype[e] = function() {
            return B.call(this, t.apply(this._wrapped, arguments));
        };
    }), _.extend(_.prototype, {
        chain: function() {
            return this._chain = !0, this;
        },
        value: function() {
            return this._wrapped;
        }
    });
}).call(this);

define("underscore", function(e) {
    return function() {
        var t, i;
        return t || e._;
    };
}(this));

(function(e, t) {
    var i = e.document, n;
    n = function() {};
    n.prototype.execute = function(e) {
        var t = new n();
        if (typeof e === "function") {
            this.executeCaller = e.bind(t);
        }
        return t;
    };
    n.prototype.always = function(e) {
        if (typeof e === "function") {
            this.alwaysCaller = e;
        }
    };
    n.prototype.fail = function(e) {
        if (typeof e === "function") {
            this.failCaller = e;
        }
    };
    n.prototype.makeSync = function(e) {
        var e;
        var t = new n();
        return {
            execute: function(i) {
                i.call(t, e);
                return t;
            }
        };
    };
    if (typeof define === "function") {
        define("Deferred", [], function() {
            return n;
        });
    } else {
        if (typeof e.Deferred === "undefined") {
            e.Deferred = n;
        }
    }
})(this);

(function(e) {
    if (typeof define === "function" && define.amd) {
        define("jqueryCookie", [ "jquery" ], e);
    } else {
        e(jQuery);
    }
})(function(e) {
    var t = /\+/g;
    function i(e) {
        if (r.raw) {
            return e;
        }
        return decodeURIComponent(e.replace(t, " "));
    }
    function n(e) {
        if (e.indexOf('"') === 0) {
            e = e.slice(1, -1).replace(/\\"/g, '"').replace(/\\\\/g, "\\");
        }
        e = i(e);
        try {
            return r.json ? JSON.parse(e) : e;
        } catch (t) {}
    }
    var r = e.cookie = function(t, a, o) {
        if (a !== undefined) {
            o = e.extend({}, r.defaults, o);
            if (typeof o.expires === "number") {
                var s = o.expires, l = o.expires = new Date();
                l.setDate(l.getDate() + s);
            }
            a = r.json ? JSON.stringify(a) : String(a);
            return document.cookie = [ r.raw ? t : encodeURIComponent(t), "=", r.raw ? a : encodeURIComponent(a), o.expires ? "; expires=" + o.expires.toUTCString() : "", o.path ? "; path=" + o.path : "", o.domain ? "; domain=" + o.domain : "", o.secure ? "; secure" : "" ].join("");
        }
        var c = document.cookie.split("; ");
        var u = t ? undefined : {};
        for (var f = 0, d = c.length; f < d; f++) {
            var h = c[f].split("=");
            var p = i(h.shift());
            var g = h.join("=");
            if (t && t === p) {
                u = n(g);
                break;
            }
            if (!t) {
                u[p] = n(g);
            }
        }
        return u;
    };
    r.defaults = {};
    e.removeCookie = function(t, i) {
        if (e.cookie(t) !== undefined) {
            e.cookie(t, "", e.extend({}, i, {
                expires: -1
            }));
            return true;
        }
        return false;
    };
});

(function(e) {
    var t = function(e, t, i) {
        if (i !== "image/jpeg") return;
        var n = t.units;
        var r = t.x;
        var a = t.y || t.x;
        if (n && r && a) {
            var o = e.length;
            var s;
            for (var l = 0; l < o; l++) {
                if (e[l] === 255 && e[l + 1] === 224) {
                    s = l;
                    break;
                }
            }
            if (s) {
                e[s + 11] = n;
                e[s + 12] = r >> 8 & 255;
                e[s + 13] = r & 255;
                e[s + 14] = a >> 8 & 255;
                e[s + 15] = a & 255;
            }
        }
    };
    var i = function() {
        var i = e.Uint8Array, n = e.HTMLCanvasElement, r = /\s*;\s*base64\s*(?:;|$)/i, a, o = function(e) {
            var t = e.length, n = new i(t / 4 * 3 | 0), r = 0, o = 0, s = [ 0, 0 ], l = 0, c = 0, u, f, d;
            while (t--) {
                f = e.charCodeAt(r++);
                u = a[f - 43];
                if (u !== 255 && u !== d) {
                    s[1] = s[0];
                    s[0] = f;
                    c = c << 6 | u;
                    l++;
                    if (l === 4) {
                        n[o++] = c >>> 16;
                        if (s[1] !== 61) {
                            n[o++] = c >>> 8;
                        }
                        if (s[0] !== 61) {
                            n[o++] = c;
                        }
                        l = 0;
                    }
                }
            }
            return n;
        };
        if (i) {
            a = new i([ 62, -1, -1, -1, 63, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, -1, -1, -1, 0, -1, -1, -1, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, -1, -1, -1, -1, -1, -1, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51 ]);
        }
        if (n && !n.prototype.toBlob) {
            n.prototype.toBlob = function(e, n, a, s) {
                if (!n) {
                    n = "image/png";
                }
                if (this.mozGetAsFile) {
                    e(this.mozGetAsFile("canvas", n));
                    return;
                }
                var l = Array.prototype.slice.call(arguments, 1), c = this.toDataURL.apply(this, l), u = c.indexOf(","), f = c.substring(u + 1), d = r.test(c.substring(0, u)), h;
                if (Blob.fake) {
                    h = new Blob();
                    if (d) {
                        h.encoding = "base64";
                    } else {
                        h.encoding = "URI";
                    }
                    h.data = f;
                    h.size = f.length;
                } else if (i) {
                    if (d) {
                        var p = o(f);
                        if (s) {
                            t(p, s, n);
                        }
                        h = new Blob([ p ], {
                            type: n
                        });
                    } else {
                        var p = decodeURIComponent(f);
                        if (s) {
                            t(p, s, n);
                        }
                        h = new Blob([ p ], {
                            type: n
                        });
                    }
                }
                e(h);
            };
        }
        return "Canvas2Blob";
    };
    if (typeof define === "function") {
        define("Canvas2Blob", [], function() {
            return i();
        });
    } else {
        if (typeof e.Canvas2Blob === "undefined") {
            e.Canvas2Blob = i();
        }
    }
})(this);

(function(e, t) {
    var i = function(i, n) {
        e.noop = function() {};
        window.saveAs = n || navigator.msSaveOrOpenBlob && navigator.msSaveOrOpenBlob.bind(navigator) || function(e) {
            if (/MSIE [1-9]\./.test(navigator.userAgent)) {
                return;
            }
            var t = e.document, i = function() {
                return e.URL || e.webkitURL || e;
            }, n = e.URL || e.webkitURL || e, r = t.createElementNS("http://www.w3.org/1999/xhtml", "a"), a = !e.externalHost && "download" in r, o = function(i) {
                var n = t.createEvent("MouseEvents");
                n.initMouseEvent("click", true, false, e, 0, 0, 0, 0, 0, false, false, false, false, 0, null);
                i.dispatchEvent(n);
            }, s = e.webkitRequestFileSystem, l = e.requestFileSystem || s || e.mozRequestFileSystem, c = function(t) {
                (e.setImmediate || e.setTimeout)(function() {
                    throw t;
                }, 0);
            }, u = "application/octet-stream", f = 0, d = [], h = function() {
                var e = d.length;
                while (e--) {
                    var t = d[e];
                    if (typeof t === "string") {
                        n.revokeObjectURL(t);
                    } else {
                        t.remove();
                    }
                }
                d.length = 0;
            }, p = function(e, t, i) {
                t = [].concat(t);
                var n = t.length;
                while (n--) {
                    var r = e["on" + t[n]];
                    if (typeof r === "function") {
                        try {
                            r.call(e, i || e);
                        } catch (a) {
                            c(a);
                        }
                    }
                }
            }, g = function(n, o) {
                var c = this, h = n.type, g = false, m, v, y = function() {
                    var e = i().createObjectURL(n);
                    d.push(e);
                    return e;
                }, b = function() {
                    p(c, "writestart progress write writeend".split(" "));
                }, w = function() {
                    if (g || !m) {
                        m = y(n);
                    }
                    if (v) {
                        v.location.href = m;
                    } else {
                        window.open(m, "_blank");
                    }
                    c.readyState = c.DONE;
                    b();
                }, C = function(e) {
                    return function() {
                        if (c.readyState !== c.DONE) {
                            return e.apply(this, arguments);
                        }
                    };
                }, x = {
                    create: true,
                    exclusive: false
                }, _;
                c.readyState = c.INIT;
                if (!o) {
                    o = "download";
                }
                if (a) {
                    m = y(n);
                    t = e.document;
                    r = t.createElementNS("http://www.w3.org/1999/xhtml", "a");
                    r.href = m;
                    r.download = o;
                    var S = t.createEvent("MouseEvents");
                    S.initMouseEvent("click", true, false, e, 0, 0, 0, 0, 0, false, false, false, false, 0, null);
                    r.dispatchEvent(S);
                    c.readyState = c.DONE;
                    b();
                    return;
                }
                if (e.chrome && h && h !== u) {
                    _ = n.slice || n.webkitSlice;
                    n = _.call(n, 0, n.size, u);
                    g = true;
                }
                if (s && o !== "download") {
                    o += ".download";
                }
                if (h === u || s) {
                    v = e;
                }
                if (!l) {
                    w();
                    return;
                }
                f += n.size;
                l(e.TEMPORARY, f, C(function(e) {
                    e.root.getDirectory("saved", x, C(function(e) {
                        var t = function() {
                            e.getFile(o, x, C(function(e) {
                                e.createWriter(C(function(t) {
                                    t.onwriteend = function(t) {
                                        v.location.href = e.toURL();
                                        d.push(e);
                                        c.readyState = c.DONE;
                                        p(c, "writeend", t);
                                    };
                                    t.onerror = function() {
                                        var e = t.error;
                                        if (e.code !== e.ABORT_ERR) {
                                            w();
                                        }
                                    };
                                    "writestart progress write abort".split(" ").forEach(function(e) {
                                        t["on" + e] = c["on" + e];
                                    });
                                    t.write(n);
                                    c.abort = function() {
                                        t.abort();
                                        c.readyState = c.DONE;
                                    };
                                    c.readyState = c.WRITING;
                                }), w);
                            }), w);
                        };
                        e.getFile(o, {
                            create: false
                        }, C(function(e) {
                            e.remove();
                            t();
                        }), C(function(e) {
                            if (e.code === e.NOT_FOUND_ERR) {
                                t();
                            } else {
                                w();
                            }
                        }));
                    }), w);
                }), w);
            }, m = g.prototype, v = function(e, t) {
                return new g(e, t);
            };
            m.abort = function() {
                var e = this;
                e.readyState = e.DONE;
                p(e, "abort");
            };
            m.readyState = m.INIT = 0;
            m.WRITING = 1;
            m.DONE = 2;
            m.error = m.onwritestart = m.onprogress = m.onwrite = m.onabort = m.onerror = m.onwriteend = null;
            return v;
        }(typeof self !== "undefined" && self || typeof window !== "undefined" && window || this.content);
        CanvasRenderingContext2D.prototype.downloadAs = CanvasRenderingContext2D.prototype.downloadAs || function(e, t, i, n, r, a) {
            var o = function(e) {
                if (e === "image/jpeg") {
                    return "jpg";
                } else if (e === "image/png") {
                    return "png";
                } else if (e === "image/bmp") {
                    return "bmp";
                } else if (e === "image/x-canon-cr2") {
                    return "cr2";
                } else if (e === "image/x-samsung-srw") {
                    return "srw";
                } else if (e === "image/x-fuji-raf") {
                    return "raf";
                } else if (e === "image/x-pentax-pef") {
                    return "pef";
                } else if (e === "image/x-sigma-x3f") {
                    return "x3f";
                } else if (e === "image/x-canon-crw") {
                    return "crw";
                } else if (e === "image/x-nikon-nef") {
                    return "nef";
                } else if (e === "image/x-olympus-orf") {
                    return "orf";
                } else if (e === "image/x-sony-arw") {
                    return "arw";
                } else if (e === "image/x-adobe-dng") {
                    return "dng";
                } else {
                    return "";
                }
            };
            var s = Math.PI / 180;
            var l = {
                TL: function() {
                    console.log(this);
                },
                TR: function() {
                    var e = document.createElement("canvas"), t = e.getContext("2d");
                    e.width = this.canvas.height;
                    e.height = this.canvas.width;
                    t.translate(e.width / 2, e.height / 2);
                    t.rotate(90 * s);
                    t.drawImage(this.canvas, -e.height / 2, -e.width / 2);
                    this.canvas.width = e.width;
                    this.canvas.height = e.height;
                    this.drawImage(e, 0, 0);
                },
                BL: function() {
                    var e = document.createElement("canvas"), t = e.getContext("2d");
                    e.width = this.canvas.height;
                    e.height = this.canvas.width;
                    t.translate(e.width / 2, e.height / 2);
                    t.rotate(-90 * s);
                    t.drawImage(this.canvas, -e.height / 2, -e.width / 2);
                    this.canvas.width = e.width;
                    this.canvas.height = e.height;
                    this.drawImage(e, 0, 0);
                },
                BR: function() {
                    var e = document.createElement("canvas"), t = e.getContext("2d");
                    e.width = this.canvas.width;
                    e.height = this.canvas.height;
                    t.translate(e.width / 2, e.height / 2);
                    t.rotate(180 * s);
                    t.drawImage(this.canvas, -e.width / 2, -e.height / 2);
                    this.canvas.width = e.width;
                    this.canvas.height = e.height;
                    this.drawImage(e, 0, 0);
                }
            };
            n && l[n].call(this);
            var c = this.canvas.toBlob(function(i) {
                var n = e;
                var a = o(t);
                if (n.endsWith(".jpeg")) {
                    n = n.replace(".jpeg", ".jpg");
                }
                if (!n.endsWith(a)) {
                    var s = n.lastIndexOf(".");
                    if (s != -1) {
                        n = n.substring(0, s) + "." + a;
                    } else {
                        n += "." + a;
                    }
                }
                r && r(i, n);
            }, t, i, a);
        };
        CanvasRenderingContext2D.prototype.drawImageWithOrientation = function(e, t, i, n, r, a, o, s, l, c) {
            var u = this, c = c || 1;
            switch (c) {
              case 1:
                u.drawImage(e, t, i, n, r, 0, 0, s, l);
                break;

              case 2:
                u.save();
                u.translate(n, 0);
                u.scale(-1, 1);
                u.drawImage(e, t, i, n, r, -a, -o, s, l);
                u.restore();
                break;

              case 3:
                u.save();
                u.translate(n, 0);
                u.scale(-1, 1);
                u.drawImage(e, t, i, n, r, -a, -o, s, l);
                u.translate(0, e.height);
                u.scale(1, -1);
                u.drawImage(e, t, i, n, r, -a, -o, s, l);
                u.restore();
                break;

              case 4:
                u.save();
                u.translate(a, o);
                u.rotate(Math.PI / 2 * 3);
                u.drawImage(e, t, i, n, r, -a, -o, s, l);
                u.translate(0, e.height);
                u.scale(1, -1);
                u.drawImage(e, t, i, n, r, -a, -o, s, l);
                u.restore();
                break;

              case 5:
                u.save();
                u.translate(a, o);
                u.rotate(Math.PI / 2 * 3);
                u.drawImage(e, t, i, n, r, -a, -o, s, l);
                u.translate(0, e.height);
                u.scale(1, -1);
                u.drawImage(e, t, i, n, r, -a, -o, s, l);
                u.restore();
                break;

              case 6:
                u.save();
                u.translate(o, a);
                u.rotate(Math.PI / 2);
                u.drawImage(e, t, i, n, r, -a, -o, s, l);
                u.restore();
                break;

              case 7:
                u.save();
                u.translate(s, 0);
                u.scale(-1, 1);
                u.translate(a, o);
                u.rotate(Math.PI / 2 * 3);
                u.drawImage(e, t, i, n, r, -a, -o, s, l);
                u.restore();
                break;

              case 8:
                u.save();
                u.translate(o, a);
                u.rotate(Math.PI / 2 * 3);
                u.drawImage(e, t, i, n, r, -a, -o, s, l);
                u.restore();
                break;

              default:
                break;
            }
        };
        CanvasRenderingContext2D.prototype.resampleHermite = function(e, t, i, n, r) {
            var a = Date.now();
            n = Math.round(n);
            r = Math.round(r);
            var o = e.getContext("2d").getImageData(0, 0, t, i);
            var s = e.getContext("2d").getImageData(0, 0, n, r);
            var l = o.data;
            var c = s.data;
            var u = t / n;
            var f = i / r;
            var d = Math.ceil(u / 2);
            var h = Math.ceil(f / 2);
            for (var p = 0; p < r; p++) {
                for (var g = 0; g < n; g++) {
                    var m = (g + p * n) * 4;
                    var v = 0;
                    var y = 0;
                    var b = 0;
                    var w = 0;
                    var C = 0;
                    var x = 0;
                    var _ = 0;
                    var S = (p + .5) * f;
                    for (var k = Math.floor(p * f); k < (p + 1) * f; k++) {
                        var A = Math.abs(S - (k + .5)) / h;
                        var E = (g + .5) * u;
                        var T = A * A;
                        for (var P = Math.floor(g * u); P < (g + 1) * u; P++) {
                            var I = Math.abs(E - (P + .5)) / d;
                            var O = Math.sqrt(T + I * I);
                            if (O >= -1 && O <= 1) {
                                v = 2 * O * O * O - 3 * O * O + 1;
                                if (v > 0) {
                                    I = 4 * (P + k * t);
                                    _ += v * l[I + 3];
                                    b += v;
                                    if (l[I + 3] < 255) v = v * l[I + 3] / 250;
                                    w += v * l[I];
                                    C += v * l[I + 1];
                                    x += v * l[I + 2];
                                    y += v;
                                }
                            }
                        }
                    }
                    c[m] = w / y;
                    c[m + 1] = C / y;
                    c[m + 2] = x / y;
                    c[m + 3] = _ / b;
                }
            }
            console.log("hermite = " + Math.round(Date.now() - a) / 1e3 + " s");
            e.getContext("2d").clearRect(0, 0, Math.max(t, n), Math.max(i, r));
            e.width = n;
            e.height = r;
            e.getContext("2d").putImageData(s, 0, 0);
        };
        CanvasRenderingContext2D.prototype.clear = CanvasRenderingContext2D.prototype.clear || function(e) {
            if (e) {
                this.save();
            }
            var t = this.transformedPoint(0, 0);
            var i = this.transformedPoint(this.canvas.width, this.canvas.height);
            this.clearRect(t.x, t.y, i.x - t.x, i.y - t.y);
            if (e) {
                this.restore();
            }
        };
        File.prototype.getMimeType = function() {
            var e = function(e) {
                var i = e.toLowerCase();
                if (i.match(/jpg/) || i.match(/jpeg/)) {
                    i = "image/jpeg";
                } else if (i.match(/png/)) {
                    i = "image/png";
                } else if (i.match(/bmp/)) {
                    i = "image/bmp";
                } else if (i.match(/cr2/)) {
                    i = "image/x-canon-cr2";
                } else if (i.match(/crw/)) {
                    i = "image/x-canon-crw";
                } else if (i.match(/nef/)) {
                    i = "image/x-nikon-nef";
                } else if (i.match(/x3f/)) {
                    i = "image/x-sigma-x3f";
                } else if (i.match(/arw/)) {
                    i = "image/x-sony-arw";
                } else if (i.match(/dng/)) {
                    i = "image/x-adobe-dng";
                } else if (i.match(/pef/)) {
                    i = "image/x-pentax-pef";
                } else if (i.match(/srw/)) {
                    i = "image/x-samsung-srw";
                } else if (i.match(/orf/)) {
                    i = "image/x-olympus-orf";
                } else if (i.match(/mp4/)) {
                    i = "video/mp4";
                } else if (i.match(/avi/) || i.match(/msvideo$/)) {
                    i = "video/x-msvideo";
                } else if (i.match(/webm/)) {
                    i = "video/webm";
                } else if (i.match(/mov/) || i.match(/quicktime$/)) {
                    i = "video/quicktime";
                } else if (i.match(/mpe?g/)) {
                    i = "video/mpeg";
                } else if (i.match(/wmv$/)) {
                    i = "video/x-ms-wmv";
                } else if (i.match(/flv$/)) {
                    i = "video/flv";
                } else if (i.match(/mts$/) || i.match(/m2ts$/)) {
                    i = "video/m2ts";
                } else if (i.match(/3gp?p$/)) {
                    i = "video/3gpp";
                } else if (i.match(/gif$/)) {
                    i = "image/gif";
                } else if (i.match(/psd$/) || i.match(/photoshop$/)) {
                    i = "image/x-photoshop";
                } else if (i.match(/raf$/)) {
                    i = "image/x-fuji-raf";
                } else if (i.match(/pdf$/)) {
                    i = "application/pdf";
                } else if (i.match(/postscript$/)) {
                    i = "application/postscript";
                } else if (i.match(/tiff$/) || i.match(/tif$/)) {
                    i = "image/tiff";
                } else if (i.match(/rw2$/)) {
                    i = "image/x-panasonic-rw2";
                } else if (i.match(/mp3$/)) {
                    i = "audio/mpeg";
                } else if (i.match(/wav$/)) {
                    i = "audio/wav";
                } else if (i.match(/svg/)) {
                    i = "image/svg+xml";
                } else if (i.match(/ttf$/)) {
                    i = "application/x-font-ttf";
                } else if (i.match(/m4p$/) || i.match(/m4v$/) || i.match(/m4a$/)) {
                    i = "video/mp4";
                } else if (i.match(/txt/)) {
                    i = "text/plain";
                } else if (i.match(/docx/)) {
                    i = "application/vnd.openxmlformats-officedocument.wordprocessingml.document";
                } else if (i.match(/xlsx/)) {
                    i = "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";
                } else {
                    i = t;
                }
                return i;
            };
            var i;
            if (this.type) {
                i = e(this.type);
            }
            if (this.mimeType) {
                i = e(this.mimeType);
            }
            if (!i) {
                var n = this.name.substring(this.name.lastIndexOf(".") + 1);
                i = e(n);
            }
            return i;
        };
        return "extensions";
    };
    if (typeof define === "function") {
        define("extensions", [ "Canvas2Blob" ], function(e) {
            return i(e);
        });
    } else {
        if (typeof e.extensions === "undefined") {
            e.extensions = i(e.Canvas2Blob);
        }
    }
})(this);

(function(e) {
    Array.prototype.map || (Array.prototype.map = function(e, t) {
        var i, n, r;
        if (null == this) throw new TypeError(" this is null or not defined");
        var a = Object(this), o = a.length >>> 0;
        if ("function" != typeof e) throw new TypeError(e + " is not a function");
        for (t && (i = t), n = Array(o), r = 0; o > r; ) {
            var s, l;
            r in a && (s = a[r], l = e.call(i, s, r, a), n[r] = l), r++;
        }
        return n;
    });
    var t = e.detect = function() {
        var e = function() {}, t = {
            browser_parsers: [ {
                regex: "^(Opera)/(\\d+)\\.(\\d+) \\(Nintendo Wii",
                family_replacement: "Wii",
                manufacturer: "Nintendo"
            }, {
                regex: "(SeaMonkey|Camino)/(\\d+)\\.(\\d+)\\.?([ab]?\\d+[a-z]*)",
                family_replacement: "Camino",
                other: !0
            }, {
                regex: "(Pale[Mm]oon)/(\\d+)\\.(\\d+)\\.?(\\d+)?",
                family_replacement: "Pale Moon (Firefox Variant)",
                other: !0
            }, {
                regex: "(Fennec)/(\\d+)\\.(\\d+)\\.?([ab]?\\d+[a-z]*)",
                family_replacement: "Firefox Mobile"
            }, {
                regex: "(Fennec)/(\\d+)\\.(\\d+)(pre)",
                family_replacment: "Firefox Mobile"
            }, {
                regex: "(Fennec)/(\\d+)\\.(\\d+)",
                family_replacement: "Firefox Mobile"
            }, {
                regex: "Mobile.*(Firefox)/(\\d+)\\.(\\d+)",
                family_replacement: "Firefox Mobile"
            }, {
                regex: "(Namoroka|Shiretoko|Minefield)/(\\d+)\\.(\\d+)\\.(\\d+(?:pre)?)",
                family_replacement: "Firefox ($1)"
            }, {
                regex: "(Firefox)/(\\d+)\\.(\\d+)(a\\d+[a-z]*)",
                family_replacement: "Firefox Alpha"
            }, {
                regex: "(Firefox)/(\\d+)\\.(\\d+)(b\\d+[a-z]*)",
                family_replacement: "Firefox Beta"
            }, {
                regex: "(Firefox)-(?:\\d+\\.\\d+)?/(\\d+)\\.(\\d+)(a\\d+[a-z]*)",
                family_replacement: "Firefox Alpha"
            }, {
                regex: "(Firefox)-(?:\\d+\\.\\d+)?/(\\d+)\\.(\\d+)(b\\d+[a-z]*)",
                family_replacement: "Firefox Beta"
            }, {
                regex: "(Namoroka|Shiretoko|Minefield)/(\\d+)\\.(\\d+)([ab]\\d+[a-z]*)?",
                family_replacement: "Firefox ($1)"
            }, {
                regex: "(Firefox).*Tablet browser (\\d+)\\.(\\d+)\\.(\\d+)",
                family_replacement: "MicroB",
                tablet: !0
            }, {
                regex: "(MozillaDeveloperPreview)/(\\d+)\\.(\\d+)([ab]\\d+[a-z]*)?"
            }, {
                regex: "(Flock)/(\\d+)\\.(\\d+)(b\\d+?)",
                family_replacement: "Flock",
                other: !0
            }, {
                regex: "(RockMelt)/(\\d+)\\.(\\d+)\\.(\\d+)",
                family_replacement: "Rockmelt",
                other: !0
            }, {
                regex: "(Navigator)/(\\d+)\\.(\\d+)\\.(\\d+)",
                family_replacement: "Netscape"
            }, {
                regex: "(Navigator)/(\\d+)\\.(\\d+)([ab]\\d+)",
                family_replacement: "Netscape"
            }, {
                regex: "(Netscape6)/(\\d+)\\.(\\d+)\\.(\\d+)",
                family_replacement: "Netscape"
            }, {
                regex: "(MyIBrow)/(\\d+)\\.(\\d+)",
                family_replacement: "My Internet Browser",
                other: !0
            }, {
                regex: "(Opera Tablet).*Version/(\\d+)\\.(\\d+)(?:\\.(\\d+))?",
                family_replacement: "Opera Tablet",
                tablet: !0
            }, {
                regex: "(Opera)/.+Opera Mobi.+Version/(\\d+)\\.(\\d+)",
                family_replacement: "Opera Mobile"
            }, {
                regex: "Opera Mobi",
                family_replacement: "Opera Mobile"
            }, {
                regex: "(Opera Mini)/(\\d+)\\.(\\d+)",
                family_replacement: "Opera Mini"
            }, {
                regex: "(Opera Mini)/att/(\\d+)\\.(\\d+)",
                family_replacement: "Opera Mini"
            }, {
                regex: "(Opera)/9.80.*Version/(\\d+)\\.(\\d+)(?:\\.(\\d+))?",
                family_replacement: "Opera"
            }, {
                regex: "(webOSBrowser)/(\\d+)\\.(\\d+)",
                family_replacement: "webOS"
            }, {
                regex: "(webOS)/(\\d+)\\.(\\d+)",
                family_replacement: "webOS"
            }, {
                regex: "(wOSBrowser).+TouchPad/(\\d+)\\.(\\d+)",
                family_replacement: "webOS TouchPad"
            }, {
                regex: "(luakit)",
                family_replacement: "LuaKit",
                other: !0
            }, {
                regex: "(Lightning)/(\\d+)\\.(\\d+)([ab]?\\d+[a-z]*)",
                family_replacement: "Lightning",
                other: !0
            }, {
                regex: "(Firefox)/(\\d+)\\.(\\d+)\\.(\\d+(?:pre)?) \\(Swiftfox\\)",
                family_replacement: "Swiftfox",
                other: !0
            }, {
                regex: "(Firefox)/(\\d+)\\.(\\d+)([ab]\\d+[a-z]*)? \\(Swiftfox\\)",
                family_replacement: "Swiftfox",
                other: !0
            }, {
                regex: "rekonq",
                family_replacement: "Rekonq",
                other: !0
            }, {
                regex: "(conkeror|Conkeror)/(\\d+)\\.(\\d+)\\.?(\\d+)?",
                family_replacement: "Conkeror",
                other: !0
            }, {
                regex: "(konqueror)/(\\d+)\\.(\\d+)\\.(\\d+)",
                family_replacement: "Konqueror",
                other: !0
            }, {
                regex: "(WeTab)-Browser",
                family_replacement: "WeTab",
                other: !0
            }, {
                regex: "(Comodo_Dragon)/(\\d+)\\.(\\d+)\\.(\\d+)",
                family_replacement: "Comodo Dragon",
                other: !0
            }, {
                regex: "(YottaaMonitor)",
                family_replacement: "Yottaa Monitor",
                other: !0
            }, {
                regex: "(Kindle)/(\\d+)\\.(\\d+)",
                family_replacement: "Kindle"
            }, {
                regex: "(Symphony) (\\d+).(\\d+)",
                family_replacement: "Symphony",
                other: !0
            }, {
                regex: "Minimo",
                family_replacement: "Minimo",
                other: !0
            }, {
                regex: "(CrMo)/(\\d+)\\.(\\d+)\\.(\\d+)\\.(\\d+)",
                family_replacement: "Chrome Mobile"
            }, {
                regex: "(CriOS)/(\\d+)\\.(\\d+)\\.(\\d+)\\.(\\d+)",
                family_replacement: "Chrome Mobile iOS"
            }, {
                regex: "(Chrome)/(\\d+)\\.(\\d+)\\.(\\d+)\\.(\\d+) Mobile",
                family_replacement: "Chrome Mobile"
            }, {
                regex: "(chromeframe)/(\\d+)\\.(\\d+)\\.(\\d+)",
                family_replacement: "Chrome Frame"
            }, {
                regex: "(UC Browser)(\\d+)\\.(\\d+)\\.(\\d+)",
                family_replacement: "UC Browser",
                other: !0
            }, {
                regex: "(SLP Browser)/(\\d+)\\.(\\d+)",
                family_replacement: "Tizen Browser",
                other: !0
            }, {
                regex: "(Epiphany)/(\\d+)\\.(\\d+).(\\d+)",
                family_replacement: "Epiphany",
                other: !0
            }, {
                regex: "(SE 2\\.X) MetaSr (\\d+)\\.(\\d+)",
                family_replacement: "Sogou Explorer",
                other: !0
            }, {
                regex: "(Pingdom.com_bot_version_)(\\d+)\\.(\\d+)",
                family_replacement: "PingdomBot",
                other: !0
            }, {
                regex: "(facebookexternalhit)/(\\d+)\\.(\\d+)",
                family_replacement: "FacebookBot"
            }, {
                regex: "(Twitterbot)/(\\d+)\\.(\\d+)",
                family_replacement: "TwitterBot"
            }, {
                regex: "(AdobeAIR|Chromium|FireWeb|Jasmine|ANTGalio|Midori|Fresco|Lobo|PaleMoon|Maxthon|Lynx|OmniWeb|Dillo|Camino|Demeter|Fluid|Fennec|Shiira|Sunrise|Chrome|Flock|Netscape|Lunascape|WebPilot|NetFront|Netfront|Konqueror|SeaMonkey|Kazehakase|Vienna|Iceape|Iceweasel|IceWeasel|Iron|K-Meleon|Sleipnir|Galeon|GranParadiso|Opera Mini|iCab|NetNewsWire|ThunderBrowse|Iron|Iris|UP\\.Browser|Bunjaloo|Google Earth|Raven for Mac)/(\\d+)\\.(\\d+)\\.(\\d+)"
            }, {
                regex: "(Bolt|Jasmine|IceCat|Skyfire|Midori|Maxthon|Lynx|Arora|IBrowse|Dillo|Camino|Shiira|Fennec|Phoenix|Chrome|Flock|Netscape|Lunascape|Epiphany|WebPilot|Opera Mini|Opera|NetFront|Netfront|Konqueror|Googlebot|SeaMonkey|Kazehakase|Vienna|Iceape|Iceweasel|IceWeasel|Iron|K-Meleon|Sleipnir|Galeon|GranParadiso|iCab|NetNewsWire|Iron|Space Bison|Stainless|Orca|Dolfin|BOLT|Minimo|Tizen Browser|Polaris)/(\\d+)\\.(\\d+)"
            }, {
                regex: "(iRider|Crazy Browser|SkipStone|iCab|Lunascape|Sleipnir|Maemo Browser) (\\d+)\\.(\\d+)\\.(\\d+)"
            }, {
                regex: "(iCab|Lunascape|Opera|Android|Jasmine|Polaris|BREW) (\\d+)\\.(\\d+)\\.?(\\d+)?"
            }, {
                regex: "(Android) Donut",
                v2_replacement: "2",
                v1_replacement: "1"
            }, {
                regex: "(Android) Eclair",
                v2_replacement: "1",
                v1_replacement: "2"
            }, {
                regex: "(Android) Froyo",
                v2_replacement: "2",
                v1_replacement: "2"
            }, {
                regex: "(Android) Gingerbread",
                v2_replacement: "3",
                v1_replacement: "2"
            }, {
                regex: "(Android) Honeycomb",
                v1_replacement: "3"
            }, {
                regex: "(IEMobile)[ /](\\d+)\\.(\\d+)",
                family_replacement: "IE Mobile"
            }, {
                regex: "(MSIE) (\\d+)\\.(\\d+).*XBLWP7",
                family_replacement: "IE Large Screen"
            }, {
                regex: "(Firefox)/(\\d+)\\.(\\d+)\\.(\\d+)"
            }, {
                regex: "(Firefox)/(\\d+)\\.(\\d+)(pre|[ab]\\d+[a-z]*)?"
            }, {
                regex: "(Obigo)InternetBrowser",
                other: !0
            }, {
                regex: "(Obigo)\\-Browser",
                other: !0
            }, {
                regex: "(Obigo|OBIGO)[^\\d]*(\\d+)(?:.(\\d+))?",
                other: !0
            }, {
                regex: "(MAXTHON|Maxthon) (\\d+)\\.(\\d+)",
                family_replacement: "Maxthon",
                other: !0
            }, {
                regex: "(Maxthon|MyIE2|Uzbl|Shiira)",
                v1_replacement: "0",
                other: !0
            }, {
                regex: "(PLAYSTATION) (\\d+)",
                family_replacement: "PlayStation",
                manufacturer: "Sony"
            }, {
                regex: "(PlayStation Portable)[^\\d]+(\\d+).(\\d+)",
                manufacturer: "Sony"
            }, {
                regex: "(BrowseX) \\((\\d+)\\.(\\d+)\\.(\\d+)",
                other: !0
            }, {
                regex: "(POLARIS)/(\\d+)\\.(\\d+)",
                family_replacement: "Polaris",
                other: !0
            }, {
                regex: "(Embider)/(\\d+)\\.(\\d+)",
                family_replacement: "Polaris",
                other: !0
            }, {
                regex: "(BonEcho)/(\\d+)\\.(\\d+)\\.(\\d+)",
                family_replacement: "Bon Echo",
                other: !0
            }, {
                regex: "(iPod).+Version/(\\d+)\\.(\\d+)\\.(\\d+)",
                family_replacement: "Mobile Safari",
                manufacturer: "Apple"
            }, {
                regex: "(iPod).*Version/(\\d+)\\.(\\d+)",
                family_replacement: "Mobile Safari",
                manufacturer: "Apple"
            }, {
                regex: "(iPod)",
                family_replacement: "Mobile Safari",
                manufacturer: "Apple"
            }, {
                regex: "(iPhone).*Version/(\\d+)\\.(\\d+)\\.(\\d+)",
                family_replacement: "Mobile Safari",
                manufacturer: "Apple"
            }, {
                regex: "(iPhone).*Version/(\\d+)\\.(\\d+)",
                family_replacement: "Mobile Safari",
                manufacturer: "Apple"
            }, {
                regex: "(iPhone)",
                family_replacement: "Mobile Safari",
                manufacturer: "Apple"
            }, {
                regex: "(iPad).*Version/(\\d+)\\.(\\d+)\\.(\\d+)",
                family_replacement: "Mobile Safari",
                tablet: !0,
                manufacturer: "Apple"
            }, {
                regex: "(iPad).*Version/(\\d+)\\.(\\d+)",
                family_replacement: "Mobile Safari",
                tablet: !0,
                manufacturer: "Apple"
            }, {
                regex: "(iPad)",
                family_replacement: "Mobile Safari",
                tablet: !0,
                manufacturer: "Apple"
            }, {
                regex: "(AvantGo) (\\d+).(\\d+)",
                other: !0
            }, {
                regex: "(Avant)",
                v1_replacement: "1",
                other: !0
            }, {
                regex: "^(Nokia)",
                family_replacement: "Nokia Services (WAP) Browser",
                manufacturer: "Nokia"
            }, {
                regex: "(NokiaBrowser)/(\\d+)\\.(\\d+).(\\d+)\\.(\\d+)",
                manufacturer: "Nokia"
            }, {
                regex: "(NokiaBrowser)/(\\d+)\\.(\\d+).(\\d+)",
                manufacturer: "Nokia"
            }, {
                regex: "(NokiaBrowser)/(\\d+)\\.(\\d+)",
                manufacturer: "Nokia"
            }, {
                regex: "(BrowserNG)/(\\d+)\\.(\\d+).(\\d+)",
                family_replacement: "NokiaBrowser",
                manufacturer: "Nokia"
            }, {
                regex: "(Series60)/5\\.0",
                v2_replacement: "0",
                v1_replacement: "7",
                family_replacement: "NokiaBrowser",
                manufacturer: "Nokia"
            }, {
                regex: "(Series60)/(\\d+)\\.(\\d+)",
                family_replacement: "Nokia OSS Browser",
                manufacturer: "Nokia"
            }, {
                regex: "(S40OviBrowser)/(\\d+)\\.(\\d+)\\.(\\d+)\\.(\\d+)",
                family_replacement: "Nokia Series 40 Ovi Browser",
                manufacturer: "Nokia"
            }, {
                regex: "(Nokia)[EN]?(\\d+)",
                manufacturer: "Nokia"
            }, {
                regex: "(PlayBook).+RIM Tablet OS (\\d+)\\.(\\d+)\\.(\\d+)",
                family_replacement: "Blackberry WebKit",
                tablet: !0,
                manufacturer: "Nokia"
            }, {
                regex: "(Black[bB]erry).+Version/(\\d+)\\.(\\d+)\\.(\\d+)",
                family_replacement: "Blackberry WebKit",
                manufacturer: "RIM"
            }, {
                regex: "(Black[bB]erry)\\s?(\\d+)",
                family_replacement: "Blackberry",
                manufacturer: "RIM"
            }, {
                regex: "(OmniWeb)/v(\\d+)\\.(\\d+)",
                other: !0
            }, {
                regex: "(Blazer)/(\\d+)\\.(\\d+)",
                family_replacement: "Palm Blazer",
                manufacturer: "Palm"
            }, {
                regex: "(Pre)/(\\d+)\\.(\\d+)",
                family_replacement: "Palm Pre",
                manufacturer: "Palm"
            }, {
                regex: "(Links) \\((\\d+)\\.(\\d+)",
                other: !0
            }, {
                regex: "(QtWeb) Internet Browser/(\\d+)\\.(\\d+)",
                other: !0
            }, {
                regex: "(Silk)/(\\d+)\\.(\\d+)(?:\\.([0-9\\-]+))?",
                other: !0,
                tablet: !0
            }, {
                regex: "(AppleWebKit)/(\\d+)\\.?(\\d+)?\\+ .* Version/\\d+\\.\\d+.\\d+ Safari/",
                family_replacement: "WebKit Nightly"
            }, {
                regex: "(Version)/(\\d+)\\.(\\d+)(?:\\.(\\d+))?.*Safari/",
                family_replacement: "Safari"
            }, {
                regex: "(Safari)/\\d+"
            }, {
                regex: "(OLPC)/Update(\\d+)\\.(\\d+)",
                other: !0
            }, {
                regex: "(OLPC)/Update()\\.(\\d+)",
                v1_replacement: "0",
                other: !0
            }, {
                regex: "(SEMC\\-Browser)/(\\d+)\\.(\\d+)",
                other: !0
            }, {
                regex: "(Teleca)",
                family_replacement: "Teleca Browser",
                other: !0
            }, {
                regex: "(MSIE) (\\d+)\\.(\\d+)",
                family_replacement: "IE"
            } ],
            os_parsers: [ {
                regex: "(Android) (\\d+)\\.(\\d+)(?:[.\\-]([a-z0-9]+))?"
            }, {
                regex: "(Android)\\-(\\d+)\\.(\\d+)(?:[.\\-]([a-z0-9]+))?"
            }, {
                regex: "(Android) Donut",
                os_v2_replacement: "2",
                os_v1_replacement: "1"
            }, {
                regex: "(Android) Eclair",
                os_v2_replacement: "1",
                os_v1_replacement: "2"
            }, {
                regex: "(Android) Froyo",
                os_v2_replacement: "2",
                os_v1_replacement: "2"
            }, {
                regex: "(Android) Gingerbread",
                os_v2_replacement: "3",
                os_v1_replacement: "2"
            }, {
                regex: "(Android) Honeycomb",
                os_v1_replacement: "3"
            }, {
                regex: "(Silk-Accelerated=[a-z]{4,5})",
                os_replacement: "Android"
            }, {
                regex: "(Windows Phone 6\\.5)"
            }, {
                regex: "(Windows (?:NT 5\\.2|NT 5\\.1))",
                os_replacement: "Windows XP"
            }, {
                regex: "(XBLWP7)",
                os_replacement: "Windows Phone OS"
            }, {
                regex: "(Windows NT 6\\.1)",
                os_replacement: "Windows 7"
            }, {
                regex: "(Windows NT 6\\.0)",
                os_replacement: "Windows Vista"
            }, {
                regex: "(Windows 98|Windows XP|Windows ME|Windows 95|Windows CE|Windows 7|Windows NT 4\\.0|Windows Vista|Windows 2000)"
            }, {
                regex: "(Windows NT 6\\.2)",
                os_replacement: "Windows 8"
            }, {
                regex: "(Windows Phone 8)",
                os_replacement: "Windows Phone 8"
            }, {
                regex: "(Windows NT 5\\.0)",
                os_replacement: "Windows 2000"
            }, {
                regex: "(Windows Phone OS) (\\d+)\\.(\\d+)"
            }, {
                regex: "(Windows ?Mobile)",
                os_replacement: "Windows Mobile"
            }, {
                regex: "(WinNT4.0)",
                os_replacement: "Windows NT 4.0"
            }, {
                regex: "(Win98)",
                os_replacement: "Windows 98"
            }, {
                regex: "(Tizen)/(\\d+)\\.(\\d+)",
                other: !0
            }, {
                regex: "(Mac OS X) (\\d+)[_.](\\d+)(?:[_.](\\d+))?",
                manufacturer: "Apple"
            }, {
                regex: "(?:PPC|Intel) (Mac OS X)",
                manufacturer: "Apple"
            }, {
                regex: "(CPU OS|iPhone OS) (\\d+)_(\\d+)(?:_(\\d+))?",
                os_replacement: "iOS",
                manufacturer: "Apple"
            }, {
                regex: "(iPhone|iPad|iPod); Opera",
                os_replacement: "iOS",
                manufacturer: "Apple"
            }, {
                regex: "(iPad); Opera",
                tablet: !0,
                manufacturer: "Apple"
            }, {
                regex: "(iPhone|iPad|iPod).*Mac OS X.*Version/(\\d+)\\.(\\d+)",
                os_replacement: "iOS",
                manufacturer: "Apple"
            }, {
                regex: "(CrOS) [a-z0-9_]+ (\\d+)\\.(\\d+)(?:\\.(\\d+))?",
                os_replacement: "Chrome OS"
            }, {
                regex: "(Debian)-(\\d+)\\.(\\d+)\\.(\\d+)(?:\\.(\\d+))?",
                other: !0
            }, {
                regex: "(Linux Mint)(?:/(\\d+))?",
                other: !0
            }, {
                regex: "(Mandriva)(?: Linux)?/(\\d+)\\.(\\d+)\\.(\\d+)(?:\\.(\\d+))?",
                other: !0
            }, {
                regex: "(Symbian[Oo][Ss])/(\\d+)\\.(\\d+)",
                os_replacement: "Symbian OS"
            }, {
                regex: "(Symbian/3).+NokiaBrowser/7\\.3",
                os_replacement: "Symbian^3 Anna"
            }, {
                regex: "(Symbian/3).+NokiaBrowser/7\\.4",
                os_replacement: "Symbian^3 Belle"
            }, {
                regex: "(Symbian/3)",
                os_replacement: "Symbian^3"
            }, {
                regex: "(Series 60|SymbOS|S60)",
                os_replacement: "Symbian OS"
            }, {
                regex: "(MeeGo)",
                other: !0
            }, {
                regex: "Symbian [Oo][Ss]",
                os_replacement: "Symbian OS"
            }, {
                regex: "(Black[Bb]erry)[0-9a-z]+/(\\d+)\\.(\\d+)\\.(\\d+)(?:\\.(\\d+))?",
                os_replacement: "BlackBerry OS",
                manufacturer: "RIM"
            }, {
                regex: "(Black[Bb]erry).+Version/(\\d+)\\.(\\d+)\\.(\\d+)(?:\\.(\\d+))?",
                os_replacement: "BlackBerry OS",
                manufacturer: "RIM"
            }, {
                regex: "(RIM Tablet OS) (\\d+)\\.(\\d+)\\.(\\d+)",
                os_replacement: "BlackBerry Tablet OS",
                tablet: !0,
                manufacturer: "RIM"
            }, {
                regex: "(Play[Bb]ook)",
                os_replacement: "BlackBerry Tablet OS",
                tablet: !0,
                manufacturer: "RIM"
            }, {
                regex: "(Black[Bb]erry)",
                os_replacement: "Blackberry OS",
                manufacturer: "RIM"
            }, {
                regex: "(webOS|hpwOS)/(\\d+)\\.(\\d+)(?:\\.(\\d+))?",
                os_replacement: "webOS"
            }, {
                regex: "(SUSE|Fedora|Red Hat|PCLinuxOS)/(\\d+)\\.(\\d+)\\.(\\d+)\\.(\\d+)",
                other: !0
            }, {
                regex: "(SUSE|Fedora|Red Hat|Puppy|PCLinuxOS|CentOS)/(\\d+)\\.(\\d+)\\.(\\d+)",
                other: !0
            }, {
                regex: "(Ubuntu|Kindle|Bada|Lubuntu|BackTrack|Red Hat|Slackware)/(\\d+)\\.(\\d+)"
            }, {
                regex: "(Windows|OpenBSD|FreeBSD|NetBSD|Ubuntu|Kubuntu|Android|Arch Linux|CentOS|WeTab|Slackware)"
            }, {
                regex: "(Linux|BSD)",
                other: !0
            } ],
            mobile_os_families: [ "Windows Phone 6.5", "Windows CE", "Symbian OS" ],
            device_parsers: [ {
                regex: "HTC ([A-Z][a-z0-9]+) Build",
                device_replacement: "HTC $1",
                manufacturer: "HTC"
            }, {
                regex: "HTC ([A-Z][a-z0-9 ]+) \\d+\\.\\d+\\.\\d+\\.\\d+",
                device_replacement: "HTC $1",
                manufacturer: "HTC"
            }, {
                regex: "HTC_Touch_([A-Za-z0-9]+)",
                device_replacement: "HTC Touch ($1)",
                manufacturer: "HTC"
            }, {
                regex: "USCCHTC(\\d+)",
                device_replacement: "HTC $1 (US Cellular)",
                manufacturer: "HTC"
            }, {
                regex: "Sprint APA(9292)",
                device_replacement: "HTC $1 (Sprint)",
                manufacturer: "HTC"
            }, {
                regex: "HTC ([A-Za-z0-9]+ [A-Z])",
                device_replacement: "HTC $1",
                manufacturer: "HTC"
            }, {
                regex: "HTC-([A-Za-z0-9]+)",
                device_replacement: "HTC $1",
                manufacturer: "HTC"
            }, {
                regex: "HTC_([A-Za-z0-9]+)",
                device_replacement: "HTC $1",
                manufacturer: "HTC"
            }, {
                regex: "HTC ([A-Za-z0-9]+)",
                device_replacement: "HTC $1",
                manufacturer: "HTC"
            }, {
                regex: "(ADR[A-Za-z0-9]+)",
                device_replacement: "HTC $1",
                manufacturer: "HTC"
            }, {
                regex: "(HTC)",
                manufacturer: "HTC"
            }, {
                regex: "SonyEricsson([A-Za-z0-9]+)/",
                device_replacement: "Ericsson $1",
                other: !0,
                manufacturer: "Sony"
            }, {
                regex: "Android[\\- ][\\d]+\\.[\\d]+\\; [A-Za-z]{2}\\-[A-Za-z]{2}\\; WOWMobile (.+) Build"
            }, {
                regex: "Android[\\- ][\\d]+\\.[\\d]+\\.[\\d]+; [A-Za-z]{2}\\-[A-Za-z]{2}\\; (.+) Build"
            }, {
                regex: "Android[\\- ][\\d]+\\.[\\d]+\\-update1\\; [A-Za-z]{2}\\-[A-Za-z]{2}\\; (.+) Build"
            }, {
                regex: "Android[\\- ][\\d]+\\.[\\d]+\\; [A-Za-z]{2}\\-[A-Za-z]{2}\\; (.+) Build"
            }, {
                regex: "Android[\\- ][\\d]+\\.[\\d]+\\.[\\d]+; (.+) Build"
            }, {
                regex: "NokiaN([0-9]+)",
                device_replacement: "Nokia N$1",
                manufacturer: "Nokia"
            }, {
                regex: "Nokia([A-Za-z0-9\\v-]+)",
                device_replacement: "Nokia $1",
                manufacturer: "Nokia"
            }, {
                regex: "NOKIA ([A-Za-z0-9\\-]+)",
                device_replacement: "Nokia $1",
                manufacturer: "Nokia"
            }, {
                regex: "Nokia ([A-Za-z0-9\\-]+)",
                device_replacement: "Nokia $1",
                manufacturer: "Nokia"
            }, {
                regex: "Lumia ([A-Za-z0-9\\-]+)",
                device_replacement: "Lumia $1",
                manufacturer: "Nokia"
            }, {
                regex: "Symbian",
                device_replacement: "Nokia",
                manufacturer: "Nokia"
            }, {
                regex: "(PlayBook).+RIM Tablet OS",
                device_replacement: "Blackberry Playbook",
                tablet: !0,
                manufacturer: "RIM"
            }, {
                regex: "(Black[Bb]erry [0-9]+);",
                manufacturer: "RIM"
            }, {
                regex: "Black[Bb]erry([0-9]+)",
                device_replacement: "BlackBerry $1",
                manufacturer: "RIM"
            }, {
                regex: "(Pre)/(\\d+)\\.(\\d+)",
                device_replacement: "Palm Pre",
                manufacturer: "Palm"
            }, {
                regex: "(Pixi)/(\\d+)\\.(\\d+)",
                device_replacement: "Palm Pixi",
                manufacturer: "Palm"
            }, {
                regex: "(Touchpad)/(\\d+)\\.(\\d+)",
                device_replacement: "HP Touchpad",
                manufacturer: "HP"
            }, {
                regex: "HPiPAQ([A-Za-z0-9]+)/(\\d+).(\\d+)",
                device_replacement: "HP iPAQ $1",
                manufacturer: "HP"
            }, {
                regex: "Palm([A-Za-z0-9]+)",
                device_replacement: "Palm $1",
                manufacturer: "Palm"
            }, {
                regex: "Treo([A-Za-z0-9]+)",
                device_replacement: "Palm Treo $1",
                manufacturer: "Palm"
            }, {
                regex: "webOS.*(P160UNA)/(\\d+).(\\d+)",
                device_replacement: "HP Veer",
                manufacturer: "HP"
            }, {
                regex: "(Kindle Fire)",
                manufacturer: "Amazon"
            }, {
                regex: "(Kindle)",
                manufacturer: "Amazon"
            }, {
                regex: "(Silk)/(\\d+)\\.(\\d+)(?:\\.([0-9\\-]+))?",
                device_replacement: "Kindle Fire",
                tablet: !0,
                manufacturer: "Amazon"
            }, {
                regex: "(iPad) Simulator;",
                manufacturer: "Apple"
            }, {
                regex: "(iPad);",
                manufacturer: "Apple"
            }, {
                regex: "(iPod);",
                manufacturer: "Apple"
            }, {
                regex: "(iPhone) Simulator;",
                manufacturer: "Apple"
            }, {
                regex: "(iPhone);",
                manufacturer: "Apple"
            }, {
                regex: "Nexus\\ ([A-Za-z0-9\\-]+)",
                device_replacement: "Nexus $1"
            }, {
                regex: "acer_([A-Za-z0-9]+)_",
                device_replacement: "Acer $1",
                manufacturer: "Acer"
            }, {
                regex: "acer_([A-Za-z0-9]+)_",
                device_replacement: "Acer $1",
                manufacturer: "Acer"
            }, {
                regex: "Amoi\\-([A-Za-z0-9]+)",
                device_replacement: "Amoi $1",
                other: !0,
                manufacturer: "Amoi"
            }, {
                regex: "AMOI\\-([A-Za-z0-9]+)",
                device_replacement: "Amoi $1",
                other: !0,
                manufacturer: "Amoi"
            }, {
                regex: "Asus\\-([A-Za-z0-9]+)",
                device_replacement: "Asus $1",
                manufacturer: "Asus"
            }, {
                regex: "ASUS\\-([A-Za-z0-9]+)",
                device_replacement: "Asus $1",
                manufacturer: "Asus"
            }, {
                regex: "BIRD\\-([A-Za-z0-9]+)",
                device_replacement: "Bird $1",
                other: !0
            }, {
                regex: "BIRD\\.([A-Za-z0-9]+)",
                device_replacement: "Bird $1",
                other: !0
            }, {
                regex: "BIRD ([A-Za-z0-9]+)",
                device_replacement: "Bird $1",
                other: !0
            }, {
                regex: "Dell ([A-Za-z0-9]+)",
                device_replacement: "Dell $1",
                manufacturer: "Dell"
            }, {
                regex: "DoCoMo/2\\.0 ([A-Za-z0-9]+)",
                device_replacement: "DoCoMo $1",
                other: !0
            }, {
                regex: "([A-Za-z0-9]+)\\_W\\;FOMA",
                device_replacement: "DoCoMo $1",
                other: !0
            }, {
                regex: "([A-Za-z0-9]+)\\;FOMA",
                device_replacement: "DoCoMo $1",
                other: !0
            }, {
                regex: "vodafone([A-Za-z0-9]+)",
                device_replacement: "Huawei Vodafone $1",
                other: !0
            }, {
                regex: "i\\-mate ([A-Za-z0-9]+)",
                device_replacement: "i-mate $1",
                other: !0
            }, {
                regex: "Kyocera\\-([A-Za-z0-9]+)",
                device_replacement: "Kyocera $1",
                other: !0
            }, {
                regex: "KWC\\-([A-Za-z0-9]+)",
                device_replacement: "Kyocera $1",
                other: !0
            }, {
                regex: "Lenovo\\-([A-Za-z0-9]+)",
                device_replacement: "Lenovo $1",
                manufacturer: "Lenovo"
            }, {
                regex: "Lenovo\\_([A-Za-z0-9]+)",
                device_replacement: "Lenovo $1",
                manufacturer: "Levovo"
            }, {
                regex: "LG/([A-Za-z0-9]+)",
                device_replacement: "LG $1",
                manufacturer: "LG"
            }, {
                regex: "LG-LG([A-Za-z0-9]+)",
                device_replacement: "LG $1",
                manufacturer: "LG"
            }, {
                regex: "LGE-LG([A-Za-z0-9]+)",
                device_replacement: "LG $1",
                manufacturer: "LG"
            }, {
                regex: "LGE VX([A-Za-z0-9]+)",
                device_replacement: "LG $1",
                manufacturer: "LG"
            }, {
                regex: "LG ([A-Za-z0-9]+)",
                device_replacement: "LG $1",
                manufacturer: "LG"
            }, {
                regex: "LGE LG\\-AX([A-Za-z0-9]+)",
                device_replacement: "LG $1",
                manufacturer: "LG"
            }, {
                regex: "LG\\-([A-Za-z0-9]+)",
                device_replacement: "LG $1",
                manufacturer: "LG"
            }, {
                regex: "LGE\\-([A-Za-z0-9]+)",
                device_replacement: "LG $1",
                manufacturer: "LG"
            }, {
                regex: "LG([A-Za-z0-9]+)",
                device_replacement: "LG $1",
                manufacturer: "LG"
            }, {
                regex: "(KIN)\\.One (\\d+)\\.(\\d+)",
                device_replacement: "Microsoft $1"
            }, {
                regex: "(KIN)\\.Two (\\d+)\\.(\\d+)",
                device_replacement: "Microsoft $1"
            }, {
                regex: "(Motorola)\\-([A-Za-z0-9]+)",
                manufacturer: "Motorola"
            }, {
                regex: "MOTO\\-([A-Za-z0-9]+)",
                device_replacement: "Motorola $1",
                manufacturer: "Motorola"
            }, {
                regex: "MOT\\-([A-Za-z0-9]+)",
                device_replacement: "Motorola $1",
                manufacturer: "Motorola"
            }, {
                regex: "Philips([A-Za-z0-9]+)",
                device_replacement: "Philips $1",
                manufacturer: "Philips"
            }, {
                regex: "Philips ([A-Za-z0-9]+)",
                device_replacement: "Philips $1",
                manufacturer: "Philips"
            }, {
                regex: "SAMSUNG-([A-Za-z0-9\\-]+)",
                device_replacement: "Samsung $1",
                manufacturer: "Samsung"
            }, {
                regex: "SAMSUNG\\; ([A-Za-z0-9\\-]+)",
                device_replacement: "Samsung $1",
                manufacturer: "Samsung"
            }, {
                regex: "Softbank/1\\.0/([A-Za-z0-9]+)",
                device_replacement: "Softbank $1",
                other: !0
            }, {
                regex: "Softbank/2\\.0/([A-Za-z0-9]+)",
                device_replacement: "Softbank $1",
                other: !0
            }, {
                regex: "(hiptop|avantgo|plucker|xiino|blazer|elaine|up.browser|up.link|mmp|smartphone|midp|wap|vodafone|o2|pocket|mobile|pda)",
                device_replacement: "Generic Smartphone"
            }, {
                regex: "^(1207|3gso|4thp|501i|502i|503i|504i|505i|506i|6310|6590|770s|802s|a wa|acer|acs\\-|airn|alav|asus|attw|au\\-m|aur |aus |abac|acoo|aiko|alco|alca|amoi|anex|anny|anyw|aptu|arch|argo|bell|bird|bw\\-n|bw\\-u|beck|benq|bilb|blac|c55/|cdm\\-|chtm|capi|comp|cond|craw|dall|dbte|dc\\-s|dica|ds\\-d|ds12|dait|devi|dmob|doco|dopo|el49|erk0|esl8|ez40|ez60|ez70|ezos|ezze|elai|emul|eric|ezwa|fake|fly\\-|fly\\_|g\\-mo|g1 u|g560|gf\\-5|grun|gene|go.w|good|grad|hcit|hd\\-m|hd\\-p|hd\\-t|hei\\-|hp i|hpip|hs\\-c|htc |htc\\-|htca|htcg)",
                device_replacement: "Generic Feature Phone"
            }, {
                regex: "^(htcp|htcs|htct|htc\\_|haie|hita|huaw|hutc|i\\-20|i\\-go|i\\-ma|i230|iac|iac\\-|iac/|ig01|im1k|inno|iris|jata|java|kddi|kgt|kgt/|kpt |kwc\\-|klon|lexi|lg g|lg\\-a|lg\\-b|lg\\-c|lg\\-d|lg\\-f|lg\\-g|lg\\-k|lg\\-l|lg\\-m|lg\\-o|lg\\-p|lg\\-s|lg\\-t|lg\\-u|lg\\-w|lg/k|lg/l|lg/u|lg50|lg54|lge\\-|lge/|lynx|leno|m1\\-w|m3ga|m50/|maui|mc01|mc21|mcca|medi|meri|mio8|mioa|mo01|mo02|mode|modo|mot |mot\\-|mt50|mtp1|mtv |mate|maxo|merc|mits|mobi|motv|mozz|n100|n101|n102|n202|n203|n300|n302|n500|n502|n505|n700|n701|n710|nec\\-|nem\\-|newg|neon)",
                device_replacement: "Generic Feature Phone"
            }, {
                regex: "^(netf|noki|nzph|o2 x|o2\\-x|opwv|owg1|opti|oran|ot\\-s|p800|pand|pg\\-1|pg\\-2|pg\\-3|pg\\-6|pg\\-8|pg\\-c|pg13|phil|pn\\-2|pt\\-g|palm|pana|pire|pock|pose|psio|qa\\-a|qc\\-2|qc\\-3|qc\\-5|qc\\-7|qc07|qc12|qc21|qc32|qc60|qci\\-|qwap|qtek|r380|r600|raks|rim9|rove|s55/|sage|sams|sc01|sch\\-|scp\\-|sdk/|se47|sec\\-|sec0|sec1|semc|sgh\\-|shar|sie\\-|sk\\-0|sl45|slid|smb3|smt5|sp01|sph\\-|spv |spv\\-|sy01|samm|sany|sava|scoo|send|siem|smar|smit|soft|sony|t\\-mo|t218|t250|t600|t610|t618|tcl\\-|tdg\\-|telm|tim\\-|ts70|tsm\\-|tsm3|tsm5|tx\\-9|tagt)",
                device_replacement: "Generic Feature Phone"
            }, {
                regex: "^(talk|teli|topl|tosh|up.b|upg1|utst|v400|v750|veri|vk\\-v|vk40|vk50|vk52|vk53|vm40|vx98|virg|vite|voda|vulc|w3c |w3c\\-|wapj|wapp|wapu|wapm|wig |wapi|wapr|wapv|wapy|wapa|waps|wapt|winc|winw|wonu|x700|xda2|xdag|yas\\-|your|zte\\-|zeto|aste|audi|avan|blaz|brew|brvw|bumb|ccwa|cell|cldc|cmd\\-|dang|eml2|fetc|hipt|http|ibro|idea|ikom|ipaq|jbro|jemu|jigs|keji|kyoc|kyok|libw|m\\-cr|midp|mmef|moto|mwbp|mywa|newt|nok6|o2im|pant|pdxg|play|pluc|port|prox|rozo|sama|seri|smal|symb|treo|upsi|vx52|vx53|vx60|vx61|vx70|vx80|vx81|vx83|vx85|wap\\-|webc|whit|wmlb|xda\\-|xda\\_)",
                device_replacement: "Generic Feature Phone"
            }, {
                regex: "(bot|borg|google(^tv)|yahoo|slurp|msnbot|msrbot|openbot|archiver|netresearch|lycos|scooter|altavista|teoma|gigabot|baiduspider|blitzbot|oegp|charlotte|furlbot|http%20client|polybot|htdig|ichiro|mogimogi|larbin|pompos|scrubby|searchsight|seekbot|semanticdiscovery|silk|snappy|speedy|spider|voila|vortex|voyager|zao|zeal|fast\\-webcrawler|converacrawler|dataparksearch|findlinks)",
                device_replacement: "Spider"
            } ],
            mobile_browser_families: [ "Firefox Mobile", "Opera Mobile", "Opera Mini", "Mobile Safari", "webOS", "IE Mobile", "Playstation Portable", "Nokia", "Blackberry", "Palm", "Silk", "Android", "Maemo", "Obigo", "Netfront", "AvantGo", "Teleca", "SEMC-Browser", "Bolt", "Iris", "UP.Browser", "Symphony", "Minimo", "Bunjaloo", "Jasmine", "Dolfin", "Polaris", "BREW", "Chrome Mobile", "Chrome Mobile iOS", "UC Browser", "Tizen Browser" ]
        };
        e.parsers = [ "device_parsers", "browser_parsers", "os_parsers", "mobile_os_families", "mobile_browser_families" ], 
        e.types = [ "browser", "os", "device" ], e.regexes = t || function() {
            var t = {};
            return e.parsers.map(function(e) {
                t[e] = [];
            }), t;
        }(), e.families = function() {
            var t = {};
            return e.types.map(function(e) {
                t[e] = [];
            }), t;
        }();
        var i = Array.prototype, n = (Object.prototype, Function.prototype, i.forEach);
        i.indexOf;
        var r = function(e, t) {
            for (var i = {}, n = 0; t.length > n && !(i = t[n](e)); n++) ;
            return i;
        }, o = function(e, t) {
            s(e, function(e) {
                s(t, function(t) {
                    delete e[t];
                });
            });
        }, s = forEach = function(e, t, i) {
            if (null != e) if (n && e.forEach === n) e.forEach(t, i); else if (e.length === +e.length) for (var r = 0, a = e.length; a > r; r++) t.call(i, e[r], r, e); else for (var o in e) _.has(e, o) && t.call(i, e[o], o, e);
        }, l = function(e) {
            return !(!e || e === undefined || null == e);
        }, c = function(e) {
            var t = "";
            return e = e || {}, l(e) && l(e.major) && (t += e.major, l(e.minor) && (t += "." + e.minor, 
            l(e.patch) && (t += "." + e.patch))), t;
        }, u = function(e) {
            e = e || {};
            var t = c(e);
            return t && (t = " " + t), e && l(e.family) ? e.family + t : "";
        };
        return e.parse = function(t) {
            var i = function(t) {
                return e.regexes[t + "_parsers"].map(function(e) {
                    function i(t) {
                        var i = t.match(n);
                        if (!i) return null;
                        var o = {};
                        return o.family = (r ? r.replace("$1", i[1]) : i[1]) || "other", o.major = parseInt(a ? a : i[2]) || null, 
                        o.minor = i[3] ? parseInt(i[3]) : null, o.patch = i[4] ? parseInt(i[4]) : null, 
                        o.tablet = e.tablet, o.man = e.manufacturer || null, o;
                    }
                    var n = RegExp(e.regex), r = e[("browser" === t ? "family" : t) + "_replacement"], a = e.major_version_replacement;
                    return i;
                });
            }, n = function() {}, s = i("browser"), f = i("os"), d = i("device");
            a = new n(), a.source = t, a.browser = r(t, s), l(a.browser) ? (a.browser.name = u(a.browser), 
            a.browser.version = c(a.browser)) : a.browser = {}, a.os = r(t, f), l(a.os) ? (a.os.name = u(a.os), 
            a.os.version = c(a.os)) : a.os = {}, a.device = r(t, d), l(a.device) ? (a.device.name = u(a.device), 
            a.device.version = c(a.device)) : a.device = {
                tablet: !1,
                family: "Other"
            };
            var h = {};
            return e.regexes.mobile_browser_families.map(function(e) {
                h[e] = !0;
            }), e.regexes.mobile_os_families.map(function(e) {
                h[e] = !0;
            }), a.device.type = "Spider" === a.browser.family ? "Spider" : a.browser.tablet || a.os.tablet || a.device.tablet ? "Tablet" : h.hasOwnProperty(a.browser.family) ? "Mobile" : "Desktop", 
            a.device.manufacturer = a.browser.man || a.os.man || a.device.man || null, o([ a.browser, a.os, a.device ], [ "tablet", "man" ]), 
            a;
        }, e;
    }();
    "undefined" != typeof exports ? ("undefined" != typeof module && module.exports && (exports = module.exports = t), 
    exports.detect = t) : e.detect = t, "function" == typeof define && define.amd && define("detect", [], function() {
        return t;
    });
})(window);

define("ua", [ "detect" ], function(e) {
    return e.parse(navigator.userAgent);
});

(function(e) {
    var t = {
        config: {
            ENV: "production",
            API_BASE_URL: window.location.origin,
            BASE_URL: window.location.origin,
            LIVE_URL: "//live.local/",
            OLD_BROWSER_URL: "https://pics.io/ancient",
            PUBSUB_URL: "https://pics.io:8091/connect",
            loaderType: "yellow",
            debug: {
                LOAD_RAW_FROM_LOCALHOST: false
            },
            browser: {
                Chrome: 32,
                Firefox: 27,
                Safari: 7
            },
            readAccess: function(e) {
                var t = this;
                $.ajax({
                    url: "/public/room/access",
                    success: function(i) {
                        if (i.errors) {
                            return e();
                        }
                        t.access = Object.merge(t.access, i);
                        e();
                    },
                    error: function(t) {
                        e();
                    }
                });
            },
            access: {
                download: true,
                flag: true,
                rating: true,
                comment: true,
                color: true,
                flagShow: true
            },
            ua: null,
            roomHash: "room",
            checkBrowser: function(e) {
                if (this.browser[this.ua.browser.family] > this.ua.browser.major) {
                    window.location = this.OLD_BROWSER_URL;
                }
            },
            getRoomAlias: function() {
                return window.location.origin + window.pathname;
            },
            tags: {
                filters: {
                    filterRegexp: /[&"'`\/\\]/g,
                    symbolToReplace: "",
                    symbolToReplaceSynced: ""
                }
            },
            payments: {
                PREVENT_SUBSCRIPTION_CHECKING_ON_SHARE: false,
                stripe: {
                    FORM_IMAGE: "https://pics.io/assets/img/favicon/faviconPicsio/apple-touch-icon-120x120.png",
                    PUBLISHABLE_KEY: "pk_live_4WmYqfZEe2LJmooWsAUsF3Cw",
                    COMMIT_CHARGE_URL: "https://pics.io/payments/stripe/commit",
                    SUBSCRIBE_URL: "/payments/stripe/subscribe",
                    UNSUBSCRIBE_URL: "/payments/stripe/unsubscribe",
                    RESTORE_PAYMENT_URL: "https://pics.io/payments/stripe/restore",
                    RETRIEVE_CUSTOMER_URL: "/payments/stripe/customer",
                    CHANGE_CARD_URL: "/payments/stripe/changeCard",
                    REDEEM_COUPON_URL: "/payments/stripe/redeem",
                    PAYPAL_URL: "https://zapier.com/hooks/paypal/?cid=18595"
                }
            },
            gdrive: {
                APP_FOLDER: "Picsio",
                BROKEN_FORMATS: [ "image/tiff", "application/octet-stream" ],
                SCOPES: [ "https://www.googleapis.com/auth/drive", "https://www.googleapis.com/auth/drive.appdata" ].join(" "),
                THUMBNAILS_PROXY_PATH: "/images/proxy?path=",
                OFFLINE_ACCESS_REDIRECT_URL: "http://requestb.in/19ym4yg1",
                getThumbnailsProxyUrl: function() {
                    return t.config.API_BASE_URL + t.config.gdrive.THUMBNAILS_PROXY_PATH;
                },
                DOWNLOAD_RAW_CHUNK_SIZE: 1024 * 1024 * 2,
                HEADER_SIZE: 1e3,
                CLIENT_ID: "190238897195.apps.googleusercontent.com",
                API_KEY: "AIzaSyBd8JsFANCT0qwsSuEC5sNjkCAJpjLWvLA"
            },
            s3: {
                THUMBNAILS_PROXY_PATH: "/images/proxy?path=",
                getThumbnailsProxyUrl: function() {
                    return t.config.API_BASE_URL + t.config.s3.THUMBNAILS_PROXY_PATH;
                },
                buckets: {
                    inputLambdaConverter: "https://s3.amazonaws.com/in-lambda-converter/",
                    outputLambdaConverter: "https://s3.amazonaws.com/out-lambda-converter/",
                    sharedImages: "https://s3.amazonaws.com/public.raw.pics.io/"
                }
            },
            vocalbee: {
                url: "https://www.vocalbee.com/vocalbeerestapi/memoryscore.svc/memoryscore?apikey=fd5c5922-5dc4-4f5d-b69e-85fd2b20db1e"
            },
            services: {
                thumbnailer: {
                    URL: "https://thumbs.pics.io/thumbnails/"
                },
                downloader: {
                    URL: "https://zip.pics.io/zip"
                }
            },
            editor: {
                "export": {
                    mimeType: "image/jpeg"
                }
            },
            filters: {
                DEFAULT_CONTRAST_FILTER: 100,
                DEFAULT_BRIGHTNESS_FILTER: 100,
                DEFAULT_SEPIA_FILTER: 0,
                DEFAULT_BLUR_FILTER: 0,
                DEFAULT_GRAYSCALE_FILTER: 0,
                DEFAULT_SATURATION_FILTER: 100,
                DEFAULT_HUE_FILTER: 0,
                DEFAULT_SHARPNESS_FILTER: 0,
                DEFAULT_HORIZONTALFLIP_FILTER: false,
                DEFAULT_VERTICALFLIP_FILTER: false,
                DEFAULT_ROTATION_ANGLE: 0
            },
            support: {
                SUPPORT_URL: "//picsio.uservoice.com",
                USER_VOICE_RELEASE: "http://support.pics.io/knowledgebase/articles/246392-what-s-in-this-release"
            },
            paths: {
                RESET_PASSWORD_PATH: "/forgot?email="
            },
            version: {
                cookiesName: "picsio.version"
            },
            assets: "/assets",
            defaultStatic: {
                imagePreview: "/assets/img/preview-fake.500.png?fake=fake"
            },
            formats: {
                SUPPORTED_REGENERATE_PREVIEW_FORMATS: [ "image/x-photoshop", "application/psd", "application/x-photoshop", "image/photoshop", "image/psd", "image/x-psd", "image/tiff", "image/x-tiff", "image/x-adobe-dng", "application/pdf" ],
                SUPPORTED_DIFF_FORMATS: [ "image/jpeg", "image/png", "image/gif" ],
                SUPPORTED_RAW_FORMATS: [ "image/x-adobe-dng", "image/x-canon-cr2", "image/x-nikon-nef", "image/x-sony-arw", "image/x-olympus-orf" ],
                PDF_FORMATS: [ "application/pdf", "application/postscript" ],
                SUPPORTED_FORMATS: [ "image/jpeg", "image/x-adobe-dng", "image/x-canon-cr2", "image/x-nikon-nef", "image/x-sony-arw", "image/x-olympus-orf", "image/png", "image/gif", "video/mp4", "video/x-msvideo", "application/x-troff-msvideo", "video/msvideo", "video/avi", "video/webm", "video/quicktime", "video/mpeg", "video/x-ms-wmv", "video/flv", "video/mp2t", "video/3gpp", "image/x-photoshop", "application/psd", "application/x-photoshop", "image/photoshop", "image/psd", "image/x-psd", "application/pdf", "application/postscript", "image/tiff", "image/x-tiff", "image/x-panasonic-rw2", "image/x-fuji-raf", "application/illustrator", "audio/mpeg", "audio/x-mpeg-3", "video/mpeg", "video/x-mpeg", "audio/wav", "audio/x-wav", "application/vnd.google-apps.document", "application/vnd.google-apps.spreadsheet", "application/vnd.google-apps.presentation", "application/vnd.google-apps.drawing", "image/svg+xml", "application/x-font-ttf", "video/mp4", "text/plain", "application/vnd.openxmlformats-officedocument.wordprocessingml.document", "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" ],
                RAWPICSIO_SUPPORTED_FORMATS: [ "image/jpeg", "image/x-adobe-dng", "image/x-canon-cr2", "image/x-canon-crw", "image/x-epson-erf", "image/x-nikon-nef", "image/x-sony-srf", "image/x-sony-arw", "image/x-olympus-orf", "image/png", "image/gif", "image/x-kodak-dcr", "image/x-panasonic-raw", "image/x-panasonic-rw2", "image/x-fuji-raf", "image/x-sigma-x3f", "image/x-pentax-pef", "image/x-samsung-srw" ],
                LAMBDA_CONVERTABLE_FORMATS: [ "image/x-adobe-dng", "image/x-canon-cr2", "image/x-canon-crw", "image/x-epson-erf", "image/x-nikon-nef", "image/x-sony-srf", "image/x-sony-arw", "image/x-olympus-orf", "image/x-kodak-dcr", "image/x-panasonic-raw", "image/x-panasonic-rw2", "image/x-fuji-raf", "image/x-sigma-x3f", "image/x-pentax-pef", "image/x-samsung-srw" ],
                PARTIALLY_SUPPORTED: [ "eps" ]
            },
            subscriptionPermissions: {
                "default": {
                    catalog: true,
                    sharing: false,
                    websites: false,
                    teams: false
                },
                unsubscribed: {
                    catalog: false,
                    sharing: false,
                    websites: false,
                    teams: false
                },
                trial: {
                    catalog: true,
                    sharing: true,
                    websites: true,
                    teams: true,
                    teammates: 100
                },
                ownerSubscriptionEnded: {
                    ownerSubscriptionEnded: true
                },
                basic_monthly: {
                    catalog: true,
                    sharing: false,
                    websites: false,
                    teams: false
                },
                basic_yearly: {
                    catalog: true,
                    sharing: false,
                    websites: false,
                    teams: false
                },
                monthly: {
                    catalog: true,
                    sharing: true,
                    websites: true,
                    teams: false
                },
                yearly: {
                    catalog: true,
                    sharing: true,
                    websites: true,
                    teams: false
                },
                tier1_monthly: {
                    catalog: true,
                    sharing: true,
                    websites: true,
                    teams: true,
                    teammates: 3
                },
                tier1_yearly: {
                    catalog: true,
                    sharing: true,
                    websites: true,
                    teams: true,
                    teammates: 3
                },
                tier2_yearly: {
                    catalog: true,
                    sharing: true,
                    websites: true,
                    teams: true,
                    teammates: 10
                },
                tier2_monthly: {
                    catalog: true,
                    sharing: true,
                    websites: true,
                    teams: true,
                    teammates: 10
                },
                tier3_yearly: {
                    catalog: true,
                    sharing: true,
                    websites: true,
                    teams: true,
                    teammates: 50
                },
                tier3_monthly: {
                    catalog: true,
                    sharing: true,
                    websites: true,
                    teams: true,
                    teammates: 50
                },
                tier4_yearly: {
                    catalog: true,
                    sharing: true,
                    websites: true,
                    teams: true,
                    teammates: 100
                },
                tier4_monthly: {
                    catalog: true,
                    sharing: true,
                    websites: true,
                    teams: true,
                    teammates: 100
                }
            },
            cameras: {
                DENIED_FOR_EDIT: [ "FUJIFILM X-E1", "FUJIFILM X-E2", "FUJIFILM X-M1", "FUJIFILM X-A1", "FUJIFILM X-Pro1" ]
            },
            SHOW_START_DISCLAIMER: true,
            SHOW_TILE_FILENAME: false,
            IMAGE_PER_PAGE: 30,
            LOAD_PER_REQUEST: 1e3,
            MAX_PREVIEW_COUNT: 0,
            unknownUsername: "Guest"
        }
    };
    var i = document.location.hostname.toLowerCase();
    if (i === "pics.io" || i === "raw.pics.io" || i === "edit.pics.io" || i === "live.pics.io") {
        t.config.ENV = "production";
        t.config.API_BASE_URL = window.location.origin;
    } else if (i === "now.pics.io" || i === "stage.pics.io" || i === "rawstage.pics.io" || i === "editstage.pics.io" || i === "raw.stage.pics.io" || i === "edit.stage.pics.io" || i === "live.stage.pics.io") {
        t.config.ENV = "stage";
        t.config.API_BASE_URL = !!(window.chrome && window.chrome.app && window.chrome.app.runtime) ? "https://pics.io" : "https://stage.pics.io";
    } else if (!!(window.chrome && window.chrome.app && window.chrome.app.runtime)) {
        t.config.ENV = "production";
        t.config.API_BASE_URL = window.location.origin;
    } else {
        t.config.ENV = "development";
        t.config.API_BASE_URL = window.location.origin;
    }
    t.config.SHOW_START_DISCLAIMER = t.config.ENV === "production" || t.config.ENV === "stage";
    t.config.SHOW_TILE_FILENAME = t.config.ENV === "development";
    if (t.config.ENV === "development") {
        t.config.s3.buckets = {
            inputLambdaConverter: "http://s3.amazonaws.com/in-lambda-converter/",
            outputLambdaConverter: "http://s3.amazonaws.com/out-lambda-converter/",
            sharedImages: "http://s3.amazonaws.com/public.raw.pics.io/"
        };
        t.config.payments.wallet = {
            ENCODE_PAYMENT_URL: "http://picsio.local/payments/wallet/encode",
            RESTORE_PAYMENT_URL: "http://picsio.local/payments/wallet/restore"
        };
        t.config.PUBSUB_URL = "http://localhost:8091/connect";
        t.config.payments.stripe = {
            PUBLISHABLE_KEY: "pk_test_4WmYPFjLHNf2327g5YbiQs3U",
            FORM_IMAGE: "https://pics.io/assets/img/favicon/faviconPicsio/apple-touch-icon-120x120.png",
            SUBSCRIBE_URL: "/payments/stripe/subscribe",
            UNSUBSCRIBE_URL: "/payments/stripe/unsubscribe",
            COMMIT_CHARGE_URL: "http://picsio.local/payments/stripe/commit",
            RESTORE_PAYMENT_URL: "http://picsio.local/payments/stripe/restore",
            RETRIEVE_CUSTOMER_URL: "/payments/stripe/customer",
            CHANGE_CARD_URL: "/payments/stripe/changeCard",
            REDEEM_COUPON_URL: "/payments/stripe/redeem"
        };
        t.config.vocalbee.url = "http://www.vocalbee.com/vocalbeerestapi/memoryscore.svc/memoryscore?apikey=fd5c5922-5dc4-4f5d-b69e-85fd2b20db1e";
    } else if (t.config.ENV === "stage") {
        t.config.payments.wallet = {
            ENCODE_PAYMENT_URL: "https://stage.pics.io/payments/wallet/encode",
            RESTORE_PAYMENT_URL: "https://stage.pics.io/payments/wallet/restore"
        };
        t.config.PUBSUB_URL = "https://stage.pics.io:8091/connect";
        t.config.payments.stripe = {
            PUBLISHABLE_KEY: "pk_test_4WmYPFjLHNf2327g5YbiQs3U",
            FORM_IMAGE: "https://pics.io/assets/img/favicon/faviconPicsio/apple-touch-icon-120x120.png",
            SUBSCRIBE_URL: "https://stage.pics.io/payments/stripe/subscribe",
            UNSUBSCRIBE_URL: "https://stage.pics.io/payments/stripe/unsubscribe",
            COMMIT_CHARGE_URL: "https://stage.pics.io/payments/stripe/commit",
            RESTORE_PAYMENT_URL: "https://stage.pics.io/payments/stripe/restore",
            RETRIEVE_CUSTOMER_URL: "https://stage.pics.io/payments/stripe/customer",
            CHANGE_CARD_URL: "https://stage.pics.io/payments/stripe/changeCard",
            REDEEM_COUPON_URL: "https://stage.pics.io/payments/stripe/redeem"
        };
        t.config.vocalbee.url = "https://www.vocalbee.com/vocalbeerestapi/memoryscore.svc/memoryscore?apikey=fd5c5922-5dc4-4f5d-b69e-85fd2b20db1e";
    }
    t.config.gdrive.LOAD_RAW_FROM_LOCALHOST = t.config.ENV === "development";
    if (typeof define === "function") {
        define("environment", [ "ua" ], function(e) {
            t.config.ua = e;
            return t;
        });
    } else {
        if (typeof e.PicsIO === "undefined") e.PicsIO = t;
    }
    Object.defineProperty(t, "BASE_URL", {
        get: function() {
            return !!(window.chrome && window.chrome.app && window.chrome.app.runtime) ? "https://pics.io" : window.location.origin;
        }
    });
    Object.defineProperty(t, "isChrome", {
        get: function() {
            return !!(window.chrome && window.chrome.app && window.chrome.app.runtime);
        }
    });
    Object.defineProperty(t, "roomId", {
        get: function() {}
    });
})(this);

(function(e) {
    if (typeof bootstrap === "function") {
        bootstrap("promise", e);
    } else if (typeof exports === "object") {
        module.exports = e();
    } else if (typeof define === "function" && define.amd) {
        define("q", e);
    } else if (typeof ses !== "undefined") {
        if (!ses.ok()) {
            return;
        } else {
            ses.makeQ = e;
        }
    } else {
        Q = e();
    }
})(function() {
    var e = false;
    try {
        throw new Error();
    } catch (t) {
        e = !!t.stack;
    }
    var i = A();
    var n;
    var r = function() {};
    var a = function() {
        var e = {
            task: void 0,
            next: null
        };
        var t = e;
        var i = false;
        var n = void 0;
        var r = false;
        function o() {
            while (e.next) {
                e = e.next;
                var t = e.task;
                e.task = void 0;
                var n = e.domain;
                if (n) {
                    e.domain = void 0;
                    n.enter();
                }
                try {
                    t();
                } catch (a) {
                    if (r) {
                        if (n) {
                            n.exit();
                        }
                        setTimeout(o, 0);
                        if (n) {
                            n.enter();
                        }
                        throw a;
                    } else {
                        setTimeout(function() {
                            throw a;
                        }, 0);
                    }
                }
                if (n) {
                    n.exit();
                }
            }
            i = false;
        }
        a = function(e) {
            t = t.next = {
                task: e,
                domain: r && process.domain,
                next: null
            };
            if (!i) {
                i = true;
                n();
            }
        };
        if (typeof process !== "undefined" && process.nextTick) {
            r = true;
            n = function() {
                process.nextTick(o);
            };
        } else if (typeof setImmediate === "function") {
            if (typeof window !== "undefined") {
                n = setImmediate.bind(window, o);
            } else {
                n = function() {
                    setImmediate(o);
                };
            }
        } else if (typeof MessageChannel !== "undefined") {
            var s = new MessageChannel();
            s.port1.onmessage = function() {
                n = l;
                s.port1.onmessage = o;
                o();
            };
            var l = function() {
                s.port2.postMessage(0);
            };
            n = function() {
                setTimeout(o, 0);
                l();
            };
        } else {
            n = function() {
                setTimeout(o, 0);
            };
        }
        return a;
    }();
    var o = Function.call;
    function s(e) {
        return function() {
            return o.apply(e, arguments);
        };
    }
    var l = s(Array.prototype.slice);
    var c = s(Array.prototype.reduce || function(e, t) {
        var i = 0, n = this.length;
        if (arguments.length === 1) {
            do {
                if (i in this) {
                    t = this[i++];
                    break;
                }
                if (++i >= n) {
                    throw new TypeError();
                }
            } while (1);
        }
        for (;i < n; i++) {
            if (i in this) {
                t = e(t, this[i], i);
            }
        }
        return t;
    });
    var u = s(Array.prototype.indexOf || function(e) {
        for (var t = 0; t < this.length; t++) {
            if (this[t] === e) {
                return t;
            }
        }
        return -1;
    });
    var f = s(Array.prototype.map || function(e, t) {
        var i = this;
        var n = [];
        c(i, function(r, a, o) {
            n.push(e.call(t, a, o, i));
        }, void 0);
        return n;
    });
    var d = Object.create || function(e) {
        function t() {}
        t.prototype = e;
        return new t();
    };
    var h = s(Object.prototype.hasOwnProperty);
    var p = Object.keys || function(e) {
        var t = [];
        for (var i in e) {
            if (h(e, i)) {
                t.push(i);
            }
        }
        return t;
    };
    var g = s(Object.prototype.toString);
    function m(e) {
        return e === Object(e);
    }
    function v(e) {
        return g(e) === "[object StopIteration]" || e instanceof y;
    }
    var y;
    if (typeof ReturnValue !== "undefined") {
        y = ReturnValue;
    } else {
        y = function(e) {
            this.value = e;
        };
    }
    var b;
    try {
        b = true;
    } catch (t) {
        b = false;
    }
    var w = "From previous event:";
    function C(t, i) {
        if (e && i.stack && typeof t === "object" && t !== null && t.stack && t.stack.indexOf(w) === -1) {
            var n = [];
            for (var r = i; !!r; r = r.source) {
                if (r.stack) {
                    n.unshift(r.stack);
                }
            }
            n.unshift(t.stack);
            var a = n.join("\n" + w + "\n");
            t.stack = x(a);
        }
    }
    function x(e) {
        var t = e.split("\n");
        var i = [];
        for (var n = 0; n < t.length; ++n) {
            var r = t[n];
            if (!k(r) && !_(r) && r) {
                i.push(r);
            }
        }
        return i.join("\n");
    }
    function _(e) {
        return e.indexOf("(module.js:") !== -1 || e.indexOf("(node.js:") !== -1;
    }
    function S(e) {
        var t = /at .+ \((.+):(\d+):(?:\d+)\)$/.exec(e);
        if (t) {
            return [ t[1], Number(t[2]) ];
        }
        var i = /at ([^ ]+):(\d+):(?:\d+)$/.exec(e);
        if (i) {
            return [ i[1], Number(i[2]) ];
        }
        var n = /.*@(.+):(\d+)$/.exec(e);
        if (n) {
            return [ n[1], Number(n[2]) ];
        }
    }
    function k(e) {
        var t = S(e);
        if (!t) {
            return false;
        }
        var r = t[0];
        var a = t[1];
        return r === n && a >= i && a <= ut;
    }
    function A() {
        if (!e) {
            return;
        }
        try {
            throw new Error();
        } catch (t) {
            var i = t.stack.split("\n");
            var r = i[0].indexOf("@") > 0 ? i[1] : i[2];
            var a = S(r);
            if (!a) {
                return;
            }
            n = a[0];
            return a[1];
        }
    }
    function E(e, t, i) {
        return function() {
            if (typeof console !== "undefined" && typeof console.warn === "function") {
                console.warn(t + " is deprecated, use " + i + " instead.", new Error("").stack);
            }
            return e.apply(e, arguments);
        };
    }
    function T(e) {
        if (F(e)) {
            return e;
        }
        if (M(e)) {
            return K(e);
        } else {
            return J(e);
        }
    }
    T.resolve = T;
    T.nextTick = a;
    T.longStackSupport = false;
    T.defer = P;
    function P() {
        var t = [], i = [], n;
        var r = d(P.prototype);
        var o = d(D.prototype);
        o.promiseDispatch = function(e, r, o) {
            var s = l(arguments);
            if (t) {
                t.push(s);
                if (r === "when" && o[1]) {
                    i.push(o[1]);
                }
            } else {
                a(function() {
                    n.promiseDispatch.apply(n, s);
                });
            }
        };
        o.valueOf = function() {
            if (t) {
                return o;
            }
            var e = L(n);
            if (F(e)) {
                n = e;
            }
            return e;
        };
        o.inspect = function() {
            if (!n) {
                return {
                    state: "pending"
                };
            }
            return n.inspect();
        };
        if (T.longStackSupport && e) {
            try {
                throw new Error();
            } catch (s) {
                o.stack = s.stack.substring(s.stack.indexOf("\n") + 1);
            }
        }
        function u(e) {
            n = e;
            o.source = e;
            c(t, function(t, i) {
                a(function() {
                    e.promiseDispatch.apply(e, i);
                });
            }, void 0);
            t = void 0;
            i = void 0;
        }
        r.promise = o;
        r.resolve = function(e) {
            if (n) {
                return;
            }
            u(T(e));
        };
        r.fulfill = function(e) {
            if (n) {
                return;
            }
            u(J(e));
        };
        r.reject = function(e) {
            if (n) {
                return;
            }
            u(X(e));
        };
        r.notify = function(e) {
            if (n) {
                return;
            }
            c(i, function(t, i) {
                a(function() {
                    i(e);
                });
            }, void 0);
        };
        return r;
    }
    P.prototype.makeNodeResolver = function() {
        var e = this;
        return function(t, i) {
            if (t) {
                e.reject(t);
            } else if (arguments.length > 2) {
                e.resolve(l(arguments, 1));
            } else {
                e.resolve(i);
            }
        };
    };
    T.promise = I;
    function I(e) {
        if (typeof e !== "function") {
            throw new TypeError("resolver must be a function.");
        }
        var t = P();
        try {
            e(t.resolve, t.reject, t.notify);
        } catch (i) {
            t.reject(i);
        }
        return t.promise;
    }
    T.passByCopy = function(e) {
        return e;
    };
    D.prototype.passByCopy = function() {
        return this;
    };
    T.join = function(e, t) {
        return T(e).join(t);
    };
    D.prototype.join = function(e) {
        return T([ this, e ]).spread(function(e, t) {
            if (e === t) {
                return e;
            } else {
                throw new Error("Can't join: not the same: " + e + " " + t);
            }
        });
    };
    T.race = O;
    function O(e) {
        return I(function(t, i) {
            for (var n = 0, r = e.length; n < r; n++) {
                T(e[n]).then(t, i);
            }
        });
    }
    D.prototype.race = function() {
        return this.then(T.race);
    };
    T.makePromise = D;
    function D(e, t, i) {
        if (t === void 0) {
            t = function(e) {
                return X(new Error("Promise does not support operation: " + e));
            };
        }
        if (i === void 0) {
            i = function() {
                return {
                    state: "unknown"
                };
            };
        }
        var n = d(D.prototype);
        n.promiseDispatch = function(i, r, a) {
            var o;
            try {
                if (e[r]) {
                    o = e[r].apply(n, a);
                } else {
                    o = t.call(n, r, a);
                }
            } catch (s) {
                o = X(s);
            }
            if (i) {
                i(o);
            }
        };
        n.inspect = i;
        if (i) {
            var r = i();
            if (r.state === "rejected") {
                n.exception = r.reason;
            }
            n.valueOf = function() {
                var e = i();
                if (e.state === "pending" || e.state === "rejected") {
                    return n;
                }
                return e.value;
            };
        }
        return n;
    }
    D.prototype.toString = function() {
        return "[object Promise]";
    };
    D.prototype.then = function(e, t, i) {
        var n = this;
        var r = P();
        var o = false;
        function s(t) {
            try {
                return typeof e === "function" ? e(t) : t;
            } catch (i) {
                return X(i);
            }
        }
        function l(e) {
            if (typeof t === "function") {
                C(e, n);
                try {
                    return t(e);
                } catch (i) {
                    return X(i);
                }
            }
            return X(e);
        }
        function c(e) {
            return typeof i === "function" ? i(e) : e;
        }
        a(function() {
            n.promiseDispatch(function(e) {
                if (o) {
                    return;
                }
                o = true;
                r.resolve(s(e));
            }, "when", [ function(e) {
                if (o) {
                    return;
                }
                o = true;
                r.resolve(l(e));
            } ]);
        });
        n.promiseDispatch(void 0, "when", [ void 0, function(e) {
            var t;
            var i = false;
            try {
                t = c(e);
            } catch (n) {
                i = true;
                if (T.onerror) {
                    T.onerror(n);
                } else {
                    throw n;
                }
            }
            if (!i) {
                r.notify(t);
            }
        } ]);
        return r.promise;
    };
    T.when = R;
    function R(e, t, i, n) {
        return T(e).then(t, i, n);
    }
    D.prototype.thenResolve = function(e) {
        return this.then(function() {
            return e;
        });
    };
    T.thenResolve = function(e, t) {
        return T(e).thenResolve(t);
    };
    D.prototype.thenReject = function(e) {
        return this.then(function() {
            throw e;
        });
    };
    T.thenReject = function(e, t) {
        return T(e).thenReject(t);
    };
    T.nearer = L;
    function L(e) {
        if (F(e)) {
            var t = e.inspect();
            if (t.state === "fulfilled") {
                return t.value;
            }
        }
        return e;
    }
    T.isPromise = F;
    function F(e) {
        return m(e) && typeof e.promiseDispatch === "function" && typeof e.inspect === "function";
    }
    T.isPromiseAlike = M;
    function M(e) {
        return m(e) && typeof e.then === "function";
    }
    T.isPending = N;
    function N(e) {
        return F(e) && e.inspect().state === "pending";
    }
    D.prototype.isPending = function() {
        return this.inspect().state === "pending";
    };
    T.isFulfilled = B;
    function B(e) {
        return !F(e) || e.inspect().state === "fulfilled";
    }
    D.prototype.isFulfilled = function() {
        return this.inspect().state === "fulfilled";
    };
    T.isRejected = j;
    function j(e) {
        return F(e) && e.inspect().state === "rejected";
    }
    D.prototype.isRejected = function() {
        return this.inspect().state === "rejected";
    };
    var U = [];
    var z = [];
    var q = false;
    var W = true;
    function H() {
        if (!q && typeof window !== "undefined" && window.console) {
            console.warn("[Q] Unhandled rejection reasons (should be empty):", U);
        }
        q = true;
    }
    function G() {
        for (var e = 0; e < U.length; e++) {
            var t = U[e];
            console.warn("Unhandled rejection reason:", t);
        }
    }
    function V() {
        U.length = 0;
        z.length = 0;
        q = false;
        if (!W) {
            W = true;
            if (typeof process !== "undefined" && process.on) {
                process.on("exit", G);
            }
        }
    }
    function $(e, t) {
        if (!W) {
            return;
        }
        z.push(e);
        if (t && typeof t.stack !== "undefined") {
            U.push(t.stack);
        } else {
            U.push("(no stack) " + t);
        }
        H();
    }
    function Y(e) {
        if (!W) {
            return;
        }
        var t = u(z, e);
        if (t !== -1) {
            z.splice(t, 1);
            U.splice(t, 1);
        }
    }
    T.resetUnhandledRejections = V;
    T.getUnhandledReasons = function() {
        return U.slice();
    };
    T.stopUnhandledRejectionTracking = function() {
        V();
        if (typeof process !== "undefined" && process.on) {
            process.removeListener("exit", G);
        }
        W = false;
    };
    V();
    T.reject = X;
    function X(e) {
        var t = D({
            when: function(t) {
                if (t) {
                    Y(this);
                }
                return t ? t(e) : this;
            }
        }, function i() {
            return this;
        }, function n() {
            return {
                state: "rejected",
                reason: e
            };
        });
        $(t, e);
        return t;
    }
    T.fulfill = J;
    function J(e) {
        return D({
            when: function() {
                return e;
            },
            get: function(t) {
                return e[t];
            },
            set: function(t, i) {
                e[t] = i;
            },
            "delete": function(t) {
                delete e[t];
            },
            post: function(t, i) {
                if (t === null || t === void 0) {
                    return e.apply(void 0, i);
                } else {
                    return e[t].apply(e, i);
                }
            },
            apply: function(t, i) {
                return e.apply(t, i);
            },
            keys: function() {
                return p(e);
            }
        }, void 0, function t() {
            return {
                state: "fulfilled",
                value: e
            };
        });
    }
    function K(e) {
        var t = P();
        a(function() {
            try {
                e.then(t.resolve, t.reject, t.notify);
            } catch (i) {
                t.reject(i);
            }
        });
        return t.promise;
    }
    T.master = Q;
    function Q(e) {
        return D({
            isDef: function() {}
        }, function t(i, n) {
            return rt(e, i, n);
        }, function() {
            return T(e).inspect();
        });
    }
    T.spread = Z;
    function Z(e, t, i) {
        return T(e).spread(t, i);
    }
    D.prototype.spread = function(e, t) {
        return this.all().then(function(t) {
            return e.apply(void 0, t);
        }, t);
    };
    T.async = et;
    function et(e) {
        return function() {
            function t(e, t) {
                var a;
                if (b) {
                    try {
                        a = i[e](t);
                    } catch (o) {
                        return X(o);
                    }
                    if (a.done) {
                        return a.value;
                    } else {
                        return R(a.value, n, r);
                    }
                } else {
                    try {
                        a = i[e](t);
                    } catch (o) {
                        if (v(o)) {
                            return o.value;
                        } else {
                            return X(o);
                        }
                    }
                    return R(a, n, r);
                }
            }
            var i = e.apply(this, arguments);
            var n = t.bind(t, "next");
            var r = t.bind(t, "throw");
            return n();
        };
    }
    T.spawn = tt;
    function tt(e) {
        T.done(T.async(e)());
    }
    T["return"] = it;
    function it(e) {
        throw new y(e);
    }
    T.promised = nt;
    function nt(e) {
        return function() {
            return Z([ this, at(arguments) ], function(t, i) {
                return e.apply(t, i);
            });
        };
    }
    T.dispatch = rt;
    function rt(e, t, i) {
        return T(e).dispatch(t, i);
    }
    D.prototype.dispatch = function(e, t) {
        var i = this;
        var n = P();
        a(function() {
            i.promiseDispatch(n.resolve, e, t);
        });
        return n.promise;
    };
    T.get = function(e, t) {
        return T(e).dispatch("get", [ t ]);
    };
    D.prototype.get = function(e) {
        return this.dispatch("get", [ e ]);
    };
    T.set = function(e, t, i) {
        return T(e).dispatch("set", [ t, i ]);
    };
    D.prototype.set = function(e, t) {
        return this.dispatch("set", [ e, t ]);
    };
    T.del = T["delete"] = function(e, t) {
        return T(e).dispatch("delete", [ t ]);
    };
    D.prototype.del = D.prototype["delete"] = function(e) {
        return this.dispatch("delete", [ e ]);
    };
    T.mapply = T.post = function(e, t, i) {
        return T(e).dispatch("post", [ t, i ]);
    };
    D.prototype.mapply = D.prototype.post = function(e, t) {
        return this.dispatch("post", [ e, t ]);
    };
    T.send = T.mcall = T.invoke = function(e, t) {
        return T(e).dispatch("post", [ t, l(arguments, 2) ]);
    };
    D.prototype.send = D.prototype.mcall = D.prototype.invoke = function(e) {
        return this.dispatch("post", [ e, l(arguments, 1) ]);
    };
    T.fapply = function(e, t) {
        return T(e).dispatch("apply", [ void 0, t ]);
    };
    D.prototype.fapply = function(e) {
        return this.dispatch("apply", [ void 0, e ]);
    };
    T["try"] = T.fcall = function(e) {
        return T(e).dispatch("apply", [ void 0, l(arguments, 1) ]);
    };
    D.prototype.fcall = function() {
        return this.dispatch("apply", [ void 0, l(arguments) ]);
    };
    T.fbind = function(e) {
        var t = T(e);
        var i = l(arguments, 1);
        return function n() {
            return t.dispatch("apply", [ this, i.concat(l(arguments)) ]);
        };
    };
    D.prototype.fbind = function() {
        var e = this;
        var t = l(arguments);
        return function i() {
            return e.dispatch("apply", [ this, t.concat(l(arguments)) ]);
        };
    };
    T.keys = function(e) {
        return T(e).dispatch("keys", []);
    };
    D.prototype.keys = function() {
        return this.dispatch("keys", []);
    };
    T.all = at;
    function at(e) {
        return R(e, function(e) {
            var t = 0;
            var i = P();
            c(e, function(n, r, a) {
                var o;
                if (F(r) && (o = r.inspect()).state === "fulfilled") {
                    e[a] = o.value;
                } else {
                    ++t;
                    R(r, function(n) {
                        e[a] = n;
                        if (--t === 0) {
                            i.resolve(e);
                        }
                    }, i.reject, function(e) {
                        i.notify({
                            index: a,
                            value: e
                        });
                    });
                }
            }, void 0);
            if (t === 0) {
                i.resolve(e);
            }
            return i.promise;
        });
    }
    D.prototype.all = function() {
        return at(this);
    };
    T.allResolved = E(ot, "allResolved", "allSettled");
    function ot(e) {
        return R(e, function(e) {
            e = f(e, T);
            return R(at(f(e, function(e) {
                return R(e, r, r);
            })), function() {
                return e;
            });
        });
    }
    D.prototype.allResolved = function() {
        return ot(this);
    };
    T.allSettled = st;
    function st(e) {
        return T(e).allSettled();
    }
    D.prototype.allSettled = function() {
        return this.then(function(e) {
            return at(f(e, function(e) {
                e = T(e);
                function t() {
                    return e.inspect();
                }
                return e.then(t, t);
            }));
        });
    };
    T.fail = T["catch"] = function(e, t) {
        return T(e).then(void 0, t);
    };
    D.prototype.fail = D.prototype["catch"] = function(e) {
        return this.then(void 0, e);
    };
    T.progress = lt;
    function lt(e, t) {
        return T(e).then(void 0, void 0, t);
    }
    D.prototype.progress = function(e) {
        return this.then(void 0, void 0, e);
    };
    T.fin = T["finally"] = function(e, t) {
        return T(e)["finally"](t);
    };
    D.prototype.fin = D.prototype["finally"] = function(e) {
        e = T(e);
        return this.then(function(t) {
            return e.fcall().then(function() {
                return t;
            });
        }, function(t) {
            return e.fcall().then(function() {
                throw t;
            });
        });
    };
    T.done = function(e, t, i, n) {
        return T(e).done(t, i, n);
    };
    D.prototype.done = function(e, t, i) {
        var n = function(e) {
            a(function() {
                C(e, r);
                if (T.onerror) {
                    T.onerror(e);
                } else {
                    throw e;
                }
            });
        };
        var r = e || t || i ? this.then(e, t, i) : this;
        if (typeof process === "object" && process && process.domain) {
            n = process.domain.bind(n);
        }
        r.then(void 0, n);
    };
    T.timeout = function(e, t, i) {
        return T(e).timeout(t, i);
    };
    D.prototype.timeout = function(e, t) {
        var i = P();
        var n = setTimeout(function() {
            i.reject(new Error(t || "Timed out after " + e + " ms"));
        }, e);
        this.then(function(e) {
            clearTimeout(n);
            i.resolve(e);
        }, function(e) {
            clearTimeout(n);
            i.reject(e);
        }, i.notify);
        return i.promise;
    };
    T.delay = function(e, t) {
        if (t === void 0) {
            t = e;
            e = void 0;
        }
        return T(e).delay(t);
    };
    D.prototype.delay = function(e) {
        return this.then(function(t) {
            var i = P();
            setTimeout(function() {
                i.resolve(t);
            }, e);
            return i.promise;
        });
    };
    T.nfapply = function(e, t) {
        return T(e).nfapply(t);
    };
    D.prototype.nfapply = function(e) {
        var t = P();
        var i = l(e);
        i.push(t.makeNodeResolver());
        this.fapply(i).fail(t.reject);
        return t.promise;
    };
    T.nfcall = function(e) {
        var t = l(arguments, 1);
        return T(e).nfapply(t);
    };
    D.prototype.nfcall = function() {
        var e = l(arguments);
        var t = P();
        e.push(t.makeNodeResolver());
        this.fapply(e).fail(t.reject);
        return t.promise;
    };
    T.nfbind = T.denodeify = function(e) {
        var t = l(arguments, 1);
        return function() {
            var i = t.concat(l(arguments));
            var n = P();
            i.push(n.makeNodeResolver());
            T(e).fapply(i).fail(n.reject);
            return n.promise;
        };
    };
    D.prototype.nfbind = D.prototype.denodeify = function() {
        var e = l(arguments);
        e.unshift(this);
        return T.denodeify.apply(void 0, e);
    };
    T.nbind = function(e, t) {
        var i = l(arguments, 2);
        return function() {
            var n = i.concat(l(arguments));
            var r = P();
            n.push(r.makeNodeResolver());
            function a() {
                return e.apply(t, arguments);
            }
            T(a).fapply(n).fail(r.reject);
            return r.promise;
        };
    };
    D.prototype.nbind = function() {
        var e = l(arguments, 0);
        e.unshift(this);
        return T.nbind.apply(void 0, e);
    };
    T.nmapply = T.npost = function(e, t, i) {
        return T(e).npost(t, i);
    };
    D.prototype.nmapply = D.prototype.npost = function(e, t) {
        var i = l(t || []);
        var n = P();
        i.push(n.makeNodeResolver());
        this.dispatch("post", [ e, i ]).fail(n.reject);
        return n.promise;
    };
    T.nsend = T.nmcall = T.ninvoke = function(e, t) {
        var i = l(arguments, 2);
        var n = P();
        i.push(n.makeNodeResolver());
        T(e).dispatch("post", [ t, i ]).fail(n.reject);
        return n.promise;
    };
    D.prototype.nsend = D.prototype.nmcall = D.prototype.ninvoke = function(e) {
        var t = l(arguments, 1);
        var i = P();
        t.push(i.makeNodeResolver());
        this.dispatch("post", [ e, t ]).fail(i.reject);
        return i.promise;
    };
    T.nodeify = ct;
    function ct(e, t) {
        return T(e).nodeify(t);
    }
    D.prototype.nodeify = function(e) {
        if (e) {
            this.then(function(t) {
                a(function() {
                    e(null, t);
                });
            }, function(t) {
                a(function() {
                    e(t);
                });
            });
        } else {
            return this;
        }
    };
    var ut = A();
    return T;
});

(function(e, t) {
    var Utils = function(e, n, r, a, o) {
        return {
            isChromeApplication: function() {
                return !!(window.chrome && window.chrome.app && window.chrome.app.runtime);
            },
            isURL: function(e) {
                var t = /^(ht|f)tps?:\/\/[a-z0-9-\.]+\.[a-z]{2,4}\/?([^\s<>\#%"\,\{\}\\|\\\^\[\]`]+)?$/;
                return t.test(e);
            },
            isNumber: function(e) {
                return !isNaN(parseFloat(e)) && isFinite(e);
            },
            getOriginImageUrl: function(t) {
                var i = new e();
                var n = t.url;
                if (this.isChromeApplication() && this.isURL(n)) {
                    var r = new XMLHttpRequest();
                    r.open("GET", n, true);
                    r.responseType = "blob";
                    r.onload = function(e) {
                        var t = window.webkitURL.createObjectURL(this.response);
                        i.executeCaller(t);
                    };
                    r.send();
                    return i;
                } else {
                    return i.makeSync(n);
                }
            },
            downloadAsBlob: function(e, t) {
                var i = new XMLHttpRequest();
                i.open("GET", e);
                i.responseType = "blob";
                i.onload = function() {
                    t(i.response);
                };
                i.send(null);
            },
            uuid: function(e) {
                e = e || "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx";
                return e.replace(/[xy]/g, function(e) {
                    var t = Math.random() * 16 | 0, i = e == "x" ? t : t & 3 | 8;
                    return i.toString(16);
                });
            },
            getMimeTypeExtension: function(e) {
                var t = {
                    "image/jpeg": "jpg",
                    "image/jpg": "jpg",
                    "image/png": "png",
                    "image/tiff": "tiff",
                    "image/bmp": "bmp",
                    "image/x-canon-cr2": "cr2",
                    "image/x-nikon-nef": "nef",
                    "image/x-sony-arw": "arw",
                    "image/x-adobe-dng": "dng",
                    "image/x-olympus-orf": "orf"
                };
                return t[e.toLowerCase()];
            },
            getExtensionByMimeType: function(e) {
                return this.getMimeTypeExtension(e);
            },
            getMimeTypeByExtension: function(e) {
                var t = {
                    jpg: "image/jpeg",
                    png: "image/png",
                    tiff: "image/tiff",
                    bmp: "image/bmp",
                    cr2: "image/x-canon-cr2",
                    nef: "image/x-nikon-nef",
                    arw: "image/x-sony-arw",
                    dng: "image/x-adobe-dng",
                    orf: "image/x-olympus-orf"
                };
                return t[e.toLowerCase()];
            },
            pixelsToSizeString: function(e, t) {
                var i = e * t;
                if (i < 2e6) return "<2Mpx"; else if (i < 8e6) return "2-8Mpx"; else if (i < 15e6) return "8-15Mpx"; else if (i < 2e7) return "15-20Mpx"; else if (i < 3e7) return "20-30Mpx"; else if (i < 4e7) return "30-40Mpx"; else return ">40Mpx";
            },
            bytesToSize: function(e, t) {
                var i = [ "bytes", "KB", "MB", "GB", "TB" ];
                var n = 0;
                if (e === 0) return "n/a";
                if (e < 1024) {
                    return Number(e) + " " + i[n];
                }
                while (e >= 1024) {
                    n++;
                    e = e / 1024;
                }
                return e.toPrecision(t) + " " + i[n];
            },
            getURLHash: function(e) {
                var t = location.hash.substr(1), i = t.substr(t.indexOf(e)).split("&")[0].split("=")[1];
                return parseInt(i) || 1;
            },
            updateURLParameter: function(e, t, n) {
                var r = "";
                var a = e.split("?");
                var o = a[0];
                var s = a[1];
                var l = "";
                if (s) {
                    a = s.split("&");
                    for (i = 0; i < a.length; i++) {
                        if (a[i].split("=")[0] != t) {
                            r += l + a[i];
                            l = "&";
                        }
                    }
                }
                var c = l + "" + t + "=" + n;
                return o + "?" + r + c;
            },
            max: function(e, t) {
                return e > t ? e : t;
            },
            min: function(e, t) {
                return e > t ? t : e;
            },
            getURL: function() {
                return this.isChromeApplication() ? a.config.API_BASE_URL : window.location.origin;
            },
            isStraightAngle: function(e) {
                return e === 180 || e === 0;
            },
            extend: function(e, t, i) {
                var n;
                var r = function(e) {
                    var t = [];
                    var i = t.slice;
                    i.call(arguments, 1).forEach(function(t) {
                        for (var i in t) e[i] = t[i];
                    });
                    return e;
                };
                if (t && hasOwnProperty.call(t, "constructor")) {
                    n = t.constructor;
                } else {
                    n = function() {
                        return e.apply(e, arguments);
                    };
                }
                r(n, e, i);
                var a = function() {
                    e.constructor = n;
                };
                a.prototype = e.prototype;
                n.prototype = new a();
                if (t) {
                    r(n.prototype, t);
                }
                n.__super__ = e.prototype;
                return n;
            },
            mixin: function(e) {
                var t = [];
                var i = t.slice;
                i.call(arguments, 1).forEach(function(t) {
                    for (var i in t) e[i] = t[i];
                });
                return e;
            },
            createImageDataFromRGBA: function(e, t, i) {
                var n = document.createElement("canvas"), r = n.getContext("2d"), a = r.createImageData(t, i), o = e;
                for (var s = 0; s < o.length; s++) {
                    a.data[s] = o[s];
                }
                return a;
            },
            imageDataToDataURL: function(e) {
                var t = document.createElement("canvas"), i = t.getContext("2d");
                t.width = e.width;
                t.height = e.height;
                i.putImageData(e, 0, 0);
                return t.toDataURL();
            },
            dataURItoArrayBuffer: function(e, t) {
                var i = ";base64,";
                var n = e.indexOf(i);
                e = e.substring(n + i.length);
                var r = window.atob(e);
                var a = new Uint8Array(r.length);
                for (var o = 0; o < r.length; o++) {
                    a[o] = r.charCodeAt(o);
                }
                return a.buffer;
            },
            dataURItoBlob: function(e, t) {
                var i = ";base64,";
                var n = e.indexOf(i);
                e = e.substring(n + i.length);
                var r = window.atob(e);
                var a = new Uint8Array(r.length);
                for (var o = 0; o < r.length; o++) {
                    a[o] = r.charCodeAt(o);
                }
                return new Blob([ a ], {
                    type: t
                });
            },
            getBlobFromUrl: function(e, t) {
                if (e.indexOf("data:") !== -1) {
                    var i = this.dataURItoBlob(e);
                    return o.resolve(i);
                }
                var n = o.defer();
                var r = new XMLHttpRequest();
                r.open("GET", e, true);
                if (t && t.type && t.browser === "Safari") {
                    r.overrideMimeType(t.type);
                }
                r.responseType = "blob";
                r.onload = function(t) {
                    if (this.status == 200) {
                        return n.resolve(this.response);
                    } else {
                        return n.reject(new Error("Can't load file from url " + e));
                    }
                };
                r.send();
                return n.promise;
            },
            getArrayBufferFromUrl: function(e, t) {
                if (e.indexOf("data:") !== -1) {
                    var i = this.dataURItoArrayBuffer(e);
                    return o.resolve(i);
                }
                var n = o.defer();
                var r = new XMLHttpRequest();
                r.open("GET", e, true);
                if (t && t.type && t.browser === "Safari") {
                    r.overrideMimeType(t.type);
                }
                r.responseType = "arraybuffer";
                r.onload = function(t) {
                    if (this.status == 200) {
                        var i = new Uint8Array(this.response);
                        return n.resolve(i);
                    } else {
                        return n.reject(new Error("Can't load file from url " + e));
                    }
                };
                r.send();
                return n.promise;
            },
            getImageSizeByUrl: function(e) {
                var t = o.defer();
                var i = this;
                var n = new Image();
                n.onerror = function() {
                    t.reject("Cant get image size");
                };
                n.onload = function(e) {
                    t.resolve({
                        width: e.target.width,
                        height: e.target.height
                    });
                };
                n.src = e;
                return t.promise;
            },
            resizeImage: function(e, i, n) {
                var r = o.defer();
                var a = this;
                console.log("startResizing");
                var s = function(i) {
                    var o = new Image(), s = document.createElement("canvas"), l = s.getContext("2d"), c = null;
                    o.onerror = function() {
                        console.log("onerror happened");
                        i(t, n);
                        r.resolve(t);
                    };
                    o.onload = function() {
                        console.log("onload happened");
                        var e = 1e4;
                        var t = 500;
                        var u = .5;
                        var f = {
                            width: o.width > e ? e : o.width,
                            height: o.height > e ? e : o.height,
                            orientation: 1
                        };
                        Object.merge(f, n);
                        if (!f.width) f.width = o.width;
                        if (!f.height) f.height = o.height;
                        console.log("getSize");
                        c = a.getSize(o.width, o.height, f.width, f.height, f.orientation);
                        s.width = c.canvasW;
                        s.height = c.canvasH;
                        console.log("drawWithOrientation");
                        if (c.scale > u || o.width < t || o.height < t) {
                            console.log("Image resized in one step");
                            l.drawImageWithOrientation(o, 0, 0, o.width, o.height, c.width / 2, c.height / 2, c.width, c.height, f.orientation);
                        } else {
                            console.log("Image resized in two steps");
                            var d = document.createElement("canvas"), h = d.getContext("2d");
                            d.width = o.width * .5;
                            d.height = o.height * .5;
                            h.drawImage(o, 0, 0, d.width, d.height);
                            h.drawImage(d, 0, 0, d.width * .5, d.height * .5);
                            l.drawImageWithOrientation(d, 0, 0, d.width * .5, d.height * .5, c.width * .5, c.height * .5, c.width, c.height, f.orientation);
                            d = null;
                        }
                        console.log("before toDataUrl");
                        console.time("toDataUrl");
                        var p = s.toDataURL("image/jpeg", .8);
                        console.timeEnd("toDataUrl");
                        s = null;
                        var g = a.decode_base64(p);
                        var m = {
                            url: p,
                            arraybuffer: g.buffer,
                            orientation: f.orientation
                        };
                        i && i(m, n);
                        r.resolve(m);
                    };
                    console.log("set image.url");
                    o.src = e;
                }(i);
                return r.promise;
            },
            detectType: function(e) {
                var i;
                i = e.toLowerCase();
                if (i.match(/jpg/) || i.match(/jpeg/)) {
                    i = "image/jpeg";
                } else if (i.match(/png/)) {
                    i = "image/png";
                } else if (i.match(/bmp/)) {
                    i = "image/bmp";
                } else if (i.match(/cr2/)) {
                    i = "image/x-canon-cr2";
                } else if (i.match(/nef/)) {
                    i = "image/x-nikon-nef";
                } else if (i.match(/arw/)) {
                    i = "image/x-sony-arw";
                } else if (i.match(/dng/)) {
                    i = "image/x-adobe-dng";
                } else if (i.match(/orf/)) {
                    i = "image/x-olympus-orf";
                } else if (i.match(/mp4/)) {
                    i = "video/mp4";
                } else if (i.match(/avi/) || i.match(/msvideo$/)) {
                    i = "video/x-msvideo";
                } else if (i.match(/webm/)) {
                    i = "video/webm";
                } else if (i.match(/mov/) || i.match(/quicktime$/)) {
                    i = "video/quicktime";
                } else if (i.match(/mpe?g/)) {
                    i = "video/mpeg";
                } else if (i.match(/wmv$/)) {
                    i = "video/x-ms-wmv";
                } else if (i.match(/flv$/)) {
                    i = "video/flv";
                } else if (i.match(/mts$/) || i.match(/m2ts$/)) {
                    i = "video/m2ts";
                } else if (i.match(/3gp?p$/)) {
                    i = "video/3gpp";
                } else if (i.match(/raf$/)) {
                    i = "image/x-fuji-raf";
                } else if (i.match(/gif$/)) {
                    i = "image/gif";
                } else if (i.match(/psd$/) || i.match(/photoshop$/)) {
                    i = "image/x-photoshop";
                } else if (i.match(/pdf$/)) {
                    i = "application/pdf";
                } else if (i.match(/postscript$/)) {
                    i = "application/postscript";
                } else if (i.match(/tiff$/) || i.match(/tif$/)) {
                    i = "image/tiff";
                } else if (i.match(/rw2$/)) {
                    i = "image/x-panasonic-rw2";
                } else if (i.match(/mp3$/)) {
                    i = "audio/mpeg";
                } else if (i.match(/wav$/)) {
                    i = "audio/wav";
                } else if (i.match(/svg/)) {
                    i = "image/svg+xml";
                } else if (i.match(/ttf$/)) {
                    i = "application/x-font-ttf";
                } else if (i.match(/txt/)) {
                    i = "text/plain";
                } else if (i.match(/docx/)) {
                    i = "application/vnd.openxmlformats-officedocument.wordprocessingml.document";
                } else if (i.match(/xlsx/)) {
                    i = "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";
                } else {
                    i = t;
                }
                return i;
            },
            getType: function(e) {
                if (e.get) {
                    console.log("ERROR: Model passed to static method.");
                    e = e.toJSON();
                }
                var i = e.mimeType;
                if (!i || i === "application/octet-stream" || i === "image/tiff") i = t;
                var n = i || e.fileExtension || e.name;
                return this.detectType(n);
            },
            isValidEmailAddress: function(e) {
                var t = new RegExp(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i);
                return t.test(e);
            },
            isNewVersionAvailable: function() {
                return $.cookie("picsio.version") !== $.cookie("picsio.userVersion");
            },
            clone: function s(e) {
                if (e == null || typeof e != "object") return e;
                var t = e.constructor();
                for (var i in e) t[i] = s(e[i]);
                return t;
            },
            float32ToClamped8Array: function(e) {
                var t = Math.pow(2, 8) - 1;
                var i = e.data;
                var n = i.length;
                var r = new Uint8ClampedArray(n);
                while (n--) {
                    r[n] = i[n] * t;
                }
                return {
                    width: e.width,
                    height: e.height,
                    data: r
                };
            },
            float32ToClamped8ArraySlices: function(e) {
                var t = [];
                for (var i = 0; i < e.length; i++) {
                    t[i] = this.float32ToClamped8Array(e[i]);
                }
                return t;
            },
            fromClampedArray8ToFloatArray32: function(e) {
                var t = Math.pow(2, 8) - 1;
                var i = e.length;
                var n = new Float32Array(i);
                while (i--) {
                    n[i] = e[i] / t;
                }
                return n;
            },
            getSize: function(e, t, i, n, r) {
                var a, o, s, l, c, u, f, d, h, p = {};
                var r = r || 1;
                if (r === 4 || r === 5 || r === 6 || r === 7 || r === 8) {
                    d = s = t;
                    h = l = e;
                } else {
                    d = s = e;
                    h = l = t;
                }
                c = i / s;
                u = n / l;
                f = this.min(c, u);
                if (f < 1) {
                    a = e * f;
                    o = t * f;
                    s = s * f;
                    l = l * f;
                } else {
                    a = e;
                    o = t;
                }
                if (r === 4 || r === 5 || r === 6 || r === 7 || r === 8) {
                    p.top = Math.round((i - s) / 2) > 10 ? Math.round((i - s) / 2) : 0;
                    p.left = Math.round((n - l) / 2) > 10 ? Math.round((n - l) / 2) : 0;
                } else {
                    p.left = Math.round((i - s) / 2) > 10 ? Math.round((i - s) / 2) : 0;
                    p.top = Math.round((n - l) / 2) > 10 ? Math.round((n - l) / 2) : 0;
                }
                return {
                    width: Math.round(a),
                    height: Math.round(o),
                    scale: f,
                    canvasW: Math.round(s),
                    canvasH: Math.round(l),
                    rotateWidth: d,
                    rotateHeight: h,
                    offset: p
                };
            },
            bytesToSize: function(e) {
                if (e == 0) return "0 Byte";
                var t = 1e3;
                var i = [ "Bytes", "KB", "MB", "GB", "TB", "PB", "EB", "ZB", "YB" ];
                var n = Math.floor(Math.log(e) / Math.log(t));
                return (e / Math.pow(t, n)).toPrecision(3) + " " + i[n];
            },
            gcd: function(e, t) {
                if (t > e) {
                    temp = e;
                    e = t;
                    t = temp;
                }
                while (t != 0) {
                    m = e % t;
                    e = t;
                    t = m;
                }
                return e;
            },
            getAspectRatio: function(e, t) {
                c = this.gcd(e, t);
                return {
                    x: e / c,
                    y: t / c
                };
            },
            getAspectSize: function(e, t, i) {
                if (i.x / i.y < e / t) {
                    var n = t;
                    var r = Math.floor(t * i.x / i.y);
                } else {
                    var n = Math.floor(e * i.y / i.x);
                    var r = e;
                }
                return {
                    x: r,
                    y: n,
                    paddingY: (t - n) / 2,
                    paddingX: (e - r) / 2
                };
            },
            max: function(e, t) {
                return e > t ? e : t;
            },
            min: function(e, t) {
                return e > t ? t : e;
            },
            cloneCanvas: function(e) {
                var t = document.createElement("canvas");
                var i = t.getContext("2d");
                t.width = e.width;
                t.height = e.height;
                i.drawImage(e, 0, 0);
                return t;
            },
            deepCopy: function(e, t) {
                var i, n, r = typeof e, a = 0, o, s;
                t = t || [];
                if (e === null) {
                    return e;
                }
                if (r === "object" || r === "function") {
                    for (a = 0, o = t.length; a < o; a++) {
                        s = t[a];
                        if (s[0] === e) {
                            n = s[1];
                            break;
                        }
                    }
                    if (n) {
                        return n;
                    } else {
                        if (r === "object") {
                            i = new e.constructor();
                        } else {
                            i = e;
                        }
                        t.push([ e, i ]);
                        for (key in e) {
                            if (e.hasOwnProperty(key)) {
                                i[key] = this.deepCopy(e[key], t);
                            }
                        }
                    }
                }
                return i || e;
            },
            sliceToImageData: function(e) {
                var t = document.createElement("canvas"), i = t.getContext("2d");
                var n = i.createImageData(e.width, e.height);
                n.data.set(e.data);
                return n;
            },
            slicesListToImageData: function(e) {
                var t = document.createElement("canvas"), i = t.getContext("2d"), n = 0, r = 0, a = 0;
                for (var o = 0; o < e.length; o++) {
                    a += e[o].height;
                }
                r = e[0].width;
                t.width = r;
                t.height = a;
                for (var o = 0; o < e.length; o++) {
                    var s = this.sliceToImageData(e[o]);
                    i.putImageData(s, 0, n);
                    n += s.height;
                }
                return i.getImageData(0, 0, r, a);
            },
            slicesListF32ToImageData: function(e) {
                e = this.float32ToClamped8ArraySlices(e);
                return this.slicesListToImageData(e);
            },
            slicesListToFloat32Array: function(e) {
                var t = 0;
                var i = e.length;
                var n = 0;
                for (var r = 0; r < i; r++) {
                    t += e[r].width * e[r].height * 4;
                }
                var a = new Float32Array(t);
                for (var r = 0; r < i; r++) {
                    var o = e[r];
                    a.set(o.data, n);
                    n += o.width * o.height * 4;
                }
                return a;
            },
            cloneSlices: function(e) {
                var t = {
                    width: e.width,
                    height: e.height,
                    slices: []
                };
                var i = 0, n = 0;
                for (var r = 0; r < e.slices.length; r++) {
                    var a = e.slices[r];
                    var o = new Uint8ClampedArray(a.data.length);
                    o.set(a.data);
                    t.slices.push({
                        data: o,
                        width: a.width,
                        height: a.height
                    });
                    n += a.height;
                }
                i = e.slices[0].width;
                if (!t.width || !t.height) {
                    t.width = i;
                    t.height = n;
                }
                return t;
            },
            generateBlackImage: function(e, t) {
                var i = document.createElement("canvas"), n = i.getContext("2d");
                i.width = e;
                i.height = t;
                return i.toDataURL();
            },
            shiftCFALeft: function l() {
                var e = this.cfa[0];
                var t = this.cfa[2];
                this.cfa[0] = this.cfa[1];
                this.cfa[2] = this.cfa[3];
                this.cfa[1] = e;
                this.cfa[3] = t;
            },
            shiftCFADown: function u() {
                var e = this.cfa[0];
                var t = this.cfa[1];
                this.cfa[0] = this.cfa[2];
                this.cfa[1] = this.cfa[3];
                this.cfa[2] = e;
                this.cfa[3] = t;
            },
            formatDate: function(e) {
                if (e !== "N/A") {
                    var t = e.split(" ")[0].split(":"), i = t[0], n = t[1], r = t[2], a = [ "january", "february", "march", "april", "may", "june", "july", "august", "september", "october", "november", "december" ];
                    e = a[n - 1] + " " + r + ", " + i;
                }
                return e;
            },
            formatDateCreateAt: function(e) {
                if (!e) return "N/A";
                e = e.substring(0, 10);
                var t = e.split("-"), i = t[0], n = t[1], r = t[2];
                return r + "." + n + "." + i;
            },
            decode_base64: function(e) {
                var t = new Uint8Array([ 62, -1, -1, -1, 63, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, -1, -1, -1, 0, -1, -1, -1, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, -1, -1, -1, -1, -1, -1, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51 ]), i = e.length, n = new Uint8Array(i / 4 * 3 | 0), r = 0, a = 0, o = [ 0, 0 ], s = 0, l = 0, c, u, f, d = e.indexOf(","), e = e.substring(d + 1);
                while (i--) {
                    u = e.charCodeAt(r++);
                    c = t[u - 43];
                    if (c !== 255 && c !== f) {
                        o[1] = o[0];
                        o[0] = u;
                        l = l << 6 | c;
                        s++;
                        if (s === 4) {
                            n[a++] = l >>> 16;
                            if (o[1] !== 61) {
                                n[a++] = l >>> 8;
                            }
                            if (o[0] !== 61) {
                                n[a++] = l;
                            }
                            s = 0;
                        }
                    }
                }
                return n;
            },
            setCookie: function(e, t) {
                document.cookie = e + " = " + t + "; path=/;";
            },
            getCookie: function(e) {
                var t = document.cookie.split("; ").find(function(t) {
                    return t.split("=")[0] === e;
                });
                if (!t) return null;
                var i = t.split("=")[1];
                if (i === "true") return true;
                if (i === "false") return false;
                return i;
            },
            randomBool: function() {
                return Math.random() < .5;
            },
            randomIntBetween: function(e, t) {
                return Math.floor(Math.random() * (t - e + 1)) + e;
            }
        };
    };
    if (typeof define === "function") {
        define("utils", [ "Deferred", "jqueryCookie", "extensions", "environment", "q" ], function(e, t, i, n, r) {
            return new Utils(e, t, i, n, r);
        });
    } else {
        if (typeof e.Utils === "undefined") {
            e.Utils = new Utils();
        }
    }
})(this);

(function() {
    var e = true, t = null, i = false;
    function n(e) {
        return function() {
            return e;
        };
    }
    var r = Object, a = Array, o = RegExp, s = Date, l = String, c = Number, u = Math, f = r.prototype.toString, d = typeof global !== "undefined" ? global : this, h = {}, p = r.defineProperty && r.defineProperties, g = "Array,Boolean,Date,Function,Number,String,RegExp".split(","), m = _(g[0]), v = _(g[1]), y = _(g[2]), b = _(g[3]), w = _(g[4]), C = _(g[5]), x = _(g[6]);
    function _(t) {
        var i, n;
        if (/String|Number|Boolean/.test(t)) i = t.toLowerCase();
        n = t === "Array" && a.isArray || function(n) {
            if (i && typeof n === i) return e;
            return f.call(n) === "[object " + t + "]";
        };
        return h[t] = n;
    }
    function S(e) {
        if (!e.SugarMethods) {
            P(e, "SugarMethods", {});
            k(e, i, i, {
                extend: function(t, n, r) {
                    k(e, r !== i, n, t);
                },
                sugarRestore: function() {
                    return E(e, arguments, function(e, t, i) {
                        P(e, t, i.method);
                    });
                },
                sugarRevert: function() {
                    return E(e, arguments, function(e, t, i) {
                        if (i.qa) P(e, t, i.Ba); else delete e[t];
                    });
                }
            });
        }
    }
    function k(e, t, n, r) {
        var a = t ? e.prototype : e;
        S(e);
        B(r, function(r, o) {
            var s = a[r], l = N(a, r);
            if (typeof n === "function") o = T(a[r], o, n);
            if (n !== i || !a[r]) P(a, r, o);
            e.SugarMethods[r] = {
                xa: t,
                method: o,
                Ba: s,
                qa: l
            };
        });
    }
    function A(e, t, i, n, r) {
        var a = {};
        n = C(n) ? n.split(",") : n;
        n.forEach(function(e, t) {
            r(a, e, t);
        });
        k(e, t, i, a);
    }
    function E(t, n, r) {
        var a = n.length === 0, o = I(n), s = i;
        B(t.SugarMethods, function(i, n) {
            if (a || o.indexOf(i) > -1) {
                s = e;
                r(n.xa ? t.prototype : t, i, n);
            }
        });
        return s;
    }
    function T(t, i, n) {
        return function() {
            return (t && (n === e || !n.apply(this, arguments)) ? t : i).apply(this, arguments);
        };
    }
    function P(t, n, a) {
        if (p) r.defineProperty(t, n, {
            value: a,
            configurable: e,
            enumerable: i,
            writable: e
        }); else t[n] = a;
    }
    function I(e, t) {
        var i = [], n, r;
        n = 0;
        for (r = e.length; n < r; n++) {
            i.push(e[n]);
            t && t.call(e, e[n], n);
        }
        return i;
    }
    function O(e, t, i) {
        I(a.prototype.concat.apply([], a.prototype.slice.call(e, i || 0)), t);
    }
    function D(e) {
        if (!e || !e.call) throw new TypeError("Callback is not callable");
    }
    function R(e) {
        return e !== void 0;
    }
    function L(e) {
        return e === void 0;
    }
    function F(e) {
        return e && typeof e === "object";
    }
    function M(e) {
        return !!e && f.call(e) === "[object Object]" && "hasOwnProperty" in e;
    }
    function N(e, t) {
        return r.hasOwnProperty.call(e, t);
    }
    function B(e, t) {
        for (var n in e) if (N(e, n)) if (t.call(e, n, e[n], e) === i) break;
    }
    function j(e, t) {
        B(t, function(i) {
            e[i] = t[i];
        });
        return e;
    }
    function U(e) {
        j(this, e);
    }
    U.prototype.constructor = r;
    function z(e, t, i, n) {
        var r = [];
        e = parseInt(e);
        for (var a = n < 0; !a && e <= t || a && e >= t; ) {
            r.push(e);
            i && i.call(this, e);
            e += n || 1;
        }
        return r;
    }
    function q(e, t, i) {
        i = u[i || "round"];
        var n = u.pow(10, u.abs(t || 0));
        if (t < 0) n = 1 / n;
        return i(e * n) / n;
    }
    function W(e, t) {
        return q(e, t, "floor");
    }
    function H(e, t, i, n) {
        n = u.abs(e).toString(n || 10);
        n = $(t - n.replace(/\.\d+/, "").length, "0") + n;
        if (i || e < 0) n = (e < 0 ? "-" : "+") + n;
        return n;
    }
    function G(e) {
        if (e >= 11 && e <= 13) return "th"; else switch (e % 10) {
          case 1:
            return "st";

          case 2:
            return "nd";

          case 3:
            return "rd";

          default:
            return "th";
        }
    }
    function V() {
        return "	\n\f\r   \u2028\u2029";
    }
    function $(e, t) {
        return a(u.max(0, R(e) ? e : 1) + 1).join(t || "");
    }
    function Y(e, t) {
        var i = e.toString().match(/[^/]*$/)[0];
        if (t) i = (i + t).split("").sort().join("").replace(/([gimy])\1+/g, "$1");
        return i;
    }
    function X(e) {
        C(e) || (e = l(e));
        return e.replace(/([\\/'*+?|()\[\]{}.^$])/g, "\\$1");
    }
    function J(e, i) {
        var n = typeof e, a, o, s, c, u, d, h;
        if (n === "string") return e;
        s = f.call(e);
        a = M(e);
        o = s === "[object Array]";
        if (e != t && a || o) {
            i || (i = []);
            if (i.length > 1) for (d = i.length; d--; ) if (i[d] === e) return "CYC";
            i.push(e);
            a = l(e.constructor);
            c = o ? e : r.keys(e).sort();
            d = 0;
            for (h = c.length; d < h; d++) {
                u = o ? d : c[d];
                a += u + J(e[u], i);
            }
            i.pop();
        } else a = 1 / e === -Infinity ? "-0" : l(e && e.valueOf ? e.valueOf() : e);
        return n + s + a;
    }
    function K(e) {
        return /^\[object Date|Array|String|Number|RegExp|Boolean|Arguments\]$/.test(f.call(e)) || M(e);
    }
    function Q(e, t, n) {
        var r = [], a = e.length, o = t[t.length - 1] !== i, s;
        I(t, function(t) {
            if (v(t)) return i;
            if (o) {
                t %= a;
                if (t < 0) t = a + t;
            }
            s = n ? e.charAt(t) || "" : e[t];
            r.push(s);
        });
        return r.length < 2 ? r[0] : r;
    }
    function Z(n, a) {
        A(a, e, i, n, function(e, i) {
            e[i + (i === "equal" ? "s" : "")] = function() {
                return r[i].apply(t, [ this ].concat(I(arguments)));
            };
        });
    }
    S(r);
    B(g, function(e, t) {
        S(d[t]);
    });
    k(r, i, i, {
        keys: function(e) {
            var t = [];
            if (!F(e) && !x(e) && !b(e)) throw new TypeError("Object required");
            B(e, function(e) {
                t.push(e);
            });
            return t;
        }
    });
    function et(e, t, i, n) {
        var r = e.length, a = n == -1, o = a ? r - 1 : 0;
        i = isNaN(i) ? o : parseInt(i >> 0);
        if (i < 0) i = r + i;
        if (!a && i < 0 || a && i >= r) i = o;
        for (;a && i >= 0 || !a && i < r; ) {
            if (e[i] === t) return i;
            i += n;
        }
        return -1;
    }
    function tt(e, t, i, n) {
        var r = e.length, a = 0, o = R(i);
        D(t);
        if (r == 0 && !o) throw new TypeError("Reduce called on empty array with no initial value"); else if (o) i = i; else {
            i = e[n ? r - 1 : a];
            a++;
        }
        for (;a < r; ) {
            o = n ? r - a - 1 : a;
            if (o in e) i = t(i, e[o], o, e);
            a++;
        }
        return i;
    }
    function it(e) {
        if (e.length === 0) throw new TypeError("First argument must be defined");
    }
    k(a, i, i, {
        isArray: function(e) {
            return m(e);
        }
    });
    k(a, e, i, {
        every: function(t, n) {
            var r = this.length, a = 0;
            for (it(arguments); a < r; ) {
                if (a in this && !t.call(n, this[a], a, this)) return i;
                a++;
            }
            return e;
        },
        some: function(t, n) {
            var r = this.length, a = 0;
            for (it(arguments); a < r; ) {
                if (a in this && t.call(n, this[a], a, this)) return e;
                a++;
            }
            return i;
        },
        map: function(e, t) {
            var i = this.length, n = 0, r = Array(i);
            for (it(arguments); n < i; ) {
                if (n in this) r[n] = e.call(t, this[n], n, this);
                n++;
            }
            return r;
        },
        filter: function(e, t) {
            var i = this.length, n = 0, r = [];
            for (it(arguments); n < i; ) {
                n in this && e.call(t, this[n], n, this) && r.push(this[n]);
                n++;
            }
            return r;
        },
        indexOf: function(e, t) {
            if (C(this)) return this.indexOf(e, t);
            return et(this, e, t, 1);
        },
        lastIndexOf: function(e, t) {
            if (C(this)) return this.lastIndexOf(e, t);
            return et(this, e, t, -1);
        },
        forEach: function(e, t) {
            var i = this.length, n = 0;
            for (D(e); n < i; ) {
                n in this && e.call(t, this[n], n, this);
                n++;
            }
        },
        reduce: function(e, t) {
            return tt(this, e, t);
        },
        reduceRight: function(t, i) {
            return tt(this, t, i, e);
        }
    });
    k(Function, e, i, {
        bind: function(e) {
            var t = this, i = I(arguments).slice(1), n;
            if (!b(this)) throw new TypeError("Function.prototype.bind called on a non-function");
            n = function() {
                return t.apply(t.prototype && this instanceof t ? this : e, i.concat(I(arguments)));
            };
            n.prototype = this.prototype;
            return n;
        }
    });
    k(s, i, i, {
        now: function() {
            return new s().getTime();
        }
    });
    (function() {
        var t = V().match(/^\s+$/);
        try {
            l.prototype.trim.call([ 1 ]);
        } catch (n) {
            t = i;
        }
        k(l, e, !t, {
            trim: function() {
                return this.toString().trimLeft().trimRight();
            },
            trimLeft: function() {
                return this.replace(o("^[" + V() + "]+"), "");
            },
            trimRight: function() {
                return this.replace(o("[" + V() + "]+$"), "");
            }
        });
    })();
    (function() {
        var t = new s(s.UTC(1999, 11, 31));
        t = t.toISOString && t.toISOString() === "1999-12-31T00:00:00.000Z";
        A(s, e, !t, "toISOString,toJSON", function(e, t) {
            e[t] = function() {
                return H(this.getUTCFullYear(), 4) + "-" + H(this.getUTCMonth() + 1, 2) + "-" + H(this.getUTCDate(), 2) + "T" + H(this.getUTCHours(), 2) + ":" + H(this.getUTCMinutes(), 2) + ":" + H(this.getUTCSeconds(), 2) + "." + H(this.getUTCMilliseconds(), 3) + "Z";
            };
        });
    })();
    function nt(t, n, r, a) {
        var s = e;
        if (t === n) return e; else if (x(n) && C(t)) return o(n).test(t); else if (b(n)) return n.apply(r, a); else if (M(n) && F(t)) {
            B(n, function(e) {
                nt(t[e], n[e], r, [ t[e], t ]) || (s = i);
            });
            return s;
        } else return K(t) && K(n) ? J(t) === J(n) : t === n;
    }
    function rt(e, t, i, n) {
        return L(t) ? e : b(t) ? t.apply(i, n || []) : b(e[t]) ? e[t].call(e) : e[t];
    }
    function at(t, n, r, a) {
        var o, s;
        if (r < 0) r = t.length + r;
        s = isNaN(r) ? 0 : r;
        for (r = a === e ? t.length + s : t.length; s < r; ) {
            o = s % t.length;
            if (o in t) {
                if (n.call(t, t[o], o, t) === i) break;
            } else return ot(t, n, s, a);
            s++;
        }
    }
    function ot(e, t, i) {
        var n = [], r;
        for (r in e) r in e && r >>> 0 == r && r != 4294967295 && r >= i && n.push(parseInt(r));
        n.sort().each(function(i) {
            return t.call(e, e[i], i, e);
        });
        return e;
    }
    function st(e, t, n, r, a) {
        var o, s;
        at(e, function(e, n, r) {
            if (nt(e, t, r, [ e, n, r ])) {
                o = e;
                s = n;
                return i;
            }
        }, n, r);
        return a ? s : o;
    }
    function lt(e, t) {
        var i = [], n = {}, r;
        at(e, function(a, o) {
            r = t ? rt(a, t, e, [ a, o, e ]) : a;
            ht(n, r) || i.push(a);
        });
        return i;
    }
    function ct(e, t, i) {
        var n = [], r = {};
        t.each(function(e) {
            ht(r, e);
        });
        e.each(function(e) {
            var t = J(e), a = !K(e);
            if (dt(r, t, e, a) != i) {
                var o = 0;
                if (a) for (t = r[t]; o < t.length; ) if (t[o] === e) t.splice(o, 1); else o += 1; else delete r[t];
                n.push(e);
            }
        });
        return n;
    }
    function ut(e, t, i) {
        t = t || Infinity;
        i = i || 0;
        var n = [];
        at(e, function(e) {
            if (m(e) && i < t) n = n.concat(ut(e, t, i + 1)); else n.push(e);
        });
        return n;
    }
    function ft(e) {
        var t = [];
        I(e, function(e) {
            t = t.concat(e);
        });
        return t;
    }
    function dt(e, t, i, n) {
        var r = t in e;
        if (n) {
            e[t] || (e[t] = []);
            r = e[t].indexOf(i) !== -1;
        }
        return r;
    }
    function ht(e, t) {
        var i = J(t), n = !K(t), r = dt(e, i, t, n);
        if (n) e[i].push(t); else e[i] = t;
        return r;
    }
    function pt(e, t, i, n) {
        var r, a = [], o = i === "max", s = i === "min", l = Array.isArray(e);
        B(e, function(i) {
            var n = e[i];
            i = rt(n, t, e, l ? [ n, parseInt(i), e ] : []);
            if (L(i)) throw new TypeError("Cannot compare with undefined");
            if (i === r) a.push(n); else if (L(r) || o && i > r || s && i < r) {
                a = [ n ];
                r = i;
            }
        });
        l || (a = ut(a, 1));
        return n ? a : a[0];
    }
    function gt(e) {
        if (a[wt]) e = e.toLowerCase();
        return e.replace(a[bt], "");
    }
    function mt(e, t) {
        var i = e.charAt(t);
        return (a[Ct] || {})[i] || i;
    }
    function vt(e) {
        var i = a[yt];
        return e ? i.indexOf(e) : t;
    }
    var yt = "AlphanumericSortOrder", bt = "AlphanumericSortIgnore", wt = "AlphanumericSortIgnoreCase", Ct = "AlphanumericSortEquivalents";
    k(a, i, i, {
        create: function() {
            var e = [], t;
            I(arguments, function(i) {
                if (F(i)) try {
                    t = a.prototype.slice.call(i, 0);
                    if (t.length > 0) i = t;
                } catch (n) {}
                e = e.concat(i);
            });
            return e;
        }
    });
    k(a, e, i, {
        find: function(e, t, i) {
            return st(this, e, t, i);
        },
        findAll: function(e, t, i) {
            var n = [];
            at(this, function(t, i, r) {
                nt(t, e, r, [ t, i, r ]) && n.push(t);
            }, t, i);
            return n;
        },
        findIndex: function(t, i, n) {
            t = st(this, t, i, n, e);
            return L(t) ? -1 : t;
        },
        count: function(e) {
            if (L(e)) return this.length;
            return this.findAll(e).length;
        },
        removeAt: function(e, t) {
            var i, n;
            if (L(e)) return this;
            if (L(t)) t = e;
            i = 0;
            for (n = t - e; i <= n; i++) this.splice(e, 1);
            return this;
        },
        include: function(e, t) {
            return this.clone().add(e, t);
        },
        exclude: function() {
            return a.prototype.remove.apply(this.clone(), arguments);
        },
        clone: function() {
            return j([], this);
        },
        unique: function(e) {
            return lt(this, e);
        },
        flatten: function(e) {
            return ut(this, e);
        },
        union: function() {
            return lt(this.concat(ft(arguments)));
        },
        intersect: function() {
            return ct(this, ft(arguments), i);
        },
        subtract: function() {
            return ct(this, ft(arguments), e);
        },
        at: function() {
            return Q(this, arguments);
        },
        first: function(e) {
            if (L(e)) return this[0];
            if (e < 0) e = 0;
            return this.slice(0, e);
        },
        last: function(e) {
            if (L(e)) return this[this.length - 1];
            return this.slice(this.length - e < 0 ? 0 : this.length - e);
        },
        from: function(e) {
            return this.slice(e);
        },
        to: function(e) {
            if (L(e)) e = this.length;
            return this.slice(0, e);
        },
        min: function(e, t) {
            return pt(this, e, "min", t);
        },
        max: function(e, t) {
            return pt(this, e, "max", t);
        },
        least: function(e, t) {
            return pt(this.groupBy.apply(this, [ e ]), "length", "min", t);
        },
        most: function(e, t) {
            return pt(this.groupBy.apply(this, [ e ]), "length", "max", t);
        },
        sum: function(e) {
            e = e ? this.map(e) : this;
            return e.length > 0 ? e.reduce(function(e, t) {
                return e + t;
            }) : 0;
        },
        average: function(e) {
            e = e ? this.map(e) : this;
            return e.length > 0 ? e.sum() / e.length : 0;
        },
        inGroups: function(e, t) {
            var i = arguments.length > 1, n = this, r = [], a = q(this.length / e, void 0, "ceil");
            z(0, e - 1, function(e) {
                e = e * a;
                var o = n.slice(e, e + a);
                i && o.length < a && z(1, a - o.length, function() {
                    o = o.add(t);
                });
                r.push(o);
            });
            return r;
        },
        inGroupsOf: function(e, i) {
            var n = [], r = this.length, a = this, o;
            if (r === 0 || e === 0) return a;
            if (L(e)) e = 1;
            if (L(i)) i = t;
            z(0, q(r / e, void 0, "ceil") - 1, function(t) {
                for (o = a.slice(e * t, e * t + e); o.length < e; ) o.push(i);
                n.push(o);
            });
            return n;
        },
        isEmpty: function() {
            return this.compact().length == 0;
        },
        sortBy: function(e, i) {
            var n = this.clone();
            n.sort(function(r, a) {
                var o, s;
                o = rt(r, e, n, [ r ]);
                s = rt(a, e, n, [ a ]);
                if (C(o) && C(s)) {
                    o = o;
                    s = s;
                    var l, c, u, f, d = 0, h = 0;
                    o = gt(o);
                    s = gt(s);
                    do {
                        u = mt(o, d);
                        f = mt(s, d);
                        l = vt(u);
                        c = vt(f);
                        if (l === -1 || c === -1) {
                            l = o.charCodeAt(d) || t;
                            c = s.charCodeAt(d) || t;
                        }
                        u = u !== o.charAt(d);
                        f = f !== s.charAt(d);
                        if (u !== f && h === 0) h = u - f;
                        d += 1;
                    } while (l != t && c != t && l === c);
                    o = l === c ? h : l < c ? -1 : 1;
                } else o = o < s ? -1 : o > s ? 1 : 0;
                return o * (i ? -1 : 1);
            });
            return n;
        },
        randomize: function() {
            for (var e = this.concat(), t = e.length, i, n; t; ) {
                i = u.random() * t | 0;
                n = e[--t];
                e[t] = e[i];
                e[i] = n;
            }
            return e;
        },
        zip: function() {
            var e = I(arguments);
            return this.map(function(i, n) {
                return [ i ].concat(e.map(function(e) {
                    return n in e ? e[n] : t;
                }));
            });
        },
        sample: function(e) {
            var t = this.randomize();
            return arguments.length > 0 ? t.slice(0, e) : t[0];
        },
        each: function(e, t, i) {
            at(this, e, t, i);
            return this;
        },
        add: function(e, t) {
            if (!w(c(t)) || isNaN(t)) t = this.length;
            a.prototype.splice.apply(this, [ t, 0 ].concat(e));
            return this;
        },
        remove: function() {
            var e, t = this;
            I(arguments, function(i) {
                for (e = 0; e < t.length; ) if (nt(t[e], i, t, [ t[e], e, t ])) t.splice(e, 1); else e++;
            });
            return t;
        },
        compact: function(e) {
            var i = [];
            at(this, function(n) {
                if (m(n)) i.push(n.compact()); else if (e && n) i.push(n); else !e && n != t && n.valueOf() === n.valueOf() && i.push(n);
            });
            return i;
        },
        groupBy: function(e, t) {
            var i = this, n = {}, r;
            at(i, function(t, a) {
                r = rt(t, e, i, [ t, a, i ]);
                n[r] || (n[r] = []);
                n[r].push(t);
            });
            t && B(n, t);
            return n;
        },
        none: function() {
            return !this.any.apply(this, arguments);
        }
    });
    k(a, e, i, {
        all: a.prototype.every,
        any: a.prototype.some,
        insert: a.prototype.add
    });
    function xt(e) {
        if (e && e.valueOf) e = e.valueOf();
        return r.keys(e);
    }
    function _t(e, t) {
        A(r, i, i, e, function(e, i) {
            e[i] = function(e, n, r) {
                var o = xt(e);
                r = a.prototype[i].call(o, function(i) {
                    return t ? rt(e[i], n, e, [ i, e[i], e ]) : nt(e[i], n, e, [ i, e[i], e ]);
                }, r);
                if (m(r)) r = r.reduce(function(t, i) {
                    t[i] = e[i];
                    return t;
                }, {});
                return r;
            };
        });
        Z(e, U);
    }
    k(r, i, i, {
        map: function(e, t) {
            return xt(e).reduce(function(i, n) {
                i[n] = rt(e[n], t, e, [ n, e[n], e ]);
                return i;
            }, {});
        },
        reduce: function(e) {
            var t = xt(e).map(function(t) {
                return e[t];
            });
            return t.reduce.apply(t, I(arguments).slice(1));
        },
        each: function(e, t) {
            D(t);
            B(e, t);
            return e;
        },
        size: function(e) {
            return xt(e).length;
        }
    });
    var St = "any,all,none,count,find,findAll,isEmpty".split(","), kt = "sum,average,min,max,least,most".split(","), At = "map,reduce,size".split(","), Et = St.concat(kt).concat(At);
    (function() {
        A(a, e, function() {
            var e = arguments;
            return e.length > 0 && !b(e[0]);
        }, "map,every,all,some,any,none,filter", function(e, t) {
            e[t] = function(e) {
                return this[t](function(i, n) {
                    return t === "map" ? rt(i, e, this, [ i, n, this ]) : nt(i, e, this, [ i, n, this ]);
                });
            };
        });
    })();
    (function() {
        a[yt] = "ABCDEFGHIJKLMNOPQRS TUVWXYZ".split("").map(function(e) {
            return e + e.toLowerCase();
        }).join("");
        var t = {};
        at("A,C,E,I,O,S,U".split(","), function(e) {
            var i = e.charAt(0);
            at(e.slice(1).split(""), function(e) {
                t[e] = i;
                t[e.toLowerCase()] = i.toLowerCase();
            });
        });
        a[wt] = e;
        a[Ct] = t;
    })();
    _t(St);
    _t(kt, e);
    Z(At, U);
    var Tt, Pt, It = [ "ampm", "hour", "minute", "second", "ampm", "utc", "offset_sign", "offset_hours", "offset_minutes", "ampm" ], Ot = "({t})?\\s*(\\d{1,2}(?:[,.]\\d+)?)(?:{h}([0-5]\\d(?:[,.]\\d+)?)?{m}(?::?([0-5]\\d(?:[,.]\\d+)?){s})?\\s*(?:({t})|(Z)|(?:([+-])(\\d{2,2})(?::?(\\d{2,2}))?)?)?|\\s*({t}))", Dt = {}, Rt, Lt, Ft, Mt = [], Nt = [ {
        ba: "f{1,4}|ms|milliseconds",
        format: function(e) {
            return ri(e, "Milliseconds");
        }
    }, {
        ba: "ss?|seconds",
        format: function(e) {
            return ri(e, "Seconds");
        }
    }, {
        ba: "mm?|minutes",
        format: function(e) {
            return ri(e, "Minutes");
        }
    }, {
        ba: "hh?|hours|12hr",
        format: function(e) {
            e = ri(e, "Hours");
            return e === 0 ? 12 : e - W(e / 13) * 12;
        }
    }, {
        ba: "HH?|24hr",
        format: function(e) {
            return ri(e, "Hours");
        }
    }, {
        ba: "dd?|date|day",
        format: function(e) {
            return ri(e, "Date");
        }
    }, {
        ba: "dow|weekday",
        la: e,
        format: function(e, t, i) {
            e = ri(e, "Day");
            return t.weekdays[e + (i - 1) * 7];
        }
    }, {
        ba: "MM?",
        format: function(e) {
            return ri(e, "Month") + 1;
        }
    }, {
        ba: "mon|month",
        la: e,
        format: function(e, t, i) {
            e = ri(e, "Month");
            return t.months[e + (i - 1) * 12];
        }
    }, {
        ba: "y{2,4}|year",
        format: function(e) {
            return ri(e, "FullYear");
        }
    }, {
        ba: "[Tt]{1,2}",
        format: function(e, t, i, n) {
            if (t.ampm.length == 0) return "";
            e = ri(e, "Hours");
            t = t.ampm[W(e / 12)];
            if (n.length === 1) t = t.slice(0, 1);
            if (n.slice(0, 1) === "T") t = t.toUpperCase();
            return t;
        }
    }, {
        ba: "z{1,4}|tz|timezone",
        text: e,
        format: function(e, t, i, n) {
            e = e.getUTCOffset();
            if (n == "z" || n == "zz") e = e.replace(/(\d{2})(\d{2})/, function(e, t) {
                return H(t, n.length);
            });
            return e;
        }
    }, {
        ba: "iso(tz|timezone)",
        format: function(t) {
            return t.getUTCOffset(e);
        }
    }, {
        ba: "ord",
        format: function(e) {
            e = ri(e, "Date");
            return e + G(e);
        }
    } ], Bt = [ {
        $: "year",
        method: "FullYear",
        ja: e,
        da: function(e) {
            return (365 + (e ? e.isLeapYear() ? 1 : 0 : .25)) * 24 * 60 * 60 * 1e3;
        }
    }, {
        $: "month",
        method: "Month",
        ja: e,
        da: function(e, t) {
            var i = 30.4375, n;
            if (e) {
                n = e.daysInMonth();
                if (t <= n.days()) i = n;
            }
            return i * 24 * 60 * 60 * 1e3;
        },
        error: .919
    }, {
        $: "week",
        method: "ISOWeek",
        da: n(6048e5)
    }, {
        $: "day",
        method: "Date",
        ja: e,
        da: n(864e5)
    }, {
        $: "hour",
        method: "Hours",
        da: n(36e5)
    }, {
        $: "minute",
        method: "Minutes",
        da: n(6e4)
    }, {
        $: "second",
        method: "Seconds",
        da: n(1e3)
    }, {
        $: "millisecond",
        method: "Milliseconds",
        da: n(1)
    } ], jt = {};
    function Ut(e) {
        j(this, e);
        this.ga = Mt.concat();
    }
    Ut.prototype = {
        getMonth: function(e) {
            return w(e) ? e - 1 : this.months.indexOf(e) % 12;
        },
        getWeekday: function(e) {
            return this.weekdays.indexOf(e) % 7;
        },
        oa: function(e) {
            var t;
            return w(e) ? e : e && (t = this.numbers.indexOf(e)) !== -1 ? (t + 1) % 10 : 1;
        },
        ua: function(e) {
            var t = this;
            return e.replace(o(this.num, "g"), function(e) {
                return t.oa(e) || "";
            });
        },
        sa: function(e) {
            return Tt.units[this.units.indexOf(e) % 8];
        },
        va: function(e) {
            return this.na(e, e[2] > 0 ? "future" : "past");
        },
        ra: function(e) {
            return this.na(Qt(e), "duration");
        },
        wa: function(t) {
            t = t || this.code;
            return t === "en" || t === "en-US" ? e : this.variant;
        },
        za: function(e) {
            return e === this.ampm[0];
        },
        Aa: function(e) {
            return e && e === this.ampm[1];
        },
        na: function(e, t) {
            var i, n, r = e[0], a = e[1], o = e[2], s = this[t] || this.relative;
            if (b(s)) return s.call(this, r, a, o, t);
            n = this.units[(this.plural && r > 1 ? 1 : 0) * 8 + a] || this.units[a];
            if (this.capitalizeUnit) n = Ht(n);
            i = this.modifiers.filter(function(e) {
                return e.name == "sign" && e.value == (o > 0 ? 1 : -1);
            })[0];
            return s.replace(/\{(.*?)\}/g, function(e, t) {
                switch (t) {
                  case "num":
                    return r;

                  case "unit":
                    return n;

                  case "sign":
                    return i.src;
                }
            });
        },
        ta: function() {
            return this.ma ? [ this.ma ].concat(this.ga) : this.ga;
        },
        addFormat: function(e, t, i, n, r) {
            var a = i || [], o = this, s;
            e = e.replace(/\s+/g, "[-,. ]*");
            e = e.replace(/\{([^,]+?)\}/g, function(e, t) {
                var n, r, s, l = t.match(/\?$/);
                s = t.match(/^(\d+)\??$/);
                var c = t.match(/(\d)(?:-(\d))?/), u = t.replace(/[^a-z]+$/, "");
                if (s) n = o.tokens[s[1]]; else if (o[u]) n = o[u]; else if (o[u + "s"]) {
                    n = o[u + "s"];
                    if (c) {
                        r = [];
                        n.forEach(function(e, t) {
                            var i = t % (o.units ? 8 : n.length);
                            if (i >= c[1] && i <= (c[2] || c[1])) r.push(e);
                        });
                        n = r;
                    }
                    n = Gt(n);
                }
                if (s) s = "(?:" + n + ")"; else {
                    i || a.push(u);
                    s = "(" + n + ")";
                }
                if (l) s += "?";
                return s;
            });
            if (t) {
                t = oi(Ot, o, r);
                r = [ "t", "[\\s\\u3000]" ].concat(o.timeMarker);
                s = e.match(/\\d\{\d,\d\}\)+\??$/);
                Wt(o, "(?:" + t + ")[,\\s\\u3000]+?" + e, It.concat(a), n);
                Wt(o, e + "(?:[,\\s]*(?:" + r.join("|") + (s ? "+" : "*") + ")" + t + ")?", a.concat(It), n);
            } else Wt(o, e, a, n);
        }
    };
    function zt(e, t) {
        var n;
        C(e) || (e = "");
        n = jt[e] || jt[e.slice(0, 2)];
        if (t === i && !n) throw Error("Invalid locale.");
        return n || Pt;
    }
    function qt(t, n) {
        function r(e) {
            var t = c[e];
            if (C(t)) c[e] = t.split(","); else t || (c[e] = []);
        }
        function a(e, t) {
            e = e.split("+").map(function(e) {
                return e.replace(/(.+):(.+)$/, function(e, t, i) {
                    return i.split("|").map(function(e) {
                        return t + e;
                    }).join("|");
                });
            }).join("|");
            return e.split("|").forEach(t);
        }
        function o(e, t, i) {
            var n = [];
            c[e].forEach(function(e, r) {
                if (t) e += "+" + e.slice(0, 3);
                a(e, function(e, t) {
                    n[t * i + r] = e.toLowerCase();
                });
            });
            c[e] = n;
        }
        function s(e, t, i) {
            e = "\\d{" + e + "," + t + "}";
            if (i) e += "|(?:" + Gt(c.numbers) + ")+";
            return e;
        }
        function l(e, t) {
            c[e] = c[e] || t;
        }
        var c, u;
        c = new Ut(n);
        r("modifiers");
        "months,weekdays,units,numbers,articles,tokens,timeMarker,ampm,timeSuffixes,dateParse,timeParse".split(",").forEach(r);
        u = !c.monthSuffix;
        o("months", u, 12);
        o("weekdays", u, 7);
        o("units", i, 8);
        o("numbers", i, 10);
        l("code", t);
        l("date", s(1, 2, c.digitDate));
        l("year", "'\\d{2}|" + s(4, 4));
        l("num", function() {
            var e = [ "\\d+" ].concat(c.articles);
            if (c.numbers) e = e.concat(c.numbers);
            return Gt(e);
        }());
        (function() {
            var e = [];
            c.ha = {};
            c.modifiers.push({
                name: "day",
                src: "yesterday",
                value: -1
            });
            c.modifiers.push({
                name: "day",
                src: "today",
                value: 0
            });
            c.modifiers.push({
                name: "day",
                src: "tomorrow",
                value: 1
            });
            c.modifiers.forEach(function(t) {
                var i = t.name;
                a(t.src, function(n) {
                    var r = c[i];
                    c.ha[n] = t;
                    e.push({
                        name: i,
                        src: n,
                        value: t.value
                    });
                    c[i] = r ? r + "|" + n : n;
                });
            });
            c.day += "|" + Gt(c.weekdays);
            c.modifiers = e;
        })();
        if (c.monthSuffix) {
            c.month = s(1, 2);
            c.months = z(1, 12).map(function(e) {
                return e + c.monthSuffix;
            });
        }
        c.full_month = s(1, 2) + "|" + Gt(c.months);
        c.timeSuffixes.length > 0 && c.addFormat(oi(Ot, c), i, It);
        c.addFormat("{day}", e);
        c.addFormat("{month}" + (c.monthSuffix || ""));
        c.addFormat("{year}" + (c.yearSuffix || ""));
        c.timeParse.forEach(function(t) {
            c.addFormat(t, e);
        });
        c.dateParse.forEach(function(e) {
            c.addFormat(e);
        });
        return jt[t] = c;
    }
    function Wt(e, t, i, n) {
        e.ga.unshift({
            Da: n,
            ya: e,
            Ca: o("^" + t + "$", "i"),
            to: i
        });
    }
    function Ht(e) {
        return e.slice(0, 1).toUpperCase() + e.slice(1);
    }
    function Gt(e) {
        return e.filter(function(e) {
            return !!e;
        }).join("|");
    }
    function Vt(e, t) {
        var i;
        if (M(e[0])) return e; else if (w(e[0]) && !w(e[1])) return [ e[0] ]; else if (C(e[0]) && t) return [ $t(e[0]), e[1] ];
        i = {};
        Lt.forEach(function(t, n) {
            i[t.$] = e[n];
        });
        return [ i ];
    }
    function $t(e, t) {
        var i = {};
        if (match = e.match(/^(\d+)?\s?(\w+?)s?$/i)) {
            if (L(t)) t = parseInt(match[1]) || 1;
            i[match[2].toLowerCase()] = t;
        }
        return i;
    }
    function Yt(e, t) {
        var i = {}, n, r;
        t.forEach(function(t, a) {
            n = e[a + 1];
            if (!(L(n) || n === "")) {
                if (t === "year") i.Ea = n.replace(/'/, "");
                r = parseFloat(n.replace(/'/, "").replace(/,/, "."));
                i[t] = !isNaN(r) ? r : n.toLowerCase();
            }
        });
        return i;
    }
    function Xt(e) {
        e = e.trim().replace(/^just (?=now)|\.+$/i, "");
        return Jt(e);
    }
    function Jt(e) {
        return e.replace(Rt, function(e, t, n) {
            var r = 0, a = 1, o, s;
            if (t) return e;
            n.split("").reverse().forEach(function(e) {
                e = Dt[e];
                var t = e > 9;
                if (t) {
                    if (o) r += a;
                    a *= e / (s || 1);
                    s = e;
                } else {
                    if (o === i) a *= 10;
                    r += a * e;
                }
                o = t;
            });
            if (o) r += a;
            return r;
        });
    }
    function Kt(t, n, r, a) {
        var o = new s(), l = i, c, u, f, d, h, p, g, m, v;
        o.utc(a);
        if (y(t)) o.utc(t.isUTC()).setTime(t.getTime()); else if (w(t)) o.setTime(t); else if (M(t)) {
            o.set(t, e);
            d = t;
        } else if (C(t)) {
            c = zt(n);
            t = Xt(t);
            c && B(c.ta(), function(r, a) {
                var y = t.match(a.Ca);
                if (y) {
                    f = a;
                    u = f.ya;
                    d = Yt(y, f.to, u);
                    d.utc && o.utc();
                    u.ma = f;
                    if (d.timestamp) {
                        d = d.timestamp;
                        return i;
                    }
                    if (f.Da && !C(d.month) && (C(d.date) || c.wa(n))) {
                        m = d.month;
                        d.month = d.date;
                        d.date = m;
                    }
                    if (d.year && d.Ea.length === 2) d.year = q(ri(new s(), "FullYear") / 100) * 100 - q(d.year / 100) * 100 + d.year;
                    if (d.month) {
                        d.month = u.getMonth(d.month);
                        if (d.shift && !d.unit) d.unit = u.units[7];
                    }
                    if (d.weekday && d.date) delete d.weekday; else if (d.weekday) {
                        d.weekday = u.getWeekday(d.weekday);
                        if (d.shift && !d.unit) d.unit = u.units[5];
                    }
                    if (d.day && (m = u.ha[d.day])) {
                        d.day = m.value;
                        o.reset();
                        l = e;
                    } else if (d.day && (p = u.getWeekday(d.day)) > -1) {
                        delete d.day;
                        if (d.num && d.month) {
                            v = function() {
                                var e = o.getWeekday();
                                o.setWeekday(7 * (d.num - 1) + (e > p ? p + 7 : p));
                            };
                            d.day = 1;
                        } else d.weekday = p;
                    }
                    if (d.date && !w(d.date)) d.date = u.ua(d.date);
                    if (u.Aa(d.ampm) && d.hour < 12) d.hour += 12; else if (u.za(d.ampm) && d.hour === 12) d.hour = 0;
                    if ("offset_hours" in d || "offset_minutes" in d) {
                        o.utc();
                        d.offset_minutes = d.offset_minutes || 0;
                        d.offset_minutes += d.offset_hours * 60;
                        if (d.offset_sign === "-") d.offset_minutes *= -1;
                        d.minute -= d.offset_minutes;
                    }
                    if (d.unit) {
                        l = e;
                        g = u.oa(d.num);
                        h = u.sa(d.unit);
                        if (d.shift || d.edge) {
                            g *= (m = u.ha[d.shift]) ? m.value : 0;
                            if (h === "month" && R(d.date)) {
                                o.set({
                                    day: d.date
                                }, e);
                                delete d.date;
                            }
                            if (h === "year" && R(d.month)) {
                                o.set({
                                    month: d.month,
                                    day: d.date
                                }, e);
                                delete d.month;
                                delete d.date;
                            }
                        }
                        if (d.sign && (m = u.ha[d.sign])) g *= m.value;
                        if (R(d.weekday)) {
                            o.set({
                                weekday: d.weekday
                            }, e);
                            delete d.weekday;
                        }
                        d[h] = (d[h] || 0) + g;
                    }
                    if (d.year_sign === "-") d.year *= -1;
                    Ft.slice(1, 4).forEach(function(e, t) {
                        var i = d[e.$], n = i % 1;
                        if (n) {
                            d[Ft[t].$] = q(n * (e.$ === "second" ? 1e3 : 60));
                            d[e.$] = W(i);
                        }
                    });
                    return i;
                }
            });
            if (f) if (l) o.advance(d); else {
                o._utc && o.reset();
                ni(o, d, e, i, r);
            } else {
                if (t !== "now") o = new s(t);
                a && o.addMinutes(-o.getTimezoneOffset());
            }
            if (d && d.edge) {
                m = u.ha[d.edge];
                B(Ft.slice(4), function(e, t) {
                    if (R(d[t.$])) {
                        h = t.$;
                        return i;
                    }
                });
                if (h === "year") d.fa = "month"; else if (h === "month" || h === "week") d.fa = "day";
                o[(m.value < 0 ? "endOf" : "beginningOf") + Ht(h)]();
                m.value === -2 && o.reset();
            }
            v && v();
            o.utc(i);
        }
        return {
            ea: o,
            set: d
        };
    }
    function Qt(e) {
        var t, i = u.abs(e), n = i, r = 0;
        Ft.slice(1).forEach(function(e, a) {
            t = W(q(i / e.da() * 10) / 10);
            if (t >= 1) {
                n = t;
                r = a + 1;
            }
        });
        return [ n, r, e ];
    }
    function Zt(e) {
        var t = Qt(e.millisecondsFromNow());
        if (t[1] === 6) t[0] = u.abs(e.monthsFromNow());
        return t;
    }
    function ei(e, t, i, n) {
        var r, a = zt(n), s = o(/^[A-Z]/);
        if (e.isValid()) if (Date[t]) t = Date[t]; else {
            if (b(t)) {
                r = Zt(e);
                t = t.apply(e, r.concat(a));
            }
        } else return "Invalid Date";
        if (!t && i) {
            r = r || Zt(e);
            if (r[1] === 0) {
                r[1] = 1;
                r[0] = 1;
            }
            return a.va(r);
        }
        t = t || "long";
        t = a[t] || t;
        Nt.forEach(function(i) {
            t = t.replace(o("\\{(" + i.ba + ")(\\d)?\\}", i.la ? "i" : ""), function(t, n, r) {
                t = i.format(e, a, r || 1, n);
                r = n.length;
                var o = n.match(/^(.)\1+$/);
                if (i.la) {
                    if (r === 3) t = t.slice(0, 3);
                    if (o || n.match(s)) t = Ht(t);
                } else if (o && !i.text) t = (w(t) ? H(t, r) : t.toString()).slice(-r);
                return t;
            });
        });
        return t;
    }
    function ti(n, r, a, o) {
        var s, l, c, u = 0, f = 0, d = 0;
        s = Kt(r, t, t, o);
        if (a > 0) {
            f = d = a;
            l = e;
        }
        if (!s.ea.isValid()) return i;
        if (s.set && s.set.fa) {
            Bt.forEach(function(e) {
                if (e.$ === s.set.fa) u = e.da(s.ea, n - s.ea) - 1;
            });
            r = Ht(s.set.fa);
            if (s.set.edge || s.set.shift) s.ea["beginningOf" + r]();
            if (s.set.fa === "month") c = s.ea.clone()["endOf" + r]().getTime();
            if (!l && s.set.sign && s.set.fa != "millisecond") {
                f = 50;
                d = -50;
            }
        }
        l = n.getTime();
        r = s.ea.getTime();
        c = c || r + u;
        c = ii(n, r, c);
        return l >= r - f && l <= c + d;
    }
    function ii(e, t, i) {
        t = new Date(t);
        e = new Date(i).utc(e.isUTC());
        if (ri(e, "Hours") !== 23) {
            t = t.getTimezoneOffset();
            e = e.getTimezoneOffset();
            if (t !== e) i += (e - t).minutes();
        }
        return i;
    }
    function ni(e, t, n, r, a) {
        function o(e) {
            return R(t[e]) ? t[e] : t[e + "s"];
        }
        function l(e) {
            return R(o(e));
        }
        var c, u;
        if (w(t) && r) t = {
            milliseconds: t
        }; else if (w(t)) {
            e.setTime(t);
            return e;
        }
        if (R(t.date)) t.day = t.date;
        B(Ft, function(r, a) {
            var o = a.$ === "day";
            if (l(a.$) || o && l("weekday")) {
                t.fa = a.$;
                u = +r;
                return i;
            } else if (n && a.$ !== "week" && (!o || !l("week"))) ai(e, a.method, o ? 1 : 0);
        });
        Bt.forEach(function(i) {
            var n = i.$;
            i = i.method;
            var a;
            a = o(n);
            if (!L(a)) {
                if (r) {
                    if (n === "week") {
                        a = (t.day || 0) + a * 7;
                        i = "Date";
                    }
                    a = a * r + ri(e, i);
                } else n === "month" && l("day") && ai(e, "Date", 15);
                ai(e, i, a);
                if (r && n === "month") {
                    n = a;
                    if (n < 0) n = n % 12 + 12;
                    n % 12 != ri(e, "Month") && ai(e, "Date", 0);
                }
            }
        });
        if (!r && !l("day") && l("weekday")) {
            c = o("weekday");
            e.setWeekday(c);
        }
        (function() {
            var t = new s();
            return a === -1 && e > t || a === 1 && e < t;
        })() && B(Ft.slice(u + 1), function(t, n) {
            if ((n.ja || n.$ === "week" && l("weekday")) && !(l(n.$) || n.$ === "day" && l("weekday"))) {
                e[n.ia](a);
                return i;
            }
        });
        return e;
    }
    function ri(e, t) {
        return e["get" + (e._utc ? "UTC" : "") + t]();
    }
    function ai(e, t, i) {
        return e["set" + (e._utc && t != "ISOWeek" ? "UTC" : "") + t](i);
    }
    function oi(e, t, i) {
        var n = {
            h: 0,
            m: 1,
            s: 2
        }, r;
        t = t || Tt;
        return e.replace(/{([a-z])}/g, function(e, a) {
            var o = [], s = a === "h", l = s && !i;
            if (a === "t") return t.ampm.join("|"); else {
                s && o.push(":");
                if (r = t.timeSuffixes[n[a]]) o.push(r + "\\s*");
                return o.length === 0 ? "" : "(?:" + o.join("|") + ")" + (l ? "" : "?");
            }
        });
    }
    function si(e, t, i) {
        var n, r;
        if (w(e[1])) n = Vt(e)[0]; else {
            n = e[0];
            r = e[1];
        }
        return Kt(n, r, t, i).ea;
    }
    s.extend({
        create: function() {
            return si(arguments);
        },
        past: function() {
            return si(arguments, -1);
        },
        future: function() {
            return si(arguments, 1);
        },
        addLocale: function(e, t) {
            return qt(e, t);
        },
        setLocale: function(e) {
            var t = zt(e, i);
            Pt = t;
            if (e && e != t.code) t.code = e;
            return t;
        },
        getLocale: function(e) {
            return !e ? Pt : zt(e, i);
        },
        addFormat: function(e, t, i) {
            Wt(zt(i), e, t);
        }
    }, i, i);
    s.extend({
        set: function() {
            var e = Vt(arguments);
            return ni(this, e[0], e[1]);
        },
        setWeekday: function(e) {
            if (!L(e)) return ai(this, "Date", ri(this, "Date") + e - ri(this, "Day"));
        },
        setISOWeek: function(e) {
            var t = ri(this, "Day") || 7;
            if (!L(e)) {
                this.set({
                    month: 0,
                    date: 4
                });
                this.set({
                    weekday: 1
                });
                e > 1 && this.addWeeks(e - 1);
                t !== 1 && this.advance({
                    days: t - 1
                });
                return this.getTime();
            }
        },
        getISOWeek: function() {
            var e = this;
            e = e.clone();
            var t = ri(e, "Day") || 7;
            e.addDays(4 - t).reset();
            return 1 + W(e.daysSince(e.clone().beginningOfYear()) / 7);
        },
        getUTCOffset: function(t) {
            var i = this._utc ? 0 : this.getTimezoneOffset(), n = t === e ? ":" : "";
            if (!i && t) return "Z";
            return H(W(-i / 60), 2, e) + n + H(u.abs(i % 60), 2);
        },
        utc: function(t) {
            P(this, "_utc", t === e || arguments.length === 0);
            return this;
        },
        isUTC: function() {
            return !!this._utc || this.getTimezoneOffset() === 0;
        },
        advance: function() {
            var t = Vt(arguments, e);
            return ni(this, t[0], t[1], 1);
        },
        rewind: function() {
            var t = Vt(arguments, e);
            return ni(this, t[0], t[1], -1);
        },
        isValid: function() {
            return !isNaN(this.getTime());
        },
        isAfter: function(e, t) {
            return this.getTime() > s.create(e).getTime() - (t || 0);
        },
        isBefore: function(e, t) {
            return this.getTime() < s.create(e).getTime() + (t || 0);
        },
        isBetween: function(e, t, i) {
            var n = this.getTime();
            e = s.create(e).getTime();
            var r = s.create(t).getTime();
            t = u.min(e, r);
            e = u.max(e, r);
            i = i || 0;
            return t - i < n && e + i > n;
        },
        isLeapYear: function() {
            var e = ri(this, "FullYear");
            return e % 4 === 0 && e % 100 !== 0 || e % 400 === 0;
        },
        daysInMonth: function() {
            return 32 - ri(new s(ri(this, "FullYear"), ri(this, "Month"), 32), "Date");
        },
        format: function(e, t) {
            return ei(this, e, i, t);
        },
        relative: function(i, n) {
            if (C(i)) {
                n = i;
                i = t;
            }
            return ei(this, i, e, n);
        },
        is: function(t, i, n) {
            var r, a;
            if (this.isValid()) {
                if (C(t)) {
                    t = t.trim().toLowerCase();
                    a = this.clone().utc(n);
                    switch (e) {
                      case t === "future":
                        return this.getTime() > new s().getTime();

                      case t === "past":
                        return this.getTime() < new s().getTime();

                      case t === "weekday":
                        return ri(a, "Day") > 0 && ri(a, "Day") < 6;

                      case t === "weekend":
                        return ri(a, "Day") === 0 || ri(a, "Day") === 6;

                      case (r = Tt.weekdays.indexOf(t) % 7) > -1:
                        return ri(a, "Day") === r;

                      case (r = Tt.months.indexOf(t) % 12) > -1:
                        return ri(a, "Month") === r;
                    }
                }
                return ti(this, t, i, n);
            }
        },
        reset: function(t) {
            var i = {}, n;
            t = t || "hours";
            if (t === "date") t = "days";
            n = Bt.some(function(e) {
                return t === e.$ || t === e.$ + "s";
            });
            i[t] = t.match(/^days?/) ? 1 : 0;
            return n ? this.set(i, e) : this;
        },
        clone: function() {
            var e = new s(this.getTime());
            e.utc(!!this._utc);
            return e;
        }
    });
    s.extend({
        iso: function() {
            return this.toISOString();
        },
        getWeekday: s.prototype.getDay,
        getUTCWeekday: s.prototype.getUTCDay
    });
    function li(e, t) {
        function i() {
            return q(this * t);
        }
        function n() {
            return si(arguments)[e.ia](this);
        }
        function r() {
            return si(arguments)[e.ia](-this);
        }
        var a = e.$, o = {};
        o[a] = i;
        o[a + "s"] = i;
        o[a + "Before"] = r;
        o[a + "sBefore"] = r;
        o[a + "Ago"] = r;
        o[a + "sAgo"] = r;
        o[a + "After"] = n;
        o[a + "sAfter"] = n;
        o[a + "FromNow"] = n;
        o[a + "sFromNow"] = n;
        c.extend(o);
    }
    c.extend({
        duration: function(e) {
            return zt(e).ra(this);
        }
    });
    Tt = Pt = s.addLocale("en", {
        plural: e,
        timeMarker: "at",
        ampm: "am,pm",
        months: "January,February,March,April,May,June,July,August,September,October,November,December",
        weekdays: "Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday",
        units: "millisecond:|s,second:|s,minute:|s,hour:|s,day:|s,week:|s,month:|s,year:|s",
        numbers: "one,two,three,four,five,six,seven,eight,nine,ten",
        articles: "a,an,the",
        tokens: "the,st|nd|rd|th,of",
        "short": "{Month} {d}, {yyyy}",
        "long": "{Month} {d}, {yyyy} {h}:{mm}{tt}",
        full: "{Weekday} {Month} {d}, {yyyy} {h}:{mm}:{ss}{tt}",
        past: "{num} {unit} {sign}",
        future: "{num} {unit} {sign}",
        duration: "{num} {unit}",
        modifiers: [ {
            name: "sign",
            src: "ago|before",
            value: -1
        }, {
            name: "sign",
            src: "from now|after|from|in|later",
            value: 1
        }, {
            name: "edge",
            src: "last day",
            value: -2
        }, {
            name: "edge",
            src: "end",
            value: -1
        }, {
            name: "edge",
            src: "first day|beginning",
            value: 1
        }, {
            name: "shift",
            src: "last",
            value: -1
        }, {
            name: "shift",
            src: "the|this",
            value: 0
        }, {
            name: "shift",
            src: "next",
            value: 1
        } ],
        dateParse: [ "{num} {unit} {sign}", "{sign} {num} {unit}", "{month} {year}", "{shift} {unit=5-7}", "{0?} {date}{1}", "{0?} {edge} of {shift?} {unit=4-7?}{month?}{year?}" ],
        timeParse: [ "{0} {num}{1} {day} of {month} {year?}", "{weekday?} {month} {date}{1?} {year?}", "{date} {month} {year}", "{date} {month}", "{shift} {weekday}", "{shift} week {weekday}", "{weekday} {2?} {shift} week", "{num} {unit=4-5} {sign} {day}", "{0?} {date}{1} of {month}", "{0?}{month?} {date?}{1?} of {shift} {unit=6-7}" ]
    });
    Ft = Bt.concat().reverse();
    Lt = Bt.concat();
    Lt.splice(2, 1);
    A(s, e, i, Bt, function(t, i, n) {
        function r(e) {
            e = e / l;
            var t = e % 1, n = i.error || .999;
            if (t && u.abs(t % 1) > n) e = q(e);
            return parseInt(e);
        }
        var a = i.$, o = Ht(a), l = i.da(), c, f;
        i.ia = "add" + o + "s";
        c = function(e, t) {
            return r(this.getTime() - s.create(e, t).getTime());
        };
        f = function(e, t) {
            return r(s.create(e, t).getTime() - this.getTime());
        };
        t[a + "sAgo"] = f;
        t[a + "sUntil"] = f;
        t[a + "sSince"] = c;
        t[a + "sFromNow"] = c;
        t[i.ia] = function(e, t) {
            var i = {};
            i[a] = e;
            return this.advance(i, t);
        };
        li(i, l);
        n < 3 && [ "Last", "This", "Next" ].forEach(function(e) {
            t["is" + e + o] = function() {
                return this.is(e + " " + a);
            };
        });
        if (n < 4) {
            t["beginningOf" + o] = function() {
                var t = {};
                switch (a) {
                  case "year":
                    t.year = ri(this, "FullYear");
                    break;

                  case "month":
                    t.month = ri(this, "Month");
                    break;

                  case "day":
                    t.day = ri(this, "Date");
                    break;

                  case "week":
                    t.weekday = 0;
                }
                return this.set(t, e);
            };
            t["endOf" + o] = function() {
                var t = {
                    hours: 23,
                    minutes: 59,
                    seconds: 59,
                    milliseconds: 999
                };
                switch (a) {
                  case "year":
                    t.month = 11;
                    t.day = 31;
                    break;

                  case "month":
                    t.day = this.daysInMonth();
                    break;

                  case "week":
                    t.weekday = 6;
                }
                return this.set(t, e);
            };
        }
    });
    Tt.addFormat("([+-])?(\\d{4,4})[-.]?{full_month}[-.]?(\\d{1,2})?", e, [ "year_sign", "year", "month", "date" ], i, e);
    Tt.addFormat("(\\d{1,2})[-.\\/]{full_month}(?:[-.\\/](\\d{2,4}))?", e, [ "date", "month", "year" ], e);
    Tt.addFormat("{full_month}[-.](\\d{4,4})", i, [ "month", "year" ]);
    Tt.addFormat("\\/Date\\((\\d+(?:\\+\\d{4,4})?)\\)\\/", i, [ "timestamp" ]);
    Tt.addFormat(oi(Ot, Tt), i, It);
    Mt = Tt.ga.slice(0, 7).reverse();
    Tt.ga = Tt.ga.slice(7).concat(Mt);
    A(s, e, i, "short,long,full", function(e, t) {
        e[t] = function(e) {
            return ei(this, t, i, e);
        };
    });
    "".split("").forEach(function(e, t) {
        if (t > 9) t = u.pow(10, t - 9);
        Dt[e] = t;
    });
    "".split("").forEach(function(e, t) {
        Dt[e] = t;
    });
    Rt = o("([])?([]+)(?!)", "g");
    (function() {
        var t = "today,yesterday,tomorrow,weekday,weekend,future,past".split(","), n = Tt.weekdays.slice(0, 7), r = Tt.months.slice(0, 12);
        A(s, e, i, t.concat(n).concat(r), function(e, t) {
            e["is" + Ht(t)] = function(e) {
                return this.is(t, 0, e);
            };
        });
    })();
    (function() {
        s.extend({
            utc: {
                create: function() {
                    return si(arguments, 0, e);
                },
                past: function() {
                    return si(arguments, -1, e);
                },
                future: function() {
                    return si(arguments, 1, e);
                }
            }
        }, i, i);
    })();
    s.extend({
        RFC1123: "{Dow}, {dd} {Mon} {yyyy} {HH}:{mm}:{ss} {tz}",
        RFC1036: "{Weekday}, {dd}-{Mon}-{yy} {HH}:{mm}:{ss} {tz}",
        ISO8601_DATE: "{yyyy}-{MM}-{dd}",
        ISO8601_DATETIME: "{yyyy}-{MM}-{dd}T{HH}:{mm}:{ss}.{fff}{isotz}"
    }, i, i);
    DateRange = function(e, t) {
        this.start = s.create(e);
        this.end = s.create(t);
    };
    DateRange.prototype.toString = function() {
        return this.isValid() ? this.start.full() + ".." + this.end.full() : "Invalid DateRange";
    };
    k(DateRange, e, i, {
        isValid: function() {
            return this.start < this.end;
        },
        duration: function() {
            return this.isValid() ? this.end.getTime() - this.start.getTime() : NaN;
        },
        contains: function(e) {
            var t = this;
            return (e.start && e.end ? [ e.start, e.end ] : [ e ]).every(function(e) {
                return e >= t.start && e <= t.end;
            });
        },
        every: function(t, i) {
            var n = this.start.clone(), r = [], a = 0, o, s;
            if (C(t)) {
                n.advance($t(t, 0), e);
                o = $t(t);
                s = t.toLowerCase() === "day";
            } else o = {
                milliseconds: t
            };
            for (;n <= this.end; ) {
                r.push(n);
                i && i(n, a);
                if (s && ri(n, "Hours") === 23) {
                    n = n.clone();
                    ai(n, "Hours", 48);
                } else n = n.clone().advance(o, e);
                a++;
            }
            return r;
        },
        union: function(e) {
            return new DateRange(this.start < e.start ? this.start : e.start, this.end > e.end ? this.end : e.end);
        },
        intersect: function(e) {
            return new DateRange(this.start > e.start ? this.start : e.start, this.end < e.end ? this.end : e.end);
        },
        clone: function() {
            return new DateRange(this.start, this.end);
        }
    });
    A(DateRange, e, i, "Millisecond,Second,Minute,Hour,Day,Week,Month,Year", function(e, t) {
        e["each" + t] = function(e) {
            return this.every(t, e);
        };
    });
    k(s, i, i, {
        range: function(e, t) {
            return new DateRange(e, t);
        }
    });
    function ci(e, t, i, n, r) {
        var a;
        if (t !== Infinity) {
            if (!e.timers) e.timers = [];
            w(t) || (t = 0);
            e.timers.push(setTimeout(function() {
                e.timers.splice(a, 1);
                i.apply(n, r || []);
            }, t));
            a = e.timers.length;
        }
    }
    k(Function, e, i, {
        lazy: function(t, n) {
            function r() {
                if (!s || o.length < n - 1) {
                    o.push([ this, arguments ]);
                    l();
                }
                return d;
            }
            var a = this, o = [], s = i, l, c, f, d;
            t = t || 1;
            n = n || Infinity;
            c = q(t, void 0, "ceil");
            f = q(c / t) || 1;
            l = function() {
                if (!(s || o.length == 0)) {
                    for (var t = u.max(o.length - f, 0); o.length > t; ) d = Function.prototype.apply.apply(a, o.shift());
                    ci(r, c, function() {
                        s = i;
                        l();
                    });
                    s = e;
                }
            };
            return r;
        },
        delay: function(e) {
            var t = I(arguments).slice(1);
            ci(this, e, this, this, t);
            return this;
        },
        throttle: function(e) {
            return this.lazy(e, 1);
        },
        debounce: function(e) {
            function t() {
                t.cancel();
                ci(t, e, i, this, arguments);
            }
            var i = this;
            return t;
        },
        cancel: function() {
            if (m(this.timers)) for (;this.timers.length > 0; ) clearTimeout(this.timers.shift());
            return this;
        },
        after: function(e) {
            var t = this, i = 0, n = [];
            if (w(e)) {
                if (e === 0) {
                    t.call();
                    return t;
                }
            } else e = 1;
            return function() {
                var r;
                n.push(I(arguments));
                i++;
                if (i == e) {
                    r = t.call(this, n);
                    i = 0;
                    n = [];
                    return r;
                }
            };
        },
        once: function() {
            return this.throttle(Infinity);
        },
        fill: function() {
            var e = this, i = I(arguments);
            return function() {
                var n = I(arguments);
                i.forEach(function(e, i) {
                    if (e != t || i >= n.length) n.splice(i, 0, e);
                });
                return e.apply(this, n);
            };
        }
    });
    function ui(e, t, n, r, a, o) {
        var s = e.toFixed(20), l = s.search(/\./);
        s = s.search(/[1-9]/);
        l = l - s;
        if (l > 0) l -= 1;
        a = u.max(u.min((l / 3).floor(), a === i ? n.length : a), -r);
        r = n.charAt(a + r - 1);
        if (l < -9) {
            a = -3;
            t = l.abs() - 9;
            r = n.slice(0, 1);
        }
        return (e / (o ? 2..pow(10 * a) : 10..pow(a * 3))).round(t || 0).format() + r.trim();
    }
    k(c, i, i, {
        random: function(e, t) {
            var i, n;
            if (arguments.length == 1) {
                t = e;
                e = 0;
            }
            i = u.min(e || 0, L(t) ? 1 : t);
            n = u.max(e || 0, L(t) ? 1 : t) + 1;
            return W(u.random() * (n - i) + i);
        }
    });
    k(c, e, i, {
        log: function(e) {
            return u.log(this) / (e ? u.log(e) : 1);
        },
        abbr: function(e) {
            return ui(this, e, "kmbt", 0, 4);
        },
        metric: function(e, t) {
            return ui(this, e, "nm kMGTPE", 4, L(t) ? 1 : t);
        },
        bytes: function(t, i) {
            return ui(this, t, "kMGTPE", 0, L(i) ? 4 : i, e) + "B";
        },
        isInteger: function() {
            return this % 1 == 0;
        },
        isOdd: function() {
            return !isNaN(this) && !this.isMultipleOf(2);
        },
        isEven: function() {
            return this.isMultipleOf(2);
        },
        isMultipleOf: function(e) {
            return this % e === 0;
        },
        format: function(e, t, i) {
            var n, r, a, o = "";
            if (L(t)) t = ",";
            if (L(i)) i = ".";
            n = (w(e) ? q(this, e || 0).toFixed(u.max(e, 0)) : this.toString()).replace(/^-/, "").split(".");
            r = n[0];
            a = n[1];
            for (n = r.length; n > 0; n -= 3) {
                if (n < r.length) o = t + o;
                o = r.slice(u.max(0, n - 3), n) + o;
            }
            if (a) o += i + $((e || 0) - a.length, "0") + a;
            return (this < 0 ? "-" : "") + o;
        },
        hex: function(e) {
            return this.pad(e || 1, i, 16);
        },
        upto: function(e, t, i) {
            return z(this, e, t, i || 1);
        },
        downto: function(e, t, i) {
            return z(this, e, t, -(i || 1));
        },
        times: function(e) {
            if (e) for (var t = 0; t < this; t++) e.call(this, t);
            return this.toNumber();
        },
        chr: function() {
            return l.fromCharCode(this);
        },
        pad: function(e, t, i) {
            return H(this, e, t, i);
        },
        ordinalize: function() {
            var e = this.abs();
            e = parseInt(e.toString().slice(-2));
            return this + G(e);
        },
        toNumber: function() {
            return parseFloat(this, 10);
        }
    });
    A(c, e, i, "round,floor,ceil", function(e, t) {
        e[t] = function(e) {
            return q(this, e, t);
        };
    });
    A(c, e, i, "abs,pow,sin,asin,cos,acos,tan,atan,exp,pow,sqrt", function(e, t) {
        e[t] = function(e, i) {
            return u[t](this, e, i);
        };
    });
    var fi = "isObject,isNaN".split(","), di = "keys,values,select,reject,each,merge,clone,equal,watch,tap,has,toQueryString".split(",");
    function hi(t, n, r, a) {
        var o = /^(.+?)(\[.*\])$/, s, l, c;
        if (a !== i && (l = n.match(o))) {
            c = l[1];
            n = l[2].replace(/^\[|\]$/g, "").split("][");
            n.forEach(function(e) {
                s = !e || e.match(/^\d+$/);
                if (!c && m(t)) c = t.length;
                N(t, c) || (t[c] = s ? [] : {});
                t = t[c];
                c = e;
            });
            if (!c && s) c = t.length.toString();
            hi(t, c, r);
        } else t[n] = r.match(/^[+-]?\d+(\.\d+)?$/) ? parseFloat(r) : r === "true" ? e : r === "false" ? i : r;
    }
    function pi(e, t) {
        var i;
        if (m(t) || M(t) && t.toString === f) {
            i = [];
            B(t, function(t, n) {
                if (e) t = e + "[" + t + "]";
                i.push(pi(t, n));
            });
            return i.join("&");
        } else {
            if (!e) return "";
            return gi(e) + "=" + (y(t) ? t.getTime() : gi(t));
        }
    }
    function gi(e) {
        return !e && e !== i && e !== 0 ? "" : encodeURIComponent(e).replace(/%20/g, "+");
    }
    function mi(t, n, r) {
        var a = {}, o;
        B(t, function(t, s) {
            o = i;
            O(n, function(i) {
                if (x(i) ? i.test(t) : F(i) ? N(i, t) : t === l(i)) o = e;
            }, 1);
            if (o === r) a[t] = s;
        });
        return a;
    }
    k(r, i, e, {
        watch: function(t, i, n) {
            if (p) {
                var a = t[i];
                r.defineProperty(t, i, {
                    enumerable: e,
                    configurable: e,
                    get: function() {
                        return a;
                    },
                    set: function(e) {
                        a = n.call(t, i, a, e);
                    }
                });
            }
        }
    });
    k(r, i, function(e, t) {
        return b(t);
    }, {
        keys: function(e, t) {
            var i = r.keys(e);
            i.forEach(function(i) {
                t.call(e, i, e[i]);
            });
            return i;
        }
    });
    k(r, i, i, {
        isObject: function(e) {
            return M(e);
        },
        isNaN: function(e) {
            return w(e) && e.valueOf() !== e.valueOf();
        },
        equal: function(e, t) {
            return K(e) && K(t) ? J(e) === J(t) : e === t;
        },
        extended: function(e) {
            return new U(e);
        },
        merge: function(t, n, l, c) {
            var u, f;
            if (t && typeof n != "string") for (u in n) if (N(n, u) && t) {
                f = n[u];
                if (R(t[u])) {
                    if (c === i) continue;
                    if (b(c)) f = c.call(n, u, t[u], n[u]);
                }
                if (l === e && f && F(f)) if (y(f)) f = new s(f.getTime()); else if (x(f)) f = new o(f.source, Y(f)); else {
                    t[u] || (t[u] = a.isArray(f) ? [] : {});
                    r.merge(t[u], n[u], l, c);
                    continue;
                }
                t[u] = f;
            }
            return t;
        },
        values: function(e, t) {
            var i = [];
            B(e, function(n, r) {
                i.push(r);
                t && t.call(e, r);
            });
            return i;
        },
        clone: function(e, t) {
            var i;
            if (y(e) && e.clone) return e.clone(); else if (F(e)) i = e instanceof U ? new U() : new e.constructor(); else return e;
            return r.merge(i, e, t);
        },
        fromQueryString: function(e, t) {
            var i = r.extended();
            e = e && e.toString ? e.toString() : "";
            e.replace(/^.*?\?/, "").split("&").forEach(function(e) {
                e = e.split("=");
                e.length === 2 && hi(i, e[0], decodeURIComponent(e[1]), t);
            });
            return i;
        },
        toQueryString: function(e, t) {
            return pi(t, e);
        },
        tap: function(e, t) {
            var i = t;
            b(t) || (i = function() {
                t && e[t]();
            });
            i.call(e, e);
            return e;
        },
        has: function(e, t) {
            return N(e, t);
        },
        select: function(t) {
            return mi(t, arguments, e);
        },
        reject: function(e) {
            return mi(e, arguments, i);
        }
    });
    A(r, i, i, g, function(e, t) {
        var i = "is" + t;
        fi.push(i);
        e[i] = h[t];
    });
    (function() {
        k(r, i, function() {
            return arguments.length === 0;
        }, {
            extend: function() {
                var e = fi.concat(di);
                if (typeof Et !== "undefined") e = e.concat(Et);
                Z(e, r);
            }
        });
    })();
    Z(di, U);
    k(o, i, i, {
        escape: function(e) {
            return X(e);
        }
    });
    k(o, e, i, {
        getFlags: function() {
            return Y(this);
        },
        setFlags: function(e) {
            return o(this.source, e);
        },
        addFlag: function(e) {
            return this.setFlags(Y(this, e));
        },
        removeFlag: function(e) {
            return this.setFlags(Y(this).replace(e, ""));
        }
    });
    var vi, yi;
    k(l, e, function(e) {
        return x(e) || arguments.length > 2;
    }, {
        startsWith: function(t, i, n) {
            var r = this;
            if (i) r = r.slice(i);
            if (L(n)) n = e;
            t = x(t) ? t.source.replace("^", "") : X(t);
            return o("^" + t, n ? "" : "i").test(r);
        },
        endsWith: function(t, i, n) {
            var r = this;
            if (R(i)) r = r.slice(0, i);
            if (L(n)) n = e;
            t = x(t) ? t.source.replace("$", "") : X(t);
            return o(t + "$", n ? "" : "i").test(r);
        }
    });
    k(l, e, i, {
        escapeRegExp: function() {
            return X(this);
        },
        escapeURL: function(e) {
            return e ? encodeURIComponent(this) : encodeURI(this);
        },
        unescapeURL: function(e) {
            return e ? decodeURI(this) : decodeURIComponent(this);
        },
        escapeHTML: function() {
            return this.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&apos;").replace(/\//g, "&#x2f;");
        },
        unescapeHTML: function() {
            return this.replace(/&lt;/g, "<").replace(/&gt;/g, ">").replace(/&quot;/g, '"').replace(/&apos;/g, "'").replace(/&#x2f;/g, "/").replace(/&amp;/g, "&");
        },
        encodeBase64: function() {
            return vi(this);
        },
        decodeBase64: function() {
            return yi(this);
        },
        each: function(e, t) {
            var i, n, r;
            if (b(e)) {
                t = e;
                e = /[\s\S]/g;
            } else if (e) if (C(e)) e = o(X(e), "gi"); else {
                if (x(e)) e = o(e.source, Y(e, "g"));
            } else e = /[\s\S]/g;
            i = this.match(e) || [];
            if (t) {
                n = 0;
                for (r = i.length; n < r; n++) i[n] = t.call(this, i[n], n, i) || i[n];
            }
            return i;
        },
        shift: function(e) {
            var t = "";
            e = e || 0;
            this.codes(function(i) {
                t += l.fromCharCode(i + e);
            });
            return t;
        },
        codes: function(e) {
            var t = [], i, n;
            i = 0;
            for (n = this.length; i < n; i++) {
                var r = this.charCodeAt(i);
                t.push(r);
                e && e.call(this, r, i);
            }
            return t;
        },
        chars: function(e) {
            return this.each(e);
        },
        words: function(e) {
            return this.trim().each(/\S+/g, e);
        },
        lines: function(e) {
            return this.trim().each(/^.*$/gm, e);
        },
        paragraphs: function(e) {
            var t = this.trim().split(/[\r\n]{2,}/);
            return t = t.map(function(t) {
                if (e) var i = e.call(t);
                return i ? i : t;
            });
        },
        isBlank: function() {
            return this.trim().length === 0;
        },
        has: function(e) {
            return this.search(x(e) ? e : X(e)) !== -1;
        },
        add: function(e, t) {
            t = L(t) ? this.length : t;
            return this.slice(0, t) + e + this.slice(t);
        },
        remove: function(e) {
            return this.replace(e, "");
        },
        reverse: function() {
            return this.split("").reverse().join("");
        },
        compact: function() {
            return this.trim().replace(/([\r\n\s\u3000])+/g, function(e, t) {
                return t === "" ? t : " ";
            });
        },
        at: function() {
            return Q(this, arguments, e);
        },
        from: function(e) {
            return this.slice(e);
        },
        to: function(e) {
            if (L(e)) e = this.length;
            return this.slice(0, e);
        },
        dasherize: function() {
            return this.underscore().replace(/_/g, "-");
        },
        underscore: function() {
            return this.replace(/[-\s]+/g, "_").replace(l.Inflector && l.Inflector.acronymRegExp, function(e, t) {
                return (t > 0 ? "_" : "") + e.toLowerCase();
            }).replace(/([A-Z\d]+)([A-Z][a-z])/g, "$1_$2").replace(/([a-z\d])([A-Z])/g, "$1_$2").toLowerCase();
        },
        camelize: function(e) {
            return this.underscore().replace(/(^|_)([^_]+)/g, function(t, n, r, a) {
                t = r;
                t = (n = l.Inflector) && n.acronyms[t];
                t = C(t) ? t : void 0;
                a = e !== i || a > 0;
                if (t) return a ? t : t.toLowerCase();
                return a ? r.capitalize() : r;
            });
        },
        spacify: function() {
            return this.underscore().replace(/_/g, " ");
        },
        stripTags: function() {
            var e = this;
            O(arguments.length > 0 ? arguments : [ "" ], function(t) {
                e = e.replace(o("</?" + X(t) + "[^<>]*>", "gi"), "");
            });
            return e;
        },
        removeTags: function() {
            var e = this;
            O(arguments.length > 0 ? arguments : [ "\\S+" ], function(t) {
                t = o("<(" + t + ")[^<>]*(?:\\/>|>.*?<\\/\\1>)", "gi");
                e = e.replace(t, "");
            });
            return e;
        },
        truncate: function(e, t, n, r) {
            var a = "", s = "", c = this.toString(), u = "[" + V() + "]+", f = "[^" + V() + "]*", d = o(u + f + "$");
            r = L(r) ? "..." : l(r);
            if (c.length <= e) return c;
            switch (n) {
              case "left":
                e = c.length - e;
                a = r;
                c = c.slice(e);
                d = o("^" + f + u);
                break;

              case "middle":
                e = W(e / 2);
                s = r + c.slice(c.length - e).trimLeft();
                c = c.slice(0, e);
                break;

              default:
                e = e;
                s = r;
                c = c.slice(0, e);
            }
            if (t === i && this.slice(e, e + 1).match(/\S/)) c = c.remove(d);
            return a + c + s;
        },
        pad: function(e, t) {
            return $(t, e) + this + $(t, e);
        },
        padLeft: function(e, t) {
            return $(t, e) + this;
        },
        padRight: function(e, t) {
            return this + $(t, e);
        },
        first: function(e) {
            if (L(e)) e = 1;
            return this.substr(0, e);
        },
        last: function(e) {
            if (L(e)) e = 1;
            return this.substr(this.length - e < 0 ? 0 : this.length - e);
        },
        repeat: function(e) {
            var t = "", i = this;
            if (!w(e) || e < 1) return "";
            for (;e; ) {
                if (e & 1) t += i;
                if (e >>= 1) i += i;
            }
            return t;
        },
        toNumber: function(e) {
            var t = this.replace(/,/g, "");
            return t.match(/\./) ? parseFloat(t) : parseInt(t, e || 10);
        },
        capitalize: function(e) {
            var t;
            return this.toLowerCase().replace(e ? /[\s\S]/g : /^\S/, function(e) {
                var i = e.toUpperCase(), n;
                n = t ? e : i;
                t = i !== e;
                return n;
            });
        },
        assign: function() {
            var e = {};
            I(arguments, function(t, i) {
                if (M(t)) j(e, t); else e[i + 1] = t;
            });
            return this.replace(/\{([^{]+?)\}/g, function(t, i) {
                return N(e, i) ? e[i] : t;
            });
        }
    });
    k(l, e, i, {
        insert: l.prototype.add
    });
    (function(e) {
        if (this.btoa) {
            vi = this.btoa;
            yi = this.atob;
        } else {
            var t = /[^A-Za-z0-9\+\/\=]/g;
            vi = function(t) {
                var i = "", n, r, a, o, s, l, c = 0;
                do {
                    n = t.charCodeAt(c++);
                    r = t.charCodeAt(c++);
                    a = t.charCodeAt(c++);
                    o = n >> 2;
                    n = (n & 3) << 4 | r >> 4;
                    s = (r & 15) << 2 | a >> 6;
                    l = a & 63;
                    if (isNaN(r)) s = l = 64; else if (isNaN(a)) l = 64;
                    i = i + e.charAt(o) + e.charAt(n) + e.charAt(s) + e.charAt(l);
                } while (c < t.length);
                return i;
            };
            yi = function(i) {
                var n = "", r, a, o, s, c, u = 0;
                if (i.match(t)) throw Error("String contains invalid base64 characters");
                i = i.replace(/[^A-Za-z0-9\+\/\=]/g, "");
                do {
                    r = e.indexOf(i.charAt(u++));
                    a = e.indexOf(i.charAt(u++));
                    s = e.indexOf(i.charAt(u++));
                    c = e.indexOf(i.charAt(u++));
                    r = r << 2 | a >> 4;
                    a = (a & 15) << 4 | s >> 2;
                    o = (s & 3) << 6 | c;
                    n += l.fromCharCode(r);
                    if (s != 64) n += l.fromCharCode(a);
                    if (c != 64) n += l.fromCharCode(o);
                } while (u < i.length);
                return n;
            };
        }
    })("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=");
})();

define("sugar", function() {});

(function(e, t) {
    if (typeof exports === "object" && module) {
        module.exports = t();
    } else if (typeof define === "function" && define.amd) {
        define("signal", t);
    } else {
        e.PubSub = t();
    }
})(typeof window === "object" && window || this, function() {
    var e = {}, t = {}, i = -1;
    function n(e) {
        return function t() {
            throw e;
        };
    }
    function r(e, t, i) {
        e(i, t);
    }
    function a(e, t, i) {
        e(t, i);
    }
    function o(e, i, n) {
        var a = t[i], o = r, s, l;
        if (!t.hasOwnProperty(i)) {
            return;
        }
        for (s = 0; s < a.length; s++) {
            o(a[s].func, e, n);
        }
    }
    function s(e, t) {
        return function i() {
            var i = String(e), n = i.lastIndexOf(".");
            o(e, e, t);
            while (n !== -1) {
                i = i.substr(0, n);
                n = i.lastIndexOf(".");
                o(e, i, t);
            }
        };
    }
    function l(e) {
        var i = String(e), n = t.hasOwnProperty(i), r = i.lastIndexOf(".");
        while (!n && r !== -1) {
            i = i.substr(0, r);
            r = i.lastIndexOf(".");
            n = t.hasOwnProperty(i);
        }
        return n && t[i].length > 0;
    }
    function c(e, t) {
        var i = s(e, t), n = l(e);
        if (!n) {
            return false;
        }
        i();
        return true;
    }
    e.publish = function(e, t) {
        return c(e, t);
    };
    e.publishSync = function(e, t) {
        return c(e, t);
    };
    e.subscribe = function(e, n) {
        if (typeof n !== "function") {
            return false;
        }
        if (!t.hasOwnProperty(e)) {
            t[e] = [];
        }
        var r = String(++i);
        t[e].push({
            token: r,
            func: n,
            message: e
        });
        return r;
    };
    e.subscribeSingle = function(e, n) {
        if (typeof n !== "function") {
            return false;
        }
        if (!t.hasOwnProperty(e)) {
            t[e] = [];
        }
        var r = String(++i);
        if (!t[e].length) {
            t[e].push({
                token: r,
                func: n,
                message: e
            });
        }
        return r;
    };
    e.unsubscribe = function(e) {
        var i = typeof e === "string", n = i ? "token" : "func", r = i ? e : true, a = false, o, s, l = "message";
        for (o in t) {
            if (t.hasOwnProperty(o)) {
                for (s = t[o].length - 1; s >= 0; s--) {
                    if (t[o][s][n] === e || t[o][s][l] === e) {
                        t[o].splice(s, 1);
                        a = r;
                        if (i) {
                            return a;
                        }
                    }
                }
            }
        }
        return a;
    };
    return e;
});

define("WorkingList", [ "utils", "sugar", "signal" ], function(Utils, e, t) {
    var i = Utils.extend(function() {}, {
        items: [],
        addItems: function(e) {
            for (var i = 0; i < e.length; i++) {
                this.items.push(e[i]);
                t.publish("workingList:item:added", e[i]);
            }
            t.publish("workingList:items:added", e);
        },
        addItem: function(e) {
            this.items.push(e);
            t.publish("workingList:item:added", e);
        },
        remove: function(e) {
            this.items.remove(e);
            t.publish("workingList:item:removed");
        },
        removeAt: function(e) {
            this.items.removeAt(e);
            t.publish("workingList:item:removed");
        },
        removeByUid: function(e) {
            var i = this.items.findIndex(function(t, i) {
                return t.get("uid") == e;
            });
            this.items.removeAt(i);
            t.publish("workingList:item:removed");
        },
        at: function(e) {
            return this.items[e];
        },
        size: function() {
            return this.items.length;
        },
        findByUid: function(e) {
            return this.items.find(function(t) {
                return t.get("uid") == e;
            });
        },
        failedItems: function() {
            return this.items.findAll(function(e) {
                return e.isProcessingFailed();
            });
        },
        itemsWithoutThumbnail: function() {
            return this.items.filter(function(e) {
                return !e.get("thumbnail");
            });
        },
        itemsWithoutMemoryscore: function() {
            return this.items.filter(function(e) {
                return !e.get("memoryscore");
            });
        },
        last: function() {
            return this.items.last();
        }
    });
    return i;
});

(function(e, t) {
    var i = function() {
        var e = {
            "default": {
                delayToRemove: 5e3
            },
            namesShowingNotifications: [],
            groups: [],
            initWrapper: function() {
                var e = this.wrapper = document.createElement("div");
                e.classList.add("picsioNotifications");
                document.body.appendChild(e);
                delete this.initWrapper;
            },
            initNotification: function(e, t) {
                var i = t[0];
                if (typeof t[1] === "object") {
                    var n = t[1].denyRepeat, r = t[1].keepOnScreen, a = t[1].btnClose !== false, o = t[1].handler, s = t[1].classList, l = t[1].styleList, c = t[1].group, u = t[1].removeOnClick !== false;
                } else {
                    var n = t[1], r = t[2], u = true, a = true;
                }
                return this.add(i, e, n, r, a, o, c, u);
            },
            add: function(e, t, i, n, r, a, o, s) {
                if (typeof this.initWrapper === "function") {
                    this.initWrapper();
                }
                if (!i || i && this.namesShowingNotifications.indexOf(e) === -1) {
                    if (t === "info") {
                        console.info && console.info.apply(console, [ e ]);
                    } else if (t === "error") {
                        console.error && console.error.apply(console, [ e ]);
                    } else if (t === "success") {
                        console.log && console.log.apply(console, [ e ]);
                    }
                    this.namesShowingNotifications.push(e);
                    return this.generateNotify(e, t, n, r, a, o, s);
                }
            },
            generateNotify: function(e, t, i, n, r, a, o) {
                var s = this, l = document.createElement("div"), c = document.createElement("span");
                l.classList.add(t + "Notifications");
                c.classList.add("textPicsioNotification");
                c.textContent = e;
                if (r || o) {
                    c.classList.add("clickablePicsioNotification");
                }
                r && c.addEventListener("click", r, false);
                o && c.addEventListener("click", this.remove.bind(this, l, e), false);
                l.appendChild(c);
                if (n) {
                    var n = document.createElement("span");
                    n.classList.add("closePicsioNotification");
                    n.classList.add("icon_regularX");
                    if (n.handler) {
                        n.addEventListener("click", n.handler, false);
                    }
                    n.addEventListener("click", this.remove.bind(this, l, e), false);
                    l.appendChild(n);
                }
                if (a) {
                    for (var u = 0; u < this.groups.length; u++) {
                        if (this.groups[u].id === a) {
                            this.groups[u].el.remove();
                            this.groups.removeAt(u);
                        }
                    }
                    this.groups.push({
                        id: a,
                        el: l
                    });
                }
                this.wrapper.appendChild(l);
                if (typeof i === "number") {
                    setTimeout(function() {
                        s.remove(l, e);
                    }, i);
                } else if (typeof i === "boolean" && i === true) {
                    var f = document.createElement("span"), d = document.createElement("span");
                    l;
                } else if (typeof i === "boolean" && i === false || typeof i === "undefined") {
                    setTimeout(function() {
                        s.remove(l, e);
                    }, this.default.delayToRemove);
                }
                return l;
            },
            remove: function(e, t, i) {
                e.remove();
                this.namesShowingNotifications.remove(t);
            }
        };
        return {
            info: function() {
                return e.initNotification("info", arguments);
            },
            success: function() {
                return e.initNotification("success", arguments);
            },
            error: function() {
                return e.initNotification("error", arguments);
            }
        };
    };
    if (typeof define === "function") {
        define("Notifications", [], function() {
            return new i();
        });
    } else if (typeof e.template === "undefined") {
        e.template = new i();
    }
})(this);

(function(e, t) {
    var i = function() {
        var e = {
            run: function(e) {
                this.config = typeof e[2] === "object" ? e[2] : {};
                this.config.type = e[0];
                this.config.message = e[1];
                this.initialize(this.config);
                return this.config;
            },
            template: function(e) {
                var t = e.btnOkValue || "Ok", i = e.defaultValue || "", n = e.type === "prompt";
                return [ '<div class="popup">', e.hideClose ? "" : '<span class="btnClose icon_regularX"></span>', e.hideOk ? "" : '<div class="btns"><span class="btn btnOk"><span>' + t + "</span></span></div>", '<div class="body">', e.message ? '<span class="text">' + e.message + "</span>" : "", n ? '<input type="text" value="' + i + '" class="promptInput" />' : "", "</div>", "</div>" ].join("");
            },
            generate: function(e) {
                var t = document.createElement("div");
                t.classList.add("picsio" + e.type.capitalize());
                t.innerHTML = this.template(e);
                var i = t.querySelector(".btnClose"), n = t.querySelector(".btnOk");
                i && i.addEventListener("click", this.onClose.bind(this), false);
                n && n.addEventListener("click", this.onOK.bind(this), false);
                this.config.el = t;
                this.config.destroy = this.destroy.bind(this);
                return t;
            },
            onClose: function() {
                this.config.onClose && this.config.onClose();
                this.destroy();
            },
            onOK: function() {
                this.config.type === "prompt" ? this.returnPromptVal() : "";
                if (this.config.onOk && this.config.onOk.length) {
                    for (var e = 0; e < this.config.onOk.length; e++) {
                        this.config.onOk[e]();
                    }
                } else if (this.config.onOk && !this.config.onOk.length) {
                    this.config.onOk();
                }
                this.destroy();
            },
            returnPromptVal: function() {
                var e = this.config.el.querySelector(".promptInput").value || "";
                this.config.value = e;
            },
            destroy: function() {
                var e = this.config.el.closest(".wrapperAlerts");
                this.config.el.remove();
                for (var t in this.config) {
                    if (t === "value") {
                        continue;
                    }
                    delete this.config[t];
                }
                !e.querySelector(".picsioAlert, .picsioPrompt") && e.remove();
                Backbone.Events.trigger("blur", "#content", false);
            }
        };
        var t = function() {
            this.initialize = function(e) {
                this.render(e);
            };
            this.render = function(e) {
                var t = this.generate(e);
                var i = document.querySelector(".wrapperAlerts");
                if (!i) {
                    i = document.createElement("div");
                    i.classList.add("wrapperAlerts");
                }
                i.appendChild(t);
                document.body.appendChild(i);
            };
            return this.run(arguments);
        };
        var i = function() {
            this.initialize = function(e) {
                this.render(e);
            };
            this.render = function(e) {
                var t = this.generate(e);
                var i = document.querySelector(".wrapperAlerts");
                if (!i) {
                    i = document.createElement("div");
                    i.classList.add("wrapperAlerts");
                }
                i.appendChild(t);
                document.body.appendChild(i);
            };
            return this.run(arguments);
        };
        t.prototype = e;
        i.prototype = e;
        return {
            alert: function(e, i) {
                return new t("alert", e, i);
            },
            prompt: function(e, t) {
                return new i("prompt", e, t);
            }
        };
    };
    if (typeof define === "function") {
        define("Alerts", [], function() {
            return new i();
        });
    } else if (typeof e.collectionAlerts === "undefined") {
        e.collectionAlerts = new i();
    }
})(this);

define("Spinner/templates/index", [], function() {
    return [ '<div class="picsioSpinner">', '<div class="innerPicsioSpinner">', '<div class="spinner">', "<div></div>", "<span></span>", "</div>", '<span class="titleSpinner"></span>', '<span class="textSpinner"></span>', "</div>", "</div>" ].join("");
});

define("Spinner/views/index", [ "require", "../templates/index", "jquery" ], function(e) {
    var t = e("../templates/index");
    var i = e("jquery");
    return function(e) {
        var n = {
            defaultConfig: {
                title: null,
                text: null,
                classList: [],
                styleList: {},
                parentEl: document.body
            },
            initialize: function(e) {
                Object.merge(this.defaultConfig, e);
                this.$el = i(t);
                this.setTitle(this.defaultConfig.title);
                this.setText(this.defaultConfig.text);
                this.setClassList(this.defaultConfig.classList);
                this.setStyleList(this.defaultConfig.styleList);
                this.render();
                return this;
            },
            render: function() {
                if (this.defaultConfig.parentEl.append) {
                    this.defaultConfig.parentEl.append(this.$el);
                } else {
                    this.defaultConfig.parentEl.appendChild(this.$el[0]);
                }
                return this;
            },
            setTitle: function(e) {
                if (!e) {
                    return;
                }
                this.$el.find(".titleSpinner").addClass("show").html(e);
            },
            setText: function(e) {
                if (!e) {
                    return;
                }
                this.$el.find(".textSpinner").addClass("show").html(e);
            },
            setClassList: function(e) {
                if (!e || !e.length) {
                    return;
                }
                this.$el.addClass(e.join(" "));
            },
            setStyleList: function(e) {
                if (!e) {
                    return;
                }
                this.$el.css(e);
            },
            destroy: function() {
                this.$el.remove();
            }
        };
        return n.initialize(e);
    };
});

define("Spinner/index", [ "require", "./views/index" ], function(e) {
    var t = e("./views/index");
    return t;
});

define("Spinner", [ "Spinner/index" ], function(e) {
    return e;
});

(function(e, t) {
    var i = e.document, n;
    var r = [ "edit.pics.io", "raw.pics.io", "live.pics.io", "pics.io" ];
    n = function(e, t, n, r, a, o, s) {
        var l = this;
        this.blockui = function(e, t) {
            var n = t && t.text;
            var r = t && t.classList || [];
            var a = t && t.styleList || {};
            r.push("blockUI");
            l.spinner && l.spinner.destroy();
            l.spinner = new s({
                parentEl: i.body,
                title: e,
                text: n,
                classList: r,
                styleList: a
            });
            return l.spinner;
        };
        this.unblockui = function() {
            l.spinner && l.spinner.destroy();
        };
        this.log = function() {
            console.log.apply(console, arguments);
        };
        this.warn = function() {
            console.warn && console.warn.apply(console, arguments);
        };
        this.info = r.info;
        this.error = r.error;
        this.success = r.success;
        this.alert = function() {
            Backbone.Events.trigger("blur", "#content", true);
            return a.alert.apply(null, arguments);
        };
        this.prompt = function() {
            Backbone.Events.trigger("blur", "#content", true);
            return a.prompt.apply(null, arguments);
        };
        var c = function(e) {
            var t = e.title;
            var i = e.body;
            var n = "/assets/img/logo_128x128.png";
            var r = new Notification(t, {
                body: i,
                icon: n
            });
            r.onclick = e.onclick;
            r.onshow = function() {
                setTimeout(r.close.bind(r), 5e3);
            };
        };
        var u = function(e) {
            if (!("Notification" in window)) {
                this.log("Notification is not suported in the browser.");
            } else if (Notification.permission === "granted") {
                c(e);
            } else if (Notification.permission !== "denied") {
                Notification.requestPermission(function(t) {
                    if (t === "granted") {
                        c(e);
                    }
                });
            }
        };
        return {
            blockui: this.blockui,
            unblockui: this.unblockui,
            log: this.log,
            warn: this.warn,
            info: this.info,
            error: this.error,
            success: this.success,
            alert: this.alert,
            prompt: this.prompt,
            showNotification: u
        };
    };
    if (typeof define === "function") {
        define("LoggingService", [ "jquery", "environment", "utils", "Notifications", "Alerts", "q", "Spinner" ], function(e, t, i, r, a, o, s) {
            return new n(e, t, i, r, a, o, s);
        });
    } else {
        if (typeof e.LoggingService === "undefined") {
            e.LoggingService = new n(e.$, e.PicsIO, utils, Notifications, Alerts, Q, Spinner);
        }
    }
})(this);

(function(e, t) {
    var i = function(Utils) {
        var IFDParser = Utils.extend(function() {}, {
            base: function() {
                return this.__proto__.__proto__;
            },
            init: function(e) {
                this.dataSize = e.dataSize;
                this.data = e.data;
                if (!this.data) this.data = new DataView(new ArrayBuffer(this.dataSize));
                this.dataUrl = e.dataUrl;
                this.readFromFile = false;
                this.endian = t;
                this.skipInlineValues = e.skipInlineValues || false;
                this.includeFieldsFilter = e.includeFields || [];
                this.excludeFieldsFilter = e.excludeFields || [];
                this.processSubIFD = e.processSubIFD || true;
                this.fileHeaderSize = e.fileHeaderSize || 12;
                this.firstPayloadSize = e.firstPayloadSize || 1e5;
                this.ifdOffset = 0;
                this.tifftypes = {
                    1: [ "BYTE", 1 ],
                    2: [ "ASCII", 1 ],
                    3: [ "SHORT", 2 ],
                    4: [ "LONG", 4 ],
                    5: [ "RATIONAL", 8 ],
                    6: [ "SBYTE", 1 ],
                    7: [ "UNDEFINED", 1 ],
                    8: [ "SSHORT", 2 ],
                    9: [ "SLONG", 4 ],
                    10: [ "SRATIONAL", 8 ],
                    11: [ "FLOAT", 4 ],
                    12: [ "DOUBLE", 8 ]
                };
                this.tifftags = {
                    254: [ "New Subfile Type", "NewSubfileType" ],
                    255: [ "Subfile Type", "SubfileType" ],
                    256: [ "Image width", "ImageWidth" ],
                    257: [ "Image height", "ImageLength" ],
                    258: [ "Number of bits per component", "BitsPerSample" ],
                    259: [ "Compression scheme", "Compression", {
                        1: "uncompressed",
                        2: "CCITT 1D",
                        3: "Group 3 Fax",
                        4: "Group 4 Fax",
                        5: "LZW",
                        6: "JPEG compression",
                        7: "JPEG ('new-style' JPEG)",
                        8: "Deflate ('Adobe-style')",
                        32773: "PackBits"
                    } ],
                    262: [ "Pixel composition", "PhotmetricInerpretation", {
                        0: "WhiteIsZero",
                        1: "BlackIsZero",
                        2: "RGB",
                        3: "RGB Palette",
                        4: "Transparency mask",
                        5: "CMYK",
                        6: "YCbCr",
                        8: "CIELab"
                    } ],
                    263: [ "Threshholding", "Threshholding" ],
                    264: [ "Cell Width", "CellWidth" ],
                    265: [ "Cell Length", "CellLength" ],
                    266: [ "Fill Order", "FillOrder" ],
                    269: [ "Document Name", "DocumentName" ],
                    270: [ "Image title", "ImageDescription" ],
                    271: [ "Make", "Make" ],
                    272: [ "Model", "Model" ],
                    273: [ "Image data location", "StripOffsets" ],
                    274: [ "Orientation of image", "Orientation", {
                        1: "Normal",
                        2: "Reverse?",
                        3: "Upside-down",
                        4: "Upside-down Reverse",
                        5: "90 degree CW",
                        6: "90 degree CW reverse",
                        7: "90 degree CCW",
                        8: "90 degree CCW reverse"
                    } ],
                    277: [ "Number of components", "SamplesPerPixel" ],
                    278: [ "Number of rows per strip", "RowsPerStrip" ],
                    279: [ "Bytes per compressed strip", "StripByteCounts" ],
                    280: [ "Min Sample Value", "MinSampleValue" ],
                    281: [ "Max Sample Value", "MaxSampleValue" ],
                    282: [ "X Resolution", "XResolution" ],
                    283: [ "Y Resolution", "YResolution" ],
                    285: [ "Page Name", "PageName" ],
                    286: [ "X Position", "XPosition" ],
                    287: [ "Y Position", "YPosition" ],
                    288: [ "Free Offsets", "FreeOffsets" ],
                    289: [ "Free Byte Counts", "FreeByteCounts" ],
                    290: [ "Gray Response Unit", "GrayResponseUnit" ],
                    291: [ "Gray Response Curve", "GrayResponseCurve" ],
                    292: [ "T4 Options", "T4Options" ],
                    293: [ "T6 Options", "T6Options" ],
                    296: [ "Resolution Unit", "ResolutionUnit", {
                        2: "inches",
                        3: "centimeters"
                    } ],
                    297: [ "Page Number", "PageNumber" ],
                    301: [ "Transfer function", "TransferFunction" ],
                    306: [ "Date and time", "DateTime" ],
                    316: [ "Host Computer", "HostComputer" ],
                    317: [ "Predictor", "Predictor" ],
                    318: [ "White point chromaticity", "WhitePoint" ],
                    319: [ "Chromaticities of primaries", "PrimaryChromaticities" ],
                    320: [ "Color Map", "ColorMap" ],
                    321: [ "Halftone Hints", "HalftoneHints" ],
                    322: [ "Tile Width", "TileWidth" ],
                    323: [ "Tile Length", "TileLength" ],
                    324: [ "Tile Offsets", "TileOffsets" ],
                    325: [ "Tile Byte Counts", "TileByteCounts" ],
                    330: [ "Offset to child IFDs", "SubIFDs" ],
                    332: [ "Ink Set", "InkSet" ],
                    333: [ "Ink Names", "InkNames" ],
                    334: [ "Number Of Inks", "NumberOfInks" ],
                    336: [ "Dot Range", "DotRange" ],
                    337: [ "Target Printer", "TargetPrinter" ],
                    338: [ "Extra Samples", "ExtraSamples" ],
                    339: [ "Sample Format", "SampleFormat" ],
                    340: [ "S Min Sample Value", "SMinSampleValue" ],
                    341: [ "S MaxSample Value", "SMaxSampleValue" ],
                    342: [ "Transfer Range", "TransferRange" ],
                    512: [ "JPEG Proc", "JPEGProc" ],
                    513: [ "Offset to JPEG SOI", "JPEGInterchangeFormat" ],
                    514: [ "Bytes of JPEG Data", "JPEGInterchangeFormatLength" ],
                    517: [ "JPEG Lossless Predictors", "JPEGLosslessPredictors" ],
                    518: [ "JPEG Point Transforms", "JPEGPointTransforms" ],
                    519: [ "JPEG Q Tables", "JPEGQTables" ],
                    520: [ "JPEG DC Tables", "JPEGDCTables" ],
                    521: [ "JPEG AC Tables", "JPEGACTables" ],
                    529: [ "Color space transformation matrix coefficients", "YCbCrCoefficients" ],
                    530: [ "Subsampling ratio of Y to C", "YCbCrSubSampling" ],
                    531: [ "Y and C positioning", "YCbCrPositioning", {
                        1: "centered",
                        2: "co-sited"
                    } ],
                    532: [ "Pair of black and white reference values", "ReferenceBlackWhite" ],
                    33421: [ "CFA Repeat Pattern Dim", "CFARepeatPatternDim" ],
                    33422: [ "CFA Pattern", "CFAPattern" ],
                    34665: [ "Exif tag", "ExifIfdPointer" ],
                    34853: [ "GPS tag", "GPSInfoIfdPointer" ],
                    34885: [ "ISO Speed Rating", "ISOSpeedRating" ],
                    37393: [ "Number assigned to an image", "ImageNumber" ],
                    50648: [ "Canon RAW IFD Specific Tag", "50648" ],
                    50752: [ "Canon RAW IFD slices", "50752" ],
                    50706: [ "DNG Version", "DNGVersion" ],
                    50707: [ "DNG Backward Version", "DNGBackwardVersion" ],
                    50708: [ "Unique Camera Model", "UniqueCameraModel" ],
                    50709: [ "Localized Camera Model", "LocalizedCameraModel" ],
                    50710: [ "CFA Plane Color", "CFAPlaneColor" ],
                    50711: [ "CFA Layout", "CFALayout" ],
                    50712: [ "Linearization Table", "LinearizationTable" ],
                    50713: [ "Black Level Repeat Dim", "BlackLevelRepeatDim" ],
                    50714: [ "Black Level", "BlackLevel" ],
                    50715: [ "Black Level Delta H", "BlackLevelDeltaH" ],
                    50716: [ "Black Level Delta V", "BlackLevelDeltaV" ],
                    50717: [ "White Level", "WhiteLevel" ],
                    50718: [ "Default Scale", "DefaultScale" ],
                    50719: [ "Default Crop Origin", "DefaultCropOrigin" ],
                    50720: [ "Default Crop Size", "DefaultCropSize" ],
                    50778: [ "Calibration Illuminant 1", "CalibrationIlluminant1" ],
                    50779: [ "Calibration Illuminant 2", "CalibrationIlluminant2" ],
                    50721: [ "Color Matrix 1", "ColorMatrix1" ],
                    50722: [ "Color Matrix 2", "ColorMatrix2" ],
                    50723: [ "Camera Calibration 1", "CameraCalibration1" ],
                    50724: [ "Camera Calibration 2", "CameraCalibration2" ],
                    50725: [ "Reduction Matrix 1", "ReductionMatrix1" ],
                    50726: [ "Reduction Matrix 2", "ReductionMatrix2" ],
                    50727: [ "Analog Balance", "AnalogBalance" ],
                    50728: [ "As Shot Neutral", "AsShotNeutral" ],
                    50729: [ "As Shot White XY", "AsShotWhiteXY" ],
                    50730: [ "Baseline Exposure", "BaselineExposure" ],
                    50731: [ "Baseline Noise", "BaselineNoise" ],
                    50732: [ "Baseline Sharpness", "BaselineSharpness" ],
                    50734: [ "Linear Response Limit", "LinearResponseLimit" ],
                    50735: [ "Camera Serial Number", "CameraSerialNumber" ],
                    50736: [ "Lens Info", "LensInfo" ],
                    50737: [ "Chroma Blur Radius", "ChromaBlurRadius" ],
                    50739: [ "Shadow Scale", "ShadowScale" ],
                    50741: [ "Maker Note Safety", "MakerNoteSafety" ],
                    50781: [ "Raw Data Unique ID", "RawDataUniqueID" ],
                    50827: [ "Original Raw File Name", "OriginalRawFileName" ],
                    50828: [ "Original Raw File Data", "OriginalRawFileData" ],
                    50829: [ "Active Area", "ActiveArea" ],
                    50830: [ "Masked Areas", "MaskedAreas" ],
                    50831: [ "As Shot ICC Profile", "AsShotICCProfile" ],
                    50832: [ "As Shot Pre Profile Matrix", "AsShotPreProfileMatrix" ],
                    50833: [ "Current ICC Profile", "CurrentICCProfile" ],
                    50834: [ "Current Pre Profile Matrix", "CurrentPreProfileMatrix" ],
                    50879: [ "Colorimetric Reference", "ColorimetricReference" ],
                    50931: [ "Camera Calibration Signature", "CameraCalibrationSignature" ],
                    50932: [ "Profile Calibration Signature", "ProfileCalibrationSignature" ],
                    50933: [ "Extra Camera Profiles", "ExtraCameraProfiles" ],
                    50934: [ "As Shot Profile Name", "AsShotProfileName" ],
                    50935: [ "Noise Reduction Applied", "NoiseReductionApplied" ],
                    50936: [ "Profile Name", "ProfileName" ],
                    50941: [ "Profile Embed Policy", "ProfileEmbedPolicy" ],
                    50942: [ "Profile Copyright", "ProfileCopyright" ],
                    50964: [ "Forward Matrix 1", "ForwardMatrix1" ],
                    50965: [ "Forward Matrix 2", "ForwardMatrix2" ],
                    50966: [ "Preview Application Name", "PreviewApplicationName" ],
                    50967: [ "Preview Application Version", "PreviewApplicationVersion" ],
                    50968: [ "Preview Settings Name", "PreviewSettingsName" ],
                    50969: [ "Preview Settings Digest", "PreviewSettingsDigest" ],
                    50970: [ "Preview Color Space", "PreviewColorSpace" ],
                    50971: [ "Preview Date Time", "PreviewDateTime" ],
                    50972: [ "Raw Image Digest", "RawImageDigest" ],
                    50973: [ "Original Raw File Digest", "OriginalRawFileDigest" ],
                    50974: [ "Sub Tile Block Size", "SubTileBlockSize" ],
                    50975: [ "Row Interleave Factor", "RowInterleaveFactor" ],
                    51008: [ "OpcodeList1", "OpcodeList1" ],
                    51009: [ "OpcodeList2", "OpcodeList2" ],
                    51022: [ "OpcodeList3", "OpcodeList3" ],
                    51041: [ "NoiseProfile", "NoiseProfile" ],
                    33434: [ "Exposure time, given in seconds.", "ExposureTime" ],
                    33437: [ "The F number.", "FNumber" ],
                    34850: [ "The class of the program used by the camera to set exposure when the picture is taken.", "ExposureProgram", {
                        0: "Not defined",
                        1: "Manual",
                        2: "Normal program",
                        3: "Aperture priority",
                        4: "Shutter priority",
                        5: "Creative program",
                        6: "Action program",
                        7: "Portrait mode",
                        8: "Landscape mode"
                    } ],
                    34852: [ "Indicates the spectral sensitivity of each channel of the camera used.", "SpectralSensitivity" ],
                    34855: [ "Indicates the ISO Speed and ISO Latitude of the camera or input device as specified in ISO 12232.", "ISOSpeedRatings" ],
                    34856: [ "Indicates the Opto-Electric Conversion Function (OECF) specified in ISO 14524.", "OECF" ],
                    36864: [ "The version of the supported Exif standard.", "ExifVersion" ],
                    36867: [ "The date and time when the original image data was generated.", "DateTimeOriginal" ],
                    37121: [ "Specific to compressed data; specifies the channels and complements PhotometricInterpretation", "ComponentsConfiguration" ],
                    37122: [ "Specific to compressed data; states the compressed bits per pixel.", "CompressedBitsPerPixel" ],
                    37377: [ "Shutter speed.", "ShutterSpeedValue" ],
                    37378: [ "The lens aperture.", "ApertureValue" ],
                    37379: [ "The value of brightness.", "BrightnessValue" ],
                    37382: [ "The distance to the subject, given in meters.", "SubjectDistance" ],
                    37384: [ "The kind of light source.", "LightSource" ],
                    37385: [ "Indicates the status of flash when the image was shot.", "Flash", {
                        0: "Flash did not fire",
                        1: "Flash fired",
                        5: "Strobe return light not detected",
                        7: "Strobe return light detected",
                        8: "On, Did not fired",
                        9: "Flash fired, compulsory flash mode",
                        13: "Flash fired, compulsory flash mode, return light not detected",
                        15: "Flash fired, compulsory flash mode, return light detected",
                        16: "Flash did not fire, compulsory flash mode",
                        24: "Flash did not fire, auto mode",
                        25: "Flash fired, auto mode",
                        29: "Flash fired, auto mode, return light not detected",
                        31: "Flash fired, auto mode, return light detected",
                        32: "No flash function",
                        65: "Flash fired, red-eye reduction mode",
                        69: "Flash fired, red-eye reduction mode, return light not detected",
                        71: "Flash fired, red-eye reduction mode, return light detected",
                        73: "Flash fired, compulsory flash mode, red-eye reduction mode",
                        77: "Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",
                        79: "Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",
                        89: "Flash fired, auto mode, red-eye reduction mode",
                        93: "Flash fired, auto mode, return light not detected, red-eye reduction mode",
                        95: "Flash fired, auto mode, return light detected, red-eye reduction mode"
                    } ],
                    37386: [ "The actual focal length of the lens, in mm.", "FocalLength" ],
                    37396: [ "Indicates the location and area of the main subject in the overall scene.", "SubjectArea" ],
                    37500: [ "Manufacturer specific information.", "MakerNote" ],
                    37520: [ "A tag used to record fractions of seconds for the DateTime tag.", "SubsecTime" ],
                    37521: [ "A tag used to record fractions of seconds for the DateTimeOriginal tag.", "SubsecTimeOriginal" ],
                    40961: [ "The color space information tag is always recorded as the color space specifier.", "ColorSpace" ],
                    40962: [ "Specific to compressed data; the valid width of the meaningful image.", "PixelXDimension" ],
                    40963: [ "Specific to compressed data; the valid height of the meaningful image.", "PixelYDimension" ],
                    40964: [ "Used to record the name of an audio file related to the image data.", "RelatedSoundFile" ],
                    41483: [ "Indicates the strobe energy at the time the image is captured, as measured in Beam Candle Power Seconds", "FlashEnergy" ],
                    41484: [ "Records the camera or input device spatial frequency table and SFR values in the direction of image width, image height, and diagonal direction, as specified in ISO 12233.", "SpatialFrequencyResponse" ],
                    41486: [ "Indicates the number of pixels in the image width (X) direction per FocalPlaneResolutionUnit on the camera focal plane.", "FocalPlaneXResolution" ],
                    41487: [ "Indicates the number of pixels in the image height (Y) direction per FocalPlaneResolutionUnit on the camera focal plane.", "FocalPlaneYResolution" ],
                    41488: [ "Indicates the unit for measuring FocalPlaneXResolution and FocalPlaneYResolution.", "FocalPlaneResolutionUnit" ],
                    41492: [ "Indicates the location of the main subject in the scene.", "SubjectLocation" ],
                    41493: [ "Indicates the exposure index selected on the camera or input device at the time the image is captured.", "ExposureIndex" ],
                    41495: [ "Indicates the image sensor type on the camera or input device.", "SensingMethod" ],
                    41728: [ "Indicates the image source.", "FileSource" ],
                    41729: [ "Indicates the type of scene.", "SceneType" ],
                    41730: [ "Indicates the color filter array (CFA) geometric pattern of the image sensor when a one-chip color area sensor is used.", "CFAPattern" ],
                    41986: [ "Indicates the exposure mode set when the image was shot.", "ExposureMode", {
                        0: "Auto exposure",
                        1: "Manual exposure",
                        2: "Auto bracket"
                    } ],
                    41987: [ "Indicates the white balance mode set when the image was shot.", "WhiteBalance" ],
                    41989: [ "Indicates the equivalent focal length assuming a 35mm film camera, in mm.", "FocalLengthIn35mmFilm" ],
                    41992: [ "Indicates the direction of contrast processing applied by the camera when the image was shot.", "Contrast" ],
                    41993: [ "Indicates the direction of saturation processing applied by the camera when the image was shot.", "Saturation" ],
                    41994: [ "Indicates the direction of sharpness processing applied by the camera when the image was shot.", "Sharpness" ],
                    41995: [ "This tag indicates information on the picture-taking conditions of a particular camera model.", "DeviceSettingDescription" ],
                    42016: [ "Indicates an identifier assigned uniquely to each image.", "ImageUniqueID" ]
                };
                return this;
            },
            findPreviewIFD: function(e) {
                if (this.isCompressedJPG(e)) return {
                    ifd: e,
                    previewType: "compressedJPG"
                };
                if (e.SubIFDs) {
                    for (var t = 0; t < e.SubIFDs.length; t++) {
                        var i = e.SubIFDs[t];
                        if (this.isCompressedJPG(i)) return {
                            ifd: i,
                            previewType: "compressedJPG"
                        };
                    }
                }
                if (this.isUncompressedRGB(e)) {
                    return {
                        ifd: e,
                        previewType: "uncompressedRGB"
                    };
                }
                if (this.isUncompressedRGBA(e)) {
                    return {
                        ifd: e,
                        previewType: "uncompressedRGBA"
                    };
                }
                if (this.isCompressedJPG(e)) {
                    return {
                        ifd: e,
                        previewType: "compressedJPG"
                    };
                }
                throw "Camera is unsupported. Cannot find preview IFD";
                return null;
            },
            findRawIFD: function(e) {
                if (this.isRaw(e)) return e;
                if (e.SubIFDs) {
                    for (var t = 0; t < e.SubIFDs.length; t++) {
                        var i = e.SubIFDs[t];
                        if (this.isRaw(i)) return i;
                    }
                }
                throw "Camera is unsupported. Cannot find raw IFD";
                return null;
            },
            organizePreviewIFD: function(e) {
                var t = this.findPreviewIFD(e);
                return {
                    PreviewType: t.previewType,
                    Orientation: t.ifd.Orientation || e.Orientation,
                    Width: t.ifd.ImageWidth,
                    Height: t.ifd.ImageLength,
                    StartOffset: t.ifd.StripOffsets,
                    EndOffset: t.ifd.StripOffsets + t.ifd.StripByteCounts
                };
            },
            organizeExifIFD: function(e) {
                var t = this.findRawIFD(e);
                var i = e.ExifIFD;
                var n = this.tifftags[37385][2][i.Flash];
                var r = this.tifftags[34850][2][i.ExposureProgram];
                var a = t && t.ImageWidth || i && i.PixelXDimension || e.ImageWidth;
                var o = t && t.ImageLength || i && i.PixelYDimension || e.ImageLength;
                var s = i.DateTimeOriginal;
                if (!s || s === "0000:00:00 00:00:00") {
                    s = "N/A";
                }
                var l = {
                    ImageWidth: {
                        rawValue: a,
                        unit: "px",
                        name: "Image Width",
                        value: a ? a + "px" : "N/A"
                    },
                    ImageHeight: {
                        rawValue: o,
                        unit: "px",
                        name: "Image Height",
                        value: o ? o + "px" : "N/A"
                    },
                    ImageSize: {
                        rawValue: a + "x" + o,
                        unit: "px",
                        name: "Image Size",
                        value: a + "x" + o + "px"
                    },
                    Model: {
                        rawValue: e.Model,
                        unit: "",
                        name: "Model",
                        value: e.Model
                    },
                    WhiteBalance: {
                        rawValue: i.WhiteBalance,
                        unit: "",
                        name: "White Balance",
                        value: i.WhiteBalance == 0 ? "Auto" : "Manual"
                    },
                    Aperture: {
                        rawValue: i.FNumber,
                        unit: "",
                        name: "Aperture",
                        value: i.FNumber ? "f" + i.FNumber : "N/A"
                    },
                    CreateDate: {
                        rawValue: i.DateTimeOriginal,
                        unit: "",
                        name: "Create Date",
                        value: Utils.formatDate(s)
                    },
                    ExposureProgram: {
                        rawValue: i.ExposureProgram,
                        unit: "",
                        name: "Exposure Program",
                        value: r
                    },
                    ExposureTime: {
                        rawValue: i.ExposureTime,
                        unit: "",
                        name: "Exposure Time",
                        value: i.ExposureTime ? "1/" + ~~(1 / i.ExposureTime) + " sec" : "N/A"
                    },
                    Flash: {
                        rawValue: i.Flash,
                        unit: "",
                        name: "Flash",
                        value: n
                    },
                    FocalLength: {
                        rawValue: i.FocalLength,
                        unit: "",
                        name: "Focal Length",
                        value: i.FocalLength ? i.FocalLength + " mm" : "N/A"
                    },
                    ISO: {
                        rawValue: i.ISOSpeedRatings,
                        unit: "",
                        name: "ISO",
                        value: i.ISOSpeedRatings + ""
                    }
                };
                var c = i.Makernote && i.Makernote.ColorData;
                if (c) l.ColorData = c;
                return l;
            },
            organizeRawIFD: function(e) {
                var t = this.findRawIFD(e);
                return t;
            },
            _organizeMetadata: function(e) {
                var t = this.organizePreviewIFD(e);
                var i = this.organizeRawIFD(e);
                var n = this.organizeExifIFD(e);
                return {
                    root: e,
                    preview: t,
                    raw: i,
                    exif: n
                };
            },
            parseFile: function(e) {
                this.readFromFile = true;
                var t = this.data;
                var i = this.parseEndian(t);
                var n = this.getIfdOffset(t);
                var r = this.parseIFD(t, n, false);
                var a = r.next_ifd;
                while (a) {
                    r.SubIFDs = r.SubIFDs || [];
                    var o = this.parseIFD(t, a, false);
                    r.SubIFDs.push(o);
                    a = o.next_ifd;
                }
                return this._organizeMetadata(r);
            },
            parse: function() {
                if (this.dataUrl) {
                    this.loadData(this.dataUrl, 0, this.fileHeaderSize);
                } else {
                    this.data = arrayBuffer;
                }
                var e = this.parseEndian(this.data);
                var t = this.getIfdOffset(this.data);
                var i = null;
                if (parseInt(this.dataSize) - t > this.firstPayloadSize) {
                    i = this.firstPayloadSize;
                } else {
                    i = parseInt(this.dataSize) - t + 1;
                }
                if (this.includeFieldsFilter.length > 0) {
                    this.setIncludeFieldsFilter(this.includeFieldsFilter);
                }
                if (this.excludeFieldsFilter.length > 0) {
                    this.setExcludeFieldsFilter(this.excludeFieldsFilter);
                }
                this.loadData(this.dataUrl, t, i);
                var n = this.parseIFD(this.data, t, this.skipInlineValues);
                var r = n.next_ifd;
                while (r) {
                    n.SubIFDs = n.SubIFDs || [];
                    this.loadData(this.dataUrl, r, this.firstPayloadSize);
                    var a = this.parseIFD(this.data, r, false);
                    n.SubIFDs.push(a);
                    r = a.next_ifd;
                }
                return this._organizeMetadata(n);
            },
            isCompressedJPG: function(e) {
                return e["NewSubfileType"] === 1 && e["Compression"] === 7;
            },
            isUncompressedRGB: function(e) {
                var t = 3;
                return e["NewSubfileType"] === 1 && e["Compression"] === 1 && e["ImageLength"] * e["ImageWidth"] * t === e["StripByteCounts"];
            },
            isUncompressedRGBA: function(e) {
                var t = 4;
                return e["NewSubfileType"] === 1 && e["Compression"] === 1 && e["ImageLength"] * e["ImageWidth"] * t === e["StripByteCounts"];
            },
            isRaw: function(e) {
                return e.NewSubfileType == 0 && e.Compression == 7 || e.NewSubfileType == 0 && e.Compression == 1;
            },
            prettifyValue: function(e, t) {
                var i = this.tifftags;
                for (var n in i) {
                    var r = i[n];
                    if (r[1] === e) {
                        return r[2] ? r[2][t] || t : t;
                    }
                }
                return t;
            },
            prettifyIFD: function(e) {
                var t = {};
                for (var i in e) {
                    var n = i;
                    var r = e[i];
                    t[n] = this.prettifyValue(n, r);
                }
                return t;
            },
            IFDHasTag: function(e, t) {
                for (var i in e) {
                    if (i === t) {
                        return true;
                    }
                }
                return false;
            },
            parseNum: function(e, i, n, r) {
                var a;
                var o;
                var s = e === ">";
                if (n === t) n = 0;
                if (r === t) r = i.length - n;
                for (s ? a = 0 : a = r - 1; s ? a < r : a >= 0; s ? a++ : a--) {
                    o <<= 8;
                    o += i.getUint8(a + n);
                }
                a = null;
                s = null;
                return o;
            },
            parseSnum: function(e, i, n, r) {
                var a;
                var o;
                var s;
                var l = e === ">";
                if (n === t) n = 0;
                if (r === t) r = i.length - n;
                for (l ? a = 0 : a = r - 1; l ? a < r : a >= 0; l ? a++ : a--) {
                    if (s === t) {
                        s = (i.getUint8(a + n) & 128) === 128;
                    }
                    o <<= 8;
                    o += s ? ~i.getUint8(a + n) & 255 : i.getUint8(a + n);
                }
                if (s) {
                    o += 1;
                    o *= -1;
                }
                a = null;
                s = null;
                l = null;
                return o;
            },
            parseASCII: function(e, t, i) {
                var n = e;
                var r = t;
                var a = "";
                for (var o = 0; o < i; o++) {
                    a = a + String.fromCharCode(n.getUint8(r + o));
                }
                a = a.split("\x00")[0];
                return a;
            },
            parseInteger: function(e, t, i, n) {
                var r = e;
                var a = t;
                var o = new Array(i);
                for (var s = 0; s < i; s++, a += n) {
                    o[s] = this.parseNum(this.endian, r, a, n);
                }
                if (i === 1) {
                    o = o[0];
                }
                return o;
            },
            parseSinteger: function(e, t, i, n) {
                var r = e;
                var a = t;
                var o = new Array(i);
                for (var s = 0; s < i; s++, a += n) {
                    o[s] = this.parseSnum(this.endian, r, a, n);
                }
                if (i === 1) {
                    o = o[0];
                }
                return o;
            },
            parseRational: function(e, t, i, n) {
                var r = e;
                var a = t;
                var o, s;
                var l = new Array(i);
                for (var c = 0; c < i; c++, a += n) {
                    o = this.parseNum(this.endian, r, a, 4);
                    s = this.parseNum(this.endian, r, a + 4, 4);
                    l[c] = o / s;
                }
                if (i === 1) {
                    l = l[0];
                }
                return l;
            },
            parseSrational: function(e, t, i, n) {
                var r = e;
                var a = t;
                var o, s;
                var l = new Array(i);
                for (var c = 0; c < i; c++, a += n) {
                    o = this.parseSnum(this.endian, r, a, 4);
                    s = this.parseSnum(this.endian, r, a + 4, 4);
                    l[c] = o / s;
                }
                if (i === 1) {
                    l = l[0];
                }
                return l;
            },
            parseFloat_: function(e, t, i, n) {
                var r = e;
                var a = t;
                var o = new Float32Array(i);
                for (var s = 0; s < i; s++) {
                    o[s] = r.getFloat32(t + s);
                }
                return o;
            },
            parseValue: function(e, t, i, n, r, a, o) {
                var s = t;
                var l = i;
                if (!a) {
                    if (a) {
                        l = i - this.ifdOffset;
                    } else {
                        this.loadData(this.dataUrl, i, n * r);
                    }
                }
                var c;
                if (e == "ASCII") {
                    c = this.parseASCII(s, l, n);
                } else if (e == "FLOAT") {
                    c = this.parseFloat_(s, l, n);
                } else if (e == "BYTE" || e == "SHORT" || e == "LONG") {
                    c = this.parseInteger(s, l, n, r);
                } else if (e == "SBYTE" || e == "SSHORT" || e == "SLONG") {
                    c = this.parseSinteger(s, l, n, r);
                } else if (e == "RATIONAL") {
                    c = this.parseRational(s, l, n, 8);
                } else if (e == "SRATIONAL") {
                    c = this.parseSrational(s, l, n, 8);
                } else if (e == "IFD") {
                    c = this.parseIFD(s, l, o.skipReferenceValues, o.overrideTags);
                } else {
                    c = "?";
                }
                return c;
            },
            parseEndian: function(e) {
                if (e.byteLength < 4) {
                    throw new Error("The file is too short - " + this._binary_data.length + " bytes");
                }
                var t = String.fromCharCode.apply(null, [ e.getUint8(0), e.getUint8(1) ]);
                if (t === "II" || t === "FO") {
                    this.endian = "<";
                } else if (t === "MM") {
                    this.endian = ">";
                } else {
                    throw new Error("Malformed TIFF meta-data. Unknown endianess: " + t);
                }
                return this.endian;
            },
            getIfdOffset: function(e) {
                return this.parseNum(this.endian, e, 4, 4);
            },
            parseRootIfdOffset: function(e, t) {
                var i = this.parseNum(this.endian, e, t, 4);
                return i;
            },
            parseMagicField: function(e, t) {
                var i = this.parseNum(this.endian, e, t, 2);
                if (i !== 42) {
                    throw new Error("Malformed TIFF meta-data. Bad magic: " + i);
                }
                return i;
            },
            parseFieldsCount: function(e, t) {
                var i = this.parseNum(this.endian, e, t, 2);
                return i;
            },
            setIncludeFieldsFilter: function(e) {
                this.includeFieldsFilter = e;
            },
            setExcludeFieldsFilter: function(e) {
                this.excludeFieldsFilter = e;
            },
            setIFDOffset: function(e) {
                this.ifdOffset = e;
            },
            parseMakernote: function(e, t) {
                return {};
            },
            parseIFD: function(e, t, i, n) {
                var r = n || this.tifftags;
                var a = new Object();
                var o = new Array();
                if (!e) {
                    alert("Data is null again");
                }
                var s = this.parseNum(this.endian, e, t, 2);
                var l, c;
                var u;
                var f;
                var d, h, p, g;
                var m;
                var v;
                var y;
                var b;
                var w;
                for (var l = 0; l < s; l++) {
                    u = t + 2 + l * 12;
                    f = this.parseNum(this.endian, e, u, 2);
                    h = this.parseNum(this.endian, e, u + 2, 2);
                    m = this.parseNum(this.endian, e, u + 4, 4);
                    v = this.parseNum(this.endian, e, u + 8, 4);
                    if (!this.tifftypes[h]) {
                        continue;
                    }
                    if (!r[f]) {
                        continue;
                    }
                    if (!!this.includeFieldsFilter.length && this.includeFieldsFilter.indexOf(f) == -1 && f != 330) {
                        continue;
                    }
                    if (!!this.excludeFieldsFilter.length && this.excludeFieldsFilter.indexOf(f) != -1 && f != 330) {
                        continue;
                    }
                    p = this.tifftypes[h][0];
                    g = this.tifftypes[h][1];
                    var C = g * m <= 4;
                    if (C) {
                        v = u + 8;
                    } else {
                        v = v + 0;
                        if (i && f != 322 && f != 323 && f != 324 && f != 325 && f != 50721 && f != 50722 && f != 50964 && f != 50965 && f != 50723 && f != 50724 && f != 50727 && f != 50728) continue;
                    }
                    if (f == 330) {
                        var x = this.parseValue(p, e, v, m, g, C);
                        for (var c = 0; c < x.length; c++) {
                            a.SubIFDs = a.SubIFDs || [];
                            this.loadData(this.dataUrl, x[c], this.firstPayloadSize);
                            var _ = this.parseIFD(e, x[c], i);
                            a.SubIFDs.push(_);
                        }
                        continue;
                    }
                    if (f == 34665) {
                        var S = this.parseValue(p, e, v, m, g, C);
                        var k = this.includeFieldsFilter;
                        var A = this.excludeFieldsFilter;
                        this.setIncludeFieldsFilter([]);
                        this.setExcludeFieldsFilter([]);
                        this.loadData(this.dataUrl, S, this.firstPayloadSize);
                        var E = this.parseIFD(e, S, false);
                        a["ExifIFD"] = E;
                        this.setIncludeFieldsFilter(k);
                        this.setExcludeFieldsFilter(A);
                        continue;
                    }
                    if (f === 50740) {
                        continue;
                    }
                    if (f === 258) {
                        this.bitsPerSample = y;
                    }
                    if (f === 37500) {
                        var T = this.parseMakernote(e, v);
                        a["Makernote"] = T;
                    }
                    y = this.parseValue(p, e, v, m, g, C);
                    if (f === 271) {
                        this.make = y;
                    }
                    if (f === 272) {
                        this.model = y;
                    }
                    if (f === 258) {
                        this.bitsPerSample = y;
                    }
                    a[r[f][1]] = y;
                    o.push(f);
                }
                a["endian"] = this.endian;
                a["next_ifd"] = this.parseNum(this.endian, e, u + 12, 4);
                a["available_names"] = o;
                a["offset"] = t;
                a = this.postProcessing(a);
                return a;
            },
            postProcessing: function(e) {
                e["ActiveArea"] = e.ActiveArea || [ 0, 0, e["ImageLength"], e["ImageWidth"] ];
                e["AnalogBalance"] = e["AnalogBalance"] || [ 1, 1, 1 ];
                if (!e["TileOffsets"]) {
                    e["TileOffsets"] = [ e["StripOffsets"] ];
                    e["TileByteCounts"] = [ e["StripByteCounts"] ];
                    e["TileWidth"] = e["ImageWidth"];
                    e["TileLength"] = e["ImageLength"];
                }
                return e;
            },
            loadedDataIntervals: [],
            registerInterval: function(e, t) {
                var i = this.checkInterval(e, t);
                if (i.status === "contained") return;
                if (i.status === "leftintersect") {
                    i.container.end = t;
                }
                if (i.status === "rightintersect") {
                    i.container.start = e;
                }
                if (i.status === "notcontained") {
                    this.loadedDataIntervals.push({
                        start: e,
                        end: t
                    });
                }
            },
            checkInterval: function(e, t) {
                for (var i = 0; i < this.loadedDataIntervals.length; i++) {
                    var n = this.loadedDataIntervals[i];
                    if (e >= n.start && t <= n.end) {
                        return {
                            status: "contained",
                            container: n
                        };
                    }
                    if (e >= n.start && e <= n.end && t > n.end) {
                        return {
                            status: "leftintersect",
                            container: n,
                            start: n.end,
                            end: t
                        };
                    }
                    if (e < n.start && t <= n.end && t >= n.start) {
                        return {
                            status: "rightintersect",
                            container: n,
                            start: e,
                            end: n.start
                        };
                    }
                }
                return {
                    status: "notcontained",
                    start: e,
                    end: t
                };
            },
            loadData: function(e, t, i) {
                if (this.readFromFile) return;
                var n = this.checkInterval(t, t + i);
                if (n.status === "contained") return;
                if (n.status === "leftintersect" && n.end - n.start < this.firstPayloadSize) {
                    n.end += this.firstPayloadSize;
                }
                var r = new XMLHttpRequest();
                r.open("GET", e, false);
                r.responseType = "arraybuffer";
                r.setRequestHeader("range", "bytes=" + n.start + "-" + n.end);
                r.send();
                var a = new Uint8Array(this.data.buffer);
                a.set(new Uint8Array(r.response), n.start);
                this.registerInterval(n.start, n.end);
            }
        });
        IFDParser.buildParser = function(e) {
            var t;
            if (e === "image/x-canon-cr2") t = new (CR2IFDParser || IFDParsers.CR2IFDParser)(); else if (e === "image/x-nikon-nef") t = new (NEFIFDParser || IFDParsers.NEFIFDParser)(); else if (e === "image/x-sony-arw") t = new (ARWIFDParser || IFDParsers.ARWIFDParser)(); else if (e === "image/x-olympus-orf") t = new (ORFIFDParser || IFDParsers.ORFIFDParser)(); else t = new (IFDParser || IFDParsers.IFDParser)();
            return t;
        };
        return IFDParser;
    };
    if (typeof define === "function") {
        define("IFDParsers/IFDParser", [ "utils" ], function(Utils) {
            return i(Utils);
        });
    } else {
        if (typeof e.IFDParser === "undefined") {
            e.IFDParser = i(e.Utils);
        }
    }
})(this);

(function(e, t) {
    var i = function(IFDParser, Utils) {
        var CR2IFDParser = Utils.extend(IFDParser, {
            init: function(e) {
                this.base().init(e);
                return this;
            },
            isCompressedJPG: function(e) {
                return e["Compression"] === 6;
            },
            isRaw: function(e) {
                return e.hasOwnProperty("50648");
            },
            parseColorData1: function(e, t) {
                var i = {};
                i.AsShot = {
                    title: "As shot",
                    rggblevels: this.parseInteger(e, t + 25 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 29 * 2, 1, 2)
                };
                i.Auto = {
                    title: "Auto",
                    rggblevels: this.parseInteger(e, t + 30 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 34 * 2, 1, 2)
                };
                i.Daylight = {
                    title: "Daylight",
                    rggblevels: this.parseInteger(e, t + 35 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 29 * 2, 1, 2)
                };
                i.Shade = {
                    title: "Shade",
                    rggblevels: this.parseInteger(e, t + 40 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 44 * 2, 1, 2)
                };
                i.Cloudy = {
                    title: "Cloudy",
                    rggblevels: this.parseInteger(e, t + 45 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 49 * 2, 1, 2)
                };
                i.Tungsten = {
                    title: "Tungsten",
                    rggblevels: this.parseInteger(e, t + 50 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 54 * 2, 1, 2)
                };
                i.Fluorescent = {
                    title: "Fluorescent",
                    rggblevels: this.parseInteger(e, t + 55 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 59 * 2, 1, 2)
                };
                i.Flash = {
                    title: "Flash",
                    rggblevels: this.parseInteger(e, t + 60 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 64 * 2, 1, 2)
                };
                i.Custom1 = {
                    title: "Custom1",
                    rggblevels: this.parseInteger(e, t + 65 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 69 * 2, 1, 2)
                };
                i.Custom2 = {
                    title: "Custom2",
                    rggblevels: this.parseInteger(e, t + 70 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 74 * 2, 1, 2)
                };
                return i;
            },
            parseColorData2: function(e, t) {
                var i = {};
                i.Auto = {
                    title: "Auto",
                    rggblevels: this.parseInteger(e, t + 24 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 28 * 2, 1, 2)
                };
                i.AsShot = {
                    title: "AsShot",
                    rggblevels: this.parseInteger(e, t + 34 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 38 * 2, 1, 2)
                };
                i.Daylight = {
                    title: "Daylight",
                    rggblevels: this.parseInteger(e, t + 39 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 43 * 2, 1, 2)
                };
                i.Shade = {
                    title: "Shade",
                    rggblevels: this.parseInteger(e, t + 44 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 48 * 2, 1, 2)
                };
                i.Cloudy = {
                    title: "Cloudy",
                    rggblevels: this.parseInteger(e, t + 49 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 53 * 2, 1, 2)
                };
                i.Tungsten = {
                    title: "Tungsten",
                    rggblevels: this.parseInteger(e, t + 54 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 58 * 2, 1, 2)
                };
                i.Fluorescent = {
                    title: "Fluorescent",
                    rggblevels: this.parseInteger(e, t + 59 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 63 * 2, 1, 2)
                };
                i.Kelvin = {
                    title: "Kelvin",
                    rggblevels: this.parseInteger(e, t + 64 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 68 * 2, 1, 2)
                };
                i.Flash = {
                    title: "Flash",
                    rggblevels: this.parseInteger(e, t + 69 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 73 * 2, 1, 2)
                };
                i.PC1 = {
                    title: "PC1",
                    rggblevels: this.parseInteger(e, t + 144 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 148 * 2, 1, 2)
                };
                i.PC2 = {
                    title: "PC2",
                    rggblevels: this.parseInteger(e, t + 149 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 153 * 2, 1, 2)
                };
                i.PC3 = {
                    title: "PC3",
                    rggblevels: this.parseInteger(e, t + 154 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 158 * 2, 1, 2)
                };
                return i;
            },
            parseColorData3: function(e, t) {
                var i = {};
                i.AsShot = {
                    title: "AsShot",
                    rggblevels: this.parseInteger(e, t + 63 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 67 * 2, 1, 2)
                };
                i.Auto = {
                    title: "Auto",
                    rggblevels: this.parseInteger(e, t + 68 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 72 * 2, 1, 2)
                };
                i.Measured = {
                    title: "Measured",
                    rggblevels: this.parseInteger(e, t + 73 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 77 * 2, 1, 2)
                };
                i.Daylight = {
                    title: "Daylight",
                    rggblevels: this.parseInteger(e, t + 78 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 82 * 2, 1, 2)
                };
                i.Shade = {
                    title: "Shade",
                    rggblevels: this.parseInteger(e, t + 83 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 87 * 2, 1, 2)
                };
                i.Cloudy = {
                    title: "Cloudy",
                    rggblevels: this.parseInteger(e, t + 88 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 92 * 2, 1, 2)
                };
                i.Tungsten = {
                    title: "Tungsten",
                    rggblevels: this.parseInteger(e, t + 93 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 97 * 2, 1, 2)
                };
                i.Fluorescent = {
                    title: "Fluorescent",
                    rggblevels: this.parseInteger(e, t + 98 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 102 * 2, 1, 2)
                };
                i.Kelvin = {
                    title: "Kelvin",
                    rggblevels: this.parseInteger(e, t + 103 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 107 * 2, 1, 2)
                };
                i.Flash = {
                    title: "Flash",
                    rggblevels: this.parseInteger(e, t + 108 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 112 * 2, 1, 2)
                };
                i.PC1 = {
                    title: "PC1",
                    rggblevels: this.parseInteger(e, t + 113 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 117 * 2, 1, 2)
                };
                i.PC2 = {
                    title: "PC2",
                    rggblevels: this.parseInteger(e, t + 118 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 122 * 2, 1, 2)
                };
                i.PC3 = {
                    title: "PC3",
                    rggblevels: this.parseInteger(e, t + 123 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 127 * 2, 1, 2)
                };
                i.Custom = {
                    title: "Custom",
                    rggblevels: this.parseInteger(e, t + 128 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 132 * 2, 1, 2)
                };
                return i;
            },
            parseColorData4: function(e, t) {
                t += 126;
                var i = {};
                i.AsShot = {
                    title: "AsShot",
                    rggblevels: this.parseInteger(e, t, 4, 2),
                    temperature: this.parseInteger(e, t + 4 * 2, 1, 2)
                };
                i.Auto = {
                    title: "Auto",
                    rggblevels: this.parseInteger(e, t + 5 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 9 * 2, 1, 2)
                };
                i.Measured = {
                    title: "Measured",
                    rggblevels: this.parseInteger(e, t + 10 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 14 * 2, 1, 2)
                };
                i.Daylight = {
                    title: "Daylight",
                    rggblevels: this.parseInteger(e, t + 20 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 24 * 2, 1, 2)
                };
                i.Shade = {
                    title: "Shade",
                    rggblevels: this.parseInteger(e, t + 25 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 29 * 2, 1, 2)
                };
                i.Cloudy = {
                    title: "Cloudy",
                    rggblevels: this.parseInteger(e, t + 30 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 34 * 2, 1, 2)
                };
                i.Tungsten = {
                    title: "Tungsten",
                    rggblevels: this.parseInteger(e, t + 35 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 39 * 2, 1, 2)
                };
                i.Fluorescent = {
                    title: "Fluorescent",
                    rggblevels: this.parseInteger(e, t + 40 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 44 * 2, 1, 2)
                };
                i.Kelvin = {
                    title: "Kelvin",
                    rggblevels: this.parseInteger(e, t + 45 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 49 * 2, 1, 2)
                };
                i.Flash = {
                    title: "Flash",
                    rggblevels: this.parseInteger(e, t + 50 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 54 * 2, 1, 2)
                };
                return i;
            },
            parseColorData6: function(e, t) {
                var i = {};
                i.AsShot = {
                    title: "AsShot",
                    rggblevels: this.parseInteger(e, t + 63 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 67 * 2, 1, 2)
                };
                i.Auto = {
                    title: "Auto",
                    rggblevels: this.parseInteger(e, t + 68 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 72 * 2, 1, 2)
                };
                i.Measured = {
                    title: "Measured",
                    rggblevels: this.parseInteger(e, t + 73 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 77 * 2, 1, 2)
                };
                i.Daylight = {
                    title: "Daylight",
                    rggblevels: this.parseInteger(e, t + 103 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 107 * 2, 1, 2)
                };
                i.Shade = {
                    title: "Shade",
                    rggblevels: this.parseInteger(e, t + 108 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 112 * 2, 1, 2)
                };
                i.Cloudy = {
                    title: "Cloudy",
                    rggblevels: this.parseInteger(e, t + 113 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 117 * 2, 1, 2)
                };
                i.Tungsten = {
                    title: "Tungsten",
                    rggblevels: this.parseInteger(e, t + 118 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 122 * 2, 1, 2)
                };
                i.Fluorescent = {
                    title: "Fluorescent",
                    rggblevels: this.parseInteger(e, t + 123 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 127 * 2, 1, 2)
                };
                i.Kelvin = {
                    title: "Kelvin",
                    rggblevels: this.parseInteger(e, t + 128 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 132 * 2, 1, 2)
                };
                i.Flash = {
                    title: "Flash",
                    rggblevels: this.parseInteger(e, t + 133 * 2, 4, 2),
                    temperature: this.parseInteger(e, t + 137 * 2, 1, 2)
                };
                return i;
            },
            parseColorData: function(e, t) {
                var i = {
                    "Canon EOS 20D": this.parseColorData1,
                    "Canon EOS 350D DIGITAL": this.parseColorData1,
                    "Canon EOS REBEL XT": this.parseColorData1,
                    "Canon EOS DIGITAL REBEL XT": this.parseColorData1,
                    "Canon EOS Kiss Digital N": this.parseColorData1,
                    "Canon EOS-1D Mark II": this.parseColorData2,
                    "Canon EOS-1Ds Mark II": this.parseColorData2,
                    "Canon EOS 400D DIGITAL": this.parseColorData3,
                    "Canon EOS REBEL XTi": this.parseColorData3,
                    "Canon EOS DIGITAL REBEL XTi": this.parseColorData3,
                    "Canon EOS Kiss X": this.parseColorData3,
                    "Canon EOS 30D": this.parseColorData3,
                    "Canon EOS 5D": this.parseColorData3,
                    "Canon EOS-1D Mark II N": this.parseColorData3,
                    "Canon EOS 450D": this.parseColorData4,
                    "Canon EOS REBEL XSi": this.parseColorData4,
                    "Canon EOS DIGITAL REBEL XSi": this.parseColorData4,
                    "Canon EOS Kiss X2": this.parseColorData4,
                    "Canon EOS 1000D": this.parseColorData4,
                    "Canon EOS REBEL XS": this.parseColorData4,
                    "Canon EOS DIGITAL REBEL XS": this.parseColorData4,
                    "Canon EOS Kiss F": this.parseColorData4,
                    "Canon EOS 40D": this.parseColorData4,
                    "Canon EOS 50D": this.parseColorData4,
                    "Canon EOS 5D Mark II": this.parseColorData4,
                    "Canon EOS 500D": this.parseColorData4,
                    "Canon EOS REBEL T1i": this.parseColorData4,
                    "Canon EOS DIGITAL REBEL T1i": this.parseColorData4,
                    "Canon EOS Kiss X3 Digital": this.parseColorData4,
                    "Canon EOS 550D": this.parseColorData4,
                    "Canon EOS REBEL T2i": this.parseColorData4,
                    "Canon EOS DIGITAL REBEL T2i": this.parseColorData4,
                    "Canon EOS Kiss X4 Digital": this.parseColorData4,
                    "Canon EOS 7D": this.parseColorData4,
                    "Canon EOS-1Ds Mark III": this.parseColorData4,
                    "Canon EOS-1D Mark III": this.parseColorData4,
                    "Canon EOS-1D Mark IV": this.parseColorData4,
                    "Canon EOS 60D": this.parseColorData4,
                    "Canon EOS 1100D": this.parseColorData4,
                    "Canon EOS REBEL T3": this.parseColorData4,
                    "Canon EOS DIGITAL REBEL T3": this.parseColorData4,
                    "Canon EOS Kiss X50": this.parseColorData4,
                    "Canon EOS 70D": this.parseColorData6,
                    "Canon EOS-1D X": this.parseColorData6,
                    "Canon EOS 5D Mark III": this.parseColorData6,
                    "Canon EOS 6D": this.parseColorData6,
                    "Canon EOS 100D": this.parseColorData6,
                    "Canon EOS REBEL SL1": this.parseColorData6,
                    "Canon EOS DIGITAL REBEL SL1": this.parseColorData6,
                    "Canon EOS Kiss X7": this.parseColorData6,
                    "Canon EOS 1200D": this.parseColorData6,
                    "Canon EOS 600D": this.parseColorData6,
                    "Canon EOS REBEL T3i": this.parseColorData6,
                    "Canon EOS DIGITAL REBEL T3i": this.parseColorData6,
                    "Canon EOS Kiss X5": this.parseColorData6,
                    "Canon EOS 650D": this.parseColorData6,
                    "Canon EOS REBEL T4i": this.parseColorData6,
                    "Canon EOS DIGITAL REBEL T4i": this.parseColorData6,
                    "Canon EOS Kiss X6i": this.parseColorData6,
                    "Canon EOS 700D": this.parseColorData6,
                    "Canon EOS REBEL T5i": this.parseColorData6,
                    "Canon EOS DIGITAL REBEL T5i": this.parseColorData6,
                    "Canon EOS Kiss X7i": this.parseColorData6,
                    "Canon EOS M": this.parseColorData6
                };
                var n = i[this.model];
                var r = n && n.call(this, e, t) || {};
                Object.keys(r, function(e, t) {
                    var i = t.rggblevels || [ 2.085934, 1, 1, 1.375979 ];
                    i = [ i[0], (i[1] + i[2]) / 2, i[3] ];
                    r[e]["levels"] = [ i[1] / i[0], 1, i[1] / i[2] ];
                });
                return r;
            },
            parseMakernote: function(e, t) {
                var i = {
                    16385: {
                        TagID: 16385,
                        TagName: "ColorData"
                    }
                };
                var n = this.parseNum(this.endian, e, t, 2);
                var r = {};
                for (var a = 0; a < n; a++) {
                    var o = t + 2 + 12 * a;
                    var s = this.parseNum(this.endian, e, o, 2);
                    var l = this.parseNum(this.endian, e, o + 2, 2);
                    var c = this.parseNum(this.endian, e, o + 4, 4);
                    var u = this.parseNum(this.endian, e, o + 8, 4);
                    if (s === 16385) {
                        var f = this.parseColorData(e, u);
                        var d = i[s].TagName;
                        r[d] = f;
                    }
                }
                return r;
            }
        });
        return CR2IFDParser;
    };
    if (typeof define === "function") {
        define("IFDParsers/CR2IFDParser", [ "IFDParsers/IFDParser", "utils" ], function(IFDParser, Utils) {
            return i(IFDParser, Utils);
        });
    } else {
        if (typeof e.CR2IFDParser === "undefined") {
            e.CR2IFDParser = i(e.IFDParser, e.Utils);
        }
    }
})(this);

(function(e, t) {
    var i = function(IFDParser, Utils) {
        var NEFIFDParser = Utils.extend(IFDParser, {
            colorDataCache: {},
            init: function(e) {
                this.base().init(e);
                return this;
            },
            isCompressedJPG: function(e) {
                return e["NewSubfileType"] === 1 && e["Compression"] === 6;
            },
            isRaw: function(e) {
                return e.hasOwnProperty("CFAPattern");
            },
            organizePreviewIFD: function(e) {
                var t = this.findPreviewIFD(e);
                return {
                    PreviewType: t.previewType,
                    Orientation: t.ifd.Orientation || e.Orientation,
                    Width: t.ifd.ImageWidth,
                    Height: t.ifd.ImageLength,
                    StartOffset: t.ifd.JPEGInterchangeFormat,
                    EndOffset: t.ifd.JPEGInterchangeFormat + t.ifd.JPEGInterchangeFormatLength
                };
            },
            parseMakernote: function(e, t) {
                var i = {
                    12: {
                        TagID: 12,
                        TagName: "WB_RBLevels"
                    },
                    150: {
                        TagID: 150,
                        TagName: "NEFLinearizationTable"
                    }
                };
                var n = function(e, t, i) {
                    var n = i === "<";
                    var r = t;
                    var a = 0, o = 0, s = 0, l = 0, c = [], u = [], f = [];
                    s = e.getUint8(r++);
                    l = e.getUint8(r++);
                    if (s == 73 || l == 88) {
                        console.log("ERROR: Cant parse this NEF!");
                        throw new Error("ERROR: Cant parse this NEF");
                        r += 2110;
                    }
                    if (s == 70) o = 2;
                    if (this.bitsPerSample == 14) o += 3;
                    var d = e.getUint16(r, n);
                    var h = e.getUint16(r += 2, n);
                    var p = e.getUint16(r += 2, n);
                    var g = e.getUint16(r += 2, n);
                    c = [ d, h ];
                    u = [ p, g ];
                    for (var m = 0; m < 32768; m++) {
                        f[m] = m;
                    }
                    var v = 1 << this.bitsPerSample & 32767;
                    var y = 0;
                    var b = e.getUint16(r += 2, n);
                    if (b > 1) y = ~~(v / (b - 1));
                    if (s == 68 && l == 32 && y > 0) {
                        for (var m = 0; m < b; m++) f[m * y] = e.getUint16(r += 2, n);
                        for (var m = 0; m < v; m++) f[m] = ~~((f[m - m % y] * (y - m % y) + f[m - m % y + y] * (m % y)) / y);
                        r = t + 562;
                        a = e.getUint16(r, n);
                    } else if (s != 70 && b <= 16385) {
                        for (var m = 0; m < b; m++) {
                            f[m] = e.getUint16(r += 2, n);
                        }
                        v = b;
                    }
                    return {
                        split: a,
                        huffSelect: o,
                        v0: s,
                        v1: l,
                        pUp1: c,
                        pUp2: u,
                        curve: f
                    };
                }.bind(this);
                var r = this.parseNum(">", e, t + 10, 2, 2);
                r = r === 19789 ? ">" : "<";
                var a = t + 18;
                var o = a - 8;
                var s = new Object();
                var l = this.parseNum(r, e, a, 2);
                var c, u;
                var f;
                var d;
                var h, p, g, m;
                var v;
                var y;
                var b;
                for (var c = 0; c < l; c++) {
                    f = a + 2 + c * 12;
                    d = this.parseNum(r, e, f, 2);
                    p = this.parseNum(r, e, f + 2, 2);
                    v = this.parseNum(r, e, f + 4, 4);
                    y = this.parseNum(r, e, f + 8, 4);
                    if (d === 12) {
                        b = this.parseRational(e, o + y, 4, 8);
                        var w = i[d].TagName;
                        s[w] = b;
                        s.ColorData = {
                            AsShot: {
                                title: "As Shot",
                                levels: [ 1 / b[0], 1 / b[2], 1 / b[1] ]
                            }
                        };
                    }
                    if (d === 150) {
                        b = n(e, o + y, r);
                        var w = i[d].TagName;
                        s[w] = b;
                    }
                }
                var C = this.colorDataCache[this.make + " " + this.model];
                if (C) {
                    for (var w in C.ColorData) {
                        var x = [ 1 / C.ColorData[w].levels[0], 1, 1 / C.ColorData[w].levels[2] ];
                        s["ColorData"][w] = C.ColorData[w];
                        s["ColorData"][w].levels = x;
                    }
                }
                return s;
            }
        });
        return NEFIFDParser;
    };
    if (typeof define === "function") {
        define("IFDParsers/NEFIFDParser", [ "IFDParsers/IFDParser", "utils" ], function(IFDParser, Utils) {
            return i(IFDParser, Utils);
        });
    } else {
        if (typeof e.NEFIFDParser === "undefined") {
            e.NEFIFDParser = i(e.IFDParser, e.Utils);
        }
    }
})(this);

(function(e, t) {
    var i = function(IFDParser, Utils) {
        var ARWIFDParser = Utils.extend(IFDParser, {
            init: function(e) {
                this.base().init(e);
                return this;
            },
            isCompressedJPG: function(e) {
                return e["NewSubfileType"] === 1 && e["Compression"] === 6;
            },
            isRaw: function(e) {
                return e.hasOwnProperty("CFAPattern");
            },
            organizePreviewIFD: function(e) {
                var t = this.findPreviewIFD(e);
                var i = t.ifd.ExifIFD.Makernote;
                return {
                    PreviewType: t.previewType,
                    Orientation: t.ifd.Orientation,
                    Width: t.ifd.ImageWidth || i && i.Width,
                    Height: t.ifd.ImageLength || i && i.Height,
                    StartOffset: t.ifd.JPEGInterchangeFormat,
                    EndOffset: t.ifd.JPEGInterchangeFormat + t.ifd.JPEGInterchangeFormatLength
                };
            },
            findRawIFD: function(e) {
                return null;
            },
            organizeRawIFD: function(e) {
                return t;
            },
            parseMakernote: function(e, t) {
                var i = {
                    45100: {
                        TagID: 45100,
                        TagName: "PreviewImageSize"
                    }
                };
                var n = this.parseNum(this.endian, e, t, 2);
                var r = {};
                for (var a = 0; a < n; a++) {
                    var o = t + 2 + 12 * a;
                    var s = this.parseNum(this.endian, e, o, 2);
                    var l = this.parseNum(this.endian, e, o + 2, 2);
                    var c = this.parseNum(this.endian, e, o + 4, 4);
                    var u = this.parseNum(this.endian, e, o + 8, 4);
                    if (s === 45100) {
                        r.Height = this.parseInteger(e, u, 1, 4);
                        r.Width = this.parseInteger(e, u + 4, 1, 4);
                    }
                }
                return r;
            }
        });
        return ARWIFDParser;
    };
    if (typeof define === "function") {
        define("IFDParsers/ARWIFDParser", [ "IFDParsers/IFDParser", "utils" ], function(IFDParser, Utils) {
            return i(IFDParser, Utils);
        });
    } else {
        if (typeof e.ARWIFDParser === "undefined") {
            e.ARWIFDParser = i(e.IFDParser, e.Utils);
        }
    }
})(this);

(function(e, t) {
    var i = function(IFDParser, Utils) {
        var ORFIFDParser = Utils.extend(IFDParser, {
            init: function(e) {
                this.base().init(e);
                this.tifftypes[13] = [ "LONG", 4 ];
                return this;
            },
            isCompressedJPG: function(e) {
                return e.hasOwnProperty("PreviewImageValid") && e.hasOwnProperty("PreviewImageStart") && e.hasOwnProperty("PreviewImageLength");
            },
            isRaw: function(e) {
                throw "Not implemented yet!";
            },
            organizePreviewIFD: function(e) {
                var t = e.ExifIFD.Makernote.CameraSettingsIFD;
                return {
                    PreviewType: "compressedJPG",
                    Orientation: t.Orientation || e.Orientation,
                    Width: t.ImageWidth,
                    Height: t.ImageLength,
                    StartOffset: t.PreviewImageStart,
                    EndOffset: t.PreviewImageStart + t.PreviewImageLength
                };
            },
            findRawIFD: function(e) {
                return null;
            },
            organizeRawIFD: function(e) {
                return t;
            },
            MakernoteTags: {
                8208: {
                    TagID: 8208,
                    TagName: "CameraEquipmentIFD"
                },
                8224: {
                    TagID: 8224,
                    TagName: "CameraSettingsIFD"
                },
                8240: {
                    TagID: 8240,
                    TagName: "RawDevelopmentIFD"
                },
                8241: {
                    TagID: 8241,
                    TagName: "RawDevelopment2IFD"
                },
                8256: {
                    TagID: 8256,
                    TagName: "ImageProcessingIFD"
                },
                8272: {
                    TagID: 8272,
                    TagName: "FocusInfoIFD"
                },
                12288: {
                    TagID: 12288,
                    TagName: "RawInfoIFD"
                }
            },
            CameraSettingsIFDTags: {
                256: [ "PreviewImageValid flag", "PreviewImageValid" ],
                257: [ "Preview Image Start", "PreviewImageStart" ],
                258: [ "Preview Image Length", "PreviewImageLength" ]
            },
            parseMakernote: function(e, t) {
                var i = "<";
                var n = this.parseASCII(this.data, t, 7, 1);
                var r = 8;
                if (n === "OLYMPUS") {
                    i = this.parseNum(">", e, t + 8, 2, 2);
                    i = i === 19789 ? ">" : "<";
                    r = 12;
                    n = 3;
                }
                var a = new Object();
                var o = t + r;
                var s = this.parseNum(i, e, t + r, 2);
                var l, c;
                var u;
                var f;
                var d, h, p, g;
                var m;
                var v;
                var y;
                for (var l = 0; l < s; l++) {
                    u = o + 2 + l * 12;
                    f = this.parseNum(i, e, u, 2);
                    h = this.parseNum(i, e, u + 2, 2);
                    m = this.parseNum(i, e, u + 4, 4);
                    v = this.parseNum(i, e, u + 8, 4);
                    p = this.tifftypes[h][0];
                    g = this.tifftypes[h][1];
                    if (f === 8224) {
                        a.CameraSettingsIFD = this.parseIFD(e, n === 3 ? t + v : v, true, this.CameraSettingsIFDTags);
                        a.CameraSettingsIFD.PreviewImageStart += n === 3 ? t : 0;
                    }
                }
                return a;
            }
        });
        return ORFIFDParser;
    };
    if (typeof define === "function") {
        define("IFDParsers/ORFIFDParser", [ "IFDParsers/IFDParser", "utils" ], function(IFDParser, Utils) {
            return i(IFDParser, Utils);
        });
    } else {
        if (typeof e.ORFIFDParser === "undefined") {
            e.ORFIFDParser = i(e.IFDParser, e.Utils);
        }
    }
})(this);

define("IFDParsers/parsers", [ "require", "./IFDParser", "./CR2IFDParser", "./NEFIFDParser", "./ARWIFDParser", "./ORFIFDParser" ], function(e) {
    return {
        IFDParser: e("./IFDParser"),
        CR2IFDParser: e("./CR2IFDParser"),
        NEFIFDParser: e("./NEFIFDParser"),
        ARWIFDParser: e("./ARWIFDParser"),
        ORFIFDParser: e("./ORFIFDParser")
    };
});

define("IFDParsers", [ "IFDParsers/parsers" ], function(e) {
    return e;
});

(function(e, t) {
    var i = {
        "Canon Canon EOS REBEL SL1": "Canon Canon EOS 100D",
        "Canon Canon EOS DIGITAL REBEL SL1": "Canon Canon EOS 100D",
        "Canon Canon EOS Kiss X7": "Canon Canon EOS 100D",
        "Canon Canon EOS REBEL": "Canon Canon EOS 300D",
        "Canon Canon EOS DIGITAL REBEL": "Canon Canon EOS 300D",
        "Canon Canon EOS Kiss Digital": "Canon Canon EOS 300D",
        "Canon Canon EOS REBEL XT": "Canon Canon EOS 350D",
        "Canon Canon EOS DIGITAL REBEL XT": "Canon Canon EOS 350D",
        "Canon Canon EOS Kiss Digital N": "Canon Canon EOS 350D",
        "Canon Canon EOS REBEL XTi": "Canon Canon EOS 400D",
        "Canon Canon EOS DIGITAL REBEL XTi": "Canon Canon EOS 400D",
        "Canon Canon EOS Kiss X": "Canon Canon EOS 400D",
        "Canon Canon EOS Kiss X Digital": "Canon Canon EOS 400D",
        "Canon Canon EOS REBEL XSi": "Canon Canon EOS 450D",
        "Canon Canon EOS DIGITAL REBEL XSi": "Canon Canon EOS 450D",
        "Canon Canon EOS Kiss X2": "Canon Canon EOS 450D",
        "Canon Canon EOS Kiss X2 Digital": "Canon Canon EOS 450D",
        "Canon Canon EOS REBEL T1i": "Canon Canon EOS 500D",
        "Canon Canon EOS DIGITAL REBEL T1i": "Canon Canon EOS 500D",
        "Canon Canon EOS Kiss X3": "Canon Canon EOS 500D",
        "Canon Canon EOS Kiss X3 Digital": "Canon Canon EOS 500D",
        "Canon Canon EOS REBEL T2i": "Canon Canon EOS 550D",
        "Canon Canon EOS DIGITAL REBEL T2i": "Canon Canon EOS 550D",
        "Canon Canon EOS Kiss X4": "Canon Canon EOS 550D",
        "Canon Canon EOS Kiss X4 Digital": "Canon Canon EOS 550D",
        "Canon Canon EOS REBEL T3i": "Canon Canon EOS 600D",
        "Canon Canon EOS DIGITAL REBEL T3i": "Canon Canon EOS 600D",
        "Canon Canon EOS Kiss X5": "Canon Canon EOS 600D",
        "Canon Canon EOS Kiss X5 Digital": "Canon Canon EOS 600D",
        "Canon Canon EOS REBEL T4i": "Canon Canon EOS 650D",
        "Canon Canon EOS DIGITAL REBEL T4i": "Canon Canon EOS 650D",
        "Canon Canon EOS Kiss X6i": "Canon Canon EOS 650D",
        "Canon Canon EOS REBEL T5i": "Canon Canon EOS 700D",
        "Canon Canon EOS DIGITAL REBEL T5i": "Canon Canon EOS 700D",
        "Canon Canon EOS REBEL T5": "Canon Canon EOS 1200D",
        "Canon Canon EOS DIGITAL REBEL T5": "Canon Canon EOS 1200D",
        "Canon Canon EOS Kiss X70": "Canon Canon EOS 1200D",
        "Canon Canon EOS Kiss X7i": "Canon Canon EOS 700D",
        "Canon Canon EOS REBEL XS": "Canon Canon EOS 1000D",
        "Canon Canon EOS DIGITAL REBEL XS": "Canon Canon EOS 1000D",
        "Canon Canon EOS Kiss F": "Canon Canon EOS 1000D",
        "Canon Canon EOS REBEL T3": "Canon Canon EOS 1100D",
        "Canon Canon EOS DIGITAL REBEL T3": "Canon Canon EOS 1100D",
        "Canon Canon EOS Kiss X50": "Canon Canon EOS 1100D",
        "NIKON CORPORATION NIKON D800E": "NIKON CORPORATION NIKON D800",
        "SONY SLT-A99V": "SONY SLT-A99",
        "SONY DSLR-A100S": "SONY DSLR-A100",
        "SONY DSLR-A300K/N": "DSLR-A300",
        "SONY DSLR-A350K/N": "DSLR-A350",
        "SONY DSLR-A330L/T ": "SONY DSLR-A330",
        "SONY SLT-A65V": "SONY SLT-A65",
        "SONY SLT-A77V": "SONY SLT-A77",
        "SONY NEX-3C": "SONY NEX-3",
        "SONY NEX-5C": "SONY NEX-5"
    };
    var n = {
        "Canon Canon EOS 20D": {
            ReadyForDecoding: true,
            BaselineExposure: .25,
            BaselineNoise: 1.25,
            BaselineSharpness: 1.5,
            AsShotNeutral: [ .5474649362394962, 1, .5928736586233474 ],
            ColorMatrix1: [ .7565, -.168, -.0264, -.6543, 1.3838, .2995, -.0965, .1349, .7631 ],
            ColorMatrix2: [ .6599, -.0537, -.0891, -.8071, 1.5783, .2424, -.1983, .2234, .7462 ],
            ForwardMatrix1: [ .8173, .039, .108, .3841, .6803, -.0643, .1142, -.2778, .9887 ],
            ForwardMatrix2: [ .8057, .0597, .0988, .3948, .7269, -.1217, .0665, -.1473, .9059 ],
            CameraCalibration1: [ .9943, 0, 0, 0, 1, 0, 0, 0, .9003 ],
            CameraCalibration2: [ .9943, 0, 0, 0, 1, 0, 0, 0, .9003 ],
            BlackLevelRepeatDim: [ 1, 1 ],
            CFALayout: 1,
            CFARepeatPatternDim: [ 2, 2 ],
            CFAPlaneColor: [ 0, 1, 2 ],
            CFAPattern: [ 0, 1, 1, 2 ],
            ActiveArea: [ 12, 74, 2360, 3596 ],
            DefaultCropOrigin: [ 10, 7 ],
            DefaultCropSize: [ 3504, 2336 ],
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "red"
                }, {
                    x: 1,
                    y: 0,
                    Color: "green"
                }, {
                    x: 0,
                    y: 1,
                    Color: "green"
                }, {
                    x: 1,
                    y: 1,
                    Color: "blue"
                } ]
            },
            Crop: {
                x: 74,
                y: 12,
                Width: 3522,
                Height: 2348
            },
            Sensor: {
                Black: 126,
                White: 4095
            },
            BlackAreas: [ {
                Offset: 0,
                Size: 72,
                Type: "vertical"
            }, {
                Offset: 2,
                Size: 8,
                Type: "horizontal"
            } ]
        },
        "Canon Canon EOS 30D": {
            ReadyForDecoding: true,
            BaselineExposure: 0,
            BaselineNoise: 1.25,
            BaselineSharpness: 1.5,
            AsShotNeutral: [ .5133688961079964, 1, .5834254659381627 ],
            ColorMatrix1: [ .7162, -.1339, -.0465, -.6462, 1.3801, .2944, -.0838, .1147, .7184 ],
            ColorMatrix2: [ .6257, -.0303, -.1, -.788, 1.5621, .2396, -.1714, .1904, .7046 ],
            ForwardMatrix1: [ .8259, .0184, .12, .3835, .6715, -.055, .1129, -.2582, .9705 ],
            ForwardMatrix2: [ .8001, .0303, .1339, .3876, .7158, -.1034, .0623, -.1346, .8975 ],
            CameraCalibration1: [ .9774, 0, 0, 0, 1, 0, 0, 0, .9969 ],
            CameraCalibration2: [ .9774, 0, 0, 0, 1, 0, 0, 0, .9969 ],
            BlackLevelRepeatDim: [ 1, 1 ],
            CFALayout: 1,
            CFARepeatPatternDim: [ 2, 2 ],
            CFAPlaneColor: [ 0, 1, 2 ],
            CFAPattern: [ 0, 1, 1, 2 ],
            ActiveArea: [ 12, 74, 2360, 3596 ],
            DefaultCropOrigin: [ 10, 7 ],
            DefaultCropSize: [ 3504, 2336 ],
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "red"
                }, {
                    x: 1,
                    y: 0,
                    Color: "green"
                }, {
                    x: 0,
                    y: 1,
                    Color: "green"
                }, {
                    x: 1,
                    y: 1,
                    Color: "blue"
                } ]
            },
            Crop: {
                x: 74,
                y: 12,
                Width: 3522,
                Height: 2348
            },
            Sensor: {
                Black: 127,
                White: 3398
            },
            BlackAreas: [ {
                Offset: 0,
                Size: 72,
                Type: "vertical"
            }, {
                Offset: 2,
                Size: 8,
                Type: "horizontal"
            } ]
        },
        "Canon Canon EOS 350D DIGITAL": {
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "red"
                }, {
                    x: 1,
                    y: 0,
                    Color: "green"
                }, {
                    x: 0,
                    y: 1,
                    Color: "green"
                }, {
                    x: 1,
                    y: 1,
                    Color: "blue"
                } ]
            },
            ReadyForDecoding: true,
            BaselineExposure: .25,
            BaselineNoise: 1,
            BaselineSharpness: 1.5,
            AsShotNeutral: [ .514387, 1, .568004 ],
            ColorMatrix1: [ .6159, -.0945, -.0745, -.6846, 1.3563, .3684, -.0802, .1086, .7555 ],
            ColorMatrix2: [ .6018, -.0617, -.0965, -.8645, 1.5881, .2975, -.153, .1719, .7642 ],
            ForwardMatrix1: [ .8255, -.0022, .1411, .424, .6455, -.0695, .0908, -.234, .9683 ],
            ForwardMatrix2: [ .7623, .0785, .1235, .3987, .7409, -.1396, .0431, -.1074, .8894 ],
            CameraCalibration1: [ 1.0113, 0, 0, 0, 1, 0, 0, 0, .9914 ],
            CameraCalibration2: [ 1.0113, 0, 0, 0, 1, 0, 0, 0, .9914 ],
            BlackLevelRepeatDim: [ 1, 1 ],
            CFALayout: 1,
            CFARepeatPatternDim: [ 2, 2 ],
            CFAPlaneColor: [ 0, 1, 2 ],
            CFAPattern: [ 0, 1, 1, 2 ],
            ActiveArea: [ 14, 42, 2328, 3516 ],
            DefaultCropOrigin: [ 10, 5 ],
            DefaultCropSize: [ 3456, 2304 ],
            MaskedAreas: [ 14, 0, 2328, 40 ],
            Crop: {
                x: 42,
                y: 14,
                Width: 3474,
                Height: 2314
            },
            Sensor: {
                Black: 255,
                White: 4095
            },
            BlackAreas: [ {
                Offset: 0,
                Size: 40,
                Type: "vertical"
            }, {
                Offset: 0,
                Size: 12,
                Type: "horizontal"
            } ]
        },
        "Canon Canon EOS 40D": {
            ReadyForDecoding: true,
            BaselineExposure: 0,
            BaselineNoise: 1,
            BaselineSharpness: 1.25,
            AsShotNeutral: [ .43948490611064206, 1, .57820446697643 ],
            ColorMatrix1: [ .7104, -.1999, -.0207, -.603, 1.3278, .3074, -.1018, .1618, .741 ],
            ColorMatrix2: [ .6071, -.0747, -.0856, -.7653, 1.5365, .2441, -.2025, .2553, .7315 ],
            ForwardMatrix1: [ .7828, .0733, .1082, .3488, .733, -.0818, .1011, -.3521, 1.0761 ],
            ForwardMatrix2: [ .7671, .0922, .105, .3669, .7678, -.1347, .0582, -.1785, .9454 ],
            CameraCalibration1: [ .9873, 0, 0, 0, 1, 0, 0, 0, 1.0088 ],
            CameraCalibration2: [ .9873, 0, 0, 0, 1, 0, 0, 0, 1.0088 ],
            BlackLevelRepeatDim: [ 1, 1 ],
            CFALayout: 1,
            CFARepeatPatternDim: [ 2, 2 ],
            CFAPlaneColor: [ 0, 1, 2 ],
            CFAPattern: [ 0, 1, 1, 2 ],
            ActiveArea: [ 18, 30, 2620, 3938 ],
            DefaultCropOrigin: [ 10, 5 ],
            DefaultCropSize: [ 3888, 2592 ],
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "red"
                }, {
                    x: 1,
                    y: 0,
                    Color: "green"
                }, {
                    x: 0,
                    y: 1,
                    Color: "green"
                }, {
                    x: 1,
                    y: 1,
                    Color: "blue"
                } ]
            },
            Crop: {
                x: 30,
                y: 18,
                Width: 3908,
                Height: 2602
            },
            Sensor: {
                Black: 1021,
                White: 12600,
                Width: 3944,
                Height: 2622
            },
            BlackAreas: [ {
                Offset: 0,
                Size: 28,
                Type: "vertical"
            }, {
                Offset: 4,
                Size: 12,
                Type: "horizontal"
            } ]
        },
        "Canon Canon EOS 450D": {
            ReadyForDecoding: true,
            BaselineExposure: 0,
            BaselineNoise: 1,
            BaselineSharpness: 1.25,
            AsShotNeutral: [ .46084605806107315, 1, .728307188319118 ],
            ColorMatrix1: [ .6695, -.1429, -.0292, -.5762, 1.2807, .3334, -.1021, .179, .7442 ],
            ColorMatrix2: [ .5784, -.0262, -.0821, -.7539, 1.5064, .2672, -.1982, .2681, .7427 ],
            ForwardMatrix1: [ .813, .0233, .128, .3593, .7378, -.0971, .084, -.4092, 1.1503 ],
            ForwardMatrix2: [ .8201, .0265, .1177, .3948, .7616, -.1564, .0523, -.1968, .9696 ],
            CameraCalibration1: [ 1.0122, 0, 0, 0, 1, 0, 0, 0, 1.0111 ],
            CameraCalibration2: [ 1.0122, 0, 0, 0, 1, 0, 0, 0, 1.0111 ],
            BlackLevelRepeatDim: [ 1, 1 ],
            CFALayout: 1,
            CFARepeatPatternDim: [ 2, 2 ],
            CFAPlaneColor: [ 0, 1, 2 ],
            CFAPattern: [ 0, 1, 1, 2 ],
            ActiveArea: [ 18, 22, 2874, 4312 ],
            DefaultCropOrigin: [ 10, 5 ],
            DefaultCropSize: [ 4272, 2848 ],
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "red"
                }, {
                    x: 1,
                    y: 0,
                    Color: "green"
                }, {
                    x: 0,
                    y: 1,
                    Color: "green"
                }, {
                    x: 1,
                    y: 1,
                    Color: "blue"
                } ]
            },
            Crop: {
                x: 22,
                y: 18,
                Width: 4290,
                Height: 2856
            },
            Sensor: {
                Black: 1020,
                White: 14500
            }
        },
        "Canon Canon EOS 50D": {
            ReadyForDecoding: true,
            BaselineExposure: .15,
            BaselineNoise: .8,
            BaselineSharpness: 1.25,
            AsShotNeutral: [ .5210127028107072, 1, .5258049284747556 ],
            ColorMatrix1: [ .5852, -.0578, -.0041, -.4691, 1.1696, .3427, -.0886, .2323, .6879 ],
            ColorMatrix2: [ .492, .0616, -.0593, -.6493, 1.3964, .2784, -.1774, .3178, .7005 ],
            ForwardMatrix1: [ .8716, -.0692, .1618, .3408, .8077, -.1486, -.0013, -.6583, 1.4847 ],
            ForwardMatrix2: [ .9485, -.115, .1308, .4313, .7807, -.212, .0293, -.2826, 1.0785 ],
            CameraCalibration1: [ 1.0019, 0, 0, 0, 1, 0, 0, 0, 1.0042 ],
            CameraCalibration2: [ 1.0019, 0, 0, 0, 1, 0, 0, 0, 1.0042 ],
            BlackLevelRepeatDim: [ 2, 2 ],
            CFALayout: 1,
            CFARepeatPatternDim: [ 2, 2 ],
            CFAPlaneColor: [ 0, 1, 2 ],
            CFAPattern: [ 0, 1, 1, 2 ],
            ActiveArea: [ 51, 62, 3228, 4832 ],
            DefaultCropOrigin: [ 10, 5 ],
            DefaultCropSize: [ 4752, 3168 ],
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "green"
                }, {
                    x: 1,
                    y: 0,
                    Color: "blue"
                }, {
                    x: 0,
                    y: 1,
                    Color: "red"
                }, {
                    x: 1,
                    y: 1,
                    Color: "green"
                } ]
            },
            Crop: {
                x: 64,
                y: 52,
                Width: 4752,
                Height: 3158
            },
            Sensor: {
                Black: 1026,
                White: 15500
            },
            BlackAreas: [ {
                Offset: 0,
                Size: 60,
                Type: "vertical"
            }, {
                Offset: 2,
                Size: 46,
                Type: "horizontal"
            } ]
        },
        "Canon Canon EOS 700D": {
            ReadyForDecoding: true,
            BaselineExposure: -.09,
            BaselineNoise: 1,
            BaselineSharpness: 1.2,
            AsShotNeutral: [ .4834750640483591, 1, .6202300433230685 ],
            ColorMatrix1: [ .6985, -.1611, -.0397, -.3596, 1.0749, .3295, -.0349, .1136, .6512 ],
            ColorMatrix2: [ .6602, -.0841, -.0939, -.4472, 1.2458, .2247, -.0975, .2039, .6148 ],
            ForwardMatrix1: [ .7747, .0485, .1411, .234, .884, -.118, .0105, -.4147, 1.2293 ],
            ForwardMatrix2: [ .7397, .1199, .1047, .265, .9355, -.2005, .0193, -.2113, 1.0171 ],
            CameraCalibration1: [ 1.0168, 0, 0, 0, 1, 0, 0, 0, .973 ],
            CameraCalibration2: [ 1.0168, 0, 0, 0, 1, 0, 0, 0, .973 ],
            BlackLevelRepeatDim: [ 2, 2 ],
            CFALayout: 1,
            CFARepeatPatternDim: [ 2, 2 ],
            CFAPlaneColor: [ 0, 1, 2 ],
            CFAPattern: [ 0, 1, 1, 2 ],
            ActiveArea: [ 52, 72, 3528, 5280 ],
            DefaultCropOrigin: [ 12, 12 ],
            DefaultCropSize: [ 5184, 3456 ],
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "green"
                }, {
                    x: 1,
                    y: 0,
                    Color: "blue"
                }, {
                    x: 0,
                    y: 1,
                    Color: "red"
                }, {
                    x: 1,
                    y: 1,
                    Color: "green"
                } ]
            },
            Crop: {
                x: 12,
                y: 12,
                Width: 0,
                Height: 0
            },
            Sensor: {
                Black: 2048,
                White: 12277
            },
            BlackAreas: [ {
                Offset: 0,
                Size: 48,
                Type: "vertical"
            }, {
                Offset: 4,
                Size: 10,
                Type: "horizontal"
            } ]
        },
        "Canon Canon EOS 60D": {
            ReadyForDecoding: true,
            BaselineExposure: -.34,
            BaselineNoise: .8,
            BaselineSharpness: 1.25,
            AsShotNeutral: [ .414071988, 1, .661926391 ],
            ColorMatrix1: [ .7428, -.1897, -.0491, -.3505, 1.0963, .2929, -.0337, .1242, .6413 ],
            ColorMatrix2: [ .6719, -.0994, -.0925, -.4408, 1.2426, .2211, -.0887, .2129, .6051 ],
            ForwardMatrix1: [ .755, .0645, .1448, .2138, .8936, -.1075, -5e-4, -.4306, 1.2562 ],
            ForwardMatrix2: [ .7286, .1385, .0972, .26, .9468, -.2068, .0093, -.2268, 1.0426 ],
            CameraCalibration1: [ .9793, 0, 0, 0, 1, 0, 0, 0, .9881 ],
            CameraCalibration2: [ .9793, 0, 0, 0, 1, 0, 0, 0, .9881 ],
            BlackLevelRepeatDim: [ 2, 2 ],
            CFALayout: 1,
            CFARepeatPatternDim: [ 2, 2 ],
            CFAPlaneColor: [ 0, 1, 2 ],
            CFAPattern: [ 0, 1, 1, 2 ],
            ActiveArea: [ 51, 142, 3516, 5344 ],
            DefaultCropOrigin: [ 10, 5 ],
            DefaultCropSize: [ 5184, 3456 ],
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "green"
                }, {
                    x: 1,
                    y: 0,
                    Color: "blue"
                }, {
                    x: 0,
                    y: 1,
                    Color: "red"
                }, {
                    x: 1,
                    y: 1,
                    Color: "green"
                } ]
            },
            Crop: {
                x: 146,
                y: 54,
                Width: 0,
                Height: 0
            },
            Sensor: {
                Black: 2026,
                White: 14200
            },
            BlackAreas: [ {
                Offset: 0,
                Size: 140,
                Type: "vertical"
            }, {
                Offset: 4,
                Size: 46,
                Type: "horizontal"
            } ]
        },
        "Canon Canon EOS 500D": {
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "red"
                }, {
                    x: 1,
                    y: 0,
                    Color: "green"
                }, {
                    x: 0,
                    y: 1,
                    Color: "green"
                }, {
                    x: 1,
                    y: 1,
                    Color: "blue"
                } ]
            },
            ReadyForDecoding: true,
            BaselineExposure: .15,
            BaselineNoise: 1,
            BaselineSharpness: 1.25,
            AsShotNeutral: [ .5165163862240948, 1, .4961538156213037 ],
            ColorMatrix1: [ .566, -.0436, -.0088, -.5034, 1.2093, .3347, -.0926, .2289, .6588 ],
            ColorMatrix2: [ .4763, .0712, -.0646, -.6821, 1.4399, .264, -.1921, .3276, .6561 ],
            ForwardMatrix1: [ .9474, -.1386, .1555, .4367, .7419, -.1786, .0398, -.3048, 1.0901 ],
            ForwardMatrix2: [ .9474, -.1386, .1555, .4367, .7419, -.1786, .0398, -.3048, 1.0901 ],
            CameraCalibration1: [ .9919, 0, 0, 0, 1, 0, 0, 0, 1.0327 ],
            CameraCalibration2: [ .9919, 0, 0, 0, 1, 0, 0, 0, 1.0327 ],
            BlackLevelRepeatDim: [ 2, 2 ],
            CFALayout: 1,
            CFARepeatPatternDim: [ 2, 2 ],
            CFAPlaneColor: [ 0, 1, 2 ],
            CFAPattern: [ 0, 1, 1, 2 ],
            ActiveArea: [ 26, 62, 3204, 4832 ],
            DefaultCropOrigin: [ 10, 5 ],
            DefaultCropSize: [ 4752, 3168 ],
            Crop: {
                x: 62,
                y: 30,
                Width: 4722,
                Height: 3142
            },
            Sensor: {
                Black: 1020,
                White: 16e3
            },
            BlackAreas: [ {
                Offset: 0,
                Size: 56,
                Type: "vertical"
            }, {
                Offset: 2,
                Size: 22,
                Type: "horizontal"
            } ]
        },
        "Canon Canon EOS 550D": {
            ReadyForDecoding: true,
            BaselineExposure: -.34,
            BaselineNoise: 1,
            BaselineSharpness: 1.2,
            AsShotNeutral: [ .5086935731653967, 1, .420879495045617 ],
            ColorMatrix1: [ .7755, -.2449, -.0349, -.3106, 1.0222, .3362, -.0156, .0986, .6409 ],
            ColorMatrix2: [ .6941, -.1164, -.0857, -.3825, 1.1597, .2534, -.0416, .154, .6039 ],
            ForwardMatrix1: [ .7163, .1301, .1179, .1926, .9543, -.1469, -.0278, -.383, 1.2359 ],
            ForwardMatrix2: [ .7239, .1838, .0566, .2467, 1.0246, -.2713, -.0112, -.1754, 1.0117 ],
            CameraCalibration1: [ .9981, 0, 0, 0, 1, 0, 0, 0, 1.0284 ],
            CameraCalibration2: [ .9981, 0, 0, 0, 1, 0, 0, 0, 1.0284 ],
            BlackLevelRepeatDim: [ 2, 2 ],
            CFALayout: 1,
            CFARepeatPatternDim: [ 2, 2 ],
            CFAPlaneColor: [ 0, 1, 2 ],
            CFAPattern: [ 0, 1, 1, 2 ],
            ActiveArea: [ 51, 142, 3516, 5344 ],
            DefaultCropOrigin: [ 10, 5 ],
            DefaultCropSize: [ 5184, 3456 ],
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 1,
                    y: 0,
                    Color: "blue"
                }, {
                    x: 0,
                    y: 0,
                    Color: "green"
                }, {
                    x: 1,
                    y: 1,
                    Color: "green"
                }, {
                    x: 0,
                    y: 1,
                    Color: "red"
                } ]
            },
            Crop: {
                x: 148,
                y: 54,
                Width: 0,
                Height: 0
            },
            Sensor: {
                Black: 2048,
                White: 15831
            },
            BlackAreas: [ {
                Offset: 0,
                Size: 140,
                Type: "vertical"
            }, {
                Offset: 4,
                Size: 44,
                Type: "horizontal"
            } ]
        },
        "Canon Canon EOS 600D": {
            ReadyForDecoding: true,
            BaselineExposure: -.34,
            BaselineNoise: 1,
            BaselineSharpness: 1.2,
            AsShotNeutral: [ .48924995535594157, 1, .38861482907553974 ],
            ColorMatrix1: [ .7164, -.1916, -.0431, -.3361, 1.06, .32, -.0272, .1058, .6442 ],
            ColorMatrix2: [ .6461, -.0907, -.0882, -.43, 1.2184, .2378, -.0819, .1944, .5931 ],
            ForwardMatrix1: [ .7486, .0835, .1322, .2099, .9147, -.1245, -.0012, -.3822, 1.2085 ],
            ForwardMatrix2: [ .7359, .1365, .0918, .261, .9687, -.2297, .0098, -.2155, 1.0309 ],
            CameraCalibration1: [ 1.0022, 0, 0, 0, 1, 0, 0, 0, .9811 ],
            CameraCalibration2: [ 1.0022, 0, 0, 0, 1, 0, 0, 0, .9811 ],
            BlackLevelRepeatDim: [ 2, 2 ],
            CFALayout: 1,
            CFARepeatPatternDim: [ 2, 2 ],
            CFAPlaneColor: [ 0, 1, 2 ],
            CFAPattern: [ 0, 1, 1, 2 ],
            ActiveArea: [ 51, 142, 3516, 5344 ],
            DefaultCropOrigin: [ 10, 5 ],
            DefaultCropSize: [ 5184, 3456 ],
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "green"
                }, {
                    x: 1,
                    y: 0,
                    Color: "blue"
                }, {
                    x: 0,
                    y: 1,
                    Color: "red"
                }, {
                    x: 1,
                    y: 1,
                    Color: "green"
                } ]
            },
            Crop: {
                x: 146,
                y: 54,
                Width: 0,
                Height: 0
            },
            Sensor: {
                Black: 2026,
                White: 13584
            },
            BlackAreas: [ {
                Offset: 0,
                Size: 140,
                Type: "vertical"
            }, {
                Offset: 4,
                Size: 44,
                Type: "horizontal"
            } ]
        },
        "Canon Canon EOS 650D": {
            ReadyForDecoding: true,
            BaselineExposure: -.09,
            BaselineNoise: 1,
            BaselineSharpness: 1.2,
            AsShotNeutral: [ .4951644713549829, 1, .47940063415115886 ],
            ColorMatrix1: [ .6985, -.1611, -.0397, -.3596, 1.0749, .3295, -.0349, .1136, .6512 ],
            ColorMatrix2: [ .6602, -.0841, -.0939, -.4472, 1.2458, .2247, -.0975, .2039, .6148 ],
            ForwardMatrix1: [ .7747, .0485, .1411, .234, .884, -.118, .0105, -.4147, 1.2293 ],
            ForwardMatrix2: [ .7397, .1199, .1047, .265, .9355, -.2005, .0193, -.2113, 1.0171 ],
            CameraCalibration1: [ 1.0316, 0, 0, 0, 1, 0, 0, 0, .9851 ],
            CameraCalibration2: [ 1.0316, 0, 0, 0, 1, 0, 0, 0, .9851 ],
            BlackLevelRepeatDim: [ 2, 2 ],
            CFALayout: 1,
            CFARepeatPatternDim: [ 2, 2 ],
            CFAPlaneColor: [ 0, 1, 2 ],
            CFAPattern: [ 0, 1, 1, 2 ],
            ActiveArea: [ 52, 72, 3528, 5280 ],
            DefaultCropOrigin: [ 12, 12 ],
            DefaultCropSize: [ 5184, 3456 ],
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "red"
                }, {
                    x: 1,
                    y: 0,
                    Color: "green"
                }, {
                    x: 0,
                    y: 1,
                    Color: "green"
                }, {
                    x: 1,
                    y: 1,
                    Color: "blue"
                } ]
            },
            Crop: {
                x: 76,
                y: 56,
                Width: 0,
                Height: 0
            },
            Sensor: {
                Black: 2026,
                White: 13584
            },
            BlackAreas: [ {
                Offset: 0,
                Size: 70,
                Type: "vertical"
            }, {
                Offset: 4,
                Size: 44,
                Type: "horizontal"
            } ]
        },
        "Canon Canon EOS 5D": {
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "red"
                }, {
                    x: 1,
                    y: 0,
                    Color: "green"
                }, {
                    x: 0,
                    y: 1,
                    Color: "green"
                }, {
                    x: 1,
                    y: 1,
                    Color: "blue"
                } ]
            },
            ReadyForDecoding: true,
            BaselineExposure: .25,
            BaselineNoise: 1,
            BaselineSharpness: 1.5,
            AsShotNeutral: [ .479401, 1, .726757 ],
            ColorMatrix1: [ .7284, -.1569, -.0425, -.6726, 1.4015, .2993, -.0926, .1258, .7774 ],
            ColorMatrix2: [ .6347, -.0479, -.0972, -.8297, 1.5954, .248, -.1968, .2131, .7649 ],
            ForwardMatrix1: [ .8141, .0349, .1153, .3909, .6662, -.0571, .1095, -.2533, .9689 ],
            ForwardMatrix2: [ .7903, .0519, .1221, .3935, .715, -.1085, .065, -.135, .8952 ],
            CameraCalibration1: [ .9669, 0, 0, 0, 1, 0, 0, 0, 1.0228 ],
            CameraCalibration2: [ .9669, 0, 0, 0, 1, 0, 0, 0, 1.0228 ],
            BlackLevelRepeatDim: [ 1, 1 ],
            CFALayout: 1,
            CFARepeatPatternDim: [ 2, 2 ],
            CFAPlaneColor: [ 0, 1, 2 ],
            CFAPattern: [ 0, 1, 1, 2 ],
            ActiveArea: [ 34, 90, 2954, 4476 ],
            DefaultCropOrigin: [ 10, 5 ],
            DefaultCropSize: [ 4368, 2912 ],
            Crop: {
                x: 90,
                y: 34,
                Width: 4386,
                Height: 2920
            },
            Sensor: {
                Black: 127,
                White: 3692
            },
            BlackAreas: [ {
                Offset: 0,
                Size: 88,
                Type: "vertical"
            }, {
                Offset: 2,
                Size: 30,
                Type: "horizontal"
            } ]
        },
        "Canon Canon EOS 5D Mark II": {
            ReadyForDecoding: true,
            BaselineExposure: .4,
            BaselineNoise: .8,
            BaselineSharpness: 1.2,
            AsShotNeutral: [ .45796059157517377, 1, .5821490965337096 ],
            ColorMatrix1: [ .5309, -.0229, -.0336, -.6241, 1.3265, .3337, -.0817, .1215, .6664 ],
            ColorMatrix2: [ .4716, .0603, -.083, -.7798, 1.5474, .248, -.1496, .1937, .6651 ],
            ForwardMatrix1: [ .8924, -.1041, .176, .4351, .6621, -.0972, .0505, -.1562, .9308 ],
            ForwardMatrix2: [ .8924, -.1041, .176, .4351, .6621, -.0972, .0505, -.1562, .9308 ],
            CameraCalibration1: [ .9852, 0, 0, 0, 1, 0, 0, 0, .9648 ],
            CameraCalibration2: [ .9852, 0, 0, 0, 1, 0, 0, 0, .9648 ],
            BlackLevelRepeatDim: [ 2, 2 ],
            CFALayout: 1,
            CFARepeatPatternDim: [ 2, 2 ],
            CFAPlaneColor: [ 0, 1, 2 ],
            CFAPattern: [ 0, 1, 1, 2 ],
            ActiveArea: [ 51, 158, 3804, 5792 ],
            DefaultCropOrigin: [ 10, 5 ],
            DefaultCropSize: [ 5616, 3744 ],
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "green"
                }, {
                    x: 1,
                    y: 0,
                    Color: "blue"
                }, {
                    x: 0,
                    y: 1,
                    Color: "red"
                }, {
                    x: 1,
                    y: 1,
                    Color: "green"
                } ]
            },
            Crop: {
                x: 158,
                y: 51,
                Width: 5634,
                Height: 3753
            },
            Sensor: {
                Black: 1024,
                White: 12995
            },
            BlackAreas: [ {
                Offset: 0,
                Size: 156,
                Type: "vertical"
            }, {
                Offset: 2,
                Size: 48,
                Type: "horizontal"
            } ]
        },
        "Canon Canon EOS 5D Mark III": {
            ReadyForDecoding: true,
            BaselineExposure: .25,
            BaselineNoise: .8,
            BaselineSharpness: 1.2,
            AsShotNeutral: [ .4951644713549829, 1, .4697248258025484 ],
            ColorMatrix1: [ .7234, -.1413, -.06, -.3631, 1.115, .285, -.0382, .1335, .6437 ],
            ColorMatrix2: [ .6722, -.0635, -.0963, -.4287, 1.246, .2028, -.0908, .2162, .5668 ],
            ForwardMatrix1: [ .7868, .0092, .1683, .2291, .8615, -.0906, .0027, -.4752, 1.2976 ],
            ForwardMatrix2: [ .7637, .0805, .1201, .2649, .9179, -.1828, .0137, -.2456, 1.057 ],
            CameraCalibration1: [ .9804, 0, 0, 0, 1, 0, 0, 0, .9861 ],
            CameraCalibration2: [ .9804, 0, 0, 0, 1, 0, 0, 0, .9861 ],
            BlackLevelRepeatDim: [ 2, 2 ],
            CFALayout: 1,
            CFARepeatPatternDim: [ 2, 2 ],
            CFAPlaneColor: [ 0, 1, 2 ],
            CFAPattern: [ 0, 1, 1, 2 ],
            ActiveArea: [ 80, 122, 3950, 5918 ],
            DefaultCropOrigin: [ 18, 16 ],
            DefaultCropSize: [ 5760, 3840 ],
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "red"
                }, {
                    x: 1,
                    y: 0,
                    Color: "green"
                }, {
                    x: 0,
                    y: 1,
                    Color: "green"
                }, {
                    x: 1,
                    y: 1,
                    Color: "blue"
                } ]
            },
            Crop: {
                x: 124,
                y: 82,
                Width: -2,
                Height: 0
            },
            Sensor: {
                Black: 2047,
                White: 15e3,
                Width: 5920,
                Height: 3950
            },
            BlackAreas: [ {
                Offset: 0,
                Size: 120,
                Type: "vertical"
            }, {
                Offset: 2,
                Size: 78,
                Type: "horizontal"
            } ]
        },
        "Canon Canon EOS 6D": {
            ReadyForDecoding: true,
            BaselineExposure: .25,
            BaselineNoise: .8,
            BaselineSharpness: 1.25,
            AsShotNeutral: [ .5311201909058414, 1, .46587815236451796 ],
            ColorMatrix1: [ .7546, -.1435, -.0929, -.3846, 1.1488, .2692, -.0332, .1209, .637 ],
            ColorMatrix2: [ .7034, -.0804, -.1014, -.442, 1.2564, .2058, -.0851, .1994, .5758 ],
            ForwardMatrix1: [ .7763, .0065, .1815, .2364, .8351, -.0715, -.0059, -.4228, 1.2538 ],
            ForwardMatrix2: [ .7464, .1044, .1135, .2648, .9173, -.182, .0113, -.2154, 1.0292 ],
            CameraCalibration1: [ 1.0135, 0, 0, 0, 1, 0, 0, 0, .9952 ],
            CameraCalibration2: [ 1.0135, 0, 0, 0, 1, 0, 0, 0, .9952 ],
            BlackLevelRepeatDim: [ 2, 2 ],
            CFALayout: 1,
            CFARepeatPatternDim: [ 2, 2 ],
            CFAPlaneColor: [ 0, 1, 2 ],
            CFAPattern: [ 0, 1, 1, 2 ],
            ActiveArea: [ 38, 72, 3708, 5568 ],
            DefaultCropOrigin: [ 12, 12 ],
            DefaultCropSize: [ 5472, 3648 ],
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "red"
                }, {
                    x: 1,
                    y: 0,
                    Color: "green"
                }, {
                    x: 0,
                    y: 1,
                    Color: "green"
                }, {
                    x: 1,
                    y: 1,
                    Color: "blue"
                } ]
            },
            Crop: {
                x: 74,
                y: 40,
                Width: 0,
                Height: 0
            },
            Sensor: {
                Black: 2048,
                White: 16383
            },
            BlackAreas: [ {
                Offset: 0,
                Size: 68,
                Type: "vertical"
            }, {
                Offset: 2,
                Size: 36,
                Type: "horizontal"
            } ]
        },
        "Canon Canon EOS 7D": {
            ReadyForDecoding: true,
            BaselineExposure: -.21,
            BaselineNoise: .8,
            BaselineSharpness: 1.25,
            AsShotNeutral: [ .5029470180522774, 1, .4530973964570502 ],
            ColorMatrix1: [ 1.162, -.635, 5e-4, -.2558, 1.0146, .2813, .0024, .0858, .6926 ],
            ColorMatrix2: [ .6844, -.0996, -.0856, -.3876, 1.1761, .2396, -.0593, .1772, .6198 ],
            ForwardMatrix1: [ .5445, .3536, .0662, .1106, 1.0136, -.1242, -.0374, -.3559, 1.2184 ],
            ForwardMatrix2: [ .7415, .1533, .0695, .2499, .9997, -.2497, -.0022, -.1933, 1.0207 ],
            CameraCalibration1: [ .994, 0, 0, 0, 1, 0, 0, 0, 1.0773 ],
            CameraCalibration2: [ .994, 0, 0, 0, 1, 0, 0, 0, 1.0773 ],
            BlackLevelRepeatDim: [ 2, 2 ],
            CFALayout: 1,
            CFARepeatPatternDim: [ 2, 2 ],
            CFAPlaneColor: [ 0, 1, 2 ],
            CFAPattern: [ 0, 1, 1, 2 ],
            ActiveArea: [ 51, 158, 3516, 5360 ],
            DefaultCropOrigin: [ 10, 5 ],
            DefaultCropSize: [ 5184, 3456 ],
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "green"
                }, {
                    x: 1,
                    y: 0,
                    Color: "blue"
                }, {
                    x: 0,
                    y: 1,
                    Color: "red"
                }, {
                    x: 1,
                    y: 1,
                    Color: "green"
                } ]
            },
            Crop: {
                x: 158,
                y: 52,
                Width: 5202,
                Height: 3464
            },
            Sensor: {
                Black: 2048,
                White: 15400
            },
            BlackAreas: [ {
                Offset: 8,
                Size: 156,
                Type: "vertical"
            }, {
                Offset: 32,
                Size: 18,
                Type: "horizontal"
            } ]
        },
        "Canon Canon EOS 7D Mark II": {
            ReadyForDecoding: true,
            BaselineExposure: -.21,
            BaselineNoise: .8,
            BaselineSharpness: 1.25,
            AsShotNeutral: [ .5029470180522774, 1, .4530973964570502 ],
            ColorMatrix1: [ 1.162, -.635, 5e-4, -.2558, 1.0146, .2813, .0024, .0858, .6926 ],
            ColorMatrix2: [ .6844, -.0996, -.0856, -.3876, 1.1761, .2396, -.0593, .1772, .6198 ],
            ForwardMatrix1: [ .5445, .3536, .0662, .1106, 1.0136, -.1242, -.0374, -.3559, 1.2184 ],
            ForwardMatrix2: [ .7415, .1533, .0695, .2499, .9997, -.2497, -.0022, -.1933, 1.0207 ],
            CameraCalibration1: [ .994, 0, 0, 0, 1, 0, 0, 0, 1.0773 ],
            CameraCalibration2: [ .994, 0, 0, 0, 1, 0, 0, 0, 1.0773 ],
            BlackLevelRepeatDim: [ 2, 2 ],
            CFALayout: 1,
            CFARepeatPatternDim: [ 2, 2 ],
            CFAPlaneColor: [ 0, 1, 2 ],
            CFAPattern: [ 0, 1, 1, 2 ],
            ActiveArea: [ 51, 158, 3516, 5360 ],
            DefaultCropOrigin: [ 10, 5 ],
            DefaultCropSize: [ 5184, 3456 ],
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "green"
                }, {
                    x: 1,
                    y: 0,
                    Color: "blue"
                }, {
                    x: 0,
                    y: 1,
                    Color: "red"
                }, {
                    x: 1,
                    y: 1,
                    Color: "green"
                } ]
            },
            Crop: {
                x: 158,
                y: 52,
                Width: 5202,
                Height: 3464
            },
            Sensor: {
                Black: 2048,
                White: 15400
            },
            BlackAreas: [ {
                Offset: 8,
                Size: 156,
                Type: "vertical"
            }, {
                Offset: 32,
                Size: 18,
                Type: "horizontal"
            } ]
        },
        "Canon Canon EOS 1000D": {
            ReadyForDecoding: true,
            BaselineExposure: .25,
            BaselineNoise: 1,
            BaselineSharpness: 1.25,
            AsShotNeutral: [ .5028354893242998, 1, .3985019514640563 ],
            ColorMatrix1: [ .7599, -.2193, -.0387, -.6082, 1.2908, .3584, -.0679, .0963, .7357 ],
            ColorMatrix2: [ .6771, -.1139, -.0977, -.7818, 1.5123, .2928, -.1244, .1437, .7533 ],
            ForwardMatrix1: [ .7725, .0904, .1014, .3626, .73, -.0926, .0803, -.2226, .9674 ],
            ForwardMatrix2: [ .7291, .1469, .0882, .364, .8036, -.1676, .0347, -.0901, .8805 ],
            CameraCalibration1: [ 1.0228, 0, 0, 0, 1, 0, 0, 0, .9955 ],
            CameraCalibration2: [ 1.0228, 0, 0, 0, 1, 0, 0, 0, .9955 ],
            BlackLevelRepeatDim: [ 1, 1 ],
            CFALayout: 1,
            CFARepeatPatternDim: [ 2, 2 ],
            CFAPlaneColor: [ 0, 1, 2 ],
            CFAPattern: [ 0, 1, 1, 2 ],
            ActiveArea: [ 18, 42, 2620, 3948 ],
            DefaultCropOrigin: [ 10, 5 ],
            DefaultCropSize: [ 3888, 2592 ],
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "red"
                }, {
                    x: 1,
                    y: 0,
                    Color: "green"
                }, {
                    x: 0,
                    y: 1,
                    Color: "green"
                }, {
                    x: 1,
                    y: 1,
                    Color: "blue"
                } ]
            },
            Crop: {
                x: 42,
                y: 18,
                Width: 3906,
                Height: 2602
            },
            Sensor: {
                Black: 255,
                White: 3650
            },
            BlackAreas: [ {
                Offset: 0,
                Size: 41,
                Type: "vertical"
            }, {
                Offset: 2,
                Size: 14,
                Type: "horizontal"
            } ]
        },
        "Canon Canon EOS 1100D": {
            ReadyForDecoding: true,
            BaselineExposure: -.34,
            BaselineNoise: 1,
            BaselineSharpness: 1.25,
            AsShotNeutral: [ .4745134102234863, 1, .4130698608532867 ],
            ColorMatrix1: [ .6873, -.1696, -.0529, -.3659, 1.0795, .3313, -.0362, .1165, .7234 ],
            ColorMatrix2: [ .6444, -.0904, -.0893, -.4563, 1.2308, .2535, -.0903, .2016, .6728 ],
            ForwardMatrix1: [ .7607, .0647, .1389, .2337, .8876, -.1213, .0093, -.3625, 1.1783 ],
            ForwardMatrix2: [ .7357, .1377, .0909, .2729, .963, -.2359, .0104, -.194, 1.0087 ],
            CameraCalibration1: [ 1.0043, 0, 0, 0, 1, 0, 0, 0, .9987 ],
            CameraCalibration2: [ 1.0043, 0, 0, 0, 1, 0, 0, 0, .9987 ],
            BlackLevelRepeatDim: [ 2, 2 ],
            CFALayout: 1,
            CFARepeatPatternDim: [ 2, 2 ],
            CFAPlaneColor: [ 0, 1, 2 ],
            CFAPattern: [ 0, 1, 1, 2 ],
            ActiveArea: [ 18, 62, 2874, 4352 ],
            DefaultCropOrigin: [ 10, 5 ],
            DefaultCropSize: [ 4272, 2848 ],
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "red"
                }, {
                    x: 1,
                    y: 0,
                    Color: "green"
                }, {
                    x: 0,
                    y: 1,
                    Color: "green"
                }, {
                    x: 1,
                    y: 1,
                    Color: "blue"
                } ]
            },
            Crop: {
                x: 64,
                y: 20,
                Width: 0,
                Height: 0
            },
            Sensor: {
                Black: 2036,
                White: 15500
            },
            BlackAreas: [ {
                Offset: 0,
                Size: 58,
                Type: "vertical"
            }, {
                Offset: 4,
                Size: 12,
                Type: "horizontal"
            } ]
        },
        "Canon Canon EOS 1200D": {
            ReadyForDecoding: false
        },
        "Canon Canon EOS 100D": {
            ReadyForDecoding: true,
            BaselineExposure: -.09,
            BaselineNoise: 1,
            BaselineSharpness: 1.2,
            AsShotNeutral: [ .5956951494331068, 1, .5272915563748495 ],
            ColorMatrix1: [ .6985, -.1611, -.0397, -.3596, 1.0749, .3295, -.0349, .1136, .6512 ],
            ColorMatrix2: [ .6602, -.0841, -.0939, -.4472, 1.2458, .2247, -.0975, .2039, .6148 ],
            ForwardMatrix1: [ .7747, .0485, .1411, .234, .884, -.118, .0105, -.4147, 1.2293 ],
            ForwardMatrix2: [ .7397, .1199, .1047, .265, .9355, -.2005, .0193, -.2113, 1.0171 ],
            CameraCalibration1: [ 1.0753, 0, 0, 0, 1, 0, 0, 0, .9937 ],
            CameraCalibration2: [ 1.0753, 0, 0, 0, 1, 0, 0, 0, .9937 ],
            BlackLevelRepeatDim: [ 2, 2 ],
            CFALayout: 1,
            CFARepeatPatternDim: [ 2, 2 ],
            CFAPlaneColor: [ 0, 1, 2 ],
            CFAPattern: [ 0, 1, 1, 2 ],
            ActiveArea: [ 52, 72, 3528, 5280 ],
            DefaultCropOrigin: [ 12, 12 ],
            DefaultCropSize: [ 5184, 3456 ],
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "red"
                }, {
                    x: 1,
                    y: 0,
                    Color: "green"
                }, {
                    x: 0,
                    y: 1,
                    Color: "green"
                }, {
                    x: 1,
                    y: 1,
                    Color: "blue"
                } ]
            },
            Crop: {
                x: 12,
                y: 12,
                Width: 0,
                Height: 0
            },
            Sensor: {
                Black: 2047,
                White: 12277
            },
            BlackAreas: [ {
                Offset: 0,
                Size: 48,
                Type: "vertical"
            }, {
                Offset: 4,
                Size: 10,
                Type: "horizontal"
            } ]
        },
        "Canon Canon EOS 70D": {
            ReadyForDecoding: true,
            BaselineExposure: .25,
            BaselineNoise: .8,
            BaselineSharpness: 1.25,
            AsShotNeutral: [ .4600179959039998, 1, .6153846153846154 ],
            ColorMatrix1: [ .7546, -.1435, -.0929, -.3846, 1.1488, .2692, -.0332, .1209, .637 ],
            ColorMatrix2: [ .7034, -.0804, -.1014, -.442, 1.2564, .2058, -.0851, .1994, .5758 ],
            ForwardMatrix1: [ .7763, .0065, .1815, .2364, .8351, -.0715, -.0059, -.4228, 1.2538 ],
            ForwardMatrix2: [ .7464, .1044, .1135, .2648, .9173, -.182, .0113, -.2154, 1.0292 ],
            CameraCalibration1: [ .9323, 0, 0, 0, 1, 0, 0, 0, .984 ],
            CameraCalibration2: [ .9323, 0, 0, 0, 1, 0, 0, 0, .984 ],
            BlackLevelRepeatDim: [ 2, 2 ],
            CFALayout: 1,
            CFARepeatPatternDim: [ 2, 2 ],
            CFAPlaneColor: [ 0, 1, 2 ],
            CFAPattern: [ 0, 1, 1, 2 ],
            ActiveArea: [ 38, 72, 3708, 5568 ],
            DefaultCropOrigin: [ 12, 12 ],
            DefaultCropSize: [ 5472, 3648 ],
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "red"
                }, {
                    x: 1,
                    y: 0,
                    Color: "green"
                }, {
                    x: 0,
                    y: 1,
                    Color: "green"
                }, {
                    x: 1,
                    y: 1,
                    Color: "blue"
                } ]
            },
            Crop: {
                x: 12,
                y: 12,
                Width: 0,
                Height: 0
            },
            Sensor: {
                Black: 2049,
                White: 15e3
            },
            BlackAreas: [ {
                Offset: 0,
                Size: 58,
                Type: "vertical"
            }, {
                Offset: 4,
                Size: 12,
                Type: "horizontal"
            } ]
        },
        "Canon Canon EOS 400D DIGITAL": {
            ReadyForDecoding: true,
            BaselineExposure: .25,
            BaselineNoise: 1.33,
            BaselineSharpness: 1.5,
            AsShotNeutral: [ .45010982679773864, 1, .6759076764186627 ],
            ColorMatrix1: [ .7622, -.2223, -.064, -.6442, 1.3441, .3359, -.0678, .0955, .7621 ],
            ColorMatrix2: [ .7054, -.1501, -.099, -.8156, 1.5544, .2812, -.1278, .1414, .7796 ],
            ForwardMatrix1: [ .7613, .0881, .1149, .3671, .7052, -.0723, .0743, -.2075, .9583 ],
            ForwardMatrix2: [ .701, .1853, .0781, .3553, .7995, -.1548, .0345, -.0796, .8703 ],
            CameraCalibration1: [ .9914, 0, 0, 0, 1, 0, 0, 0, .9987 ],
            CameraCalibration2: [ .9914, 0, 0, 0, 1, 0, 0, 0, .9987 ],
            BlackLevelRepeatDim: [ 1, 1 ],
            CFALayout: 1,
            CFARepeatPatternDim: [ 2, 2 ],
            CFAPlaneColor: [ 0, 1, 2 ],
            CFAPattern: [ 0, 1, 1, 2 ],
            ActiveArea: [ 18, 42, 2620, 3948 ],
            DefaultCropOrigin: [ 10, 5 ],
            DefaultCropSize: [ 3888, 2592 ],
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "red"
                }, {
                    x: 1,
                    y: 0,
                    Color: "green"
                }, {
                    x: 0,
                    y: 1,
                    Color: "green"
                }, {
                    x: 1,
                    y: 1,
                    Color: "blue"
                } ]
            },
            Crop: {
                x: 42,
                y: 18,
                Width: 3906,
                Height: 2602
            },
            Sensor: {
                Black: 255,
                White: 3726
            },
            BlackAreas: [ {
                Offset: 0,
                Size: 40,
                Type: "vertical"
            }, {
                Offset: 4,
                Size: 12,
                Type: "horizontal"
            } ]
        },
        "Canon Canon EOS M": {
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "red"
                }, {
                    x: 1,
                    y: 0,
                    Color: "green"
                }, {
                    x: 0,
                    y: 1,
                    Color: "green"
                }, {
                    x: 1,
                    y: 1,
                    Color: "blue"
                } ]
            },
            Crop: {
                x: 76,
                y: 56,
                Width: 0,
                Height: 0
            },
            Sensor: {
                Black: 2026,
                White: 13584
            },
            ReadyForDecoding: true,
            BaselineExposure: -.09,
            BaselineNoise: 1,
            BaselineSharpness: 1.2,
            AsShotNeutral: [ .44521734174972194, 1, .6932971339789779 ],
            ColorMatrix1: [ .6985, -.1611, -.0397, -.3596, 1.0749, .3295, -.0349, .1136, .6512 ],
            ColorMatrix2: [ .6602, -.0841, -.0939, -.4472, 1.2458, .2247, -.0975, .2039, .6148 ],
            ForwardMatrix1: [ .7747, .0485, .1411, .234, .884, -.118, .0105, -.4147, 1.2293 ],
            ForwardMatrix2: [ .7397, .1199, .1047, .265, .9355, -.2005, .0193, -.2113, 1.0171 ],
            CameraCalibration1: [ 1.0566, 0, 0, 0, 1, 0, 0, 0, 1 ],
            CameraCalibration2: [ 1.0566, 0, 0, 0, 1, 0, 0, 0, 1 ],
            BlackLevelRepeatDim: [ 2, 2 ],
            CFALayout: 1,
            CFARepeatPatternDim: [ 2, 2 ],
            CFAPlaneColor: [ 0, 1, 2 ],
            CFAPattern: [ 0, 1, 1, 2 ],
            ActiveArea: [ 52, 72, 3528, 5280 ],
            DefaultCropOrigin: [ 12, 12 ],
            DefaultCropSize: [ 5184, 3456 ],
            BlackAreas: [ {
                Offset: 0,
                Size: 70,
                Type: "vertical"
            }, {
                Offset: 4,
                Size: 44,
                Type: "horizontal"
            } ]
        },
        "Canon Canon EOS-1D Mark II": {
            ReadyForDecoding: true,
            BaselineExposure: .35,
            BaselineNoise: 1,
            BaselineSharpness: 1,
            AsShotNeutral: [ .5059287257729705, 1, .7052340354408312 ],
            ColorMatrix1: [ .718, -.1623, -.0246, -.6794, 1.4095, .2977, -.0978, .1328, .8537 ],
            ColorMatrix2: [ .6264, -.0582, -.0724, -.8312, 1.5948, .2504, -.1744, .1919, .8664 ],
            ForwardMatrix1: [ .8156, .0439, .1049, .3946, .6659, -.0605, .1049, -.2425, .9627 ],
            ForwardMatrix2: [ .819, .0766, .0687, .4118, .7224, -.1342, .0507, -.1028, .8772 ],
            CameraCalibration1: [ .9884, 0, 0, 0, 1, 0, 0, 0, .968 ],
            CameraCalibration2: [ .9884, 0, 0, 0, 1, 0, 0, 0, .968 ],
            BlackLevelRepeatDim: [ 1, 1 ],
            CFALayout: 1,
            CFARepeatPatternDim: [ 2, 2 ],
            CFAPlaneColor: [ 0, 1, 2 ],
            CFAPattern: [ 0, 1, 1, 2 ],
            ActiveArea: [ 12, 74, 2360, 3596 ],
            DefaultCropOrigin: [ 10, 7 ],
            DefaultCropSize: [ 3504, 2336 ],
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "red"
                }, {
                    x: 1,
                    y: 0,
                    Color: "green"
                }, {
                    x: 0,
                    y: 1,
                    Color: "green"
                }, {
                    x: 1,
                    y: 1,
                    Color: "blue"
                } ]
            },
            Crop: {
                x: 74,
                y: 12,
                Width: 3522,
                Height: 2348
            },
            Sensor: {
                Black: 127,
                White: 3700
            },
            BlackAreas: [ {
                Offset: 0,
                Size: 72,
                Type: "vertical"
            }, {
                Offset: 2,
                Size: 8,
                Type: "horizontal"
            } ]
        },
        "Canon Canon EOS-1D Mark II N": {
            ReadyForDecoding: true,
            BaselineExposure: .25,
            BaselineNoise: 1,
            BaselineSharpness: 1.5,
            AsShotNeutral: [ .4541020857817004, 1, .804399097785972 ],
            ColorMatrix1: [ .7218, -.159, -.0328, -.6635, 1.3904, .3024, -.0901, .1205, .8114 ],
            ColorMatrix2: [ .624, -.0466, -.0822, -.818, 1.5825, .25, -.1801, .1938, .8042 ],
            ForwardMatrix1: [ .8148, .0412, .1083, .3885, .6722, -.0607, .1065, -.2364, .955 ],
            ForwardMatrix2: [ .8135, .0586, .0922, .4041, .7206, -.1247, .0586, -.1151, .8816 ],
            CameraCalibration1: [ .9881, 0, 0, 0, 1, 0, 0, 0, 1.0178 ],
            CameraCalibration2: [ .9881, 0, 0, 0, 1, 0, 0, 0, 1.0178 ],
            BlackLevelRepeatDim: [ 1, 1 ],
            CFALayout: 1,
            CFARepeatPatternDim: [ 2, 2 ],
            CFAPlaneColor: [ 0, 1, 2 ],
            CFAPattern: [ 0, 1, 1, 2 ],
            ActiveArea: [ 12, 74, 2360, 3596 ],
            DefaultCropOrigin: [ 10, 7 ],
            DefaultCropSize: [ 3504, 2336 ],
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "red"
                }, {
                    x: 1,
                    y: 0,
                    Color: "green"
                }, {
                    x: 0,
                    y: 1,
                    Color: "green"
                }, {
                    x: 1,
                    y: 1,
                    Color: "blue"
                } ]
            },
            Crop: {
                x: 74,
                y: 12,
                Width: 3522,
                Height: 2348
            },
            Sensor: {
                Black: 127,
                White: 3700
            },
            BlackAreas: [ {
                Offset: 0,
                Size: 72,
                Type: "vertical"
            }, {
                Offset: 2,
                Size: 8,
                Type: "horizontal"
            } ]
        },
        "Canon Canon EOS-1D Mark III": {
            ReadyForDecoding: true,
            BaselineExposure: .35,
            BaselineNoise: .75,
            BaselineSharpness: 1,
            AsShotNeutral: [ .5291730454067515, 1, .37491011529985685 ],
            ColorMatrix1: [ .7064, -.1449, -.0503, -.6904, 1.4333, .2817, -.0821, .109, .7409 ],
            ColorMatrix2: [ .6291, -.054, -.0976, -.835, 1.6145, .2311, -.1714, .1858, .7326 ],
            ForwardMatrix1: [ .8153, .0298, .1192, .3947, .6507, -.0454, .1053, -.2299, .9497 ],
            ForwardMatrix2: [ .7798, .0605, .124, .3883, .7036, -.092, .0581, -.1184, .8854 ],
            CameraCalibration1: [ 1.0346, 0, 0, 0, 1, 0, 0, 0, 1.0382 ],
            CameraCalibration2: [ 1.0346, 0, 0, 0, 1, 0, 0, 0, 1.0382 ],
            BlackLevelRepeatDim: [ 1, 1 ],
            CFALayout: 1,
            CFARepeatPatternDim: [ 2, 2 ],
            CFAPlaneColor: [ 0, 1, 2 ],
            CFAPattern: [ 0, 1, 1, 2 ],
            ActiveArea: [ 20, 78, 2620, 3984 ],
            DefaultCropOrigin: [ 10, 5 ],
            DefaultCropSize: [ 3888, 2592 ],
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "red"
                }, {
                    x: 1,
                    y: 0,
                    Color: "green"
                }, {
                    x: 0,
                    y: 1,
                    Color: "green"
                }, {
                    x: 1,
                    y: 1,
                    Color: "blue"
                } ]
            },
            Crop: {
                x: 78,
                y: 20,
                Width: 3906,
                Height: 2600
            },
            Sensor: {
                Black: 1023,
                White: 15100
            },
            BlackAreas: [ {
                Offset: 2,
                Size: 74,
                Type: "vertical"
            }, {
                Offset: 4,
                Size: 14,
                Type: "horizontal"
            } ]
        },
        "Canon Canon EOS-1D Mark IV": {
            ReadyForDecoding: true,
            BaselineExposure: 0,
            BaselineNoise: .75,
            BaselineSharpness: 1.3,
            AsShotNeutral: [ .5174250652084939, 1, .3901460043392039 ],
            ColorMatrix1: [ .9966, -.4682, -.0136, -.28, 1.0398, .279, .0065, .0935, .643 ],
            ColorMatrix2: [ .6014, -.022, -.0795, -.4109, 1.2014, .2361, -.0561, .1824, .5787 ],
            ForwardMatrix1: [ .6031, .2692, .092, .1389, .9853, -.1242, -.0695, -.4034, 1.298 ],
            ForwardMatrix2: [ .8225, .0315, .1102, .2887, .9418, -.2305, -.0099, -.2103, 1.0453 ],
            CameraCalibration1: [ 1.0103, 0, 0, 0, 1, 0, 0, 0, .9907 ],
            CameraCalibration2: [ 1.0103, 0, 0, 0, 1, 0, 0, 0, .9907 ],
            BlackLevelRepeatDim: [ 2, 2 ],
            CFALayout: 1,
            CFARepeatPatternDim: [ 2, 2 ],
            CFAPlaneColor: [ 0, 1, 2 ],
            CFAPattern: [ 0, 1, 1, 2 ],
            ActiveArea: [ 45, 142, 3318, 5058 ],
            DefaultCropOrigin: [ 10, 5 ],
            DefaultCropSize: [ 4896, 3264 ],
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "green"
                }, {
                    x: 1,
                    y: 0,
                    Color: "blue"
                }, {
                    x: 0,
                    y: 1,
                    Color: "red"
                }, {
                    x: 1,
                    y: 1,
                    Color: "green"
                } ]
            },
            Crop: {
                x: 144,
                y: 46,
                Width: -64,
                Height: -2
            },
            Sensor: {
                Black: 2e3,
                White: 13e3,
                Width: 5120,
                Height: 3318
            },
            BlackAreas: [ {
                Offset: 0,
                Size: 140,
                Type: "vertical"
            }, {
                Offset: 26,
                Size: 16,
                Type: "horizontal"
            } ]
        },
        "Canon Canon EOS-1Ds Mark II": {
            ReadyForDecoding: true,
            BaselineExposure: .35,
            BaselineNoise: 1,
            BaselineSharpness: 1,
            AsShotNeutral: [ .6459627008217291, 1, .46203546953892555 ],
            ColorMatrix1: [ .7565, -.1791, -.0272, -.6727, 1.4067, .2934, -.082, .1093, .7688 ],
            ColorMatrix2: [ .6517, -.0602, -.0867, -.818, 1.5926, .2378, -.1618, .1771, .7633 ],
            ForwardMatrix1: [ .8088, .0524, .1032, .3875, .6709, -.0584, .1018, -.2245, .9478 ],
            ForwardMatrix2: [ .7992, .0723, .0928, .396, .7186, -.1145, .0535, -.1081, .8798 ],
            CameraCalibration1: [ 1.0533, 0, 0, 0, 1, 0, 0, 0, 1.0595 ],
            CameraCalibration2: [ 1.0533, 0, 0, 0, 1, 0, 0, 0, 1.0595 ],
            BlackLevelRepeatDim: [ 1, 1 ],
            CFALayout: 1,
            CFARepeatPatternDim: [ 2, 2 ],
            CFAPlaneColor: [ 0, 1, 2 ],
            CFAPattern: [ 0, 1, 1, 2 ],
            ActiveArea: [ 13, 98, 3349, 5108 ],
            DefaultCropOrigin: [ 10, 3 ],
            DefaultCropSize: [ 4992, 3328 ],
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "green"
                }, {
                    x: 1,
                    y: 0,
                    Color: "blue"
                }, {
                    x: 0,
                    y: 1,
                    Color: "red"
                }, {
                    x: 1,
                    y: 1,
                    Color: "green"
                } ]
            },
            Crop: {
                x: 98,
                y: 13,
                Width: 5010,
                Height: 3336
            },
            Sensor: {
                Black: 126,
                White: 4060
            },
            BlackAreas: [ {
                Offset: 0,
                Size: 96,
                Type: "vertical"
            }, {
                Offset: 2,
                Size: 10,
                Type: "horizontal"
            } ]
        },
        "Canon Canon EOS-1Ds Mark III": {
            ReadyForDecoding: true,
            BaselineExposure: .35,
            BaselineNoise: .9,
            BaselineSharpness: 1.2,
            AsShotNeutral: [ .5426766331039258, 1, .42916668276041725 ],
            ColorMatrix1: [ .6704, -.1154, -.0457, -.6783, 1.4191, .2848, -.0853, .116, .749 ],
            ColorMatrix2: [ .5859, -.0211, -.093, -.8255, 1.6017, .2353, -.1732, .1887, .7448 ],
            ForwardMatrix1: [ .8325, .01, .1218, .3987, .6488, -.0475, .1078, -.2457, .963 ],
            ForwardMatrix2: [ .8099, .0216, .1328, .4017, .6908, -.0925, .0599, -.1223, .8876 ],
            CameraCalibration1: [ 1, 0, 0, 0, 1, 0, 0, 0, .9737 ],
            CameraCalibration2: [ 1, 0, 0, 0, 1, 0, 0, 0, .9737 ],
            BlackLevelRepeatDim: [ 1, 1 ],
            CFALayout: 1,
            CFARepeatPatternDim: [ 2, 2 ],
            CFAPlaneColor: [ 0, 1, 2 ],
            CFAPattern: [ 0, 1, 1, 2 ],
            ActiveArea: [ 20, 62, 3774, 5712 ],
            DefaultCropOrigin: [ 10, 5 ],
            DefaultCropSize: [ 5616, 3744 ],
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "red"
                }, {
                    x: 1,
                    y: 0,
                    Color: "green"
                }, {
                    x: 0,
                    y: 1,
                    Color: "green"
                }, {
                    x: 1,
                    y: 1,
                    Color: "blue"
                } ]
            },
            Crop: {
                x: 62,
                y: 20,
                Width: 5640,
                Height: 3752
            },
            Sensor: {
                Black: 1021,
                White: 15100
            },
            BlackAreas: [ {
                Offset: 0,
                Size: 60,
                Type: "vertical"
            }, {
                Offset: 4,
                Size: 14,
                Type: "horizontal"
            } ]
        },
        "Canon Canon EOS-1D X": {
            ReadyForDecoding: true,
            BaselineExposure: 0,
            BaselineNoise: .75,
            BaselineSharpness: 1.3,
            AsShotNeutral: [ .5137983105283953, 1, .722653525934951 ],
            ColorMatrix1: [ .7151, -.1143, -.079, -.3998, 1.14, .2975, -.0477, .1398, .769 ],
            ColorMatrix2: [ .6847, -.0614, -.1014, -.4669, 1.2737, .2139, -.1197, .2488, .6846 ],
            ForwardMatrix1: [ .8042, -.013, .1731, .2588, .823, -.0818, .0172, -.4079, 1.2158 ],
            ForwardMatrix2: [ .7653, .0735, .1255, .2796, .8983, -.1779, .0213, -.2293, 1.0331 ],
            CameraCalibration1: [ .991, 0, 0, 0, 1, 0, 0, 0, .9908 ],
            CameraCalibration2: [ .991, 0, 0, 0, 1, 0, 0, 0, .9908 ],
            BlackLevelRepeatDim: [ 2, 2 ],
            CFALayout: 1,
            CFARepeatPatternDim: [ 2, 2 ],
            CFAPlaneColor: [ 0, 1, 2 ],
            CFAPattern: [ 0, 1, 1, 2 ],
            ActiveArea: [ 100, 126, 3582, 5344 ],
            DefaultCropOrigin: [ 18, 14 ],
            DefaultCropSize: [ 5184, 3456 ],
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "red"
                }, {
                    x: 1,
                    y: 0,
                    Color: "green"
                }, {
                    x: 0,
                    y: 1,
                    Color: "green"
                }, {
                    x: 1,
                    y: 1,
                    Color: "blue"
                } ]
            },
            Crop: {
                x: 128,
                y: 102,
                Width: 0,
                Height: -2
            },
            Sensor: {
                Black: 2050,
                White: 15100
            },
            BlackAreas: [ {
                Offset: 0,
                Size: 120,
                Type: "vertical"
            }, {
                Offset: 0,
                Size: 98,
                Type: "horizontal"
            } ]
        },
        "Canon Canon PowerShot G10": {
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "green"
                }, {
                    x: 1,
                    y: 0,
                    Color: "blue"
                }, {
                    x: 0,
                    y: 1,
                    Color: "red"
                }, {
                    x: 1,
                    y: 1,
                    Color: "green"
                } ]
            },
            Crop: {
                x: 12,
                y: 13,
                Width: 4432,
                Height: 3323
            },
            Sensor: {
                Black: 128,
                White: 4095
            },
            BlackAreas: [ {
                Offset: 0,
                Size: 10,
                Type: "vertical"
            }, {
                Offset: 0,
                Size: 8,
                Type: "horizontal"
            } ]
        },
        "Canon Canon PowerShot G16": {
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "green"
                }, {
                    x: 1,
                    y: 0,
                    Color: "blue"
                }, {
                    x: 0,
                    y: 1,
                    Color: "red"
                }, {
                    x: 1,
                    y: 1,
                    Color: "green"
                } ]
            },
            Crop: {
                x: 106,
                y: 12,
                Width: -10,
                Height: -66
            },
            Sensor: {
                Black: 500,
                White: 2800
            },
            BlackAreas: [ {
                Offset: 0,
                Size: 100,
                Type: "vertical"
            }, {
                Offset: 3062,
                Size: 60,
                Type: "horizontal"
            } ]
        },
        "NIKON CORPORATION NIKON D200": {
            ReadyForDecoding: false,
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "green"
                }, {
                    x: 1,
                    y: 0,
                    Color: "red"
                }, {
                    x: 0,
                    y: 1,
                    Color: "blue"
                }, {
                    x: 1,
                    y: 1,
                    Color: "green"
                } ]
            },
            Crop: {
                x: 2,
                y: 0,
                Width: 3898,
                Height: 2616
            },
            Sensor: {
                Black: 0,
                White: 3880
            }
        },
        "NIKON CORPORATION NIKON D3X": {
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "red"
                }, {
                    x: 1,
                    y: 0,
                    Color: "green"
                }, {
                    x: 0,
                    y: 1,
                    Color: "green"
                }, {
                    x: 1,
                    y: 1,
                    Color: "blue"
                } ]
            },
            Crop: {
                x: 0,
                y: 0,
                Width: 6080,
                Height: 4044
            },
            ReadyForDecoding: true,
            BaselineExposure: .25,
            BaselineNoise: .9,
            BaselineSharpness: 1.2,
            AsShotNeutral: [ .512, 1, .5529156903097102 ],
            ColorMatrix1: [ .8213, -.3151, .0011, -.6594, 1.3688, .3236, -.1101, .1577, .7803 ],
            ColorMatrix2: [ .7171, -.1986, -.0648, -.8085, 1.5555, .2718, -.217, .2512, .7457 ],
            ForwardMatrix1: [ .7118, .2552, -.0027, .3522, .8486, -.2008, .0614, -.1567, .9204 ],
            ForwardMatrix2: [ .7118, .2552, -.0027, .3522, .8486, -.2008, .0614, -.1567, .9204 ],
            CameraCalibration1: [ 1, 0, 0, 0, 1, 0, 0, 0, 1 ],
            CameraCalibration2: [ 1, 0, 0, 0, 1, 0, 0, 0, 1 ],
            BlackLevelRepeatDim: [ 1, 1 ],
            CFALayout: 1,
            CFARepeatPatternDim: [ 2, 2 ],
            CFAPlaneColor: [ 0, 1, 2 ],
            CFAPattern: [ 0, 1, 1, 2 ],
            ActiveArea: [ 0, 0, 4044, 6080 ],
            DefaultCropOrigin: [ 15, 6 ],
            DefaultCropSize: [ 6048, 4032 ],
            Sensor: {
                Black: 0,
                White: 15892
            }
        },
        "NIKON CORPORATION NIKON D300": {
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "red"
                }, {
                    x: 1,
                    y: 0,
                    Color: "green"
                }, {
                    x: 0,
                    y: 1,
                    Color: "green"
                }, {
                    x: 1,
                    y: 1,
                    Color: "blue"
                } ]
            },
            Crop: {
                x: 0,
                y: 0,
                Width: 4320,
                Height: 2868
            },
            ReadyForDecoding: false,
            BaselineExposure: 1.5,
            BaselineNoise: 1,
            BaselineSharpness: 1,
            AsShotNeutral: [ .6956521739130435, 1, .6881720430107527 ],
            ColorMatrix1: [ 1.0354, -.3401, .0054, -.7111, 1.4628, .2702, -.135, .2011, .8528 ],
            ColorMatrix2: [ .903, -.1992, -.0716, -.8465, 1.6302, .2256, -.2689, .3217, .8069 ],
            ForwardMatrix1: [ .7708, .1873, .0062, .3832, .7719, -.1551, .0723, -.1832, .9361 ],
            ForwardMatrix2: [ .7708, .1873, .0062, .3832, .7719, -.1551, .0723, -.1832, .9361 ],
            CameraCalibration1: [ 1, 0, 0, 0, 1, 0, 0, 0, 1 ],
            CameraCalibration2: [ 1, 0, 0, 0, 1, 0, 0, 0, 1 ],
            BlackLevelRepeatDim: [ 1, 1 ],
            CFALayout: 1,
            CFARepeatPatternDim: [ 2, 2 ],
            CFAPlaneColor: [ 0, 1, 2 ],
            CFAPattern: [ 0, 1, 1, 2 ],
            ActiveArea: [ 0, 0, 2868, 4320 ],
            DefaultCropOrigin: [ 15, 10 ],
            DefaultCropSize: [ 4288, 2848 ],
            Sensor: {
                Black: 0,
                White: 15236
            }
        },
        "NIKON CORPORATION NIKON D300S": {
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "red"
                }, {
                    x: 1,
                    y: 0,
                    Color: "green"
                }, {
                    x: 0,
                    y: 1,
                    Color: "green"
                }, {
                    x: 1,
                    y: 1,
                    Color: "blue"
                } ]
            },
            Crop: {
                x: 0,
                y: 0,
                Width: 4320,
                Height: 2868
            },
            ReadyForDecoding: true,
            BaselineExposure: 1.5,
            BaselineNoise: 1,
            BaselineSharpness: 1,
            AsShotNeutral: [ .6956521739130435, 1, .6881720430107527 ],
            ColorMatrix1: [ 1.0354, -.3401, .0054, -.7111, 1.4628, .2702, -.135, .2011, .8528 ],
            ColorMatrix2: [ .903, -.1992, -.0716, -.8465, 1.6302, .2256, -.2689, .3217, .8069 ],
            ForwardMatrix1: [ .7708, .1873, .0062, .3832, .7719, -.1551, .0723, -.1832, .9361 ],
            ForwardMatrix2: [ .7708, .1873, .0062, .3832, .7719, -.1551, .0723, -.1832, .9361 ],
            CameraCalibration1: [ 1, 0, 0, 0, 1, 0, 0, 0, 1 ],
            CameraCalibration2: [ 1, 0, 0, 0, 1, 0, 0, 0, 1 ],
            BlackLevelRepeatDim: [ 1, 1 ],
            CFALayout: 1,
            CFARepeatPatternDim: [ 2, 2 ],
            CFAPlaneColor: [ 0, 1, 2 ],
            CFAPattern: [ 0, 1, 1, 2 ],
            ActiveArea: [ 0, 0, 2868, 4320 ],
            DefaultCropOrigin: [ 15, 10 ],
            DefaultCropSize: [ 4288, 2848 ],
            Sensor: {
                Black: 0,
                White: 3808
            }
        },
        "NIKON CORPORATION NIKON D3000": {
            ReadyForDecoding: false,
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "green"
                }, {
                    x: 1,
                    y: 0,
                    Color: "blue"
                }, {
                    x: 0,
                    y: 1,
                    Color: "red"
                }, {
                    x: 1,
                    y: 1,
                    Color: "green"
                } ]
            },
            Crop: {
                x: 0,
                y: 0,
                Width: 3898,
                Height: 2610
            },
            Sensor: {
                Black: 0,
                White: 16383
            }
        },
        "NIKON CORPORATION NIKON D3200": {
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "red"
                }, {
                    x: 1,
                    y: 0,
                    Color: "green"
                }, {
                    x: 0,
                    y: 1,
                    Color: "green"
                }, {
                    x: 1,
                    y: 1,
                    Color: "blue"
                } ]
            },
            Crop: {
                x: 0,
                y: 0,
                Width: -48,
                Height: 0
            },
            ReadyForDecoding: true,
            BaselineExposure: .35,
            BaselineNoise: 1,
            BaselineSharpness: 1,
            AsShotNeutral: [ .5458422919699503, 1, .6881720430107527 ],
            ColorMatrix1: [ .7179, -.1985, .0103, -.4102, 1.0944, .3649, -.0609, .1585, .8185 ],
            ColorMatrix2: [ .7013, -.1408, -.0635, -.5268, 1.2902, .264, -.147, .2801, .7379 ],
            ForwardMatrix1: [ .7755, .0884, .1003, .2732, .8748, -.148, .0234, -.4317, 1.2333 ],
            ForwardMatrix2: [ .7477, .2145, .002, .3005, .9721, -.2726, .0232, -.2404, 1.0423 ],
            CameraCalibration1: [ 1, 0, 0, 0, 1, 0, 0, 0, 1 ],
            CameraCalibration2: [ 1, 0, 0, 0, 1, 0, 0, 0, 1 ],
            BlackLevelRepeatDim: [ 1, 1 ],
            CFALayout: 1,
            CFARepeatPatternDim: [ 2, 2 ],
            CFAPlaneColor: [ 0, 1, 2 ],
            CFAPattern: [ 0, 1, 1, 2 ],
            ActiveArea: [ 0, 0, 4012, 6034 ],
            DefaultCropOrigin: [ 8, 6 ],
            DefaultCropSize: [ 6016, 4e3 ],
            Sensor: {
                Black: 0,
                White: 3880
            }
        },
        "NIKON CORPORATION NIKON D3300": {
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "red"
                }, {
                    x: 1,
                    y: 0,
                    Color: "green"
                }, {
                    x: 0,
                    y: 1,
                    Color: "green"
                }, {
                    x: 1,
                    y: 1,
                    Color: "blue"
                } ]
            },
            Crop: {
                x: 0,
                y: 0,
                Width: -48,
                Height: 0
            },
            ReadyForDecoding: true,
            BaselineExposure: .35,
            BaselineNoise: 1,
            BaselineSharpness: 1,
            AsShotNeutral: [ .4196720430852106, 1, .8533333333333334 ],
            ColorMatrix1: [ .9672, -.4153, .0064, -.412, 1.1852, .2571, -.094, .1812, .7894 ],
            ColorMatrix2: [ .6988, -.1384, -.0714, -.5631, 1.341, .2447, -.1485, .2204, .7318 ],
            ForwardMatrix1: [ .5659, .2657, .1327, .3421, .615, .0429, .2195, 2e-4, .6055 ],
            ForwardMatrix2: [ .5042, .2789, .1812, .2922, .6514, .0563, .1447, .0047, .6757 ],
            CameraCalibration1: [ 1, 0, 0, 0, 1, 0, 0, 0, 1 ],
            CameraCalibration2: [ 1, 0, 0, 0, 1, 0, 0, 0, 1 ],
            BlackLevelRepeatDim: [ 2, 2 ],
            CFALayout: 1,
            CFARepeatPatternDim: [ 2, 2 ],
            CFAPlaneColor: [ 0, 1, 2 ],
            CFAPattern: [ 0, 1, 1, 2 ],
            ActiveArea: [ 0, 0, 4016, 6016 ],
            DefaultCropOrigin: [ 8, 8 ],
            DefaultCropSize: [ 6e3, 4e3 ],
            Sensor: {
                Black: 147,
                White: 3880
            }
        },
        "NIKON CORPORATION NIKON D4": {
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "red"
                }, {
                    x: 1,
                    y: 0,
                    Color: "green"
                }, {
                    x: 0,
                    y: 1,
                    Color: "green"
                }, {
                    x: 1,
                    y: 1,
                    Color: "blue"
                } ]
            },
            Crop: {
                x: 2,
                y: 0,
                Width: -50,
                Height: 0
            },
            Sensor: {
                Black: 0,
                White: 16383
            },
            ReadyForDecoding: true,
            BaselineExposure: .25,
            BaselineNoise: .6,
            BaselineSharpness: 1,
            AsShotNeutral: [ .5322246030402799, 1, .6481011608139892 ],
            ColorMatrix1: [ .9033, -.3555, -.0287, -.4881, 1.2214, .3022, -.0459, .0926, .7932 ],
            ColorMatrix2: [ .8598, -.2848, -.0857, -.5618, 1.3606, .2195, -.1002, .1773, .7137 ],
            ForwardMatrix1: [ .6919, .1772, .0952, .2645, .8172, -.0817, .0392, -.2442, 1.0301 ],
            ForwardMatrix2: [ .6227, .3389, .0026, .2548, .9378, -.1926, .0156, -.133, .9425 ],
            CameraCalibration1: [ 1, 0, 0, 0, 1, 0, 0, 0, 1 ],
            CameraCalibration2: [ 1, 0, 0, 0, 1, 0, 0, 0, 1 ],
            BlackLevelRepeatDim: [ 1, 1 ],
            CFALayout: 1,
            CFARepeatPatternDim: [ 2, 2 ],
            CFAPlaneColor: [ 0, 1, 2 ],
            CFAPattern: [ 0, 1, 1, 2 ],
            ActiveArea: [ 0, 0, 3292, 4940 ],
            DefaultCropOrigin: [ 6, 6 ],
            DefaultCropSize: [ 4928, 3280 ],
            BlackAreas: [ {
                Offset: 4984,
                Size: 8,
                Type: "vertical"
            } ]
        },
        "NIKON CORPORATION NIKON D4S": {
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "red"
                }, {
                    x: 1,
                    y: 0,
                    Color: "green"
                }, {
                    x: 0,
                    y: 1,
                    Color: "green"
                }, {
                    x: 1,
                    y: 1,
                    Color: "blue"
                } ]
            },
            Crop: {
                x: 2,
                y: 0,
                Width: -50,
                Height: 0
            },
            Sensor: {
                Black: 768,
                White: 15520
            },
            ReadyForDecoding: true,
            BaselineExposure: .25,
            BaselineNoise: .6,
            BaselineSharpness: 1,
            AsShotNeutral: [ .5150906095891328, 1, .6666666666666666 ],
            ColorMatrix1: [ .9033, -.3555, -.0287, -.4881, 1.2214, .3022, -.0459, .0926, .7932 ],
            ColorMatrix2: [ .8598, -.2848, -.0857, -.5618, 1.3606, .2195, -.1002, .1773, .7137 ],
            ForwardMatrix1: [ .6919, .1772, .0952, .2645, .8172, -.0817, .0392, -.2442, 1.0301 ],
            ForwardMatrix2: [ .6227, .3389, .0026, .2548, .9378, -.1926, .0156, -.133, .9425 ],
            CameraCalibration1: [ 1, 0, 0, 0, 1, 0, 0, 0, 1 ],
            CameraCalibration2: [ 1, 0, 0, 0, 1, 0, 0, 0, 1 ],
            BlackLevelRepeatDim: [ 2, 2 ],
            CFALayout: 1,
            CFARepeatPatternDim: [ 2, 2 ],
            CFAPlaneColor: [ 0, 1, 2 ],
            CFAPattern: [ 0, 1, 1, 2 ],
            ActiveArea: [ 0, 0, 3288, 4936 ],
            DefaultCropOrigin: [ 4, 4 ],
            DefaultCropSize: [ 4928, 3280 ],
            BlackAreas: [ {
                Offset: 4984,
                Size: 8,
                Type: "vertical"
            } ]
        },
        "NIKON CORPORATION NIKON D3100": {
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "green"
                }, {
                    x: 1,
                    y: 0,
                    Color: "blue"
                }, {
                    x: 0,
                    y: 1,
                    Color: "red"
                }, {
                    x: 1,
                    y: 1,
                    Color: "green"
                } ]
            },
            Crop: {
                x: 8,
                y: 2,
                Width: -24,
                Height: -2
            },
            Sensor: {
                Black: 0,
                White: 4095
            },
            ReadyForDecoding: true,
            BaselineExposure: 0,
            BaselineNoise: 1,
            BaselineSharpness: 1,
            AsShotNeutral: [ .4970873168668189, 1, .7573961628795596 ],
            ColorMatrix1: [ .8306, -.282, -.041, -.455, 1.1949, .2955, -.0675, .1472, .8632 ],
            ColorMatrix2: [ .7911, -.2167, -.0813, -.5327, 1.315, .2408, -.1288, .2483, .7968 ],
            ForwardMatrix1: [ .7209, .1305, .1129, .2567, .8338, -.0905, .0443, -.3308, 1.1117 ],
            ForwardMatrix2: [ .6717, .2817, .0109, .2695, .9596, -.2291, .0159, -.1835, .9927 ],
            CameraCalibration1: [ 1, 0, 0, 0, 1, 0, 0, 0, 1 ],
            CameraCalibration2: [ 1, 0, 0, 0, 1, 0, 0, 0, 1 ],
            BlackLevelRepeatDim: [ 1, 1 ],
            CFALayout: 1,
            CFARepeatPatternDim: [ 2, 2 ],
            CFAPlaneColor: [ 0, 1, 2 ],
            CFAPattern: [ 1, 2, 0, 1 ],
            ActiveArea: [ 0, 0, 3084, 4644 ],
            DefaultCropOrigin: [ 18, 6 ],
            DefaultCropSize: [ 4608, 3072 ]
        },
        "NIKON CORPORATION NIKON D40X": {
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "green"
                }, {
                    x: 1,
                    y: 0,
                    Color: "blue"
                }, {
                    x: 0,
                    y: 1,
                    Color: "red"
                }, {
                    x: 1,
                    y: 1,
                    Color: "green"
                } ]
            },
            Crop: {
                x: 4,
                y: 0,
                Width: 3896,
                Height: 2613
            },
            Sensor: {
                Black: 0,
                White: 3880
            }
        },
        "NIKON CORPORATION NIKON D40": {
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "blue"
                }, {
                    x: 1,
                    y: 0,
                    Color: "green"
                }, {
                    x: 0,
                    y: 1,
                    Color: "green"
                }, {
                    x: 1,
                    y: 1,
                    Color: "red"
                } ]
            },
            Crop: {
                x: 0,
                y: 0,
                Width: 3038,
                Height: 2014
            },
            Sensor: {
                Black: 0,
                White: 3880
            }
        },
        "NIKON CORPORATION NIKON D5000": {
            ReadyForDecoding: true,
            BaselineExposure: .92,
            BaselineNoise: 1,
            BaselineSharpness: 1,
            AsShotNeutral: [ .7485377315414338, 1, .588505660541696 ],
            ColorMatrix1: [ .8437, -.2581, .0132, -.6948, 1.4143, .31, -.1215, .1778, .83 ],
            ColorMatrix2: [ .7309, -.1403, -.0519, -.8474, 1.6008, .2622, -.2433, .2826, .8064 ],
            ForwardMatrix1: [ .8031, .1702, -.009, .4054, .7851, -.1905, .0695, -.1657, .9213 ],
            ForwardMatrix2: [ .8031, .1702, -.009, .4054, .7851, -.1905, .0695, -.1657, .9213 ],
            CameraCalibration1: [ 1, 0, 0, 0, 1, 0, 0, 0, 1 ],
            CameraCalibration2: [ 1, 0, 0, 0, 1, 0, 0, 0, 1 ],
            BlackLevelRepeatDim: [ 1, 1 ],
            CFALayout: 1,
            CFARepeatPatternDim: [ 2, 2 ],
            CFAPlaneColor: [ 0, 1, 2 ],
            CFAPattern: [ 1, 2, 0, 1 ],
            ActiveArea: [ 0, 0, 2868, 4310 ],
            DefaultCropOrigin: [ 11, 10 ],
            DefaultCropSize: [ 4288, 2848 ],
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "green"
                }, {
                    x: 1,
                    y: 0,
                    Color: "blue"
                }, {
                    x: 0,
                    y: 1,
                    Color: "red"
                }, {
                    x: 1,
                    y: 1,
                    Color: "green"
                } ]
            },
            Crop: {
                x: 0,
                y: 0,
                Width: 4310,
                Height: 2868
            },
            Sensor: {
                Black: 0,
                White: 4096
            }
        },
        "NIKON CORPORATION NIKON D5100": {
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "red"
                }, {
                    x: 1,
                    y: 0,
                    Color: "green"
                }, {
                    x: 0,
                    y: 1,
                    Color: "green"
                }, {
                    x: 1,
                    y: 1,
                    Color: "blue"
                } ]
            },
            Crop: {
                x: 0,
                y: 0,
                Width: -46,
                Height: 0
            },
            ReadyForDecoding: true,
            BaselineExposure: 0,
            BaselineNoise: 1,
            BaselineSharpness: 1.25,
            AsShotNeutral: [ 1, .49709, .65631 ],
            ColorMatrix1: [ .8642, -.3058, -.0243, -.3999, 1.1033, .3422, -.0453, .1099, .7814 ],
            ColorMatrix2: [ .8198, -.2239, -.0724, -.4871, 1.2389, .2798, -.1043, .205, .7181 ],
            ForwardMatrix1: [ .7132, .1579, .0931, .2379, .8888, -.1267, .0316, -.3024, 1.0959 ],
            ForwardMatrix2: [ .6876, .3081, -.0314, .2676, 1.0343, -.3019, .0151, -.1801, .9901 ],
            CameraCalibration1: [ 1, 0, 0, 0, 1, 0, 0, 0, 1 ],
            CameraCalibration2: [ 1, 0, 0, 0, 1, 0, 0, 0, 1 ],
            BlackLevelRepeatDim: [ 1, 1 ],
            CFALayout: 1,
            CFARepeatPatternDim: [ 2, 2 ],
            CFAPlaneColor: [ 0, 1, 2 ],
            CFAPattern: [ 0, 1, 1, 2 ],
            ActiveArea: [ 0, 0, 3280, 4948 ],
            DefaultCropOrigin: [ 8, 8 ],
            DefaultCropSize: [ 4928, 3264 ],
            Sensor: {
                Black: 0,
                White: 15892
            }
        },
        "NIKON CORPORATION NIKON D5200": {
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "red"
                }, {
                    x: 1,
                    y: 0,
                    Color: "green"
                }, {
                    x: 0,
                    y: 1,
                    Color: "green"
                }, {
                    x: 1,
                    y: 1,
                    Color: "blue"
                } ]
            },
            Crop: {
                x: 0,
                y: 0,
                Width: 0,
                Height: 0
            },
            ReadyForDecoding: true,
            BaselineExposure: .35,
            BaselineNoise: 1,
            BaselineSharpness: 1,
            AsShotNeutral: [ .5412262888762843, 1, .4970873168668189 ],
            ColorMatrix1: [ .8693, -.3745, -.0467, -.5349, 1.2601, .3098, -.0367, .0752, .7041 ],
            ColorMatrix2: [ .8322, -.3112, -.1047, -.6367, 1.4342, .2179, -.0988, .1638, .6394 ],
            ForwardMatrix1: [ .6637, .2038, .0968, .2768, .8043, -.0812, .0259, -.2161, 1.0153 ],
            ForwardMatrix2: [ .5536, .3713, .0394, .2424, .9215, -.1639, .0149, -.1266, .9368 ],
            CameraCalibration1: [ 1, 0, 0, 0, 1, 0, 0, 0, 1 ],
            CameraCalibration2: [ 1, 0, 0, 0, 1, 0, 0, 0, 1 ],
            BlackLevelRepeatDim: [ 1, 1 ],
            CFALayout: 1,
            CFARepeatPatternDim: [ 2, 2 ],
            CFAPlaneColor: [ 0, 1, 2 ],
            CFAPattern: [ 0, 1, 1, 2 ],
            ActiveArea: [ 0, 0, 4020, 6036 ],
            DefaultCropOrigin: [ 18, 10 ],
            DefaultCropSize: [ 6e3, 4e3 ],
            Sensor: {
                Black: 0,
                White: 15892
            }
        },
        "NIKON CORPORATION NIKON D5300": {
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "red"
                }, {
                    x: 1,
                    y: 0,
                    Color: "green"
                }, {
                    x: 0,
                    y: 1,
                    Color: "green"
                }, {
                    x: 1,
                    y: 1,
                    Color: "blue"
                } ]
            },
            Crop: {
                x: 0,
                y: 0,
                Width: 0,
                Height: 0
            },
            ReadyForDecoding: true,
            BaselineExposure: .35,
            BaselineNoise: 1,
            BaselineSharpness: 1,
            AsShotNeutral: [ .5553146107161282, 1, .6124400038461232 ],
            ColorMatrix1: [ .9672, -.4153, .0064, -.412, 1.1852, .2571, -.094, .1812, .7894 ],
            ColorMatrix2: [ .6988, -.1384, -.0714, -.5631, 1.341, .2447, -.1485, .2204, .7318 ],
            ForwardMatrix1: [ .5659, .2657, .1327, .3421, .615, .0429, .2195, 2e-4, .6055 ],
            ForwardMatrix2: [ .5042, .2789, .1812, .2922, .6514, .0563, .1447, .0047, .6757 ],
            CameraCalibration1: [ 1, 0, 0, 0, 1, 0, 0, 0, 1 ],
            CameraCalibration2: [ 1, 0, 0, 0, 1, 0, 0, 0, 1 ],
            BlackLevelRepeatDim: [ 2, 2 ],
            CFALayout: 1,
            CFARepeatPatternDim: [ 2, 2 ],
            CFAPlaneColor: [ 0, 1, 2 ],
            CFAPattern: [ 0, 1, 1, 2 ],
            ActiveArea: [ 0, 0, 4016, 6016 ],
            DefaultCropOrigin: [ 8, 8 ],
            DefaultCropSize: [ 6e3, 4e3 ],
            Sensor: {
                Black: 600,
                White: 15892
            }
        },
        "NIKON CORPORATION NIKON D600": {
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "red"
                }, {
                    x: 1,
                    y: 0,
                    Color: "green"
                }, {
                    x: 0,
                    y: 1,
                    Color: "green"
                }, {
                    x: 1,
                    y: 1,
                    Color: "blue"
                } ]
            },
            Crop: {
                x: 0,
                y: 0,
                Width: -50,
                Height: 0
            },
            ReadyForDecoding: true,
            BaselineExposure: .35,
            BaselineNoise: .6,
            BaselineSharpness: 1.33,
            AsShotNeutral: [ .5517241379310345, 1, .6863271955092239 ],
            ColorMatrix1: [ .8508, -.2966, .0171, -.3991, 1.0849, .3635, -.0467, .1053, .8072 ],
            ColorMatrix2: [ .8178, -.2245, -.0609, -.4857, 1.2394, .2776, -.1207, .2086, .7298 ],
            ForwardMatrix1: [ .7308, .1593, .0742, .2481, .8874, -.1355, .0409, -.2996, 1.0838 ],
            ForwardMatrix2: [ .7008, .3187, -.0551, .2691, 1.036, -.3051, .0258, -.1753, .9746 ],
            CameraCalibration1: [ 1, 0, 0, 0, 1, 0, 0, 0, 1 ],
            CameraCalibration2: [ 1, 0, 0, 0, 1, 0, 0, 0, 1 ],
            BlackLevelRepeatDim: [ 1, 1 ],
            CFALayout: 1,
            CFARepeatPatternDim: [ 2, 2 ],
            CFAPlaneColor: [ 0, 1, 2 ],
            CFAPattern: [ 0, 1, 1, 2 ],
            ActiveArea: [ 0, 0, 4028, 6034 ],
            DefaultCropOrigin: [ 8, 6 ],
            DefaultCropSize: [ 6016, 4016 ],
            Sensor: {
                Black: 0,
                White: 15520
            }
        },
        "NIKON CORPORATION NIKON D610": {
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "red"
                }, {
                    x: 1,
                    y: 0,
                    Color: "green"
                }, {
                    x: 0,
                    y: 1,
                    Color: "green"
                }, {
                    x: 1,
                    y: 1,
                    Color: "blue"
                } ]
            },
            Crop: {
                x: 0,
                y: 0,
                Width: -50,
                Height: 0
            },
            ReadyForDecoding: true,
            BaselineExposure: .35,
            BaselineNoise: .6,
            BaselineSharpness: 1.33,
            AsShotNeutral: [ .5517241379310345, 1, .6863271955092239 ],
            ColorMatrix1: [ .8508, -.2966, .0171, -.3991, 1.0849, .3635, -.0467, .1053, .8072 ],
            ColorMatrix2: [ .8178, -.2245, -.0609, -.4857, 1.2394, .2776, -.1207, .2086, .7298 ],
            ForwardMatrix1: [ .7308, .1593, .0742, .2481, .8874, -.1355, .0409, -.2996, 1.0838 ],
            ForwardMatrix2: [ .7008, .3187, -.0551, .2691, 1.036, -.3051, .0258, -.1753, .9746 ],
            CameraCalibration1: [ 1, 0, 0, 0, 1, 0, 0, 0, 1 ],
            CameraCalibration2: [ 1, 0, 0, 0, 1, 0, 0, 0, 1 ],
            BlackLevelRepeatDim: [ 1, 1 ],
            CFALayout: 1,
            CFARepeatPatternDim: [ 2, 2 ],
            CFAPlaneColor: [ 0, 1, 2 ],
            CFAPattern: [ 0, 1, 1, 2 ],
            ActiveArea: [ 0, 0, 4028, 6034 ],
            DefaultCropOrigin: [ 8, 6 ],
            DefaultCropSize: [ 6016, 4016 ],
            Sensor: {
                Black: 0,
                White: 15520
            }
        },
        "NIKON CORPORATION NIKON Df": {
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "blue"
                }, {
                    x: 1,
                    y: 0,
                    Color: "green"
                }, {
                    x: 0,
                    y: 1,
                    Color: "green"
                }, {
                    x: 1,
                    y: 1,
                    Color: "red"
                } ]
            },
            Crop: {
                x: 0,
                y: 0,
                Width: 4928,
                Height: 3280
            },
            ReadyForDecoding: true,
            BaselineExposure: .25,
            BaselineNoise: .6,
            BaselineSharpness: 1,
            AsShotNeutral: [ .4368599728360469, 1, .7641789584852139 ],
            ColorMatrix1: [ .9033, -.3555, -.0287, -.4881, 1.2214, .3022, -.0459, .0926, .7932 ],
            ColorMatrix2: [ .8598, -.2848, -.0857, -.5618, 1.3606, .2195, -.1002, .1773, .7137 ],
            ForwardMatrix1: [ .6919, .1772, .0952, .2645, .8172, -.0817, .0392, -.2442, 1.0301 ],
            ForwardMatrix2: [ .6227, .3389, .0026, .2548, .9378, -.1926, .0156, -.133, .9425 ],
            CameraCalibration1: [ 1, 0, 0, 0, 1, 0, 0, 0, 1 ],
            CameraCalibration2: [ 1, 0, 0, 0, 1, 0, 0, 0, 1 ],
            BlackLevelRepeatDim: [ 1, 1 ],
            CFALayout: 1,
            CFARepeatPatternDim: [ 2, 2 ],
            CFAPlaneColor: [ 0, 1, 2 ],
            CFAPattern: [ 0, 1, 1, 2 ],
            ActiveArea: [ 0, 0, 3292, 4940 ],
            DefaultCropOrigin: [ 6, 6 ],
            DefaultCropSize: [ 4928, 3280 ],
            Sensor: {
                Black: 0,
                White: 15520
            }
        },
        "NIKON CORPORATION NIKON D700": {
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "red"
                }, {
                    x: 1,
                    y: 0,
                    Color: "green"
                }, {
                    x: 0,
                    y: 1,
                    Color: "green"
                }, {
                    x: 1,
                    y: 1,
                    Color: "blue"
                } ]
            },
            ReadyForDecoding: true,
            BaselineExposure: .5,
            BaselineNoise: .6,
            BaselineSharpness: 1,
            AsShotNeutral: [ .53002063370327, 1, .7191011235955056 ],
            ColorMatrix1: [ .9336, -.3405, .0014, -.732, 1.4779, .2763, -.0914, .1171, .8248 ],
            ColorMatrix2: [ .8139, -.2171, -.0663, -.8747, 1.6541, .2295, -.1925, .2008, .8093 ],
            ForwardMatrix1: [ .7539, .1323, .0781, .3791, .6808, -.0599, .0975, -.2017, .9293 ],
            ForwardMatrix2: [ .7344, .2281, .0017, .3736, .772, -.1457, .0568, -.0994, .8677 ],
            CameraCalibration1: [ 1, 0, 0, 0, 1, 0, 0, 0, 1 ],
            CameraCalibration2: [ 1, 0, 0, 0, 1, 0, 0, 0, 1 ],
            BlackLevelRepeatDim: [ 1, 1 ],
            CFALayout: 1,
            CFARepeatPatternDim: [ 2, 2 ],
            CFAPlaneColor: [ 0, 1, 2 ],
            CFAPattern: [ 0, 1, 1, 2 ],
            ActiveArea: [ 0, 0, 2844, 4284 ],
            DefaultCropOrigin: [ 13, 6 ],
            DefaultCropSize: [ 4256, 2832 ],
            Crop: {
                x: 2,
                y: 0,
                Width: 4282,
                Height: 2844
            },
            Sensor: {
                Black: 0,
                White: 3972
            }
        },
        "NIKON CORPORATION NIKON D750": {
            ReadyForDecoding: false
        },
        "NIKON CORPORATION NIKON D7000": {
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "red"
                }, {
                    x: 1,
                    y: 0,
                    Color: "green"
                }, {
                    x: 0,
                    y: 1,
                    Color: "green"
                }, {
                    x: 1,
                    y: 1,
                    Color: "blue"
                } ]
            },
            Crop: {
                x: 0,
                y: 0,
                Width: -46,
                Height: -2
            },
            ReadyForDecoding: true,
            BaselineExposure: 0,
            BaselineNoise: 1,
            BaselineSharpness: 1.25,
            AsShotNeutral: [ .8258061106348963, 1, .4970873168668189 ],
            ColorMatrix1: [ .8642, -.3058, -.0243, -.3999, 1.1033, .3422, -.0453, .1099, .7814 ],
            ColorMatrix2: [ .8198, -.2239, -.0724, -.4871, 1.2389, .2798, -.1043, .205, .7181 ],
            ForwardMatrix1: [ .7132, .1579, .0931, .2379, .8888, -.1267, .0316, -.3024, 1.0959 ],
            ForwardMatrix2: [ .6876, .3081, -.0314, .2676, 1.0343, -.3019, .0151, -.1801, .9901 ],
            CameraCalibration1: [ 1, 0, 0, 0, 1, 0, 0, 0, 1 ],
            CameraCalibration2: [ 1, 0, 0, 0, 1, 0, 0, 0, 1 ],
            BlackLevelRepeatDim: [ 1, 1 ],
            CFALayout: 1,
            CFARepeatPatternDim: [ 2, 2 ],
            CFAPlaneColor: [ 0, 1, 2 ],
            CFAPattern: [ 0, 1, 1, 2 ],
            ActiveArea: [ 0, 0, 3280, 4948 ],
            DefaultCropOrigin: [ 8, 8 ],
            DefaultCropSize: [ 4928, 3264 ],
            Sensor: {
                Black: 0,
                White: 15892
            }
        },
        "NIKON CORPORATION NIKON D7100": {
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "red"
                }, {
                    x: 1,
                    y: 0,
                    Color: "green"
                }, {
                    x: 0,
                    y: 1,
                    Color: "green"
                }, {
                    x: 1,
                    y: 1,
                    Color: "blue"
                } ]
            },
            Crop: {
                x: 0,
                y: 0,
                Width: 0,
                Height: 0
            },
            ReadyForDecoding: true,
            BaselineExposure: .35,
            BaselineNoise: 1,
            BaselineSharpness: 1,
            AsShotNeutral: [ .6213592233009708, 1, .43537414965986393 ],
            ColorMatrix1: [ .8693, -.3745, -.0467, -.5349, 1.2601, .3098, -.0367, .0752, .7041 ],
            ColorMatrix2: [ .8322, -.3112, -.1047, -.6367, 1.4342, .2179, -.0988, .1638, .6394 ],
            ForwardMatrix1: [ .6637, .2038, .0968, .2768, .8043, -.0812, .0259, -.2161, 1.0153 ],
            ForwardMatrix2: [ .5536, .3713, .0394, .2424, .9215, -.1639, .0149, -.1266, .9368 ],
            CameraCalibration1: [ 1, 0, 0, 0, 1, 0, 0, 0, 1 ],
            CameraCalibration2: [ 1, 0, 0, 0, 1, 0, 0, 0, 1 ],
            BlackLevelRepeatDim: [ 1, 1 ],
            CFALayout: 1,
            CFARepeatPatternDim: [ 2, 2 ],
            CFAPlaneColor: [ 0, 1, 2 ],
            CFAPattern: [ 0, 1, 1, 2 ],
            ActiveArea: [ 0, 0, 4020, 6036 ],
            DefaultCropOrigin: [ 18, 10 ],
            DefaultCropSize: [ 6e3, 4e3 ],
            Sensor: {
                Black: 0,
                White: 15892
            }
        },
        "NIKON CORPORATION NIKON D800": {
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "red"
                }, {
                    x: 1,
                    y: 0,
                    Color: "green"
                }, {
                    x: 0,
                    y: 1,
                    Color: "green"
                }, {
                    x: 1,
                    y: 1,
                    Color: "blue"
                } ]
            },
            Crop: {
                x: 2,
                y: 0,
                Width: -48,
                Height: 0
            },
            ReadyForDecoding: true,
            BaselineExposure: .35,
            BaselineNoise: .6,
            BaselineSharpness: 1,
            AsShotNeutral: [ .4894836877113652, 1, .7335244898153792 ],
            ColorMatrix1: [ .8437, -.3046, .0228, -.397, 1.0927, .3516, -.0444, .1049, .825 ],
            ColorMatrix2: [ .7866, -.2108, -.0555, -.4869, 1.2483, .2681, -.1176, .2069, .7501 ],
            ForwardMatrix1: [ .7237, .1692, .0714, .2421, .8875, -.1296, .0359, -.2945, 1.0838 ],
            ForwardMatrix2: [ .7111, .3061, -.053, .2728, 1.0168, -.2896, .024, -.1679, .969 ],
            CameraCalibration1: [ 1, 0, 0, 0, 1, 0, 0, 0, 1 ],
            CameraCalibration2: [ 1, 0, 0, 0, 1, 0, 0, 0, 1 ],
            BlackLevelRepeatDim: [ 1, 1 ],
            CFALayout: 1,
            CFARepeatPatternDim: [ 2, 2 ],
            CFAPlaneColor: [ 0, 1, 2 ],
            CFAPattern: [ 0, 1, 1, 2 ],
            ActiveArea: [ 0, 0, 4924, 7378 ],
            DefaultCropOrigin: [ 8, 6 ],
            DefaultCropSize: [ 7360, 4912 ],
            Sensor: {
                Black: 0,
                White: 3972
            },
            Aliases: [ "NIKON D800E" ]
        },
        "NIKON CORPORATION NIKON D90": {
            CFA: {
                Width: 2,
                Height: 2,
                Pattern: [ {
                    x: 0,
                    y: 0,
                    Color: "green"
                }, {
                    x: 1,
                    y: 0,
                    Color: "blue"
                }, {
                    x: 0,
                    y: 1,
                    Color: "red"
                }, {
                    x: 1,
                    y: 1,
                    Color: "green"
                } ]
            },
            Crop: {
                x: 0,
                y: 0,
                Width: 4310,
                Height: 2868
            },
            ReadyForDecoding: true,
            BaselineExposure: -.55,
            BaselineNoise: 1,
            BaselineSharpness: 1,
            AsShotNeutral: [ .5389472958049959, 1, .8025076759859208 ],
            ColorMatrix1: [ .8437, -.258, .0132, -.6948, 1.4143, .3099, -.1215, .1778, .83 ],
            ColorMatrix2: [ .7309, -.1403, -.0519, -.8474, 1.6008, .2622, -.2434, .2826, .8064 ],
            ForwardMatrix1: [ .7905, .0901, .0836, .3914, .6923, -.0836, .1061, -.3142, 1.0333 ],
            ForwardMatrix2: [ .8031, .1701, -.0089, .4054, .785, -.1905, .0695, -.1658, .9213 ],
            CameraCalibration1: [ 1, 0, 0, 0, 1, 0, 0, 0, 1 ],
            CameraCalibration2: [ 1, 0, 0, 0, 1, 0, 0, 0, 1 ],
            BlackLevelRepeatDim: [ 1, 1 ],
            CFALayout: 1,
            CFARepeatPatternDim: [ 2, 2 ],
            CFAPlaneColor: [ 0, 1, 2 ],
            CFAPattern: [ 1, 2, 0, 1 ],
            ActiveArea: [ 0, 0, 2868, 4310 ],
            DefaultCropOrigin: [ 11, 10 ],
            DefaultCropSize: [ 4288, 2848 ],
            Sensor: {
                Black: 0,
                White: 3767
            }
        },
        "SONY DSC-RX10": {
            ReadyForDecoding: false
        },
        "SONY DSC-RX100": {
            ReadyForDecoding: false
        },
        "SONY DSC-RX100M2": {
            ReadyForDecoding: false
        },
        "SONY DSC-RX100M3": {
            ReadyForDecoding: false
        },
        "SONY DSLR-A100": {
            ReadyForDecoding: false
        },
        "SONY DSLR-A200": {
            ReadyForDecoding: false
        },
        "SONY DSLR-A230": {
            ReadyForDecoding: false
        },
        "SONY DSLR-A290": {
            ReadyForDecoding: false
        },
        "SONY DSLR-A300": {
            ReadyForDecoding: false
        },
        "SONY DSLR-A330": {
            ReadyForDecoding: false
        },
        "SONY DSLR-A350": {
            ReadyForDecoding: false
        },
        "SONY DSLR-A380": {
            ReadyForDecoding: false
        },
        "SONY DSLR-A390": {
            ReadyForDecoding: false
        },
        "SONY DSLR-A450": {
            ReadyForDecoding: false
        },
        "SONY DSLR-A500": {
            ReadyForDecoding: false
        },
        "SONY DSLR-A550": {
            ReadyForDecoding: false
        },
        "SONY DSLR-A560": {
            ReadyForDecoding: false
        },
        "SONY DSLR-A580": {
            ReadyForDecoding: false
        },
        "SONY DSLR-A700": {
            ReadyForDecoding: false
        },
        "SONY DSLR-A850": {
            ReadyForDecoding: false
        },
        "SONY DSLR-A900": {
            ReadyForDecoding: false
        },
        "SONY SLT-A33": {
            ReadyForDecoding: false
        },
        "SONY SLT-A35": {
            ReadyForDecoding: false
        },
        "SONY SLT-A37": {
            ReadyForDecoding: false
        },
        "SONY SLT-A55V": {
            ReadyForDecoding: false
        },
        "SONY SLT-A57": {
            ReadyForDecoding: false
        },
        "SONY SLT-A58": {
            ReadyForDecoding: false
        },
        "SONY SLT-A65": {
            ReadyForDecoding: false
        },
        "SONY SLT-A77": {
            ReadyForDecoding: false
        },
        "SONY SLT-A99": {
            ReadyForDecoding: false
        },
        "SONY ILCA-77M2": {
            ReadyForDecoding: false
        },
        "SONY ILCE-7": {
            ReadyForDecoding: false
        },
        "SONY ILCE-7R": {
            ReadyForDecoding: false
        },
        "SONY ILCE-7S": {
            ReadyForDecoding: false
        },
        "SONY NEX-3": {
            ReadyForDecoding: false
        },
        "SONY NEX-5": {
            ReadyForDecoding: false
        },
        "SONY NEX-C3": {
            ReadyForDecoding: false
        },
        "SONY NEX-5N": {
            ReadyForDecoding: false
        },
        "SONY NEX-7": {
            ReadyForDecoding: false
        },
        "SONY NEX-F3": {
            ReadyForDecoding: false
        },
        "SONY NEX-5R": {
            ReadyForDecoding: false
        },
        "SONY NEX-6": {
            ReadyForDecoding: false
        },
        "SONY NEX-3N": {
            ReadyForDecoding: false
        },
        "SONY NEX-5T": {
            ReadyForDecoding: false
        },
        "SONY ILCE-3000": {
            ReadyForDecoding: false
        },
        "SONY ILCE-5000": {
            ReadyForDecoding: false
        },
        "SONY ILCE-6000": {
            ReadyForDecoding: false
        },
        "SONY ILCE-3500": {
            ReadyForDecoding: false
        },
        "OLYMPUS IMAGING CORP. E-30": {
            ReadyForDecoding: false
        },
        "OLYMPUS IMAGING CORP. E-330": {
            ReadyForDecoding: false
        },
        "OLYMPUS IMAGING CORP. E-400": {
            ReadyForDecoding: false
        },
        "OLYMPUS IMAGING CORP. E-410": {
            ReadyForDecoding: false
        },
        "OLYMPUS IMAGING CORP. E-420": {
            ReadyForDecoding: false
        },
        "OLYMPUS IMAGING CORP. E-450": {
            ReadyForDecoding: false
        },
        "OLYMPUS IMAGING CORP. E-5": {
            ReadyForDecoding: false
        },
        "OLYMPUS IMAGING CORP. E-500": {
            ReadyForDecoding: false
        },
        "OLYMPUS IMAGING CORP. E-510": {
            ReadyForDecoding: false
        },
        "OLYMPUS IMAGING CORP. E-520": {
            ReadyForDecoding: false
        },
        "OLYMPUS IMAGING CORP. E-620": {
            ReadyForDecoding: false
        },
        "OLYMPUS IMAGING CORP. E-P1": {
            ReadyForDecoding: false
        },
        "OLYMPUS IMAGING CORP. E-P2": {
            ReadyForDecoding: false
        },
        "OLYMPUS IMAGING CORP. E-P3": {
            ReadyForDecoding: false
        },
        "OLYMPUS IMAGING CORP. E-P5": {
            ReadyForDecoding: false
        },
        "OLYMPUS IMAGING CORP. E-PL1": {
            ReadyForDecoding: false
        },
        "OLYMPUS IMAGING CORP. E-PL2": {
            ReadyForDecoding: false
        },
        "OLYMPUS IMAGING CORP. E-PL3": {
            ReadyForDecoding: false
        },
        "OLYMPUS IMAGING CORP. E-PL5": {
            ReadyForDecoding: false
        },
        "OLYMPUS IMAGING CORP. E-PM1": {
            ReadyForDecoding: false
        },
        "OLYMPUS IMAGING CORP. E-PM2": {
            ReadyForDecoding: false
        },
        "OLYMPUS IMAGING CORP. STYLUS1": {
            ReadyForDecoding: false
        },
        "OLYMPUS IMAGING CORP. E-M1": {
            ReadyForDecoding: false
        },
        "OLYMPUS IMAGING CORP. E-M5": {
            ReadyForDecoding: false
        },
        "OLYMPUS IMAGING CORP. E-M5MarkII": {
            ReadyForDecoding: false
        },
        "OLYMPUS IMAGING CORP. E-M10": {
            ReadyForDecoding: false
        }
    };
    var r = {
        data: n,
        isReadyForThumbnailing: function(e, t) {
            var r = e + " " + t;
            var a = n[r];
            if (!a) {
                r = i[r];
                a = n[r];
            }
            return !!a;
        },
        isReadyForDecoding: function(e, t) {
            var r = e + " " + t;
            var a = n[r];
            if (!a) {
                r = i[r];
                a = n[r];
            }
            return !!(a && a.ReadyForDecoding);
        },
        getMetadata: function a(e, t) {
            var r = e + " " + t;
            var a = n[r];
            if (!a) {
                r = i[r];
                a = n[r];
            }
            if (a) {
                a.getCFAArray = function() {
                    var e = a.CFA.Pattern;
                    var t = e[0].x;
                    var i = e[0].y;
                    var n = e[0].Color;
                    var r = e[1].x;
                    var o = e[1].y;
                    var s = e[1].Color;
                    if (t === 0 && i === 0 && n === "red" && r === 1 && o === 0 && s === "green") return [ 0, 1, 2, 3 ];
                    if (t === 0 && i === 0 && n === "green" && r === 1 && o === 0 && s === "blue") return [ 2, 3, 0, 1 ];
                    if (t === 0 && i === 0 && n === "blue" && r === 1 && o === 0 && s === "green") return [ 3, 1, 2, 0 ];
                    if (t === 0 && i === 0 && n === "green" && r === 1 && o === 0 && s === "red") return [ 1, 0, 3, 2 ];
                };
                return a;
            } else {
                throw "Camera " + t + " is not supported yet! ";
            }
        }
    };
    if (typeof define === "function") {
        define("cameradata", [], function() {
            return r;
        });
    } else {
        if (typeof e.cameras === "undefined") {
            e.cameras = r;
        }
    }
})(this);

(function() {
    var e = function(e) {
        var t = {
            types: {
                CONSEQUENTIALLY: "consequentially",
                POOL: "pool"
            }
        };
        var i = [], n = false, r = 1e3, a = 0, o = e.type || t.types.CONSEQUENTIALLY, s = e.simultaneously || 1;
        var l = function(e) {
            i.push(e);
            if (o === t.types.CONSEQUENTIALLY) {
                f();
            } else if (o === t.types.POOL) {
                u();
            }
        }, c = function(e) {
            i.unshift(e);
            f();
        }, u = function() {
            if (a === s) {
                return false;
            }
            if (!i.length) {
                n = false;
                return;
            }
            n = true;
            d();
        }, f = function() {
            if (n) {
                return;
            }
            if (!i.length) {
                return;
            }
            n = true;
            d();
        }, d = function() {
            try {
                var e = i.shift();
                if (o === t.types.CONSEQUENTIALLY) {
                    setTimeout(e.task.bind(this, h.bind(this)), r);
                } else if (o === t.types.POOL) {
                    e.task(h);
                }
                a++;
            } catch (n) {
                h();
                console.warn(n);
            }
        }, h = function() {
            a--;
            if (!i.length) {
                n = false;
                return n;
            }
            d();
        }, p = function() {
            i.length = 0;
            n = false;
            a = 0;
        };
        return {
            addTask: l,
            reset: p
        };
    };
    var t = {
        getConsequentiallyTaskRunner: function() {
            return new e({
                type: "consequentially"
            });
        },
        getPoolTaskRunner: function(t) {
            return new e({
                type: "pool",
                simultaneously: t.simultaneously || 1
            });
        }
    };
    if (typeof define === "function" && define.amd) define("queue", [], function() {
        return t;
    }); else return this.ret = t;
})();

(function(e, t) {
    var i = function(Utils, e, i, n, r, a) {
        var o = a.getPoolTaskRunner({
            simultaneously: 15
        });
        var s = function() {};
        s.prototype._getJPGRawData = function(e, t, i, n) {
            var r = new Image();
            Utils.getOriginImageUrl(e.thumbnail.original).execute(function(e) {
                var t = this;
                r.crossOrigin = "Anonymous";
                r.onload = function() {
                    t.executeCaller();
                };
                r.src = e;
                return t;
            }).execute(function() {
                var i = document.createElement("canvas");
                i.width = r.width;
                i.height = r.height;
                var n = i.getContext("2d");
                n.drawImage(r, 0, 0);
                e.thumbnail.original.raw = r;
                var a = n.getImageData(0, 0, r.width, r.height);
                var o = a.data;
                t(e, o, a);
            });
        };
        s.prototype._getCR2RawData = function(e, t, i, n) {
            var r = this.getRawIFD(e);
            var a = r.StripOffsets;
            var o = r.StripByteCounts;
            var s = function(e, i, n) {
                t(e, i, n);
            };
            e.storage._getFilePart(e, a, a + o, s);
        };
        s.prototype._getNEFRawData = function(e, t, i, n) {
            var r = this.getRawIFD(e);
            var a = r.StripOffsets;
            var o = r.StripByteCounts;
            var s = function(e, i, n) {
                t(e, i, n);
            };
            e.storage._getFilePart(e, a, a + o, s);
        };
        s.prototype._getDNGRawData = function(e, t, i, r) {
            var a = this.getRawIFD(e);
            var o = function(e, t, i) {
                r(e, t, i);
            };
            var s = function(e, i, n) {
                TrackingService.push("Storage", "RawLoaded");
                t(e, i, n);
            };
            console.time("gd: Download raw data");
            var l = 0;
            var c = 0;
            var u = 0;
            var f = 0;
            var d = [];
            u = a["TileOffsets"][0];
            this._prepareTilesPosition(e);
            for (var h = 0; h < a.TileOffsets.length; h++) {
                if (c > n.config.gdrive.DOWNLOAD_RAW_CHUNK_SIZE) {
                    f = u + c;
                    e.storage._getFilePart(e, u, a.TileOffsets[h], function(e, t, i) {
                        if (o) o(e, t, i);
                    }, {
                        lastByte: a.TileOffsets[h],
                        tiles: d
                    });
                    d = [];
                    c = 0;
                    u = a.TileOffsets[h];
                }
                if (h > 0 && a.TileOffsets[h - 1] + a.TileByteCounts[h - 1] + 1 < a.TileOffsets[h]) {
                    alert("There's a gap! Cannot complete download!");
                    return;
                }
                c = c + a.TileByteCounts[h];
                d.push(h);
            }
            f = u + c;
            e.storage._getFilePart(e, u, f, o, {
                lastByte: a.TileOffsets[h],
                tiles: d
            });
        };
        s.prototype._prepareTilesPosition = function(e) {
            var t = this.getRawIFD(e);
            var i = 1;
            var n = 0;
            var r = 0;
            var a = Math.ceil(t.ImageWidth / t.TileWidth);
            e.tilePositions = [];
            for (var o = 0; o < t["TileOffsets"].length; o++) {
                if (i > a) {
                    i = 1;
                    n = 0;
                    r = r + t.TileLength;
                }
                e.tilePositions[o] = [ r, n ];
                n = n + t.TileWidth;
                i++;
            }
        };
        s.prototype.getMetadata = function(e) {
            var t = e.object;
            var i = e.success || noop;
            var r = e.failure || noop;
            var a = e.mode;
            var o = this;
            if (!t.url) {
                r({
                    errors: {
                        type: 401,
                        mes: "No access. No url."
                    }
                });
                return;
            }
            var s = function(e) {
                o.updatePhotoMetadata(e, null, null);
                i(e);
            };
            var l = function(e, t, i, r) {
                e.storage._getFilePart(e, 0, n.config.gdrive.HEADER_SIZE, function(e, t) {
                    e.storage.constructFullUrl(e);
                    e.originaldata = null;
                    e.decompressedData = null;
                    e.storage = null;
                    o.getMetadataForArrayBufferInThreads(e, t, s, i, r);
                }, false, i);
            };
            if (this.isJPG(t)) {
                i(t);
            } else {
                var c = t.thumbnail;
                if (c && c.original && c.original.raw) {
                    c.original.raw = null;
                }
                l(t, i, r, a);
            }
        }, s.prototype.getRawData = function(t, i, n, r) {
            if (this.isDNG(t)) {
                this._getDNGRawData(t, i, n, r);
            } else if (this.isCR2(t)) {
                this._getCR2RawData(t, i, n, r);
            } else if (this.isNEF(t)) {
                this._getNEFRawData(t, i, n, r);
            } else if (this.isJPG(t)) {
                this._getJPGRawData(t, i, n, r);
                e.warn("SHOULDNT be HERE! PLEASE REMOVE JPG FROM METADATA SERVICE AND GET IT DIRECTLY FROM IMAGEDESCRIPTOR");
            } else {
                e.warn("Format decoding is not supported by clientside decoder");
                n && n("Format decoding is not supported by clientside decoder");
            }
        }, s.prototype.updatePhotoMetadata = function(e, t, i) {
            console.warn("deprecated. Please use the method inside model");
            if (!e || !e.metadata) {
                i && i({
                    error: "Metadata not saved!"
                });
                return;
            }
            var r = n.config.API_BASE_URL + "/images/metadata/" + e.id + "/" + e.metadata.type;
            var a = e.metadata;
            var o = function() {
                console.log("Error");
                i && i({
                    error: "Metadata not saved!"
                });
            };
            var s = function(e) {
                if (!e.errors) {
                    if (t) t(e.responseText);
                } else {
                    if (i) i({
                        error: "Metadata not saved!"
                    });
                }
            };
            $.ajax({
                method: "POST",
                url: r,
                async: true,
                cache: false,
                crossDomain: true,
                data: JSON.stringify(a),
                contentType: "application/json",
                success: s,
                error: o
            });
        }, s.prototype.isMetadataContainsMetadata = function(e, t) {
            if (!t || !e) return false;
            if (e === t) return true;
            if (e === "raw" && t === "thumbnail") return true;
            if (e === "full" && t === "thumbnail") return true;
            if (e === "full" && t === "raw") return true;
            return false;
        }, s.prototype.getPhotoMetadata = function(e, t, i) {
            if (n.config.ENV === "development") {
                return i({
                    error: "Metadata not found!"
                });
            }
            var r = n.config.API_BASE_URL + "/images/metadata/" + e.id + "/full/orsmaller";
            var a = function() {
                if (i) i({
                    error: "Metadata not found!"
                });
            };
            var o = function(e) {
                if (!e.errors) {
                    if (t) t(e.responseText);
                } else {
                    if (i) i({
                        error: "Metadata not found!"
                    });
                }
            };
            $.ajax({
                method: "GET",
                url: r,
                async: true,
                cache: false,
                crossDomain: true,
                contentType: "application/json",
                success: o,
                error: a
            });
        }, s.prototype.getMetadataForArrayBufferInThreads = function(e, t, i, r, a) {
            var s = this;
            var l = new Parallel({
                mode: a,
                descriptor: e,
                arrayBuffer: t
            });
            l.require(n.config.BASE_URL + "/assets/js/shared/utils.js?v=0.14.0");
            l.require(n.config.BASE_URL + "/assets/js/decoders/IFDParser.js?v=0.14.0");
            l.require(n.config.BASE_URL + "/assets/js/decoders/CR2IFDParser.js?v=0.14.0");
            l.require(n.config.BASE_URL + "/assets/js/decoders/NEFIFDParser.js?v=0.14.0");
            l.require(n.config.BASE_URL + "/assets/js/decoders/ARWIFDParser.js?v=0.14.0");
            l.require(n.config.BASE_URL + "/assets/js/decoders/ORFIFDParser.js?v=0.14.0");
            var c = function(t) {
                if (i) {
                    e.metadata = t.descriptor.metadata;
                    i(e);
                }
            };
            var u = function(e, t) {
                c(t);
                e();
            };
            o.addTask({
                task: function(e) {
                    l.spawn(s.getMetadataForDescriptor).then(u.bind(this, e), r.bind(this, {
                        error: {
                            type: "500"
                        }
                    }));
                }
            });
        }, s.prototype.getMetadataForDescriptor = function(e) {
            var t = e.descriptor, n = e.mode, r = e.arrayBuffer;
            var a = {
                data: null,
                dataSize: t.fileSize,
                dataUrl: e.descriptor.fullUrl,
                skipInlineValues: false,
                includeFields: [],
                excludeFields: [],
                processSubIFD: true,
                fileHeaderSize: 12,
                firstPayloadSize: 1e5
            };
            if (n == "thumbnail") {
                a.skipInlineValues = false;
                a.includeFields = [ 254, 255, 256, 257, 259, 271, 272, 273, 274, 278, 279, 34665, 513, 514, 50648, 50752, 33422 ];
                a.processSubIFD = true;
            } else if (n == "raw") {
                a.skipInlineValues = false;
                a.excludeFields = [ 50736, 532, 529, 315, 50931, 50735, 50706, 50707, 50740, 306, 50709, 50827, 50828, 50940, 50966, 50967, 50971, 50972, 50969, 50932, 50942, 50936, 305, 700 ];
                a.processSubIFD = true;
            } else if (n == "full") {
                a.skipInlineValues = false;
                a.processSubIFD = true;
            } else {
                a.skipInlineValues = false;
                a.includeFields = [];
                a.processSubIFD = true;
            }
            var o = function(e) {
                var t;
                if (e === "image/x-canon-cr2") t = new (typeof CR2IFDParser !== "undefined" ? CR2IFDParser : i.CR2IFDParser)(); else if (e === "image/x-nikon-nef") t = new (typeof NEFIFDParser !== "undefined" ? NEFIFDParser : i.NEFIFDParser)(); else if (e === "image/x-sony-arw") t = new (typeof ARWIFDParser !== "undefined" ? ARWIFDParser : i.ARWIFDParser)(); else if (e === "image/x-olympus-orf") t = new (typeof ORFIFDParser !== "undefined" ? ORFIFDParser : i.ORFIFDParser)(); else t = new (typeof IFDParser !== "undefined" ? IFDParser : i.IFDParser)();
                return t;
            };
            var s = o(t.mimeType);
            t.metadata = s.init(a).parse();
            t.metadata.type = n;
            return {
                type: "finished",
                descriptor: t
            };
        };
        s.prototype.getMetadataForFile = function(e, t, r, a) {
            var o = e.mimeType;
            var s = this;
            if (n.config.formats.SUPPORTED_RAW_FORMATS.indexOf(o) == -1) {
                t && t(e);
                return;
            }
            var l = e.file;
            var c = new FileReader();
            c.onload = function(n) {
                console.time("Parse file metadata");
                var o = new DataView(n.target.result);
                var s = function(e) {
                    var t;
                    if (e === "image/x-canon-cr2") t = new (typeof CR2IFDParser !== "undefined" ? CR2IFDParser : i.CR2IFDParser)(); else if (e === "image/x-nikon-nef") t = new (typeof NEFIFDParser !== "undefined" ? NEFIFDParser : i.NEFIFDParser)(); else if (e === "image/x-sony-arw") t = new (typeof ARWIFDParser !== "undefined" ? ARWIFDParser : i.ARWIFDParser)(); else if (e === "image/x-olympus-orf") t = new (typeof ORFIFDParser !== "undefined" ? ORFIFDParser : i.ORFIFDParser)(); else t = new (typeof IFDParser !== "undefined" ? IFDParser : i.IFDParser)();
                    return t;
                };
                try {
                    var l = s(e.mimeType);
                    console.log("WARNING! Here happened cleaning of old metadata! Should be more smart merge!");
                    e.metadata = l.init({
                        data: o
                    }).parseFile(a);
                } catch (n) {
                    var c = new Error(n);
                    c.code = "unsupported_camera";
                    console.log(c);
                    return r && r(c);
                }
                t && t(e);
                console.timeEnd("Parse file metadata");
            };
            c.readAsArrayBuffer(l);
        };
        s.prototype.isNEF = function(e) {
            console.assert(!e.get, "WARNING: Model passed to static method.");
            if (e.get) e = e.toJSON();
            if (!e.mimeType) throw "WARNING: Object doesn't contain mimeType. Image is broken.";
            return e.mimeType === "image/x-nikon-nef";
        };
        s.prototype.isARW = function(e) {
            console.assert(!e.get, "WARNING: Model passed to static method.");
            if (e.get) e = e.toJSON();
            if (!e.mimeType) throw "WARNING: Object doesn't contain mimeType. Image is broken.";
            return e.mimeType === "image/x-sony-arw";
        };
        s.prototype.isDNG = function(e) {
            console.assert(!e.get, "WARNING: Model passed to static method.");
            if (e.get) e = e.toJSON();
            if (!e.mimeType) throw "WARNING: Object doesn't contain mimeType. Image is broken.";
            return e.mimeType === "image/x-adobe-dng";
        };
        s.prototype.isCR2 = function(e) {
            console.assert(!e.get, "WARNING: Model passed to static method.");
            if (e.get) e = e.toJSON();
            if (!e.mimeType) throw "WARNING: Object doesn't contain mimeType. Image is broken.";
            return e.mimeType === "image/x-canon-cr2";
        };
        s.prototype.isJPG = function(e) {
            if (e.get) {
                console.log("WARNING: Model passed to static method.");
                e = e.toJSON();
            }
            if (!e.mimeType) throw "WARNING: Object doesn't contain mimeType. Image is broken.";
            var t = n.config.formats.SUPPORTED_FORMATS.subtract(n.config.formats.SUPPORTED_RAW_FORMATS);
            return t.indexOf(e.mimeType) > -1;
        };
        s.prototype.getRootIFD = function(i) {
            console.warn("WARN: This method is deprecated! Only for backward compatibility. If you see this message please, goto your caller function and replace getRootIfd(descriptor); call to descriptor.metadata.root;");
            if (i.get) i = i.toJSON();
            if (i && i.metadata && i.metadata.root) {
                return i.metadata.root;
            }
            e.log("Cannot find root descriptor");
            return t;
        };
        s.prototype.getMakerModel = function(e) {
            console.assert(!e.get, "WARNING: Model passed to static method.");
            if (e.get) e = e.toJSON();
            var t, i;
            try {
                t = e.metadata.root.Make.trim();
                i = e.metadata.root.Model.trim();
            } catch (n) {
                console.error("Unknown camera for file", e.name);
            }
            return {
                Make: t,
                Model: i
            };
        };
        s.prototype.getExifIFD = function(i) {
            console.warn("WARN: This method is deprecated! Only for backward compatibility. If you see this message please, goto your caller function and replace getExifIfd(descriptor); call to descriptor.metadata.exif;");
            if (i.get) i = i.toJSON();
            if (i && i.metadata && i.metadata.exif) {
                return i.metadata.exif;
            }
            e.log("Cannot find exif descriptor");
            return t;
        };
        s.prototype.getRawIFD = function(i) {
            console.warn("WARN: This method is deprecated! Only for backward compatibility. If you see this message please, goto your caller function and replace getRawIfd(descriptor); call to descriptor.metadata.raw;");
            if (i.get) i = i.toJSON();
            if (i && i.metadata && i.metadata.raw) {
                return i.metadata.raw;
            }
            e.log("Cannot find raw descriptor");
            return t;
        };
        s.prototype.isRawUncompressed = function(e) {
            console.assert(!e.get, "WARNING: Model passed to static method.");
            var t = this.getRawIFD(e);
            if (this.isNEF(e) && t.Compression == 1) return true;
            return t["NewSubfileType"] == 0 && t["Compression"] == 1;
        };
        s.prototype.isNikon = function(e) {
            return e === "NIKON CORPORATION";
        };
        s.prototype.isCanon = function(e) {
            return e === "Canon";
        };
        s.prototype.readyForWhat = function(e) {
            console.assert(!e.get, "WARNING: Model passed to static method.");
            if (this.isJPG(e)) {
                return {
                    thumbnailing: false,
                    decoding: false
                };
            }
            var t = this.getMakerModel(e);
            console.assert(t && t.Make && t.Model, "Can't detect camera Maker and Model!");
            if (!t || !t.Make || !t.Model) throw "Can't detect camera Maker and Model!";
            if (e.mimeType === "image/x-adobe-dng") return {
                thumbnailing: true,
                decoding: true
            };
            var i = {};
            i.thumbnailing = true;
            i.decoding = r.isReadyForDecoding(t.Make, t.Model);
            return i;
        };
        s.prototype.fillIFDWithCachedMetadata = function(e, t, i, n, r) {
            if (this.isNikon(e)) {
                return this._fillIFDWithCachedMetadataNEF(e, t, i, n, r);
            } else if (this.isCanon(e)) {
                return this._fillIFDWithCachedMetadataCR2(e, t, i, n, r);
            }
        };
        s.prototype._fillIFDWithCachedMetadataNEF = function(i, n, a, o, s) {
            var l = r.getMetadata(i, n);
            var c = l.getCFAArray();
            var u = a.ExifIFD.Makernote.WB_RBLevels;
            if (!u) {
                u = [ 1, 1, 1 ];
                e.warn("No WB_RBLevels parsed for " + n + ". Default settings used.");
            }
            a["AsShotNeutral"] = [ 1 / u[0], 1 / u[2], 1 / u[1] ] || l.AsShotNeutral || [ .479401, 1, .726757 ];
            a["ColorMatrix1"] = l.ColorMatrix1;
            a["ColorMatrix2"] = l.ColorMatrix2;
            a["ForwardMatrix1"] = l.ForwardMatrix1;
            a["ForwardMatrix2"] = l.ForwardMatrix2;
            a["CameraCalibration1"] = l.CameraCalibration1;
            a["CameraCalibration2"] = l.CameraCalibration2;
            a["CalibrationIlluminant1"] = 17;
            a["CalibrationIlluminant2"] = 21;
            o["BlackLevelRepeatDim"] = l.BlackLevelRepeatDim;
            o["CFALayout"] = l.CFALayout;
            o["CFARepeatPatternDim"] = l.CFARepeatPatternDim;
            o["CFAPlaneColor"] = l.CFAPlaneColor;
            o["CFAPattern"] = l.CFAPattern;
            o["ActiveArea"] = l.ActiveArea;
            o["DefaultCropOrigin"] = l.DefaultCropOrigin;
            o["DefaultCropSize"] = l.DefaultCropSize;
            o["MaskedAreas"] = l.MaskedAreas;
            o["WhiteLevel"] = l.Sensor.White;
            o["BlackLevel"] = l.Sensor.Black;
            a["BaselineExposure"] = l.BaselineExposure || 0;
            o["BlackLevelDeltaV"] = t;
            o["fBlack1DBuffer"] = t;
            o["fBlack2DCols"] = t;
            o["LinearizationTable"] = t;
            if (!o["BlackLevelDeltaV"]) {
                o["BlackLevelDeltaV"] = new Uint16Array(o["ImageLength"]);
                for (var f = o["ImageLength"] - 1; f >= 0; f--) {
                    o["BlackLevelDeltaV"][f] = o["BlackLevel"];
                }
            }
        };
        s.prototype._fillIFDWithCachedMetadataCR2 = function(e, t, i, n, a) {
            var o = r.getMetadata(e, t);
            var s = o.getCFAArray();
            i["AsShotNeutral"] = o.AsShotNeutral || [ .479401, 1, .726757 ];
            i["ColorMatrix1"] = o.ColorMatrix1;
            i["ColorMatrix2"] = o.ColorMatrix2;
            i["ForwardMatrix1"] = o.ForwardMatrix1;
            i["ForwardMatrix2"] = o.ForwardMatrix2;
            i["CameraCalibration1"] = o.CameraCalibration1;
            i["CameraCalibration2"] = o.CameraCalibration2;
            i["CalibrationIlluminant1"] = 17;
            i["CalibrationIlluminant2"] = 21;
            n["BlackLevelRepeatDim"] = o.BlackLevelRepeatDim;
            n["CFALayout"] = o.CFALayout;
            n["CFARepeatPatternDim"] = o.CFARepeatPatternDim;
            n["CFAPlaneColor"] = o.CFAPlaneColor;
            n["CFAPattern"] = o.CFAPattern;
            n["ActiveArea"] = o.ActiveArea;
            n["DefaultCropOrigin"] = o.DefaultCropOrigin;
            n["DefaultCropSize"] = o.DefaultCropSize;
            n["MaskedAreas"] = o.MaskedAreas;
            n["ImageWidth"] = o.Sensor.Width || o.ActiveArea[3];
            n["ImageLength"] = o.Sensor.Height || o.ActiveArea[2];
            n["WhiteLevel"] = o.Sensor.White;
            n["BlackLevel"] = o.Sensor.Black;
            i["BaselineExposure"] = o.BaselineExposure || 0;
            n["BlackLevelDeltaV"] = new Uint16Array(n["ImageLength"]);
            for (var l = n["ImageLength"] - 1; l >= 0; l--) {
                n["BlackLevelDeltaV"][l] = n["BlackLevel"];
            }
        };
        return new s();
    };
    if (typeof define === "function") {
        define("MetadataService", [ "utils", "LoggingService", "IFDParsers", "environment", "cameradata", "queue" ], function() {
            return i.apply(this, arguments);
        });
    } else {
        if (typeof e.MetadataService === "undefined") {
            e.MetadataService = i(e.Utils, e.LoggingService, e.IFDParsers, e.PicsIO, e.cameras);
        }
    }
})(this);

(function(e, t) {
    var i = e.document, n;
    n = function(Utils) {
        return {
            get: function(e, t) {
                if (Utils.isChromeApplication()) {
                    this.getChrome(e, t);
                } else {
                    var i = $.cookie(e);
                    t && t(i);
                    return i;
                }
            },
            set: function(e, t, i, n) {
                if (Utils.isChromeApplication()) {
                    this.setChrome(e, t);
                } else {
                    var r = $.cookie(e, t, {
                        expires: n
                    });
                    i && i(r);
                }
            },
            inc: function(e, t) {
                if (Utils.isChromeApplication()) {
                    this.getChrome(e, function(i) {
                        var n = ~~i + 1;
                        this.setChrome(e, n);
                        t && t(n);
                    });
                } else {
                    var i = ~~$.cookie(e);
                    $.cookie(e, ++i);
                    t && t(i);
                }
            },
            remove: function(e, t) {
                if (Utils.isChromeApplication()) {
                    this.removeChrome(e, t || function() {});
                } else {
                    $.removeCookie(e);
                    t && t();
                }
            },
            removeLocal: function(e, t) {
                if (Utils.isChromeApplication()) {
                    this.removeChrome(e, t);
                } else {
                    localStorage.removeItem(e);
                    t && t();
                }
            },
            getLocal: function(e, t) {
                if (Utils.isChromeApplication()) {
                    this.getChrome(e, t);
                } else {
                    var i = JSON.parse(localStorage.getItem(e));
                    t && t(i);
                }
            },
            setLocal: function(e, t) {
                if (Utils.isChromeApplication()) {
                    this.setChrome(e, t);
                } else {
                    localStorage.setItem(e, JSON.stringify(t));
                }
            },
            getChrome: function(e, t) {
                chrome.storage.local.get(e, function(i) {
                    t && t(i[e]);
                });
            },
            removeChrome: function(e, t) {
                chrome.storage.local.remove(e, function(e) {
                    t && t(e);
                });
            },
            setChrome: function(e, t) {
                var i = {};
                i[e] = t;
                chrome.storage.local.set(i);
            }
        };
    };
    if (typeof define === "function") {
        define("StorageService", [ "utils" ], function(Utils) {
            return new n(Utils);
        });
    } else {
        if (typeof e.StorageService === "undefined") {
            e.StorageService = new n(e.Utils);
        }
    }
})(this);

(function(e, t) {
    e._gaq = e._gaq || [];
    e._gaq.push([ "_setAccount", "UA-25877411-2" ]);
    e._gaq.push([ "_setDomainName", window.location.host ]);
    e._gaq.push([ "_trackPageview" ]);
    (function() {
        var e = document.createElement("script");
        e.type = "text/javascript";
        e.async = true;
        e.src = ("https:" == document.location.protocol ? "https://" : "http://") + "stats.g.doubleclick.net/dc.js";
        var t = document.getElementsByTagName("script")[0];
        t.parentNode.insertBefore(e, t);
    })();
    var i = function() {
        this.usePicsioBackendTracker = true;
        var e = function(e) {
            this.category = e;
        };
        var i = function(e, i, n, r, a) {
            e = this.category || e;
            n += "";
            a = a === true;
            if (typeof e === "function") {
                if (e) _gaq.push(e);
                return;
            }
            var o = typeof r === "number" ? r : t;
            _gaq.push([ "_trackEvent", e, i, n, o, a ]);
            if (this.usePicsioBackendTracker) {
                var s = n || {};
                $.post("/events", {
                    event: {
                        type: e + ":" + i,
                        value: s
                    }
                }, noop, "application/json");
            }
        };
        var n = function() {
            window.addEventListener("error", function(e) {
                var t = e.colno ? " line:" + e.lineno + ", column:" + e.colno : " line:" + e.lineno;
                i.call(this, "FrontendError", e.message, e.filename + t + " -> " + navigator.userAgent);
            });
        };
        n();
        return {
            push: i,
            setCategory: e,
            trackableErrors: [ "UnsupportedFormat" ]
        };
    };
    if (typeof define === "function") {
        define("TrackingService", [], function() {
            return new i();
        });
    } else {
        if (typeof e.TrackingService === "undefined") {
            e.TrackingService = new i();
        }
    }
})(this);

(function(e, t) {
    if (typeof define === "function" && define.amd) {
        define("backbone", [ "underscore", "jquery", "exports" ], function(i, n, r) {
            e.Backbone = t(e, r, i, n);
        });
    } else if (typeof exports !== "undefined") {
        var i = require("underscore");
        t(e, exports, i);
    } else {
        e.Backbone = t(e, {}, e._, e.jQuery || e.Zepto || e.ender || e.$);
    }
})(this, function(e, t, i, n) {
    var r = e.Backbone;
    var a = [];
    var o = a.push;
    var s = a.slice;
    var l = a.splice;
    t.VERSION = "1.1.1";
    t.$ = n;
    t.noConflict = function() {
        e.Backbone = r;
        return this;
    };
    t.emulateHTTP = false;
    t.emulateJSON = false;
    var c = t.Events = {
        on: function(e, t, i) {
            if (!f(this, "on", e, [ t, i ]) || !t) return this;
            this._events || (this._events = {});
            var n = this._events[e] || (this._events[e] = []);
            n.push({
                callback: t,
                context: i,
                ctx: i || this
            });
            return this;
        },
        once: function(e, t, n) {
            if (!f(this, "once", e, [ t, n ]) || !t) return this;
            var r = this;
            var a = i.once(function() {
                r.off(e, a);
                t.apply(this, arguments);
            });
            a._callback = t;
            return this.on(e, a, n);
        },
        off: function(e, t, n) {
            var r, a, o, s, l, c, u, d;
            if (!this._events || !f(this, "off", e, [ t, n ])) return this;
            if (!e && !t && !n) {
                this._events = void 0;
                return this;
            }
            s = e ? [ e ] : i.keys(this._events);
            for (l = 0, c = s.length; l < c; l++) {
                e = s[l];
                if (o = this._events[e]) {
                    this._events[e] = r = [];
                    if (t || n) {
                        for (u = 0, d = o.length; u < d; u++) {
                            a = o[u];
                            if (t && t !== a.callback && t !== a.callback._callback || n && n !== a.context) {
                                r.push(a);
                            }
                        }
                    }
                    if (!r.length) delete this._events[e];
                }
            }
            return this;
        },
        trigger: function(e) {
            if (!this._events) return this;
            var t = s.call(arguments, 1);
            if (!f(this, "trigger", e, t)) return this;
            var i = this._events[e];
            var n = this._events.all;
            if (i) d(i, t);
            if (n) d(n, arguments);
            return this;
        },
        stopListening: function(e, t, n) {
            var r = this._listeningTo;
            if (!r) return this;
            var a = !t && !n;
            if (!n && typeof t === "object") n = this;
            if (e) (r = {})[e._listenId] = e;
            for (var o in r) {
                e = r[o];
                e.off(t, n, this);
                if (a || i.isEmpty(e._events)) delete this._listeningTo[o];
            }
            return this;
        }
    };
    var u = /\s+/;
    var f = function(e, t, i, n) {
        if (!i) return true;
        if (typeof i === "object") {
            for (var r in i) {
                e[t].apply(e, [ r, i[r] ].concat(n));
            }
            return false;
        }
        if (u.test(i)) {
            var a = i.split(u);
            for (var o = 0, s = a.length; o < s; o++) {
                e[t].apply(e, [ a[o] ].concat(n));
            }
            return false;
        }
        return true;
    };
    var d = function(e, t) {
        var i, n = -1, r = e.length, a = t[0], o = t[1], s = t[2];
        switch (t.length) {
          case 0:
            while (++n < r) (i = e[n]).callback.call(i.ctx);
            return;

          case 1:
            while (++n < r) (i = e[n]).callback.call(i.ctx, a);
            return;

          case 2:
            while (++n < r) (i = e[n]).callback.call(i.ctx, a, o);
            return;

          case 3:
            while (++n < r) (i = e[n]).callback.call(i.ctx, a, o, s);
            return;

          default:
            while (++n < r) (i = e[n]).callback.apply(i.ctx, t);
            return;
        }
    };
    var h = {
        listenTo: "on",
        listenToOnce: "once"
    };
    i.each(h, function(e, t) {
        c[t] = function(t, n, r) {
            var a = this._listeningTo || (this._listeningTo = {});
            var o = t._listenId || (t._listenId = i.uniqueId("l"));
            a[o] = t;
            if (!r && typeof n === "object") r = this;
            t[e](n, r, this);
            return this;
        };
    });
    c.bind = c.on;
    c.unbind = c.off;
    i.extend(t, c);
    var p = t.Model = function(e, t) {
        var n = e || {};
        t || (t = {});
        this.cid = i.uniqueId("c");
        this.attributes = {};
        if (t.collection) this.collection = t.collection;
        if (t.parse) n = this.parse(n, t) || {};
        n = i.defaults({}, n, i.result(this, "defaults"));
        this.set(n, t);
        this.changed = {};
        this.initialize.apply(this, arguments);
    };
    i.extend(p.prototype, c, {
        changed: null,
        validationError: null,
        idAttribute: "id",
        initialize: function() {},
        toJSON: function(e) {
            return i.clone(this.attributes);
        },
        sync: function() {
            return t.sync.apply(this, arguments);
        },
        get: function(e) {
            return this.attributes[e];
        },
        escape: function(e) {
            return i.escape(this.get(e));
        },
        has: function(e) {
            return this.get(e) != null;
        },
        set: function(e, t, n) {
            var r, a, o, s, l, c, u, f;
            if (e == null) return this;
            if (typeof e === "object") {
                a = e;
                n = t;
            } else {
                (a = {})[e] = t;
            }
            n || (n = {});
            if (!this._validate(a, n)) return false;
            o = n.unset;
            l = n.silent;
            s = [];
            c = this._changing;
            this._changing = true;
            if (!c) {
                this._previousAttributes = i.clone(this.attributes);
                this.changed = {};
            }
            f = this.attributes, u = this._previousAttributes;
            if (this.idAttribute in a) this.id = a[this.idAttribute];
            for (r in a) {
                t = a[r];
                if (!i.isEqual(f[r], t)) s.push(r);
                if (!i.isEqual(u[r], t)) {
                    this.changed[r] = t;
                } else {
                    delete this.changed[r];
                }
                o ? delete f[r] : f[r] = t;
            }
            if (!l) {
                if (s.length) this._pending = n;
                for (var d = 0, h = s.length; d < h; d++) {
                    this.trigger("change:" + s[d], this, f[s[d]], n);
                }
            }
            if (c) return this;
            if (!l) {
                while (this._pending) {
                    n = this._pending;
                    this._pending = false;
                    this.trigger("change", this, n);
                }
            }
            this._pending = false;
            this._changing = false;
            return this;
        },
        unset: function(e, t) {
            return this.set(e, void 0, i.extend({}, t, {
                unset: true
            }));
        },
        clear: function(e) {
            var t = {};
            for (var n in this.attributes) t[n] = void 0;
            return this.set(t, i.extend({}, e, {
                unset: true
            }));
        },
        hasChanged: function(e) {
            if (e == null) return !i.isEmpty(this.changed);
            return i.has(this.changed, e);
        },
        changedAttributes: function(e) {
            if (!e) return this.hasChanged() ? i.clone(this.changed) : false;
            var t, n = false;
            var r = this._changing ? this._previousAttributes : this.attributes;
            for (var a in e) {
                if (i.isEqual(r[a], t = e[a])) continue;
                (n || (n = {}))[a] = t;
            }
            return n;
        },
        previous: function(e) {
            if (e == null || !this._previousAttributes) return null;
            return this._previousAttributes[e];
        },
        previousAttributes: function() {
            return i.clone(this._previousAttributes);
        },
        fetch: function(e) {
            e = e ? i.clone(e) : {};
            if (e.parse === void 0) e.parse = true;
            var t = this;
            var n = e.success;
            e.success = function(i) {
                if (!t.set(t.parse(i, e), e)) return false;
                if (n) n(t, i, e);
                t.trigger("sync", t, i, e);
            };
            j(this, e);
            return this.sync("read", this, e);
        },
        save: function(e, t, n) {
            var r, a, o, s = this.attributes;
            if (e == null || typeof e === "object") {
                r = e;
                n = t;
            } else {
                (r = {})[e] = t;
            }
            n = i.extend({
                validate: true
            }, n);
            if (r && !n.wait) {
                if (!this.set(r, n)) return false;
            } else {
                if (!this._validate(r, n)) return false;
            }
            if (r && n.wait) {
                this.attributes = i.extend({}, s, r);
            }
            if (n.parse === void 0) n.parse = true;
            var l = this;
            var c = n.success;
            n.success = function(e) {
                l.attributes = s;
                var t = l.parse(e, n);
                if (n.wait) t = i.extend(r || {}, t);
                if (i.isObject(t) && !l.set(t, n)) {
                    return false;
                }
                if (c) c(l, e, n);
                l.trigger("sync", l, e, n);
            };
            j(this, n);
            a = this.isNew() ? "create" : n.patch ? "patch" : "update";
            if (a === "patch") n.attrs = r;
            o = this.sync(a, this, n);
            if (r && n.wait) this.attributes = s;
            return o;
        },
        destroy: function(e) {
            e = e ? i.clone(e) : {};
            var t = this;
            var n = e.success;
            var r = function() {
                t.trigger("destroy", t, t.collection, e);
            };
            e.success = function(i) {
                if (e.wait || t.isNew()) r();
                if (n) n(t, i, e);
                if (!t.isNew()) t.trigger("sync", t, i, e);
            };
            if (this.isNew()) {
                e.success();
                return false;
            }
            j(this, e);
            var a = this.sync("delete", this, e);
            if (!e.wait) r();
            return a;
        },
        url: function() {
            var e = i.result(this, "urlRoot") || i.result(this.collection, "url") || B();
            if (this.isNew()) return e;
            return e.replace(/([^\/])$/, "$1/") + encodeURIComponent(this.id);
        },
        parse: function(e, t) {
            return e;
        },
        clone: function() {
            return new this.constructor(this.attributes);
        },
        isNew: function() {
            return !this.has(this.idAttribute);
        },
        isValid: function(e) {
            return this._validate({}, i.extend(e || {}, {
                validate: true
            }));
        },
        _validate: function(e, t) {
            if (!t.validate || !this.validate) return true;
            e = i.extend({}, this.attributes, e);
            var n = this.validationError = this.validate(e, t) || null;
            if (!n) return true;
            this.trigger("invalid", this, n, i.extend(t, {
                validationError: n
            }));
            return false;
        }
    });
    var g = [ "keys", "values", "pairs", "invert", "pick", "omit" ];
    i.each(g, function(e) {
        p.prototype[e] = function() {
            var t = s.call(arguments);
            t.unshift(this.attributes);
            return i[e].apply(i, t);
        };
    });
    var m = t.Collection = function(e, t) {
        t || (t = {});
        if (t.model) this.model = t.model;
        if (t.comparator !== void 0) this.comparator = t.comparator;
        this._reset();
        this.initialize.apply(this, arguments);
        if (e) this.reset(e, i.extend({
            silent: true
        }, t));
    };
    var v = {
        add: true,
        remove: true,
        merge: true
    };
    var y = {
        add: true,
        remove: false
    };
    i.extend(m.prototype, c, {
        model: p,
        initialize: function() {},
        toJSON: function(e) {
            return this.map(function(t) {
                return t.toJSON(e);
            });
        },
        sync: function() {
            return t.sync.apply(this, arguments);
        },
        add: function(e, t) {
            return this.set(e, i.extend({
                merge: false
            }, t, y));
        },
        remove: function(e, t) {
            var n = !i.isArray(e);
            e = n ? [ e ] : i.clone(e);
            t || (t = {});
            var r, a, o, s;
            for (r = 0, a = e.length; r < a; r++) {
                s = e[r] = this.get(e[r]);
                if (!s) continue;
                delete this._byId[s.id];
                delete this._byId[s.cid];
                o = this.indexOf(s);
                this.models.splice(o, 1);
                this.length--;
                if (!t.silent) {
                    t.index = o;
                    s.trigger("remove", s, this, t);
                }
                this._removeReference(s, t);
            }
            return n ? e[0] : e;
        },
        set: function(e, t) {
            t = i.defaults({}, t, v);
            if (t.parse) e = this.parse(e, t);
            var n = !i.isArray(e);
            e = n ? e ? [ e ] : [] : i.clone(e);
            var r, a, o, s, l, c, u;
            var f = t.at;
            var d = this.model;
            var h = this.comparator && f == null && t.sort !== false;
            var g = i.isString(this.comparator) ? this.comparator : null;
            var m = [], y = [], b = {};
            var w = t.add, C = t.merge, x = t.remove;
            var _ = !h && w && x ? [] : false;
            for (r = 0, a = e.length; r < a; r++) {
                l = e[r] || {};
                if (l instanceof p) {
                    o = s = l;
                } else {
                    o = l[d.prototype.idAttribute || "id"];
                }
                if (c = this.get(o)) {
                    if (x) b[c.cid] = true;
                    if (C) {
                        l = l === s ? s.attributes : l;
                        if (t.parse) l = c.parse(l, t);
                        c.set(l, t);
                        if (h && !u && c.hasChanged(g)) u = true;
                    }
                    e[r] = c;
                } else if (w) {
                    s = e[r] = this._prepareModel(l, t);
                    if (!s) continue;
                    m.push(s);
                    this._addReference(s, t);
                }
                s = c || s;
                if (_ && (s.isNew() || !b[s.id])) _.push(s);
                b[s.id] = true;
            }
            if (x) {
                for (r = 0, a = this.length; r < a; ++r) {
                    if (!b[(s = this.models[r]).cid]) y.push(s);
                }
                if (y.length) this.remove(y, t);
            }
            if (m.length || _ && _.length) {
                if (h) u = true;
                this.length += m.length;
                if (f != null) {
                    for (r = 0, a = m.length; r < a; r++) {
                        this.models.splice(f + r, 0, m[r]);
                    }
                } else {
                    if (_) this.models.length = 0;
                    var S = _ || m;
                    for (r = 0, a = S.length; r < a; r++) {
                        this.models.push(S[r]);
                    }
                }
            }
            if (u) this.sort({
                silent: true
            });
            if (!t.silent) {
                for (r = 0, a = m.length; r < a; r++) {
                    (s = m[r]).trigger("add", s, this, t);
                }
                if (u || _ && _.length) this.trigger("sort", this, t);
            }
            return n ? e[0] : e;
        },
        reset: function(e, t) {
            t || (t = {});
            for (var n = 0, r = this.models.length; n < r; n++) {
                this._removeReference(this.models[n], t);
            }
            t.previousModels = this.models;
            this._reset();
            e = this.add(e, i.extend({
                silent: true
            }, t));
            if (!t.silent) this.trigger("reset", this, t);
            return e;
        },
        push: function(e, t) {
            return this.add(e, i.extend({
                at: this.length
            }, t));
        },
        pop: function(e) {
            var t = this.at(this.length - 1);
            this.remove(t, e);
            return t;
        },
        unshift: function(e, t) {
            return this.add(e, i.extend({
                at: 0
            }, t));
        },
        shift: function(e) {
            var t = this.at(0);
            this.remove(t, e);
            return t;
        },
        slice: function() {
            return s.apply(this.models, arguments);
        },
        get: function(e) {
            if (e == null) return void 0;
            return this._byId[e] || this._byId[e.id] || this._byId[e.cid];
        },
        at: function(e) {
            return this.models[e];
        },
        where: function(e, t) {
            if (i.isEmpty(e)) return t ? void 0 : [];
            return this[t ? "find" : "filter"](function(t) {
                for (var i in e) {
                    if (e[i] !== t.get(i)) return false;
                }
                return true;
            });
        },
        findWhere: function(e) {
            return this.where(e, true);
        },
        sort: function(e) {
            if (!this.comparator) throw new Error("Cannot sort a set without a comparator");
            e || (e = {});
            if (i.isString(this.comparator) || this.comparator.length === 1) {
                this.models = this.sortBy(this.comparator, this);
            } else {
                this.models.sort(i.bind(this.comparator, this));
            }
            if (!e.silent) this.trigger("sort", this, e);
            return this;
        },
        pluck: function(e) {
            return i.invoke(this.models, "get", e);
        },
        fetch: function(e) {
            e = e ? i.clone(e) : {};
            if (e.parse === void 0) e.parse = true;
            var t = e.success;
            var n = this;
            e.success = function(i) {
                var r = e.reset ? "reset" : "set";
                n[r](i, e);
                if (t) t(n, i, e);
                n.trigger("sync", n, i, e);
            };
            j(this, e);
            return this.sync("read", this, e);
        },
        create: function(e, t) {
            t = t ? i.clone(t) : {};
            if (!(e = this._prepareModel(e, t))) return false;
            if (!t.wait) this.add(e, t);
            var n = this;
            var r = t.success;
            t.success = function(e, i) {
                if (t.wait) n.add(e, t);
                if (r) r(e, i, t);
            };
            e.save(null, t);
            return e;
        },
        parse: function(e, t) {
            return e;
        },
        clone: function() {
            return new this.constructor(this.models);
        },
        _reset: function() {
            this.length = 0;
            this.models = [];
            this._byId = {};
        },
        _prepareModel: function(e, t) {
            if (e instanceof p) return e;
            t = t ? i.clone(t) : {};
            t.collection = this;
            var n = new this.model(e, t);
            if (!n.validationError) return n;
            this.trigger("invalid", this, n.validationError, t);
            return false;
        },
        _addReference: function(e, t) {
            this._byId[e.cid] = e;
            if (e.id != null) this._byId[e.id] = e;
            if (!e.collection) e.collection = this;
            e.on("all", this._onModelEvent, this);
        },
        _removeReference: function(e, t) {
            if (this === e.collection) delete e.collection;
            e.off("all", this._onModelEvent, this);
        },
        _onModelEvent: function(e, t, i, n) {
            if ((e === "add" || e === "remove") && i !== this) return;
            if (e === "destroy") this.remove(t, n);
            if (t && e === "change:" + t.idAttribute) {
                delete this._byId[t.previous(t.idAttribute)];
                if (t.id != null) this._byId[t.id] = t;
            }
            this.trigger.apply(this, arguments);
        }
    });
    var b = [ "forEach", "each", "map", "collect", "reduce", "foldl", "inject", "reduceRight", "foldr", "find", "detect", "filter", "select", "reject", "every", "all", "some", "any", "include", "contains", "invoke", "max", "min", "toArray", "size", "first", "head", "take", "initial", "rest", "tail", "drop", "last", "without", "difference", "indexOf", "shuffle", "lastIndexOf", "isEmpty", "chain", "sample" ];
    i.each(b, function(e) {
        m.prototype[e] = function() {
            var t = s.call(arguments);
            t.unshift(this.models);
            return i[e].apply(i, t);
        };
    });
    var w = [ "groupBy", "countBy", "sortBy", "indexBy" ];
    i.each(w, function(e) {
        m.prototype[e] = function(t, n) {
            var r = i.isFunction(t) ? t : function(e) {
                return e.get(t);
            };
            return i[e](this.models, r, n);
        };
    });
    var C = t.View = function(e) {
        this.cid = i.uniqueId("view");
        e || (e = {});
        i.extend(this, i.pick(e, _));
        this._ensureElement();
        this.initialize.apply(this, arguments);
        this.delegateEvents();
    };
    var x = /^(\S+)\s*(.*)$/;
    var _ = [ "model", "collection", "el", "id", "attributes", "className", "tagName", "events" ];
    i.extend(C.prototype, c, {
        tagName: "div",
        $: function(e) {
            return this.$el.find(e);
        },
        initialize: function() {},
        render: function() {
            return this;
        },
        remove: function() {
            this.$el.remove();
            this.stopListening();
            return this;
        },
        setElement: function(e, i) {
            if (this.$el) this.undelegateEvents();
            this.$el = e instanceof t.$ ? e : t.$(e);
            this.el = this.$el[0];
            if (i !== false) this.delegateEvents();
            return this;
        },
        delegateEvents: function(e) {
            if (!(e || (e = i.result(this, "events")))) return this;
            this.undelegateEvents();
            for (var t in e) {
                var n = e[t];
                if (!i.isFunction(n)) n = this[e[t]];
                if (!n) continue;
                var r = t.match(x);
                var a = r[1], o = r[2];
                n = i.bind(n, this);
                a += ".delegateEvents" + this.cid;
                if (o === "") {
                    this.$el.on(a, n);
                } else {
                    this.$el.on(a, o, n);
                }
            }
            return this;
        },
        undelegateEvents: function() {
            this.$el.off(".delegateEvents" + this.cid);
            return this;
        },
        _ensureElement: function() {
            if (!this.el) {
                var e = i.extend({}, i.result(this, "attributes"));
                if (this.id) e.id = i.result(this, "id");
                if (this.className) e["class"] = i.result(this, "className");
                var n = t.$("<" + i.result(this, "tagName") + ">").attr(e);
                this.setElement(n, false);
            } else {
                this.setElement(i.result(this, "el"), false);
            }
        }
    });
    t.sync = function(e, n, r) {
        var a = k[e];
        i.defaults(r || (r = {}), {
            emulateHTTP: t.emulateHTTP,
            emulateJSON: t.emulateJSON
        });
        var o = {
            type: a,
            dataType: "json"
        };
        if (!r.url) {
            o.url = i.result(n, "url") || B();
        }
        if (r.data == null && n && (e === "create" || e === "update" || e === "patch")) {
            o.contentType = "application/json";
            o.data = JSON.stringify(r.attrs || n.toJSON(r));
        }
        if (r.emulateJSON) {
            o.contentType = "application/x-www-form-urlencoded";
            o.data = o.data ? {
                model: o.data
            } : {};
        }
        if (r.emulateHTTP && (a === "PUT" || a === "DELETE" || a === "PATCH")) {
            o.type = "POST";
            if (r.emulateJSON) o.data._method = a;
            var s = r.beforeSend;
            r.beforeSend = function(e) {
                e.setRequestHeader("X-HTTP-Method-Override", a);
                if (s) return s.apply(this, arguments);
            };
        }
        if (o.type !== "GET" && !r.emulateJSON) {
            o.processData = false;
        }
        if (o.type === "PATCH" && S) {
            o.xhr = function() {
                return new ActiveXObject("Microsoft.XMLHTTP");
            };
        }
        var l = r.xhr = t.ajax(i.extend(o, r));
        n.trigger("request", n, l, r);
        return l;
    };
    var S = typeof window !== "undefined" && !!window.ActiveXObject && !(window.XMLHttpRequest && new XMLHttpRequest().dispatchEvent);
    var k = {
        create: "POST",
        update: "PUT",
        patch: "PATCH",
        "delete": "DELETE",
        read: "GET"
    };
    t.ajax = function() {
        return t.$.ajax.apply(t.$, arguments);
    };
    var A = t.Router = function(e) {
        e || (e = {});
        if (e.routes) this.routes = e.routes;
        this._bindRoutes();
        this.initialize.apply(this, arguments);
    };
    var E = /\((.*?)\)/g;
    var T = /(\(\?)?:\w+/g;
    var P = /\*\w+/g;
    var I = /[\-{}\[\]+?.,\\\^$|#\s]/g;
    i.extend(A.prototype, c, {
        initialize: function() {},
        route: function(e, n, r) {
            if (!i.isRegExp(e)) e = this._routeToRegExp(e);
            if (i.isFunction(n)) {
                r = n;
                n = "";
            }
            if (!r) r = this[n];
            var a = this;
            t.history.route(e, function(i) {
                var o = a._extractParameters(e, i);
                a.execute(r, o);
                a.trigger.apply(a, [ "route:" + n ].concat(o));
                a.trigger("route", n, o);
                t.history.trigger("route", a, n, o);
            });
            return this;
        },
        execute: function(e, t) {
            if (e) e.apply(this, t);
        },
        navigate: function(e, i) {
            t.history.navigate(e, i);
            return this;
        },
        _bindRoutes: function() {
            if (!this.routes) return;
            this.routes = i.result(this, "routes");
            var e, t = i.keys(this.routes);
            while ((e = t.pop()) != null) {
                this.route(e, this.routes[e]);
            }
        },
        _routeToRegExp: function(e) {
            e = e.replace(I, "\\$&").replace(E, "(?:$1)?").replace(T, function(e, t) {
                return t ? e : "([^/?]+)";
            }).replace(P, "([^?]*?)");
            return new RegExp("^" + e + "(?:\\?(.*))?$");
        },
        _extractParameters: function(e, t) {
            var n = e.exec(t).slice(1);
            return i.map(n, function(e, t) {
                if (t === n.length - 1) return e || null;
                return e ? decodeURIComponent(e) : null;
            });
        }
    });
    var O = t.History = function() {
        this.handlers = [];
        i.bindAll(this, "checkUrl");
        if (typeof window !== "undefined") {
            this.location = window.location;
            this.history = window.history;
        }
    };
    var D = /^[#\/]|\s+$/g;
    var R = /^\/+|\/+$/g;
    var L = /msie [\w.]+/;
    var F = /\/$/;
    var M = /#.*$/;
    O.started = false;
    i.extend(O.prototype, c, {
        interval: 50,
        atRoot: function() {
            return this.location.pathname.replace(/[^\/]$/, "$&/") === this.root;
        },
        getHash: function(e) {
            var t = (e || this).location.href.match(/#(.*)$/);
            return t ? t[1] : "";
        },
        getFragment: function(e, t) {
            if (e == null) {
                if (this._hasPushState || !this._wantsHashChange || t) {
                    e = decodeURI(this.location.pathname + this.location.search);
                    var i = this.root.replace(F, "");
                    if (!e.indexOf(i)) e = e.slice(i.length);
                } else {
                    e = this.getHash();
                }
            }
            return e.replace(D, "");
        },
        start: function(e) {
            if (O.started) throw new Error("Backbone.history has already been started");
            O.started = true;
            this.options = i.extend({
                root: "/"
            }, this.options, e);
            this.root = this.options.root;
            this._wantsHashChange = this.options.hashChange !== false;
            this._wantsPushState = !!this.options.pushState;
            this._hasPushState = !!(this.options.pushState && this.history && this.history.pushState);
            var n = this.getFragment();
            var r = document.documentMode;
            var a = L.exec(navigator.userAgent.toLowerCase()) && (!r || r <= 7);
            this.root = ("/" + this.root + "/").replace(R, "/");
            if (a && this._wantsHashChange) {
                var o = t.$('<iframe src="javascript:0" tabindex="-1">');
                this.iframe = o.hide().appendTo("body")[0].contentWindow;
                this.navigate(n);
            }
            if (this._hasPushState) {
                t.$(window).on("popstate", this.checkUrl);
            } else if (this._wantsHashChange && "onhashchange" in window && !a) {
                t.$(window).on("hashchange", this.checkUrl);
            } else if (this._wantsHashChange) {
                this._checkUrlInterval = setInterval(this.checkUrl, this.interval);
            }
            this.fragment = n;
            var s = this.location;
            if (this._wantsHashChange && this._wantsPushState) {
                if (!this._hasPushState && !this.atRoot()) {
                    this.fragment = this.getFragment(null, true);
                    this.location.replace(this.root + "#" + this.fragment);
                    return true;
                } else if (this._hasPushState && this.atRoot() && s.hash) {
                    this.fragment = this.getHash().replace(D, "");
                    this.history.replaceState({}, document.title, this.root + this.fragment);
                }
            }
            if (!this.options.silent) return this.loadUrl();
        },
        stop: function() {
            t.$(window).off("popstate", this.checkUrl).off("hashchange", this.checkUrl);
            clearInterval(this._checkUrlInterval);
            O.started = false;
        },
        route: function(e, t) {
            this.handlers.unshift({
                route: e,
                callback: t
            });
        },
        checkUrl: function(e) {
            var t = this.getFragment();
            if (t === this.fragment && this.iframe) {
                t = this.getFragment(this.getHash(this.iframe));
            }
            if (t === this.fragment) return false;
            if (this.iframe) this.navigate(t);
            this.loadUrl();
        },
        loadUrl: function(e) {
            e = this.fragment = this.getFragment(e);
            return i.any(this.handlers, function(t) {
                if (t.route.test(e)) {
                    t.callback(e);
                    return true;
                }
            });
        },
        navigate: function(e, t) {
            if (!O.started) return false;
            if (!t || t === true) t = {
                trigger: !!t
            };
            var i = this.root + (e = this.getFragment(e || ""));
            e = e.replace(M, "");
            if (this.fragment === e) return;
            this.fragment = e;
            if (e === "" && i !== "/") i = i.slice(0, -1);
            if (this._hasPushState) {
                this.history[t.replace ? "replaceState" : "pushState"]({}, document.title, i);
            } else if (this._wantsHashChange) {
                this._updateHash(this.location, e, t.replace);
                if (this.iframe && e !== this.getFragment(this.getHash(this.iframe))) {
                    if (!t.replace) this.iframe.document.open().close();
                    this._updateHash(this.iframe.location, e, t.replace);
                }
            } else {
                return this.location.assign(i);
            }
            if (t.trigger) return this.loadUrl(e);
        },
        _updateHash: function(e, t, i) {
            if (i) {
                var n = e.href.replace(/(javascript:|#).*$/, "");
                e.replace(n + "#" + t);
            } else {
                e.hash = "#" + t;
            }
        }
    });
    t.history = new O();
    var N = function(e, t) {
        var n = this;
        var r;
        if (e && i.has(e, "constructor")) {
            r = e.constructor;
        } else {
            r = function() {
                return n.apply(this, arguments);
            };
        }
        i.extend(r, n, t);
        var a = function() {
            this.constructor = r;
        };
        a.prototype = n.prototype;
        r.prototype = new a();
        if (e) i.extend(r.prototype, e);
        r.__super__ = n.prototype;
        return r;
    };
    p.extend = m.extend = A.extend = C.extend = O.extend = N;
    var B = function() {
        throw new Error('A "url" property or function must be specified');
    };
    var j = function(e, t) {
        var i = t.error;
        t.error = function(n) {
            if (i) i(e, n, t);
            e.trigger("error", e, n, t);
        };
    };
    return t;
});

(function() {
    var e = typeof module !== "undefined" && module.exports;
    var t = t || function(e) {
        setTimeout(e, 0);
    };
    var i = e ? require(__dirname + "/Worker.js") : self.Worker;
    var n = typeof self !== "undefined" ? self.URL ? self.URL : self.webkitURL : null;
    var r = e || self.Worker;
    function a(e, t) {
        if (!t) t = {};
        for (var i in e) {
            if (t[i] === undefined) t[i] = e[i];
        }
        return t;
    }
    function o() {
        this._callbacks = [];
        this._errCallbacks = [];
        this._resolved = 0;
        this._result = null;
    }
    o.prototype.resolve = function(e, t) {
        if (!e) {
            this._resolved = 1;
            this._result = t;
            for (var i = 0; i < this._callbacks.length; ++i) {
                this._callbacks[i](t);
            }
        } else {
            this._resolved = 2;
            this._result = e;
            for (var n = 0; n < this._errCallbacks.length; ++n) {
                this._errCallbacks[n](t);
            }
        }
        this._callbacks = [];
        this._errCallbacks = [];
    };
    o.prototype.then = function(e, t) {
        if (this._resolved === 1) {
            if (e) {
                e(this._result);
            }
            return;
        } else if (this._resolved === 2) {
            if (t) {
                t(this._result);
            }
            return;
        }
        if (e) {
            this._callbacks[this._callbacks.length] = e;
        }
        if (t) {
            this._errCallbacks[this._errCallbacks.length] = t;
        }
        return this;
    };
    var s = {
        evalPath: e ? __dirname + "/eval.js" : null,
        maxWorkers: e ? require("os").cpus().length : 4,
        synchronous: true
    };
    function l(e, t) {
        this.data = e;
        this.options = a(s, t);
        this.operation = new o();
        this.operation.resolve(null, this.data);
        this.requiredScripts = [];
        this.requiredFunctions = [];
    }
    l.isSupported = function() {
        return r;
    };
    l.prototype.getWorkerSource = function(t) {
        var i = "";
        var n = 0;
        if (!e && this.requiredScripts.length !== 0) {
            i += 'importScripts("' + this.requiredScripts.join('","') + '");\r\n';
        }
        for (n = 0; n < this.requiredFunctions.length; ++n) {
            if (this.requiredFunctions[n].name) {
                i += "var " + this.requiredFunctions[n].name + " = " + this.requiredFunctions[n].fn.toString() + ";";
            } else {
                i += this.requiredFunctions[n].fn.toString();
            }
        }
        if (e) {
            return i + 'process.on("message", function(e) {process.send(JSON.stringify((' + t.toString() + ")(JSON.parse(e).data)))})";
        } else {
            return i + "self.onmessage = function(e) {self.postMessage((" + t.toString() + ")(e.data))}";
        }
    };
    l.prototype.require = function() {
        var e = Array.prototype.slice.call(arguments, 0), t;
        for (var i = 0; i < e.length; i++) {
            t = e[i];
            if (typeof t === "string") {
                this.requiredScripts.push(t);
            } else if (typeof t === "function") {
                this.requiredFunctions.push({
                    fn: t
                });
            } else if (typeof t === "object") {
                this.requiredFunctions.push(t);
            }
        }
        return this;
    };
    l.prototype._spawnWorker = function(t) {
        var r;
        var a = this.getWorkerSource(t);
        if (e) {
            r = new i(this.options.evalPath);
            r.postMessage(a);
        } else {
            if (i === undefined) {
                return undefined;
            }
            try {
                var o = new Blob([ a ], {
                    type: "text/javascript"
                });
                var s = n.createObjectURL(o);
                r = new i(s);
            } catch (l) {
                if (this.options.evalPath !== null) {
                    r = new i(this.options.evalPath);
                    r.postMessage(a);
                } else {
                    throw l;
                }
            }
        }
        return r;
    };
    l.prototype.spawn = function(e) {
        var i = this;
        var n = new o();
        this.operation.then(function() {
            var r = i._spawnWorker(e);
            if (r !== undefined) {
                r.onmessage = function(e) {
                    r.terminate();
                    i.data = e.data;
                    n.resolve(null, i.data);
                };
                r.onerror = function(e) {
                    n.resolve(e, i.data);
                };
                r.postMessage(i.data);
            } else if (i.options.synchronous) {
                t(function() {
                    i.data = e(i.data);
                    n.resolve(null, i.data);
                });
            } else {
                throw new Error("Workers do not exist and synchronous operation not allowed!");
            }
        });
        this.operation = n;
        return this;
    };
    l.prototype._spawnMapWorker = function(e, i, n) {
        var r = this;
        var a = r._spawnWorker(i);
        if (a !== undefined) {
            a.onmessage = function(t) {
                a.terminate();
                r.data[e] = t.data;
                n();
            };
            if (r.data[e] && r.data[e].params !== undefined) {
                r.data[e].params.number = e;
            }
            a.postMessage(r.data[e]);
        } else if (r.options.synchronous) {
            t(function() {
                r.data[e] = i(r.data[e]);
                n();
            });
        } else {
            throw new Error("Workers do not exist and synchronous operation not allowed!");
        }
    };
    l.prototype.map = function(e, t) {
        if (!this.data.length) {
            return this.spawn(e);
        }
        var i = this;
        var n = 0;
        var r = 0;
        function a() {
            if (++r === i.data.length) {
                s.resolve(null, i.data);
            } else if (n < i.data.length) {
                i._spawnMapWorker(n++, e, a);
            }
            if (t) {
                t(r / i.data.length);
            }
        }
        var s = new o();
        this.operation.then(function() {
            for (;n - r < i.options.maxWorkers && n < i.data.length; ++n) {
                i._spawnMapWorker(n, e, a);
            }
        });
        this.operation = s;
        return this;
    };
    l.prototype._spawnReduceWorker = function(e, i, n) {
        var r = this;
        var a = r._spawnWorker(i);
        if (a !== undefined) {
            a.onmessage = function(e) {
                a.terminate();
                r.data[r.data.length] = e.data;
                n();
            };
            a.postMessage(e);
        } else if (r.options.synchronous) {
            t(function() {
                r.data[r.data.length] = i(e);
                n();
            });
        } else {
            throw new Error("Workers do not exist and synchronous operation not allowed!");
        }
    };
    l.prototype.reduce = function(e) {
        if (!this.data.length) {
            throw new Error("Can't reduce non-array data");
        }
        var t = 0;
        var i = this;
        function n(a) {
            --t;
            if (i.data.length === 1 && t === 0) {
                i.data = i.data[0];
                r.resolve(null, i.data);
            } else if (i.data.length > 1) {
                ++t;
                i._spawnReduceWorker([ i.data[0], i.data[1] ], e, n);
                i.data.splice(0, 2);
            }
        }
        var r = new o();
        this.operation.then(function() {
            if (i.data.length === 1) {
                r.resolve(null, i.data[0]);
            } else {
                for (var a = 0; a < i.options.maxWorkers && a < Math.floor(i.data.length / 2); ++a) {
                    ++t;
                    i._spawnReduceWorker([ i.data[a * 2], i.data[a * 2 + 1] ], e, n);
                }
                i.data.splice(0, a * 2);
            }
        });
        this.operation = r;
        return this;
    };
    l.prototype.then = function(e, t) {
        var i = this;
        var n = new o();
        this.operation.then(function() {
            var t = e(i.data);
            if (t !== undefined) {
                i.data = t;
            }
            n.resolve(null, i.data);
        }, t);
        this.operation = n;
        return this;
    };
    if (e) {
        module.exports = l;
    } else {
        self.Parallel = l;
    }
})();

define("Parallel", function(e) {
    return function() {
        var t, i;
        return t || e.Parallel;
    };
}(this));

(function(e, t) {
    var i = function(e, t, i, Utils) {
        var n = Utils.extend(function() {}, {
            isFake: function() {
                return true;
            },
            init: function r(e) {},
            getFilesList: function(e) {},
            trashFile: function(e, t) {},
            processFileThumbnail: function(t, i, n) {
                var r = function(e) {
                    function t(e) {
                        var t = "";
                        var i = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
                        var n = new Uint8Array(e);
                        var r = n.byteLength;
                        var a = r % 3;
                        var o = r - a;
                        var s, l, c, u;
                        var f;
                        for (var d = 0; d < o; d = d + 3) {
                            f = n[d] << 16 | n[d + 1] << 8 | n[d + 2];
                            s = (f & 16515072) >> 18;
                            l = (f & 258048) >> 12;
                            c = (f & 4032) >> 6;
                            u = f & 63;
                            t += i[s] + i[l] + i[c] + i[u];
                        }
                        if (a == 1) {
                            f = n[o];
                            s = (f & 252) >> 2;
                            l = (f & 3) << 4;
                            t += i[s] + i[l] + "==";
                        } else if (a == 2) {
                            f = n[o] << 8 | n[o + 1];
                            s = (f & 64512) >> 10;
                            l = (f & 1008) >> 4;
                            c = (f & 15) << 2;
                            t += i[s] + i[l] + i[c] + "=";
                        }
                        return t;
                    }
                    var i = e.descriptor, n = e.rawData;
                    i.thumbnail = "data:image/jpeg;base64," + t(n);
                    return i;
                };
                var a = function(e) {
                    if (n) n(new ImageDescriptor(e));
                };
                var o = new e({
                    descriptor: t.toJSON(),
                    rawData: i
                });
                o.spawn(r).then(a);
            },
            getMetadata: function(e, t) {},
            getThumbnail: function(e, t, i, n) {},
            getRawData: function(e, t, i) {},
            uploadFile: function(e, t) {},
            _uploadedFilesCount: 0,
            uploadFiles: function(e, t, i) {
                var n = function(e, n) {
                    if (t) t(e, n);
                    _uploadedFilesCount--;
                    if (_uploadedFilesCount == 0 && i) {
                        i(e);
                    }
                };
                _uploadedFilesCount = e.length;
                for (var r = 0; r < e.length; r++) {
                    this.uploadFile(e[r], n);
                }
            }
        });
        return n;
    };
    if (typeof define === "function") {
        define("BaseStorage", [ "Parallel", "environment", "MetadataService", "utils" ], function() {
            return i.apply(this, arguments);
        });
    } else {
        if (typeof e.BaseStorage === "undefined") {
            e.BaseStorage = i(e.Parallel, e.PicsIO, e.MetadataService, e.Utils);
        }
    }
})(this);

(function(e, t) {
    var i = function() {
        var e = function() {
            this.interval = 1e3;
            this.maxInterval = 25 * 1e3;
        };
        e.prototype.retry = function(e, t) {
            setTimeout(e, this.interval);
            this.interval = this.nextInterval_();
            this.interval > this.maxInterval && t();
        };
        e.prototype.reset = function() {
            this.interval = 1e3;
        };
        e.prototype.nextInterval_ = function() {
            var e = this.interval * 2 + this.getRandomInt_(0, 1e3);
            return Math.min(e, this.maxInterval);
        };
        e.prototype.getRandomInt_ = function(e, t) {
            return Math.floor(Math.random() * (t - e + 1) + e);
        };
        return e;
    };
    if (typeof define === "function") {
        define("RetryHandler", [], function() {
            return i();
        });
    } else if (typeof e.RetryHandler === "undefined") {
        e.RetryHandler = i();
    }
})(this);

(function(e, t) {
    var i = function(e) {
        var t = function(t) {
            var i = function() {};
            this.file = t.file;
            this.fileId = t.fileId;
            this.contentType = t.contentType || this.file.type || "application/octet-stream";
            this.metadata = t.metadata || {
                title: this.file.name || t.filename,
                mimeType: this.contentType
            };
            if (t.parent) {
                this.metadata["parents"] = [ {
                    id: t.parent
                } ];
            }
            this.token = t.token;
            this.onComplete = t.onComplete || i;
            this.onError = t.onError || i;
            this.onProgress = t.onProgress || i;
            this.offset = t.offset || 0;
            this.chunkSize = t.chunkSize || 0;
            this.delay = 15 * 1e3;
            this.retryHandler = new e();
            this.delayURI = null;
            this.url = t.url;
            if (!this.url) {
                var n = t.params || {};
                n.uploadType = "resumable";
                this.url = this.buildUrl_(this.fileId, n);
            }
            this.httpMethod = this.fileId ? "PUT" : "POST";
            return this;
        };
        t.prototype.upload = function() {
            var e = this;
            var t = new XMLHttpRequest();
            t.onload = function(e) {
                var t = e.target.getResponseHeader("Location");
                this.url = t;
                this.sendFile_();
            }.bind(this);
            t.onerror = this.onUploadError_.bind(this);
            t.ontimeout = this.onUploadError_.bind(this);
            t.open(this.httpMethod, this.url, true);
            t.setRequestHeader("Authorization", "Bearer " + this.token);
            t.setRequestHeader("Content-Type", "application/json");
            t.setRequestHeader("X-Upload-Content-Length", this.file.size);
            t.setRequestHeader("X-Upload-Content-Type", this.contentType);
            t.timeout = 1e3 * 60;
            t.send(JSON.stringify(this.metadata));
        };
        t.prototype.sendFile_ = function() {
            var e = this.file;
            var t = this.file.size;
            if (this.offset || this.chunkSize) {
                if (this.chunkSize) {
                    t = Math.min(this.offset + this.chunkSize, this.file.size);
                }
                e = e.slice(this.offset, t);
            }
            var i = new XMLHttpRequest();
            i.upload.onprogress = this.onContentUploadProgress_.bind(this, i);
            i.onload = this.onContentUploadSuccess_.bind(this);
            i.onerror = i.ontimeout = function() {
                console.log("onerror");
                this.nextWatcher(i);
                this.onContentUploadError_();
            }.bind(this);
            i.timeout = 1e3 * 60 * 2;
            i.open("PUT", this.url, true);
            i.setRequestHeader("Content-Type", this.contentType);
            i.setRequestHeader("Content-Range", "bytes " + this.offset + "-" + (t - 1) + "/" + this.file.size);
            i.setRequestHeader("X-Upload-Content-Type", this.file.type);
            i.send(e);
            this.watchDelayLimit(i);
        };
        t.prototype.watchDelayLimit = function(e) {
            this.delayURI = setTimeout(this.onContentUploadDelayError_.bind(this, e), this.delay);
        };
        t.prototype.onContentUploadDelayError_ = function(e) {
            e.abort();
        };
        t.prototype.clearDelayWatcher = function() {
            clearTimeout(this.delayURI);
        };
        t.prototype.nextWatcher = function(e) {
            this.clearDelayWatcher();
            this.watchDelayLimit(e);
        };
        t.prototype.resume_ = function() {
            var e = new XMLHttpRequest();
            e.open("PUT", this.url, true);
            e.setRequestHeader("Content-Range", "bytes */" + this.file.size);
            e.setRequestHeader("X-Upload-Content-Type", this.file.type);
            e.timeout = 1e3 * 30;
            e.onload = this.onContentUploadSuccess_.bind(this);
            e.onerror = e.ontimeout = this.onContentUploadError_.bind(this);
            e.send();
        };
        t.prototype.extractRange_ = function(e) {
            var t = e.getResponseHeader("Range");
            if (t) {
                this.offset = parseInt(t.match(/\d+/g).pop(), 10) + 1;
            }
        };
        t.prototype.onContentUploadSuccess_ = function(e) {
            if (e.target.status == 200 || e.target.status == 201) {
                this.onComplete(e.target.response);
                this.clearDelayWatcher();
            } else if (e.target.status == 308) {
                this.extractRange_(e.target);
                this.sendFile_();
            } else {
                var t = JSON.parse(e.target.response);
                this.onError(t);
            }
        };
        t.prototype.onContentUploadError_ = function(e) {
            console.log("onContentUploadError_", "happend");
            this.clearDelayWatcher();
            this.retryHandler.retry(this.resume_.bind(this), this.onError.bind(this));
        };
        t.prototype.onContentUploadProgress_ = function(e, t) {
            if (t.lengthComputable) {
                this.onProgress(t.loaded, t.total);
            }
            this.nextWatcher(e);
        };
        t.prototype.onUploadError_ = function(e) {
            this.onError(e.target.response);
        };
        t.prototype.buildQuery_ = function(e) {
            e = e || {};
            return Object.keys(e).map(function(t) {
                return encodeURIComponent(t) + "=" + encodeURIComponent(e[t]);
            }).join("&");
        };
        t.prototype.buildUrl_ = function(e, t) {
            var i = "https://www.googleapis.com/upload/drive/v2/files/";
            if (e) {
                i += e;
            }
            var n = this.buildQuery_(t);
            if (n) {
                i += "?" + n;
            }
            return i;
        };
        return t;
    };
    if (typeof define === "function") {
        define("GDriveUploader", [ "RetryHandler" ], function(e) {
            return i(e);
        });
    } else if (typeof e.GDriveUploader === "undefined") {
        e.GDriveUploader = i();
    }
})(this);

(function(e, t) {
    if (typeof define === "function" && define.amd) {
        define("User", [ "backbone", "environment", "TrackingService", "q", "LoggingService" ], t);
    } else {
        e.User = t(Backbone, PicsIO, TrackingService, Q, LoggingService);
    }
})(this, function(e, t, i, n, r) {
    var a = e.Model.extend({
        idAttribute: "_id",
        url: t.config.API_BASE_URL + "/users/current",
        initialize: function(t, i) {
            var n = this;
            this.fetch().done(function() {
                a.current = n;
                if (a.current.hasParent()) {
                    a.current.fetchParent().then(function(e) {
                        var t = e.users[0];
                        var i = a.prototype.initialize;
                        a.prototype.initialize = function() {};
                        var r = new a(t);
                        a.current.set("parent", {
                            user: r,
                            confirmed: n.get("parent").confirmed,
                            permissions: n.get("parent").permissions
                        });
                        a.prototype.initialize = i;
                        n.trigger("user:initialized");
                    }).catch(function(e) {
                        n.trigger("user:initialized");
                    });
                } else if (a.current.hasUnconfirmedParent()) {
                    a.current.fetchParent().then(function(t) {
                        var i = t.users[0];
                        e.Events.trigger("teammates:confirm", {
                            email: i.email
                        });
                    });
                } else {
                    n.trigger("user:initialized");
                }
            });
        },
        fetchParent: function() {
            var e = this.get("parent");
            var t = this;
            return n($.ajax({
                url: "/users/search/" + t.get("parent").user
            }));
        },
        parse: function(e) {
            if (e && e.user) {
                return e.user;
            } else {
                console.error("User can't be fetched from backend.");
                return null;
            }
        },
        toJSON: function() {
            var t = e.Model.prototype.toJSON.call(this);
            return {
                user: t
            };
        },
        hasParent: function() {
            return this.get("parent") && this.get("parent").confirmed;
        },
        hasConfirmedParent: function() {
            return this.get("parent") && this.get("parent").confirmed && typeof this.get("parent").user === "object";
        },
        hasUnconfirmedParent: function() {
            return this.get("parent") && this.get("parent").confirmed === null;
        },
        removeFromTeammates: function() {
            var e = this;
            return n($.ajax({
                method: "DELETE",
                url: "/teammates",
                data: {
                    email: e.get("email")
                }
            })).then(function() {
                e.set("parent", undefined);
                r.success("You are successfully removed");
            }).catch(function() {
                r.error("Can not be removed");
            });
        },
        requestResetPassword: function(e, n) {
            var r = this.get("email");
            if (!r) {
                n && n("User have no email. Can't reset password");
            } else {
                var a = t.config.API_BASE_URL + "/requestResetEmail?email=" + r;
                window.open(a);
                i.push("User", "ResetPassword", r);
                e && e(r);
            }
        },
        detachGoogleDrive: function() {
            return n($.post("/users/detachGoogleDrive")).then(function() {
                r.success("Google Drive disconnected");
            }, function() {
                r.success("Can't disconnect Google Drive");
            }).done();
        },
        getCustomer: function() {
            var e = n.defer();
            var i = this;
            $.get(t.config.payments.stripe.RETRIEVE_CUSTOMER_URL).done(function(t) {
                if (t.errors) throw new Error(t.msg);
                return e.resolve(t);
            }).fail(function(t) {
                return e.reject(new Error("Can't retrieve customer. This indicates technical problems. Please contact support@pics.io."));
            });
            return e.promise;
        },
        getSubscriptionStatus: function() {
            var e = t.config.subscriptionPermissions;
            if (this.hasParent()) {
                if (!this.get("parent").user.get) {
                    return n.resolve(e.tier4_monthly);
                }
                var i = new Date(this.get("parent").user.get("trialEnds"));
                if (i > Date.now()) {
                    return n.resolve(e.tier4_monthly);
                }
                try {
                    var a = this.get("parent").user.get("stripeCustomer");
                    var o = a.subscriptions.data[0].plan.id;
                    return n.resolve(e[o] || e.default);
                } catch (s) {
                    return n.resolve(e.ownerSubscriptionEnded);
                }
            }
            var l = this.get("trialEnds");
            if (l) {
                var c = new Date(l);
                if (c > Date.now()) {
                    return n.resolve(e.trial);
                }
            }
            var u = this.getCustomer().then(function(t) {
                var i = t.subscription ? e[t.subscription.plan.id] || e.default : e.unsubscribed;
                return n.resolve(i);
            }).fail(function() {
                r.error("Can't get subscription status");
                return n.resolve(e.default);
            });
            return u;
        },
        isDenyTeammatePermission: function(e) {
            return this.hasParent() && this.get("parent").permissions && this.get("parent").permissions[e] === false;
        }
    }, {
        current: null,
        login: function(e, n, r, a) {
            var o = t.config.API_BASE_URL + "/users/signin";
            var s = {
                email: e,
                password: n
            };
            var l = function() {
                console.log("Error");
                a && a({
                    error: "Something went wrong"
                });
            };
            var c = function(e) {
                if (e.errors) {
                    a && a(e.errors);
                } else if (e.user) {
                    i.push("User", "Login", e.user.email);
                    r && r(e.user);
                } else {
                    a && a({
                        error: "Something went wrong"
                    });
                }
            };
            $.ajax({
                method: "POST",
                url: o,
                async: true,
                cache: false,
                crossDomain: true,
                contentType: "application/json",
                data: JSON.stringify(s),
                success: c,
                error: l,
                xhrFields: {
                    withCredentials: true
                }
            });
        },
        logout: function(e, n) {
            var r = t.config.API_BASE_URL + "/users/signout";
            var a = function() {
                console.log("Error");
                n && n({
                    error: "Something went wrong"
                });
            };
            var o = function(t) {
                if (t.errors) {
                    n && n(t.errors);
                } else if (t.user) {
                    i.push("User", "Logout", t.user.email);
                    e && e(t.user);
                } else {
                    n && n({
                        error: "Something went wrong"
                    });
                }
            };
            $.ajax({
                method: "POST",
                url: r,
                async: true,
                contentType: "application/json",
                success: o,
                error: a
            });
        },
        openForgotPasswordForm: function(e) {
            window.open(t.config.paths.RESET_PASSWORD_PATH + e, "_blank");
        },
        isUserLoggedIn: function(e, i) {
            var e = e, i = i;
            var n = t.config.API_BASE_URL + "/users/current";
            var r = function() {
                i && i({
                    error: "Something went wrong"
                });
            };
            var a = function(t) {
                if (!t.errors) {
                    e && e(t.user);
                } else {
                    i && i(t.errors);
                }
            };
            $.ajax({
                method: "GET",
                url: n,
                contentType: "application/json",
                success: a,
                error: r
            });
        },
        checkGoogleAuth: function(e) {
            return this._authorize(e).then(a.getCurrentGoogleProfile.bind(this)).then(function(e) {
                var t = a.current.get("googleProfileId");
                var i = a.current.get("googleProfileEmail");
                a.current.set("totalQuota", e.totalQuota);
                a.current.set("usedQuota", e.usedQuota);
                a.current.set("lastAuthorizedGoogleEmail", e.email);
                if (!t) {
                    console.log("No Google profile detected in db. Saving " + e.email + "(" + e.id + ")");
                    a.current.save({
                        googleProfileId: e.id,
                        googleProfileEmail: e.email
                    });
                } else if (t != e.id) {
                    var n = new Error("Please use {1} account you connected before or reconnect new one".assign(i));
                    throw n;
                }
                return e;
            });
        },
        _authorize: function(e) {
            var i = n.defer();
            var r = {
                client_id: t.config.gdrive.CLIENT_ID,
                scope: t.config.gdrive.SCOPES,
                immediate: !!(e.immediate || false)
            };
            var o = a.current.get("googleProfileEmail");
            if (o) {
                r.authuser = -1;
                r.login_hint = o;
            }
            gapi.auth.authorize(r, function(e) {
                if (!e || e && e.error) {
                    return i.reject("Not authorized to Google!");
                }
                return i.resolve();
            });
            return i.promise;
        },
        getCurrentGoogleProfile: function() {
            var e = n.defer();
            var t = function(t) {
                if (!t || t.error) {
                    var i = new Error(t.error.message || "Not authorized to Google");
                    i.name = "GoogleAuthError";
                    return e.reject(i);
                }
                if (!t.user) {
                    var i = new Error("Google does not return user info");
                    i.name = "GoogleAuthError";
                    return e.reject(i);
                }
                if (!t.user.permissionId) {
                    var i = new Error("Google does not return profile id");
                    i.name = "GoogleAuthError";
                    return e.reject(i);
                }
                if (!t.user.emailAddress) {
                    var i = new Error("Google does not return profile email");
                    i.name = "GoogleAuthError";
                    return e.reject(i);
                }
                e.resolve({
                    id: t.user.permissionId,
                    email: t.user.emailAddress,
                    totalQuota: Math.round(t.quotaBytesTotal / Math.pow(1024, 3)),
                    usedQuota: Math.round(t.quotaBytesUsedAggregate / Math.pow(1024, 3))
                });
            };
            var i = "name,permissionId,user,quotaBytesTotal,quotaBytesUsed,quotaBytesUsedAggregate";
            if (gapi.client.drive) {
                var r = gapi.client.drive.about.get({
                    fields: i
                });
                r.execute(t);
            } else {
                gapi.client.load("drive", "v2", function() {
                    var e = gapi.client.drive.about.get({
                        fields: i
                    });
                    e.execute(t);
                });
            }
            return e.promise;
        }
    });
    return a;
});

(function(e, t) {
    if (typeof define === "function" && define.amd) {
        define("GDriveStorage", [ "BaseStorage", "LoggingService", "GDriveUploader", "environment", "TrackingService", "User", "utils", "q" ], t);
    } else {
        e.GDriveStorage = t(e.b);
    }
})(this, function(e, t, i, n, r, a, Utils, o) {
    var s = Utils.extend(e, {
        requestsQueue: [],
        MAX_FOLDERS_COUNT: 50,
        alias: "gd",
        isConnected: function() {
            return null != gapi.auth.getToken();
        },
        isFake: function() {
            return false;
        },
        _isMainFolderHasPermission: function() {
            var e = o.defer();
            var t = this;
            var i = "items(authKey,domain,emailAddress,id,name,role,type,value,withLink)";
            var r = gapi.client.drive.permissions.list({
                fileId: n.config.gdrive.APP_FOLDER,
                fields: i
            });
            r.execute(function(t) {
                if (t.items) return e.reject(new Error("Cant retrieve main folder's permissions"));
                var i = t.items;
                console.log("Permissions retrieved: ", i);
                var n = "08475001729112611634";
                var r = i.find(function(e) {
                    return e.id === n && e.role === "writer";
                });
                if (r) {
                    console.log("Permission for service account found: ", r);
                    e.resolve(r);
                } else {
                    console.warn("Permission for service account NOT found");
                    e.reject(new Error("Cant retrieve main folder's permissions"));
                }
            });
            return e.promise;
        },
        _setMainFolderPermission: function() {
            var e = this;
            if (!this.folderId) return o.reject(new Error("Can't set permission to main folder"));
            var t = o.defer();
            var i = "08475001729112611634";
            var n = {
                id: i,
                type: "user",
                role: "writer"
            };
            var r = gapi.client.drive.permissions.insert({
                fileId: e.folderId,
                resource: n,
                sendNotificationEmails: false
            });
            if (a.current.hasConfirmedParent()) {
                t.resolve(e.folderId);
            } else {
                r.execute(function(i) {
                    if (!i.error) {
                        console.log("Permission for service account is set: ", i);
                        t.resolve(e.folderId);
                    } else {
                        console.error("Permission for service account is NOT set: ", i.error);
                        t.reject(new Error("Can't set permission to main folder"));
                    }
                });
            }
            return t.promise;
        },
        _getMainFolderData: function() {
            var e = o.defer();
            var i = this;
            var r = a.current.hasConfirmedParent() ? a.current.get("parent").user.get("googleProfileId") : "me";
            var s = gapi.client.drive.files.list({
                q: "title='" + n.config.gdrive.APP_FOLDER + "' and trashed != true and '" + r + "' in owners"
            });
            s.execute(function(n) {
                if (n.items && n.items.length > 0) {
                    if (n.items.length > 1) {
                        console.warn("WARN! There are more than one Picsio folder in Google Drive. We will use earliest one. Please remove other folders.");
                    }
                    var r = n.items.sortBy(function(e) {
                        return new Date(e.createdDate);
                    });
                    i.folderId = r[0].id;
                    t.log("Folder ID is " + i.folderId);
                    e.resolve(i.folderId);
                } else {
                    e.reject(new Error("Picsio folder not found in Google Drive"));
                }
            });
            return e.promise;
        },
        init: function() {
            var e = n.config.formats.SUPPORTED_FORMATS.concat(n.config.gdrive.BROKEN_FORMATS);
            this.QUERY_MIMETYPE_STATEMENT = " and (" + _.map(e, function(e) {
                return "mimeType='" + e + "'";
            }).join(" or ") + ") ";
            this.FILEDS_FILTER = "items(downloadUrl,fileExtension,fileSize,id,imageMediaMetadata(height,rotation,width),mimeType,title,thumbnail,createdDate),nextPageToken";
            var i = this;
            return a.checkGoogleAuth({
                immediate: true
            }).then(function() {
                var e = gapi.auth.getToken();
                if (e == undefined) {
                    t.log("No token available, authorization is pending");
                    throw new Error("Can't authorize to Google Drive");
                }
                return i._getMainFolderData().fail(i._createMainFolderIfNeeded.bind(i)).then(i._setMainFolderPermission.bind(i)).then(function(e) {
                    return {
                        picsioFolderId: e
                    };
                });
            }).fail(function(e) {
                e = e || "Can't connect to Google Drive";
                throw new Error(e);
            });
        },
        _createMainFolderIfNeeded: function() {
            var e = this;
            if (this.folderId) {
                console.log("Folder " + this.folderId + " exists");
                return o.resolve(this.folderId);
            } else {
                return this.createFolder(n.config.gdrive.APP_FOLDER).then(function(t) {
                    e.folderId = response.id;
                });
            }
        },
        createFolder: function(e, i) {
            var n = o.defer();
            var r = this;
            var a = {};
            a.title = e;
            a.mimeType = "application/vnd.google-apps.folder";
            if (i) {
                a.parents = [ {
                    id: i
                } ];
            }
            var s = gapi.client.drive.files.insert({
                resource: a
            });
            var l = function(i) {
                if (i.title) {
                    t.success("Folder " + e + " is created in Google Drive!");
                    n.resolve(i.id);
                } else {
                    n.reject(new Error("Can't create folder " + e));
                }
            };
            var c = gapi.auth.getToken();
            if (c == undefined) {
                t.log("No token available, authorization is pending");
                return;
            }
            s.execute(l);
            return n.promise;
        },
        execute: function(e, i) {
            t.log("gd: request executed");
            e.execute(i);
        },
        getFolderIdByTitleAndParentId: function(e, i) {
            var n = o.defer();
            var r = this;
            var a = gapi.client.drive.files.list({
                q: "(title='{1}') and ('{2}' in parents) and (mimeType='application/vnd.google-apps.folder') and (trashed != true)".assign(e, i)
            });
            a.execute(function(r) {
                if (r.items && r.items.length > 0) {
                    if (r.items.length > 1) {
                        var a = "There are more than one folder {1} in Google Drive.".assign(e);
                        var o = new Error(a);
                        o.code = "duplicated";
                        o.parentId = i;
                        o.title = e;
                        console.warn(a);
                        if (resolveDuplicates === false) {
                            return n.reject(o);
                        }
                    }
                    var s = r.items.sortBy(function(e) {
                        return new Date(e.createdDate);
                    });
                    var l = s[0];
                    t.log("Folder is " + l);
                    n.resolve(l);
                } else {
                    n.reject(new Error("Folder not found in Google Drive"));
                }
            });
            return n.promise;
        },
        getFolderIdByPath: function(e) {
            var t = this;
            var i = e.split("/").compact(true);
            if (i.length === 0) {
                return o.resolve(this.folderId);
            }
            var n = function(e, t) {
                var i = o.defer();
                var n = 0;
                var r = function() {
                    var a = e.call(this, arguments, n) ? i.resolve.call(this, arguments) : t.call(this, arguments, n).then(r, i.reject);
                    n++;
                    return a;
                };
                r(undefined);
                return i.promise;
            };
            return n(function(e, t) {
                return i.length === t;
            }, function(e, n) {
                if (e.length > 1) throw new Error("Two folders with similar name found in GD. Please remove one of folders and try again.");
                var r = n === 0 ? t.folderId : e[0].id;
                return t.getFolderIdByTitleAndParentId(i[n], r, false);
            }).then(function(e) {
                return e[0].id;
            });
        },
        createFolderUnderPath: function(e, i) {
            console.log('createFolderUnderPath(title="{1}", parentPath="{2}")'.assign(e, i));
            var n = this;
            return this.getFolderIdByPath(i).then(function(t) {
                return n.createFolder(e, t);
            }).fail(function(e) {
                t.error(e.message);
            });
        },
        renameFolderByPath: function(e, t) {
            console.log('renameFolderByPath(newName="{1}", path="{2}")'.assign(e, t));
            var i = this;
            return this.getFolderIdByPath(t).then(function(t) {
                return i.renameFolder(t, e);
            });
        },
        removeFolderByPath: function(e) {
            console.log('removeFolderByPath(path="{1}")'.assign(e));
            var i = this;
            return this.getFolderIdByPath(e).then(function(e) {
                return i.removeFolders({
                    ids: [ e ]
                });
            }).fail(function(e) {
                t.error(e);
            });
        },
        testBatch: function() {
            var e = function(e) {
                return gapi.client.drive.files.insert({
                    resource: {
                        title: "new_file_title" + e
                    }
                });
            };
            return this.batchRequest([ 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10 ], e);
        },
        addParentsToFiles: function(e, t) {
            var i = function(t) {
                return gapi.client.drive.files.patch({
                    fileId: t,
                    addParents: e.join(",")
                });
            };
            return this.batchRequest(t, i);
        },
        addParentToFilesByPath: function(e, i) {
            console.log('addParentToFilesByPath(parentPath="{1}", fileIds="{2}")'.assign(e, i));
            var n = this;
            return this.getFolderIdByPath(e).then(function(e) {
                return n.addParentsToFiles([ e ], i);
            }).then(function() {
                t.success("Files placed to {1} folder in Google Drive".assign(e.split("/").last()));
            }).fail(function(e) {
                t.error(e);
            });
        },
        renameFolder: function(e, i) {
            var n = o.defer();
            var r = this;
            var a = gapi.client.drive.files.patch({
                fileId: e,
                resource: {
                    title: i
                }
            });
            var s = function(r) {
                if (r.title) {
                    t.success("Folder renamed to {2} in Google Drive!".assign(e, i));
                    n.resolve(r.id);
                } else {
                    n.reject(new Error("Can not rename folder"));
                }
            };
            a.execute(s);
            return n.promise;
        },
        openMainFolder: function() {
            this.openFolder(this.folderId);
        },
        openFolder: function(e) {
            window.open("http://drive.google.com/#folders/" + e);
        },
        makeRequest: function(e) {
            var i = gapi.auth.getToken().access_token;
            var r = [ e.descriptor ? e.descriptor.url : e.url, "&key=", n.config.gdrive.API_KEY, "&access_token=", encodeURIComponent(i) ].join("");
            var a = new XMLHttpRequest();
            a.open("GET", r, true);
            a.setRequestHeader("Authorization", "Bearer " + i);
            a.responseType = "arraybuffer";
            var o, s;
            if (typeof e.startOffset === "number") {
                o = e.startOffset;
                s = e.endOffset;
            } else {
                o = e.offset.start;
                s = e.offset.end;
            }
            a.setRequestHeader("range", "bytes=" + o + "-" + s);
            if (e.extraParams) {
                for (var l in e.extraParams) a[l] = e.extraParams[l];
            }
            a.onload = function() {
                if (this.status == 200 || this.status == 206 || this.status == 302) {
                    e.handler(e.descriptor, this.response, this);
                } else if (this.status == 403) {
                    e.error("Security token has expired, please reload the page.");
                    t.error("Security token has expired, please reload the page.");
                } else if (this.status == 404) {
                    e.handler(e.descriptor, this.response, this);
                    console.warn("File not found");
                } else if (this.status === 401) {
                    e.error({
                        type: 401,
                        mes: "Not authorized."
                    });
                }
            };
            a.onerror = function() {
                e.error("Cannot get requested part of file from Google drive.");
                t.log("Cannot get requested part of file from Google drive.");
            };
            return a;
        },
        getFileRevisions: function(e) {
            e = e || {};
            var t = e.fileId;
            var i = o.defer();
            gapi.client.drive.revisions.list({
                fileId: t
            }).execute(function(e) {
                if (e.error) {
                    return i.reject(new Error(e.error));
                }
                if (!e.items[0].originalFilename) {
                    return i.resolve([]);
                }
                return i.resolve(e.items);
            }, function() {
                return i.resolve([]);
            });
            return i.promise;
        },
        removeFileRevisions: function(e) {
            e = e || {};
            var t = e.fileId;
            var i = e.revisionId;
            var n = o.defer();
            gapi.client.drive.revisions.delete({
                fileId: t,
                revisionId: i
            }).execute(function(e) {
                n.resolve(e.items);
            }, n.reject);
            return n.promise;
        },
        trashFile: function(e, i) {
            var n = i && i.success || noop;
            var a = i && i.failure || noop;
            var o = this;
            var s = gapi.client.drive.files.trash({
                fileId: e.get("id")
            });
            var l = function(i) {
                if (i.error) {
                    t.log("Can't delete file");
                    a("Can't delete file from GDrive");
                } else {
                    r.push("Photo", "MoveToTrash", e.get("name"));
                    n(o, e);
                }
            };
            o.execute(s, l);
        },
        untrashFile: function(e, i) {
            var n = i && i.success || noop;
            var a = i && i.failure || noop;
            var o = this;
            var s = gapi.client.drive.files.untrash({
                fileId: e.get("id")
            });
            var l = function(i) {
                if (i.error) {
                    t.log("Can't untrash file");
                    a("Can't untrash file");
                } else {
                    r.push("Photo", "UnTrash", e.get("name"));
                    n(o, e);
                }
            };
            o.execute(s, l);
        },
        trashFiles: function(e) {
            var t = function(e) {
                return gapi.client.drive.files.trash({
                    fileId: e
                });
            };
            return this.batchRequest(e, t);
        },
        batchRequest: function(e, t) {
            var i = o.defer();
            var n = 5;
            var r = 800;
            var a = [];
            var s = 0;
            var l = function() {
                var e = gapi.client.newHttpBatch();
                a.push(e);
            };
            var c = 0;
            e.each(function(e) {
                c === 0 && l();
                var i = a.last();
                i.add(t(e), {
                    id: e
                });
                c++;
                c >= r && (c = 0);
            });
            var u = a.length * n;
            var f = function() {
                var e = a.shift();
                e.execute(function(e) {
                    if (!a.length) {
                        i.resolve();
                        return;
                    }
                    u--;
                    if (!u) {
                        i.resolve();
                        return;
                    }
                    var n;
                    Object.keys(e).each(function(i) {
                        if (!e[i].hasOwnProperty("error")) {
                            s++;
                            return;
                        }
                        if (!n) {
                            l();
                            n = a.last();
                        }
                        n.add(t(i), {
                            id: i
                        });
                    });
                    n && a.push(n);
                    i.notify(s);
                    f();
                });
            };
            f();
            return i.promise;
        },
        constructThumbnailUrl: function(e, t) {
            if (e && !e.url) console.error("Cant construct thumbnailurl. descriptor.url is empty!");
            return [ e.url, "&key=" + n.config.gdrive.API_KEY, "&uid=" + e.id, "&access_token=" + encodeURIComponent(gapi.auth.getToken().access_token), "&offset_start=" + t.start, "&offset_end=" + t.end, "&thumb_type=" ].join("");
        },
        constructFullUrl: function(e) {
            var t = gapi.auth.getToken();
            if (e && !e.url) {
                console.error("Cant construct fullurl. descriptor.url is empty!");
                throw "Cant construct fullurl. descriptor.url is empty!";
            }
            e.fullUrl = e.url + "&key=" + n.config.gdrive.API_KEY + "&access_token=" + encodeURIComponent(t.access_token);
            return e;
        },
        constructUrl: function(e) {
            var t = gapi.auth.getToken();
            if (!e) console.error("Cant construct url. url is empty!");
            return e + "&key=" + n.config.gdrive.API_KEY + "&access_token=" + encodeURIComponent(t.access_token);
        },
        _buildFilesListRequest: function(e, t, i, r) {
            var a = {
                q: e,
                maxResults: r || n.config.LOAD_PER_REQUEST || 1e3
            };
            if (t) a.fields = t;
            if (i) a.pageToken = i;
            return gapi.client.drive.files.list(a);
        },
        retrieveAllFiles: function(e) {
            var t = this;
            var i = "(trashed != true) and ((sharedWithMe = true) or ('" + t.folderId + "'" + " in parents )) " + this.QUERY_MIMETYPE_STATEMENT;
            var n = this.FILEDS_FILTER;
            var r = o.defer();
            var a = function(o, s) {
                o.execute(function(o) {
                    s = s.concat(o.items);
                    r.notify(o.items);
                    if (o.nextPageToken) {
                        a(t._buildFilesListRequest(i, n, o.nextPageToken), s);
                    } else {
                        r.resolve(s);
                        e && e(s);
                    }
                });
            };
            a(t._buildFilesListRequest(i, n), []);
            return r.promise;
        },
        _getFolders: function(e) {
            var i = this;
            var n = o.defer();
            var r = "(trashed=false) and (mimeType='application/vnd.google-apps.folder')";
            if (e && e.onlyMy) r += " and ('me' in owners)";
            var a = "items(id,parents(id,isRoot),title),nextPageToken";
            var s = function(e, o) {
                e.execute(function(e) {
                    if (!e || e.error) {
                        var l = new Error(e && e.error && e.error.message || "Can not load folders from Google Drive");
                        t.log(l);
                        return n.reject(l);
                    } else {
                        o = o.concat(e.items);
                        n.notify(o);
                        if (e.nextPageToken) {
                            s(i._buildFilesListRequest(r, a, e.nextPageToken), o);
                        } else {
                            return n.resolve(o);
                        }
                    }
                });
            };
            s(i._buildFilesListRequest(r, a), []);
            return n.promise;
        },
        getFilesFromFolders: function(e, t) {
            var i = this;
            var n = e.inGroupsOf(this.MAX_FOLDERS_COUNT);
            var r = [];
            n.each(function(e) {
                r.push(i._getFilesFromFolders(e.compact(), t));
            });
            return o.all(r).progress(function(e) {
                return e.value;
            }).then(function(e) {
                return e.flatten().compact();
            });
        },
        _getFilesFromFolders: function(e, i) {
            if (e.length > this.MAX_FOLDERS_COUNT) return o.reject(new Error("Too many folders. Google Array will reject that request. Split folders array and try again."));
            var r = this;
            var a = o.defer();
            var s = " and (" + _.map(n.config.formats.SUPPORTED_FORMATS, function(e) {
                return "mimeType='" + e + "'";
            }).join(" or ") + ") ";
            var l = " and (" + e.map(function(e) {
                return "('" + e + "' in parents)";
            }).join(" or ") + ")";
            var c = "(trashed=false)" + s + l;
            if (i && i.onlyMy) c += " and ('me' in owners) and ('190238897195-9i7vc0b05bfetrqeacgnrvonplli5ob2@developer.gserviceaccount.com' in writers)";
            var u = "items(fileExtension,fileSize,id,imageMediaMetadata(height,rotation,width),mimeType,parents/id,title,createdDate),nextPageToken";
            var f = function(e, i) {
                e.execute(function(e) {
                    if (!e || e.error) {
                        var n = new Error(e && e.error && e.error.message || "Can not load files from Google Drive");
                        t.log(n);
                        return a.reject(n);
                    } else {
                        i = i.concat(e.items);
                        a.notify("Found {1} files in Google Drive folders".assign(i.length));
                        if (e.nextPageToken) {
                            f(r._buildFilesListRequest(c, u, e.nextPageToken), i);
                        } else {
                            return a.resolve(i);
                        }
                    }
                });
            };
            f(r._buildFilesListRequest(c, u), []);
            return a.promise;
        },
        getFoldersAsPaths: function(e) {
            var t = this.folderId;
            var i = n.config.tags.filters;
            return this._getFolders(e).progress(function(e) {
                return e.length;
            }).then(function(e) {
                var i = {
                    ignoreFolderRegex: /\.lrdata/
                };
                var n = [];
                var r = e.length;
                console.log("folders:", e.length);
                while (r > 0) {
                    r--;
                    var a = e[r];
                    if (i.ignoreFolderRegex.test(e[r].title)) {
                        n.push(a.id);
                        e.splice(r, 1);
                    }
                }
                while (n.length) {
                    r = e.length;
                    var o = [];
                    while (r > 0) {
                        r--;
                        var a = e[r];
                        if (a.parents.length && n.indexOf(a.parents[0].id) > -1) {
                            o.push(a.id);
                            e.splice(r, 1);
                        }
                    }
                    n = o;
                }
                console.log("folders after cleaning:", e.length);
                var s = [];
                var l = function(t) {
                    var i = [];
                    var n = e.length;
                    while (n) {
                        n--;
                        var r = e[n];
                        if (!r.parents.length) {
                            continue;
                        }
                        var a = Array.prototype.find.call(t, function(e) {
                            return e.id === r.parents[0].id;
                        });
                        if (!!a) {
                            r.path = a.path + "/" + r.title;
                            i.push({
                                id: r.id,
                                path: r.path
                            });
                            s.push(r);
                            e.splice(n, 1);
                            continue;
                        }
                    }
                    return i;
                };
                var c = Array.prototype.find.call(e, function(e) {
                    return e.id === t;
                });
                s.push(c);
                var u = [ {
                    id: c.id,
                    path: ""
                } ];
                while (u.length) {
                    u = l(u);
                }
                return s;
            });
        },
        _getFilePart: function(e, t, i, r, a, o) {
            var s = gapi.auth.getToken();
            if (n.config.debug.LOAD_RAW_FROM_LOCALHOST) {
                e.url = n.config.API_BASE_URL + "/raws/" + e.name + "?a=a";
                if (!a) a = {};
                a.Range = "bytes=" + t + "-" + i;
            }
            var l = {
                _partialCustomGet: true,
                descriptor: e,
                startOffset: t,
                endOffset: i,
                handler: r,
                extraParams: a,
                token: s.access_token,
                error: o
            };
            if (s) {
                var c = this.makeRequest(l);
                c.send();
            }
        },
        checkToken: function(e, t) {
            var i = Date.now(), r = e.expires_at * 1e3;
            if (i < r) {
                t();
            } else {
                gapi.auth.authorize({
                    client_id: n.config.gdrive.CLIENT_ID,
                    scope: n.config.gdrive.SCOPES,
                    immediate: true
                }, t);
            }
        },
        addRevision: function() {
            i.prototype.addRevision();
        },
        uploadFile: function(e, t, n) {
            var a = o.defer(), s = this, l = gapi.auth.getToken().access_token, c = e.get("file"), n = n || {}, u = n.fileId;
            var f = function(e) {
                var i = JSON.parse(e);
                r.push("Photo", "FileUploaded", {
                    gdid: i.id,
                    name: i.originalFilename
                });
                if (t && t.uploaded) t.uploaded(this.file, i);
                a.resolve(i);
                r.push("Catalog", "FilesUploaded");
            };
            var d = function(e) {
                if (t && t.failed) t.failed(this.file, e);
                a.resolve();
            };
            var h = function(e, i) {
                if (t && t.progressed) t.progressed(this.file, e / i * 100);
                a.notify(e / i * 100);
            };
            s.checkToken(gapi.auth.getToken(), function() {
                var t = gapi.auth.getToken().access_token;
                var n = new i({
                    parent: s.folderId,
                    file: c,
                    originalObject: e,
                    token: t,
                    onComplete: f,
                    onError: d,
                    onProgress: h,
                    contentType: c.getMimeType(),
                    fileId: u
                });
                n.upload();
            });
            return a.promise;
        },
        uploadBlob: function(e, t) {
            var n = o.defer();
            var a = gapi.auth.getToken().access_token;
            var s = new Blob([ e.blob ], {
                type: "image/jpeg"
            });
            var l = function(e) {
                var i = JSON.parse(e);
                if (t && t.uploaded) t.uploaded(this.file, i);
                n.resolve(i);
                r.push("Catalog", "FilesUploaded");
            };
            var c = function(e) {
                if (t && t.failed) t.failed(this.file);
                console.error("Can't upload image");
                n.resolve();
            };
            var u = new i({
                parent: this.appFolderId,
                file: s,
                token: a,
                onComplete: l,
                filename: e.filename,
                onError: c,
                contentType: "image/jpeg"
            });
            u.upload();
            return n.promise;
        },
        uploadFiles: function(e, t) {
            var n = [];
            var a = gapi.auth.getToken().access_token;
            var o = this;
            var s = 0;
            var l = e.length;
            var c = function(e) {
                var i = JSON.parse(e);
                r.push("Photo", "FileUploaded", {
                    gdid: i.id,
                    name: i.originalFilename
                });
                if (t && t.uploaded) t.uploaded(this.file, i);
                if (++s === l) {
                    if (t && t.completed) t.completed();
                    r.push("Catalog", "FilesUploaded");
                }
            };
            var u = function(e) {
                if (t && t.failed) t.failed(this.file);
                if (++s === l) {
                    if (t && t.completed) t.completed();
                    r.push("Catalog", "FilesUploaded", s);
                }
            };
            var f = function(e, i) {
                if (t && t.progressed) t.progressed(this.file, e / i * 100);
            };
            for (var d = 0; d < e.length; d++) {
                var h = e.at(d).get("file");
                var p = new i({
                    parent: this.folderId,
                    file: h,
                    originalObject: e.at(d),
                    token: a,
                    onComplete: c,
                    onError: u,
                    onProgress: f,
                    contentType: h.getMimeType()
                });
                p.upload();
            }
        },
        getThumbnailsByIds: function(e) {
            var t = o.defer();
            var i = "items/downloadUrl, items/title";
            var r = e.models || [];
            var a = gapi.auth.getToken();
            var s = gapi.client.newHttpBatch();
            r.each(function(e) {
                var t = "'appdata' in parents and title = '" + e.id + "_small.jpg'";
                var r = gapi.client.request({
                    method: "GET",
                    path: "drive/v2/files",
                    params: {
                        fields: i,
                        q: t,
                        maxResults: 1
                    }
                });
                s.add(r, {
                    callback: function(t) {
                        var i;
                        if (t.result.items && t.result.items.length) {
                            i = t.result.items[0].downloadUrl + "&key=" + n.config.gdrive.API_KEY + "&access_token=" + encodeURIComponent(a.access_token);
                        }
                        e.callback(i);
                    }
                });
            });
            s.execute(function(e) {
                t.resolve();
            });
            return t.promise;
        },
        updateUrlToken: function(e, t) {
            return Utils.updateURLParameter(e, "access_token", t);
        },
        getThumbnail: function(e) {
            var t = o.defer();
            var i = "items/downloadUrl";
            var r = gapi.client.drive.files.list({
                q: "'appdata' in parents and title = '" + e.id + "_small.jpg'",
                fields: i
            });
            var a = gapi.auth.getToken();
            if (e.object.thumbnail && e.object.thumbnail.small) {
                e.object.thumbnail.small.url = this.updateUrlToken(e.object.thumbnail.small.url, a.access_token);
                t.resolve({
                    small: {
                        url: e.object.thumbnail.small.url
                    }
                });
            } else {
                r.execute(function(e) {
                    if (e && e.items && e.items.length) {
                        t.resolve({
                            small: {
                                url: e.items[0].downloadUrl + "&key=" + n.config.gdrive.API_KEY + "&access_token=" + encodeURIComponent(a.access_token)
                            }
                        });
                    } else {
                        t.reject("No Items Found");
                    }
                });
            }
            return t.promise;
        },
        getDownloadUrls: function(e) {
            var t = o.defer();
            var i = "downloadUrl,title,thumbnailLink,thumbnail";
            var n = e.models;
            var r = gapi.client.newHttpBatch();
            n.each(function(e) {
                var t = gapi.client.request({
                    method: "GET",
                    path: "drive/v2/files/" + e.id,
                    params: {
                        fields: i
                    }
                });
                r.add(t, {
                    callback: e.callback
                });
            });
            r.execute(t.resolve);
            return t.promise;
        },
        shareTag: function(e, t) {
            var i = this;
            return o($.ajax({
                url: "/tags/share",
                method: "POST",
                contentType: "application/json",
                data: JSON.stringify({
                    collaborators: [ t._id ],
                    tag: e,
                    access_token: gapi.auth.getToken().access_token,
                    picsioFolderId: i.folderId
                })
            }));
        },
        shareTagPublic: function(e) {
            var t = this;
            return o($.ajax({
                url: "/tags/share",
                method: "POST",
                contentType: "application/json",
                data: JSON.stringify({
                    publicSharing: true,
                    tag: e,
                    access_token: gapi.auth.getToken().access_token,
                    picsioFolderId: t.folderId
                })
            }));
        },
        unshareTagPublic: function(e) {
            var t = this;
            return o($.ajax({
                url: "/tags/unshare",
                method: "POST",
                contentType: "application/json",
                data: JSON.stringify({
                    publicSharing: true,
                    tag: e,
                    access_token: gapi.auth.getToken().access_token,
                    picsioFolderId: t.folderId
                })
            }));
        },
        unshareTag: function(e, t) {
            var i = this;
            return o($.ajax({
                url: "/tags/unshare",
                method: "POST",
                contentType: "application/json",
                data: JSON.stringify({
                    collaborators: [ t._id ],
                    tag: e,
                    access_token: gapi.auth.getToken().access_token,
                    picsioFolderId: i.folderId
                })
            }));
        },
        removeFolders: function(e) {
            var i = e.ids;
            var n = gapi.client.newHttpBatch();
            var r = o.defer();
            i.each(function(e) {
                var t = gapi.client.drive.files.delete({
                    fileId: e
                });
                n.add(t);
            });
            n.execute(function(e) {
                if (!e || e.error) {
                    var i = new Error(e && e.error && e.error.message || "Can not remove files from Google Drive");
                    t.log(i);
                    return r.reject(i);
                } else {
                    r.resolve(e);
                }
            });
            return r.promise;
        },
        toString: function() {
            return "[object GDriveStorage]";
        }
    });
    return new s();
});

(function(e, t) {
    var i = {
        list: [],
        active: false,
        delay: 150,
        addTask: function(e) {
            this.list.push(e);
            this.startQueueProcessing();
        },
        addPriorTask: function(e) {
            this.list.unshift(e);
            this.startQueueProcessing();
        },
        startQueueProcessing: function() {
            if (this.active) {
                return false;
            }
            if (!this.list.length) {
                return false;
            }
            this.active = true;
            this.runTask();
        },
        runTask: function() {
            try {
                var e = this.list.shift();
                e.task.apply(this, [ this.next.bind(this) ]);
            } catch (t) {
                this.next();
                console.warn(t);
            }
        },
        next: function() {
            if (!this.list.length) {
                this.active = false;
                return false;
            }
            setTimeout(this.runTask.bind(this), this.delay);
        }
    };
    if (typeof define === "function") {
        define("QueueService", [ "environment" ], function(e) {
            return i;
        });
    } else {
        if (typeof e.cacheService === "undefined") {
            e.QueueService = i;
        }
    }
})(this);

(function(e, t) {
    var i = e.document, n;
    n = function(Utils, e, t, n, r) {
        var a = "assets/img/loading.gif";
        var o = {
            type: {
                small: "small",
                original: "original"
            },
            images: [ "image/jpeg", "image/png", "image/gif" ],
            raws: t.config.formats.SUPPORTED_RAW_FORMATS
        };
        var s = function(e) {
            if (e === "small300") return {
                width: 300,
                height: 300,
                alias: "small300"
            };
            if (e === "small") return {
                width: 2e3,
                height: 500,
                alias: "small"
            };
            if (e === "small16") return {
                width: 16,
                height: 16,
                alias: "small16"
            };
            return null;
        };
        var l = function(e) {
            var t = e.thumbnails;
            if (e.object.file) {
                if (!Array.isArray(t)) t = [ t ];
                t.remove("original");
                t = t.unique().compact(true);
                t = t.map(function(e) {
                    if (typeof e === "string") {
                        e = s(e);
                    } else if (!e.alias && e.width && e.height) {
                        e.alias = "w" + e.width + "h" + e.height;
                    }
                    return e;
                });
                e.thumbnails = t.compact(true);
                return u(e);
            } else {
                return y(e);
            }
        };
        var c = function(e, t) {
            var i = d(new Uint8Array(e.arrayBuffer), e.width, e.height), n = Utils.imageDataToDataURL(i);
            Utils.resizeImage(n, t);
        };
        var u = function(t) {
            var i = t.object, n = t.thumbnails, r = t.success, s = t.fail, l = t.progress;
            var c = i.mimeType || i.type;
            var u = new FileReader();
            u.onload = function(s) {
                if (o.images.indexOf(i.mimeType.toLowerCase()) !== -1) {
                    var l = {};
                    var c = new Blob([ s.target.result ]);
                    var u = URL.createObjectURL(c);
                    l.original = {
                        url: u,
                        orientation: 1
                    };
                    if (n.length == 0) {
                        r && r(l);
                        !t.doNotRevokeBlobs && URL.revokeObjectURL(u);
                    }
                    var f = 0;
                    var d = function(e, i) {
                        l[i.alias] = {
                            url: e.url,
                            arraybuffer: e.arraybuffer,
                            orientation: e.orientation
                        };
                        if (++f == n.length) {
                            r && r(l);
                            !t.doNotRevokeBlobs && URL.revokeObjectURL(u);
                        }
                    };
                    n.each(function(e) {
                        Utils.resizeImage(u, d, e);
                    });
                } else if (o.raws.indexOf(i.mimeType.toLowerCase()) !== -1) {
                    i.originalData = s.target.result;
                    var h = function(e) {
                        console.time("metadataReadyHandler");
                        var a = i.metadata.preview;
                        var o = {};
                        var s;
                        var l = e.originalData.slice(a.StartOffset, a.EndOffset);
                        e.originalData = null;
                        if (a.PreviewType === "compressedJPG") {
                            var c = new Blob([ l ], {
                                type: "image/jpeg"
                            });
                            s = URL.createObjectURL(c);
                            c = null;
                        } else {
                            var u = new Uint8ClampedArray(l);
                            s = p(u, a.Width, a.Height);
                        }
                        var f = i.metadata.preview.Width;
                        var d = i.metadata.preview.Height;
                        var h = f > d ? f : d;
                        Utils.resizeImage(s, function(i, l) {
                            o.original = {
                                url: i.url
                            };
                            if (n.length == 0) {
                                return r && r(o);
                                !t.doNotRevokeBlobs && URL.revokeObjectURL(s);
                            }
                            var c = 0;
                            var u = function(i, a) {
                                o[a.alias] = {
                                    url: i.url,
                                    arraybuffer: i.arraybuffer,
                                    orientation: i.orientation
                                };
                                if (++c >= n.length) {
                                    r && r(o, e);
                                    !t.doNotRevokeBlobs && URL.revokeObjectURL(s);
                                }
                            };
                            n.each(function(e) {
                                if (!e.orientation) e.orientation = a && a.Orientation || 1;
                                Utils.resizeImage(s, u, e);
                            });
                            console.timeEnd("metadataReadyHandler");
                        }, {
                            alias: "original",
                            height: h,
                            orientation: a && a.Orientation || 1,
                            width: h
                        });
                    };
                    e.getMetadataForFile(i, h);
                } else {
                    r && r({
                        url: a
                    });
                }
            };
            u.readAsArrayBuffer(i.file);
        };
        var f = function(e, t, n) {
            var r = new Image();
            Utils.getOriginImageUrl(e.thumbnail.original).execute(function(e) {
                var t = this;
                r.crossOrigin = "Anonymous";
                r.onload = function() {
                    t.executeCaller();
                };
                r.src = e;
                return t;
            }).execute(function() {
                var n = i.createElement("canvas");
                n.width = r.width;
                n.height = r.height;
                var a = n.getContext("2d");
                a.drawImage(r, 0, 0);
                var o = a.getImageData(0, 0, r.width, r.height);
                var s = o.data;
                t(e, s, o);
            });
        };
        var d = function(e, t, n) {
            var r = i.createElement("canvas"), a = r.getContext("2d"), o = a.createImageData(t, n), s = e;
            for (var l = 0, c = 0; c < s.length; ) {
                o.data[l++] = s[c++];
                o.data[l++] = s[c++];
                o.data[l++] = s[c++];
                o.data[l++] = 255;
            }
            return o;
        };
        var h = function(e, t, n) {
            var r = i.createElement("canvas"), a = r.getContext("2d");
            r.width = t;
            r.height = n;
            a.putImageData(e, 0, 0);
            return r.toDataURL();
        };
        var p = function(e, t, i) {
            var n = d(e, t, i);
            return h(n, t, i);
        };
        var g = function(e, i) {
            var n = e.imageMediaMetadata.width / e.imageMediaMetadata.height;
            var r = [ "https://images1-focus-opensocial.googleusercontent.com/gadgets/proxy?url=", "http://pics.io" + t.config.defaultStatic.imagePreview, "&container=focus&resize_w=500", "&resize_h=" + (500 / n + ""), "&refresh=240" ].join("");
            Utils.downloadAsBlob(r, function(e) {
                var t = {
                    url: r,
                    orientation: 1,
                    blob: e
                };
                var n = [];
                n.isFake = true;
                n.original = n.small = t;
                i && i(n);
            });
        };
        var m = function(e) {
            var t = e.descriptor.metadata;
            var i = t && t.preview && t.preview.Orientation || 1;
            var n = e.thumbnail || "small";
            e.handler = function(t, r, a) {
                if (!r) {}
                var o = new Blob([ r ], {
                    type: "image/jpeg"
                });
                var s = URL.createObjectURL(o);
                r = null;
                if (n === "big") {
                    var l = function(t) {
                        URL.revokeObjectURL(s);
                        t && delete t.arraybuffer;
                        if (!e.descriptor.thumbnail || !e.descriptor.thumbnail.original) {
                            e.descriptor.thumbnail = e.descriptor.thumbnail || {};
                            e.descriptor.thumbnail["original"] = t;
                        }
                        e.success(e.descriptor);
                    };
                    Utils.resizeImage(s, l, {
                        orientation: 1
                    });
                } else {
                    var l = function(t) {
                        URL.revokeObjectURL(s);
                        t && delete t.arraybuffer;
                        if (!e.descriptor.thumbnail || !e.descriptor.thumbnail.small) {
                            e.descriptor.thumbnail = e.descriptor.thumbnail || {};
                            e.descriptor.thumbnail["small"] = t;
                        }
                        e.success(e.descriptor);
                    };
                    Utils.resizeImage(s, l, {
                        width: 2e3,
                        height: 500,
                        orientation: i
                    });
                }
            };
            e.error = function(t) {
                e.fail && e.fail(t);
            };
            e.descriptor.storage.makeRequest(e).send();
        };
        var v = {
            compressedJPG: function(e, i, n, r, a) {
                var i;
                if (n && Utils.isNumber(n.start) && Utils.isNumber(n.end)) {
                    i = new m({
                        descriptor: e,
                        url: e.url,
                        offset: n,
                        success: r,
                        fail: a,
                        thumbnail: i
                    });
                } else {
                    console.warn("WARN! [DEPRECATED METHOD! SHOULDNT BE HERE!]");
                    var o = t.config.assets + t.config.defaultStatic.imagePreview;
                    i = new m({
                        url: o,
                        offset: n
                    });
                }
            },
            uncompressedRGB: function(e, t, i) {
                e.storage._getFilePart(e, t.start, t.end, function(e, n) {
                    var r = new Uint8ClampedArray(n), a = p(r, e.metadata.root.ImageWidth, e.metadata.root.ImageLength);
                    var o = new m({
                        smallUrl: a,
                        originalUrl: a,
                        offset: t,
                        data: r
                    });
                    i(o, e);
                });
            },
            uncompressedRGBA: function() {}
        };
        var y = function(e) {
            var t = e.object, i = e.thumbnails, n = e.success, a = e.fail;
            n = n || function() {};
            a = a || function() {};
            var o = this;
            var s = function(e) {
                console.time("photoCut");
                if (t.mimeType === "image/jpeg") {
                    v.compressedJPG(t, i, {
                        start: 0,
                        end: t.fileSize
                    }, function() {
                        n.apply(o, arguments);
                        e();
                    }, function() {
                        a.apply(o, arguments);
                        e();
                    });
                } else {
                    if (!t.metadata) {
                        a();
                        return;
                    }
                    var r = t.metadata.preview;
                    var s = {
                        start: r.StartOffset,
                        end: r.EndOffset
                    };
                    v[r.PreviewType](t, i, s, function() {
                        n.apply(o, arguments);
                        console.timeEnd("photoCut");
                        e();
                    });
                }
            };
            if (!i || i === "small") {
                r.addTask({
                    task: s
                });
            } else {
                r.addPriorTask({
                    task: s
                });
            }
        };
        return {
            getThumbnail: l,
            getThumbnailImageData: f,
            getThumbnailFromArrayBuffer: c
        };
    };
    if (typeof define === "function") {
        define("ThumbnailService", [ "utils", "MetadataService", "environment", "GDriveStorage", "QueueService" ], function(e, t, i, r, a) {
            return new n(e, t, i, r, a);
        });
    } else {
        if (typeof e.ThumbnailService === "undefined") {
            e.ThumbnailService = new n(e.Utils, e.MetadataService);
        }
    }
})(this);

define("colorsHelper", [], function() {
    return {
        colors: {
            defaultValue: "color",
            reset: {
                name: "none",
                value: "#000"
            },
            list: [ {
                colorTitle: "red",
                colorHex: "#ff0000"
            }, {
                colorTitle: "yellow",
                colorHex: "#ffcc00"
            }, {
                colorTitle: "green",
                colorHex: "#66cc00"
            }, {
                colorTitle: "blue",
                colorHex: "#3300ff"
            }, {
                colorTitle: "purple",
                colorHex: "#9900ff"
            } ],
            unlabeled: {
                colorTitle: "nocolor"
            }
        },
        getColorHex: function(e) {
            var t = this.colors.list;
            var e = t.find(function(t) {
                return t.colorTitle === e;
            });
            return e ? e.colorHex : "";
        }
    };
});

define("localization", [], function() {
    return {
        STORAGE_FOLDER_NOT_FOUND: "Picsio folder not found",
        STORAGE_FILES_NOT_FOUND: "Picsio folder is empty",
        STORAGE_CANT_TRASH_FILE: "Can't trash file",
        DISCLAIMER_PATTERN: "<b>Hold up there, %name%.</b><br/><br/>Youre getting access to the really early version of Pics.io.<br/><br/><b>It's an alpha.</b><br/><br/>I bet you've got it - it doesn't work more often than it works. Sometimes it delivers weird results only Andy Warhol would be satisfied.<br/><br/>We are big fans of rapid delivery so you will see small changes almost every day. Please let me know if you see that something goes wrong using our Helpdesk, Twitter or email.<br/><br/>Love,<br/>Vlad from TopTechPhoto",
        STORAGE_GDRIVE_NOT_CONNECTED: "Looks like your <b>Pics.io</b> account is not connected to <b>Google Drive</b> or you are not logged in!",
        LOGOUT_QUESTION: "<center>You are going to <b>logout</b>.<br/><br/> Continue?</center>",
        GOBACK_FROM_DEVELOP_QUESTION: "<center>If you return to catalog your adjustments <b>will be lost</b>.<br/><br/>Return to catalog?</center>",
        DELETE_IMAGE_QUESTION: "<center>Are you sure you want to <b>delete</b> image from your storage?<br/><br/>If you are using GoogleDrive item will be placed to trash.</center>",
        RESETPASSWORD_QUESTION: "<center>You are going to <b>reset your password</b>.<br/>We will send you an <b>email</b> with instructions.<br/><br/> Continue?</center>",
        RESETPASSWORD_SUCCESS_MESSAGE: "<center>Reset password instructions sent to <b>%email%</b>. Don't forget to relogin after changing password. =)</center>",
        NOT_IMPLEMENTED_YET: "<center><b>Coming soon...</b><br/><br/>Feature is not ready yet, and we are working hard on it.<br/><br/>If you have any suggestions or ideas, just <a href='javascript:app.openSupport()'>let us now</a>.</center>",
        FORMAT_NOT_SUPPORTED_YET: "<center><b>Coming soon...</b><br/><br/>Editing of this raw format is not ready yet, and we are working hard on it.<br/><br/>If you have any suggestions or ideas, just <a href='javascript:app.openSupport()'>let us now</a>.</center>",
        IMPORT_FORMAT_NOT_SUPPORTED_YET: {
            title: "Unsupported format",
            text: 'It seems that you\'ve dropped a file that Pics.io doesn\'t support yet.<br>You can find supported formats list <a href="http://blog.pics.io/sneak-peeks/the-most-complete-list-of-pics-io-features/#supported-media-formats" target="_blank">here</a>.'
        },
        NO_PHOTO_IN_COLLECTION: "<div>There are no files in this collection</div><span>To add use Upload, or select and drag'n'drop files from another collections</span>",
        NO_PHOTO_IN_COLLECTION_WITHOUT_UPLOAD: "<div>There are no files in this collection</div>",
        NO_PHOTO_IN_PROOFING_TEMPLATE: "<div>There are no files on this site.</div><span>Please use <a href='https://pics.io/' target='_blank'>pics.io</a> to add files.</span>",
        NO_PHOTO_IN_FILTER: "<div>No files match the filter</div><span>Try to change filtering options or reset filters</span>",
        NO_PHOTO_IN_SEARCH: "<div>Your search did not match any files.",
        NO_PHOTO_IN_SMART_COLLECTION: "<div>There are no files in this collection</div>",
        DIALOGS: {
            WRONG_GOOGLE_ACCOUNT: {
                TITLE: "Wrong Google Account",
                TEXT_TPL: "Note that you're authorized to <b style='color:#FC0'>{authorized}</b>.<br/><br/>Previously you've connected <b style='color:#FC0'>{saved}</b> to pics.io. <br><br>You won't see any files from your original Google Drive account. You might want to login to correct Google Drive account before.",
                OK_TEXT: "Ok, got it",
                CANCEL_TEXT: "Cancel"
            }
        },
        BLOCKUI: {
            GENERATING_THUMBNAIL: "Generating thumbnail..."
        },
        APPLICATION_ERROR: "Application can not start. Please contact administrator support@pics.io",
        LOADING_LIBRARY: "Loading library...",
        CONNECTING_STORAGES: "Connecting storage...",
        UNABLE_TO_CREATE_COLLECTION: "Unable to create collection. Please, contact us.",
        UNABLE_TO_RENAME_COLLECTION: "Unable to rename collection. Please, contact us.",
        UNABLE_TO_REMOVE_COLLECTION: "Unable to remove collection. Please, contact us.",
        UNABLE_TO_REMOVE_IMAGE: "Unable to remove image. Please, contact us.",
        THUMBNAIL_GENERATE_SUCCESS: "Thumbnail generated",
        UNABLE_TO_GENERATE_THUMBNAIL: "Unable to generate thumbnail. Please, contact us.",
        FILES_ARE_REMOVED: "Files are removed",
        FILES_WERENT_REMOVED: "Files weren't removed. Please, try again later."
    };
});

(function(e, t) {
    var i = e.document, n;
    var n = function(e, Utils, i, n, r, a, o, s, l, c, u, f, d) {
        var h = e.Model.extend({
            options: {
                defaultTileSize: 250,
                defaultImgSize: 500,
                maxHeight: f.device.type !== "Mobile" ? 220 : 150,
                bigImgSize: 3e3
            },
            urlRoot: i.config.API_BASE_URL + "/images",
            defaults: {
                flag: 0,
                rating: 0,
                fake: false,
                tags: [],
                facebook: 0,
                twitter: 0,
                color: "nocolor",
                trashed: false,
                description: "",
                selectedTile: false,
                keywords: [],
                storageCreatedAt: new Date().toISOString(),
                storage: s
            },
            defaultUserOrientation: {
                rotation: 0,
                flipX: false,
                flipY: false
            },
            errors: {
                "404": {
                    type: "File not found",
                    handler: function() {
                        console.log(this.type);
                    }
                },
                "401": {
                    type: "",
                    handler: function() {
                        console.log(this.type);
                    }
                },
                "500": {
                    type: "",
                    handler: function() {
                        console.log(this.type);
                    }
                }
            },
            failed: false,
            fail: function(e) {
                if (this.failed) return;
                this.error = e;
                this.failed = true;
                this.trigger("image:failed", e);
                return this;
            },
            repair: function() {
                if (!this.failed) return;
                this.error = t;
                this.failed = false;
                return this;
            },
            repairThumb: function() {
                return this.repair().getThumbnail().then(this.updateThumbnail.bind(this), this._generateThumbnail.bind(this));
            },
            getError: function() {
                if (!this.isFail()) {
                    return false;
                }
                return this.error;
            },
            isFail: function() {
                return !!this.failed;
            },
            isDocument: function() {
                var e = this.get("mimeType");
                return /vnd\.google\-apps/.test(e);
            },
            getDocumentType: function() {
                var e = this.get("mimeType");
                if (!this.isDocument()) {
                    return false;
                } else if (/document/.test(e)) {
                    return "document";
                } else if (/presentation/.test(e)) {
                    return "presentation";
                } else if (/spreadsheet/.test(e)) {
                    return "spreadsheets";
                } else if (/drawing/.test(e)) {
                    return "drawings";
                }
                return false;
            },
            initialize: function(e, t) {
                var i = this;
                var n = this.get("imageMediaMetadata");
                var r = [ 1, 3 ];
                if (n && r.indexOf(n.rotation) !== -1) {
                    n = {
                        rotation: n.rotation,
                        height: n.width,
                        width: n.height
                    };
                    this.set("imageMediaMetadata", n);
                }
                !this.get("userOrientation") && this.set("userOrientation", Object.clone(this.defaultUserOrientation, true));
                var a = this.get("userOrientation").rotation;
                if (a === 90 || a === 270) {
                    var o = n.width;
                    n.width = n.height;
                    n.height = o;
                }
                this.prepareSize();
                !this.get("id") && this.get("googleId") && this.set("id", this.get("googleId"));
                return this;
            },
            retryImage: function() {
                var e = this;
                var t = new Image();
                t.src = this.getOriginalUrl();
                t.onload = function() {
                    e.loadedImage = true;
                    e.trigger("gd:image:was:loaded");
                };
                t.onerror = function() {
                    var t = e.get("thumbnail");
                    var i = t.original.url;
                    e.trigger("gd:image:was:loaded");
                };
            },
            preloadImage: function() {
                if (this.loadedImage) {
                    return;
                }
                if (!this.get("thumbnail")) {
                    return;
                }
                var e = this;
                var t = new Image();
                t.src = this.getOriginalUrl();
                t.onload = function() {
                    e.loadedImage = true;
                    e.trigger("gd:image:was:loaded");
                };
                t.onerror = function() {
                    var t = e.get("thumbnail");
                    t.original.url = t.original.url.replace(/=s\d+$/, "=s500");
                    e.set("thumbnail", t);
                    e.retryImage();
                };
            },
            loadedImage: false,
            getOriginalUrl: function() {
                return this.get("thumbnail").original.url;
            },
            waitUntilImageWillBeLoaded: function() {
                var e = r.defer();
                this.preloadImage();
                if (this.loadedImage) {
                    e.resolve();
                } else {
                    this.on("gd:image:was:loaded", e.resolve, e.resolve);
                }
                return e.promise;
            },
            initTagInstances: function() {
                var e = this;
                if (this.tagInstances && this.tagInstances.length) {
                    return true;
                }
                var t = this.get("tags");
                this.tagInstances = [];
                t.each(function(t) {
                    if (!app.folderTreeModel) {
                        return;
                    }
                    var i = app.folderTreeModel._nodes.findByTagName(t);
                    i && e.tagInstances.push(i);
                });
            },
            parse: function(e, t) {
                if (!t.parse) return false;
                var i = {};
                e.createdDate && (i.storageCreatedAt = e.createdDate);
                e.id && (i.id = e.id);
                e.id && (i.googleId = e.id);
                e._id && (i._id = e._id);
                var n = e.title || e.name;
                n && (i.name = n);
                n = e.downloadUrl || e.url;
                n && (i.url = n);
                if (e.userOrientation) {
                    i.userOrientation = e.userOrientation;
                } else {
                    i.userOrientation = {
                        rotation: 0,
                        flipX: false,
                        flipY: false
                    };
                }
                e.fileSize && (i.fileSize = e.fileSize);
                e.fileExtension && (i.fileExtension = e.fileExtension);
                if (e.imageMediaMetadata) {
                    if (e.imageMediaMetadata.rotation === 1 || e.imageMediaMetadata.rotation === 3) {
                        i.imageMediaMetadata = {
                            rotation: e.imageMediaMetadata.rotation,
                            height: e.imageMediaMetadata.width,
                            width: e.imageMediaMetadata.height
                        };
                    } else {
                        i.imageMediaMetadata = {
                            rotation: e.imageMediaMetadata.rotation,
                            height: e.imageMediaMetadata.height,
                            width: e.imageMediaMetadata.width
                        };
                    }
                }
                e.tags && (i.tags = e.tags);
                e.mimeType && (i.mimeType = e.mimeType);
                return i;
            },
            changeCounters: function() {},
            isVideo: function() {
                return !!this.get("mimeType").match(/video/) || !!this.get("mimeType").match(/audio/);
            },
            isSharedWith: function(e) {
                if (!e) {
                    return false;
                }
                var t = e.get("_id") !== this.get("user");
                var i = e.get("parent") && e.get("parent").user === this.get("user");
                return t && !i;
            },
            fixMimeType: function() {
                var e = this.get("mimeType");
                !e && (e = Utils.getType(this.toJSON()));
                this.set("mimeType", e);
                return e;
            },
            isTestImage: function() {
                var e = this.get("metadata").root.RawDataUniqueID;
                return e && e.toString() == "107,173,35,142,22,48,254,1,164,44,118,26,119,191,178,191";
            },
            hasThumbnail: function() {
                return !!this.get("thubmnail");
            },
            hasMetadata: function() {
                return !!this.get("metadata");
            },
            getOrientation: function() {
                var e;
                if (this.get("metadata") && this.get("metadata").root.Orientation) {
                    e = this.get("metadata").root.Orientation;
                } else {
                    e = 1;
                }
                return e;
            },
            addFlip: function(e) {
                if (e === "x") {
                    var t = this.get("userOrientation");
                    t.flipX = !t.flipX;
                    this.trigger("change:user:orientation", "flipX", t.flipX);
                } else {
                    var t = this.get("userOrientation");
                    t.flipY = !t.flipY;
                    this.trigger("change:user:orientation", "flipY", t.flipY);
                }
                this.save({
                    userOrientation: this.get("userOrientation")
                }, {
                    parse: false
                });
            },
            addRotation: function(e) {
                var t = this.get("userOrientation").rotation;
                if (e > 0) {
                    t = t + e === 360 ? 0 : t + e;
                } else {
                    t = t + e < 0 ? 270 : t + e;
                }
                this.get("userOrientation").rotation = t;
                this.trigger("change:user:orientation", "rotation", t);
                this.save({
                    userOrientation: this.get("userOrientation")
                }, {
                    parse: false
                });
            },
            keywordGenerationError: function() {
                c.error("By some reason the service is unavailable now. Please try again later.", {
                    btnClose: true
                });
                n.push("Error", "AutokeywordsFailed", "imagga");
            },
            generateKeywords: function() {
                n.push("Photo", "Autokeywords", "imagga");
                var e = this;
                return r($.ajax({
                    url: "/analize/tags",
                    data: {
                        url: e.get("thumbnail").small.url
                    }
                })).then(function(t) {
                    var i = e.get("keywords");
                    i = i.union(t);
                    e.set("keywords", i);
                    e.save({
                        keywords: i
                    }, {
                        parse: false
                    });
                    return i;
                }, this.keywordGenerationError);
            },
            setKnownPeers: function(e) {},
            addPeers: function(e) {},
            addPeer: function(e) {
                var t = this.get("knownPeers") || [];
                t.push(e);
                this.set("knownPeers", t);
            },
            getKnownPeers: function(e) {
                return this.get("knownPeers") || [];
            },
            changeFlag: function(e) {
                if (typeof e !== "undefined") {
                    var t = parseInt(e);
                } else {
                    switch (this.get("flag")) {
                      case 1:
                        var t = 2;
                        break;

                      case 2:
                        var t = 0;
                        break;

                      default:
                        var t = 1;
                        break;
                    }
                }
                this.save({
                    flag: t
                }, {
                    parse: false
                });
                n.push("Catalog", "FlagChanged");
            },
            changeStars: function(e, t) {
                e = parseInt(e);
                if (this.get("rating") === e && !t) {
                    e = 0;
                }
                this.save({
                    rating: e
                }, {
                    parse: false
                });
                n.push("Catalog", "StarsSet");
            },
            changeColor: function(e) {
                if (this.get("color") !== e) {
                    e = e !== l.colors.reset.name ? e : "";
                    this.save({
                        color: e || this.defaults.color
                    }, {
                        parse: false
                    });
                    n.push("Catalog", "ColorLabelChanged");
                }
            },
            isEditable: function() {
                var e = this.get("mimeType");
                if (!_.contains(i.config.formats.SUPPORTED_FORMATS, e)) return false;
                var t = this.get("metadata");
                if (t) {
                    var n = t.root && t.root.Make;
                    var r = t.root && t.root.Model;
                    if (n && r && _.contains(i.config.cameras.DENIED_FOR_EDIT, n + " " + r)) return false;
                }
                return true;
            },
            isLambdaConvertableRawFormat: function() {
                var e = this.get("mimeType");
                return i.config.formats.LAMBDA_CONVERTABLE_FORMATS.indexOf(e) !== -1;
            },
            getTagUrl: function() {
                return i.config.API_BASE_URL + "/images/tags";
            },
            setACL: function(e) {
                var t = this;
                $.ajax({
                    type: "PUT",
                    url: "/images/acl/" + this.get("id"),
                    contentType: "application/json",
                    data: JSON.stringify({
                        acl: e
                    }),
                    success: function(e) {
                        t.set("acl", e.acl);
                    }
                });
            },
            setTags: function(e) {
                var t = this, i = this.get("tags").slice(0);
                this.setSelected(false);
                if (e) {
                    i.push(e);
                }
                this.save({
                    googleId: t.get("id"),
                    tags: i
                }, {
                    parse: false,
                    success: function() {}
                });
            },
            setDescription: function(e) {
                var t = this;
                this.save({
                    googleId: t.get("googleId"),
                    description: e
                }, {
                    parse: false,
                    success: function() {
                        t.set("description", e);
                    }
                });
            },
            setTitle: function(e) {
                var t = this;
                this.save({
                    googleId: t.get("googleId"),
                    title: e
                }, {
                    parse: false,
                    success: function() {
                        t.set("title", e);
                    }
                });
            },
            setSelected: function(t) {
                if (this.get("selectedTile") !== t) {
                    this.set("selectedTile", t);
                    e.Events.trigger("selectItem:" + (t ? "added" : "removed"), this);
                }
            },
            recalculateImageMediaMetadata: function() {
                var e = this, t = new Image(), i = this.get("thumbnail");
                t.onload = function(t) {
                    e.saveMetadata(t.target.width, t.target.height);
                };
                i && i.original && i.original.url && (t.src = i.original.url);
            },
            saveMetadata: function(e, t) {
                var i = this;
                var n = this.get("imageMediaMetadata") || {};
                n.width = e;
                n.height = t;
                this.save({
                    googleId: i.get("id"),
                    imageMediaMetadata: n
                }, {
                    parse: false,
                    success: function() {
                        i.set("imageMediaMetadata", n);
                    }
                });
            },
            _restoreTrashFile: function(e) {
                var t = this, i = r.defer();
                this.set("trashed", false);
                this.get("storage").untrashFile(this, {
                    success: function() {
                        e.success();
                        i.resolve();
                    },
                    failure: function() {
                        i.reject("Incorrect response from google drive.");
                    }
                });
                return i.promise;
            },
            _restoreTrashFileDb: function() {
                return r($.ajax({
                    type: "PUT",
                    url: "/images/untrash/" + this.get("_id")
                }));
            },
            restore: function(e) {
                this._restoreTrashFile(e).then(this._restoreTrashFileDb.bind(this)).catch(function(e) {
                    console.warn(e);
                }).done();
            },
            _trashFile: function() {
                var e = this, t = r.defer(), i = this.get("storage");
                i.trashFile && i.trashFile(this, {
                    success: function() {
                        t.resolve();
                    },
                    failure: function(e) {
                        t.reject(e || "Can't trash file from Google Drive.");
                    }
                });
                return t.promise;
            },
            _trashFileFromDb: function() {
                return r($.ajax({
                    type: "PUT",
                    url: "/images/trash/" + this.get("_id")
                }));
            },
            downloadImage: function() {
                if (!this.isDocument()) {
                    var e = this.get("url") || this.get("downloadUrl");
                    e = e.replace("&gd=true", "");
                    window.open(e);
                } else {
                    window.open("https://docs.google.com/file/d/" + this.get("googleId") + "/edit");
                }
            },
            removeImage: function(t) {
                if (this.isFail()) {
                    return this.removeNotFoundImage();
                }
                this._trashFile().then(this._trashFileFromDb.bind(this)).then(function() {
                    this.set("trashed", true);
                }.bind(this)).catch(function(t) {
                    if (u.current.hasParent()) {
                        e.Events.trigger("teammates:parent:can:remove:images");
                    }
                    console.warn(t);
                }).done();
            },
            removeNotFoundImage: function() {
                this._trashFileFromDb().then(function() {
                    this.set("trashed", true);
                }.bind(this)).catch(function() {
                    c.error(d.UNABLE_TO_REMOVE_IMAGE);
                });
            },
            getTagsNames: function() {
                var e = this.get("tags").unique(), t = [];
                e.each(function(e) {
                    var i = e.split("/");
                    t.push({
                        title: i.last(),
                        url: encodeURIComponent(e)
                    });
                });
                return t;
            },
            getTagsTreeAsArray: function() {
                var e = this.get("tags").unique(), t = [];
                e.each(function(e) {
                    t.push({
                        tagsPath: e.split("/"),
                        tag: e
                    });
                });
                return t;
            },
            removeTag: function(t) {
                var i = this.get("tags").slice(0);
                i.remove(t).clone();
                this.set("tags", i);
                this.setTags();
                e.Events.trigger("image:remove:tag", {
                    image: this,
                    tag: t,
                    path: t
                });
            },
            setKeyword: function(e) {
                var t = this.get("keywords").clone();
                t.push(e);
                this.set("keywords", t);
                this.saveKeyword(t);
                n.push("Photo", "addKeyword", "manual");
            },
            removeKeyword: function(e) {
                var t = this.get("keywords").clone();
                t.remove(e);
                this.set("keywords", t);
                this.saveKeyword(t);
                n.push("Photo", "removeKeyword", "manual");
            },
            saveKeyword: function(e) {
                var t = this;
                this.save({
                    googleId: t.get("id"),
                    keywords: e
                }, {
                    parse: false,
                    success: function() {
                        c.log("Keywords updated");
                    }
                });
            },
            uploadImageToCache: function() {
                var e = Utils.decode_base64(this.get("thumbnail").small.url);
                if (e.byteLength < 1e3) return;
                this.get("storage").uploadBlob({
                    blob: e,
                    filename: this.get("id") + "_small.jpg"
                }, {
                    uploaded: function(e, t) {
                        n.push("Catalog", "ThumbnailSavedToDriveFromDescriptor");
                    },
                    failed: function() {
                        n.push("Catalog", "ThumbnailSavedErrorFromDescriptor");
                    }
                });
            },
            isFakeThumbnail: function() {
                return this.thumbnail.isFake;
            },
            save: function(t, i, n) {
                var r = {}, a = {};
                if (_.isObject(t) || t == null) {
                    r = t;
                    a = i;
                } else {
                    r = {};
                    r[t] = i;
                    a = n;
                }
                if (a && r) {
                    a.data = JSON.stringify(r);
                    a.contentType = "application/json";
                }
                if (r) {
                    delete r.storage;
                    delete r.thumbnail;
                    delete r.metadata;
                    delete r.id;
                }
                if (!a.headers) a.headers = {};
                if (gapi.auth.getToken()) {
                    a.headers["google-access-token"] = gapi.auth.getToken().access_token;
                }
                return e.Model.prototype.save.call(this, r, a);
            },
            getMetadata: function() {
                var e = r.defer(), t = this;
                if (this.hasMetadata()) {
                    e.resolve();
                } else {
                    a.getMetadata({
                        object: this.toJSON(),
                        mode: "thumbnail",
                        success: function(i) {
                            t.set("metadata", i.metadata);
                            e.resolve();
                        },
                        failure: function(i) {
                            i = (i || {}).error || i;
                            t.fail(i);
                            e.reject(i);
                        }
                    });
                }
                return e.promise;
            },
            isNew: function() {
                return !this.has("_id");
            },
            getThumbnail: function() {
                var e = this;
                return e.get("storage").getThumbnail({
                    id: e.get("id"),
                    url: e.get("url"),
                    metadata: e.get("metadata"),
                    object: e.toJSON()
                });
            },
            getDownloadUrl: function() {
                var e = this;
                console.log("getDownloadUrl");
                return e.get("storage").getDownloadUrl({
                    fileId: e.get("id")
                });
            },
            updateThumbnail: function(e) {
                if (e && e.small && e.small.url) {
                    var t = Object.clone(this.get("thumbnail") || {});
                    t["small"] = {
                        url: e.small.url
                    };
                    this.set("thumbnail", t);
                    this.trigger("change:thumbnail:small");
                    this.removeProcessing();
                }
                if (e && e.original && e.original.url) {
                    var t = Object.clone(this.get("thumbnail") || {});
                    t["original"] = {
                        url: e.original.url
                    };
                    this.set("thumbnail", t);
                    this.trigger("change:thumbnail:original", e.original.url);
                }
            },
            setProcessing: function() {
                this.set("processing", true);
            },
            removeProcessing: function() {
                this.set("processing", false);
            },
            getDispMetadata: function() {
                var e = this.get("metadata") && this.get("metadata").exif || {}, t = [ "ImageSize", "Model", "WhiteBalance", "Aperture", "CreateDate", "ExposureProgram", "ExposureTime", "Flash", "FocalLength", "ISO" ], i = [ {
                    key: "Filename",
                    name: "Filename",
                    value: this.get("name")
                }, {
                    key: "FileSize",
                    name: "File Size",
                    value: Utils.bytesToSize(this.get("fileSize"), 3)
                } ];
                for (var n in e) {
                    var r = e[n];
                    r.key = n.capitalize();
                    t.some(n) ? i.push(r) : "";
                }
                return i;
            },
            _generateThumbnail: function() {
                var e = this, t = e;
                if (e.isFail()) {
                    return;
                }
                e.trigger("thumbnail:genarating:started");
                o.getThumbnail({
                    object: t.toJSON(),
                    thumbnails: "small",
                    success: function(i) {
                        var n = i.thumbnail;
                        t.set("thumbnail", n);
                        if (!n.isFake) t.uploadImageToCache();
                        t.trigger("change:thumbnail:small");
                        e.set("processing", false);
                    },
                    fail: function() {
                        t.fail({
                            type: 500,
                            mes: "No metadata"
                        });
                        e.set("processing", false);
                    }
                });
            },
            createGDThumbnail: function() {
                var e = i.config.services.thumbnailer.URL + this.get("googleId");
                return r($.ajax({
                    method: "POST",
                    url: e
                }));
            },
            hasPermissionChangeFlag: function() {
                this.initTagInstances();
                var e = this;
                var t = this.isSharedWith();
                var i = this.tagInstances.find(function(e) {
                    return !e.get("allowEditing");
                });
                return !t || t && !i;
            },
            isPartiallySupported: function() {
                return !!this.get("partiallySupported");
            },
            setUrls: function(e, t) {
                if (t !== true && this.get("thumbnail")) {
                    return;
                }
                this.set("webContentLink", e.webContentLink);
                this.set("url", e.downloadUrl);
                this.set("name", e.title);
                if (!e.thumbnailLink && i.config.formats.PARTIALLY_SUPPORTED.indexOf(this.get("fileExtension") > -1)) {
                    n.push("Error", "PartiallySupported", this.get("fileExtension"));
                    this.set("partiallySupported", true);
                    return this.trigger("image:partiallySupported", {
                        extension: this.get("fileExtension")
                    });
                } else if (!e.thumbnailLink) {
                    n.push("Error", "PartiallySupported", this.get("fileExtension"));
                    return this.trigger("image:failed");
                }
                var r = this.get("imageMediaMetadata");
                var a = this.options.defaultImgSize;
                var o = !r ? this.options.bigImgSize : r.height > r.width ? r.height : r.width;
                if (this.isNarrow() && r && r.width && r.height) {
                    a = parseInt(r.height * this.options.defaultImgSize / r.width);
                }
                var s = e.thumbnailLink.replace(/=s\d+$/, "=s" + a), l = e.thumbnailLink.replace(/=s\d+$/, "=s" + o);
                this.updateThumbnail({
                    small: {
                        url: s
                    },
                    original: {
                        url: l
                    }
                });
            },
            prepareSize: function() {
                var e = this.get("imageMediaMetadata");
                var t = e && e.width && e.height;
                var i = t ? e.width : this.options.defaultTileSize;
                var n = t ? e.height : this.options.defaultTileSize;
                var r = this.isNarrow() ? this.options.defaultTileSize : this.options.maxHeight / n * i;
                this.set("realWidth", r);
                this.set("realHeight", this.options.maxHeight);
            },
            isNarrow: function() {
                var e = this.get("imageMediaMetadata");
                if (!e) {
                    return false;
                }
                return e.height / e.width > 7 / 4;
            },
            share: function(e) {
                var t = this.get("storage");
                if (!t) throw new Error("Storage is not defined for image.");
                var i = this.get("id");
                var n = this;
                var r = e.map(function(e) {
                    return {
                        object: n.toJSON(),
                        user: e
                    };
                });
                return t.share(r).then(function(t) {
                    console.log(t.length + " permissions was set to GD.");
                    var i = e.map(function(e) {
                        return {
                            user: e,
                            rights: "reader"
                        };
                    });
                    n.setACL(i);
                    return t;
                }).fail(function(e) {
                    console.error(e);
                    throw err;
                });
            },
            getFileUrl: function() {
                var e = this;
                var t = {
                    id: this.get("id"),
                    callback: function(e) {
                        if (e.result.error) {
                            return this.fail(e.result.error);
                        }
                        this.setUrls(e.result);
                    }.bind(this)
                };
                return s.getDownloadUrls({
                    models: [ t ]
                });
            },
            refreshData: function(e) {
                return r($.ajax({
                    type: "GET",
                    url: "/image/" + this.get("googleId")
                })).then(function(e) {
                    delete e.selectedTile;
                    this.set(e);
                    return e;
                }.bind(this)).catch(function(e) {
                    return e;
                });
            }
        });
        return h;
    };
    if (typeof define === "function") {
        define("ImageDescriptor", [ "backbone", "utils", "environment", "TrackingService", "q", "MetadataService", "ThumbnailService", "GDriveStorage", "colorsHelper", "LoggingService", "User", "ua", "localization" ], function(e, Utils, t, i, r, a, o, s, l, c, u, f, d) {
            return n.apply(n, arguments);
        });
    } else {
        if (typeof e.ImageDescriptor === "undefined") {
            e.ImageDescriptor = n(Backbone, Utils);
        }
    }
})(this);

(function(e, t) {
    var i = e.document, n;
    n = function(e, t, i, n, r, a, o, s, Utils) {
        return e.extend({
            initialize: function() {
                this.set("storageCreatedAt", new Date().toISOString());
                if (!this.fixMimeType()) {
                    var e = new Error("Format ." + this.get("fileExtension") + " is not supported yet!");
                    e.code = "UnsupportedFormat";
                    e.data = this.get("fileExtension");
                    throw e;
                }
                this.set("state", "local");
                this.set("progress", 0);
            },
            parse: function(e, t) {
                if (!t.parse) return false;
                var i = {};
                i.fileSize = e.size;
                i.shortSize = Utils.bytesToSize(e.size);
                i.file = e;
                i.fileExtension = e.name.split(".").pop();
                i.name = e.name;
                if (e.tags) i.tags = e.tags;
                i.mimeType = e.getMimeType();
                return i;
            },
            toJSON: function() {
                var e = Backbone.Model.prototype.toJSON.call(this);
                return e;
            },
            setProgress: function(e, t) {
                this.set("progress", e);
                this.trigger("uploading", e);
                if (t) {
                    this.set("state", t);
                    if (t === "uploaded") {
                        this.trigger("uploaded");
                    }
                }
            },
            getThumbnail: function() {
                var e = i.defer();
                var n = this;
                t.getThumbnail({
                    object: this.toJSON(),
                    thumbnails: [ "small" ],
                    success: function(t, i) {
                        n.set("thumbnail", t);
                        if (i && i.metadata) {
                            n.set("metadata", i.metadata);
                        }
                        e.resolve();
                    }
                });
                return e.promise;
            },
            saveMetadata: function(e) {
                var t = this.toJSON();
                if (!t.metadata) {
                    return false;
                }
                var i = s.config.API_BASE_URL + "/images/metadata/" + (e || t.id) + "/" + (t.metadata.type || "thumbnail");
                var n = t.metadata;
                var r = function() {
                    console.log("Error");
                };
                var a = function(e) {
                    console.log("Saved");
                };
                $.ajax({
                    method: "POST",
                    url: i,
                    async: true,
                    cache: false,
                    crossDomain: true,
                    data: JSON.stringify(n),
                    contentType: "application/json",
                    success: a,
                    error: r
                });
            },
            addRevision: function(e) {
                return this.upload({
                    fileId: e.fileId
                }).then(function(t) {
                    $.post("/revision/" + e.id);
                });
            },
            upload: function(t) {
                var o = i.defer(), s = this, t = t || {}, l = t.fileId, c = !!l;
                n.uploadFile(this, {
                    uploaded: function(t, i) {
                        var l = i.id;
                        s.setProgress(100, "uploaded");
                        if (c) {
                            r.info("Your file revision was updated");
                            a.push("History", "RevisionAdded");
                            o.resolve({
                                data: i
                            });
                            var u = app.contentView.collection;
                            var f = u.findWhere({
                                googleId: l
                            });
                            if (f) {
                                f.setUrls(i, true);
                            }
                            return;
                        }
                        var d = new e(i, {
                            parse: true
                        });
                        d.save(null, {
                            success: function(e) {
                                d.set("storage", n);
                                d.set("thumbnail", s.get("thumbnail"));
                                d.set("metadata", s.get("metadata"));
                                var t = s.get("tags");
                                if (t.length) {
                                    Backbone.Events.trigger("images:add:tag", {
                                        images: [ d ],
                                        path: t[0],
                                        models: [ d ]
                                    });
                                }
                                d.set("tags", s.get("tags"));
                                d.setTags();
                                var r = d.toJSON();
                                if (r.metadata) {
                                    r.metadata.type = "thumbnail";
                                }
                                var e = app.workingList.add(d, {
                                    at: 0
                                });
                                var l = e.get("id");
                                app.workingList.trigger("item:loaded", d);
                                if (i.thumbnail) {
                                    s.saveMetadata(l);
                                    s.saveThumbnail(l);
                                    s.destroy();
                                    o.resolve({
                                        model: s
                                    });
                                } else {
                                    s.destroy();
                                    o.resolve({
                                        model: s
                                    });
                                }
                                a.push("Catalog", "FinishPhotoImport");
                            },
                            error: function() {
                                o.reject({
                                    model: s
                                });
                                a.push("Catalog", "FailedFinishPhotoImport");
                                r.error("Can't save uploaded image into google drive");
                            }
                        });
                    },
                    failed: function(e, t) {
                        if (t && t.error && t.error.code === 403 && t.error.errors && t.error.errors[0].domain === "usageLimits") {
                            if (s.collection) {
                                s.collection.trigger("usage:limit");
                            }
                        }
                        o.reject({
                            model: s
                        });
                        s.setProgress(0, "local");
                    },
                    progressed: function(e, t) {
                        s.setProgress(t, "uploading");
                    }
                }, {
                    fileId: l
                });
                return o.promise;
            },
            saveThumbnail: function(e) {
                var t = this, r = i.defer();
                n.uploadBlob({
                    blob: t.get("thumbnail").small.arraybuffer,
                    filename: (e || t.get("id")) + "_small.jpg"
                }, {
                    uploaded: function(e, i) {
                        a.push("Catalog", "ThumbnailSavedToDrive");
                        console.log("Thumbnail success");
                        t.get("thumbnail").small.arraybuffer = null;
                        r.resolve();
                    },
                    failed: function() {
                        a.push("Catalog", "ThumbnailSavedError");
                        t.get("thumbnail").small.arraybuffer = null;
                        console.log("Thumbnail fail");
                        r.reject();
                    }
                });
                return r.promise;
            }
        });
    };
    if (typeof define === "function") {
        define("ImportImageDescriptor", [ "ImageDescriptor", "ThumbnailService", "q", "GDriveStorage", "LoggingService", "TrackingService", "MetadataService", "environment", "utils" ], function(e, t, i, r, a, o, s, l, Utils) {
            return new n(e, t, i, r, a, o, s, l, Utils);
        });
    } else {
        if (typeof e.ImportImageDescriptor === "undefined") {
            e.ImportImageDescriptor = new n(ImageDescriptor);
        }
    }
})(this);

(function(e, t) {
    var i = function(e, t, Utils, i) {
        var n = Utils.extend(e, {
            alias: "fs",
            isConnected: function() {
                return false;
            },
            init: function(e) {
                var t = i.defer();
                var n = e && e.success || function() {};
                var r = e && e.failure || function() {};
                n(this);
                t.resolve(this);
                return t.promise;
            },
            getFilesList: function(e) {
                var t = e && e.success || function() {};
                var i = e && e.failure || function() {};
                if (e.success) e.success(this, []);
            },
            getRawData: function(e, t, i) {},
            uploadFile: function(e, t) {
                this.workingList.push(e);
                if (t) t(this, e);
            },
            _getFilePart: function(e, i, n, r, a) {
                var o = e.file.slice(i, n);
                var s = new FileReader();
                s.addEventListener("loadend", function(o) {
                    t.log("Read %d bytes from file", n - i);
                    r(e, o.target.result, a);
                });
                s.readAsArrayBuffer(o);
            },
            constructFullUrl: function(e) {
                return e;
            }
        });
        return n;
    };
    if (typeof define === "function") {
        define("FileSystemStorage", [ "BaseStorage", "LoggingService", "utils", "q" ], function() {
            return i.apply(this, arguments);
        });
    } else {
        if (typeof e.FileSystemStorage === "undefined") {
            e.FileSystemStorage = i(BaseStorage, LoggingService, e.Utils);
        }
    }
})(this);

(function(e, t) {
    var i = e.document, n;
    n = function() {
        var e, t;
        if (typeof Float32Array == "undefined") {
            e = t = function(e) {
                if (e.length) {
                    return e.slice(0);
                }
                return new Array(e);
            };
        } else {
            e = function(e) {
                return new Float32Array(e);
            };
            t = function(e) {
                return new Uint8Array(e);
            };
        }
        var r;
        if (typeof i != "undefined") {
            var a = i.createElement("canvas");
            var o = a.getContext("2d");
            var s = function(e) {
                var t, i;
                if (e.getContext) {
                    t = e;
                    try {
                        i = t.getContext("2d");
                    } catch (n) {}
                }
                if (!i) {
                    t = c(e.width, e.height);
                    i = t.getContext("2d");
                    i.drawImage(e, 0, 0);
                }
                return i.getImageData(0, 0, t.width, t.height);
            };
            var l = function(e) {
                var t = r(e.width, e.height);
                t.data.set(e.data);
                return t;
            };
            r = function(e, t) {
                return o.createImageData(e, t);
            };
            var c = function(e, t) {
                var n = i.createElement("canvas");
                n.width = e;
                n.height = t;
                return n;
            };
            this.filterImage = function(e, t, i) {
                var n = [ this.getPixels(t) ];
                for (var r = 2; r < arguments.length; r++) {
                    n.push(arguments[r]);
                }
                return e.apply(this, n);
            };
            var u = function(e) {
                var t = c(e.width, e.height);
                t.getContext("2d").putImageData(e, 0, 0);
                return t;
            };
            var f = function(e) {
                return identity(e);
            };
            var d = function(e, t) {
                switch (t) {
                  case 1:
                    break;

                  case 2:
                    e = et.horizontalFlip(e);
                    break;

                  case 3:
                    e = et.rotate180(e);
                    break;

                  case 4:
                    e = et.verticalFlip(e);
                    break;

                  case 5:
                    e = et.rotate90CounterClockwise(e);
                    e = et.verticalFlip(e);
                    break;

                  case 6:
                    e = et.rotate90Clockwise(e);
                    break;

                  case 7:
                    e = et.rotate90CounterClockwise(e);
                    e = et.horizontalFlip(e);
                    break;

                  case 8:
                    e = et.rotate90CounterClockwise(e);
                    break;

                  default:
                    break;
                }
                return e;
            };
            var h = function(e, t, i, n, r) {
                var a = p(e, t, i);
                if (r) {
                    a = g(a, r.x, r.y, r.width, r.height);
                }
                n = n || 1;
                a = d(a, n);
                return a;
            };
            var p = function(e, t, i) {
                var n = r(t, i);
                var a = e;
                if (n.data.set) {
                    n.data.set(a, 0);
                } else {
                    for (var o = 0; o < a.length; o++) n.data[o] = a[o];
                }
                return n;
            };
            var g = function(e, t, i, n, r) {
                var a = u(e);
                return a.getContext("2d").getImageData(t, i, n, r);
            };
            var m = function(e, t, i, r) {
                var a = function(e) {
                    var t = e.imageData, i = e.filters, r = e.startRow, a = e.endRow;
                    n.brightnessContrast(t, i["brightness"].value, i["contrast"].value);
                    n.sepia(t, i["sepia"].value);
                    n.grayscale(t, i["grayscale"].value);
                    n.saturation(t, i["saturation"].value);
                    n.hue(t, i["hue"].value);
                    i = null;
                    return {
                        imageData: t,
                        startRow: r,
                        endRow: a
                    };
                };
                var o = new Uint8ClampedArray(e.data.length);
                var s = 500;
                if (!!r) s = e.height;
                var l = Math.ceil(e.height / s);
                var c = new Array(l);
                for (var u = 0; u < l; u++) {
                    var f = u * s;
                    var d = (u + 1) * s;
                    if (d > e.height) d = e.height;
                    var h = g(e, 0, f, e.width, d - f);
                    c[u] = {
                        imageData: {
                            data: h.data,
                            width: h.width,
                            height: h.height
                        },
                        filters: t,
                        startRow: f,
                        endRow: d
                    };
                }
                var m = new Parallel(c, {
                    evalPath: PicsIO.config.BASE_URL + "/assets/js/lib/eval.js"
                });
                m.require(PicsIO.config.BASE_URL + "/assets/js/services/FiltersService.js?v=0.14.0");
                m.map(a).then(function(t) {
                    for (var n = 0; n < t.length; n++) {
                        var r = p(t[n].imageData.data, t[n].imageData.width, t[n].imageData.height);
                        var a = new Uint8ClampedArray(r.data);
                        var s = t[n].startRow === 0 ? 0 : t[n].startRow * r.width * 4;
                        o.set(a, s);
                    }
                    var r = p(o, e.width, e.height);
                    if (i) i(r);
                });
            };
        } else {
            r = function(t, i) {
                return {
                    width: t,
                    height: i,
                    data: e(t * i * 4)
                };
            };
        }
        var v = function(e) {
            var t = null;
            t = this[e[0].name].apply(this, e[0].args);
            for (var i = 1; i < e.length; i++) {
                var n = e[i];
                var r = n.args.slice(0);
                r.unshift(t);
                t = this[n.name].apply(this, r);
            }
            return t;
        };
        var y = function(t, i) {
            return {
                width: t,
                height: i,
                data: e(t * i * 4)
            };
        };
        this.identity = function(e, t) {
            var i = this.createImageData(e.width, e.height);
            var n = i.data;
            var r = e.data;
            for (var a = 0; a < r.length; a++) {
                n[a] = r[a];
            }
            return i;
        };
        this.luminance = function(e, t) {
            var i = this.createImageData(e.width, e.height);
            var n = i.data;
            var r = e.data;
            for (var a = 0; a < r.length; a += 4) {
                var o = r[a];
                var s = r[a + 1];
                var l = r[a + 2];
                var c = .2126 * o + .7152 * s + .0722 * l;
                n[a] = n[a + 1] = n[a + 2] = c;
                n[a + 3] = r[a + 3];
            }
            return i;
        };
        var b = function(e, t) {
            if (t === 0) return e;
            var i = e.data;
            var n = 1 - t;
            for (var r = 0; r < i.length; r += 4) {
                var a = i[r];
                var o = i[r + 1];
                var s = i[r + 2];
                var l = .3 * a + .59 * o + .11 * s;
                i[r] = i[r + 1] = i[r + 2] = l;
                i[r] = t * i[r] + n * a;
                i[r + 1] = t * i[r + 1] + n * o;
                i[r + 2] = t * i[r + 2] + n * s;
            }
            return e;
        };
        this.grayscaleAvg = function(e, t) {
            var i = this.createImageData(e.width, e.height);
            var n = i.data;
            var r = e.data;
            var a = 1 / 3;
            for (var o = 0; o < r.length; o += 4) {
                var s = r[o];
                var l = r[o + 1];
                var c = r[o + 2];
                var u = (s + l + c) * a;
                n[o] = n[o + 1] = n[o + 2] = u;
                n[o + 3] = r[o + 3];
            }
            return i;
        };
        var w = function(e, t) {
            if (t === 0) return e;
            var i = e.data;
            var n = 1 - t;
            for (var r = 0; r < i.length; r += 4) {
                var a = i[r];
                var o = i[r + 1];
                var s = i[r + 2];
                i[r] = a * .393 + o * .769 + s * .189;
                i[r + 1] = a * .349 + o * .686 + s * .168;
                i[r + 2] = a * .272 + o * .534 + s * .131;
                i[r + 3] = i[r + 3];
                i[r] = t * i[r] + n * a;
                i[r + 1] = t * i[r + 1] + n * o;
                i[r + 2] = t * i[r + 2] + n * s;
            }
            return e;
        };
        var C = function(e, t) {
            if (t === 0) return e;
            var i = e.data;
            var n = .3086;
            var r = .6094;
            var a = .082;
            var o = 1 - t;
            var s = o * n;
            var l = o * r;
            var c = o * a;
            for (var u = 0; u < i.length; u += 4) {
                var f = i[u];
                var d = i[u + 1];
                var h = i[u + 2];
                i[u] = f * (s + t) + d * l + h * c;
                i[u + 1] = f * s + d * (l + t) + h * c;
                i[u + 2] = f * s + d * l + h * (c + t);
            }
            return e;
        };
        var x = function(e, t) {
            if (t % 360 === 0) return e;
            t = t * Math.PI / 180;
            var i = e.data;
            var n = Math.cos(t);
            var r = Math.sin(t);
            var a = .213;
            var o = .715;
            var s = .072;
            var l = 1 - a;
            var c = 1 - o;
            var u = 1 - s;
            for (var f = 0; f < i.length; f += 4) {
                var d = i[f];
                var h = i[f + 1];
                var p = i[f + 2];
                i[f] = d * (a + n * (1 - a) + r * -a) + h * (a + n * -a + r * .143) + p * (a + n * -a + r * -(1 - a));
                i[f + 1] = d * (o + n * -o + r * -o) + h * (o + n * (1 - o) + r * .14) + p * (o + n * -o + r * o);
                i[f + 2] = d * (s + n * -s + r * (1 - s)) + h * (s + n * -s + r * -.283) + p * (s + n * (1 - s) + r * s);
            }
            return e;
        };
        this.threshold = function(e, t, i, n) {
            var r = this.createImageData(e.width, e.height);
            if (i === null) i = 255;
            if (n === null) n = 0;
            var a = e.data;
            var o = r.data;
            for (var s = 0; s < a.length; s += 4) {
                var l = a[s];
                var c = a[s + 1];
                var u = a[s + 2];
                var f = .3 * l + .59 * c + .11 * u >= t ? i : n;
                o[s] = o[s + 1] = o[s + 2] = f;
                o[s + 3] = a[s + 3];
            }
            return r;
        };
        var _ = function(e) {
            var t = r(e.width, e.height);
            var i = e.data;
            var n = t.data;
            for (var a = 0; a < i.length; a += 4) {
                n[a] = 255 - i[a];
                n[a + 1] = 255 - i[a + 1];
                n[a + 2] = 255 - i[a + 2];
                n[a + 3] = i[a + 3];
            }
            return t;
        };
        var S = function(e, t, i) {
            if (t === 0 && i === 0) return e;
            var n = P(t, i);
            return k(e, {
                r: n,
                g: n,
                b: n,
                a: E()
            });
        };
        var k = function(e, t) {
            var i = e.data;
            var n = t.r;
            var r = t.g;
            var a = t.b;
            var o = t.a;
            for (var s = 0; s < i.length; s += 4) {
                i[s] = n[i[s]];
                i[s + 1] = r[i[s + 1]];
                i[s + 2] = a[i[s + 2]];
                i[s + 3] = o[i[s + 3]];
            }
            return e;
        };
        var A = function(e) {
            var i = t(256);
            var n = [ 0, 0 ];
            for (var r = 0, a = 0; r < i.length; r++) {
                while (a < e.length && e[a][0] < r) {
                    n = e[a];
                    a++;
                }
                i[r] = n[1];
            }
            return i;
        };
        var E = function() {
            var e = t(256);
            for (var i = 0; i < e.length; i++) {
                e[i] = i;
            }
            return e;
        };
        var T = function() {
            var e = t(256);
            for (var i = 0; i < e.length; i++) {
                e[i] = 255 - i;
            }
            return e;
        };
        var P = function(e, i) {
            var n = t(256);
            var r = -128 * i + 128;
            var a = 255 * e;
            var o = r + a;
            for (var s = 0; s < n.length; s++) {
                var l = s * i + o;
                n[s] = l < 0 ? 0 : l > 255 ? 255 : l;
            }
            return n;
        };
        var I = function(e, t, i) {
            var n = Math.round(Math.sqrt(t.length));
            var a = Math.floor(n / 2);
            var o = e.data;
            var s = e.width;
            var l = e.height;
            var c = s;
            var u = l;
            var f = r(c, u);
            var d = f.data;
            var h = i ? 1 : 0;
            for (var p = 0; p < u; p++) {
                for (var g = 0; g < c; g++) {
                    var m = p;
                    var v = g;
                    var y = (p * c + g) * 4;
                    var b = 0, w = 0, C = 0, x = 0;
                    for (var _ = 0; _ < n; _++) {
                        for (var S = 0; S < n; S++) {
                            var k = Math.min(l - 1, Math.max(0, m + _ - a));
                            var A = Math.min(s - 1, Math.max(0, v + S - a));
                            var E = (k * s + A) * 4;
                            var T = t[_ * n + S];
                            b += o[E] * T;
                            w += o[E + 1] * T;
                            C += o[E + 2] * T;
                            x += o[E + 3] * T;
                        }
                    }
                    d[y] = b;
                    d[y + 1] = w;
                    d[y + 2] = C;
                    d[y + 3] = x + h * (255 - x);
                }
            }
            return f;
        };
        this.verticalConvolve = function(e, t, i) {
            var n = t.length;
            var r = Math.floor(n / 2);
            var a = e.data;
            var o = e.width;
            var s = e.height;
            var l = o;
            var c = s;
            var u = this.createImageData(l, c);
            var f = u.data;
            var d = i ? 1 : 0;
            for (var h = 0; h < c; h++) {
                for (var p = 0; p < l; p++) {
                    var g = h;
                    var m = p;
                    var v = (h * l + p) * 4;
                    var y = 0, b = 0, w = 0, C = 0;
                    for (var x = 0; x < n; x++) {
                        var _ = Math.min(s - 1, Math.max(0, g + x - r));
                        var S = m;
                        var k = (_ * o + S) * 4;
                        var A = t[x];
                        y += a[k] * A;
                        b += a[k + 1] * A;
                        w += a[k + 2] * A;
                        C += a[k + 3] * A;
                    }
                    f[v] = y;
                    f[v + 1] = b;
                    f[v + 2] = w;
                    f[v + 3] = C + d * (255 - C);
                }
            }
            return u;
        };
        this.horizontalConvolve = function(e, t, i) {
            var n = t.length;
            var r = Math.floor(n / 2);
            var a = e.data;
            var o = e.width;
            var s = e.height;
            var l = o;
            var c = s;
            var u = this.createImageData(l, c);
            var f = u.data;
            var d = i ? 1 : 0;
            for (var h = 0; h < c; h++) {
                for (var p = 0; p < l; p++) {
                    var g = h;
                    var m = p;
                    var v = (h * l + p) * 4;
                    var y = 0, b = 0, w = 0, C = 0;
                    for (var x = 0; x < n; x++) {
                        var _ = g;
                        var S = Math.min(o - 1, Math.max(0, m + x - r));
                        var k = (_ * o + S) * 4;
                        var A = t[x];
                        y += a[k] * A;
                        b += a[k + 1] * A;
                        w += a[k + 2] * A;
                        C += a[k + 3] * A;
                    }
                    f[v] = y;
                    f[v + 1] = b;
                    f[v + 2] = w;
                    f[v + 3] = C + d * (255 - C);
                }
            }
            return u;
        };
        this.separableConvolve = function(e, t, i, n) {
            return this.horizontalConvolve(this.verticalConvolveFloat32(e, i, n), t, n);
        };
        this.convolveFloat32 = function(e, t, i) {
            var n = Math.round(Math.sqrt(t.length));
            var r = Math.floor(n / 2);
            var a = e.data;
            var o = e.width;
            var s = e.height;
            var l = o;
            var c = s;
            var u = this.createImageDataFloat32(l, c);
            var f = u.data;
            var d = i ? 1 : 0;
            for (var h = 0; h < c; h++) {
                for (var p = 0; p < l; p++) {
                    var g = h;
                    var m = p;
                    var v = (h * l + p) * 4;
                    var y = 0, b = 0, w = 0, C = 0;
                    for (var x = 0; x < n; x++) {
                        for (var _ = 0; _ < n; _++) {
                            var S = Math.min(s - 1, Math.max(0, g + x - r));
                            var k = Math.min(o - 1, Math.max(0, m + _ - r));
                            var A = (S * o + k) * 4;
                            var E = t[x * n + _];
                            y += a[A] * E;
                            b += a[A + 1] * E;
                            w += a[A + 2] * E;
                            C += a[A + 3] * E;
                        }
                    }
                    f[v] = y;
                    f[v + 1] = b;
                    f[v + 2] = w;
                    f[v + 3] = C + d * (255 - C);
                }
            }
            return u;
        };
        var O = function(e, t, i) {
            var n = t.length;
            var r = Math.floor(n / 2);
            var a = e.data;
            var o = e.width;
            var s = e.height;
            var l = o;
            var c = s;
            var u = y(l, c);
            var f = u.data;
            var d = i ? 1 : 0;
            for (var h = 0; h < c; h++) {
                for (var p = 0; p < l; p++) {
                    var g = h;
                    var m = p;
                    var v = (h * l + p) * 4;
                    var b = 0, w = 0, C = 0, x = 0;
                    for (var _ = 0; _ < n; _++) {
                        var S = Math.min(s - 1, Math.max(0, g + _ - r));
                        var k = m;
                        var A = (S * o + k) * 4;
                        var E = t[_];
                        b += a[A] * E;
                        w += a[A + 1] * E;
                        C += a[A + 2] * E;
                        x += a[A + 3] * E;
                    }
                    f[v] = b;
                    f[v + 1] = w;
                    f[v + 2] = C;
                    f[v + 3] = x + d * (255 - x);
                }
            }
            return u;
        };
        var D = function(e, t, i) {
            var n = t.length;
            var r = Math.floor(n / 2);
            var a = e.data;
            var o = e.width;
            var s = e.height;
            var l = o;
            var c = s;
            var u = y(l, c);
            var f = u.data;
            var d = i ? 1 : 0;
            for (var h = 0; h < c; h++) {
                for (var p = 0; p < l; p++) {
                    var g = h;
                    var m = p;
                    var v = (h * l + p) * 4;
                    var b = 0, w = 0, C = 0, x = 0;
                    for (var _ = 0; _ < n; _++) {
                        var S = g;
                        var k = Math.min(o - 1, Math.max(0, m + _ - r));
                        var A = (S * o + k) * 4;
                        var E = t[_];
                        b += a[A] * E;
                        w += a[A + 1] * E;
                        C += a[A + 2] * E;
                        x += a[A + 3] * E;
                    }
                    f[v] = b;
                    f[v + 1] = w;
                    f[v + 2] = C;
                    f[v + 3] = x + d * (255 - x);
                }
            }
            return u;
        };
        var R = function(e, t, i, n) {
            return D(O(e, i, n), t, n);
        };
        this.gaussianBlur = function(t, i) {
            i = Math.abs(i);
            if (i <= 1) return this.identity(t);
            var n = i / 2;
            var r = Math.ceil(i) + (1 - Math.ceil(i) % 2);
            var a = e(r);
            var o = (n + .5) / 3;
            var s = o * o;
            var l = 1 / Math.sqrt(2 * Math.PI * s);
            var c = -1 / (2 * o * o);
            var u = 0;
            var f = Math.floor(r / 2);
            var d = 0;
            for (d = 0; d < r; d++) {
                var h = d - f;
                var p = l * Math.exp(h * h * c);
                a[d] = p;
                u += p;
            }
            for (d = 0; d < a.length; d++) {
                a[d] /= u;
            }
            return this.separableConvolve(t, a, a, false);
        };
        var L = e([ -1, -1, -1, -1, 8, -1, -1, -1, -1 ]);
        var F = function(e) {
            return I(e, L, true);
        };
        var M = e([ -1, -1, -1, -1, 9, -1, -1, -1, -1 ]);
        var N = function(e, t) {
            if (t === 0) return e;
            var i = [];
            i[0] = this.sharpnessKernel[0] * t;
            i[1] = this.sharpnessKernel[1] * t;
            i[2] = this.sharpnessKernel[2] * t;
            i[3] = this.sharpnessKernel[3] * t;
            i[4] = this.sharpnessKernel[4] = -i[0] * 8 + t;
            i[5] = this.sharpnessKernel[5] * t;
            i[6] = this.sharpnessKernel[6] * t;
            i[7] = this.sharpnessKernel[7] * t;
            i[8] = this.sharpnessKernel[8] * t;
            return I(e, i, true);
        };
        var B = e([ -1, 0, 1 ]);
        var j = e([ 1, 2, 1 ]);
        var U = function(e) {
            return R(e, B, j);
        };
        var z = function(e) {
            return R(e, j, B);
        };
        this.sobelVectors = function(t) {
            var i = this.sobelVerticalGradient(t);
            var n = this.sobelHorizontalGradient(t);
            var r = {
                width: i.width,
                height: i.height,
                data: e(i.width * i.height * 8)
            };
            var a = i.data;
            var o = n.data;
            var s = r.data;
            for (var l = 0, c = 0; l < s.length; l += 2, c++) {
                s[l] = o[c];
                s[l + 1] = a[c];
            }
            return r;
        };
        var q = function(e, t) {
            t = t || .5;
            e = b(e, t);
            var i = U(e);
            var n = z(e);
            var a = r(i.width, i.height);
            for (var o = 0; o < a.data.length; o += 4) {
                var s = Math.abs(i.data[o]);
                a.data[o] = s;
                var l = Math.abs(n.data[o]);
                a.data[o + 1] = l;
                a.data[o + 2] = (s + l) / 4;
                a.data[o + 3] = 255;
            }
            return a;
        };
        var W = function(e, t, i, n) {
            var r = Math.floor(t);
            var a = Math.ceil(t);
            var o = Math.floor(i);
            var s = Math.ceil(i);
            var l = (r + e.width * o) * 4;
            var c = (a + e.width * o) * 4;
            var u = (r + e.width * s) * 4;
            var f = (a + e.width * s) * 4;
            var d = t - r + (i - o);
            var h = a - t + (i - o);
            var p = t - r + (s - i);
            var g = a - t + (s - i);
            var m = 1 / (g + p + h + d);
            g *= m;
            p *= m;
            h *= m;
            d *= m;
            var v = e.data;
            n[0] = v[l] * g + v[c] * p + v[u] * h + v[f] * d;
            n[1] = v[l + 1] * g + v[c + 1] * p + v[u + 1] * h + v[f + 1] * d;
            n[2] = v[l + 2] * g + v[c + 2] * p + v[u + 2] * h + v[f + 2] * d;
            n[3] = v[l + 3] * g + v[c + 3] * p + v[u + 3] * h + v[f + 3] * d;
            return n;
        };
        var H = function(e, t, i) {
            if (!t || t === null) t = .5;
            if (!i || i === null) i = t;
            var n = r(e.width, e.height);
            var a = n.data;
            var o = e.data;
            var s = r(1, 1).data;
            for (var l = 0; l < n.height; l++) {
                var c = -Math.sin(l / (n.height - 1) * Math.PI * 2);
                var u = l + c * i * n.height / 4;
                u = Math.max(Math.min(u, n.height - 1), 0);
                for (var f = 0; f < n.width; f++) {
                    var d = -Math.sin(f / (n.width - 1) * Math.PI * 2);
                    var h = f + d * t * n.width / 4;
                    h = Math.max(Math.min(h, n.width - 1), 0);
                    var p = W(e, h, u, s);
                    var g = (l * n.width + f) * 4;
                    a[g] = p[0];
                    a[g + 1] = p[1];
                    a[g + 2] = p[2];
                    a[g + 3] = p[3];
                }
            }
            return n;
        };
        this.darkenBlend = function(e, t) {
            var i = this.createImageData(e.width, e.height);
            var n = e.data;
            var r = t.data;
            var a = i.data;
            var o = 1 / 255;
            for (var s = 0; s < n.length; s += 4) {
                a[s] = n[s] < r[s] ? n[s] : r[s];
                a[s + 1] = n[s + 1] < r[s + 1] ? n[s + 1] : r[s + 1];
                a[s + 2] = n[s + 2] < r[s + 2] ? n[s + 2] : r[s + 2];
                a[s + 3] = n[s + 3] + (255 - n[s + 3]) * r[s + 3] * o;
            }
            return i;
        };
        this.lightenBlend = function(e, t) {
            var i = this.createImageData(e.width, e.height);
            var n = e.data;
            var r = t.data;
            var a = i.data;
            var o = 1 / 255;
            for (var s = 0; s < n.length; s += 4) {
                a[s] = n[s] > r[s] ? n[s] : r[s];
                a[s + 1] = n[s + 1] > r[s + 1] ? n[s + 1] : r[s + 1];
                a[s + 2] = n[s + 2] > r[s + 2] ? n[s + 2] : r[s + 2];
                a[s + 3] = n[s + 3] + (255 - n[s + 3]) * r[s + 3] * o;
            }
            return i;
        };
        this.multiplyBlend = function(e, t) {
            var i = this.createImageData(e.width, e.height);
            var n = e.data;
            var r = t.data;
            var a = i.data;
            var o = 1 / 255;
            for (var s = 0; s < n.length; s += 4) {
                a[s] = n[s] * r[s] * o;
                a[s + 1] = n[s + 1] * r[s + 1] * o;
                a[s + 2] = n[s + 2] * r[s + 2] * o;
                a[s + 3] = n[s + 3] + (255 - n[s + 3]) * r[s + 3] * o;
            }
            return i;
        };
        this.screenBlend = function(e, t) {
            var i = this.createImageData(e.width, e.height);
            var n = e.data;
            var r = t.data;
            var a = i.data;
            var o = 1 / 255;
            for (var s = 0; s < n.length; s += 4) {
                a[s] = n[s] + r[s] - n[s] * r[s] * o;
                a[s + 1] = n[s + 1] + r[s + 1] - n[s + 1] * r[s + 1] * o;
                a[s + 2] = n[s + 2] + r[s + 2] - n[s + 2] * r[s + 2] * o;
                a[s + 3] = n[s + 3] + (255 - n[s + 3]) * r[s + 3] * o;
            }
            return i;
        };
        this.addBlend = function(e, t) {
            var i = this.createImageData(e.width, e.height);
            var n = e.data;
            var r = t.data;
            var a = i.data;
            var o = 1 / 255;
            for (var s = 0; s < n.length; s += 4) {
                a[s] = n[s] + r[s];
                a[s + 1] = n[s + 1] + r[s + 1];
                a[s + 2] = n[s + 2] + r[s + 2];
                a[s + 3] = n[s + 3] + (255 - n[s + 3]) * r[s + 3] * o;
            }
            return i;
        };
        this.subBlend = function(e, t) {
            var i = this.createImageData(e.width, e.height);
            var n = e.data;
            var r = t.data;
            var a = i.data;
            var o = 1 / 255;
            for (var s = 0; s < n.length; s += 4) {
                a[s] = n[s] + r[s] - 255;
                a[s + 1] = n[s + 1] + r[s + 1] - 255;
                a[s + 2] = n[s + 2] + r[s + 2] - 255;
                a[s + 3] = n[s + 3] + (255 - n[s + 3]) * r[s + 3] * o;
            }
            return i;
        };
        this.differenceBlend = function(e, t) {
            var i = this.createImageData(e.width, e.height);
            var n = e.data;
            var r = t.data;
            var a = i.data;
            var o = 1 / 255;
            for (var s = 0; s < n.length; s += 4) {
                a[s] = Math.abs(n[s] - r[s]);
                a[s + 1] = Math.abs(n[s + 1] - r[s + 1]);
                a[s + 2] = Math.abs(n[s + 2] - r[s + 2]);
                a[s + 3] = n[s + 3] + (255 - n[s + 3]) * r[s + 3] * o;
            }
            return i;
        };
        var G = function(e) {
            var t = e.data;
            var i = e.width;
            var n = e.height;
            var a = i;
            var o = n;
            var s = r(a, o);
            var l = s.data;
            for (var c = 0; c < o; c++) {
                for (var u = 0; u < a; u++) {
                    var f = c;
                    var d = u;
                    var h = (c * a + u) * 4;
                    var p = (f * i + d) * 4;
                    var g = 0;
                    if (t[p] === 0) {
                        if (t[(f * i + Math.max(0, d - 1)) * 4] === 0 && t[(Math.max(0, f - 1) * i + d) * 4] === 0) {
                            g = 255;
                        }
                    } else {
                        g = 255;
                    }
                    l[h] = g;
                    l[h + 1] = g;
                    l[h + 2] = g;
                    l[h + 3] = 255;
                }
            }
            return s;
        };
        var V = function(e, t) {
            if (!t) t = "lefttoright";
            console.time("clusterize");
            var i = r(e.width, e.height);
            var n = i.data;
            var a = e.data;
            var o = e.width;
            var s = e.height;
            var l = 10;
            var c = 20;
            var u = 220;
            var f = new Array(l);
            var d = new Array(l);
            for (var h = 0; h < l; h++) {
                f[h] = {
                    r: 0,
                    g: 0,
                    b: 0
                };
            }
            var p = 0;
            var g = 4;
            var m = a.length;
            if (t === "righttoleft") {
                p = a.length;
                g = -g;
                m = 0;
            }
            var v;
            if (t === "lefttoright") {
                v = function(e) {
                    return e < m;
                };
            } else {
                v = function(e) {
                    return e > m;
                };
            }
            while (v(p)) {
                var y = a[p];
                var b = a[p + 1];
                var w = a[p + 2];
                for (var h = 0; h < l; h++) {
                    d[h] = [ y - f[h].r, b - f[h].g, w - f[h].b ].average();
                }
                if (d.some(function(e) {
                    return e > c;
                })) {
                    y = b = w = 255;
                } else {
                    y = b = w = 0;
                }
                for (var h = 0; h < l; h++) {
                    f[h].r = a[p - 4 * h];
                    f[h].g = a[p + 1 - 4 * h];
                    f[h].b = a[p + 2 - 4 * h];
                }
                n[p] = y;
                n[p + 1] = b;
                n[p + 2] = w;
                p += g;
            }
            console.timeEnd("clusterize");
            return i;
        };
        var Y = function(e, t) {
            if (!t) t = 5;
            console.time("posterize");
            var i = r(e.width, e.height);
            var n = i.data;
            var a = e.data;
            var o = e.width;
            var s = e.height;
            var l = {};
            var c = parseInt(256 / t);
            for (var u = 0; u < 256; u++) {
                l[u] = ~~(u / c) * c;
            }
            var f = function(e, t, i) {
                var n = l[e], r = l[t], a = l[i];
                return {
                    r: n,
                    g: r,
                    b: a
                };
            };
            for (var d = 0; d < s; d++) {
                for (var h = 0; h < o; h++) {
                    var u = (d * o + h) * 4;
                    var p = a[u];
                    var g = a[u + 1];
                    var m = a[u + 2];
                    var v = f(p, g, m);
                    n[u] = v.r;
                    n[u + 1] = v.g;
                    n[u + 2] = v.b;
                    n[u + 3] = 255;
                }
            }
            console.timeEnd("posterize");
            return i;
        };
        var X = function(e, t) {
            if (typeof t === "string") {
                t = PaletteService.getPalette(t || "flower");
            }
            console.time("palettize");
            var i = r(e.width, e.height);
            var n = i.data;
            var a = e.data;
            var o = e.width;
            var s = e.height;
            for (var l = 0; l < s; l++) {
                for (var c = 0; c < o; c++) {
                    var u = (l * o + c) * 4;
                    var f = a[u];
                    var d = a[u + 1];
                    var h = a[u + 2];
                    var p = PaletteService.getClosestPaletteColor(t, f, d, h);
                    n[u] = p.r;
                    n[u + 1] = p.g;
                    n[u + 2] = p.b;
                    n[u + 3] = 255;
                }
            }
            console.timeEnd("palettize");
            return i;
        };
        var J = e([ 0, -1, 0, -1, 5, -1, 0, -1, 0 ]);
        var K = e([ -1, -1, -1, -1, 9, -1, -1, -1, -1 ]);
        var Q = e([ 1, -2, 1, -2, 5, -2, 1, -2, 1 ]);
        var Z = function(e, t, i) {
            i = i || true;
            t = t || .5;
            console.time("highpass");
            var n = r(e.width, e.height);
            var a = n.data;
            var o = e.data;
            var s = e.width;
            var l = e.height;
            a[0] = o[0];
            a[1] = o[1];
            a[2] = o[2];
            a[3] = 255;
            for (var c = 4; c < o.length; c = c + 4) {
                var u = t * (a[c - 4] + o[c] - o[c - 4]);
                var f = t * (a[c - 3] + o[c + 1] - o[c - 3]);
                var d = t * (a[c - 2] + o[c + 2] - o[c - 2]);
                if (i) {
                    a[c] = a[c + 1] = a[c + 2] = 127 - (u + f + d) / 3;
                } else {
                    a[c] = u;
                    a[c + 1] = f;
                    a[c + 2] = d;
                }
                a[c + 3] = 255;
            }
            console.timeEnd("highpass");
            return n;
        };
        var et = {
            rotate90Clockwise: function(e) {
                var t = i.createElement("canvas"), n = t.getContext("2d");
                t.width = e.width;
                t.height = e.height;
                n.putImageData(e, 0, 0);
                var r = i.createElement("canvas"), a = r.getContext("2d"), o = Math.PI / 180;
                r.width = e.height;
                r.height = e.width;
                a.translate(r.width / 2, r.height / 2);
                a.rotate(90 * o);
                a.drawImage(t, -r.height / 2, -r.width / 2);
                t = null;
                return a.getImageData(0, 0, r.width, r.height);
            },
            rotate90CounterClockwise: function(e) {
                var t = i.createElement("canvas"), n = t.getContext("2d");
                t.width = e.width;
                t.height = e.height;
                n.putImageData(e, 0, 0);
                var r = i.createElement("canvas"), a = r.getContext("2d"), o = Math.PI / 180;
                r.width = e.height;
                r.height = e.width;
                a.translate(r.width / 2, r.height / 2);
                a.rotate(-90 * o);
                a.drawImage(t, -r.height / 2, -r.width / 2);
                t = null;
                return a.getImageData(0, 0, r.width, r.height);
            },
            rotate180: function(e) {
                var t = $("<canvas>")[0], i = t.getContext("2d");
                var n = e;
                var r = i.createImageData(n.width, n.height);
                var a = n.width;
                var o = n.height;
                var s = o - 1;
                var l = 0;
                while (s > -1) {
                    var c = a - 1;
                    while (c > -1) {
                        var u = s * 4 * a + c * 4;
                        r.data[l++] = n.data[u];
                        r.data[l++] = n.data[u + 1];
                        r.data[l++] = n.data[u + 2];
                        r.data[l++] = n.data[u + 3];
                        c--;
                    }
                    s--;
                }
                return r;
            },
            horizontalFlip: function(e) {
                var t = e.width;
                var i = e.height;
                var n = t / 2;
                var r = e.data;
                for (var a = 0; a < i; a++) {
                    for (var o = 0; o < n; o++) {
                        var s = (a * t + o) * 4;
                        var l = (a * t + (t - o - 1)) * 4;
                        var c = r[s];
                        var u = r[s + 1];
                        var f = r[s + 2];
                        var d = r[s + 3];
                        r[s] = r[l];
                        r[s + 1] = r[l + 1];
                        r[s + 2] = r[l + 2];
                        r[s + 3] = r[l + 3];
                        r[l] = c;
                        r[l + 1] = u;
                        r[l + 2] = f;
                        r[l + 3] = d;
                    }
                }
                return e;
            },
            verticalFlip: function(e) {
                var t = e.width;
                var i = e.height;
                var n = e.data;
                var r = t * 4;
                var a = i / 2;
                for (var o = 0; o < a; o++) {
                    var s = o * r;
                    var l = (i - o) * r;
                    for (var c = 0; c < r; c++) {
                        var u = n[s + c];
                        n[s + c] = n[l + c];
                        n[l + c] = u;
                    }
                }
                return e;
            }
        };
        var tt = function() {
            var e = Array.prototype.slice.call(arguments, 0, -1);
            var t = arguments[arguments.length - 1];
            var n = h.apply(this, e);
            var r = i.createElement("canvas");
            var a = r.getContext("2d");
            r.width = n.width;
            r.height = n.height;
            a.putImageData(n, 0, 0);
            r.toBlob(function(e) {
                t && t({
                    blob: e
                });
            });
        };
        return {
            getImageData: h,
            getBlob: tt,
            toCanvas: u,
            createImageData: r,
            copyImageData: l,
            getCanvas: c,
            getImageDataCropped: g,
            createAndFillImageData: p,
            brightnessContrast: S,
            sepia: w,
            saturation: C,
            grayscale: b,
            hue: x,
            erode: G,
            sobel: q,
            distortSine: H,
            laplace: F,
            invert: _,
            clusterize: V,
            posterize: Y,
            palettize: X,
            transformation: et,
            highpass: Z,
            applyFiltersToImageData: m
        };
    };
    if (typeof define === "function") {
        define("FiltersService", [], function() {
            return new n();
        });
    } else {
        if (typeof e.FiltersService === "undefined") {
            e.FiltersService = new n();
        }
    }
})(this);

(function(e, t) {
    var i = function() {
        var e = function t() {
            this.buffer = [];
            this.current_buffer = [];
            this.size = 0;
            this.mLeft = 0;
            this.off = 0;
            this.stuffed = 0;
        };
        e.prototype.init = function i(e, t, n) {
            this.buffer = new Uint8Array(e.buffer.slice(t, e.byteLength));
            this.current_buffer = new Uint8Array(16);
            this.size = n + 4;
            this.off = 0;
            this.mLeft = 0;
            this.stuffed = 0;
            this.fill();
        };
        e.prototype.getOffset = function n() {
            return this.off - (this.mLeft >> 3) + this.stuffed;
        };
        e.prototype.getOffsetMSB = function r() {
            return this.off - (this.mLeft >> 3);
        };
        e.prototype.fill = function a() {
            if (this.mLeft >= 24) return;
            var e = this.mLeft;
            var t = this.current_buffer;
            var i = this.buffer;
            var n = this.off;
            var r = this.stuffed;
            var a = this.size;
            t[12] = t[0];
            t[13] = t[1];
            t[14] = t[2];
            t[15] = t[3];
            for (var o = 0; o < 12; o++) {
                var s = i[n++] | 0;
                if (s == 255) {
                    if (i[n]) {
                        s = 0 | 0;
                        n--;
                        r++;
                    } else {
                        n++;
                    }
                }
                t[11 - o] = s | 0;
            }
            e += 96;
            this.mLeft = e;
            this.current_buffer = t;
            this.buffer = i;
            this.off = n;
            this.stuffed = r;
        };
        e.prototype.peekBitsNoFill = function o(e) {
            var t = this.mLeft - e | 0;
            var i = t >> 3 | 0;
            var n = this.current_buffer;
            var r = (n[i + 3] << 24) + (n[i + 2] << 16) + (n[i + 1] << 8) + n[i];
            r >>= t & 7;
            r = r & (1 << e) - 1;
            return r | 0;
        };
        e.prototype.peek14BitsNoFill = function s() {
            var e = this.mLeft - 14 | 0;
            var t = e >> 3 | 0;
            var i = this.current_buffer;
            var n = (i[t + 3] << 24) + (i[t + 2] << 16) + (i[t + 1] << 8) + i[t];
            n >>= e & 7;
            n = n & 16383;
            return n | 0;
        };
        e.prototype.skipBitsNoFill = function l(e) {
            this.mLeft -= e;
        };
        e.prototype.getBitsNoFill = function c(e) {
            var t = this.peekBitsNoFill(e);
            this.mLeft -= e;
            return t | 0;
        };
        e.prototype.getBitNoFill = function u() {
            this.mLeft--;
            var e = this.current_buffer[this.mLeft >> 3] >> (this.mLeft & 7) & 1;
            return e | 0;
        };
        return e;
    };
    if (typeof define === "function") {
        define("BitPumpJpeg", [], function() {
            return i();
        });
    } else {
        if (typeof e.BitPumpJpeg === "undefined") {
            e.BitPumpJpeg = i();
        }
    }
})(this);

(function(e, t) {
    var i = function(e) {
        var t = {
            M_STUFF: 0,
            M_SOF0: 192,
            M_SOF1: 193,
            M_SOF2: 194,
            M_SOF3: 195,
            M_SOF5: 197,
            M_SOF6: 198,
            M_SOF7: 199,
            M_JPG: 200,
            M_SOF9: 201,
            M_SOF10: 202,
            M_SOF11: 203,
            M_SOF13: 205,
            M_SOF14: 206,
            M_SOF15: 207,
            M_DHT: 196,
            M_DAC: 204,
            M_RST0: 208,
            M_RST1: 209,
            M_RST2: 210,
            M_RST3: 211,
            M_RST4: 212,
            M_RST5: 213,
            M_RST6: 214,
            M_RST7: 215,
            M_SOI: 216,
            M_EOI: 217,
            M_SOS: 218,
            M_DQT: 219,
            M_DNL: 220,
            M_DRI: 221,
            M_DHP: 222,
            M_EXP: 223,
            M_APP0: 224,
            M_APP1: 225,
            M_APP2: 226,
            M_APP3: 227,
            M_APP4: 228,
            M_APP5: 229,
            M_APP6: 230,
            M_APP7: 231,
            M_APP8: 232,
            M_APP9: 233,
            M_APP10: 234,
            M_APP11: 235,
            M_APP12: 236,
            M_APP13: 237,
            M_APP14: 238,
            M_APP15: 239,
            M_JPG0: 240,
            M_JPG13: 253,
            M_COM: 254,
            M_TEM: 1,
            M_FILL: 255
        };
        var i = function(e, t, i) {
            var n;
            var r = function(e) {
                var t = [];
                var i = t.slice;
                i.call(arguments, 1).forEach(function(t) {
                    for (var i in t) e[i] = t[i];
                });
                return e;
            };
            if (t && hasOwnProperty.call(t, "constructor")) {
                n = t.constructor;
            } else {
                n = function() {
                    return e.apply(e, arguments);
                };
            }
            r(n, e, i);
            var a = function() {
                e.constructor = n;
            };
            a.prototype = e.prototype;
            n.prototype = new a();
            if (t) {
                r(n.prototype, t);
            }
            n.__super__ = e.prototype;
            return n;
        };
        var n = i(function() {}, {
            base: function() {
                return this.__proto__.__proto__;
            },
            init: function r(e, t, i, n, a) {
                this.bitMask = [ 4294967295, 2147483647, 1073741823, 536870911, 268435455, 134217727, 67108863, 33554431, 16777215, 8388607, 4194303, 2097151, 1048575, 524287, 262143, 131071, 65535, 32767, 16383, 8191, 4095, 2047, 1023, 511, 255, 127, 63, 31, 15, 7, 3, 1 ];
                this.sof = {};
                this.pred = 0;
                this.Pt = 0;
                this.input = 0;
                this.offX = 0;
                this.offY = 0;
                this.skipX = 0;
                this.skipY = 0;
                this.huff = [];
                this.slicesW = [];
                this.bits = {};
                this.rawdata = new DataView(e);
                this.rawdataOffset = 0;
                this.rawdataSize = 0;
                this.dim = i || {
                    x: 0,
                    y: 0
                };
                this.uncropped_dim = t || {
                    x: 0,
                    y: 0
                };
                this.cpp = n;
                this.pitch = a;
                this.data = new Uint16Array(this.uncropped_dim.x * this.uncropped_dim.y);
                this.skipX = this.skipY = 0;
                for (var o = 0; o < 4; o++) {
                    this.huff.push({});
                    this.huff[o].initialized = false;
                    this.huff[o].bits = new Uint16Array(255);
                    this.huff[o].huffval = new Uint16Array(255);
                    this.huff[o].valptr = new Uint8Array(255);
                    this.huff[o].mincode = new Uint32Array(255);
                    this.huff[o].maxcode = new Uint32Array(255);
                    this.huff[o].ehufco = new Uint16Array(255);
                    this.huff[o].ehufsi = new Uint16Array(255);
                    this.huff[o].numbits = new Uint16Array(255);
                    this.huff[o].value = new Uint32Array(65535);
                    this.huff[o].bigTable = new Uint32Array(16384);
                }
                this.slicesW = [];
                this.mUseBigtable = true;
            },
            getByte: function a() {
                return new Uint8Array(this.rawdata.buffer.slice(this.rawdataOffset, this.rawdataOffset += 1))[0];
            },
            ungetByte: function o() {
                this.rawdataOffset--;
            },
            getShort: function s() {
                return this.get2Bytes();
            },
            get2Bytes: function l() {
                var e = new Uint8Array(this.rawdata.buffer.slice(this.rawdataOffset, this.rawdataOffset += 2));
                return e[0] << 8 | e[1];
            },
            skipBytes: function c(e) {
                this.rawdataOffset += e;
            },
            skipToMarker: function u() {
                while (this.getByte() != 255) {}
                this.ungetByte();
            },
            getRemainSize: function f() {
                return this.rawdataSize - this.rawdataOffset;
            },
            getNextMarker: function d(e) {
                if (!e) {
                    var i = this.getByte();
                    if (i != t.M_FILL) {
                        throw "LJpegDecompressor::getNextMarker: (Noskip) Expected marker not found. Propably corrupt file.";
                    }
                    var n = this.getByte();
                    if (t.M_FILL == n || t.M_STUFF == n) {
                        throw "LJpegDecompressor::getNextMarker: (Noskip) Expected marker, but found stuffed 00 or ff.";
                    }
                    return n;
                }
                this.skipToMarker();
                var i = this.getByte();
                return this.getByte();
            },
            getSOF: function h(e, i) {
                if (false) {
                    throw "LJpegDecompressor::getSOF: Start offset plus size is longer than file. Truncated file.";
                }
                this.rawdataOffset = 0;
                var n = this.getNextMarker(false);
                if (n != t.M_SOI) {
                    throw "LJpegDecompressor::getSOF: Image did not start with SOI. Probably not an LJPEG";
                }
                while (true) {
                    n = this.getNextMarker(true);
                    if (t.M_SOF3 == n) {
                        this.parseSOF();
                        return this.sof;
                    }
                    if (t.M_EOI == n) {
                        throw "LJpegDecompressor: Could not locate Start of Frame.";
                        return;
                    }
                }
            },
            parseSOF: function p() {
                var e = this.get2Bytes();
                var t = {};
                t.prec = this.getByte();
                t.h = this.get2Bytes();
                t.w = this.get2Bytes();
                t.cps = this.getByte();
                if (t.prec > 16) {
                    throw "LJpegDecompressor: More than 16 bits per channel is not supported.";
                }
                if (t.cps > 4 || t.cps < 2) {
                    throw "LJpegDecompressor: Only from 2 to 4 components are supported.";
                }
                if (e != t.cps * 3 + 8) {
                    throw "LJpegDecompressor: Header size mismatch.";
                }
                var i = new Array();
                for (var n = 0; n < t.cps; n++) {
                    var r = {};
                    r["componentId"] = this.getByte();
                    r["componentIndex"] = n;
                    var a = this.getByte();
                    r["superH"] = a >> 4 & 15;
                    r["superV"] = a & 15;
                    i.push(r);
                    if (this.getByte() != 0) {
                        throw "LJpegDecompressor: Quantized components not supported.";
                    }
                }
                t.compInfo = i;
                t.initialized = true;
                this.sof = t;
            },
            startDecoder: function g(e, i, n, r) {
                if (false) {
                    throw "LJpegDecompressor::startDecoder: Start offset plus size is longer than file. Truncated file.";
                }
                if (n >= this.dim.x) {
                    throw "LJpegDecompressor::startDecoder: X offset outside of image";
                }
                if (r >= this.dim.y) {
                    throw "LJpegDecompressor::startDecoder: Y offset outside of image";
                }
                this.offX = n;
                this.offY = r;
                this.rawdataOffset = 0;
                if (this.getNextMarker(false) != t.M_SOI) {
                    throw "LJpegDecompressor::startDecoder: Image did not start with SOI. Probably not an LJPEG";
                }
                var a = true;
                while (a) {
                    var o = this.getNextMarker(true);
                    switch (o) {
                      case t.M_SOS:
                        this.parseSOS();
                        break;

                      case t.M_EOI:
                        a = false;
                        break;

                      case t.M_DHT:
                        this.parseDHT();
                        break;

                      case t.M_DQT:
                        throw "LJpegDecompressor: Not a valid RAW file.";
                        break;

                      case t.M_DRI:
                        break;

                      case t.M_APP0:
                        break;

                      case t.M_SOF3:
                        this.parseSOF();
                        break;

                      default:
                        break;
                    }
                }
            },
            parseDHT: function m() {
                var e = this.get2Bytes() - 2;
                while (e) {
                    var t = this.getByte();
                    var i = t >> 4;
                    if (i != 0) {
                        throw "LJpegDecompressor::parseDHT: Unsupported Table class.";
                    }
                    var n = t & 15;
                    if (n > 3) {
                        throw "LJpegDecompressor::parseDHT: Invalid huffman table destination id.";
                    }
                    var r = 0;
                    var a = this.huff[n];
                    if (a.initialized) {
                        throw "LJpegDecompressor::parseDHT: Duplicate table definition";
                    }
                    a.bits[0] = 0;
                    for (var o = 0; o < 16; o++) {
                        a.bits[o + 1] = this.getByte();
                        r += a.bits[o + 1];
                    }
                    if (r > 256) {
                        throw "LJpegDecompressor::parseDHT: Invalid DHT table.";
                    }
                    if (e < 1 + 16 + r) throw "LJpegDecompressor::parseDHT: Invalid DHT table length.";
                    for (var o = 0; o < r; o++) {
                        a.huffval[o] = this.getByte();
                    }
                    this.createHuffmanTable(a);
                    e -= 1 + 16 + r;
                }
            },
            createHuffmanTable: function v(e) {
                var t, i, n, r, a;
                var o;
                var s;
                var l, c, u;
                var f = new Array();
                t = 0;
                for (var n = 1; n <= 16; n++) {
                    for (var i = 1; i <= e.bits[n]; i++) {
                        f[t++] = n | 0;
                        if (t > 256) {
                            throw "LJpegDecompressor::createHuffmanTable: Code length too long. Corrupt data.";
                        }
                    }
                }
                f[t] = 0 | 0;
                var r = t;
                var d = new Array();
                var o = 0 | 0;
                var a = f[0] | 0;
                t = 0;
                while (f[t]) {
                    while (f[t] == a) {
                        d[t++] = o;
                        o++;
                    }
                    o <<= 1;
                    a++;
                    if (t > 256) {
                        throw "createHuffmanTable: Code length too long. Corrupt data.";
                    }
                }
                for (var t = 0; t < r; t++) {
                    e.ehufco[e.huffval[t]] = d[t];
                    e.ehufsi[e.huffval[t]] = f[t];
                }
                e.mincode[0] = 0;
                e.maxcode[0] = 0;
                t = 0;
                for (var n = 1; n <= 16; n++) {
                    if (e.bits[n]) {
                        e.valptr[n] = t;
                        e.mincode[n] = d[t];
                        t += e.bits[n];
                        e.maxcode[n] = d[t - 1];
                    } else {
                        e.valptr[n] = 255;
                        e.maxcode[n] = -1;
                    }
                    if (t > 256) {
                        throw "createHuffmanTable: Code length too long. Corrupt data.";
                    }
                }
                e.maxcode[17] = 1048575;
                for (var t = 0; t < r; t++) {
                    s = f[t];
                    if (s <= 8) {
                        l = e.huffval[t];
                        o = d[t];
                        c = o << 8 - s;
                        u = s < 8 ? c | this.bitMask[24 + s] : c;
                        if (u > 256 || c > u) {
                            throw "createHuffmanTable: Code length too long. Corrupt data.";
                        }
                        for (var i = c; i <= u; i++) {
                            e.numbits[i] = s | l << 4;
                        }
                    }
                }
                this.createBigTable(e);
                e.initialized = true;
            },
            createBigTable: function y(e) {
                var t = 14;
                var i = 1 << t;
                var n = 0;
                var r;
                var a;
                for (var o = 0; o < i; o++) {
                    var s = o << 2;
                    var l = s >> 8 | 0;
                    var c = e.numbits[l] | 0;
                    a = c & 15;
                    if (a) {
                        n = c >> 4;
                    } else {
                        a = 8;
                        while (l > e.maxcode[a]) {
                            r = s >> 15 - a & 1;
                            l = l << 1 | r;
                            a++;
                        }
                        if (a > ~~this.sof.prec || e.valptr[a] == 255) {
                            e.bigTable[o] = 255;
                            continue;
                        } else {
                            n = e.huffval[e.valptr[a] + (l - e.mincode[a])];
                        }
                    }
                    if (n == 16) {
                        e.bigTable[o] = -32768 << 8 | a | 0;
                        continue;
                    }
                    if (n + a > t) {
                        e.bigTable[o] = 255 | 0;
                        continue;
                    }
                    if (n) {
                        var u = s >> 16 - a - n & (1 << n) - 1 | 0;
                        if ((u & 1 << n - 1) == 0) {
                            u -= (1 << n) - 1;
                        }
                        e.bigTable[o] = u << 8 | a + n | 0;
                    } else {
                        e.bigTable[o] = a | 0;
                    }
                }
            },
            parseSOS: function b() {
                if (!this.sof.initialized) throw "LJpegDecompressor::parseSOS: Frame not yet initialized (SOF Marker not parsed)";
                var t = this.getShort();
                var i = this.getByte();
                if (this.sof.cps != i) throw "LJpegDecompressor::parseSOS: Component number mismatch.";
                for (var n = 0; n < this.sof.cps; n++) {
                    var r = this.getByte();
                    var a = 0;
                    while (this.sof.compInfo[a].componentId != r) {
                        if (a >= this.sof.cps) throw "LJpegDecompressor::parseSOS: Invalid Component Selector";
                        a++;
                    }
                    var o = this.getByte();
                    var s = o >> 4;
                    if (s > 3) throw "LJpegDecompressor::parseSOS: Invalid Huffman table selection";
                    if (!this.huff[s].initialized) throw "LJpegDecompressor::parseSOS: Invalid Huffman table selection, not defined.";
                    if (a > 3) throw "LJpegDecompressor::parseSOS: Component count out of range";
                    this.sof.compInfo[a].dcTblNo = s;
                }
                this.pred = this.getByte();
                if (this.pred > 7) throw "LJpegDecompressor::parseSOS: Invalid predictor mode.";
                this.skipBytes(1);
                var o = this.getByte();
                this.Pt = o & 15;
                this.bits = new e();
                this.bits.init(this.rawdata, this.rawdataOffset, this.getRemainSize());
                this.decodeScan();
                this.skipBytes(this.bits.getOffset());
            },
            decodeScan: function w() {
                var e = this.sof.w * this.sof.cps + this.offX * this.cpp;
                var t = this.dim.x * this.cpp;
                if (e > t) {
                    this.skipX = (e - t) / this.sof.cps;
                }
                e = this.sof.h + this.offY;
                if (e > this.dim.y) {
                    this.skipY = e - this.dim.y;
                }
                if (this.slicesW.length == 0) {
                    this.slicesW.push(this.sof.w * this.sof.cps);
                }
                if (0 == this.sof.h || 0 == this.sof.w) {
                    throw "LJpegPlain::decodeScan: Image width or height set to zero";
                }
                for (var i = 0; i < this.sof.cps; i++) {
                    if (this.sof.compInfo[i].superH != 1 || this.sof.compInfo[i].superV != 1) {
                        if (this.cpp != this.sof.cps) {
                            throw "LJpegDecompressor::decodeScan: Subsampled component count does not match image.";
                        }
                        if (this.pred == 1) {
                            if (this.sof.compInfo[0].superH == 2 && this.sof.compInfo[0].superV == 2 && this.sof.compInfo[1].superH == 1 && this.sof.compInfo[1].superV == 1 && this.sof.compInfo[2].superH == 1 && this.sof.compInfo[2].superV == 1) {
                                this.decodeScanLeft4_2_0();
                                return;
                            } else if (this.sof.compInfo[0].superH == 2 && this.sof.compInfo[0].superV == 1 && this.sof.compInfo[1].superH == 1 && this.sof.compInfo[1].superV == 1 && this.sof.compInfo[2].superH == 1 && this.sof.compInfo[2].superV == 1) {
                                this.decodeScanLeft4_2_2();
                                return;
                            } else {
                                LoggingService.error("LJpegDecompressor::decodeScan: Unsupported subsampling");
                                this.decodeScanLeftGeneric();
                                return;
                            }
                        } else {
                            throw "LJpegDecompressor::decodeScan: Unsupported prediction direction.";
                        }
                    }
                }
                if (this.pred == 1) {
                    if (this.sof.cps == 2) {
                        this.decodeScanLeft2Comps();
                    } else if (this.sof.cps == 3) {
                        this.decodeScanLeft3Comps();
                    } else if (this.sof.cps == 4) {
                        this.decodeScanLeft4Comps();
                    } else throw "LJpegDecompressor::decodeScan: Unsupported component direction count.";
                    return;
                }
                throw "LJpegDecompressor::decodeScan: Unsupported prediction direction.";
            },
            decodeScanLeft2Comps: function C() {
                var e = this.slicesW.length;
                var t = this.huff[this.sof.compInfo[0].dcTblNo];
                var i = this.huff[this.sof.compInfo[1].dcTblNo];
                var n = this.HuffDecode.bind(this);
                var r = this.skipX;
                var a = this.sof.h - this.skipY;
                var o = e * a;
                this.offset = new Uint32Array(o + 1);
                var s = this.offset;
                var l = 0;
                var c = 0;
                var u = 0;
                var f = 0;
                var d = this.sof.w - r;
                for (f = 0; f < o; f++) {
                    s[f] = c + this.offX + (this.offY + l) * this.dim.x | u << 28;
                    l++;
                    if (l == this.sof.h - this.skipY) {
                        l = 0;
                        c += this.slicesW[u++];
                    }
                }
                s[o] = s[o - 1];
                this.slice_width = new Uint32Array(e);
                var h = this.slice_width;
                for (var p = 0; p < e; p++) {
                    h[p] = this.slicesW[p] / 2;
                }
                if (r) {
                    h[e - 1] -= r;
                }
                var g = 0;
                var m = this.data;
                var v = (1 << this.sof.prec - this.Pt - 1) + n(t);
                m[g++] = v;
                var y = (1 << this.sof.prec - this.Pt - 1) + n(i);
                m[g++] = y;
                f = 1;
                var b = h[0] - 1;
                var w = v;
                var C = y;
                var x = this.bits;
                var _ = 1;
                var S = true;
                for (var k = 0; k < a; k++) {
                    S = true;
                    for (;_ < d; _++) {
                        var A;
                        var E;
                        var T, P;
                        var I;
                        var O = t.bigTable;
                        if (x.mLeft < 24) {
                            var D = x.mLeft;
                            var R = x.current_buffer;
                            var L = x.buffer;
                            var F = x.off;
                            var M = x.stuffed;
                            var N = x.size;
                            R[12] = R[0];
                            R[13] = R[1];
                            R[14] = R[2];
                            R[15] = R[3];
                            for (var p = 0; p < 12; p++) {
                                var P = L[F++] | 0;
                                if (P == 255) {
                                    if (L[F]) {
                                        P = 0 | 0;
                                        F--;
                                        M++;
                                    } else {
                                        F++;
                                    }
                                }
                                R[11 - p] = P | 0;
                            }
                            D += 96;
                            x.mLeft = D;
                            x.current_buffer = R;
                            x.buffer = L;
                            x.off = F;
                            x.stuffed = M;
                        }
                        var B = x.mLeft - 14 | 0;
                        var j = B >> 3 | 0;
                        var R = x.current_buffer;
                        var U = (R[j + 3] << 24) + (R[j + 2] << 16) + (R[j + 1] << 8) + R[j];
                        U >>= B & 7;
                        T = U & 16383;
                        {
                            P = O[T] | 0;
                            var z = P & 255 | 0;
                            if (z != 255) {
                                x.mLeft -= z;
                                v += P >> 8 | 0;
                            } else {
                                A = 0 | 0;
                                T = T >> 6 | 0;
                                P = t.numbits[T];
                                I = P & 15;
                                if (I) {
                                    x.mLeft -= I;
                                    A = P >> 4 | 0;
                                } else {
                                    x.skipBitsNoFill(8);
                                    I = 8;
                                    while (T > t.maxcode[I]) {
                                        E = x.getBitNoFill();
                                        T = T << 1 | E;
                                        I++;
                                    }
                                    A = t.huffval[t.valptr[I] + (T - t.mincode[I])] | 0;
                                }
                                if (A == 16) {
                                    v += -32768;
                                } else {
                                    if (A + I > 24) {
                                        if (x.mLeft < 24) x.fill();
                                    }
                                    if (A) {
                                        var q = x.getBitsNoFill(A);
                                        if ((q & 1 << A - 1) == 0) {
                                            q -= (1 << A) - 1;
                                        }
                                        v += q;
                                    }
                                }
                            }
                        }
                        m[g++] = v;
                        var A;
                        var E;
                        var T, P;
                        var I;
                        var O = i.bigTable;
                        if (x.mLeft < 24) {
                            var D = x.mLeft;
                            var R = x.current_buffer;
                            var L = x.buffer;
                            var F = x.off;
                            var M = x.stuffed;
                            var N = x.size;
                            R[12] = R[0];
                            R[13] = R[1];
                            R[14] = R[2];
                            R[15] = R[3];
                            for (var p = 0; p < 12; p++) {
                                var P = L[F++] | 0;
                                if (P == 255) {
                                    if (L[F]) {
                                        P = 0 | 0;
                                        F--;
                                        M++;
                                    } else {
                                        F++;
                                    }
                                }
                                R[11 - p] = P | 0;
                            }
                            D += 96;
                            x.mLeft = D;
                            x.current_buffer = R;
                            x.buffer = L;
                            x.off = F;
                            x.stuffed = M;
                        }
                        var B = x.mLeft - 14 | 0;
                        var j = B >> 3 | 0;
                        var R = x.current_buffer;
                        var U = (R[j + 3] << 24) + (R[j + 2] << 16) + (R[j + 1] << 8) + R[j];
                        U >>= B & 7;
                        T = U & 16383;
                        {
                            P = O[T] | 0;
                            var z = P & 255 | 0;
                            if (z != 255) {
                                x.skipBitsNoFill(z);
                                y += P >> 8 | 0;
                            } else {
                                A = 0 | 0;
                                T = T >> 6 | 0;
                                P = i.numbits[T];
                                I = P & 15;
                                if (I) {
                                    x.skipBitsNoFill(I);
                                    A = P >> 4 | 0;
                                } else {
                                    x.skipBitsNoFill(8);
                                    I = 8;
                                    while (T > i.maxcode[I]) {
                                        E = x.getBitNoFill();
                                        T = T << 1 | E;
                                        I++;
                                    }
                                    A = i.huffval[i.valptr[I] + (T - i.mincode[I])] | 0;
                                }
                                if (A == 16) {
                                    y += -32768;
                                } else {
                                    if (A + I > 24) {
                                        if (x.mLeft < 24) x.fill();
                                    }
                                    if (A) {
                                        var q = x.getBitsNoFill(A);
                                        if ((q & 1 << A - 1) == 0) {
                                            q -= (1 << A) - 1;
                                        }
                                        y += q;
                                    }
                                }
                            }
                        }
                        m[g++] = y;
                        if (S && k) {
                            w = v;
                            C = y;
                            S = false;
                        }
                        if (0 == --b) {
                            var W = s[f++];
                            g = W & 268435455;
                            b = h[W >> 28];
                        }
                    }
                    if (r) {
                        for (var p = 0; p < r; p++) {
                            n(t);
                            n(i);
                        }
                    }
                    v = w;
                    y = C;
                    _ = 0;
                }
            },
            decodeScanLeft4Comps: function x() {
                console.log("decodeScanLeft4Comps()");
                var e = this.huff[this.sof.compInfo[0].dcTblNo];
                var t = this.huff[this.sof.compInfo[1].dcTblNo];
                var i = this.huff[this.sof.compInfo[2].dcTblNo];
                var n = this.huff[this.sof.compInfo[3].dcTblNo];
                var r = this.slicesW.length * (this.sof.h - this.skipY);
                this.offset = new Uint32Array(r + 1);
                var a = 0;
                var o = 0;
                var s = 0;
                var l = 0;
                var c = this.sof.w - this.skipX;
                for (l = 0; l < r; l++) {
                    this.offset[l] = o + this.offX + (this.offY + a) * this.pitch | s << 28;
                    a++;
                    if (a == this.sof.h - this.skipY) {
                        a = 0;
                        o += this.slicesW[s++];
                    }
                }
                this.offset[r] = this.offset[r - 1];
                this.slice_width = new Uint32Array(this.slicesW.length);
                for (var u = 0; u < this.slicesW.length; u++) {
                    this.slice_width[u] = this.slicesW[u] / 4;
                }
                if (this.skipX) {
                    this.slice_width[this.slicesW.length - 1] -= this.skipX;
                }
                var f = 0;
                var d = (1 << this.sof.prec - this.Pt - 1) + this.HuffDecode(e);
                this.data[f++] = d;
                var h = (1 << this.sof.prec - this.Pt - 1) + this.HuffDecode(t);
                this.data[f++] = h;
                var p = (1 << this.sof.prec - this.Pt - 1) + this.HuffDecode(i);
                this.data[f++] = p;
                var g = (1 << this.sof.prec - this.Pt - 1) + this.HuffDecode(n);
                this.data[f++] = g;
                l = 1;
                var m = this.slice_width[0] - 1;
                var v = d;
                var y = h;
                var b = p;
                var w = g;
                var C = this.data;
                var x = this.bits;
                var _ = 1;
                var S = true;
                for (var k = 0; k < this.sof.h - this.skipY; k++) {
                    S = true;
                    for (;_ < c; _++) {
                        var A;
                        var E;
                        var T, P;
                        var I;
                        var O = e.bigTable;
                        if (x.mLeft < 24) {
                            var D = x.mLeft;
                            var R = x.current_buffer;
                            var L = x.buffer;
                            var F = x.off;
                            var M = x.stuffed;
                            var N = x.size;
                            R[12] = R[0];
                            R[13] = R[1];
                            R[14] = R[2];
                            R[15] = R[3];
                            for (var u = 0; u < 12; u++) {
                                var P = L[F++] | 0;
                                if (P == 255) {
                                    if (L[F]) {
                                        P = 0 | 0;
                                        F--;
                                        M++;
                                    } else {
                                        F++;
                                    }
                                }
                                R[11 - u] = P | 0;
                            }
                            D += 96;
                            x.mLeft = D;
                            x.current_buffer = R;
                            x.buffer = L;
                            x.off = F;
                            x.stuffed = M;
                        }
                        var B = x.mLeft - 14 | 0;
                        var j = B >> 3 | 0;
                        var R = x.current_buffer;
                        var U = (R[j + 3] << 24) + (R[j + 2] << 16) + (R[j + 1] << 8) + R[j];
                        U >>= B & 7;
                        T = U & 16383;
                        {
                            P = O[T] | 0;
                            var z = P & 255 | 0;
                            if (z != 255) {
                                x.mLeft -= z;
                                d += P >> 8 | 0;
                            } else {
                                A = 0 | 0;
                                T = T >> 6 | 0;
                                P = e.numbits[T];
                                I = P & 15;
                                if (I) {
                                    x.mLeft -= I;
                                    A = P >> 4 | 0;
                                } else {
                                    x.skipBitsNoFill(8);
                                    I = 8;
                                    while (T > e.maxcode[I]) {
                                        E = x.getBitNoFill();
                                        T = T << 1 | E;
                                        I++;
                                    }
                                    A = e.huffval[e.valptr[I] + (T - e.mincode[I])] | 0;
                                }
                                if (A == 16) {
                                    d += -32768;
                                } else {
                                    if (A + I > 24) {
                                        if (x.mLeft < 24) x.fill();
                                    }
                                    if (A) {
                                        var q = x.getBitsNoFill(A);
                                        if ((q & 1 << A - 1) == 0) {
                                            q -= (1 << A) - 1;
                                        }
                                        d += q;
                                    }
                                }
                            }
                        }
                        C[f++] = d;
                        var A;
                        var E;
                        var T, P;
                        var I;
                        var O = t.bigTable;
                        if (x.mLeft < 24) {
                            var D = x.mLeft;
                            var R = x.current_buffer;
                            var L = x.buffer;
                            var F = x.off;
                            var M = x.stuffed;
                            var N = x.size;
                            R[12] = R[0];
                            R[13] = R[1];
                            R[14] = R[2];
                            R[15] = R[3];
                            for (var u = 0; u < 12; u++) {
                                var P = L[F++] | 0;
                                if (P == 255) {
                                    if (L[F]) {
                                        P = 0 | 0;
                                        F--;
                                        M++;
                                    } else {
                                        F++;
                                    }
                                }
                                R[11 - u] = P | 0;
                            }
                            D += 96;
                            x.mLeft = D;
                            x.current_buffer = R;
                            x.buffer = L;
                            x.off = F;
                            x.stuffed = M;
                        }
                        var B = x.mLeft - 14 | 0;
                        var j = B >> 3 | 0;
                        var R = x.current_buffer;
                        var U = (R[j + 3] << 24) + (R[j + 2] << 16) + (R[j + 1] << 8) + R[j];
                        U >>= B & 7;
                        T = U & 16383;
                        {
                            P = O[T] | 0;
                            var z = P & 255 | 0;
                            if (z != 255) {
                                x.mLeft -= z;
                                h += P >> 8 | 0;
                            } else {
                                A = 0 | 0;
                                T = T >> 6 | 0;
                                P = t.numbits[T];
                                I = P & 15;
                                if (I) {
                                    x.mLeft -= I;
                                    A = P >> 4 | 0;
                                } else {
                                    x.skipBitsNoFill(8);
                                    I = 8;
                                    while (T > t.maxcode[I]) {
                                        E = x.getBitNoFill();
                                        T = T << 1 | E;
                                        I++;
                                    }
                                    A = t.huffval[t.valptr[I] + (T - t.mincode[I])] | 0;
                                }
                                if (A == 16) {
                                    h += -32768;
                                } else {
                                    if (A + I > 24) {
                                        if (x.mLeft < 24) x.fill();
                                    }
                                    if (A) {
                                        var q = x.getBitsNoFill(A);
                                        if ((q & 1 << A - 1) == 0) {
                                            q -= (1 << A) - 1;
                                        }
                                        h += q;
                                    }
                                }
                            }
                        }
                        C[f++] = h;
                        var A;
                        var E;
                        var T, P;
                        var I;
                        var O = i.bigTable;
                        if (x.mLeft < 24) {
                            var D = x.mLeft;
                            var R = x.current_buffer;
                            var L = x.buffer;
                            var F = x.off;
                            var M = x.stuffed;
                            var N = x.size;
                            R[12] = R[0];
                            R[13] = R[1];
                            R[14] = R[2];
                            R[15] = R[3];
                            for (var u = 0; u < 12; u++) {
                                var P = L[F++] | 0;
                                if (P == 255) {
                                    if (L[F]) {
                                        P = 0 | 0;
                                        F--;
                                        M++;
                                    } else {
                                        F++;
                                    }
                                }
                                R[11 - u] = P | 0;
                            }
                            D += 96;
                            x.mLeft = D;
                            x.current_buffer = R;
                            x.buffer = L;
                            x.off = F;
                            x.stuffed = M;
                        }
                        var B = x.mLeft - 14 | 0;
                        var j = B >> 3 | 0;
                        var R = x.current_buffer;
                        var U = (R[j + 3] << 24) + (R[j + 2] << 16) + (R[j + 1] << 8) + R[j];
                        U >>= B & 7;
                        T = U & 16383;
                        {
                            P = O[T] | 0;
                            var z = P & 255 | 0;
                            if (z != 255) {
                                x.mLeft -= z;
                                p += P >> 8 | 0;
                            } else {
                                A = 0 | 0;
                                T = T >> 6 | 0;
                                P = i.numbits[T];
                                I = P & 15;
                                if (I) {
                                    x.mLeft -= I;
                                    A = P >> 4 | 0;
                                } else {
                                    x.skipBitsNoFill(8);
                                    I = 8;
                                    while (T > i.maxcode[I]) {
                                        E = x.getBitNoFill();
                                        T = T << 1 | E;
                                        I++;
                                    }
                                    A = i.huffval[i.valptr[I] + (T - i.mincode[I])] | 0;
                                }
                                if (A == 16) {
                                    p += -32768;
                                } else {
                                    if (A + I > 24) {
                                        if (x.mLeft < 24) x.fill();
                                    }
                                    if (A) {
                                        var q = x.getBitsNoFill(A);
                                        if ((q & 1 << A - 1) == 0) {
                                            q -= (1 << A) - 1;
                                        }
                                        p += q;
                                    }
                                }
                            }
                        }
                        C[f++] = p;
                        var A;
                        var E;
                        var T, P;
                        var I;
                        var O = n.bigTable;
                        if (x.mLeft < 24) {
                            var D = x.mLeft;
                            var R = x.current_buffer;
                            var L = x.buffer;
                            var F = x.off;
                            var M = x.stuffed;
                            var N = x.size;
                            R[12] = R[0];
                            R[13] = R[1];
                            R[14] = R[2];
                            R[15] = R[3];
                            for (var u = 0; u < 12; u++) {
                                var P = L[F++] | 0;
                                if (P == 255) {
                                    if (L[F]) {
                                        P = 0 | 0;
                                        F--;
                                        M++;
                                    } else {
                                        F++;
                                    }
                                }
                                R[11 - u] = P | 0;
                            }
                            D += 96;
                            x.mLeft = D;
                            x.current_buffer = R;
                            x.buffer = L;
                            x.off = F;
                            x.stuffed = M;
                        }
                        var B = x.mLeft - 14 | 0;
                        var j = B >> 3 | 0;
                        var R = x.current_buffer;
                        var U = (R[j + 3] << 24) + (R[j + 2] << 16) + (R[j + 1] << 8) + R[j];
                        U >>= B & 7;
                        T = U & 16383;
                        {
                            P = O[T] | 0;
                            var z = P & 255 | 0;
                            if (z != 255) {
                                x.mLeft -= z;
                                g += P >> 8 | 0;
                            } else {
                                A = 0 | 0;
                                T = T >> 6 | 0;
                                P = n.numbits[T];
                                I = P & 15;
                                if (I) {
                                    x.mLeft -= I;
                                    A = P >> 4 | 0;
                                } else {
                                    x.skipBitsNoFill(8);
                                    I = 8;
                                    while (T > n.maxcode[I]) {
                                        E = x.getBitNoFill();
                                        T = T << 1 | E;
                                        I++;
                                    }
                                    A = n.huffval[n.valptr[I] + (T - n.mincode[I])] | 0;
                                }
                                if (A == 16) {
                                    g += -32768;
                                } else {
                                    if (A + I > 24) {
                                        if (x.mLeft < 24) x.fill();
                                    }
                                    if (A) {
                                        var q = x.getBitsNoFill(A);
                                        if ((q & 1 << A - 1) == 0) {
                                            q -= (1 << A) - 1;
                                        }
                                        g += q;
                                    }
                                }
                            }
                        }
                        C[f++] = g;
                        if (S && k != 0) {
                            v = d;
                            y = h;
                            b = p;
                            w = g;
                            S = false;
                        }
                        if (0 == --m) {
                            if (l > r) {
                                throw "LJpegPlain::decodeScanLeft: Ran out of slices";
                            }
                            var W = this.offset[l++];
                            f = W & 268435455;
                            m = this.slice_width[W >> 28];
                        }
                    }
                    if (this.skipX) {
                        for (var u = 0; u < this.skipX; u++) {
                            this.HuffDecode(e);
                            this.HuffDecode(t);
                            this.HuffDecode(i);
                            this.HuffDecode(n);
                        }
                    }
                    d = v;
                    h = y;
                    p = b;
                    g = w;
                    _ = 0;
                }
            },
            decodeScanLeft4_2_0: function _() {
                throw "not supported yet!";
            },
            decodeScanLeft4_2_2: function S() {
                throw "not supported yet!";
            },
            decodeScanLeftGeneric: function k() {
                throw "not supported yet!";
            },
            decodeScanLeft3Comps: function A() {
                throw "not supported yet!";
            },
            HuffDecode: function E(e) {
                var t;
                var i;
                var n, r;
                var a;
                var o = this.bits;
                var s = e.bigTable;
                if (this.bits.mLeft < 24) o.fill();
                n = o.peekBitsNoFill(14);
                if (s) {
                    r = s[n] | 0;
                    var l = r & 255 | 0;
                    if (l != 255) {
                        o.skipBitsNoFill(l);
                        return r >> 8 | 0;
                    } else {
                        t = 0 | 0;
                        n = n >> 6 | 0;
                        r = e.numbits[n];
                        a = r & 15;
                        if (a) {
                            o.skipBitsNoFill(a);
                            t = r >> 4 | 0;
                        } else {
                            o.skipBitsNoFill(8);
                            a = 8;
                            while (n > e.maxcode[a]) {
                                i = o.getBitNoFill();
                                n = n << 1 | i;
                                a++;
                            }
                            t = e.huffval[e.valptr[a] + (n - e.mincode[a])] | 0;
                        }
                        if (t == 16) {
                            return -32768;
                        } else {
                            if (t + a > 24) {
                                if (this.bits.mLeft < 24) o.fill();
                            }
                            if (t) {
                                var c = o.getBitsNoFill(t);
                                if ((c & 1 << t - 1) == 0) {
                                    c -= (1 << t) - 1;
                                }
                                return c;
                            }
                            return 0;
                        }
                    }
                }
            }
        });
        return n;
    };
    if (typeof define === "function") {
        define("LJpegDecompressor", [ "BitPumpJpeg" ], function() {
            return i.apply(this, arguments);
        });
    } else {
        if (typeof e.LJpegDecompressor === "undefined") {
            e.LJpegDecompressor = i(e.BitPumpJpeg);
        }
    }
})(this);

(function(e, t) {
    var i = function(e) {
        var CR2Decoder = function() {};
        CR2Decoder.prototype.decode = function i(n, r, a) {
            this.cpp = 1;
            this.bpp = 2;
            if (a === t) {
                throw new Error("CR2 Decoder: No image data found");
            }
            var o = 0;
            var s = [];
            var l = [];
            l.push(a.StripOffsets);
            var c = [];
            c.push(a.StripByteCounts);
            for (var u = 0; u < l.length; u++) {
                var f = {};
                f.offset = l[0];
                f.count = c[0];
                var d = new e();
                d.init(n, this.uncropped_dim, this.dim, this.cpp, this.pitch);
                var h = d.getSOF(f.offset, f.count);
                f.w = h.w * h.cps;
                f.h = h.h;
                s.push(f);
                o += f.h;
            }
            if (s.length == 0) {
                throw "CR2 Decoder: No Slices found.";
            }
            this.dim = {
                x: s[0].w,
                y: o
            };
            var p = a["50885"];
            this.pitch = ~~((this.dim.x + 15) / 16) * 16;
            this.uncropped_dim = this.dim;
            this.data = new Uint16Array(this.uncropped_dim.x * this.uncropped_dim.y);
            var g = [];
            var p = a["50752"];
            if (p !== t) {
                for (var m = 0; m < p[0]; m++) {
                    g.push(p[1]);
                }
                g.push(p[2]);
            } else {
                g.push(s[0].w);
            }
            var v = 0;
            if (g.length > 15) {
                throw "CR2 Decoder: No more than 15 slices supported";
            }
            var d;
            for (var m = 0; m < s.length; m++) {
                var f = s[m];
                d = new e();
                d.init(n, this.uncropped_dim, this.dim, this.cpp, this.pitch);
                d.slicesW = g;
                d.mUseBigtable = true;
                d.startDecoder(f.offset, f.count, 0, v);
                v += f.w;
            }
            return d.data;
        };
        return CR2Decoder;
    };
    if (typeof define === "function") {
        define("CR2Decoder", [ "LJpegDecompressor" ], function() {
            return i.apply(this, arguments);
        });
    } else {
        if (typeof e.CR2Decoder === "undefined") {
            e.CR2Decoder = i(e.LJpegDecompressor);
        }
    }
})(this);

(function(e, t) {
    var i = function() {
        var e = function t() {
            this.buffer = null;
            this.current_buffer = null;
            this.size = 0;
            this.mLeft = 0;
            this.off = 0;
            this.stuffed = 0;
        };
        e.prototype.init = function i(e, t, n) {
            this.buffer = new Uint8Array(e.buffer.slice(t, e.byteLength));
            this.current_buffer = new Uint8Array(16);
            this.size = n + 4;
            this.off = 0;
            this.mLeft = 0;
            this.stuffed = 0;
            this.fill();
        };
        e.prototype.getOffset = function n() {
            return this.off - (this.mLeft >> 3);
        };
        e.prototype.getBits = function r(e) {
            this.fill();
            return this.getBitsNoFill(e);
        };
        e.prototype.fill = function a() {
            if (this.mLeft >= 24) return;
            var e = this.mLeft;
            var t = this.current_buffer;
            var i = this.buffer;
            var n = this.off;
            t[12] = t[0];
            t[13] = t[1];
            t[14] = t[2];
            t[15] = t[3];
            t[0] = i[n + 11];
            t[1] = i[n + 10];
            t[2] = i[n + 9];
            t[3] = i[n + 8];
            t[4] = i[n + 7];
            t[5] = i[n + 6];
            t[6] = i[n + 5];
            t[7] = i[n + 4];
            t[8] = i[n + 3];
            t[9] = i[n + 2];
            t[10] = i[n + 1];
            t[11] = i[n + 0];
            this.off += 12;
            this.mLeft += 96;
        };
        e.prototype.peekByteNoFill = function o() {
            var e = this.mLeft - 8 | 0;
            var t = e >> 3 | 0;
            var i = this.current_buffer;
            var n = (i[t + 3] << 24) + (i[t + 2] << 16) + (i[t + 1] << 8) + i[t];
            n >>= e & 7;
            n = n & 255;
            return n | 0;
        };
        e.prototype.peekBitsNoFill = function s(e) {
            var t = this.mLeft - e | 0;
            var i = t >> 3 | 0;
            var n = this.current_buffer;
            var r = (n[i + 3] << 24) + (n[i + 2] << 16) + (n[i + 1] << 8) + n[i];
            r >>= t & 7;
            r = r & (1 << e) - 1;
            return r | 0;
        };
        e.prototype.peek14BitsNoFill = function l() {
            var e = this.mLeft - 14 | 0;
            var t = e >> 3 | 0;
            var i = this.current_buffer;
            var n = (i[t + 3] << 24) + (i[t + 2] << 16) + (i[t + 1] << 8) + i[t];
            n >>= e & 7;
            n = n & 16383;
            return n | 0;
        };
        e.prototype.skipBitsNoFill = function c(e) {
            this.mLeft -= e;
        };
        e.prototype.skipBits = function u(e) {
            while (e) {
                this.fill();
                var t = Math.min(e, this.mLeft);
                this.mLeft -= t;
                e -= t;
            }
        };
        e.prototype.getBitsNoFill = function f(e) {
            var t = this.peekBitsNoFill(e);
            this.mLeft -= e;
            return t | 0;
        };
        e.prototype.getBitNoFill = function d() {
            this.mLeft--;
            var e = this.current_buffer[this.mLeft >> 3] >> (this.mLeft & 7) & 1;
            return e | 0;
        };
        e.prototype.checkPos = function h() {};
        return e;
    };
    if (typeof define === "function") {
        define("BitPumpMSB", [], function() {
            return i();
        });
    } else {
        if (typeof e.BitPumpMSB === "undefined") {
            e.BitPumpMSB = i();
        }
    }
})(this);

(function(e, t) {
    var i = function(e, t) {
        var i = [ [ 0, 1, 5, 1, 1, 1, 1, 1, 1, 2, 0, 0, 0, 0, 0, 0, 5, 4, 3, 6, 2, 7, 1, 0, 8, 9, 11, 10, 12 ], [ 0, 1, 5, 1, 1, 1, 1, 1, 1, 2, 0, 0, 0, 0, 0, 0, 57, 90, 56, 39, 22, 5, 4, 3, 2, 1, 0, 11, 12, 12 ], [ 0, 1, 4, 2, 3, 1, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 5, 4, 6, 3, 7, 2, 8, 1, 9, 0, 10, 11, 12 ], [ 0, 1, 4, 3, 1, 1, 1, 1, 1, 2, 0, 0, 0, 0, 0, 0, 5, 6, 4, 7, 8, 3, 9, 2, 1, 0, 10, 11, 12, 13, 14 ], [ 0, 1, 5, 1, 1, 1, 1, 1, 1, 1, 2, 0, 0, 0, 0, 0, 8, 92, 75, 58, 41, 7, 6, 5, 4, 3, 2, 1, 0, 13, 14 ], [ 0, 1, 4, 2, 2, 3, 1, 2, 0, 0, 0, 0, 0, 0, 0, 0, 7, 6, 8, 5, 9, 4, 10, 3, 11, 12, 2, 0, 1, 13, 14 ] ];
        var n = function(e, t, i) {
            var n;
            var r = function(e) {
                var t = [];
                var i = t.slice;
                i.call(arguments, 1).forEach(function(t) {
                    for (var i in t) e[i] = t[i];
                });
                return e;
            };
            if (t && hasOwnProperty.call(t, "constructor")) {
                n = t.constructor;
            } else {
                n = function() {
                    return e.apply(e, arguments);
                };
            }
            r(n, e, i);
            var a = function() {
                e.constructor = n;
            };
            a.prototype = e.prototype;
            n.prototype = new a();
            if (t) {
                r(n.prototype, t);
            }
            n.__super__ = e.prototype;
            return n;
        };
        var r = n(e, {
            init: function a(e, t, i, n, r, o, s) {
                this.base().init(e, t, i, n, r);
                this.rawIFD = o;
                this.rootIFD = s;
                this.input = 0;
                this.skipX = this.skipY = 0;
                for (var l = 0; l < 4; l++) {
                    this.huff.push({});
                    this.huff[l].initialized = false;
                    this.huff[l].bigTable = 0;
                    this.huff[l].bits = new Uint16Array(256);
                    this.huff[l].huffval = new Uint16Array(256);
                    this.huff[l].valptr = new Uint8Array(256);
                    this.huff[l].mincode = new Uint32Array(256);
                    this.huff[l].maxcode = new Uint32Array(256);
                    this.huff[l].ehufco = new Uint16Array(256);
                    this.huff[l].ehufsi = new Uint16Array(256);
                    this.huff[l].numbits = new Uint16Array(256);
                    this.huff[l].value = new Uint32Array(65536);
                    this.huff[l].bigTable = new Uint32Array(16384);
                }
                this.mDNGCompatible = false;
                this.slicesW = [];
                this.mUseBigtable = true;
            },
            initTable: function(e) {
                var t = this.huff[0];
                var n = 0;
                for (var r = 0; r < 16; r++) {
                    t.bits[r + 1] = i[e][r];
                    n += t.bits[r + 1];
                }
                t.bits[0] = 0;
                for (var r = 0; r < n; r++) {
                    t.huffval[r] = i[e][r + 16];
                }
                this.createHuffmanTable(t);
            },
            decode: function o() {
                var e = this.rawIFD;
                var i = this.rootIFD;
                var n = i.ExifIFD.Makernote.NEFLinearizationTable.pUp1;
                var r = i.ExifIFD.Makernote.NEFLinearizationTable.pUp2;
                var a = i.ExifIFD.Makernote.NEFLinearizationTable.huffSelect;
                var o = i.ExifIFD.Makernote.NEFLinearizationTable.split;
                this.initTable(a);
                this.curve = i.ExifIFD.Makernote.NEFLinearizationTable.curve;
                this.blackLevel = this.curve[0];
                this.whitePoint = this.curve[4095];
                var s, l;
                var c = e.ImageWidth, u = e.ImageLength;
                this.bits = new t();
                this.bits.init(this.rawdata, this.rawdataOffset, this.getRemainSize());
                this.dim = {
                    x: c,
                    y: u
                };
                this.pitch = ~~((this.dim.x + 15) / 16) * 16;
                this.uncropped_dim = this.dim;
                this.data = new Uint16Array(this.uncropped_dim.x * this.uncropped_dim.y);
                var f = this.data;
                var d;
                var h = this.pitch;
                var p = 0;
                var g = 0;
                var m = c / 2;
                function v(e) {
                    var t;
                    if (t = e >> 15) e = ~t >> 17;
                    return e;
                }
                var y = this.curve;
                var b = this.bits;
                var w = b.buffer;
                var C = this.huff[0];
                var x = C.bigTable;
                var _ = 0;
                for (l = 0; l < u; l++) {
                    if (o && l == o) {
                        this.initTable(a + 1);
                    }
                    var S = l & 1;
                    {
                        var k;
                        var A = b.current_buffer;
                        if (b.mLeft < 24) {
                            var E = b.off;
                            A[12] = A[0];
                            A[13] = A[1];
                            A[14] = A[2];
                            A[15] = A[3];
                            A[0] = w[E + 11];
                            A[1] = w[E + 10];
                            A[2] = w[E + 9];
                            A[3] = w[E + 8];
                            A[4] = w[E + 7];
                            A[5] = w[E + 6];
                            A[6] = w[E + 5];
                            A[7] = w[E + 4];
                            A[8] = w[E + 3];
                            A[9] = w[E + 2];
                            A[10] = w[E + 1];
                            A[11] = w[E + 0];
                            b.off += 12;
                            b.mLeft += 96;
                        }
                        var T = b.mLeft - 14 | 0;
                        var P = T >> 3 | 0;
                        var I = (A[P + 3] << 24) + (A[P + 2] << 16) + (A[P + 1] << 8) + A[P];
                        I >>= T & 7;
                        I = I & 16383;
                        var O = I | 0;
                        var D = x[O];
                        var R = D & 255 | 0;
                        if (R != 255) {
                            b.mLeft -= R;
                            k = D >> 8 | 0;
                        } else {
                            var L = 0;
                            var T = b.mLeft - 8 | 0;
                            var P = T >> 3 | 0;
                            var I = (A[P + 3] << 24) + (A[P + 2] << 16) + (A[P + 1] << 8) + A[P];
                            I >>= T & 7;
                            O = I & 255;
                            D = C.numbits[O];
                            var F = D & 15;
                            if (F) {
                                b.mLeft -= F;
                                L = D >> 4;
                            } else {
                                b.skipBits(8);
                                F = 8;
                                var M;
                                while (O > C.maxcode[F]) {
                                    M = b.getBitNoFill();
                                    O = O << 1 | M;
                                    F++;
                                }
                                L = C.huffval[C.valptr[F] + (O - C.mincode[F])];
                            }
                            if (L == 16) {
                                k = -32768;
                            } else {
                                var N = L & 15;
                                var B = L >> 4;
                                k = (b.getBits(N - B) << 1) + 1 << B >> 1;
                                if ((k & 1 << N - 1) == 0) {
                                    k -= (1 << N) - !B;
                                }
                            }
                        }
                        n[S] += k;
                        p = n[S];
                        f[_++] = y[p > 32768 ? 32768 : p];
                    }
                    {
                        var k;
                        var A = b.current_buffer;
                        if (b.mLeft < 24) {
                            var E = b.off;
                            A[12] = A[0];
                            A[13] = A[1];
                            A[14] = A[2];
                            A[15] = A[3];
                            A[0] = w[E + 11];
                            A[1] = w[E + 10];
                            A[2] = w[E + 9];
                            A[3] = w[E + 8];
                            A[4] = w[E + 7];
                            A[5] = w[E + 6];
                            A[6] = w[E + 5];
                            A[7] = w[E + 4];
                            A[8] = w[E + 3];
                            A[9] = w[E + 2];
                            A[10] = w[E + 1];
                            A[11] = w[E + 0];
                            b.off += 12;
                            b.mLeft += 96;
                        }
                        var T = b.mLeft - 14 | 0;
                        var P = T >> 3 | 0;
                        var I = (A[P + 3] << 24) + (A[P + 2] << 16) + (A[P + 1] << 8) + A[P];
                        I >>= T & 7;
                        I = I & 16383;
                        var O = I | 0;
                        var D = x[O];
                        var R = D & 255 | 0;
                        if (R != 255) {
                            b.mLeft -= R;
                            k = D >> 8 | 0;
                        } else {
                            var L = 0;
                            var T = b.mLeft - 8 | 0;
                            var P = T >> 3 | 0;
                            var I = (A[P + 3] << 24) + (A[P + 2] << 16) + (A[P + 1] << 8) + A[P];
                            I >>= T & 7;
                            O = I & 255;
                            D = C.numbits[O];
                            var F = D & 15;
                            if (F) {
                                b.mLeft -= F;
                                L = D >> 4;
                            } else {
                                b.skipBits(8);
                                F = 8;
                                var M;
                                while (O > C.maxcode[F]) {
                                    M = b.getBitNoFill();
                                    O = O << 1 | M;
                                    F++;
                                }
                                L = C.huffval[C.valptr[F] + (O - C.mincode[F])];
                            }
                            if (L == 16) {
                                k = -32768;
                            } else {
                                var N = L & 15;
                                var B = L >> 4;
                                k = (b.getBits(N - B) << 1) + 1 << B >> 1;
                                if ((k & 1 << N - 1) == 0) {
                                    k -= (1 << N) - !B;
                                }
                            }
                        }
                        r[S] += k;
                        g = r[S];
                        f[_++] = y[g > 32768 ? 32768 : g];
                    }
                    for (s = 1; s < m; s++) {
                        {
                            var k;
                            var A = b.current_buffer;
                            if (b.mLeft < 24) {
                                var E = b.off;
                                A[12] = A[0];
                                A[13] = A[1];
                                A[14] = A[2];
                                A[15] = A[3];
                                A[0] = w[E + 11];
                                A[1] = w[E + 10];
                                A[2] = w[E + 9];
                                A[3] = w[E + 8];
                                A[4] = w[E + 7];
                                A[5] = w[E + 6];
                                A[6] = w[E + 5];
                                A[7] = w[E + 4];
                                A[8] = w[E + 3];
                                A[9] = w[E + 2];
                                A[10] = w[E + 1];
                                A[11] = w[E + 0];
                                b.off += 12;
                                b.mLeft += 96;
                            }
                            var T = b.mLeft - 14 | 0;
                            var P = T >> 3 | 0;
                            var I = (A[P + 3] << 24) + (A[P + 2] << 16) + (A[P + 1] << 8) + A[P];
                            I >>= T & 7;
                            var O = I & 16383;
                            var D = x[O];
                            var R = D & 255 | 0;
                            if (R != 255) {
                                b.mLeft -= R;
                                k = D >> 8 | 0;
                            } else {
                                var L = 0;
                                var T = b.mLeft - 8 | 0;
                                var P = T >> 3 | 0;
                                var I = (A[P + 3] << 24) + (A[P + 2] << 16) + (A[P + 1] << 8) + A[P];
                                I >>= T & 7;
                                I = I & 255;
                                O = I | 0;
                                D = C.numbits[O];
                                var F = D & 15;
                                if (F) {
                                    b.mLeft -= F;
                                    L = D >> 4;
                                } else {
                                    b.skipBits(8);
                                    F = 8;
                                    var M;
                                    while (O > C.maxcode[F]) {
                                        M = b.getBitNoFill();
                                        O = O << 1 | M;
                                        F++;
                                    }
                                    L = C.huffval[C.valptr[F] + (O - C.mincode[F])];
                                }
                                if (L == 16) {
                                    k = -32768;
                                } else {
                                    var N = L & 15;
                                    var B = L >> 4;
                                    k = (b.getBits(N - B) << 1) + 1 << B >> 1;
                                    if ((k & 1 << N - 1) == 0) {
                                        k -= (1 << N) - !B;
                                    }
                                }
                            }
                            p += k;
                            f[_++] = y[p > 32768 ? 32768 : p];
                        }
                        {
                            k = 0;
                            var A = b.current_buffer;
                            if (b.mLeft < 24) {
                                var E = b.off;
                                A[12] = A[0];
                                A[13] = A[1];
                                A[14] = A[2];
                                A[15] = A[3];
                                A[0] = w[E + 11];
                                A[1] = w[E + 10];
                                A[2] = w[E + 9];
                                A[3] = w[E + 8];
                                A[4] = w[E + 7];
                                A[5] = w[E + 6];
                                A[6] = w[E + 5];
                                A[7] = w[E + 4];
                                A[8] = w[E + 3];
                                A[9] = w[E + 2];
                                A[10] = w[E + 1];
                                A[11] = w[E + 0];
                                b.off += 12;
                                b.mLeft += 96;
                            }
                            var T = b.mLeft - 14 | 0;
                            var P = T >> 3 | 0;
                            var I = (A[P + 3] << 24) + (A[P + 2] << 16) + (A[P + 1] << 8) + A[P];
                            I >>= T & 7;
                            var O = I & 16383;
                            var D = x[O];
                            var R = D & 255 | 0;
                            if (R != 255) {
                                b.mLeft -= R;
                                k = D >> 8 | 0;
                            } else {
                                var L = 0;
                                var T = b.mLeft - 8 | 0;
                                var P = T >> 3 | 0;
                                var I = (A[P + 3] << 24) + (A[P + 2] << 16) + (A[P + 1] << 8) + A[P];
                                I >>= T & 7;
                                I = I & 255;
                                O = I | 0;
                                D = C.numbits[O];
                                var F = D & 15;
                                if (F) {
                                    b.mLeft -= F;
                                    L = D >> 4;
                                } else {
                                    b.skipBits(8);
                                    F = 8;
                                    var M;
                                    while (O > C.maxcode[F]) {
                                        M = b.getBitNoFill();
                                        O = O << 1 | M;
                                        F++;
                                    }
                                    L = C.huffval[C.valptr[F] + (O - C.mincode[F])];
                                }
                                if (L == 16) {
                                    k = -32768;
                                } else {
                                    var N = L & 15;
                                    var B = L >> 4;
                                    k = (b.getBits(N - B) << 1) + 1 << B >> 1;
                                    if ((k & 1 << N - 1) == 0) {
                                        k -= (1 << N) - !B;
                                    }
                                }
                            }
                            g += k;
                            f[_++] = y[g > 32768 ? 32768 : g];
                        }
                    }
                }
                return this.data;
            },
            HuffDecodeNikon: function s() {
                var e = this.bits;
                var t = this.huff[0];
                var i = t.bigTable;
                e.fill();
                var n = e.peek14BitsNoFill();
                var r = i[n];
                var a = r & 255 | 0;
                if (a != 255) {
                    e.mLeft -= a;
                    return r >> 8 | 0;
                }
                var o = 0;
                n = e.peekByteNoFill();
                r = t.numbits[n];
                var s = r & 15;
                if (s) {
                    e.mLeft -= s;
                    o = r >> 4;
                } else {
                    e.skipBits(8);
                    s = 8;
                    var l;
                    while (n > t.maxcode[s]) {
                        l = e.getBitNoFill();
                        n = n << 1 | l;
                        s++;
                    }
                    o = t.huffval[t.valptr[s] + (n - t.mincode[s])];
                }
                if (o == 16) {
                    return -32768;
                }
                var c = o & 15;
                var u = o >> 4;
                var f = (e.getBits(c - u) << 1) + 1 << u >> 1;
                if ((f & 1 << c - 1) == 0) {
                    f -= (1 << c) - !u;
                }
                return f;
            }
        });
        return r;
    };
    if (typeof define === "function") {
        define("NEFJpegDecompressor", [ "LJpegDecompressor", "BitPumpMSB" ], function() {
            return i.apply(this, arguments);
        });
    } else {
        if (typeof e.NEFJpegDecompressor === "undefined") {
            e.NEFJpegDecompressor = i(e.LJpegDecompressor, e.BitPumpMSB);
        }
    }
})(this);

(function(e, t) {
    var i = function(e) {
        var NEFDecoder = function() {};
        NEFDecoder.prototype.decode = function t(i, n, r) {
            var a = new e();
            a.init(i, this.uncropped_dim, this.dim, this.cpp, this.pitch, r, n);
            var o = a.decode();
            return o;
        };
        return NEFDecoder;
    };
    if (typeof define === "function") {
        define("NEFDecoder", [ "NEFJpegDecompressor" ], function() {
            return i.apply(this, arguments);
        });
    } else {
        if (typeof e.NEFDecoder === "undefined") {
            e.NEFDecoder = i(e.NEFJpegDecompressor);
        }
    }
})(this);

(function(e, t) {
    var i = function(e, t, i, n, r, CR2Decoder, NEFDecoder) {
        var a = function(e, t, i, n) {
            var r = this;
            this.constructor.prototype.decodingParams = t;
            console.group("Decoding RAW");
            console.time("Total");
            this.constructor.prototype.callback = function() {
                console.timeEnd("Total");
                console.groupEnd("Decoding RAW");
                i.apply(r, arguments);
            };
            this.constructor.prototype.errback = n;
            this.loadRawData(e);
        };
        a.prototype.loadRawData = function(e) {
            var t = this;
            i.blockui("Loading raw...");
            var r = window.app && window.app.showError || function(e) {
                console.error(e);
                t.errback(e);
            };
            if (e.decompressedData) {
                this.decodeDecompressedData(e);
            } else {
                n.getRawData(e, this.decompressRawData.bind(this), r, this.rawDataChunkReady.bind(this));
            }
        };
        a.prototype.parseArrayBuffer = {
            bit8: function(e) {
                return new Uint8Array(e.slice(0, e.byteLength - 1));
            },
            bit16: function(e) {
                return new Uint16Array(e.slice(0, e.byteLength - 1));
            },
            bit10: function(e) {
                var t = (e.byteLength - 1) / 5;
                var i = new Uint16Array(t * 4);
                for (var n = 0; n < t; n++) {
                    var r = new Uint8Array(e.slice(n * 5, (n + 1) * 5));
                    var a = r[0];
                    var o = r[1];
                    var s = r[2];
                    var l = r[3];
                    var c = r[4];
                    var u = n * 4;
                    i[u] = (a << 8 | o & 192) >> 6;
                    i[u + 1] = ((o & 63) << 8 | s & 240) >> 4;
                    i[u + 2] = ((s & 15) << 8 | l & 252) >> 2;
                    i[u + 3] = (l & 3) << 8 | c;
                }
                return i;
            },
            bit14: function(e) {
                throw new Error("14 bit uncompressed file is not supported yet");
            },
            getSampleData: function(e, t) {
                var n = null;
                if (t === "<") {
                    n = e;
                } else if (t === ">") {
                    var r = e >> 8;
                    var a = (e & 255) << 8;
                    n = a | r;
                } else {
                    i.error("ERROR! Endian is undefined!");
                    throw "ERROR! Endian is undefined!";
                }
                return n;
            }
        };
        a.prototype.prepareUncompressedDataForDemosaik = function(e, t) {
            var i = this;
            var r = n.getRawIFD(e);
            var a = r.endian;
            var o = i.parseArrayBuffer["bit" + r["BitsPerSample"]](t);
            var s = [];
            var l = o.length - 1;
            var c = r["TileWidth"];
            var u = i.parseArrayBuffer.getSampleDatal;
            for (var f = 0; f < l; ) {
                var d = new Uint32Array(c);
                var h = o[f];
                for (var p = 0; p < c; p++) {
                    d[p] = getSampleData(h, a);
                    f++;
                }
                s.push(d);
            }
            e.decompressedData = s;
            i.decodeDecompressedData(e);
            return true;
        };
        a.prototype.rawDataChunkReady = function(e, t, i) {
            if (n.isRawUncompressed(e)) {
                this.prepareUncompressedDataForDemosaik(e, t);
            } else {
                this.decompressChunk(e, t, i);
            }
        };
        a.prototype.decompressRawData = function(t, r) {
            i.blockui("Decompressing data...");
            if (n.isJPG(t)) {
                return this.callback({
                    rgb: r,
                    width: t.thumbnail.original.raw.width,
                    height: t.thumbnail.original.raw.height,
                    timestamp: new Date()
                });
            }
            if (n.isRawUncompressed(t)) {
                return this.prepareUncompressedDataForDemosaik(t, r);
            }
            var a = n.getRootIFD(t);
            var o = n.getRawIFD(t);
            var s = this;
            console.time("JPG decompression");
            var l = {
                type: t.mimeType,
                data: r,
                ifdRoot: a,
                ifdRaw: o
            };
            var c = new e(l);
            c.require(window.location.origin + "/assets/js/decoders/BitPumpJpeg.js");
            c.require(window.location.origin + "/assets/js/decoders/BitPumpMSB.js");
            c.require(window.location.origin + "/assets/js/decoders/LJpegDecompressor.js");
            c.require(window.location.origin + "/assets/js/decoders/NEFJpegDecompressor.js");
            c.require(window.location.origin + "/assets/js/decoders/NEFDecoder.js");
            c.require(window.location.origin + "/assets/js/decoders/CR2Decoder.js");
            var u = function(e) {
                console.error(e);
                s.errback(e);
            };
            c.spawn(function(e) {
                var t;
                if (e.type === "image/x-canon-cr2") {
                    t = new CR2Decoder();
                } else if (e.type === "image/x-nikon-nef") {
                    t = new NEFDecoder();
                } else {
                    throw new Error("ERROR: No decoder found for this raw type!");
                }
                return t.decode(e.data, e.ifdRoot, e.ifdRaw);
            }, u).then(function(e) {
                console.timeEnd("JPG decompression");
                console.time("Additional metadata decoding");
                var t = a["Make"], i = a["Model"];
                n.fillIFDWithCachedMetadata(t, i, a, o);
                console.timeEnd("Additional metadata decoding");
                console.time("Preparing for demosaic");
                return {
                    rawdata: e,
                    ifdRoot: a,
                    ifdRaw: o
                };
            }, u).spawn(function(e) {
                var t = e.rawdata;
                var i = e.ifdRaw["ImageLength"], n = e.ifdRaw["ImageWidth"];
                var r = new Array(i);
                for (var a = 0; a < i; a++) {
                    r[a] = new Uint32Array(t.subarray(a * n, (a + 1) * n));
                }
                return r;
            }, u).then(function(e) {
                console.timeEnd("Preparing for demosaic");
                t.decompressedData = e;
                s.decodeDecompressedData(t);
            }, u);
        };
        a.prototype.decompressChunk = function(t, r, a) {
            var o = this;
            var s = "Chunk JPG decompression: tiles " + a.tiles[0] + "-" + a.tiles[a.tiles.length - 1];
            console.time(s);
            var l = function(e) {
                i.log("Error: " + e.data.message);
            };
            var c = function(e) {
                console.timeEnd(s);
                var i = e.length;
                for (var n = 0; n < i; n++) {
                    o.chunkDecoded(e[n].tile, e[n].image, d, t);
                }
            };
            var u = function(e) {
                var t = e.chunk;
                var i = e.ifd;
                var n = e.tiles;
                var r = [];
                var a = i.TileOffsets[n[0]];
                var o = 0;
                var s = 0;
                var l = n.length;
                for (var c = 0; c < l; c++) {
                    o = i.TileOffsets[n[c]] - a;
                    s = i.TileByteCounts[n[c]];
                    var u = new Uint8Array(t.slice(o, o + s));
                    var f = new DNGJpegDecompressor(i.TileWidth, i.TileLength);
                    f.setData(u);
                    f.parse();
                    var d = f.getDecodedImage();
                    r.push({
                        tile: n[c],
                        image: d
                    });
                }
                return r;
            };
            var f = r;
            var d = n.getRawIFD(t);
            var h = a.tiles;
            var p = new e({
                chunk: f,
                ifd: d,
                tiles: h
            }, {
                maxWorkers: 32,
                evalPath: window.location.origin + "/assets/js/lib/eval.js"
            });
            p.require(window.location.origin + "/assets/js/decoders/DNGJpegDecompressor.js?v=0.14.0");
            p.map(u).then(c, l);
            return;
        };
        a.prototype._createDecompressedData = function(e) {
            console.time("Create bayer array");
            var t = n.getRawIFD(e);
            var i = Math.ceil(t.ImageWidth / t.TileWidth);
            var r = Math.ceil(t.ImageLength / t.TileLength);
            var a = i * t.TileWidth;
            e.decompressedData = new Array(r * t.TileLength);
            var o = e.decompressedData.length;
            for (var s = 0; s < o; s++) {
                e.decompressedData[s] = new Uint32Array(a);
            }
            console.timeEnd("Create bayer array");
        };
        a.prototype.chunkDecoded = function(e, t, i, n) {
            var r = this;
            if (!n.tilesArrived) n.tilesArrived = new Array(i.TileOffsets.length);
            n.tilesArrived[e] = t;
            var a = Object.keys(n.tilesArrived).length;
            if (a >= i.TileOffsets.length) {
                this._createDecompressedData(n);
                for (var o = 0; o < n.tilesArrived.length; o++) {
                    var s = n.tilesArrived[o];
                    var l = n.tilePositions[o];
                    for (var c = 0; c < s.length; c++) {
                        n.decompressedData[l[0] + c].set(s[c], l[1]);
                    }
                }
                n.tilesArrived.length = 0;
                n.tilesArrived = null;
                r.decodeDecompressedData(n);
            }
        };
        a.prototype.decodeStage1 = function() {
            var e = n.getRawIFD(app.developView.descriptor);
            var t = n.getRootIFD(app.developView.descriptor);
            console.time("Construct decoder");
            var i = new DNGDecoder(e, t, 0);
            console.timeEnd("Construct decoder");
            console.time("Init decoder");
            i.init();
            console.timeEnd("Init decoder");
            console.time("Set bayer data to decoder");
            i.setBayerData(app.developView.descriptor.get("decompressedData"));
            console.timeEnd("Set bayer data to decoder");
            console.time("Extrapolate");
            i.extrapolate();
            console.timeEnd("Extrapolate");
            var r = new Uint8ClampedArray(i.getRGBData().buffer);
            var a = {
                width: 0,
                height: 0
            };
            this.callback(r, i.getWidth(), i.getLength());
            return;
        };
        a.prototype.decodeStage1onGPU = function() {
            console.time("Construct decoder");
            rawDecoder = new DNGGLDecoder(app.developView.descriptor, 0);
            console.timeEnd("Construct decoder");
            console.time("Set bayer data to decoder");
            rawDecoder.setBayerData(app.developView.descriptor.decompressedData);
            console.timeEnd("Set bayer data to decoder");
            console.time("Init decoder");
            rawDecoder.init(function() {
                console.time("Extrapolate");
                rawDecoder.extrapolate();
                console.timeEnd("Extrapolate");
                this.callback(rawDecoder.getWidth(), rawDecoder.getLength(), rawDecoder.getRGBData());
            });
            console.timeEnd("Init decoder");
        };
        a.prototype.decodeDecompressedData = function(t) {
            i.blockui("Decoding raw data...");
            console.time("Demosaicing");
            var r = this;
            var a = function(e) {
                var t = e.firstLineIndex, i = e.ifd, n = e.ifdRoot, r = e.rows, a = e.decodingParams;
                if (a && a.BaselineExposure) a.BaselineExposure += n.BaselineExposure;
                var o = new DNGDecoder(i, n, t, a);
                o.init();
                o.setBayerData(r);
                o.extrapolate();
                var s = o.getRGBData();
                return {
                    width: o.getWidth(),
                    height: o.getLength(),
                    rgbData: s,
                    firstLineIndex: t
                };
            };
            var o = n.getRawIFD(t);
            var s = n.getRootIFD(t);
            var l = t.decompressedData[0].length;
            var c = {
                width: 0,
                height: 0
            };
            var u = 400;
            var f = Math.ceil(t.decompressedData.length / u);
            var d = r.decodingParams;
            var h = new Array(f);
            for (var p = 0; p < f; p++) {
                var g = p * u;
                h[p] = {
                    rows: [],
                    ifd: o,
                    ifdRoot: s,
                    firstLineIndex: g,
                    decodingParams: d
                };
            }
            var m = t.decompressedData.length;
            var v = t.decompressedData;
            for (var y = 0; y < m; y++) {
                var b = ~~(y / u);
                var w = new Uint32Array(v[y].buffer);
                h[b].rows.push(w);
            }
            var C = new e(h, {
                maxWorkers: 32,
                evalPath: window.location.origin + "/assets/js/lib/eval.js"
            });
            C.require(window.location.origin + "/assets/js/decoders/DNGMatrix.js?v=0.14.0");
            C.require(window.location.origin + "/assets/js/decoders/DNGTable.js?v=0.14.0");
            C.require(window.location.origin + "/assets/js/decoders/DNGColor.js?v=0.14.0");
            C.require(window.location.origin + "/assets/js/decoders/DNGColorSpace.js?v=0.14.0");
            C.require(window.location.origin + "/assets/js/decoders/DNGTemperature.js?v=0.14.0");
            C.require(window.location.origin + "/assets/js/decoders/DNGDecoder.js?v=0.14.0");
            var m = t.decompressedData.length * l * 4;
            console.log("Trying to allocate %d bytes: ", m);
            var x = new Uint8ClampedArray(m);
            C.map(a).then(function(e) {
                console.timeEnd("Demosaicing");
                console.time("Glueing");
                var a = e.length;
                for (var o = 0; o < a; o++) {
                    var s = e[o];
                    var u = s.firstLineIndex * l * 4;
                    x.set(s.rgbData, u);
                    c.width = s.width;
                    c.height = s.height;
                    s = null;
                }
                console.timeEnd("Glueing");
                console.time("FIXME: PrepareFloatToUint8");
                console.timeEnd("FIXME: PrepareFloatToUint8");
                var f = n.getRawIFD(t);
                var d = f.ActiveArea[1];
                var h = f.ActiveArea[0];
                var p = f.ActiveArea[3] - f.ActiveArea[1];
                var g = f.ActiveArea[2] - f.ActiveArea[0];
                i.unblockui();
                r.callback({
                    rgb: x,
                    width: c.width,
                    height: c.height,
                    crop: {
                        x: d,
                        y: h,
                        width: p - 2,
                        height: g - 2
                    },
                    timestamp: new Date()
                });
            });
        };
        return a;
    };
    if (typeof define === "function") {
        define("DecodeService", [ "Parallel", "environment", "LoggingService", "MetadataService", "ImageDescriptor", "CR2Decoder", "NEFDecoder" ], function() {
            return i.apply(this, arguments);
        });
    } else {
        if (typeof e.DecodeService === "undefined") {
            e.DecodeService = i(e.Parallel, e.PicsIO, e.LoggingService, e.MetadataService, e.ImageDescriptor, e.CR2Decoder);
        }
    }
})(this);

define("LambdaDecodeService", [ "require", "MetadataService", "FiltersService", "backbone", "q", "utils", "environment" ], function(e) {
    var t = e("MetadataService");
    var i = e("FiltersService");
    var n = e("backbone");
    var r = e("q");
    var Utils = e("utils");
    var a = e("environment");
    return {
        _upload: function(e, t) {
            var i = r.defer();
            var n = new XMLHttpRequest();
            n.upload.addEventListener("progress", function(e) {
                if (e.lengthComputable) {
                    var t = e.loaded / e.total;
                    i.notify({
                        msg: "Uploading image... {1}%".assign(Math.round(t * 100)),
                        progress: t
                    });
                }
            });
            n.addEventListener("error", function() {
                console.error("Error happened uploading to S3 bucket");
                return i.reject("Error happened uploading file");
            }, false);
            n.upload.addEventListener("load", function() {
                i.notify({
                    msg: "Image uploaded..."
                });
                i.resolve();
            });
            i.notify({
                msg: "Uploading image..."
            });
            n.open("PUT", e);
            n.setRequestHeader("x-amz-acl", "public-read");
            n.overrideMimeType(t.type);
            n.send(t);
            return i.promise;
        },
        _poll: function(e, t, i) {
            var n = r.defer();
            t = t || 10;
            i = i || 1e3;
            var a = 0;
            (function o() {
                var r = new XMLHttpRequest();
                r.open("GET", e, true);
                r.responseType = "blob";
                r.onerror = r.ontimeout = function() {
                    console.log("Error happened polling S3 bucket");
                    setTimeout(o, i);
                    return;
                };
                r.onload = function(e) {
                    n.notify({
                        msg: "Converting image..."
                    });
                    if (this.status == 200) {
                        n.notify({
                            msg: "Downloading image..."
                        });
                        var r = this.response;
                        n.resolve(r);
                    } else if (a++ < t) {
                        setTimeout(o, i);
                    } else {
                        n.reject(new Error("timed out"));
                    }
                };
                r.send();
            })();
            return n.promise;
        },
        _cleanup: function(e, t) {
            if (!e) {
                console.warn("url is not specified for cleanup");
                return r.resolve(t);
            }
            var i = r.defer();
            var n = new XMLHttpRequest();
            n.addEventListener("load", function() {
                i.notify({
                    msg: "Finishing..."
                });
                i.resolve(t);
            });
            i.notify({
                msg: "Finishing..."
            });
            n.open("DELETE", e);
            n.send();
            return i.promise;
        },
        decode: function(e, t) {
            var i = e.file;
            var n = i.name.split(".").pop();
            var r = Utils.uuid("xyxyxyxyxyxyxyxyxy");
            var o = r + "." + n;
            var s = a.config.s3.buckets.inputLambdaConverter + o;
            var l = a.config.s3.buckets.outputLambdaConverter + o + ".jpg";
            var c = this;
            return this._upload(s, i).then(c._poll.bind(c, l, 60 * 5, 1e3)).then(c._cleanup.bind(c, s)).then(c._cleanup.bind(c, l));
        }
    };
});

define("MemoryscoreService", [ "require", "backbone", "q", "utils", "environment" ], function(e) {
    var t = e("backbone");
    var i = e("q");
    var Utils = e("utils");
    var n = e("environment");
    return {
        analyze: function(e, t) {
            var r = i.defer();
            var a = new Uint8Array(t);
            var o = new XMLHttpRequest();
            o.onreadystatechange = function() {
                r.notify({
                    uid: e,
                    msg: "Analyzing image... {1}%".assign(o.readyState * 20)
                });
                if (o.readyState == 4) {
                    try {
                        var t = JSON.parse(o.response).memoryscore;
                        return r.resolve({
                            uid: e,
                            memoryscore: t
                        });
                    } catch (i) {
                        return r.reject({
                            uid: e,
                            msg: "Can't get memoryscore"
                        });
                    }
                }
            };
            r.notify({
                uid: e,
                msg: "Analyzing image..."
            });
            o.open("POST", n.config.vocalbee.url);
            o.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
            o.send(a);
            return r.promise;
        }
    };
});

(function() {
    function e(e, t, i, n, r, a) {
        if (t[e]) {
            i.push(e);
            if (t[e] === true || t[e] === 1) {
                n.push(r + e + "/" + a);
            }
        }
    }
    function t(e, t, i, n, r) {
        var a = n + t + "/" + r;
        if (require._fileExists(e.toUrl(a + ".js"))) {
            i.push(a);
        }
    }
    function i(e, t, n) {
        var r;
        for (r in t) {
            if (t.hasOwnProperty(r) && (!e.hasOwnProperty(r) || n)) {
                e[r] = t[r];
            } else if (typeof t[r] === "object") {
                if (!e[r] && t[r]) {
                    e[r] = {};
                }
                i(e[r], t[r], n);
            }
        }
    }
    define("i18n", [ "module" ], function(n) {
        var r = n.config ? n.config() : {};
        return {
            version: "2.0.4",
            load: function(n, a, o, s) {
                s = s || {};
                if (s.locale) {
                    r.locale = s.locale;
                }
                var l = s.i18n && s.i18n.nls || "nls";
                var c = new RegExp("(^.*(^|/)" + l + "(/|$))([^/]*)/?([^/]*)");
                var u, f = c.exec(n), d = f[1], h = f[4], p = f[5], g = h.split("-"), m = [], v = {}, y, b, w = "";
                if (f[5]) {
                    d = f[1];
                    u = d + p;
                } else {
                    u = n;
                    p = f[4];
                    h = r.locale;
                    if (!h) {
                        h = r.locale = typeof navigator === "undefined" ? "root" : (navigator.language || navigator.userLanguage || "root").toLowerCase();
                    }
                    g = h.split("-");
                }
                if (s.isBuild) {
                    m.push(u);
                    t(a, "root", m, d, p);
                    for (y = 0; y < g.length; y++) {
                        b = g[y];
                        w += (w ? "-" : "") + b;
                        t(a, w, m, d, p);
                    }
                    a(m, function() {
                        o();
                    });
                } else {
                    a([ u ], function(t) {
                        var n = [], r;
                        e("root", t, n, m, d, p);
                        for (y = 0; y < g.length; y++) {
                            r = g[y];
                            w += (w ? "-" : "") + r;
                            e(w, t, n, m, d, p);
                        }
                        a(m, function() {
                            var e, r, s;
                            for (e = n.length - 1; e > -1 && n[e]; e--) {
                                s = n[e];
                                r = t[s];
                                if (r === true || r === 1) {
                                    r = a(d + s + "/" + p);
                                }
                                i(v, r);
                            }
                            o(v);
                        });
                    });
                }
            }
        };
    });
})();

define("assets/js/picsio-raw/localization/strings", {
    root: {
        INDEX: {
            SELF_LINK: "https://raw.pics.io",
            TITLE: "Online Raw Converter | Develop and Convert CR2/NEF/ARW/ORF/PEF/RAF/DNG for free",
            KEYWORDS: "raw, converter, cr2, nef, arw, raf, pef, orf, dng, pdf, canon, nikon, jpeg, jpg, convert, photo, image, exposure, whitebalance, wb",
            DESCRIPTION: "Raw.pics.io is a converter for PDF (Adobe), CR2 (Canon), NEF (Nikon), ARW (Sony), ORF (Olympus), PEF (Pentax), RAF (Fujifilm) and DNG images. It allows to edit CR2, NEF ORF, PEF, RAF and ARW photos online.",
            SITE_TITLE: "Best RAW file converter",
            SITE_DESCRIPTION: "<p>Raw.pics.io is an in-browser files converter. You can convert image, pictures and photo from RAW camera format with the converter. It allows to convert PDF, CR2, NEF, ARW, ORF, PEF, RAF, DNG and other les into JPEG, PNG and other formats online. We support Canon and Nikon raw formats directly.</p><p>As well our service allows to resize your JPG les. We don't upload your images to the Internet, performing all manipulations right in your browser which is super secure.</p>",
            OPEN_PHOTOS: "Open &#xfb01;les",
            ADD_NEW_PHOTOS: "Add new &#xfb01;les",
            SAVE_THIS_PHOTO: "Save this &#xfb01;le",
            SAVE_ALL_PHOTOS: "Save All",
            SAVE_ALL_AS_PDF: "Save All to PDF",
            EDIT_PHOTO: "Edit",
            BTN_CREATE_WEBSITE: "Create website",
            BTN_HELP: "Help",
            RESET_EXPOSURE: " Reset",
            EXPOSURE: "Exposure",
            ADD_RAW_FILES: "Drop or open<br /> your file",
            SAVE_AS_JPG: "Convert",
            HOW_IT_WORKS: "See how it works",
            DROP_PHOTO_TO_CONVERT: "Drop &#xfb01;les to convert!",
            OR: "or",
            OPEN_PHOTO_TO_CONVERT: "Open &#xfb01;les from computer",
            SURVEY_TEXT: "Please help us to improve the service<br /> and ll out a short survey",
            SURVEY_NO: "No, thanks",
            SURVEY_YES: "Take our Survey",
            TWEET_MESSAGE: "Raw.Pics.io - Online Raw Converter via @TopTechPhoto. Supports CR2 (#Canon) and NEF (#Nikon) photos",
            DO_TWEET: "Tweet",
            SOCIAL_NETWORKS: "Keep in touch",
            FOLLOW_FB: "Follow @TopTechPhoto",
            SELECT_LANGUAGE: "Select your language",
            ABOUT_COMPANY_TITLE: "About TopTechPhoto",
            ABOUT_COMPANY_TEXT: "is a software development company with strong focus on imaging, cloud and collaboration. We develop products that enable creative people to do more doing less since 2009.",
            ABOUT_PICSIO_TITLE: "About pics.io",
            ABOUT_PICSIO_TEXT: "is a saas system that allows people to manage media assets in the cloud and businesses to use Google Drive as their Digital Asset Management and Version Control system.",
            ASK_QUESTION: "Questions & Suggestions",
            OUR_PRODUCTS: "OUR PRODUCTS",
            EDIT_TITLE: "Online photo editor",
            EDIT_DESCRIPTION: "Description & features",
            EDIT_MORE_TEXT: "About Edit",
            RAW_CONVERT_RAW_TO_JPG: "Converts RAW to JPEG",
            RAW_CONVERT_CR2_TO_JPG: "Converts CR2 images",
            RAW_CONVERT_NEF_TO_JPG: "Converts NEF images",
            RAW_CONVERT_PDF_TO_JPG: "Convert PDF to JPG",
            RAW_CONVERT_JPG_TO_PDF: "Convert JPG to PDF",
            RAW_HOWTO_CONVERT: "How to convert",
            RAW_ONLINE_CONVERTER_AND_RESIZER: "Online raw converter and photo resizer",
            RAW_RESIZE_PHOTO_ONLINE: "Resize photo online",
            LIVE_TITLE: "Live photo sharing",
            LIVE_MORE_TEXT: "About Live",
            BLOG_TITLE: "Blog homepage",
            CONTACTS_TITLE: "CONTACT",
            SUPPORT: "Support:",
            SUPPORT_WEBSITE: "Helpdesk",
            SUPPORT_EMAIL: "Support Email",
            HIRING: "Jobs:",
            HIRING_JS_DEVELOPER: "JS Developer",
            FOLLOW_US_TWITTER: "Follow us in Twitter",
            COPYRIGHT: "Copyright &copy; 2009-2015<br /> <a href='http://toptechphoto.com'>TopTechPhoto</a>. All rights reserved.",
            TERMS: "<a href='https://docs.google.com/document/d/19FIWIPdvBgHNhxLQ3v6QuXKv-xGphtCOajEl4dnKITs/edit'>Terms of Use</a>",
            PRIVACY_POLICY: "<a href='https://docs.google.com/document/d/18A8ainNuU3pDctZwfb1mQ8aHTwcLX8Te7BPo5Jrzk6Q/edit?usp=sharing'>Privacy Policy and Cookies</a>"
        },
        SHARE_THIS_PHOTO_TO_FB: "Share this &#xfb01;le to FB",
        SHARE_TO_FB: "Share to FB",
        SHOW_JPG: "<span>show</span> jpg",
        SHOW_RAW: "<span>show</span> raw",
        WHITE_BALANCE: "White Balance",
        DRAWING_IMAGE: "Drawing image...",
        CONVERTING_IMAGE: "Converting image...",
        SHARING_TO_FB: "Sharing to FB...",
        FB_POST_TEXTS: {
            "0": "Whoa! RAW by Pics.io allowed me to convert my RAW right in the browser. Photogs, you have to try it too > https://raw.pics.io #RawPicsio",
            "1": "Whod knew well be able to edit RAW in a browser in 2014? http://raw.pics.io #RawPicsio",
            "2": "Hard to believe but theres a web service that handles RAW in a browser. Photogs, you have to try it too > https://raw.pics.io #RawPicsio"
        },
        CAMERA_IS_NOT_SUPPORTED_YET: "Camera is not supported yet!",
        CAMERA_IS_NOT_SUPPORTED_YET_TPL: "Camera {1} is not supported yet. Contact support@pics.io and we'll add it.",
        FORMAT_IS_NOT_SUPPORTED_YET_TPL: "File {1} skipped. Format is not supported yet!",
        CANT_CONVERT_FILE: "Can't convert file",
        CANT_DRAW_IMAGE_TPL: "Can't render {1} file",
        NEVER_ASK_AGAIN: "Never ask again",
        ENABLE_POPUPS_TTITLE: "Enable popups",
        ENABLE_POPUPS_TEXT: "Make sure Popups are enabled in your browser",
        SAVE_MANY_FILES_POPUP_TITLE: "Warning",
        SAVE_MANY_FILES_POPUP_TEXT_TPL: "You are trying to save {1} files.<br /><br />Processing a lot of files may cause a crash of the browser page.<br /><br />If you are experiencing any issues while saving a lot of files, try to split them in a few smaller batches and convert subsequently.",
        CONVERTED_NUMBER_FILES: "<b></b> &#xfb01;les converted",
        SAVE_CHANGES: "Save changes?",
        SAVE_CHANGES_TEXT: "Do you want to save changes?",
        DIALOGS: {
            FAILED_TO_CONVERT: {
                TITLE: "Convert",
                YES: "Convert",
                NO: "Skip",
                MSG_1_FILE: "Unable to process file. Try to use serverside converter?<br/><br/>Please note it may take a time on slow connections.",
                MSG_10LESS_FILES_TPL: "Unable to process {1} files:<br/><br/>{2}<br/><br/>Try to use serverside converter?<br/><br/>Please note it may take a time on slow connections.",
                MSG_10MORE_FILES_TPL: "Unable to process {1} files including:<br/><br/>{2}<br/>...and more<br/><br/>Try to use serverside converter?<br/><br/>Please note it may take a time on slow connections."
            },
            FILES_SAVED: {
                TITLE: "Information",
                YES: "OK",
                TEXT: "The files are saved to your browser Downloads folder, you may find them there.",
                TEXT_SAFARI: "Convertation process is finished. You may find converted files in new tabs of the browser. This is only the way Safari allows. For better experience please use FireFox or Chrome browsers."
            }
        },
        PAYMENT_FORM: {
            LOADING: "Loading form...",
            TEXT_UNLIMITED_ACCESS: "You are one step away from getting unlimited access",
            MESSAGE_BATCH: {
                TITLE: "It seems you're trying to convert several files",
                TEXT: "<span class='innerText'>To continue, please, <span class='whiteHighlight'><span>buy a <b>lifetime access</b></span> <span>for the cost of one coffee ($2.99)</span></span> or <b>share our page</b> to your friends. <span class='txtFree'>As well, you will be able to perform true raw decoding for Canon/Nikon/DNG files.<br />Or you may continue using one file at a time conversion for free.</span></span>"
            },
            MESSAGE_RAW: {
                TITLE: "True raw decoding is unavailable in free version",
                TEXT: "<span class='innerText'>To continue, please, <span class='whiteHighlight'><span>buy a <b>lifetime access</b></span> <span>for the cost of one coffee ($2.99)</span></span> or <b>share our page</b> to your friends. <span class='txtFree'>As well, you will be able to do batch conversion.<br />Or you still may continue using jpeg extraction for free.</span></span>"
            },
            MESSAGE_MULTIPLE_FILES: {
                TITLE: "It seems youre converting a lot",
                TEXT: "<span class='innerText'>To continue, please, <span class='whiteHighlight'><span>buy a <b>lifetime access</b></span> <span>for the cost of one coffee ($2.99)</span></span> or <b>share our page</b> to your friends. <span class='txtFree'>As well, you will be able to do batch conversion and true raw decoding for Canon/Nikon/DNG files</span></span>",
                PROPOSAL: "Unlimited c"
            },
            MESSAGE_PRIVATE_BROWSING: {
                TITLE: "It seems youre using private browsing mode",
                TEXT: "<span class='innerText'>To continue, please, <span class='whiteHighlight'><span>buy a <b>lifetime access</b></span> <span>for the cost of one coffee ($2.99)</span></span> or <b>share our page</b> to your friends. <span class='txtFree'>As well, you will be able to do batch conversion and true raw decoding for Canon/Nikon/DNG files</span></span>"
            },
            SHARE_TO_FACEBOOK: "Share to facebook",
            BUY_WITH_PAYPAL: "Buy now with paypal",
            BUY_WITH_CREDIT_CARD: "Buy now with credit card",
            RESTORE_MESSAGE: "Type 'Lifetime raw.pics.io' order number or your email:",
            ERROR_EMPTY_ORDER_NUMBER: "Order number/email can't be empty",
            ERROR_CANT_RESTORE_PAYMENT: "Can't restore payment. Check your order number/email and try again.",
            ERROR_CANT_RESTORE_PAYMENT_SERVER_UNAVAILABLE: "Payment server is unavailable. To restore your purchase contact support@pics.io.",
            ERROR_CANT_RESTORE_PAYMENT_EXPIRED: "Your payment is expired. To continue please purchase raw.pics.io.",
            PAYMENT_RESTORED: "Payment successfully restored",
            PAYMENT_NAME_TPL: "Raw.pics.io (only ${1})",
            PAY_BUTTON_TPL: "Pay {{amount}}",
            PAYMENT_DESCRIPTION: "Access to raw.pics.io",
            PAYPAL_NOT_READY_YET_TEXT: "PayPal payment option is unavailable now. We're working to make it available.<br/><br/>You still may pay with credit card.",
            PAYMENT_COMPLETE_TPL: "Your purchase is complete. Please use your charge number <b>{1}</b> or your email(<b>{2}</b>) to restore your purchase.",
            ERROR_CANT_PROCEED_PAYMENT: "Can't proceed payment. Your card WON'T be charged. This indicates technical problems. Please contact support@pics.io.",
            TEXT_SHARE_FOR_SPREAD_WORLD: "Please, help us to spread a word about this service. Share this message among your friends on <span class='btnFB'>FaceBook</span> and <span class='btnTW'>Tweeter</span>!",
            I_FOUND_PRETTY_CONVERTER: "I found pretty cool raw converter.  Check this out - http://raw.pics.io.",
            TITLE_TABLE: "Secure credit card payment",
            TABLE_OF_PRICES: [ {
                label: '<span class="valPrice">$2.99</span>One month of unlimited raw conversion and resizing',
                value: "2.99",
                checked: true
            }, {
                label: '<span class="valPrice">$4.99</span>Lifetime unlimited raw conversion and resizing',
                value: "4.99"
            } ],
            SECOND_TABLE_OF_PRICES: {
                ONE_TIME_FEE: "One time fee",
                LIFETIME_VALUE: "$4.99",
                MONTH_VALUE: "$2.99",
                URCAIR: "Ulimited raw conversion and image resizing",
                TXT_LIFETIME: "Lifetime",
                TXT_ONE_MONTH: "One month",
                CHOOSE_PERIOD: "Choose period"
            },
            BTN_PAY: "Pay by credit card with Stripe&trade;",
            BTN_BUY_LATER: "I'm not ready to buy right now<i class=\"hiddenForC\">,<br />I'll be back later.</i>",
            TEXT_WE_DONT_STORE: "We don't store your credit card information",
            TEXT_WHAT_HAPPENS_NEXT: "What happens next? You will be able to convert and resize any number of photos.",
            TEXT_REFUND: '"No questions asked" refund',
            BTN_RESTORE_PREV_PURCHASE: "Restore previous purchase (login)"
        }
    },
    ru: true,
    it: true,
    pt: true,
    fr: true,
    es: true
});

define("RawImageDescriptor", [ "require", "ImportImageDescriptor", "FileSystemStorage", "ThumbnailService", "MetadataService", "FiltersService", "DecodeService", "LambdaDecodeService", "MemoryscoreService", "backbone", "q", "utils", "i18n!assets/js/picsio-raw/localization/strings", "environment" ], function(e) {
    var t = e("ImportImageDescriptor");
    var i = e("FileSystemStorage");
    var n = e("ThumbnailService");
    var r = e("MetadataService");
    var a = e("FiltersService");
    var o = e("DecodeService");
    var s = e("LambdaDecodeService");
    var l = e("MemoryscoreService");
    var c = e("backbone");
    var u = e("q");
    var Utils = e("utils");
    var f = e("i18n!assets/js/picsio-raw/localization/strings");
    var d = e("environment");
    return t.extend({
        initialize: function(e, t) {
            this.set("uid", e.name);
            this.set("decodingParams", {
                exposureCompensationValue: 0,
                selectedSourceSegment: "jpg",
                selectedwb: "asShot"
            });
            this.set("storage", new i());
        },
        isProcessingFailed: function() {
            var e = this.get("failedStatus");
            return !!e;
        },
        generateThumbnail: function(e) {
            var t = e && e.mode || "basic";
            var i = this;
            var a = this.toJSON();
            if (a.thumbnail && a.thumbnail.original && a.thumbnail.small300) {
                return u.resolve(i);
            }
            var o = function() {
                if (t === "lambda") {
                    return s.decode(a).then(function(e) {
                        var t = URL.createObjectURL(e);
                        var i = URL.createObjectURL(e.slice());
                        try {
                            var n = a.metadata.preview.orientation;
                        } catch (r) {
                            n = 1;
                        }
                        return u.resolve({
                            original: {
                                url: t,
                                orientation: n
                            },
                            small300: {
                                url: i,
                                orientation: n
                            }
                        });
                    });
                } else {
                    var e = d.config.formats.LAMBDA_CONVERTABLE_FORMATS.indexOf(a.mimeType) === -1;
                    if (!e && t != "lambda") {
                        var i = r.readyForWhat(a);
                        if (!i.thumbnailing) {
                            var o = new Error(f.CAMERA_IS_NOT_SUPPORTED_YET_TPL.assign(a.metadata.root.Model));
                            o.code = "unsupported_camera";
                            return u.reject(o);
                        }
                    }
                    var l = u.defer();
                    n.getThumbnail({
                        object: Object.clone(a),
                        thumbnails: [ "original", "small300" ],
                        doNotRevokeBlobs: true,
                        success: l.resolve
                    });
                    return l.promise;
                }
            };
            var l = u.defer();
            o().progress(function(e) {
                l.notify({
                    descriptor: i,
                    message: e
                });
            }).then(function(e) {
                i.set("thumbnail", e);
                return l.resolve(i);
            }).fail(function(e) {
                l.reject(e);
            });
            return l.promise;
        },
        setThumbnail: function(e, t) {
            var i = this.get("thumbnail");
            var n = i[e] || {};
            if (n.url) {
                URL.revokeObjectURL(n.url);
            }
            i[e] = Object.merge(n, t);
            if (e === "small300") {
                this.trigger("thumbnail:small:changed", this);
            }
            this.trigger("thumbnail:changed", this);
        },
        hasOriginalData: function() {
            return !!this.get("thumbnail").originalData;
        },
        hasOriginalDataFromLambda: function() {
            return !!this.get("originalData");
        },
        decodeImage: function(e) {
            var t = e && e.mode || "basic";
            var i = this;
            var n = this.toJSON();
            if (t === "lambda") {
                if (e && e.skipIfDecoded && i.hasOriginalDataFromLambda()) {
                    return u.resolve(n);
                }
                return s.decode(n, e).then(function(e) {
                    var t = u.defer();
                    var n = URL.createObjectURL(e);
                    var r = new Image();
                    r.onload = function() {
                        var e = document.createElement("canvas");
                        e.width = r.width;
                        e.height = r.height;
                        var n = e.getContext("2d");
                        n.drawImage(r, 0, 0);
                        var a = n.getImageData(0, 0, e.width, e.height);
                        i.set("originalData", a);
                        t.resolve(i);
                    };
                    r.src = n;
                    return t.promise;
                });
            } else {
                if (e && e.skipIfDecoded && i.hasOriginalData()) {
                    return u.resolve(n);
                }
                var r = u.defer();
                new o(n, e, function(e) {
                    var t;
                    try {
                        t = n.metadata.root.Orientation;
                    } catch (o) {
                        t = 1;
                    }
                    a.getBlob(e.rgb, e.width, e.height, t, e.crop, function(e) {
                        var n = e.blob;
                        i.setThumbnail("originalData", {
                            url: URL.createObjectURL(n),
                            orientation: t
                        });
                        r.resolve(i);
                    });
                }, function(e) {
                    r.reject(e);
                });
                return r.promise;
            }
        },
        generateMetadata: function() {
            var e = this;
            var t = u.defer();
            r.getMetadataForFile(this.toJSON(), function(i) {
                e.set("metadata", i.metadata);
                t.resolve(e);
            }, function(i) {
                console.error(i);
                t.resolve(e);
            }, {
                includeFilter: [],
                excludeFilter: [],
                fillFromCachedMetadataFile: true
            });
            return t.promise;
        },
        calculateMemoryscore: function() {
            var e = this;
            var t = e.get("uid");
            var i = this.get("thumbnail");
            var n = e.get("memoryscore");
            if (!i) return u.resolve({
                uid: t,
                memoryscore: "N/A"
            });
            if (!i.original) return u.resolve({
                uid: t,
                memoryscore: "N/A"
            });
            if (!i.original.url) return u.resolve({
                uid: t,
                memoryscore: "N/A"
            });
            if (n) return u.resolve({
                uid: t,
                memoryscore: n
            });
            return Utils.getArrayBufferFromUrl(this.get("thumbnail").original.url).then(l.analyze.bind(this, t)).then(function(t) {
                e.set("memoryscore", t.memoryscore);
                console.log("Image analyzied for image {1}. Memoryscore = {2}".assign(t.uid, t.memoryscore));
                return t;
            });
        }
    });
});

define("RawPdfImageDescriptor", [ "require", "RawImageDescriptor", "backbone", "q" ], function(e) {
    var t = e("RawImageDescriptor");
    var i = e("backbone");
    var n = e("q");
    return t.extend({
        initialize: function(e, t) {
            var i = "{1} (page {2})".assign(e.name, t.pageNumber);
            this.set("uid", i);
            this.set("name", i);
            this.set("pageNumber", t.pageNumber);
            this.set("decodingParams", {
                exposureCompensationValue: 0,
                selectedSourceSegment: "jpg",
                selectedwb: "asShot"
            });
            this.set("mimeType", "image/png");
        },
        generateThumbnail: function() {
            var e = this;
            var t = e.toJSON();
            var i = t.file.pdf;
            t.mimeType = "image/png";
            return i.getPage(t.pageNumber).then(function(t) {
                var i = document.createElement("canvas");
                var r = 2;
                var a = t.getViewport(r);
                var o = i.getContext("2d");
                i.height = a.height;
                i.width = a.width;
                var s = {
                    canvasContext: o,
                    viewport: a
                };
                return t.render(s).then(function() {
                    var t = n.defer();
                    i.toBlob(function(n) {
                        var r = URL.createObjectURL(n);
                        e.set("thumbnail", {
                            small300: {
                                orientation: 1,
                                url: i.toDataURL()
                            },
                            original: {
                                orientation: 1,
                                url: r
                            }
                        });
                        t.resolve(e);
                    });
                    return t.promise;
                }.bind(this));
            });
        }
    });
});

define("decode", [], function() {
    var e = {
        fromClampedArray8ToFloatArray32: function(e) {
            var t = Math.pow(2, 8) - 1;
            var i = e.length;
            var n = new Float32Array(i);
            while (i--) {
                n[i] = e[i] / t;
            }
            return n;
        }
    };
    return e;
});

define("resizeImage", [ "utils", "decode" ], function(e, t) {
    var i = function(t, i, n) {
        var r, a = document.createElement("canvas"), o = a.getContext("2d");
        n = n || "imageData";
        if (t instanceof Image || t instanceof HTMLCanvasElement) {
            r = e.getSize(t.width, t.height, i.width, i.height, i.orientation);
            var s = 500;
            if (i.smartResize && t.width > s && t.height > s) {
                console.log("Image resized by two step algorithm");
                var l = document.createElement("canvas"), c = l.getContext("2d");
                l.width = t.width;
                l.height = t.height;
                c.drawImage(t, 0, 0, t.width, t.height);
                var u = {
                    w: (t.width - r.width) / 2,
                    h: (t.height - r.height) / 2
                };
                var f = document.createElement("canvas"), d = f.getContext("2d");
                var h = {
                    w: t.width - u.w,
                    h: t.height - u.h
                };
                f.width = h.w;
                f.height = h.h;
                d.drawImage(l, 0, 0, t.width, t.height, 0, 0, h.w, h.h);
                a.width = r.width;
                a.height = r.height;
                o.drawImageWithOrientation(f, 0, 0, f.width, f.height, 0, 0, r.width, r.height, i.orientation);
            } else {
                console.log("Image resized by one step algorithm");
                a.width = r.canvasW;
                a.height = r.canvasH;
                o.drawImageWithOrientation(t, 0, 0, t.width, t.height, 0, 0, r.width, r.height, i.orientation);
            }
        } else if (t instanceof ImageData) {
            var p = document.createElement("canvas");
            var g = p.getContext("2d");
            p.width = t.width;
            p.height = t.height;
            g.putImageData(t, 0, 0);
            r = e.getSize(t.width, t.height, i.width, i.height, i.orientation);
            a.width = r.canvasW;
            a.height = r.canvasH;
            o.drawImageWithOrientation(p, 0, 0, p.width, p.height, r.width / 2, r.height / 2, r.width, r.height, i.orientation);
        }
        if (n == "imageData") {
            return o.getImageData(0, 0, r.width, r.height);
        } else {
            return o;
        }
    };
    return i;
});

(function(e, t) {
    if (typeof exports === "object" && exports) {
        t(exports);
    } else {
        var i = {};
        t(i);
        if (typeof define === "function" && define.amd) {
            define("mustache", i);
        } else {
            e.Mustache = i;
        }
    }
})(this, function(e) {
    var t = /\s*/;
    var i = /\s+/;
    var n = /\S/;
    var r = /\s*=/;
    var a = /\s*\}/;
    var o = /#|\^|\/|>|\{|&|=|!/;
    var s = RegExp.prototype.test;
    function l(e, t) {
        return s.call(e, t);
    }
    function c(e) {
        return !l(n, e);
    }
    var u = Object.prototype.toString;
    var f = Array.isArray || function(e) {
        return u.call(e) === "[object Array]";
    };
    function d(e) {
        return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g, "\\$&");
    }
    var h = {
        "&": "&amp;",
        "<": "&lt;",
        ">": "&gt;",
        '"': "&quot;",
        "'": "&#39;",
        "/": "&#x2F;"
    };
    function p(e) {
        return String(e).replace(/[&<>"'\/]/g, function(e) {
            return h[e];
        });
    }
    function g(e) {
        this.string = e;
        this.tail = e;
        this.pos = 0;
    }
    g.prototype.eos = function() {
        return this.tail === "";
    };
    g.prototype.scan = function(e) {
        var t = this.tail.match(e);
        if (t && t.index === 0) {
            this.tail = this.tail.substring(t[0].length);
            this.pos += t[0].length;
            return t[0];
        }
        return "";
    };
    g.prototype.scanUntil = function(e) {
        var t, i = this.tail.search(e);
        switch (i) {
          case -1:
            t = this.tail;
            this.pos += this.tail.length;
            this.tail = "";
            break;

          case 0:
            t = "";
            break;

          default:
            t = this.tail.substring(0, i);
            this.tail = this.tail.substring(i);
            this.pos += i;
        }
        return t;
    };
    function m(e, t) {
        this.view = e || {};
        this.parent = t;
        this._cache = {};
    }
    m.make = function(e) {
        return e instanceof m ? e : new m(e);
    };
    m.prototype.push = function(e) {
        return new m(e, this);
    };
    m.prototype.lookup = function(e) {
        var t = this._cache[e];
        if (!t) {
            if (e == ".") {
                t = this.view;
            } else {
                var i = this;
                while (i) {
                    if (e.indexOf(".") > 0) {
                        t = i.view;
                        var n = e.split("."), r = 0;
                        while (t && r < n.length) {
                            t = t[n[r++]];
                        }
                    } else {
                        t = i.view[e];
                    }
                    if (t != null) break;
                    i = i.parent;
                }
            }
            this._cache[e] = t;
        }
        if (typeof t === "function") t = t.call(this.view);
        return t;
    };
    function v() {
        this.clearCache();
    }
    v.prototype.clearCache = function() {
        this._cache = {};
        this._partialCache = {};
    };
    v.prototype.compile = function(t, i) {
        var n = this._cache[t];
        if (!n) {
            var r = e.parse(t, i);
            n = this._cache[t] = this.compileTokens(r, t);
        }
        return n;
    };
    v.prototype.compilePartial = function(e, t, i) {
        var n = this.compile(t, i);
        this._partialCache[e] = n;
        return n;
    };
    v.prototype.getPartial = function(e) {
        if (!(e in this._partialCache) && this._loadPartial) {
            this.compilePartial(e, this._loadPartial(e));
        }
        return this._partialCache[e];
    };
    v.prototype.compileTokens = function(e, t) {
        var i = this;
        return function(n, r) {
            if (r) {
                if (typeof r === "function") {
                    i._loadPartial = r;
                } else {
                    for (var a in r) {
                        i.compilePartial(a, r[a]);
                    }
                }
            }
            return y(e, i, m.make(n), t);
        };
    };
    v.prototype.render = function(e, t, i) {
        return this.compile(e)(t, i);
    };
    function y(t, i, n, r) {
        var a = "";
        var o, s, l;
        for (var c = 0, u = t.length; c < u; ++c) {
            o = t[c];
            s = o[1];
            switch (o[0]) {
              case "#":
                l = n.lookup(s);
                if (typeof l === "object") {
                    if (f(l)) {
                        for (var d = 0, h = l.length; d < h; ++d) {
                            a += y(o[4], i, n.push(l[d]), r);
                        }
                    } else if (l) {
                        a += y(o[4], i, n.push(l), r);
                    }
                } else if (typeof l === "function") {
                    var p = r == null ? null : r.slice(o[3], o[5]);
                    l = l.call(n.view, p, function(e) {
                        return i.render(e, n);
                    });
                    if (l != null) a += l;
                } else if (l) {
                    a += y(o[4], i, n, r);
                }
                break;

              case "^":
                l = n.lookup(s);
                if (!l || f(l) && l.length === 0) {
                    a += y(o[4], i, n, r);
                }
                break;

              case ">":
                l = i.getPartial(s);
                if (typeof l === "function") a += l(n);
                break;

              case "&":
                l = n.lookup(s);
                if (l != null) a += l;
                break;

              case "name":
                l = n.lookup(s);
                if (l != null) a += e.escape(l);
                break;

              case "text":
                a += s;
                break;
            }
        }
        return a;
    }
    function b(e) {
        var t = [];
        var i = t;
        var n = [];
        var r;
        for (var a = 0, o = e.length; a < o; ++a) {
            r = e[a];
            switch (r[0]) {
              case "#":
              case "^":
                n.push(r);
                i.push(r);
                i = r[4] = [];
                break;

              case "/":
                var s = n.pop();
                s[5] = r[2];
                i = n.length > 0 ? n[n.length - 1][4] : t;
                break;

              default:
                i.push(r);
            }
        }
        return t;
    }
    function w(e) {
        var t = [];
        var i, n;
        for (var r = 0, a = e.length; r < a; ++r) {
            i = e[r];
            if (i) {
                if (i[0] === "text" && n && n[0] === "text") {
                    n[1] += i[1];
                    n[3] = i[3];
                } else {
                    n = i;
                    t.push(i);
                }
            }
        }
        return t;
    }
    function C(e) {
        return [ new RegExp(d(e[0]) + "\\s*"), new RegExp("\\s*" + d(e[1])) ];
    }
    function x(n, s) {
        n = n || "";
        s = s || e.tags;
        if (typeof s === "string") s = s.split(i);
        if (s.length !== 2) throw new Error("Invalid tags: " + s.join(", "));
        var l = C(s);
        var u = new g(n);
        var f = [];
        var h = [];
        var p = [];
        var m = false;
        var v = false;
        function y() {
            if (m && !v) {
                while (p.length) {
                    delete h[p.pop()];
                }
            } else {
                p = [];
            }
            m = false;
            v = false;
        }
        var x, _, S, k, A;
        while (!u.eos()) {
            x = u.pos;
            S = u.scanUntil(l[0]);
            if (S) {
                for (var E = 0, T = S.length; E < T; ++E) {
                    k = S.charAt(E);
                    if (c(k)) {
                        p.push(h.length);
                    } else {
                        v = true;
                    }
                    h.push([ "text", k, x, x + 1 ]);
                    x += 1;
                    if (k == "\n") y();
                }
            }
            if (!u.scan(l[0])) break;
            m = true;
            _ = u.scan(o) || "name";
            u.scan(t);
            if (_ === "=") {
                S = u.scanUntil(r);
                u.scan(r);
                u.scanUntil(l[1]);
            } else if (_ === "{") {
                S = u.scanUntil(new RegExp("\\s*" + d("}" + s[1])));
                u.scan(a);
                u.scanUntil(l[1]);
                _ = "&";
            } else {
                S = u.scanUntil(l[1]);
            }
            if (!u.scan(l[1])) throw new Error("Unclosed tag at " + u.pos);
            A = [ _, S, x, u.pos ];
            h.push(A);
            if (_ === "#" || _ === "^") {
                f.push(A);
            } else if (_ === "/") {
                if (f.length === 0) throw new Error('Unopened section "' + S + '" at ' + x);
                var P = f.pop();
                if (P[1] !== S) throw new Error('Unclosed section "' + P[1] + '" at ' + x);
            } else if (_ === "name" || _ === "{" || _ === "&") {
                v = true;
            } else if (_ === "=") {
                s = S.split(i);
                if (s.length !== 2) throw new Error("Invalid tags at " + x + ": " + s.join(", "));
                l = C(s);
            }
        }
        var P = f.pop();
        if (P) throw new Error('Unclosed section "' + P[1] + '" at ' + u.pos);
        h = w(h);
        return b(h);
    }
    e.name = "mustache.js";
    e.version = "0.7.2";
    e.tags = [ "{{", "}}" ];
    e.Scanner = g;
    e.Context = m;
    e.Writer = v;
    e.parse = x;
    e.escape = p;
    var _ = new v();
    e.clearCache = function() {
        return _.clearCache();
    };
    e.compile = function(e, t) {
        return _.compile(e, t);
    };
    e.compilePartial = function(e, t, i) {
        return _.compilePartial(e, t, i);
    };
    e.compileTokens = function(e, t) {
        return _.compileTokens(e, t);
    };
    e.render = function(e, t, i) {
        return _.render(e, t, i);
    };
    e.to_html = function(t, i, n, r) {
        var a = e.render(t, i, n);
        if (typeof r === "function") {
            r(a);
        } else {
            return a;
        }
    };
});

var Opentip, firstAdapter, i, mouseMoved, mousePosition, mousePositionObservers, position, vendors, _i, _len, _ref, __slice = [].slice, __indexOf = [].indexOf || function(e) {
    for (var t = 0, i = this.length; i > t; t++) if (t in this && this[t] === e) return t;
    return -1;
}, __hasProp = {}.hasOwnProperty;

for (Opentip = function() {
    function e(t, i, n, r) {
        var a, o, s, l, c, u, f, d, h, p, g, m, v, y, b = this;
        if (this.id = ++e.lastId, this.debug("Creating Opentip."), e.tips.push(this), this.adapter = e.adapter, 
        a = this.adapter.data(t, "opentips") || [], a.push(this), this.adapter.data(t, "opentips", a), 
        this.triggerElement = this.adapter.wrap(t), this.triggerElement.length > 1) throw Error("You can't call Opentip on multiple elements.");
        if (1 > this.triggerElement.length) throw Error("Invalid element.");
        this.loaded = !1, this.loading = !1, this.visible = !1, this.waitingToShow = !1, 
        this.waitingToHide = !1, this.currentPosition = {
            left: 0,
            top: 0
        }, this.dimensions = {
            width: 100,
            height: 50
        }, this.content = "", this.redraw = !0, this.currentObservers = {
            showing: !1,
            visible: !1,
            hiding: !1,
            hidden: !1
        }, r = this.adapter.clone(r), typeof i == "object" ? (r = i, i = n = void 0) : typeof n == "object" && (r = n, 
        n = void 0), n != null && (r.title = n), i != null && this.setContent(i), r["extends"] == null && (r["extends"] = r.style != null ? r.style : e.defaultStyle), 
        l = [ r ], y = r;
        while (y["extends"]) {
            if (u = y["extends"], y = e.styles[u], y == null) throw Error("Invalid style: " + u);
            l.unshift(y), y["extends"] == null && u !== "standard" && (y["extends"] = "standard");
        }
        for (r = (g = this.adapter).extend.apply(g, [ {} ].concat(__slice.call(l))), r.hideTriggers = function() {
            var e, t, i, n;
            for (i = r.hideTriggers, n = [], e = 0, t = i.length; t > e; e++) o = i[e], n.push(o);
            return n;
        }(), r.hideTrigger && r.hideTriggers.length === 0 && r.hideTriggers.push(r.hideTrigger), 
        m = [ "tipJoint", "targetJoint", "stem" ], f = 0, h = m.length; h > f; f++) c = m[f], 
        r[c] && typeof r[c] == "string" && (r[c] = new e.Joint(r[c]));
        for (!r.ajax || r.ajax !== !0 && r.ajax || (r.ajax = this.adapter.tagName(this.triggerElement) === "A" ? this.adapter.attr(this.triggerElement, "href") : !1), 
        r.showOn === "click" && this.adapter.tagName(this.triggerElement) === "A" && this.adapter.observe(this.triggerElement, "click", function(e) {
            return e.preventDefault(), e.stopPropagation(), e.stopped = !0;
        }), r.target && (r.fixed = !0), r.stem === !0 && (r.stem = new e.Joint(r.tipJoint)), 
        r.target === !0 ? r.target = this.triggerElement : r.target && (r.target = this.adapter.wrap(r.target)), 
        this.currentStem = r.stem, r.delay == null && (r.delay = r.showOn === "mouseover" ? .2 : 0), 
        r.targetJoint == null && (r.targetJoint = new e.Joint(r.tipJoint).flip()), this.showTriggers = [], 
        this.showTriggersWhenVisible = [], this.hideTriggers = [], r.showOn && r.showOn !== "creation" && this.showTriggers.push({
            element: this.triggerElement,
            event: r.showOn
        }), r.ajaxCache != null && (r.cache = r.ajaxCache, delete r.ajaxCache), this.options = r, 
        this.bound = {}, v = [ "prepareToShow", "prepareToHide", "show", "hide", "reposition" ], 
        d = 0, p = v.length; p > d; d++) s = v[d], this.bound[s] = function(e) {
            return function() {
                return b[e].apply(b, arguments);
            };
        }(s);
        this.adapter.domReady(function() {
            return b.activate(), b.options.showOn === "creation" ? b.prepareToShow() : void 0;
        });
    }
    return e.prototype.STICKS_OUT_TOP = 1, e.prototype.STICKS_OUT_BOTTOM = 2, e.prototype.STICKS_OUT_LEFT = 1, 
    e.prototype.STICKS_OUT_RIGHT = 2, e.prototype["class"] = {
        container: "opentip-container",
        opentip: "opentip",
        header: "ot-header",
        content: "ot-content",
        loadingIndicator: "ot-loading-indicator",
        close: "ot-close",
        goingToHide: "ot-going-to-hide",
        hidden: "ot-hidden",
        hiding: "ot-hiding",
        goingToShow: "ot-going-to-show",
        showing: "ot-showing",
        visible: "ot-visible",
        loading: "ot-loading",
        ajaxError: "ot-ajax-error",
        fixed: "ot-fixed",
        showEffectPrefix: "ot-show-effect-",
        hideEffectPrefix: "ot-hide-effect-",
        stylePrefix: "style-"
    }, e.prototype._setup = function() {
        var e, t, i, n, r, a, o, s, l, c, u;
        for (this.debug("Setting up the tooltip."), this._buildContainer(), this.hideTriggers = [], 
        l = this.options.hideTriggers, n = r = 0, o = l.length; o > r; n = ++r) {
            if (t = l[n], i = null, e = this.options.hideOn instanceof Array ? this.options.hideOn[n] : this.options.hideOn, 
            typeof t == "string") switch (t) {
              case "trigger":
                e = e || "mouseout", i = this.triggerElement;
                break;

              case "tip":
                e = e || "mouseover", i = this.container;
                break;

              case "target":
                e = e || "mouseover", i = this.options.target;
                break;

              case "closeButton":
                break;

              default:
                throw Error("Unknown hide trigger: " + t + ".");
            } else e = e || "mouseover", i = this.adapter.wrap(t);
            i && this.hideTriggers.push({
                element: i,
                event: e,
                original: t
            });
        }
        for (c = this.hideTriggers, u = [], a = 0, s = c.length; s > a; a++) t = c[a], u.push(this.showTriggersWhenVisible.push({
            element: t.element,
            event: "mouseover"
        }));
        return u;
    }, e.prototype._buildContainer = function() {
        return this.container = this.adapter.create('<div id="opentip-' + this.id + '" class="' + this["class"].container + " " + this["class"].hidden + " " + this["class"].stylePrefix + this.options.className + '"></div>'), 
        this.adapter.css(this.container, {
            position: "absolute"
        }), this.options.ajax && this.adapter.addClass(this.container, this["class"].loading), 
        this.options.fixed && this.adapter.addClass(this.container, this["class"].fixed), 
        this.options.showEffect && this.adapter.addClass(this.container, "" + this["class"].showEffectPrefix + this.options.showEffect), 
        this.options.hideEffect ? this.adapter.addClass(this.container, "" + this["class"].hideEffectPrefix + this.options.hideEffect) : void 0;
    }, e.prototype._buildElements = function() {
        var e, t;
        return this.tooltipElement = this.adapter.create('<div class="' + this["class"].opentip + '"><div class="' + this["class"].header + '"></div><div class="' + this["class"].content + '"></div></div>'), 
        this.backgroundCanvas = this.adapter.wrap(document.createElement("canvas")), this.adapter.css(this.backgroundCanvas, {
            position: "absolute"
        }), typeof G_vmlCanvasManager != "undefined" && G_vmlCanvasManager !== null && G_vmlCanvasManager.initElement(this.adapter.unwrap(this.backgroundCanvas)), 
        e = this.adapter.find(this.tooltipElement, "." + this["class"].header), this.options.title && (t = this.adapter.create("<h1></h1>"), 
        this.adapter.update(t, this.options.title, this.options.escapeTitle), this.adapter.append(e, t)), 
        this.options.ajax && !this.loaded && this.adapter.append(this.tooltipElement, this.adapter.create('<div class="' + this["class"].loadingIndicator + '"><span></span></div>')), 
        __indexOf.call(this.options.hideTriggers, "closeButton") >= 0 && (this.closeButtonElement = this.adapter.create('<a href="javascript:undefined;" class="' + this["class"].close + '"><span>Close</span></a>'), 
        this.adapter.append(e, this.closeButtonElement)), this.adapter.append(this.container, this.backgroundCanvas), 
        this.adapter.append(this.container, this.tooltipElement), this.adapter.append(document.body, this.container), 
        this._newContent = !0, this.redraw = !0;
    }, e.prototype.setContent = function(e) {
        return this.content = e, this._newContent = !0, typeof this.content == "function" ? (this._contentFunction = this.content, 
        this.content = "") : this._contentFunction = null, this.visible ? this._updateElementContent() : void 0;
    }, e.prototype._updateElementContent = function() {
        var e;
        return (this._newContent || !this.options.cache && this._contentFunction) && (e = this.adapter.find(this.container, "." + this["class"].content), 
        e != null && (this._contentFunction && (this.debug("Executing content function."), 
        this.content = this._contentFunction(this)), this.adapter.update(e, this.content, this.options.escapeContent)), 
        this._newContent = !1), this._storeAndLockDimensions(), this.reposition();
    }, e.prototype._storeAndLockDimensions = function() {
        var e;
        if (this.container) return e = this.dimensions, this.adapter.css(this.container, {
            width: "auto",
            left: "0px",
            top: "0px"
        }), this.dimensions = this.adapter.dimensions(this.container), this.dimensions.width += 1, 
        this.adapter.css(this.container, {
            width: "" + this.dimensions.width + "px",
            top: "" + this.currentPosition.top + "px",
            left: "" + this.currentPosition.left + "px"
        }), this._dimensionsEqual(this.dimensions, e) ? void 0 : (this.redraw = !0, this._draw());
    }, e.prototype.activate = function() {
        return this._setupObservers("hidden", "hiding");
    }, e.prototype.deactivate = function() {
        return this.debug("Deactivating tooltip."), this.hide(), this._setupObservers("-showing", "-visible", "-hidden", "-hiding");
    }, e.prototype._setupObservers = function() {
        var e, t, i, n, r, a, o, s, l, c, u, f, d, h, p, g, m = this;
        for (n = arguments.length >= 1 ? __slice.call(arguments, 0) : [], a = 0, c = n.length; c > a; a++) if (i = n[a], 
        t = !1, i.charAt(0) === "-" && (t = !0, i = i.substr(1)), this.currentObservers[i] !== !t) switch (this.currentObservers[i] = !t, 
        e = function() {
            var e, i, n;
            return e = arguments.length >= 1 ? __slice.call(arguments, 0) : [], t ? (i = m.adapter).stopObserving.apply(i, e) : (n = m.adapter).observe.apply(n, e);
        }, i) {
          case "showing":
            for (h = this.hideTriggers, o = 0, u = h.length; u > o; o++) r = h[o], e(r.element, r.event, this.bound.prepareToHide);
            e(document.onresize != null ? document : window, "resize", this.bound.reposition), 
            e(window, "scroll", this.bound.reposition);
            break;

          case "visible":
            for (p = this.showTriggersWhenVisible, s = 0, f = p.length; f > s; s++) r = p[s], 
            e(r.element, r.event, this.bound.prepareToShow);
            break;

          case "hiding":
            for (g = this.showTriggers, l = 0, d = g.length; d > l; l++) r = g[l], e(r.element, r.event, this.bound.prepareToShow);
            break;

          case "hidden":
            break;

          default:
            throw Error("Unknown state: " + i);
        }
        return null;
    }, e.prototype.prepareToShow = function() {
        return this._abortHiding(), this._abortShowing(), this.visible ? void 0 : (this.debug("Showing in " + this.options.delay + "s."), 
        this.container == null && this._setup(), this.options.group && e._abortShowingGroup(this.options.group, this), 
        this.preparingToShow = !0, this._setupObservers("-hidden", "-hiding", "showing"), 
        this._followMousePosition(), this.options.fixed && !this.options.target && (this.initialMousePosition = mousePosition), 
        this.reposition(), this._showTimeoutId = this.setTimeout(this.bound.show, this.options.delay || 0));
    }, e.prototype.show = function() {
        var t = this;
        return this._abortHiding(), this.visible ? void 0 : (this._clearTimeouts(), this._triggerElementExists() ? (this.debug("Showing now."), 
        this.container == null && this._setup(), this.options.group && e._hideGroup(this.options.group, this), 
        this.visible = !0, this.preparingToShow = !1, this.tooltipElement == null && this._buildElements(), 
        this._updateElementContent(), !this.options.ajax || this.loaded && this.options.cache || this._loadAjax(), 
        this._searchAndActivateCloseButtons(), this._startEnsureTriggerElement(), this.adapter.css(this.container, {
            zIndex: e.lastZIndex++
        }), this._setupObservers("-hidden", "-hiding", "-showing", "-visible", "showing", "visible"), 
        this.options.fixed && !this.options.target && (this.initialMousePosition = mousePosition), 
        this.reposition(), this.adapter.removeClass(this.container, this["class"].hiding), 
        this.adapter.removeClass(this.container, this["class"].hidden), this.adapter.addClass(this.container, this["class"].goingToShow), 
        this.setCss3Style(this.container, {
            transitionDuration: "0s"
        }), this.defer(function() {
            var e;
            if (t.visible && !t.preparingToHide) return t.adapter.removeClass(t.container, t["class"].goingToShow), 
            t.adapter.addClass(t.container, t["class"].showing), e = 0, t.options.showEffect && t.options.showEffectDuration && (e = t.options.showEffectDuration), 
            t.setCss3Style(t.container, {
                transitionDuration: "" + e + "s"
            }), t._visibilityStateTimeoutId = t.setTimeout(function() {
                return t.adapter.removeClass(t.container, t["class"].showing), t.adapter.addClass(t.container, t["class"].visible);
            }, e), t._activateFirstInput();
        }), this._draw()) : this.deactivate());
    }, e.prototype._abortShowing = function() {
        return this.preparingToShow ? (this.debug("Aborting showing."), this._clearTimeouts(), 
        this._stopFollowingMousePosition(), this.preparingToShow = !1, this._setupObservers("-showing", "-visible", "hiding", "hidden")) : void 0;
    }, e.prototype.prepareToHide = function() {
        return this._abortShowing(), this._abortHiding(), this.visible ? (this.debug("Hiding in " + this.options.hideDelay + "s"), 
        this.preparingToHide = !0, this._setupObservers("-showing", "visible", "-hidden", "hiding"), 
        this._hideTimeoutId = this.setTimeout(this.bound.hide, this.options.hideDelay)) : void 0;
    }, e.prototype.hide = function() {
        var e = this;
        return this._abortShowing(), this.visible && (this._clearTimeouts(), this.debug("Hiding!"), 
        this.visible = !1, this.preparingToHide = !1, this._stopEnsureTriggerElement(), 
        this._setupObservers("-showing", "-visible", "-hiding", "-hidden", "hiding", "hidden"), 
        this.options.fixed || this._stopFollowingMousePosition(), this.container) ? (this.adapter.removeClass(this.container, this["class"].visible), 
        this.adapter.removeClass(this.container, this["class"].showing), this.adapter.addClass(this.container, this["class"].goingToHide), 
        this.setCss3Style(this.container, {
            transitionDuration: "0s"
        }), this.defer(function() {
            var t;
            return e.adapter.removeClass(e.container, e["class"].goingToHide), e.adapter.addClass(e.container, e["class"].hiding), 
            t = 0, e.options.hideEffect && e.options.hideEffectDuration && (t = e.options.hideEffectDuration), 
            e.setCss3Style(e.container, {
                transitionDuration: "" + t + "s"
            }), e._visibilityStateTimeoutId = e.setTimeout(function() {
                return e.adapter.removeClass(e.container, e["class"].hiding), e.adapter.addClass(e.container, e["class"].hidden), 
                e.setCss3Style(e.container, {
                    transitionDuration: "0s"
                }), e.options.removeElementsOnHide ? (e.debug("Removing HTML elements."), e.adapter.remove(e.container), 
                delete e.container, delete e.tooltipElement) : void 0;
            }, t);
        })) : void 0;
    }, e.prototype._abortHiding = function() {
        return this.preparingToHide ? (this.debug("Aborting hiding."), this._clearTimeouts(), 
        this.preparingToHide = !1, this._setupObservers("-hiding", "showing", "visible")) : void 0;
    }, e.prototype.reposition = function() {
        var e, t, i, n = this;
        return e = this.getPosition(), e == null || (t = this.options.stem, this.options.containInViewport && (i = this._ensureViewportContainment(e), 
        e = i.position, t = i.stem), this._positionsEqual(e, this.currentPosition)) ? void 0 : (this.options.stem && !t.eql(this.currentStem) && (this.redraw = !0), 
        this.currentPosition = e, this.currentStem = t, this._draw(), this.adapter.css(this.container, {
            left: "" + e.left + "px",
            top: "" + e.top + "px"
        }), this.defer(function() {
            var e, t;
            return e = n.adapter.unwrap(n.container), e.style.visibility = "hidden", t = e.offsetHeight, 
            e.style.visibility = "visible";
        }));
    }, e.prototype.getPosition = function(e, t, i) {
        var n, r, a, o, s, l, c, u, f;
        if (this.container) return e == null && (e = this.options.tipJoint), t == null && (t = this.options.targetJoint), 
        o = {}, this.options.target ? (c = this.adapter.offset(this.options.target), l = this.adapter.dimensions(this.options.target), 
        o = c, t.right ? (u = this.adapter.unwrap(this.options.target), u.getBoundingClientRect != null ? o.left = u.getBoundingClientRect().right + ((f = window.pageXOffset) != null ? f : document.body.scrollLeft) : o.left += l.width) : t.center && (o.left += Math.round(l.width / 2)), 
        t.bottom ? o.top += l.height : t.middle && (o.top += Math.round(l.height / 2)), 
        this.options.borderWidth && (this.options.tipJoint.left && (o.left += this.options.borderWidth), 
        this.options.tipJoint.right && (o.left -= this.options.borderWidth), this.options.tipJoint.top ? o.top += this.options.borderWidth : this.options.tipJoint.bottom && (o.top -= this.options.borderWidth))) : o = this.initialMousePosition ? {
            top: this.initialMousePosition.y,
            left: this.initialMousePosition.x
        } : {
            top: mousePosition.y,
            left: mousePosition.x
        }, this.options.autoOffset && (s = this.options.stem ? this.options.stemLength : 0, 
        a = s && this.options.fixed ? 2 : 10, n = e.middle && !this.options.fixed ? 15 : 0, 
        r = e.center && !this.options.fixed ? 15 : 0, e.right ? o.left -= a + n : e.left && (o.left += a + n), 
        e.bottom ? o.top -= a + r : e.top && (o.top += a + r), s && (i == null && (i = this.options.stem), 
        i.right ? o.left -= s : i.left && (o.left += s), i.bottom ? o.top -= s : i.top && (o.top += s))), 
        o.left += this.options.offset[0], o.top += this.options.offset[1], e.right ? o.left -= this.dimensions.width : e.center && (o.left -= Math.round(this.dimensions.width / 2)), 
        e.bottom ? o.top -= this.dimensions.height : e.middle && (o.top -= Math.round(this.dimensions.height / 2)), 
        o;
    }, e.prototype._ensureViewportContainment = function(t) {
        var i, n, r, a, o, s, l, c, u, f, d, h;
        if (l = this.options.stem, r = {
            position: t,
            stem: l
        }, !this.visible || !t) return r;
        if (c = this._sticksOut(t), !c[0] && !c[1]) return r;
        if (f = new e.Joint(this.options.tipJoint), this.options.targetJoint && (u = new e.Joint(this.options.targetJoint)), 
        s = this.adapter.scrollOffset(), d = this.adapter.viewportDimensions(), h = [ t.left - s[0], t.top - s[1] ], 
        i = !1, d.width >= this.dimensions.width && c[0]) switch (i = !0, c[0]) {
          case this.STICKS_OUT_LEFT:
            f.setHorizontal("left"), this.options.targetJoint && u.setHorizontal("right");
            break;

          case this.STICKS_OUT_RIGHT:
            f.setHorizontal("right"), this.options.targetJoint && u.setHorizontal("left");
        }
        if (d.height >= this.dimensions.height && c[1]) switch (i = !0, c[1]) {
          case this.STICKS_OUT_TOP:
            f.setVertical("top"), this.options.targetJoint && u.setVertical("bottom");
            break;

          case this.STICKS_OUT_BOTTOM:
            f.setVertical("bottom"), this.options.targetJoint && u.setVertical("top");
        }
        return i ? (this.options.stem && (l = f), t = this.getPosition(f, u, l), n = this._sticksOut(t), 
        a = !1, o = !1, n[0] && n[0] !== c[0] && (a = !0, f.setHorizontal(this.options.tipJoint.horizontal), 
        this.options.targetJoint && u.setHorizontal(this.options.targetJoint.horizontal)), 
        n[1] && n[1] !== c[1] && (o = !0, f.setVertical(this.options.tipJoint.vertical), 
        this.options.targetJoint && u.setVertical(this.options.targetJoint.vertical)), a && o ? r : ((a || o) && (this.options.stem && (l = f), 
        t = this.getPosition(f, u, l)), {
            position: t,
            stem: l
        })) : r;
    }, e.prototype._sticksOut = function(e) {
        var t, i, n, r;
        return i = this.adapter.scrollOffset(), r = this.adapter.viewportDimensions(), t = [ e.left - i[0], e.top - i[1] ], 
        n = [ !1, !1 ], 0 > t[0] ? n[0] = this.STICKS_OUT_LEFT : t[0] + this.dimensions.width > r.width && (n[0] = this.STICKS_OUT_RIGHT), 
        0 > t[1] ? n[1] = this.STICKS_OUT_TOP : t[1] + this.dimensions.height > r.height && (n[1] = this.STICKS_OUT_BOTTOM), 
        n;
    }, e.prototype._draw = function() {
        var t, i, n, r, a, o, s, l, c, u, f, d, h, p, g, m, v, y, b, w = this;
        if (this.backgroundCanvas && this.redraw) {
            if (this.debug("Drawing background."), this.redraw = !1, this.currentStem) {
                for (v = [ "top", "right", "bottom", "left" ], g = 0, m = v.length; m > g; g++) d = v[g], 
                this.adapter.removeClass(this.container, "stem-" + d);
                this.adapter.addClass(this.container, "stem-" + this.currentStem.horizontal), this.adapter.addClass(this.container, "stem-" + this.currentStem.vertical);
            }
            return o = [ 0, 0 ], s = [ 0, 0 ], __indexOf.call(this.options.hideTriggers, "closeButton") >= 0 && (a = new e.Joint(((y = this.currentStem) != null ? y + "" : void 0) === "top right" ? "top left" : "top right"), 
            o = [ this.options.closeButtonRadius + this.options.closeButtonOffset[0], this.options.closeButtonRadius + this.options.closeButtonOffset[1] ], 
            s = [ this.options.closeButtonRadius - this.options.closeButtonOffset[0], this.options.closeButtonRadius - this.options.closeButtonOffset[1] ]), 
            n = this.adapter.clone(this.dimensions), r = [ 0, 0 ], this.options.borderWidth && (n.width += this.options.borderWidth * 2, 
            n.height += this.options.borderWidth * 2, r[0] -= this.options.borderWidth, r[1] -= this.options.borderWidth), 
            this.options.shadow && (n.width += this.options.shadowBlur * 2, n.width += Math.max(0, this.options.shadowOffset[0] - this.options.shadowBlur * 2), 
            n.height += this.options.shadowBlur * 2, n.height += Math.max(0, this.options.shadowOffset[1] - this.options.shadowBlur * 2), 
            r[0] -= Math.max(0, this.options.shadowBlur - this.options.shadowOffset[0]), r[1] -= Math.max(0, this.options.shadowBlur - this.options.shadowOffset[1])), 
            i = {
                left: 0,
                right: 0,
                top: 0,
                bottom: 0
            }, this.currentStem && (this.currentStem.left ? i.left = this.options.stemLength : this.currentStem.right && (i.right = this.options.stemLength), 
            this.currentStem.top ? i.top = this.options.stemLength : this.currentStem.bottom && (i.bottom = this.options.stemLength)), 
            a && (a.left ? i.left = Math.max(i.left, s[0]) : a.right && (i.right = Math.max(i.right, s[0])), 
            a.top ? i.top = Math.max(i.top, s[1]) : a.bottom && (i.bottom = Math.max(i.bottom, s[1]))), 
            n.width += i.left + i.right, n.height += i.top + i.bottom, r[0] -= i.left, r[1] -= i.top, 
            this.currentStem && this.options.borderWidth && (b = this._getPathStemMeasures(this.options.stemBase, this.options.stemLength, this.options.borderWidth), 
            p = b.stemLength, h = b.stemBase), t = this.adapter.unwrap(this.backgroundCanvas), 
            t.width = n.width, t.height = n.height, this.adapter.css(this.backgroundCanvas, {
                width: "" + t.width + "px",
                height: "" + t.height + "px",
                left: "" + r[0] + "px",
                top: "" + r[1] + "px"
            }), l = t.getContext("2d"), l.setTransform(1, 0, 0, 1, 0, 0), l.clearRect(0, 0, t.width, t.height), 
            l.beginPath(), l.fillStyle = this._getColor(l, this.dimensions, this.options.background, this.options.backgroundGradientHorizontal), 
            l.lineJoin = "miter", l.miterLimit = 500, f = this.options.borderWidth / 2, this.options.borderWidth ? (l.strokeStyle = this.options.borderColor, 
            l.lineWidth = this.options.borderWidth) : (p = this.options.stemLength, h = this.options.stemBase), 
            h == null && (h = 0), u = function(e, t, i) {
                return i && l.moveTo(Math.max(h, w.options.borderRadius, o[0]) + 1 - f, -f), t ? (l.lineTo(e / 2 - h / 2, -f), 
                l.lineTo(e / 2, -p - f), l.lineTo(e / 2 + h / 2, -f)) : void 0;
            }, c = function(e, t, i) {
                var n, r, a, s;
                return e ? (l.lineTo(-h + f, 0 - f), l.lineTo(p + f, -p - f), l.lineTo(f, h - f)) : t ? (s = w.options.closeButtonOffset, 
                a = o[0], i % 2 !== 0 && (s = [ s[1], s[0] ], a = o[1]), n = Math.acos(s[1] / w.options.closeButtonRadius), 
                r = Math.acos(s[0] / w.options.closeButtonRadius), l.lineTo(-a + f, -f), l.arc(f - s[0], -f + s[1], w.options.closeButtonRadius, -(Math.PI / 2 + n), r, !1)) : (l.lineTo(-w.options.borderRadius + f, -f), 
                l.quadraticCurveTo(f, -f, f, w.options.borderRadius - f));
            }, l.translate(-r[0], -r[1]), l.save(), function() {
                var t, i, n, r, o, s, f, d, h, p, g;
                for (g = [], i = h = 0, p = e.positions.length / 2; p >= 0 ? p > h : h > p; i = p >= 0 ? ++h : --h) o = i * 2, 
                s = i === 0 || i === 3 ? 0 : w.dimensions.width, f = 2 > i ? 0 : w.dimensions.height, 
                d = Math.PI / 2 * i, n = i % 2 === 0 ? w.dimensions.width : w.dimensions.height, 
                r = new e.Joint(e.positions[o]), t = new e.Joint(e.positions[o + 1]), l.save(), 
                l.translate(s, f), l.rotate(d), u(n, r.eql(w.currentStem), i === 0), l.translate(n, 0), 
                c(t.eql(w.currentStem), t.eql(a), i), g.push(l.restore());
                return g;
            }(), l.closePath(), l.save(), this.options.shadow && (l.shadowColor = this.options.shadowColor, 
            l.shadowBlur = this.options.shadowBlur, l.shadowOffsetX = this.options.shadowOffset[0], 
            l.shadowOffsetY = this.options.shadowOffset[1]), l.fill(), l.restore(), this.options.borderWidth && l.stroke(), 
            l.restore(), a ? function() {
                var e, t, i, n, r;
                return i = t = w.options.closeButtonRadius * 2, a + "" == "top right" ? (r = [ w.dimensions.width - w.options.closeButtonOffset[0], w.options.closeButtonOffset[1] ], 
                e = [ r[0] + f, r[1] - f ]) : (r = [ w.options.closeButtonOffset[0], w.options.closeButtonOffset[1] ], 
                e = [ r[0] - f, r[1] - f ]), l.translate(e[0], e[1]), n = w.options.closeButtonCrossSize / 2, 
                l.save(), l.beginPath(), l.strokeStyle = w.options.closeButtonCrossColor, l.lineWidth = w.options.closeButtonCrossLineWidth, 
                l.lineCap = "round", l.moveTo(-n, -n), l.lineTo(n, n), l.stroke(), l.beginPath(), 
                l.moveTo(n, -n), l.lineTo(-n, n), l.stroke(), l.restore(), w.adapter.css(w.closeButtonElement, {
                    left: "" + (r[0] - n - w.options.closeButtonLinkOverscan) + "px",
                    top: "" + (r[1] - n - w.options.closeButtonLinkOverscan) + "px",
                    width: "" + (w.options.closeButtonCrossSize + w.options.closeButtonLinkOverscan * 2) + "px",
                    height: "" + (w.options.closeButtonCrossSize + w.options.closeButtonLinkOverscan * 2) + "px"
                });
            }() : void 0;
        }
    }, e.prototype._getPathStemMeasures = function(e, t, i) {
        var n, r, a, o, s, l, c;
        if (o = i / 2, a = Math.atan(e / 2 / t), n = a * 2, s = o / Math.sin(n), r = 2 * s * Math.cos(a), 
        c = o + t - r, 0 > c) throw Error("Sorry but your stemLength / stemBase ratio is strange.");
        return l = Math.tan(a) * c * 2, {
            stemLength: c,
            stemBase: l
        };
    }, e.prototype._getColor = function(e, t, i, n) {
        var r, a, o, s, l;
        if (n == null && (n = !1), typeof i == "string") return i;
        for (a = n ? e.createLinearGradient(0, 0, t.width, 0) : e.createLinearGradient(0, 0, 0, t.height), 
        o = s = 0, l = i.length; l > s; o = ++s) r = i[o], a.addColorStop(r[0], r[1]);
        return a;
    }, e.prototype._searchAndActivateCloseButtons = function() {
        var e, t, i, n;
        for (n = this.adapter.findAll(this.container, "." + this["class"].close), t = 0, 
        i = n.length; i > t; t++) e = n[t], this.hideTriggers.push({
            element: this.adapter.wrap(e),
            event: "click"
        });
        return this.currentObservers.showing && this._setupObservers("-showing", "showing"), 
        this.currentObservers.visible ? this._setupObservers("-visible", "visible") : void 0;
    }, e.prototype._activateFirstInput = function() {
        var e;
        return e = this.adapter.unwrap(this.adapter.find(this.container, "input, textarea")), 
        e != null ? typeof e.focus == "function" ? e.focus() : void 0 : void 0;
    }, e.prototype._followMousePosition = function() {
        return this.options.fixed ? void 0 : e._observeMousePosition(this.bound.reposition);
    }, e.prototype._stopFollowingMousePosition = function() {
        return this.options.fixed ? void 0 : e._stopObservingMousePosition(this.bound.reposition);
    }, e.prototype._clearShowTimeout = function() {
        return clearTimeout(this._showTimeoutId);
    }, e.prototype._clearHideTimeout = function() {
        return clearTimeout(this._hideTimeoutId);
    }, e.prototype._clearTimeouts = function() {
        return clearTimeout(this._visibilityStateTimeoutId), this._clearShowTimeout(), this._clearHideTimeout();
    }, e.prototype._triggerElementExists = function() {
        var e;
        e = this.adapter.unwrap(this.triggerElement);
        while (e.parentNode) {
            if (e.parentNode.tagName === "BODY") return !0;
            e = e.parentNode;
        }
        return !1;
    }, e.prototype._loadAjax = function() {
        var e = this;
        if (!this.loading) return this.loaded = !1, this.loading = !0, this.adapter.addClass(this.container, this["class"].loading), 
        this.setContent(""), this.debug("Loading content from " + this.options.ajax), this.adapter.ajax({
            url: this.options.ajax,
            method: this.options.ajaxMethod,
            onSuccess: function(t) {
                return e.debug("Loading successful."), e.adapter.removeClass(e.container, e["class"].loading), 
                e.setContent(t);
            },
            onError: function(t) {
                var i;
                return i = e.options.ajaxErrorMessage, e.debug(i, t), e.setContent(i), e.adapter.addClass(e.container, e["class"].ajaxError);
            },
            onComplete: function() {
                return e.adapter.removeClass(e.container, e["class"].loading), e.loading = !1, e.loaded = !0, 
                e._searchAndActivateCloseButtons(), e._activateFirstInput(), e.reposition();
            }
        });
    }, e.prototype._ensureTriggerElement = function() {
        return this._triggerElementExists() ? void 0 : (this.deactivate(), this._stopEnsureTriggerElement());
    }, e.prototype._ensureTriggerElementInterval = 1e3, e.prototype._startEnsureTriggerElement = function() {
        var e = this;
        return this._ensureTriggerElementTimeoutId = setInterval(function() {
            return e._ensureTriggerElement();
        }, this._ensureTriggerElementInterval);
    }, e.prototype._stopEnsureTriggerElement = function() {
        return clearInterval(this._ensureTriggerElementTimeoutId);
    }, e;
}(), vendors = [ "khtml", "ms", "o", "moz", "webkit" ], Opentip.prototype.setCss3Style = function(e, t) {
    var i, n, r, a, o;
    e = this.adapter.unwrap(e), o = [];
    for (i in t) __hasProp.call(t, i) && (n = t[i], e.style[i] != null ? o.push(e.style[i] = n) : o.push(function() {
        var t, o, s;
        for (s = [], t = 0, o = vendors.length; o > t; t++) r = vendors[t], a = "" + this.ucfirst(r) + this.ucfirst(i), 
        e.style[a] != null ? s.push(e.style[a] = n) : s.push(void 0);
        return s;
    }.call(this)));
    return o;
}, Opentip.prototype.defer = function(e) {
    return setTimeout(e, 0);
}, Opentip.prototype.setTimeout = function(e, t) {
    return setTimeout(e, t ? t * 1e3 : 0);
}, Opentip.prototype.ucfirst = function(e) {
    return e == null ? "" : e.charAt(0).toUpperCase() + e.slice(1);
}, Opentip.prototype.dasherize = function(e) {
    return e.replace(/([A-Z])/g, function(e, t) {
        return "-" + t.toLowerCase();
    });
}, mousePositionObservers = [], mousePosition = {
    x: 0,
    y: 0
}, mouseMoved = function(e) {
    var t, i, n, r;
    for (mousePosition = Opentip.adapter.mousePosition(e), r = [], i = 0, n = mousePositionObservers.length; n > i; i++) t = mousePositionObservers[i], 
    r.push(t());
    return r;
}, Opentip.followMousePosition = function() {
    return Opentip.adapter.observe(document.body, "mousemove", mouseMoved);
}, Opentip._observeMousePosition = function(e) {
    return mousePositionObservers.push(e);
}, Opentip._stopObservingMousePosition = function(e) {
    var t;
    return mousePositionObservers = function() {
        var i, n, r;
        for (r = [], i = 0, n = mousePositionObservers.length; n > i; i++) t = mousePositionObservers[i], 
        t !== e && r.push(t);
        return r;
    }();
}, Opentip.Joint = function() {
    function e(e) {
        e != null && (e instanceof Opentip.Joint && (e += ""), this.set(e));
    }
    return e.prototype.set = function(e) {
        return e = e.toLowerCase(), this.setHorizontal(e), this.setVertical(e), this;
    }, e.prototype.setHorizontal = function(e) {
        var t, i, n, r, a, o, s;
        for (i = [ "left", "center", "right" ], n = 0, a = i.length; a > n; n++) t = i[n], 
        ~e.indexOf(t) && (this.horizontal = t.toLowerCase());
        for (this.horizontal == null && (this.horizontal = "center"), s = [], r = 0, o = i.length; o > r; r++) t = i[r], 
        s.push(this[t] = this.horizontal === t ? t : void 0);
        return s;
    }, e.prototype.setVertical = function(e) {
        var t, i, n, r, a, o, s;
        for (i = [ "top", "middle", "bottom" ], n = 0, a = i.length; a > n; n++) t = i[n], 
        ~e.indexOf(t) && (this.vertical = t.toLowerCase());
        for (this.vertical == null && (this.vertical = "middle"), s = [], r = 0, o = i.length; o > r; r++) t = i[r], 
        s.push(this[t] = this.vertical === t ? t : void 0);
        return s;
    }, e.prototype.eql = function(e) {
        return e != null && this.horizontal === e.horizontal && this.vertical === e.vertical;
    }, e.prototype.flip = function() {
        var e, t;
        return t = Opentip.position[this.toString(!0)], e = (t + 4) % 8, this.set(Opentip.positions[e]), 
        this;
    }, e.prototype.toString = function(e) {
        var t, i;
        return e == null && (e = !1), i = this.vertical === "middle" ? "" : this.vertical, 
        t = this.horizontal === "center" ? "" : this.horizontal, i && t && (t = e ? Opentip.prototype.ucfirst(t) : " " + t), 
        "" + i + t;
    }, e;
}(), Opentip.prototype._positionsEqual = function(e, t) {
    return e != null && t != null && e.left === t.left && e.top === t.top;
}, Opentip.prototype._dimensionsEqual = function(e, t) {
    return e != null && t != null && e.width === t.width && e.height === t.height;
}, Opentip.prototype.debug = function() {
    var e;
    return e = arguments.length >= 1 ? __slice.call(arguments, 0) : [], Opentip.debug && (typeof console != "undefined" && console !== null ? console.debug : void 0) != null ? (e.unshift("#" + this.id + " |"), 
    console.debug.apply(console, e)) : void 0;
}, Opentip.findElements = function() {
    var e, t, i, n, r, a, o, s, l, c;
    for (e = Opentip.adapter, l = e.findAll(document.body, "[data-ot]"), c = [], o = 0, 
    s = l.length; s > o; o++) {
        i = l[o], a = {}, t = e.data(i, "ot"), (t === "" || t === "true" || t === "yes") && (t = e.attr(i, "title"), 
        e.attr(i, "title", "")), t = t || "";
        for (n in Opentip.styles.standard) r = e.data(i, "ot" + Opentip.prototype.ucfirst(n)), 
        r != null && (r === "yes" || r === "true" || r === "on" ? r = !0 : (r === "no" || r === "false" || r === "off") && (r = !1), 
        a[n] = r);
        c.push(new Opentip(i, t, a));
    }
    return c;
}, Opentip.version = "2.4.6", Opentip.debug = !1, Opentip.lastId = 0, Opentip.lastZIndex = 100, 
Opentip.tips = [], Opentip._abortShowingGroup = function(e, t) {
    var i, n, r, a, o;
    for (a = Opentip.tips, o = [], n = 0, r = a.length; r > n; n++) i = a[n], i !== t && i.options.group === e ? o.push(i._abortShowing()) : o.push(void 0);
    return o;
}, Opentip._hideGroup = function(e, t) {
    var i, n, r, a, o;
    for (a = Opentip.tips, o = [], n = 0, r = a.length; r > n; n++) i = a[n], i !== t && i.options.group === e ? o.push(i.hide()) : o.push(void 0);
    return o;
}, Opentip.adapters = {}, Opentip.adapter = null, firstAdapter = !0, Opentip.addAdapter = function(e) {
    return Opentip.adapters[e.name] = e, firstAdapter ? (Opentip.adapter = e, e.domReady(Opentip.findElements), 
    e.domReady(Opentip.followMousePosition), firstAdapter = !1) : void 0;
}, Opentip.positions = [ "top", "topRight", "right", "bottomRight", "bottom", "bottomLeft", "left", "topLeft" ], 
Opentip.position = {}, _ref = Opentip.positions, i = _i = 0, _len = _ref.length; _len > _i; i = ++_i) position = _ref[i], 
Opentip.position[position] = i;

Opentip.styles = {
    standard: {
        "extends": null,
        title: void 0,
        escapeTitle: !0,
        escapeContent: !1,
        className: "standard",
        stem: !0,
        delay: null,
        hideDelay: .1,
        fixed: !1,
        showOn: "mouseover",
        hideTrigger: "trigger",
        hideTriggers: [],
        hideOn: null,
        removeElementsOnHide: !1,
        offset: [ 0, 0 ],
        containInViewport: !0,
        autoOffset: !0,
        showEffect: "appear",
        hideEffect: "fade",
        showEffectDuration: .3,
        hideEffectDuration: .2,
        stemLength: 5,
        stemBase: 8,
        tipJoint: "top left",
        target: null,
        targetJoint: null,
        cache: !0,
        ajax: !1,
        ajaxMethod: "GET",
        ajaxErrorMessage: "There was a problem downloading the content.",
        group: null,
        style: null,
        background: "#fff18f",
        backgroundGradientHorizontal: !1,
        closeButtonOffset: [ 5, 5 ],
        closeButtonRadius: 7,
        closeButtonCrossSize: 4,
        closeButtonCrossColor: "#d2c35b",
        closeButtonCrossLineWidth: 1.5,
        closeButtonLinkOverscan: 6,
        borderRadius: 5,
        borderWidth: 1,
        borderColor: "#f2e37b",
        shadow: !0,
        shadowBlur: 10,
        shadowOffset: [ 3, 3 ],
        shadowColor: "rgba(0, 0, 0, 0.1)"
    },
    glass: {
        "extends": "standard",
        className: "glass",
        background: [ [ 0, "rgba(252, 252, 252, 0.8)" ], [ .5, "rgba(255, 255, 255, 0.8)" ], [ .5, "rgba(250, 250, 250, 0.9)" ], [ 1, "rgba(245, 245, 245, 0.9)" ] ],
        borderColor: "#eee",
        closeButtonCrossColor: "rgba(0, 0, 0, 0.2)",
        borderRadius: 15,
        closeButtonRadius: 10,
        closeButtonOffset: [ 8, 8 ]
    },
    dark: {
        "extends": "standard",
        className: "dark",
        borderRadius: 13,
        borderColor: "#444",
        closeButtonCrossColor: "rgba(240, 240, 240, 1)",
        shadowColor: "rgba(0, 0, 0, 0.3)",
        shadowOffset: [ 2, 2 ],
        background: [ [ 0, "rgba(30, 30, 30, 0.7)" ], [ .5, "rgba(30, 30, 30, 0.8)" ], [ .5, "rgba(10, 10, 10, 0.8)" ], [ 1, "rgba(10, 10, 10, 0.9)" ] ]
    },
    alert: {
        "extends": "standard",
        className: "alert",
        borderRadius: 1,
        borderColor: "#AE0D11",
        closeButtonCrossColor: "rgba(255, 255, 255, 1)",
        shadowColor: "rgba(0, 0, 0, 0.3)",
        shadowOffset: [ 2, 2 ],
        background: [ [ 0, "rgba(203, 15, 19, 0.7)" ], [ .5, "rgba(203, 15, 19, 0.8)" ], [ .5, "rgba(189, 14, 18, 0.8)" ], [ 1, "rgba(179, 14, 17, 0.9)" ] ]
    }
}, Opentip.defaultStyle = "standard", typeof module != "undefined" && module !== null ? module.exports = Opentip : window.Opentip = Opentip;

var __slice = [].slice;

(function(e) {
    var t;
    return e.fn.opentip = function(e, t, i) {
        return new Opentip(this, e, t, i);
    }, t = function() {
        function t() {}
        return t.prototype.name = "jquery", t.prototype.domReady = function(t) {
            return e(t);
        }, t.prototype.create = function(t) {
            return e(t);
        }, t.prototype.wrap = function(t) {
            if (t = e(t), t.length > 1) throw Error("Multiple elements provided.");
            return t;
        }, t.prototype.unwrap = function(t) {
            return e(t)[0];
        }, t.prototype.tagName = function(e) {
            return this.unwrap(e).tagName;
        }, t.prototype.attr = function() {
            var t, i, n;
            return i = arguments[0], t = arguments.length >= 2 ? __slice.call(arguments, 1) : [], 
            (n = e(i)).attr.apply(n, t);
        }, t.prototype.data = function() {
            var t, i, n;
            return i = arguments[0], t = arguments.length >= 2 ? __slice.call(arguments, 1) : [], 
            (n = e(i)).data.apply(n, t);
        }, t.prototype.find = function(t, i) {
            return e(t).find(i).get(0);
        }, t.prototype.findAll = function(t, i) {
            return e(t).find(i);
        }, t.prototype.update = function(t, i, n) {
            return t = e(t), n ? t.text(i) : t.html(i);
        }, t.prototype.append = function(t, i) {
            return e(t).append(i);
        }, t.prototype.remove = function(t) {
            return e(t).remove();
        }, t.prototype.addClass = function(t, i) {
            return e(t).addClass(i);
        }, t.prototype.removeClass = function(t, i) {
            return e(t).removeClass(i);
        }, t.prototype.css = function(t, i) {
            return e(t).css(i);
        }, t.prototype.dimensions = function(t) {
            return {
                width: e(t).outerWidth(),
                height: e(t).outerHeight()
            };
        }, t.prototype.scrollOffset = function() {
            return [ window.pageXOffset || document.documentElement.scrollLeft || document.body.scrollLeft, window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop ];
        }, t.prototype.viewportDimensions = function() {
            return {
                width: document.documentElement.clientWidth,
                height: document.documentElement.clientHeight
            };
        }, t.prototype.mousePosition = function(e) {
            return e == null ? null : {
                x: e.pageX,
                y: e.pageY
            };
        }, t.prototype.offset = function(t) {
            var i;
            return i = e(t).offset(), {
                left: i.left,
                top: i.top
            };
        }, t.prototype.observe = function(t, i, n) {
            return e(t).bind(i, n);
        }, t.prototype.stopObserving = function(t, i, n) {
            return e(t).unbind(i, n);
        }, t.prototype.ajax = function(t) {
            var i, n;
            if (t.url == null) throw Error("No url provided");
            return e.ajax({
                url: t.url,
                type: (i = (n = t.method) != null ? n.toUpperCase() : void 0) != null ? i : "GET"
            }).done(function(e) {
                return typeof t.onSuccess == "function" ? t.onSuccess(e) : void 0;
            }).fail(function(e) {
                return typeof t.onError == "function" ? t.onError("Server responded with status " + e.status) : void 0;
            }).always(function() {
                return typeof t.onComplete == "function" ? t.onComplete() : void 0;
            });
        }, t.prototype.clone = function(t) {
            return e.extend({}, t);
        }, t.prototype.extend = function() {
            var t, i;
            return i = arguments[0], t = arguments.length >= 2 ? __slice.call(arguments, 1) : [], 
            e.extend.apply(e, [ i ].concat(__slice.call(t)));
        }, t;
    }(), Opentip.addAdapter(new t());
})(jQuery), document.createElement("canvas").getContext || function() {
    function e() {
        return this.context_ || (this.context_ = new c(this));
    }
    function t(e, t) {
        var i = _.call(arguments, 2);
        return function() {
            return e.apply(t, i.concat(_.call(arguments)));
        };
    }
    function i(e) {
        var t = e.srcElement;
        switch (e.propertyName) {
          case "width":
            t.style.width = t.attributes.width.nodeValue + "px", t.getContext().clearRect();
            break;

          case "height":
            t.style.height = t.attributes.height.nodeValue + "px", t.getContext().clearRect();
        }
    }
    function n(e) {
        var t = e.srcElement;
        t.firstChild && (t.firstChild.style.width = t.clientWidth + "px", t.firstChild.style.height = t.clientHeight + "px");
    }
    function r() {
        return [ [ 1, 0, 0 ], [ 0, 1, 0 ], [ 0, 0, 1 ] ];
    }
    function a(e, t) {
        for (var i = r(), n = 0; 3 > n; n++) for (var a = 0; 3 > a; a++) {
            for (var o = 0, s = 0; 3 > s; s++) o += e[n][s] * t[s][a];
            i[n][a] = o;
        }
        return i;
    }
    function o(e, t) {
        t.fillStyle = e.fillStyle, t.lineCap = e.lineCap, t.lineJoin = e.lineJoin, t.lineWidth = e.lineWidth, 
        t.miterLimit = e.miterLimit, t.shadowBlur = e.shadowBlur, t.shadowColor = e.shadowColor, 
        t.shadowOffsetX = e.shadowOffsetX, t.shadowOffsetY = e.shadowOffsetY, t.strokeStyle = e.strokeStyle, 
        t.globalAlpha = e.globalAlpha, t.arcScaleX_ = e.arcScaleX_, t.arcScaleY_ = e.arcScaleY_, 
        t.lineScale_ = e.lineScale_;
    }
    function s(e) {
        var t, i = 1;
        if (e += "", e.substring(0, 3) == "rgb") {
            var n = e.indexOf("(", 3), r = e.indexOf(")", n + 1), a = e.substring(n + 1, r).split(",");
            t = "#";
            for (var o = 0; 3 > o; o++) t += k[Number(a[o])];
            a.length == 4 && e.substr(3, 1) == "a" && (i = a[3]);
        } else t = e;
        return {
            color: t,
            alpha: i
        };
    }
    function l(e) {
        switch (e) {
          case "butt":
            return "flat";

          case "round":
            return "round";

          case "square":
          default:
            return "square";
        }
    }
    function c(e) {
        this.m_ = r(), this.mStack_ = [], this.aStack_ = [], this.currentPath_ = [], this.strokeStyle = "#000", 
        this.fillStyle = "#000", this.lineWidth = 1, this.lineJoin = "miter", this.lineCap = "butt", 
        this.miterLimit = C * 1, this.globalAlpha = 1, this.canvas = e;
        var t = e.ownerDocument.createElement("div");
        t.style.width = e.clientWidth + "px", t.style.height = e.clientHeight + "px", t.style.position = "absolute", 
        e.appendChild(t), this.element_ = t, this.arcScaleX_ = 1, this.arcScaleY_ = 1, this.lineScale_ = 1;
    }
    function u(e, t, i, n) {
        e.currentPath_.push({
            type: "bezierCurveTo",
            cp1x: t.x,
            cp1y: t.y,
            cp2x: i.x,
            cp2y: i.y,
            x: n.x,
            y: n.y
        }), e.currentX_ = n.x, e.currentY_ = n.y;
    }
    function f(e) {
        for (var t = 0; 3 > t; t++) for (var i = 0; 2 > i; i++) if (!isFinite(e[t][i]) || isNaN(e[t][i])) return !1;
        return !0;
    }
    function d(e, t, i) {
        if (f(t) && (e.m_ = t, i)) {
            var n = t[0][0] * t[1][1] - t[0][1] * t[1][0];
            e.lineScale_ = w(b(n));
        }
    }
    function h(e) {
        this.type_ = e, this.x0_ = 0, this.y0_ = 0, this.r0_ = 0, this.x1_ = 0, this.y1_ = 0, 
        this.r1_ = 0, this.colors_ = [];
    }
    function p() {}
    var g = Math, m = g.round, v = g.sin, y = g.cos, b = g.abs, w = g.sqrt, C = 10, x = C / 2, _ = Array.prototype.slice, S = {
        init: function(e) {
            if (/MSIE/.test(navigator.userAgent) && !window.opera) {
                var i = e || document;
                i.createElement("canvas"), i.attachEvent("onreadystatechange", t(this.init_, this, i));
            }
        },
        init_: function(e) {
            if (e.namespaces.g_vml_ || e.namespaces.add("g_vml_", "urn:schemas-microsoft-com:vml", "#default#VML"), 
            e.namespaces.g_o_ || e.namespaces.add("g_o_", "urn:schemas-microsoft-com:office:office", "#default#VML"), 
            !e.styleSheets.ex_canvas_) {
                var t = e.createStyleSheet();
                t.owningElement.id = "ex_canvas_", t.cssText = "canvas{display:inline-block;overflow:hidden;text-align:left;width:300px;height:150px}g_vml_\\:*{behavior:url(#default#VML)}g_o_\\:*{behavior:url(#default#VML)}";
            }
            for (var i = e.getElementsByTagName("canvas"), n = 0; i.length > n; n++) this.initElement(i[n]);
        },
        initElement: function(t) {
            if (!t.getContext) {
                t.getContext = e, t.innerHTML = "", t.attachEvent("onpropertychange", i), t.attachEvent("onresize", n);
                var r = t.attributes;
                r.width && r.width.specified ? t.style.width = r.width.nodeValue + "px" : t.width = t.clientWidth, 
                r.height && r.height.specified ? t.style.height = r.height.nodeValue + "px" : t.height = t.clientHeight;
            }
            return t;
        }
    };
    S.init();
    for (var k = [], A = 0; 16 > A; A++) for (var E = 0; 16 > E; E++) k[A * 16 + E] = A.toString(16) + E.toString(16);
    var T = c.prototype;
    T.clearRect = function() {
        this.element_.innerHTML = "";
    }, T.beginPath = function() {
        this.currentPath_ = [];
    }, T.moveTo = function(e, t) {
        var i = this.getCoords_(e, t);
        this.currentPath_.push({
            type: "moveTo",
            x: i.x,
            y: i.y
        }), this.currentX_ = i.x, this.currentY_ = i.y;
    }, T.lineTo = function(e, t) {
        var i = this.getCoords_(e, t);
        this.currentPath_.push({
            type: "lineTo",
            x: i.x,
            y: i.y
        }), this.currentX_ = i.x, this.currentY_ = i.y;
    }, T.bezierCurveTo = function(e, t, i, n, r, a) {
        var o = this.getCoords_(r, a), s = this.getCoords_(e, t), l = this.getCoords_(i, n);
        u(this, s, l, o);
    }, T.quadraticCurveTo = function(e, t, i, n) {
        var r = this.getCoords_(e, t), a = this.getCoords_(i, n), o = {
            x: this.currentX_ + 2 / 3 * (r.x - this.currentX_),
            y: this.currentY_ + 2 / 3 * (r.y - this.currentY_)
        }, s = {
            x: o.x + (a.x - this.currentX_) / 3,
            y: o.y + (a.y - this.currentY_) / 3
        };
        u(this, o, s, a);
    }, T.arc = function(e, t, i, n, r, a) {
        i *= C;
        var o = a ? "at" : "wa", s = e + y(n) * i - x, l = t + v(n) * i - x, c = e + y(r) * i - x, u = t + v(r) * i - x;
        s != c || a || (s += .125);
        var f = this.getCoords_(e, t), d = this.getCoords_(s, l), h = this.getCoords_(c, u);
        this.currentPath_.push({
            type: o,
            x: f.x,
            y: f.y,
            radius: i,
            xStart: d.x,
            yStart: d.y,
            xEnd: h.x,
            yEnd: h.y
        });
    }, T.rect = function(e, t, i, n) {
        this.moveTo(e, t), this.lineTo(e + i, t), this.lineTo(e + i, t + n), this.lineTo(e, t + n), 
        this.closePath();
    }, T.strokeRect = function(e, t, i, n) {
        var r = this.currentPath_;
        this.beginPath(), this.moveTo(e, t), this.lineTo(e + i, t), this.lineTo(e + i, t + n), 
        this.lineTo(e, t + n), this.closePath(), this.stroke(), this.currentPath_ = r;
    }, T.fillRect = function(e, t, i, n) {
        var r = this.currentPath_;
        this.beginPath(), this.moveTo(e, t), this.lineTo(e + i, t), this.lineTo(e + i, t + n), 
        this.lineTo(e, t + n), this.closePath(), this.fill(), this.currentPath_ = r;
    }, T.createLinearGradient = function(e, t, i, n) {
        var r = new h("gradient");
        return r.x0_ = e, r.y0_ = t, r.x1_ = i, r.y1_ = n, r;
    }, T.createRadialGradient = function(e, t, i, n, r, a) {
        var o = new h("gradientradial");
        return o.x0_ = e, o.y0_ = t, o.r0_ = i, o.x1_ = n, o.y1_ = r, o.r1_ = a, o;
    }, T.drawImage = function(e) {
        var t, i, n, r, a, o, s, l, c = e.runtimeStyle.width, u = e.runtimeStyle.height;
        e.runtimeStyle.width = "auto", e.runtimeStyle.height = "auto";
        var f = e.width, d = e.height;
        if (e.runtimeStyle.width = c, e.runtimeStyle.height = u, arguments.length == 3) t = arguments[1], 
        i = arguments[2], a = o = 0, s = n = f, l = r = d; else if (arguments.length == 5) t = arguments[1], 
        i = arguments[2], n = arguments[3], r = arguments[4], a = o = 0, s = f, l = d; else {
            if (arguments.length != 9) throw Error("Invalid number of arguments");
            a = arguments[1], o = arguments[2], s = arguments[3], l = arguments[4], t = arguments[5], 
            i = arguments[6], n = arguments[7], r = arguments[8];
        }
        var h = this.getCoords_(t, i), p = [], v = 10, y = 10;
        if (p.push(" <g_vml_:group", ' coordsize="', C * v, ",", C * y, '"', ' coordorigin="0,0"', ' style="width:', v, "px;height:", y, "px;position:absolute;"), 
        this.m_[0][0] != 1 || this.m_[0][1]) {
            var b = [];
            b.push("M11=", this.m_[0][0], ",", "M12=", this.m_[1][0], ",", "M21=", this.m_[0][1], ",", "M22=", this.m_[1][1], ",", "Dx=", m(h.x / C), ",", "Dy=", m(h.y / C), "");
            var w = h, x = this.getCoords_(t + n, i), _ = this.getCoords_(t, i + r), S = this.getCoords_(t + n, i + r);
            w.x = g.max(w.x, x.x, _.x, S.x), w.y = g.max(w.y, x.y, _.y, S.y), p.push("padding:0 ", m(w.x / C), "px ", m(w.y / C), "px 0;filter:progid:DXImageTransform.Microsoft.Matrix(", b.join(""), ", sizingmethod='clip');");
        } else p.push("top:", m(h.y / C), "px;left:", m(h.x / C), "px;");
        p.push(' ">', '<g_vml_:image src="', e.src, '"', ' style="width:', C * n, "px;", " height:", C * r, 'px;"', ' cropleft="', a / f, '"', ' croptop="', o / d, '"', ' cropright="', (f - a - s) / f, '"', ' cropbottom="', (d - o - l) / d, '"', " />", "</g_vml_:group>"), 
        this.element_.insertAdjacentHTML("BeforeEnd", p.join(""));
    }, T.stroke = function(e) {
        var t = [], i = s(e ? this.fillStyle : this.strokeStyle), n = i.color, r = i.alpha * this.globalAlpha, a = 10, o = 10;
        t.push("<g_vml_:shape", ' filled="', !!e, '"', ' style="position:absolute;width:', a, "px;height:", o, 'px;"', ' coordorigin="0 0" coordsize="', C * a, " ", C * o, '"', ' stroked="', !e, '"', ' path="');
        for (var c = {
            x: null,
            y: null
        }, u = {
            x: null,
            y: null
        }, f = 0; this.currentPath_.length > f; f++) {
            var d, h = this.currentPath_[f];
            switch (h.type) {
              case "moveTo":
                d = h, t.push(" m ", m(h.x), ",", m(h.y));
                break;

              case "lineTo":
                t.push(" l ", m(h.x), ",", m(h.y));
                break;

              case "close":
                t.push(" x "), h = null;
                break;

              case "bezierCurveTo":
                t.push(" c ", m(h.cp1x), ",", m(h.cp1y), ",", m(h.cp2x), ",", m(h.cp2y), ",", m(h.x), ",", m(h.y));
                break;

              case "at":
              case "wa":
                t.push(" ", h.type, " ", m(h.x - this.arcScaleX_ * h.radius), ",", m(h.y - this.arcScaleY_ * h.radius), " ", m(h.x + this.arcScaleX_ * h.radius), ",", m(h.y + this.arcScaleY_ * h.radius), " ", m(h.xStart), ",", m(h.yStart), " ", m(h.xEnd), ",", m(h.yEnd));
            }
            h && ((c.x == null || c.x > h.x) && (c.x = h.x), (u.x == null || h.x > u.x) && (u.x = h.x), 
            (c.y == null || c.y > h.y) && (c.y = h.y), (u.y == null || h.y > u.y) && (u.y = h.y));
        }
        if (t.push(' ">'), e) if (typeof this.fillStyle == "object") {
            var p = this.fillStyle, v = 0, y = {
                x: 0,
                y: 0
            }, b = 0, w = 1;
            if (p.type_ == "gradient") {
                var x = p.x0_ / this.arcScaleX_, _ = p.y0_ / this.arcScaleY_, S = p.x1_ / this.arcScaleX_, k = p.y1_ / this.arcScaleY_, A = this.getCoords_(x, _), E = this.getCoords_(S, k), T = E.x - A.x, P = E.y - A.y;
                v = Math.atan2(T, P) * 180 / Math.PI, 0 > v && (v += 360), 1e-6 > v && (v = 0);
            } else {
                var A = this.getCoords_(p.x0_, p.y0_), I = u.x - c.x, O = u.y - c.y;
                y = {
                    x: (A.x - c.x) / I,
                    y: (A.y - c.y) / O
                }, I /= this.arcScaleX_ * C, O /= this.arcScaleY_ * C;
                var D = g.max(I, O);
                b = 2 * p.r0_ / D, w = 2 * p.r1_ / D - b;
            }
            var R = p.colors_;
            R.sort(function(e, t) {
                return e.offset - t.offset;
            });
            for (var L = R.length, F = R[0].color, M = R[L - 1].color, N = R[0].alpha * this.globalAlpha, B = R[L - 1].alpha * this.globalAlpha, j = [], f = 0; L > f; f++) {
                var U = R[f];
                j.push(U.offset * w + b + " " + U.color);
            }
            t.push('<g_vml_:fill type="', p.type_, '"', ' method="none" focus="100%"', ' color="', F, '"', ' color2="', M, '"', ' colors="', j.join(","), '"', ' opacity="', B, '"', ' g_o_:opacity2="', N, '"', ' angle="', v, '"', ' focusposition="', y.x, ",", y.y, '" />');
        } else t.push('<g_vml_:fill color="', n, '" opacity="', r, '" />'); else {
            var z = this.lineScale_ * this.lineWidth;
            1 > z && (r *= z), t.push("<g_vml_:stroke", ' opacity="', r, '"', ' joinstyle="', this.lineJoin, '"', ' miterlimit="', this.miterLimit, '"', ' endcap="', l(this.lineCap), '"', ' weight="', z, 'px"', ' color="', n, '" />');
        }
        t.push("</g_vml_:shape>"), this.element_.insertAdjacentHTML("beforeEnd", t.join(""));
    }, T.fill = function() {
        this.stroke(!0);
    }, T.closePath = function() {
        this.currentPath_.push({
            type: "close"
        });
    }, T.getCoords_ = function(e, t) {
        var i = this.m_;
        return {
            x: C * (e * i[0][0] + t * i[1][0] + i[2][0]) - x,
            y: C * (e * i[0][1] + t * i[1][1] + i[2][1]) - x
        };
    }, T.save = function() {
        var e = {};
        o(this, e), this.aStack_.push(e), this.mStack_.push(this.m_), this.m_ = a(r(), this.m_);
    }, T.restore = function() {
        o(this.aStack_.pop(), this), this.m_ = this.mStack_.pop();
    }, T.translate = function(e, t) {
        var i = [ [ 1, 0, 0 ], [ 0, 1, 0 ], [ e, t, 1 ] ];
        d(this, a(i, this.m_), !1);
    }, T.rotate = function(e) {
        var t = y(e), i = v(e), n = [ [ t, i, 0 ], [ -i, t, 0 ], [ 0, 0, 1 ] ];
        d(this, a(n, this.m_), !1);
    }, T.scale = function(e, t) {
        this.arcScaleX_ *= e, this.arcScaleY_ *= t;
        var i = [ [ e, 0, 0 ], [ 0, t, 0 ], [ 0, 0, 1 ] ];
        d(this, a(i, this.m_), !0);
    }, T.transform = function(e, t, i, n, r, o) {
        var s = [ [ e, t, 0 ], [ i, n, 0 ], [ r, o, 1 ] ];
        d(this, a(s, this.m_), !0);
    }, T.setTransform = function(e, t, i, n, r, a) {
        var o = [ [ e, t, 0 ], [ i, n, 0 ], [ r, a, 1 ] ];
        d(this, o, !0);
    }, T.clip = function() {}, T.arcTo = function() {}, T.createPattern = function() {
        return new p();
    }, h.prototype.addColorStop = function(e, t) {
        t = s(t), this.colors_.push({
            offset: e,
            color: t.color,
            alpha: t.alpha
        });
    }, G_vmlCanvasManager = S, CanvasRenderingContext2D = c, CanvasGradient = h, CanvasPattern = p;
}();

define("tooltip", function() {});

define("uiObject", [ "utils", "signal", "tooltip" ], function(e, t, i) {
    var n = function(e) {
        this.config = e || {};
        this.initialize.call(this, e);
    };
    n.prototype.initialize = function() {};
    n.prototype.render = function() {
        this.config.customContainer && (this.config.container = this.config.customContainer);
        var e = $(this.template);
        if (this.config.logo) {
            var t = $(this.logo);
            e.find(".logoPicsioEditor").append(t);
        }
        $(this.config.container).append(e);
        this.$el = e;
        this.el = e[0];
        this.elem = e;
        this.createTooltip();
        return e;
    };
    n.prototype.createTooltip = function() {
        if (this.config.tooltip && typeof this.config.tooltip === "object") {
            new Opentip(this.$el, this.config.tooltip.title, {
                tipJoint: this.config.tooltip.align || "center",
                background: this.config.tooltip.background || "#000",
                borderColor: this.config.tooltip.borderColor || "#000",
                delay: this.config.tooltip.delay || null,
                target: this.config.tooltip.target || true,
                removeElementsOnHide: this.config.tooltip.removeElementsOnHide || true
            });
        }
    };
    n.prototype.show = function() {
        this.$el.show();
    };
    n.prototype.hide = function() {
        this.$el.hide();
    };
    n.prototype.template = "<div></div>";
    n.prototype.switchState = function() {
        this.state = !this.state;
    };
    n.prototype.changeVal = function(e) {
        return this.val = e;
    };
    n.extend = function(t, i) {
        var n = this;
        var r;
        if (t && hasOwnProperty.call(t, "constructor")) {
            r = t.constructor;
        } else {
            r = function() {
                return n.apply(this, arguments);
            };
        }
        e.mixin(r, n, i);
        var a = function() {
            this.constructor = r;
        };
        a.prototype = n.prototype;
        r.prototype = new a();
        if (t) e.mixin(r.prototype, t);
        r.prototype.__super__ = n.prototype;
        return r;
    };
    return n.extend(t);
});

define("Widget/button", [ "uiObject", "mustache" ], function(e, t) {
    var i = e.extend({
        initialize: function() {
            var e = this;
            this.config.container = this.config.parentToolbar ? this.config.parentToolbar : this.config.container;
            this.disable = typeof this.config.disable == "boolean" ? this.config.disable : false;
            if (this.config.type == "icon") {
                this.template = t.to_html('<li {{#id}}id="{{id}}"{{/id}} class="{{#classList}}{{.}} {{/classList}}"><span class="itemIcon {{className}}" style="{{#icon}}background-image: url({{icon}}){{/icon}}"></span></li>', {
                    id: this.config.id,
                    className: this.config.className,
                    plugin_name: this.config.title,
                    icon: this.config.icon,
                    plugin_path: this.config.path || "",
                    classList: this.config.classList
                });
            } else if (this.config.title) {
                var i = this.config.defaultValue === undefined ? "" : this.config.defaultValue;
                this.template = t.to_html('<li class="{{#classList}}{{.}} {{/classList}}">{{plugin_name}}</li>', {
                    plugin_name: this.config.title,
                    classList: this.config.classList
                });
            } else {
                this.template = t.to_html('<div class = "pics-button {{className}}">{{text}}</div>', {
                    className: this.config.className,
                    text: this.config.text
                });
            }
            var n = this.render();
            if (this.config.tooltip) {
                new Opentip(n[0], this.config.tooltip, {
                    tipJoint: e.config.parentToolbar.parents("#thirdPicsioToolbar").length ? "right" : "bottom",
                    background: "#000",
                    borderColor: "#000",
                    delay: null,
                    target: true,
                    removeElementsOnHide: true
                });
            }
            n.on("click", function(t) {
                !e.disable && e.config.click && e.config.click(t);
            });
        }
    });
    return i;
});

define("Widget/canvas", [ "uiObject", "mustache" ], function(e, t) {
    return e.extend({
        initialize: function() {
            var e = this, t = this.render(), i = t[0], n = i.getContext("2d"), r = this.config.classList ? this.config.classList.join(" ") : null;
            i.width = this.config.imageData.width;
            i.height = this.config.imageData.height;
            if (r !== null) {
                i.classList.add(r);
            }
            n.putImageData(this.config.imageData, 0, 0);
            this.elem = t;
        },
        setImageData: function(e) {
            var t = this.getNode()[0];
            if (t.width !== e.width || t.height !== e.height) {
                console.log("Incorrect size of image data");
            } else {
                var i = t.getContext("2d");
                i.putImageData(e, 0, 0);
            }
        },
        getNode: function() {
            return this.elem;
        },
        template: "<canvas></canvas>"
    });
});

define("Widget/checkbox", [ "uiObject", "mustache" ], function(e, t) {
    var i = e.extend({
        initialize: function() {
            var e = this, i = this.config.label || "", n = "", r = "", a = this.config.checked || this.config.defaultValue || false;
            if (this.config.switcher === true) {
                n += "picsioSwitcher ";
            } else {
                n += "picsioCheckbox ";
            }
            if (this.config.classList) {
                n += this.config.classList.join(" ");
            }
            if (this.config.styleList) {
                for (style in this.config.styleList) {
                    r += style + ": " + this.config.styleList[style] + "; ";
                }
            }
            this.template = t.to_html('<div class="{{classList}}" style="{{styleList}}" data-checked="{{checked}}">{{#image}}<img src="{{image}}">{{/image}}{{label}}</div>', {
                label: i,
                image: this.config.image,
                classList: n,
                styleList: r,
                checked: a
            });
            this.checked = a;
            if (a) {
                this.config.onChecked && this.config.onChecked();
            } else {
                this.config.onUnchecked && this.config.onUnchecked();
            }
            this.render();
            if (this.config.disabled) {
                this.disable();
            }
            this.toggleCheckedHandler = this.toggleChecked.bind(this);
            this.el.addEventListener("click", this.toggleCheckedHandler, false);
        },
        checked: false,
        enabled: true,
        disable: function() {
            this.enabled = false;
            this.$el.addClass("disable");
        },
        enable: function() {
            this.enabled = true;
            this.$el.removeClass("disable");
        },
        toggleEnabling: function() {
            this.enabled ? this.disable() : this.enable();
        },
        isDisabled: function() {
            return !this.enabled;
        },
        isEnabled: function() {
            return this.enabled;
        },
        getValue: function() {
            return this.checked;
        },
        setValue: function(e, t) {
            e = !!e;
            this.checked = e;
            this.el.dataset.checked = e.toString();
            this.config.onChange && this.config.onChange(e, t);
            if (e) {
                this.config.onChecked && this.config.onChecked();
            } else {
                this.config.onUnchecked && this.config.onUnchecked();
            }
        },
        toggleChecked: function() {
            if (this.isDisabled()) {
                return;
            }
            if (this.checked) {
                this.config.onChange && this.config.onChange(false);
                this.config.onUnchecked && this.config.onUnchecked();
                this.el.dataset.checked = "false";
                this.checked = false;
            } else {
                this.config.onChange && this.config.onChange(true);
                this.config.onChecked && this.config.onChecked();
                this.el.dataset.checked = "true";
                this.checked = true;
            }
        },
        isChecked: function() {
            return this.checked;
        },
        setTitle: function(e) {
            this.el.innerText = e;
        },
        destroy: function(e) {
            e.removeEventListener("click", this.config.onChange, false);
            e.removeEventListener("click", this.getCheckedHandler, false);
            e.parentNode.removeChild(e);
        }
    });
    return i;
});

var installedColorSpaces = [], namedColors = {}, undef = function(e) {
    return typeof e === "undefined";
}, channelRegExp = /\s*(\.\d+|\d+(?:\.\d+)?)(%)?\s*/, alphaChannelRegExp = /\s*(\.\d+|\d+(?:\.\d+)?)\s*/, cssColorRegExp = new RegExp("^(rgb|hsl|hsv)a?" + "\\(" + channelRegExp.source + "," + channelRegExp.source + "," + channelRegExp.source + "(?:," + alphaChannelRegExp.source + ")?" + "\\)$", "i");

function ONECOLOR(e) {
    if (Object.prototype.toString.apply(e) === "[object Array]") {
        if (typeof e[0] === "string" && typeof ONECOLOR[e[0]] === "function") {
            return new ONECOLOR[e[0]](e.slice(1, e.length));
        } else if (e.length === 4) {
            return new ONECOLOR.RGB(e[0] / 255, e[1] / 255, e[2] / 255, e[3] / 255);
        }
    } else if (typeof e === "string") {
        var t = e.toLowerCase();
        if (namedColors[t]) {
            e = "#" + namedColors[t];
        }
        if (t === "transparent") {
            e = "rgba(0,0,0,0)";
        }
        var i = e.match(cssColorRegExp);
        if (i) {
            var n = i[1].toUpperCase(), r = undef(i[8]) ? i[8] : parseFloat(i[8]), a = n[0] === "H", o = i[3] ? 100 : a ? 360 : 255, s = i[5] || a ? 100 : 255, l = i[7] || a ? 100 : 255;
            if (undef(ONECOLOR[n])) {
                throw new Error("one.color." + n + " is not installed.");
            }
            return new ONECOLOR[n](parseFloat(i[2]) / o, parseFloat(i[4]) / s, parseFloat(i[6]) / l, r);
        }
        if (e.length < 6) {
            e = e.replace(/^#?([0-9a-f])([0-9a-f])([0-9a-f])$/i, "$1$1$2$2$3$3");
        }
        var c = e.match(/^#?([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])$/i);
        if (c) {
            return new ONECOLOR.RGB(parseInt(c[1], 16) / 255, parseInt(c[2], 16) / 255, parseInt(c[3], 16) / 255);
        }
    } else if (typeof e === "object" && e.isColor) {
        return e;
    }
    return false;
}

function installColorSpace(e, t, i) {
    ONECOLOR[e] = new Function(t.join(","), "if (Object.prototype.toString.apply(" + t[0] + ") === '[object Array]') {" + t.map(function(e, i) {
        return e + "=" + t[0] + "[" + i + "];";
    }).reverse().join("") + "}" + "if (" + t.filter(function(e) {
        return e !== "alpha";
    }).map(function(e) {
        return "isNaN(" + e + ")";
    }).join("||") + "){" + 'throw new Error("[' + e + ']: Invalid color: ("+' + t.join('+","+') + '+")");}' + t.map(function(e) {
        if (e === "hue") {
            return "this._hue=hue<0?hue-Math.floor(hue):hue%1";
        } else if (e === "alpha") {
            return "this._alpha=(isNaN(alpha)||alpha>1)?1:(alpha<0?0:alpha);";
        } else {
            return "this._" + e + "=" + e + "<0?0:(" + e + ">1?1:" + e + ")";
        }
    }).join(";") + ";");
    ONECOLOR[e].propertyNames = t;
    var n = ONECOLOR[e].prototype;
    [ "valueOf", "hex", "hexa", "css", "cssa" ].forEach(function(t) {
        n[t] = n[t] || (e === "RGB" ? n.hex : new Function("return this.rgb()." + t + "();"));
    });
    n.isColor = true;
    n.equals = function(i, n) {
        if (undef(n)) {
            n = 1e-10;
        }
        i = i[e.toLowerCase()]();
        for (var r = 0; r < t.length; r = r + 1) {
            if (Math.abs(this["_" + t[r]] - i["_" + t[r]]) > n) {
                return false;
            }
        }
        return true;
    };
    n.toJSON = new Function("return ['" + e + "', " + t.map(function(e) {
        return "this._" + e;
    }, this).join(", ") + "];");
    for (var r in i) {
        if (i.hasOwnProperty(r)) {
            var a = r.match(/^from(.*)$/);
            if (a) {
                ONECOLOR[a[1].toUpperCase()].prototype[e.toLowerCase()] = i[r];
            } else {
                n[r] = i[r];
            }
        }
    }
    n[e.toLowerCase()] = function() {
        return this;
    };
    n.toString = new Function('return "[one.color.' + e + ':"+' + t.map(function(e, i) {
        return '" ' + t[i] + '="+this._' + e;
    }).join("+") + '+"]";');
    t.forEach(function(e, i) {
        n[e] = n[e === "black" ? "k" : e[0]] = new Function("value", "isDelta", "if (typeof value === 'undefined') {" + "return this._" + e + ";" + "}" + "if (isDelta) {" + "return new this.constructor(" + t.map(function(t, i) {
            return "this._" + t + (e === t ? "+value" : "");
        }).join(", ") + ");" + "}" + "return new this.constructor(" + t.map(function(t, i) {
            return e === t ? "value" : "this._" + t;
        }).join(", ") + ");");
    });
    function o(e, t) {
        var i = {};
        i[t.toLowerCase()] = new Function("return this.rgb()." + t.toLowerCase() + "();");
        ONECOLOR[t].propertyNames.forEach(function(e, n) {
            i[e] = i[e === "black" ? "k" : e[0]] = new Function("value", "isDelta", "return this." + t.toLowerCase() + "()." + e + "(value, isDelta);");
        });
        for (var n in i) {
            if (i.hasOwnProperty(n) && ONECOLOR[e].prototype[n] === undefined) {
                ONECOLOR[e].prototype[n] = i[n];
            }
        }
    }
    installedColorSpaces.forEach(function(t) {
        o(e, t);
        o(t, e);
    });
    installedColorSpaces.push(e);
}

ONECOLOR.installMethod = function(e, t) {
    installedColorSpaces.forEach(function(i) {
        ONECOLOR[i].prototype[e] = t;
    });
};

installColorSpace("RGB", [ "red", "green", "blue", "alpha" ], {
    hex: function() {
        var e = (Math.round(255 * this._red) * 65536 + Math.round(255 * this._green) * 256 + Math.round(255 * this._blue)).toString(16);
        return "#" + "00000".substr(0, 6 - e.length) + e;
    },
    hexa: function() {
        var e = Math.round(this._alpha * 255).toString(16);
        return "#" + "00".substr(0, 2 - e.length) + e + this.hex().substr(1, 6);
    },
    css: function() {
        return "rgb(" + Math.round(255 * this._red) + "," + Math.round(255 * this._green) + "," + Math.round(255 * this._blue) + ")";
    },
    cssa: function() {
        return "rgba(" + Math.round(255 * this._red) + "," + Math.round(255 * this._green) + "," + Math.round(255 * this._blue) + "," + this._alpha + ")";
    }
});

if (typeof module !== "undefined") {
    module.exports = ONECOLOR;
} else if (typeof define === "function" && !undef(define.amd)) {
    define("onecolor", [], function() {
        return ONECOLOR;
    });
} else if (typeof jQuery !== "undefined" && undef(jQuery.color)) {
    jQuery.color = ONECOLOR;
} else {
    one = window.one || {};
    one.color = ONECOLOR;
}

namedColors = {
    aliceblue: "f0f8ff",
    antiquewhite: "faebd7",
    aqua: "0ff",
    aquamarine: "7fffd4",
    azure: "f0ffff",
    beige: "f5f5dc",
    bisque: "ffe4c4",
    black: "000",
    blanchedalmond: "ffebcd",
    blue: "00f",
    blueviolet: "8a2be2",
    brown: "a52a2a",
    burlywood: "deb887",
    cadetblue: "5f9ea0",
    chartreuse: "7fff00",
    chocolate: "d2691e",
    coral: "ff7f50",
    cornflowerblue: "6495ed",
    cornsilk: "fff8dc",
    crimson: "dc143c",
    cyan: "0ff",
    darkblue: "00008b",
    darkcyan: "008b8b",
    darkgoldenrod: "b8860b",
    darkgray: "a9a9a9",
    darkgrey: "a9a9a9",
    darkgreen: "006400",
    darkkhaki: "bdb76b",
    darkmagenta: "8b008b",
    darkolivegreen: "556b2f",
    darkorange: "ff8c00",
    darkorchid: "9932cc",
    darkred: "8b0000",
    darksalmon: "e9967a",
    darkseagreen: "8fbc8f",
    darkslateblue: "483d8b",
    darkslategray: "2f4f4f",
    darkslategrey: "2f4f4f",
    darkturquoise: "00ced1",
    darkviolet: "9400d3",
    deeppink: "ff1493",
    deepskyblue: "00bfff",
    dimgray: "696969",
    dimgrey: "696969",
    dodgerblue: "1e90ff",
    firebrick: "b22222",
    floralwhite: "fffaf0",
    forestgreen: "228b22",
    fuchsia: "f0f",
    gainsboro: "dcdcdc",
    ghostwhite: "f8f8ff",
    gold: "ffd700",
    goldenrod: "daa520",
    gray: "808080",
    grey: "808080",
    green: "008000",
    greenyellow: "adff2f",
    honeydew: "f0fff0",
    hotpink: "ff69b4",
    indianred: "cd5c5c",
    indigo: "4b0082",
    ivory: "fffff0",
    khaki: "f0e68c",
    lavender: "e6e6fa",
    lavenderblush: "fff0f5",
    lawngreen: "7cfc00",
    lemonchiffon: "fffacd",
    lightblue: "add8e6",
    lightcoral: "f08080",
    lightcyan: "e0ffff",
    lightgoldenrodyellow: "fafad2",
    lightgray: "d3d3d3",
    lightgrey: "d3d3d3",
    lightgreen: "90ee90",
    lightpink: "ffb6c1",
    lightsalmon: "ffa07a",
    lightseagreen: "20b2aa",
    lightskyblue: "87cefa",
    lightslategray: "789",
    lightslategrey: "789",
    lightsteelblue: "b0c4de",
    lightyellow: "ffffe0",
    lime: "0f0",
    limegreen: "32cd32",
    linen: "faf0e6",
    magenta: "f0f",
    maroon: "800000",
    mediumaquamarine: "66cdaa",
    mediumblue: "0000cd",
    mediumorchid: "ba55d3",
    mediumpurple: "9370d8",
    mediumseagreen: "3cb371",
    mediumslateblue: "7b68ee",
    mediumspringgreen: "00fa9a",
    mediumturquoise: "48d1cc",
    mediumvioletred: "c71585",
    midnightblue: "191970",
    mintcream: "f5fffa",
    mistyrose: "ffe4e1",
    moccasin: "ffe4b5",
    navajowhite: "ffdead",
    navy: "000080",
    oldlace: "fdf5e6",
    olive: "808000",
    olivedrab: "6b8e23",
    orange: "ffa500",
    orangered: "ff4500",
    orchid: "da70d6",
    palegoldenrod: "eee8aa",
    palegreen: "98fb98",
    paleturquoise: "afeeee",
    palevioletred: "d87093",
    papayawhip: "ffefd5",
    peachpuff: "ffdab9",
    peru: "cd853f",
    pink: "ffc0cb",
    plum: "dda0dd",
    powderblue: "b0e0e6",
    purple: "800080",
    red: "f00",
    rosybrown: "bc8f8f",
    royalblue: "4169e1",
    saddlebrown: "8b4513",
    salmon: "fa8072",
    sandybrown: "f4a460",
    seagreen: "2e8b57",
    seashell: "fff5ee",
    sienna: "a0522d",
    silver: "c0c0c0",
    skyblue: "87ceeb",
    slateblue: "6a5acd",
    slategray: "708090",
    slategrey: "708090",
    snow: "fffafa",
    springgreen: "00ff7f",
    steelblue: "4682b4",
    tan: "d2b48c",
    teal: "008080",
    thistle: "d8bfd8",
    tomato: "ff6347",
    turquoise: "40e0d0",
    violet: "ee82ee",
    wheat: "f5deb3",
    white: "fff",
    whitesmoke: "f5f5f5",
    yellow: "ff0",
    yellowgreen: "9acd32"
};

installColorSpace("XYZ", [ "x", "y", "z", "alpha" ], {
    fromRgb: function() {
        var e = function(e) {
            return 100 * (e > .04045 ? Math.pow((e + .055) / 1.055, 2.4) : e / 12.92);
        }, t = e(this._red), i = e(this._green), n = e(this._blue);
        return new ONECOLOR.XYZ(t * .4124 + i * .3576 + n * .1805, t * .2126 + i * .7152 + n * .0722, t * .0193 + i * .1192 + n * .9505, this._alpha);
    },
    rgb: function() {
        var e = this._x / 100, t = this._y / 100, i = this._z / 100, n = function(e) {
            return e > .0031308 ? 1.055 * Math.pow(e, 1 / 2.4) - .055 : 12.92 * e;
        };
        return new ONECOLOR.RGB(n(e * 3.2406 + t * -1.5372 + i * -.4986), n(e * -.9689 + t * 1.8758 + i * .0415), n(e * .0557 + t * -.204 + i * 1.057), this._alpha);
    },
    lab: function() {
        var e = function(e) {
            return e > .008856 ? Math.pow(e, 1 / 3) : 7.787037 * e + 4 / 29;
        }, t = e(this._x / 95.047), i = e(this._y / 100), n = e(this._z / 108.883);
        return new ONECOLOR.LAB(116 * i - 16, 500 * (t - i), 200 * (i - n), this._alpha);
    }
});

installColorSpace("LAB", [ "l", "a", "b", "alpha" ], {
    fromRgb: function() {
        return this.xyz().lab();
    },
    rgb: function() {
        return this.xyz().rgb();
    },
    xyz: function() {
        var e = function(e) {
            var t = Math.pow(e, 3);
            return t > .008856 ? t : (e - 16 / 116) / 7.87;
        }, t = (this._l + 16) / 116, i = this._a / 500 + t, n = t - this._b / 200;
        return new ONECOLOR.XYZ(e(i) * 95.047, e(t) * 100, e(n) * 108.883, this._alpha);
    }
});

installColorSpace("HSV", [ "hue", "saturation", "value", "alpha" ], {
    rgb: function() {
        var e = this._hue, t = this._saturation, i = this._value, n = Math.min(5, Math.floor(e * 6)), r = e * 6 - n, a = i * (1 - t), o = i * (1 - r * t), s = i * (1 - (1 - r) * t), l, c, u;
        switch (n) {
          case 0:
            l = i;
            c = s;
            u = a;
            break;

          case 1:
            l = o;
            c = i;
            u = a;
            break;

          case 2:
            l = a;
            c = i;
            u = s;
            break;

          case 3:
            l = a;
            c = o;
            u = i;
            break;

          case 4:
            l = s;
            c = a;
            u = i;
            break;

          case 5:
            l = i;
            c = a;
            u = o;
            break;
        }
        return new ONECOLOR.RGB(l, c, u, this._alpha);
    },
    hsl: function() {
        var e = (2 - this._saturation) * this._value, t = this._saturation * this._value, i = e <= 1 ? e : 2 - e, n;
        if (i < 1e-9) {
            n = 0;
        } else {
            n = t / i;
        }
        return new ONECOLOR.HSL(this._hue, n, e / 2, this._alpha);
    },
    fromRgb: function() {
        var e = this._red, t = this._green, i = this._blue, n = Math.max(e, t, i), r = Math.min(e, t, i), a = n - r, o, s = n === 0 ? 0 : a / n, l = n;
        if (a === 0) {
            o = 0;
        } else {
            switch (n) {
              case e:
                o = (t - i) / a / 6 + (t < i ? 1 : 0);
                break;

              case t:
                o = (i - e) / a / 6 + 1 / 3;
                break;

              case i:
                o = (e - t) / a / 6 + 2 / 3;
                break;
            }
        }
        return new ONECOLOR.HSV(o, s, l, this._alpha);
    }
});

installColorSpace("HSL", [ "hue", "saturation", "lightness", "alpha" ], {
    hsv: function() {
        var e = this._lightness * 2, t = this._saturation * (e <= 1 ? e : 2 - e), i;
        if (e + t < 1e-9) {
            i = 0;
        } else {
            i = 2 * t / (e + t);
        }
        return new ONECOLOR.HSV(this._hue, i, (e + t) / 2, this._alpha);
    },
    rgb: function() {
        return this.hsv().rgb();
    },
    fromRgb: function() {
        return this.hsv().hsl();
    }
});

installColorSpace("CMYK", [ "cyan", "magenta", "yellow", "black", "alpha" ], {
    rgb: function() {
        return new ONECOLOR.RGB(1 - this._cyan * (1 - this._black) - this._black, 1 - this._magenta * (1 - this._black) - this._black, 1 - this._yellow * (1 - this._black) - this._black, this._alpha);
    },
    fromRgb: function() {
        var e = this._red, t = this._green, i = this._blue, n = 1 - e, r = 1 - t, a = 1 - i, o = 1;
        if (e || t || i) {
            o = Math.min(n, Math.min(r, a));
            n = (n - o) / (1 - o);
            r = (r - o) / (1 - o);
            a = (a - o) / (1 - o);
        } else {
            o = 1;
        }
        return new ONECOLOR.CMYK(n, r, a, o, this._alpha);
    }
});

ONECOLOR.installMethod("clearer", function(e) {
    return this.alpha(isNaN(e) ? -.1 : -e, true);
});

ONECOLOR.installMethod("darken", function(e) {
    return this.lightness(isNaN(e) ? -.1 : -e, true);
});

ONECOLOR.installMethod("desaturate", function(e) {
    return this.saturation(isNaN(e) ? -.1 : -e, true);
});

function gs() {
    var e = this.rgb(), t = e._red * .3 + e._green * .59 + e._blue * .11;
    return new ONECOLOR.RGB(t, t, t, this._alpha);
}

ONECOLOR.installMethod("greyscale", gs);

ONECOLOR.installMethod("grayscale", gs);

ONECOLOR.installMethod("lighten", function(e) {
    return this.lightness(isNaN(e) ? .1 : e, true);
});

ONECOLOR.installMethod("mix", function(e, t) {
    e = ONECOLOR(e).rgb();
    t = 1 - (isNaN(t) ? .5 : t);
    var i = t * 2 - 1, n = this._alpha - e._alpha, r = ((i * n === -1 ? i : (i + n) / (1 + i * n)) + 1) / 2, a = 1 - r, o = this.rgb();
    return new ONECOLOR.RGB(o._red * r + e._red * a, o._green * r + e._green * a, o._blue * r + e._blue * a, o._alpha * t + e._alpha * (1 - t));
});

ONECOLOR.installMethod("negate", function() {
    var e = this.rgb();
    return new ONECOLOR.RGB(1 - e._red, 1 - e._green, 1 - e._blue, this._alpha);
});

ONECOLOR.installMethod("opaquer", function(e) {
    return this.alpha(isNaN(e) ? .1 : e, true);
});

ONECOLOR.installMethod("rotate", function(e) {
    return this.hue((e || 0) / 360, true);
});

ONECOLOR.installMethod("saturate", function(e) {
    return this.saturation(isNaN(e) ? .1 : e, true);
});

ONECOLOR.installMethod("toAlpha", function(e) {
    var t = this.rgb(), i = ONECOLOR(e).rgb(), n = 1e-10, r = new ONECOLOR.RGB(0, 0, 0, t._alpha), a = [ "_red", "_green", "_blue" ];
    a.forEach(function(e) {
        if (t[e] < n) {
            r[e] = t[e];
        } else if (t[e] > i[e]) {
            r[e] = (t[e] - i[e]) / (1 - i[e]);
        } else if (t[e] > i[e]) {
            r[e] = (i[e] - t[e]) / i[e];
        } else {
            r[e] = 0;
        }
    });
    if (r._red > r._green) {
        if (r._red > r._blue) {
            t._alpha = r._red;
        } else {
            t._alpha = r._blue;
        }
    } else if (r._green > r._blue) {
        t._alpha = r._green;
    } else {
        t._alpha = r._blue;
    }
    if (t._alpha < n) {
        return t;
    }
    a.forEach(function(e) {
        t[e] = (t[e] - i[e]) / t._alpha + i[e];
    });
    t._alpha *= r._alpha;
    return t;
});

(function(e, t) {
    if (typeof exports === "object") {
        module.exports = t(require("onecolor"));
    } else if (typeof define === "function" && define.amd) {
        define("colorjoe", [ "onecolor" ], t);
    } else {
        e.colorjoe = t(e.one.color);
    }
})(this, function(e) {
    var t = function() {
        function e(e, t) {
            if (!e) {
                console.warn("drag is missing elem!");
                return;
            }
            if (o()) s(e, t, "touchstart", "touchmove", "touchend"); else s(e, t, "mousedown", "mousemove", "mouseup");
        }
        function t(t) {
            var i = r(t["class"] || "", t.parent);
            var a = r("pointer", i);
            r("shape shape1", a);
            r("shape shape2", a);
            r("bg bg1", i);
            r("bg bg2", i);
            e(i, n(t.cbs, a));
            return {
                background: i,
                pointer: a
            };
        }
        function i(t) {
            var i = r(t["class"], t.parent);
            var a = r("pointer", i);
            r("shape", a);
            r("bg", i);
            e(i, n(t.cbs, a));
            return {
                background: i,
                pointer: a
            };
        }
        e.xyslider = t;
        e.slider = i;
        return e;
        function n(e, t) {
            var i = {};
            for (var n in e) i[n] = r(e[n]);
            function r(e) {
                return function(i) {
                    i.pointer = t;
                    e(i);
                };
            }
            return i;
        }
        function r(e, t) {
            return a("div", e, t);
        }
        function a(e, t, i) {
            var n = document.createElement(e);
            if (t) n.className = t;
            i.appendChild(n);
            return n;
        }
        function o() {
            return typeof window.ontouchstart != "undefined";
        }
        function s(e, t, i, n, r) {
            var a = false;
            t = u(t);
            var o = t.begin;
            var s = t.change;
            var f = t.end;
            l(e, i, function(t) {
                a = true;
                var i = p(h, s, e);
                function u() {
                    a = false;
                    c(document, n, i);
                    c(document, r, u);
                    h(f, e, t);
                }
                l(document, n, i);
                l(document, r, u);
                h(o, e, t);
            });
        }
        function l(e, t, i) {
            if (e.addEventListener) e.addEventListener(t, i, false); else if (e.attachEvent) e.attachEvent("on" + t, i);
        }
        function c(e, t, i) {
            if (e.removeEventListener) e.removeEventListener(t, i, false); else if (e.detachEvent) e.detachEvent("on" + t, i);
        }
        function u(e) {
            if (!e) {
                var t;
                var i;
                return {
                    begin: function(e) {
                        t = {
                            x: e.elem.offsetLeft,
                            y: e.elem.offsetTop
                        };
                        i = e.cursor;
                    },
                    change: function(e) {
                        f(e.elem, "left", t.x + e.cursor.x - i.x + "px");
                        f(e.elem, "top", t.y + e.cursor.y - i.y + "px");
                    },
                    end: d
                };
            } else {
                return {
                    begin: e.begin || d,
                    change: e.change || d,
                    end: e.end || d
                };
            }
        }
        function f(e, t, i) {
            e.style[t] = i;
        }
        function d() {}
        function h(e, t, i) {
            i.preventDefault();
            var n = g(t);
            var r = t.clientWidth;
            var a = t.clientHeight;
            var o = {
                x: m(t, i),
                y: v(t, i)
            };
            var s = (o.x - n.x) / r;
            var l = (o.y - n.y) / a;
            e({
                x: isNaN(s) ? 0 : s,
                y: isNaN(l) ? 0 : l,
                cursor: o,
                elem: t,
                e: i
            });
        }
        function p(e) {
            var t = Array.prototype.slice;
            var i = t.apply(arguments, [ 1 ]);
            return function() {
                return e.apply(null, i.concat(t.apply(arguments)));
            };
        }
        function g(e) {
            var t = 0;
            var i = 0;
            if (e.offsetParent) {
                do {
                    t += e.offsetLeft;
                    i += e.offsetTop;
                } while (e = e.offsetParent);
            }
            return {
                x: t,
                y: i
            };
        }
        function m(e, t) {
            if (b(e)) {
                var i = parseInt(w(document.body, "marginLeft"), 10) - y(e, "scrollLeft") + window.pageXOffset + e.style.marginLeft;
                return t.clientX - i;
            }
            if (t.pageX) return t.pageX; else if (t.clientX) return t.clientX + document.body.scrollLeft;
        }
        function v(e, t) {
            if (b(e)) {
                var i = parseInt(w(document.body, "marginTop"), 10) - y(e, "scrollTop") + window.pageYOffset + e.style.marginTop;
                return t.clientY - i;
            }
            if (t.pageY) return t.pageY; else if (t.clientY) return t.clientY + document.body.scrollTop;
        }
        function y(e, t) {
            var i = 0;
            while (e.nodeName != "HTML") {
                i += e[t];
                e = e.parentNode;
            }
            return i;
        }
        function b(e) {
            while (e.nodeName != "HTML" && C(e, "position") != "fixed") e = e.parentNode;
            if (e.nodeName == "HTML") return false; else return true;
        }
        function w(e, t) {
            if (e.currentStyle) return e.currentStyle[t];
            if (document.defaultView && document.defaultView.getComputedStyle) return document.defaultView.getComputedStyle(e, "")[t];
            return e.style[t];
        }
        function C(e, t) {
            var i;
            if (window.getComputedStyle) i = window.getComputedStyle(e, null); else i = e.currentStyle;
            return i[t];
        }
    }();
    var i = r(n, "div");
    function n(e, t, i) {
        var n = document.createElement(e);
        n.className = t;
        i.appendChild(n);
        return n;
    }
    function r(e) {
        var t = Array.prototype.slice;
        var i = t.apply(arguments, [ 1 ]);
        return function() {
            return e.apply(null, i.concat(t.apply(arguments)));
        };
    }
    function a(e, t, n, r) {
        var a = i(e, n);
        var l = o(t, a);
        var c = s("text", a, r);
        return {
            label: l,
            input: c
        };
    }
    function o(e, t) {
        var i = n("label", "", t);
        i.innerHTML = e;
        return i;
    }
    function s(e, t, i) {
        var r = n("input", "", t);
        r.type = e;
        if (i) r.maxLength = i;
        return r;
    }
    function l(e, t) {
        e.style.left = f(t * 100, 0, 100) + "%";
    }
    function c(e, t) {
        e.style.top = f(t * 100, 0, 100) + "%";
    }
    function u(e, t) {
        e.style.background = t;
    }
    function f(e, t, i) {
        return Math.min(Math.max(e, t), i);
    }
    var d = {
        clamp: f,
        e: n,
        div: i,
        partial: r,
        labelInput: a,
        X: l,
        Y: c,
        BG: u
    };
    function h(e) {
        var t = d.div("currentColorContainer", e);
        var i = d.div("currentColor", t);
        return {
            change: function(e) {
                d.BG(i, e.cssa());
            }
        };
    }
    function p(e, t, i) {
        var n = i.space;
        var r = i.limit || 255;
        var a = i.fix >= 0 ? i.fix : 0;
        var o = ("" + r).length + a;
        o = a ? o + 1 : o;
        var s = n.split("");
        var l = n[n.length - 1] == "A";
        n = l ? n.slice(0, -1) : n;
        if ([ "RGB", "HSL", "HSV", "CMYK" ].indexOf(n) < 0) return console.warn("Invalid field names", n);
        var c = d.div("colorFields", e);
        var u = s.map(function(e, t) {
            e = e.toLowerCase();
            var i = d.labelInput("color " + e, e, c, o);
            i.input.onkeyup = f;
            return {
                name: e,
                e: i
            };
        });
        function f() {
            var e = [ n ];
            u.forEach(function(t) {
                e.push(t.e.input.value / r);
            });
            if (!l) e.push(t.getAlpha());
            t.set(e);
        }
        return {
            change: function(e) {
                u.forEach(function(t) {
                    t.e.input.value = (e[t.name]() * r).toFixed(a);
                });
            }
        };
    }
    function g(e, i) {
        var n = t.slider({
            parent: e,
            "class": "oned alpha",
            cbs: {
                begin: r,
                change: r
            }
        });
        function r(e) {
            var t = d.clamp(e.y, 0, 1);
            d.Y(e.pointer, t);
            i.setAlpha(1 - t);
        }
        return {
            change: function(e) {
                d.Y(n.pointer, 1 - e.alpha());
            }
        };
    }
    function m(e, t, i) {
        var n = d.labelInput("hex", i.label || "", e, 7);
        n.input.value = "#";
        n.input.onkeyup = function(e) {
            var i = e.keyCode || e.which;
            var n = e.target.value;
            n = n[0] == "#" ? n : "#" + n;
            n = y(n, 7, "0");
            if (i == 13) t.set(n);
        };
        n.input.onblur = function(e) {
            t.set(e.target.value);
        };
        return {
            change: function(e) {
                n.input.value = n.input.value[0] == "#" ? "#" : "";
                n.input.value += e.hex().slice(1);
            }
        };
    }
    function v(e, t, i) {
        var n = d.e("a", i["class"] || "close", e);
        n.href = "#";
        n.innerHTML = i.label || "Close";
        n.onclick = function(e) {
            e.preventDefault();
            t.hide();
        };
    }
    function y(e, t, i) {
        var n = e;
        for (var r = e.length, a = t; r < t; r++) n += i;
        return n;
    }
    var b = {
        currentColor: h,
        fields: p,
        hex: m,
        alpha: g,
        close: v
    };
    var w = function(e) {
        if (!T(D, [ e.init, e.xy, e.z ])) return console.warn("colorjoe: missing cb");
        return function(t, i, n) {
            return _({
                e: t,
                color: i,
                cbs: e,
                extras: n
            });
        };
    };
    w.rgb = w({
        init: function(t, i, n) {
            var r = e(t).hsv();
            this.xy(r, {
                x: r.saturation(),
                y: 1 - r.value()
            }, i, n);
            this.z(r, r.hue(), i, n);
            return r;
        },
        xy: function(e, t, i, n) {
            d.X(i.pointer, t.x);
            d.Y(i.pointer, t.y);
            return e.saturation(t.x).value(1 - t.y);
        },
        z: function(e, t, i, n) {
            d.Y(n.pointer, t);
            x(i.background, t);
            return e.hue(t);
        }
    });
    w.hsl = w({
        init: function(t, i, n) {
            var r = e(t).hsl();
            this.xy(r, {
                x: r.hue(),
                y: 1 - r.saturation()
            }, i, n);
            this.z(r, 1 - r.lightness(), i, n);
            return r;
        },
        xy: function(e, t, i, n) {
            d.X(i.pointer, t.x);
            d.Y(i.pointer, t.y);
            x(n.background, t.x);
            return e.hue(t.x).saturation(1 - t.y);
        },
        z: function(e, t, i, n) {
            d.Y(n.pointer, t);
            return e.lightness(1 - t);
        }
    });
    w._extras = {};
    w.registerExtra = function(e, t) {
        if (e in w._extras) console.warn('Extra "' + e + '"has been registered already!');
        w._extras[e] = t;
    };
    for (var C in b) {
        w.registerExtra(C, b[C]);
    }
    function x(t, i) {
        d.BG(t, new e.HSV(i, 1, 1).cssa());
    }
    function _(e) {
        if (!e.e) return console.warn("colorjoe: missing element");
        var i = I(e.e) ? document.getElementById(e.e) : e.e;
        i.className = "colorPicker";
        var n = e.cbs;
        var r = t.xyslider({
            parent: i,
            "class": "twod",
            cbs: {
                begin: a,
                change: a,
                end: h
            }
        });
        function a(e) {
            c = n.xy(c, {
                x: d.clamp(e.x, 0, 1),
                y: d.clamp(e.y, 0, 1)
            }, r, o);
            f();
        }
        var o = t.slider({
            parent: i,
            "class": "oned",
            cbs: {
                begin: s,
                change: s,
                end: h
            }
        });
        function s(e) {
            c = n.z(c, d.clamp(e.y, 0, 1), r, o);
            f();
        }
        var l = S(e.color);
        var c = n.init(l, r, o);
        var u = {
            change: [],
            done: [],
            close: []
        };
        function f(e) {
            e = P(e) ? e : [];
            var t = u.change;
            var i;
            for (var n = 0, r = t.length; n < r; n++) {
                i = t[n];
                if (e.indexOf(i.name) == -1) i.fn(c);
            }
        }
        function h() {
            if (l.equals(c)) return;
            for (var e = 0, t = u.done.length; e < t; e++) {
                u.done[e].fn(c);
            }
            l = c;
        }
        var p = {
            e: i,
            update: function(e) {
                f(e);
                return this;
            },
            hide: function() {
                i.style.display = "none";
                for (var e = 0, t = u.close.length; e < t; e++) {
                    u.close[e].fn();
                }
                return this;
            },
            show: function() {
                i.style.display = "";
                return this;
            },
            get: function() {
                return c;
            },
            set: function(e) {
                var t = this.get();
                c = n.init(S(e), r, o);
                if (!t.equals(c)) this.update();
                return this;
            },
            getAlpha: function() {
                return c.alpha();
            },
            setAlpha: function(e) {
                c = c.alpha(e);
                this.update();
                return this;
            },
            on: function(e, t, i) {
                if (e == "change" || e == "done" || e == "close") {
                    u[e].push({
                        name: i,
                        fn: t
                    });
                } else console.warn('Passed invalid evt name "' + e + '" to colorjoe.on');
                return this;
            },
            removeAllListeners: function(e) {
                if (e) {
                    delete u[e];
                } else {
                    for (var t in u) {
                        delete u[t];
                    }
                }
                return this;
            }
        };
        k(i, p, e.extras);
        f();
        return p;
    }
    function S(t) {
        if (!O(t)) return e("#000");
        if (t.isColor) return t;
        var i = e(t);
        if (i) return i;
        if (O(t)) console.warn("Passed invalid color to colorjoe, using black instead");
        return e("#000");
    }
    function k(e, t, i) {
        if (!i) return;
        var n = d.div("extras", e);
        var r;
        var a;
        var o;
        i.forEach(function(e, i) {
            if (P(e)) {
                a = e[0];
                o = e.length > 1 ? e[1] : {};
            } else {
                a = e;
                o = {};
            }
            extra = a in w._extras ? w._extras[a] : null;
            if (extra) {
                r = extra(n, A(t, a + i), o);
                for (var s in r) t.on(s, r[s], a);
            }
        });
    }
    function A(e, t) {
        var i = E(e);
        i.update = function() {
            e.update([ t ]);
        };
        return i;
    }
    function E(e) {
        var t = {};
        for (var i in e) {
            t[i] = e[i];
        }
        return t;
    }
    function T(e, t) {
        return t.map(e).filter(R).length == t.length;
    }
    function P(e) {
        return Object.prototype.toString.call(e) === "[object Array]";
    }
    function I(e) {
        return typeof e === "string";
    }
    function O(e) {
        return typeof e !== "undefined";
    }
    function D(e) {
        return typeof e === "function";
    }
    function R(e) {
        return e;
    }
    return w;
});

define("Widget/colorPickerBox", [ "uiObject", "signal", "colorjoe" ], function(e, t, i) {
    return e.extend({
        initialize: function(e) {
            var n = this;
            this.joe = i.rgb("picsEdit-colorDropper-box", "rgba(" + e.join(",") + ")", [ "close", "currentColor", [ "fields", {
                space: "RGB",
                limit: 255,
                fix: 0
            } ] ]);
            this.joe.on("change", function(e) {
                n.currentValue = [ e.r(), e.g(), e.b() ].map(function(e) {
                    return Math.round(e * 255);
                }).concat([ e.a() ]);
            });
            this.joe.on("close", function() {
                t.publish("colorPickerBoxClosed");
            });
            t.subscribe("colorPickerBoxClosed", function() {
                n.active = false;
            });
        },
        active: false,
        toggle: function() {
            if (this.active) {
                this.hide();
            } else {
                this.show();
            }
        },
        show: function() {
            this.active = true;
            document.querySelector("#picsEdit-colorDropper-box").style.display = "block";
        },
        hide: function() {
            this.active = false;
            document.querySelector("#picsEdit-colorDropper-box").style.display = "none";
        }
    });
});

define("Widget/confirmationDialog", [ "uiObject", "mustache" ], function(e, t) {
    var i = e.extend({
        initialize: function() {
            var e = this;
            this.template = t.to_html([ '<div class = "picsEdit-confirmation">', '<div class="confirmationBtn confirmationOk" id = "picsEdit-confirmationBtn-ok">Ok</div>', '<div class="confirmationBtn confirmationCancel" id = "picsEdit-confirmationBtn-cancel">Cancel</div>', "</div>" ].join(""), {});
            var i = this.elem = this.render();
            i.find(".confirmationOk").on("click", function(t) {
                e.config.onOk.call(e, t);
            });
            i.find(".confirmationCancel").on("click", function(t) {
                e.config.onCancel.call(e, t);
            });
        },
        show: function() {
            this.elem.show();
        },
        hide: function() {
            this.elem.hide();
        }
    });
    return i;
});

(function(e, t, i) {
    var n = "pep";
    var r = {
        initiate: function() {},
        start: function() {},
        drag: function() {},
        stop: function() {},
        rest: function() {},
        moveTo: false,
        callIfNotStarted: [ "stop", "rest" ],
        startThreshold: [ 0, 0 ],
        grid: [ 1, 1 ],
        debug: false,
        activeClass: "pep-active",
        multiplier: 1,
        velocityMultiplier: 2.5,
        shouldPreventDefault: true,
        allowDragEventPropagation: true,
        stopEvents: "",
        hardwareAccelerate: true,
        useCSSTranslation: true,
        disableSelect: true,
        cssEaseString: "cubic-bezier(0.190, 1.000, 0.220, 1.000)",
        cssEaseDuration: 1e3,
        shouldEase: true,
        droppable: false,
        droppableActiveClass: "pep-dpa",
        overlapFunction: false,
        constrainTo: false,
        removeMargins: false,
        place: true,
        deferPlacement: false,
        axis: null,
        forceNonCSS3Movement: false,
        elementsWithInteraction: "input",
        revert: false,
        revertAfter: "stop",
        revertIf: function() {
            return true;
        }
    };
    function a(t, i) {
        this.name = n;
        this.el = t;
        this.$el = e(t);
        this.options = e.extend({}, r, i);
        this.$document = e(this.$el[0].ownerDocument);
        this.$body = this.$document.find("body");
        this.moveTrigger = "MSPointerMove touchmove mousemove";
        this.startTrigger = "MSPointerDown touchstart mousedown";
        this.stopTrigger = "MSPointerUp touchend mouseup";
        this.startTriggerArray = this.startTrigger.split(" ");
        this.moveTriggerArray = this.moveTrigger.split(" ");
        this.stopTriggerArray = this.stopTrigger.split(" ");
        this.stopEvents = [ this.stopTrigger, this.options.stopEvents ].join(" ");
        if (this.options.constrainTo === "window") this.$container = this.$document; else if (this.options.constrainTo && this.options.constrainTo !== "parent") this.$container = e(this.options.constrainTo); else this.$container = this.$el.parent();
        if (this.isPointerEventCompatible()) this.applyMSDefaults();
        this.CSSEaseHash = this.getCSSEaseHash();
        this.scale = 1;
        this.started = false;
        this.disabled = false;
        this.resetVelocityQueue();
        this.init();
    }
    a.prototype.init = function() {
        if (this.options.debug) this.buildDebugDiv();
        if (this.options.disableSelect) this.disableSelect();
        if (this.options.place && !this.options.deferPlacement) {
            this.positionParent();
            this.placeObject();
        }
        this.ev = {};
        this.pos = {};
        this.subscribe();
    };
    a.prototype.subscribe = function() {
        var e = this;
        this.$el.on(this.startTrigger, function(t) {
            e.handleStart(t);
        });
        this.$el.on(this.startTrigger, this.options.elementsWithInteraction, function(e) {
            e.stopPropagation();
        });
        this.$document.on(this.stopEvents, function(t) {
            e.handleStop(t);
        });
        this.$document.on(this.moveTrigger, function(t) {
            e.moveEvent = t;
        });
    };
    a.prototype.handleStart = function(t) {
        var i = this;
        if (this.isValidMoveEvent(t) && !this.disabled) {
            if (this.isPointerEventCompatible() && t.preventManipulation) t.preventManipulation();
            t = this.normalizeEvent(t);
            if (this.options.place && this.options.deferPlacement) {
                this.positionParent();
                this.placeObject();
            }
            this.log({
                type: "event",
                event: t.type
            });
            if (this.options.hardwareAccelerate && !this.hardwareAccelerated) {
                this.hardwareAccelerate();
                this.hardwareAccelerated = true;
            }
            var n = this.options.initiate.call(this, t, this);
            if (n === false) return;
            clearTimeout(this.restTimeout);
            this.$el.addClass(this.options.activeClass);
            this.removeCSSEasing();
            this.startX = this.ev.x = t.pep.x;
            this.startY = this.ev.y = t.pep.y;
            this.initialPosition = this.initialPosition || this.$el.position();
            this.startEvent = this.moveEvent = t;
            this.active = true;
            if (this.options.shouldPreventDefault) t.preventDefault();
            if (!this.options.allowDragEventPropagation) t.stopPropagation();
            (function r() {
                if (!i.active) return;
                i.handleMove();
                i.requestAnimationFrame(r);
            })(e, i);
        }
    };
    a.prototype.handleMove = function() {
        if (typeof this.moveEvent === "undefined") return;
        var i = this.normalizeEvent(this.moveEvent);
        var n = t.parseInt(i.pep.x / this.options.grid[0]) * this.options.grid[0];
        var r = t.parseInt(i.pep.y / this.options.grid[1]) * this.options.grid[1];
        this.addToLIFO({
            time: i.timeStamp,
            x: n,
            y: r
        });
        var a, o;
        if (e.inArray(i.type, this.startTriggerArray) > -1) {
            a = 0;
            o = 0;
        } else {
            a = n - this.ev.x;
            o = r - this.ev.y;
        }
        this.dx = a;
        this.dy = o;
        this.ev.x = n;
        this.ev.y = r;
        if (a === 0 && o === 0) {
            this.log({
                type: "event",
                event: "** stopped **"
            });
            return;
        }
        var s = Math.abs(this.startX - n);
        var l = Math.abs(this.startY - r);
        if (!this.started && (s > this.options.startThreshold[0] || l > this.options.startThreshold[1])) {
            this.started = true;
            this.$el.addClass("pep-start");
            this.options.start.call(this, this.startEvent, this);
        }
        if (this.options.droppable) {
            this.calculateActiveDropRegions();
        }
        var c = this.options.drag.call(this, i, this);
        if (c === false) {
            this.resetVelocityQueue();
            return;
        }
        this.log({
            type: "event",
            event: i.type
        });
        this.log({
            type: "event-coords",
            x: this.ev.x,
            y: this.ev.y
        });
        this.log({
            type: "velocity"
        });
        var u = this.handleConstraint(a, o);
        var f, d;
        if (typeof this.options.moveTo === "function") {
            f = a >= 0 ? "+=" + Math.abs(a / this.scale) * this.options.multiplier : "-=" + Math.abs(a / this.scale) * this.options.multiplier;
            d = o >= 0 ? "+=" + Math.abs(o / this.scale) * this.options.multiplier : "-=" + Math.abs(o / this.scale) * this.options.multiplier;
            if (this.options.constrainTo) {
                f = u.x !== false ? u.x : f;
                d = u.y !== false ? u.y : d;
            }
            if (this.options.axis === "x") d = u.y;
            if (this.options.axis === "y") f = u.x;
            this.options.moveTo.call(this, f, d);
        } else if (!this.shouldUseCSSTranslation()) {
            f = a >= 0 ? "+=" + Math.abs(a / this.scale) * this.options.multiplier : "-=" + Math.abs(a / this.scale) * this.options.multiplier;
            d = o >= 0 ? "+=" + Math.abs(o / this.scale) * this.options.multiplier : "-=" + Math.abs(o / this.scale) * this.options.multiplier;
            if (this.options.constrainTo) {
                f = u.x !== false ? u.x : f;
                d = u.y !== false ? u.y : d;
            }
            if (this.options.axis === "x") d = u.y;
            if (this.options.axis === "y") f = u.x;
            this.moveTo(f, d);
        } else {
            a = a / this.scale * this.options.multiplier;
            o = o / this.scale * this.options.multiplier;
            if (this.options.constrainTo) {
                a = u.x === false ? a : 0;
                o = u.y === false ? o : 0;
            }
            if (this.options.axis === "x") o = 0;
            if (this.options.axis === "y") a = 0;
            this.moveToUsingTransforms(a, o);
        }
    };
    a.prototype.handleStop = function(t) {
        if (!this.active) return;
        this.log({
            type: "event",
            event: t.type
        });
        this.active = false;
        this.$el.removeClass("pep-start").addClass("pep-ease");
        if (this.options.droppable) {
            this.calculateActiveDropRegions();
        }
        if (this.started || !this.started && e.inArray("stop", this.options.callIfNotStarted) > -1) {
            this.options.stop.call(this, t, this);
        }
        if (this.options.shouldEase) {
            this.ease(t, this.started);
        } else {
            this.removeActiveClass();
        }
        if (this.options.revert && (this.options.revertAfter === "stop" || !this.options.shouldEase) && (this.options.revertIf && this.options.revertIf())) {
            this.revert();
        }
        this.started = false;
        this.resetVelocityQueue();
    };
    a.prototype.ease = function(t, i) {
        var n = this.$el.position();
        var r = this.velocity();
        var a = this.dt;
        var o = r.x / this.scale * this.options.multiplier;
        var s = r.y / this.scale * this.options.multiplier;
        var l = this.handleConstraint(o, s, true);
        if (this.cssAnimationsSupported()) this.$el.css(this.getCSSEaseHash());
        var c = r.x > 0 ? "+=" + o : "-=" + Math.abs(o);
        var u = r.y > 0 ? "+=" + s : "-=" + Math.abs(s);
        if (this.options.constrainTo) {
            c = l.x !== false ? l.x : c;
            u = l.y !== false ? l.y : u;
        }
        if (this.options.axis === "x") u = "+=0";
        if (this.options.axis === "y") c = "+=0";
        var f = !this.cssAnimationsSupported() || this.options.forceNonCSS3Movement;
        if (typeof this.options.moveTo === "function") {
            this.options.moveTo.call(this, c, u);
        } else {
            this.moveTo(c, u, f);
        }
        var d = this;
        this.restTimeout = setTimeout(function() {
            if (d.options.droppable) {
                d.calculateActiveDropRegions();
            }
            if (i || !i && e.inArray("rest", d.options.callIfNotStarted) > -1) {
                d.options.rest.call(d, t, d);
            }
            if (d.options.revert && (d.options.revertAfter === "ease" && d.options.shouldEase) && (d.options.revertIf && d.options.revertIf())) {
                d.revert();
            }
            d.removeActiveClass();
        }, this.options.cssEaseDuration);
    };
    a.prototype.normalizeEvent = function(e) {
        e.pep = {};
        if (this.isPointerEventCompatible() || !this.isTouch(e)) {
            if (e.pageX) {
                e.pep.x = e.pageX;
                e.pep.y = e.pageY;
            } else {
                e.pep.x = e.originalEvent.pageX;
                e.pep.y = e.originalEvent.pageY;
            }
            e.pep.type = e.type;
        } else {
            e.pep.x = e.originalEvent.touches[0].pageX;
            e.pep.y = e.originalEvent.touches[0].pageY;
            e.pep.type = e.type;
        }
        return e;
    };
    a.prototype.resetVelocityQueue = function() {
        this.velocityQueue = new Array(5);
    };
    a.prototype.moveTo = function(e, t, i) {
        this.log({
            type: "delta",
            x: e,
            y: t
        });
        if (i) {
            this.$el.animate({
                top: t,
                left: e
            }, this.options.cssEaseDuration / 2, "easeOutQuad", {
                queue: false
            });
        } else {
            this.$el.stop(true, false).css({
                top: t,
                left: e
            });
        }
    };
    a.prototype.moveToUsingTransforms = function(e, t) {
        var i = this.matrixToArray(this.matrixString());
        if (!this.cssX) this.cssX = this.xTranslation(i);
        if (!this.cssY) this.cssY = this.yTranslation(i);
        this.cssX = this.cssX + e;
        this.cssY = this.cssY + t;
        this.log({
            type: "delta",
            x: e,
            y: t
        });
        i[4] = this.cssX;
        i[5] = this.cssY;
        this.translation = this.arrayToMatrix(i);
        this.transform(this.translation);
    };
    a.prototype.transform = function(e) {
        this.$el.css({
            "-webkit-transform": e,
            "-moz-transform": e,
            "-ms-transform": e,
            "-o-transform": e,
            transform: e
        });
    };
    a.prototype.xTranslation = function(e) {
        e = e || this.matrixToArray(this.matrixString());
        return parseInt(e[4], 10);
    };
    a.prototype.yTranslation = function(e) {
        e = e || this.matrixToArray(this.matrixString());
        return parseInt(e[5], 10);
    };
    a.prototype.matrixString = function() {
        var e = function(e) {
            return !(!e || e === "none" || e.indexOf("matrix") < 0);
        };
        var t = "matrix(1, 0, 0, 1, 0, 0)";
        if (e(this.$el.css("-webkit-transform"))) t = this.$el.css("-webkit-transform");
        if (e(this.$el.css("-moz-transform"))) t = this.$el.css("-moz-transform");
        if (e(this.$el.css("-ms-transform"))) t = this.$el.css("-ms-transform");
        if (e(this.$el.css("-o-transform"))) t = this.$el.css("-o-transform");
        if (e(this.$el.css("transform"))) t = this.$el.css("transform");
        return t;
    };
    a.prototype.matrixToArray = function(e) {
        return e.split("(")[1].split(")")[0].split(",");
    };
    a.prototype.arrayToMatrix = function(e) {
        return "matrix(" + e.join(",") + ")";
    };
    a.prototype.addToLIFO = function(e) {
        var t = this.velocityQueue;
        t = t.slice(1, t.length);
        t.push(e);
        this.velocityQueue = t;
    };
    a.prototype.velocity = function() {
        var e = 0;
        var t = 0;
        for (var i = 0; i < this.velocityQueue.length - 1; i++) {
            if (this.velocityQueue[i]) {
                e += this.velocityQueue[i + 1].x - this.velocityQueue[i].x;
                t += this.velocityQueue[i + 1].y - this.velocityQueue[i].y;
                this.dt = this.velocityQueue[i + 1].time - this.velocityQueue[i].time;
            }
        }
        return {
            x: e * this.options.velocityMultiplier,
            y: t * this.options.velocityMultiplier
        };
    };
    a.prototype.revert = function() {
        if (this.shouldUseCSSTranslation()) {
            this.moveToUsingTransforms(-this.xTranslation(), -this.yTranslation());
        }
        this.moveTo(this.initialPosition.left, this.initialPosition.top);
    };
    a.prototype.requestAnimationFrame = function(e) {
        return t.requestAnimationFrame && t.requestAnimationFrame(e) || t.webkitRequestAnimationFrame && t.webkitRequestAnimationFrame(e) || t.mozRequestAnimationFrame && t.mozRequestAnimationFrame(e) || t.oRequestAnimationFrame && t.mozRequestAnimationFrame(e) || t.msRequestAnimationFrame && t.msRequestAnimationFrame(e) || t.setTimeout(e, 1e3 / 60);
    };
    a.prototype.positionParent = function() {
        if (!this.options.constrainTo || this.parentPositioned) return;
        this.parentPositioned = true;
        if (this.options.constrainTo === "parent") {
            this.$container.css({
                position: "relative"
            });
        } else if (this.options.constrainTo === "window" && this.$container.get(0).nodeName !== "#document" && this.$container.css("position") !== "static") {
            this.$container.css({
                position: "static"
            });
        }
    };
    a.prototype.placeObject = function() {
        if (this.objectPlaced) return;
        this.objectPlaced = true;
        this.offset = this.options.constrainTo === "parent" || this.hasNonBodyRelative() ? this.$el.position() : this.$el.offset();
        if (parseInt(this.$el.css("left"), 10)) this.offset.left = this.$el.css("left");
        if (parseInt(this.$el.css("top"), 10)) this.offset.top = this.$el.css("top");
        if (this.options.removeMargins) this.$el.css({
            margin: 0
        });
        this.$el.css({
            position: "absolute",
            top: this.offset.top,
            left: this.offset.left
        });
    };
    a.prototype.hasNonBodyRelative = function() {
        return this.$el.parents().filter(function() {
            var t = e(this);
            return t.is("body") || t.css("position") === "relative";
        }).length > 1;
    };
    a.prototype.setScale = function(e) {
        this.scale = e;
    };
    a.prototype.setMultiplier = function(e) {
        this.options.multiplier = e;
    };
    a.prototype.removeCSSEasing = function() {
        if (this.cssAnimationsSupported()) this.$el.css(this.getCSSEaseHash(true));
    };
    a.prototype.disableSelect = function() {
        this.$el.css({
            "-webkit-touch-callout": "none",
            "-webkit-user-select": "none",
            "-khtml-user-select": "none",
            "-moz-user-select": "none",
            "-ms-user-select": "none",
            "user-select": "none"
        });
    };
    a.prototype.removeActiveClass = function() {
        this.$el.removeClass([ this.options.activeClass, "pep-ease" ].join(" "));
    };
    a.prototype.handleConstraint = function(t, n, r) {
        var a = this.$el.position();
        this.pos.x = a.left;
        this.pos.y = a.top;
        var o = {
            x: false,
            y: false
        };
        var s, l, c, u;
        this.log({
            type: "pos-coords",
            x: this.pos.x,
            y: this.pos.y
        });
        if (e.isArray(this.options.constrainTo)) {
            if (this.options.constrainTo[3] !== i && this.options.constrainTo[1] !== i) {
                l = this.options.constrainTo[1] === false ? Infinity : this.options.constrainTo[1];
                c = this.options.constrainTo[3] === false ? -Infinity : this.options.constrainTo[3];
            }
            if (this.options.constrainTo[0] !== false && this.options.constrainTo[2] !== false) {
                s = this.options.constrainTo[2] === false ? Infinity : this.options.constrainTo[2];
                u = this.options.constrainTo[0] === false ? -Infinity : this.options.constrainTo[0];
            }
            if (this.pos.x + t < c) o.x = c;
            if (this.pos.y + n < u) o.y = u;
        } else if (typeof this.options.constrainTo === "string") {
            c = 0;
            u = 0;
            l = this.$container.width() - this.$el.outerWidth();
            s = this.$container.height() - this.$el.outerHeight();
            if (this.pos.x + t < 0) o.x = 0;
            if (this.pos.y + n < 0) o.y = 0;
        }
        if (this.pos.x + t > l) o.x = l;
        if (this.pos.y + n > s) o.y = s;
        if (this.shouldUseCSSTranslation() && r) {
            if (o.x === c && this.xTranslation()) o.x = c - this.xTranslation();
            if (o.x === l && this.xTranslation()) o.x = l - this.xTranslation();
            if (o.y === u && this.yTranslation()) o.y = u - this.yTranslation();
            if (o.y === s && this.yTranslation()) o.y = s - this.yTranslation();
        }
        return o;
    };
    a.prototype.getCSSEaseHash = function(e) {
        if (typeof e === "undefined") e = false;
        var t;
        if (e) {
            t = "";
        } else if (this.CSSEaseHash) {
            return this.CSSEaseHash;
        } else {
            t = [ "all", this.options.cssEaseDuration + "ms", this.options.cssEaseString ].join(" ");
        }
        return {
            "-webkit-transition": t,
            "-moz-transition": t,
            "-ms-transition": t,
            "-o-transition": t,
            transition: t
        };
    };
    a.prototype.calculateActiveDropRegions = function() {
        var t = this;
        this.activeDropRegions = [];
        e.each(e(this.options.droppable), function(i, n) {
            var r = e(n);
            if (t.isOverlapping(r, t.$el)) {
                r.addClass(t.options.droppableActiveClass);
                t.activeDropRegions.push(r);
            } else {
                r.removeClass(t.options.droppableActiveClass);
            }
        });
    };
    a.prototype.isOverlapping = function(e, t) {
        if (this.options.overlapFunction) {
            return this.options.overlapFunction(e, t);
        }
        var i = e[0].getBoundingClientRect();
        var n = t[0].getBoundingClientRect();
        return !(i.right < n.left || i.left > n.right || i.bottom < n.top || i.top > n.bottom);
    };
    a.prototype.isTouch = function(e) {
        return e.type.search("touch") > -1;
    };
    a.prototype.isPointerEventCompatible = function() {
        return "MSPointerEvent" in t;
    };
    a.prototype.applyMSDefaults = function(e) {
        this.$el.css({
            "-ms-touch-action": "none",
            "touch-action": "none",
            "-ms-scroll-chaining": "none",
            "-ms-scroll-limit": "0 0 0 0"
        });
    };
    a.prototype.isValidMoveEvent = function(e) {
        return !this.isTouch(e) || this.isTouch(e) && e.originalEvent.touches && e.originalEvent.touches.length === 1;
    };
    a.prototype.shouldUseCSSTranslation = function() {
        if (typeof this.useCSSTranslation !== "undefined") return this.useCSSTranslation;
        var e = false;
        if (!this.options.useCSSTranslation || typeof Modernizr !== "undefined" && !Modernizr.csstransforms) {
            e = false;
        } else {
            e = true;
        }
        this.useCSSTranslation = e;
        return e;
    };
    a.prototype.cssAnimationsSupported = function() {
        if (typeof this.cssAnimationsSupport !== "undefined") {
            return this.cssAnimationsSupport;
        }
        if (typeof Modernizr !== "undefined" && Modernizr.cssanimations) {
            this.cssAnimationsSupport = true;
            return true;
        }
        var e = false, t = document.createElement("div"), n = "animation", r = "", a = "Webkit Moz O ms Khtml".split(" "), o = "";
        if (t.style.animationName) {
            e = true;
        }
        if (e === false) {
            for (var s = 0; s < a.length; s++) {
                if (t.style[a[s] + "AnimationName"] !== i) {
                    o = a[s];
                    n = o + "Animation";
                    r = "-" + o.toLowerCase() + "-";
                    e = true;
                    break;
                }
            }
        }
        this.cssAnimationsSupport = e;
        return e;
    };
    a.prototype.hardwareAccelerate = function() {
        this.$el.css({
            "-webkit-perspective": 1e3,
            perspective: 1e3,
            "-webkit-backface-visibility": "hidden",
            "backface-visibility": "hidden"
        });
    };
    a.prototype.getMovementValues = function() {
        return {
            ev: this.ev,
            pos: this.pos,
            velocity: this.velocity()
        };
    };
    a.prototype.buildDebugDiv = function() {
        var t;
        if (e("#pep-debug").length === 0) {
            t = e("<div></div>");
            t.attr("id", "pep-debug").append("<div style='font-weight:bold; background: red; color: white;'>DEBUG MODE</div>").append("<div id='pep-debug-event'>no event</div>").append("<div id='pep-debug-ev-coords'>event coords: <span class='pep-x'>-</span>, <span class='pep-y'>-</span></div>").append("<div id='pep-debug-pos-coords'>position coords: <span class='pep-x'>-</span>, <span class='pep-y'>-</span></div>").append("<div id='pep-debug-velocity'>velocity: <span class='pep-x'>-</span>, <span class='pep-y'>-</span></div>").append("<div id='pep-debug-delta'>&Delta; movement: <span class='pep-x'>-</span>, <span class='pep-y'>-</span></div>").css({
                position: "fixed",
                bottom: 5,
                right: 5,
                zIndex: 99999,
                textAlign: "right",
                fontFamily: "Arial, sans",
                fontSize: 10,
                border: "1px solid #DDD",
                padding: "3px",
                background: "white",
                color: "#333"
            });
        }
        var i = this;
        setTimeout(function() {
            i.debugElements = {
                $event: e("#pep-debug-event"),
                $velocityX: e("#pep-debug-velocity .pep-x"),
                $velocityY: e("#pep-debug-velocity .pep-y"),
                $dX: e("#pep-debug-delta .pep-x"),
                $dY: e("#pep-debug-delta .pep-y"),
                $evCoordsX: e("#pep-debug-ev-coords .pep-x"),
                $evCoordsY: e("#pep-debug-ev-coords .pep-y"),
                $posCoordsX: e("#pep-debug-pos-coords .pep-x"),
                $posCoordsY: e("#pep-debug-pos-coords .pep-y")
            };
        }, 0);
        e("body").append(t);
    };
    a.prototype.log = function(e) {
        if (!this.options.debug) return;
        switch (e.type) {
          case "event":
            this.debugElements.$event.text(e.event);
            break;

          case "pos-coords":
            this.debugElements.$posCoordsX.text(e.x);
            this.debugElements.$posCoordsY.text(e.y);
            break;

          case "event-coords":
            this.debugElements.$evCoordsX.text(e.x);
            this.debugElements.$evCoordsY.text(e.y);
            break;

          case "delta":
            this.debugElements.$dX.text(e.x);
            this.debugElements.$dY.text(e.y);
            break;

          case "velocity":
            var t = this.velocity();
            this.debugElements.$velocityX.text(Math.round(t.x));
            this.debugElements.$velocityY.text(Math.round(t.y));
            break;
        }
    };
    a.prototype.toggle = function(e) {
        if (typeof e === "undefined") {
            this.disabled = !this.disabled;
        } else {
            this.disabled = !e;
        }
    };
    e.extend(e.easing, {
        easeOutQuad: function(e, t, i, n, r) {
            return -n * (t /= r) * (t - 2) + i;
        },
        easeOutCirc: function(e, t, i, n, r) {
            return n * Math.sqrt(1 - (t = t / r - 1) * t) + i;
        },
        easeOutExpo: function(e, t, i, n, r) {
            return t === r ? i + n : n * (-Math.pow(2, -10 * t / r) + 1) + i;
        }
    });
    e.fn[n] = function(t) {
        return this.each(function() {
            if (!e.data(this, "plugin_" + n)) {
                var i = new a(this, t);
                e.data(this, "plugin_" + n, i);
                e.pep.peps.push(i);
            }
        });
    };
    e.pep = {};
    e.pep.peps = [];
    e.pep.toggleAll = function(t) {
        e.each(this.peps, function(e, i) {
            i.toggle(t);
        });
    };
    e.pep.unbind = function(e) {
        var t = e.data("plugin_" + n);
        if (typeof t === "undefined") return;
        t.toggle(false);
        e.removeData("plugin_" + n);
    };
})(jQuery, window);

define("pep", function() {});

define("Widget/dialog", [ "utils", "uiObject", "pep", "mustache" ], function(e, t, i, n) {
    var r = t.extend({
        template: [ '<div class="layerUnderPicsioEditorPopup"></div>', '<div class="picsioEditorPopup {{classList}}" style="{{styleList}}">', '<div class="headerPicsioEditorPopup">', '{{#show_close_button}}<span class="closePicsioEditorPopup icon_lightX"></span>{{/show_close_button}}', '<span class="titlePicsioEditorPopup">{{plugin_title}}</span>', "</div>", '<div class="contentPicsioEditorPopup">', '{{#icon}}<div class="iconPicsioEditorPopup icon_{{icon.name}}"></div>{{/icon}}', '<div class="innerContentPicsioEditorPopup">', "</div>", "</div>", '<div class="footerPicsioEditorPopup">', "{{#btns}}", '<span class="btnPicsioEditorPopup customBtnPicsioEditorPopup" data-name="{{name}}">{{text}}</span>', "{{/btns}}", "{{^btns}}", '<span class="btnPicsioEditorPopup cancelPicsioEditorPopup" style="{{disableCancel}}">{{cancelName}}</span>', '<span class="btnPicsioEditorPopup okPicsioEditorPopup" style="{{disableOk}}">{{okName}}</span>', "{{/btns}}", "</div>", "</div>" ].join(""),
        _window: null,
        initialize: function(e, t) {
            var i = this;
            this.config.container = this.config.container || $("body");
            this.config.autoclose = this.config.autoclose === false ? false : true;
            var r = this.config.classList ? this.config.classList.join(" ") : "";
            var a = "", r = this.config.classList ? this.config.classList.join(" ") : "", o = this.config.disableOk ? "display: none;" : "", s = this.config.disableCancel ? "display: none;" : "";
            if (typeof this.config.styleList !== "undefined") {
                for (var l in this.config.styleList) {
                    a += l + ": " + this.config.styleList[l] + "; ";
                }
            }
            this.template = n.to_html(this.template, {
                plugin_title: this.config.title,
                show_close_button: this.config.showCloseButton !== false,
                styleList: a,
                classList: r,
                disableOk: o,
                disableCancel: s,
                cancelName: this.config.cancelName || "Cancel",
                okName: this.config.okName || "Ok",
                icon: this.config.icon || false,
                btns: this.config.btns || false
            });
            var c = this.elem = this.render();
            this.config.onOk && (this.config.onOk = this.config.onOk.bind(this));
            this.destroy = this.destroy.bind(this);
            if (!t) {
                c.on("click", ".okPicsioEditorPopup", function() {
                    if (i._validate()) {
                        return i.config.onOk.call(i);
                    } else {
                        return false;
                    }
                });
                c.on("click", ".cancelPicsioEditorPopup", this.config.onCancel || function() {});
                c.on("click", ".closePicsioEditorPopup", this.config.onCancel || function() {});
                c.on("click", ".okPicsioEditorPopup", this.destroy);
                c.on("click", ".cancelPicsioEditorPopup", this.destroy.bind(this, "cancel"));
                c.on("click", ".closePicsioEditorPopup", this.destroy.bind(this, "close"));
            }
            if (this.config.text) {
                var u = this.config.text;
                var f = c.find(".innerContentPicsioEditorPopup");
                f.html("<div class = 'picsio-text'>" + u + "</div>");
            }
            if (this.config.btns) {
                c.on("click", ".customBtnPicsioEditorPopup", this.onClickCustomBtn.bind(this));
            }
            this.addItems(this.config.items);
            this.addDrag(c);
            this.config.onRender && this.config.onRender();
            this.config.blur && this.setBlur(this.config.blur);
        },
        _initCss: function(e) {
            for (var t = 0; t < e.length; t++) {
                console.log(this.config.container.append(e[t]));
            }
        },
        destroy: function(e) {
            var t = this;
            this.$el[1].classList.add("hiddingPopup");
            setTimeout(function() {
                if (!t._validate() && (e !== "cancel" && e !== "close")) {
                    console.log("Dialog is not valid");
                    return;
                }
                if (!t.config.autoclose && typeof e !== "string") {
                    return;
                }
                t.config.onExit = t.config.onExit || function() {};
                t.config.onClose = t.config.onClose || function() {};
                t.elem.off("click", ".okPicsioEditorPopup", t.config.onOk);
                t.elem.off("click", ".cancelPicsioEditorPopup", t.config.onCancel);
                t.elem.off("click", ".closePicsioEditorPopup", t.config.onCancel);
                t.elem.off("click", ".okPicsioEditorPopup", t.destroy);
                t.elem.off("click", ".cancelPicsioEditorPopup", t.destroy);
                t.elem.off("click", ".closePicsioEditorPopup", t.destroy);
                t.elem.off("click", ".cancelPicsioEditorPopup", t.convertToWindow);
                t.elem.off("click", ".closePicsioEditorPopup", t.convertToWindow);
                t.config.onExit();
                t.config.onClose();
                t.elem.remove();
                t._validators && (t._validators.length = 0);
                t._window && t._window.close();
                t.elem = null;
                t.config.blur && t.unsetBlur(t.config.blur);
            }, 150);
        },
        addValidator: function(e) {
            if (!this._validators) {
                this._validators = [];
            }
            this._validators.push(e);
        },
        _validate: function() {
            var e = this, t = true;
            this._validators && this._validators.each(function(i) {
                var n = i.bind(e);
                if (!n()) {
                    t = false;
                    return false;
                }
            });
            return t;
        },
        addItem: function(t, i) {
            if (!this.items) {
                this.items = {};
            }
            e.mixin(i, {
                container: this.elem.find(".innerContentPicsioEditorPopup")
            });
            var n = new t(i);
            this.items[i.id] = n;
            if (i.name) {
                !this.nameItems && (this.nameItems = {});
                this.nameItems[i.name] = n;
            }
            return t;
        },
        addItems: function(e) {
            if (!e) return;
            for (var t = 0; t < e.length; t++) {
                this.addItem(e[t].item, e[t].config);
            }
        },
        getContainer: function() {
            return this.config.container.find(".innerContentPicsioEditorPopup")[0];
        },
        getItem: function(e) {
            return this.items[e];
        },
        getItemByName: function(e) {
            return this.nameItems[e];
        },
        convertToWindow: function() {
            var e = this;
            this.destroy();
            var t = this._window = window.open("", "Title", "directories=no,titlebar=no,toolbar=no,location=yes,status=no,menubar=no,scrollbars=no,resizable=no,width=600,height=400");
            t.document.title = this.config.title;
            var i = setInterval(function() {
                if (!e._window.window) {
                    clearInterval(i);
                    e.config.onCancel && e.config.onCancel();
                }
            }, 200);
            this.config._modalContainer = this.config.container;
            this.config.container = $(t.document.body);
            this.config.container.append("<script>function onBodyUnload(){}</script>");
            this.initializeWindow();
        },
        reInitItems: function() {
            var e = this.items;
            for (var t in e) {
                e[t].config.defaultValue = e[t].config.curValue;
                e[t].config.container = this.elem.find(".innerContentPicsioEditorPopup");
                e[t].initialize();
            }
        },
        convertToModal: function() {
            this.config.container = this.config._modalContainer;
            this.initializeModal();
        },
        initializeModal: function() {
            this.destroy();
            var e = this.elem = this.render();
            this.reInitItems();
            e.on("click", ".picsEdit-dialog-ok", this.config.onOk.bind(this));
            e.on("click", ".picsEdit-dialog-cancel", this.config.onCancel);
            e.on("click", ".picsEdit-dialog-ok", this.destroy.bind(this));
            e.on("click", ".picsEdit-dialog-cancel", this.destroy.bind(this));
            e.on("click", ".picsEdit-toWindow", this.convertToWindow.bind(this));
        },
        initializeWindow: function() {
            var e = this.elem = this.render();
            var t = this;
            this.reInitItems();
            e.on("click", ".picsEdit-dialog-ok", function() {
                if (t._validate()) {
                    return t.config.onOk.bind(this);
                } else {
                    return false;
                }
            });
            e.on("click", ".picsEdit-dialog-cancel", this.config.onCancel);
            e.on("click", ".picsEdit-dialog-ok", this.destroy.bind(this));
            e.on("click", ".picsEdit-dialog-cancel", this.destroy.bind(this));
        },
        addDrag: function(e) {
            e.pep({
                initiate: function(e) {
                    if (e.target.className !== "titlePicsioEditorPopup") {
                        return false;
                    }
                },
                constrainTo: "parent",
                useCSSTranslation: false
            });
        },
        addToTitle: function(e) {
            var t = this.elem.find(".titlePicsioEditorPopup"), i = t.text(), n = i + e;
            t.text(n);
        },
        setBlur: function(e) {
            var t = document.querySelector(e);
            t && t.classList.add("blur");
        },
        unsetBlur: function(e) {
            var t = document.querySelector(e);
            t && t.classList.remove("blur");
        },
        onClickCustomBtn: function(e) {
            var t = e.currentTarget.dataset.name;
            var i = this.config.btns.find(function(e) {
                return e["name"] === t;
            });
            i.handler.call(this);
        },
        changeBtnText: function(e) {
            var t = this.$el[1].querySelector(".btnPicsioEditorPopup[data-name=" + e.name + "]");
            t && (t.textContent = e.text);
        },
        hideBtn: function(e) {
            var t = this.$el[1].querySelector(".btnPicsioEditorPopup[data-name=" + e.name + "]");
            t && t.classList.add("hide");
        },
        showBtn: function(e) {
            var t = this.$el[1].querySelector(".btnPicsioEditorPopup[data-name=" + e.name + "]");
            t && t.classList.remove("hide");
        },
        addEvent: function(e) {
            this.getItem(e.itemId).config[e.event] = e.handler;
        }
    });
    return r;
});

define("Widget/dialogButton", [ "uiObject", "mustache" ], function(e, t) {
    var i = e.extend({
        disable: false,
        initialize: function() {
            var e = this, i = "";
            if (typeof this.config.styleList !== "undefined") {
                for (var n in this.config.styleList) {
                    i += n + ": " + this.config.styleList[n] + "; ";
                }
            }
            this.template = t.to_html([ '<div class="dialogButton{{#classList}} {{.}}{{/classList}}" style="{{styleList}}">', "{{title}}", "</div>" ].join(""), {
                title: this.config.title,
                classList: this.config.classList,
                styleList: i
            });
            var r = this.$el = this.render();
            r.on("click", function() {
                !e.disable && e.config.click && e.config.click();
            });
        },
        setDisable: function(e) {
            if (e) {
                this.$el.addClass("disable");
                this.disable = true;
            } else {
                this.$el.removeClass("disable");
                this.disable = false;
            }
        },
        setTitle: function(e) {
            return this.setValue(e);
        },
        setValue: function(e) {
            this.$el.text(e || "");
        }
    });
    return i;
});

define("Widget/gradientFilter", [ "uiObject", "signal" ], function(e, t) {
    return e.extend({
        initialize: function() {
            var e = this;
            e.config.container = document.querySelector(".picsEdit-GradientFilter");
            e.position.top = e.config.top = e.config.top || 100;
            e.position.height = e.config.height = e.config.height || 200;
            e.config.container.classList.add("gradientIsOpen");
            var i = e.config.container;
            e.render();
            e.config.container.querySelector(".topGradientLine").style.top = e.config.top + "px";
            e.config.container.querySelector(".bottomGradientLine").style.top = e.config.top + e.config.height + "px";
            var n = e.config.container.querySelector(".centerGradientPoint");
            e.position.rY = $(n).offset().top + 8;
            e.position.rX = $(n).offset().left + 8;
            e.config.container.style.left = "0px";
            e.config.container.style.top = "0px";
            e.recalculatePositions();
            e.position.angle = 0;
            var r = document.querySelector(".topGradientPoint"), a = document.querySelector(".bottomGradientPoint");
            var o = editor.canvas.color;
            o.length = 3;
            var s = "rgb(" + o.join(",") + ")";
            r.style.background = s;
            t.subscribe("canvasColorChanged", function() {
                var e = editor.canvas.color;
                e.length = 3;
                var t = "rgb(" + e.join(",") + ")";
                r.style.background = t;
            });
            e.mouseDown = e.mouseDown.bind(e);
            e.mouseUp = e.mouseUp.bind(e);
            i.addEventListener("mousedown", e.mouseDown);
            document.addEventListener("mouseup", e.mouseUp);
        },
        draggable: false,
        target: null,
        currentMoveFn: null,
        latestMousePosition: {
            x: null,
            y: null
        },
        position: {
            top: 100,
            height: 200,
            rX: 0,
            rY: 0,
            correct: true,
            angle: 0,
            wrapperLeft: 0,
            wrapperTop: 0
        },
        positiveAngle: function(e) {
            return e > 0 ? e : e + 360;
        },
        mouseDown: function(e) {
            var t = e.srcElement || e.target, i = this;
            i.target = t;
            i.draggable = true;
            i.latestMousePosition.x = e.clientX;
            i.latestMousePosition.y = e.clientY;
            i.angleMouseDown = Math.atan2(e.clientX - i.position.rX, -(e.clientY - i.position.rY)) * (180 / Math.PI) + 90;
            i.angleMouseDown -= i.position.angle;
            i.currentMoveFn = i.moveTop.bind(i);
            document.addEventListener("mousemove", i.currentMoveFn);
            return;
        },
        mouseUp: function() {
            var e = this;
            document.removeEventListener("mousemove", e.currentMoveFn);
        },
        moveTop: function(e) {
            var t = this, i = (e.clientY - t.latestMousePosition.y) * Math.cos(t.position.angle * Math.PI / 180), n = (e.clientX - t.latestMousePosition.x) * Math.sin(t.position.angle * Math.PI / 180), r = e.clientY - t.latestMousePosition.y, a = e.clientX - t.latestMousePosition.x, o = t.config.container.querySelector(".topGradientLine"), s = t.config.container.querySelector(".bottomGradientLine"), l = t.config.container.querySelector(".centerGradientPoint");
            if (t.target.className === "topGradientLine" || t.target.className === "topGradientPoint") {
                t.position.top += i - n;
                t.position.height -= i - n;
                o.style.top = t.position.top + "px";
                t.recalculatePositions();
                t.position.wrapperStyle = true;
                t.config.onChange && t.config.onChange();
            } else if (t.target.className === "bottomGradientLine" || t.target.className === "bottomGradientPoint") {
                t.position.height += i - n;
                s.style.top = t.position.top + t.position.height + "px";
                t.recalculatePositions();
                t.position.wrapperStyle = true;
                t.config.onChange && t.config.onChange();
            } else if (t.target.className === "arrowRotateBlock_1" || t.target.className === "arrowRotateBlock_2") {
                var c = Math.atan2(e.clientX - t.position.rX, -(e.clientY - t.position.rY)) * (180 / Math.PI) + 90;
                c -= t.angleMouseDown;
                t.position.yOriginRotate = t.position.top + t.position.height / 2;
                if (t.position.wrapperStyle) {
                    t.position.wrapperStyle = false;
                    $(t.config.container).css({
                        "-webkit-transform-origin": "50% " + t.position.yOriginRotate + "px"
                    });
                    $(t.config.container).css({
                        "-moz-transform-origin": "50% " + t.position.yOriginRotate + "px"
                    });
                    $(t.config.container).css({
                        "transform-origin": "50% " + t.position.yOriginRotate + "px"
                    });
                    var u = parseInt(t.config.container.style.left);
                    var f = parseInt(t.config.container.style.top);
                    t.config.container.style.left = u + t.position.wrapperLeft + "px";
                    t.config.container.style.top = f + t.position.wrapperTop + "px";
                }
                $(t.config.container).css({
                    "-webkit-transform": "rotate(" + c + "deg)"
                });
                $(t.config.container).css({
                    "-moz-transform": "rotate(" + c + "deg)"
                });
                $(t.config.container).css({
                    transform: "rotate(" + c + "deg)"
                });
                t.position.angle = c;
                t.config.onChange && t.config.onChange();
            } else if (t.target.className === "centerGradientPoint") {
                t.position.top += r;
                t.recalculatePositions();
                t.position.wrapperStyle = true;
                t.config.onChange && t.config.onChange();
            }
            t.position.rY = $(l).offset().top + 2;
            t.position.rX = $(l).offset().left + 2;
            t.latestMousePosition.x = e.clientX;
            t.latestMousePosition.y = e.clientY;
        },
        recalculatePositions: function() {
            var e = this, t = e.config.container.querySelector(".centerGradientPoint"), i = e.config.container.querySelector(".gradientRotateBlock"), n = e.config.container.querySelector(".topGradientPoint"), r = e.config.container.querySelector(".bottomGradientPoint"), a = e.config.container.querySelector(".gradientFilterVertical"), o = e.config.container.querySelector(".gradientSeparateLine"), s = e.config.container.querySelector(".topGradientLine"), l = e.config.container.querySelector(".bottomGradientLine"), c = e.position.top + e.position.height / 2;
            t.style.top = c + "px";
            i.style.top = c + "px";
            o.style.top = c + "px";
            n.style.top = e.position.top + "px";
            r.style.top = e.position.top + e.position.height + "px";
            a.style.top = e.position.top + "px";
            a.style.height = e.position.height + "px";
            s.style.top = e.position.top + "px";
            l.style.top = e.position.top + e.position.height + "px";
            var u = e.position.top + e.position.height / 2, f = e.position.yOriginRotate - u;
            e.position.wrapperLeft = f * Math.sin(e.position.angle * Math.PI / 180);
            e.position.wrapperTop = f - f * Math.cos(e.position.angle * Math.PI / 180);
        },
        getControlPoints: function() {
            var e = this.config.container.querySelector(".topGradientPoint"), t = this.config.container.querySelector(".bottomGradientPoint"), i = editor.canvas;
            var n = $(e).offset(), r = i.getTranformPoint(n.left + $(e).width() / 2, n.top + $(e).height() / 2), a = $(t).offset(), o = i.getTranformPoint(a.left + $(t).width() / 2, a.top + $(t).height() / 2);
            return {
                start: r,
                end: o
            };
        },
        destroy: function() {
            var e = this;
            console.count("removeEventListener mouseUp");
            document.removeEventListener("mouseup", e.mouseUp);
            e.config.container.removeEventListener("mousedown", e.mouseDown);
            e.refreshPosition();
            while (e.config.container.firstChild) {
                e.config.container.removeChild(e.config.container.firstChild);
            }
            e.config.container.classList.remove("gradientIsOpen");
        },
        refreshPosition: function() {
            var e = this;
            e.config.container.removeAttribute("style");
            e.position = {
                angle: 0,
                correct: true,
                rX: 0,
                rY: 0,
                wrapperLeft: 0,
                wrapperTop: 0
            };
            e.recalculatePositions();
        },
        template: [ '<div class = "topGradientLine"><span></span></div>', '<div class = "gradientRotateBlock">', '<span class="arrowRotateBlock_1"></span>', '<span class="arrowRotateBlock_2"></span>', "</div>", '<div class = "gradientFilterVertical"></div>', '<div class = "bottomGradientLine"><span></span></div>', '<div class = "topGradientPoint"></div>', '<div class = "centerGradientPoint"></div>', '<div class = "bottomGradientPoint"></div>', '<div class = "gradientSeparateLine"><span></span></div>' ].join("")
    });
});

define("Widget/hr", [ "uiObject", "mustache" ], function(e, t) {
    var i = e.extend({
        initialize: function() {
            var e = this, i = "", n = "";
            i += "picsioHr";
            if (this.config.classList) {
                i += " " + this.config.classList.join(" ");
            }
            if (this.config.styleList) {
                for (style in this.config.styleList) {
                    n += " " + style + ": " + this.config.styleList[style] + ";";
                }
            }
            this.template = t.to_html('<div class="{{classList}}" style="{{styleList}}"></div>', {
                classList: i,
                styleList: n
            });
            var r = this.render();
        }
    });
    return i;
});

define("Widget/inputFile", [ "uiObject", "mustache", "signal" ], function(e, t, i) {
    var n = e.extend({
        initialize: function() {
            var e = this;
            this.config.container = this.config.container || $("#picsEdit-rangeInput");
            e.params = {
                mimetypes: this.config.mimetypes || [ "image/jpeg", "image/bmp", "image/x-windows-bmp", "image/png", "image/pjpeg" ]
            };
            var i = this.config.min || 0;
            var n = this.config.max || 100;
            this.config.curValue = this.config.defaultValue;
            this.template = t.to_html([ '<li class="{{#classList}}{{.}} {{/classList}}">{{title}}<div class="btnInputFile"><input type="file" /></div></li>' ].join(""), {
                title: this.config.title,
                classList: this.config.classList
            });
            var r = this.render();
            var a = this.elem = r.find("input[type=file]");
            var o = {
                image: function(t, i) {
                    var n = new Blob([ t.target.result ]);
                    var r = URL.createObjectURL(n);
                    var a = new Image();
                    a.onload = function(t) {
                        console.log("Image ready");
                        e.config.onReady && e.config.onReady(a, i);
                    };
                    a.src = r;
                },
                xml: function(t, i) {
                    var n = t.target.result;
                    var r = function(e) {
                        return String.fromCharCode.apply(null, new Uint8Array(e));
                    };
                    e.config.onReady && e.config.onReady(r(n), i);
                }
            };
            a.on("change", function(t) {
                var i = t.target, n = i.files[0];
                e._onChooseFile(t, n, o);
                i.value = "";
            });
            this.initDnD(o);
        },
        initDnD: function(e) {
            if (this.config.id !== "loadFile") {
                return;
            }
            $("#picsioEditor").on("drop", function(t) {
                t.preventDefault();
                t.stopPropagation();
                if (t.originalEvent.dataTransfer && t.originalEvent.dataTransfer.files.length) {
                    var i = t.originalEvent.dataTransfer.files[0];
                    this._onChooseFile(t, i, e);
                }
            }.bind(this)).on("dragenter", function(e) {
                if (e.originalEvent.dataTransfer) {
                    e.preventDefault();
                    e.stopPropagation();
                    var t = e.originalEvent.dataTransfer.types[0];
                    var i = t === "Files";
                    var n = t === "application/x-moz-file";
                    var r = t === "public.file-url";
                    if (i || n || r) {}
                }
            }).on("dragover", function(e) {
                if (e.preventDefault) {
                    e.preventDefault();
                }
            });
        },
        _onChooseFile: function(e, t, n) {
            if (this.params.mimetypes.indexOf(t.type.toLowerCase()) == -1) {
                i.publish("dialog.alert.show", {
                    key: "unsupportedFormat"
                });
                return;
            }
            var r = new FileReader();
            r.onload = function(e) {
                if (n[this.config.type]) {
                    n[this.config.type](e, t);
                } else {
                    this.config.onReady && this.config.onReady(e, t);
                }
            }.bind(this);
            r.readAsArrayBuffer(t);
        },
        getValue: function() {
            return this.elem.val();
        },
        open: function() {
            this.elem.trigger("click");
        }
    });
    return n;
});

define("Widget/inputRange", [ "uiObject", "mustache" ], function(e, t) {
    var i = e.extend({
        initialize: function() {
            var e = this;
            this.config.container = this.config.container || $("#picsEdit-rangeInput");
            var i = "", n = this.config.min || 0, r = this.config.max || 100, a = this.config.label || "", o = this.config.bgRangeHandle || "", s = this.config.bgProgress ? "linear-gradient(to right, " + this.config.bgProgress[0] + " , " + this.config.bgProgress[1] + ")" : "", l = typeof this.config.showProgress === "boolean" ? this.config.showProgress : true, c = typeof this.config.progressStartValue !== "undefined" ? this.config.progressStartValue : this.config.defaultValue, u = typeof this.config.inputTxtWidth !== "undefined" ? "width: " + this.config.inputTxtWidth : "";
            this.config.curValue = this.config.defaultValue;
            i += "picsioInputRange";
            if (this.config.title) {
                i += " " + this.config.title;
            }
            if (this.config.classList) {
                i += " " + this.config.classList.join(" ");
            }
            this.template = t.to_html([ '<div class="{{classList}}">', '<span class="labelInputRange">{{label}}</span>', '<input type="range" name="{{plugin_name}}" min="{{minValue}}" max="{{maxValue}}" step="1" value="{{defaultValue}}" style="{{inputTxtWidth}}" />', "</div>" ].join(""), {
                plugin_name: this.config.title,
                defaultValue: c,
                minValue: n,
                maxValue: r,
                label: a,
                classList: i,
                inputTxtWidth: u
            });
            this.container = this.render();
            var f = this.container.find('input[type="range"]');
            var d = this.elem = f.rangeinput({
                css: {
                    slider: "rangeInput",
                    progress: "rangeProgress",
                    handle: "rangeHandle"
                },
                progress: l,
                bgRangeHandle: o,
                bgProgress: s
            }).keyup(function(e) {
                if (e.keyCode === 13) {
                    e.target.blur();
                }
            });
            if (typeof this.config.chooseBtns !== "undefined") {
                this.generateChooseBtns(d);
            }
            d.on("change", function(t, i) {
                d.trigger("onCustomChange", i);
                if (e.config.onChangeFinished) {
                    e.config.onChangeFinished.call(e, i);
                }
                if (typeof e.config.chooseBtns !== "undefined") {
                    e.actCooseBtn(this);
                }
            });
            d.on("onSlide", function(t, i) {
                d.trigger("onCustomChange", i);
                if (typeof e.config.chooseBtns !== "undefined") {
                    e.actCooseBtn(this);
                }
            });
            d.on("onCustomChange", function(t, i) {
                e.config.curValue = i;
                e.config.onChange.call(e, i);
            });
            if (typeof this.config.chooseBtns !== "undefined") {
                this.actCooseBtn(d[0]);
            }
            if (typeof this.config.progressStartValue !== "undefined") {
                d[0].value = this.config.defaultValue;
                d.blur();
            }
            this.config.disabled ? this.disable() : this.enable();
        },
        generateChooseBtns: function(e) {
            var t = this, i = this.config.chooseBtns, n = document.createElement("div");
            for (var r = 0; r < i.length; r++) {
                var a = document.createElement("div"), o = document.createTextNode(i[r].title);
                a.appendChild(o);
                a.dataset.value = i[r].value;
                a.classList.add("someBtnInputrange");
                a.addEventListener("click", function(i) {
                    t.handlerChooseBtn(i, e);
                }, false);
                n.appendChild(a);
            }
            n.classList.add("btnsInputrange");
            this.container[0].appendChild(n);
        },
        handlerChooseBtn: function(e, t) {
            if (!this.container[0].classList.contains("disabledInputRange")) {
                var i = e.target.dataset.value;
                t[0].value = i;
                t.blur();
            }
        },
        actCooseBtn: function(e) {
            var t = this.config.chooseBtns;
            for (var i = 0; i < t.length; i++) {
                if (e.value <= t[i].value || t.length === i + 1) {
                    var n = this.container[0].querySelectorAll(".someBtnInputrange");
                    for (var r = 0; r < n.length; r++) {
                        n[r].classList.remove("act");
                    }
                    n[i].classList.add("act");
                    return;
                }
            }
        },
        getValue: function() {
            return this.elem.val();
        },
        setValue: function(e) {
            this.elem.val(e).blur();
        },
        resetValue: function() {
            this.elem.val(this.config.defaultValue).blur();
        },
        enabled: true,
        enable: function() {
            this.enabled = true;
            this.$el.find("input").prop("disabled", false);
            this.$el.removeClass("disabledInputRange");
        },
        disable: function() {
            this.enabled = false;
            this.$el.find("input").prop("disabled", true);
            this.$el.addClass("disabledInputRange");
        },
        toggleEnabling: function() {
            this.enabled ? this.disable() : this.enable();
        },
        isDisabled: function() {
            return !this.enabled;
        },
        isEnabled: function() {
            return this.enabled;
        }
    });
    return i;
});

define("Widget/inputText", [ "uiObject", "mustache" ], function(e, t) {
    return e.extend({
        initialize: function() {
            var e = this;
            var i = "", n = this.config.styleList, r = this.config.type || "text";
            minVal = this.config.minValue || "", maxVal = this.config.maxValue || "", value = typeof this.config.defaultValue !== "undefined" ? this.config.defaultValue : 0, 
            title = this.config.title || "inputText", label = this.config.label || "", validity = this.config.validity || false, 
            placeholder = this.config.placeholder || "", help = this.config.help;
            var a = [];
            for (var o in n) {
                a.push({
                    key: o,
                    value: n[o]
                });
            }
            this.config.curValue = this.config.defaultValue;
            i += "picsioInputText";
            if (this.config.title) {
                i += " " + this.config.title;
            }
            if (this.config.classList) {
                i += " " + this.config.classList.join(" ");
            }
            this.template = t.to_html([ '<div class="{{classList}}" style="{{#styleList}}{{key}}: {{value}};{{/styleList}}">', '{{#label}}<span class="labelInputText">{{label}}</span>{{/label}}', '{{#help}}<a class="helpLinkInputText" target="_blank" href="{{help.url}}">{{help.text}}</a>{{/help}}', '<span class="labelInputText error"></span>', '<input type="{{type}}" name="{{plugin_name}}" min="{{minValue}}" max="{{maxValue}}" value="{{defaultValue}}"', '{{#placeholder}}placeholder="{{placeholder}}"{{/placeholder}}/>', "</div>" ].join(""), {
                plugin_name: title,
                defaultValue: value,
                minValue: minVal,
                maxValue: maxVal,
                label: label,
                classList: i,
                styleList: a,
                placeholder: placeholder,
                type: r,
                help: help
            });
            this.render();
            this.$inputEl = this.$el.find("input");
            this.prevValue = this.config.curValue;
            this.$inputEl.on("input", function(t) {
                e.config.onBeforeChange && e.config.onBeforeChange.call(e, e.getValue());
                if (!validity || validity && validity.test(e.getValue())) {
                    e.config.onChange && e.config.onChange(e.getValue());
                } else {
                    e.config.onChange && e.config.onChange(null, {
                        error: {
                            value: e.getValue()
                        }
                    });
                }
                this.prevValue = e.getValue();
                e._validate(function(t, i) {
                    if (t) {
                        e.config.onError && e.config.onError();
                        e.addErrorWarn();
                        e.addErrorText(t);
                        e.setErrorState();
                    } else {
                        e.removeErrorWarn();
                        e.removeErrorText();
                        e.removeErrorState();
                    }
                });
            });
            this.$inputEl.on("blur", function(t) {
                e.config.onBlur && e.config.onBlur.call(e, e.getValue());
            });
            this.error = false;
            this.config.disabled ? this.disable() : this.enable();
        },
        hasError: function() {
            return this.error;
        },
        setErrorState: function() {
            this.error = true;
        },
        removeErrorState: function() {
            this.error = false;
        },
        enabled: true,
        enable: function() {
            this.enabled = true;
            this.$inputEl.prop("disabled", false);
            this.$el.removeClass("disable");
            return this;
        },
        disable: function() {
            this.enabled = false;
            this.$inputEl.prop("disabled", true);
            this.$el.addClass("disable");
            return this;
        },
        toggleEnabling: function() {
            this.enabled ? this.disable() : this.enable();
        },
        isDisabled: function() {
            return !this.enabled;
        },
        isEnabled: function() {
            return this.enabled;
        },
        focus: function(e) {
            this.$el.find("input").focus();
            if (e) {
                var t = this.$el.find("input").val().length;
                this.$el.find("input")[0].setSelectionRange(t, t);
            }
        },
        select: function() {
            this.$el.find("input").select();
        },
        addErrorWarn: function() {
            this.$el.addClass("errorWarn");
        },
        removeErrorWarn: function() {
            this.$el.removeClass("errorWarn");
        },
        addErrorText: function(e) {
            var t = this.$el.find(".labelInputText.error");
            t.text(e);
            t.addClass("show");
        },
        removeErrorText: function() {
            var e = this.$el.find(".labelInputText.error");
            e.text("");
            e.removeClass("show");
        },
        getValue: function() {
            return this.$inputEl.val();
        },
        setValue: function(e) {
            this.prevValue = e;
            return this.$inputEl.val(e);
        },
        addValidators: function(e) {
            if (!this._validators) {
                this._validators = [];
            }
            if (!(e instanceof Array)) {
                this._validators.push.apply(this._validators, [ e ]);
            } else {
                this._validators.push.apply(this._validators, e);
            }
        },
        _validate: function(e) {
            var t = this, i = true, n = function(i) {
                if (!r.length) {
                    return e(null, true);
                }
                var a = r.shift();
                var o = a;
                o.call(t, function(t, i) {
                    if (t) {
                        e(t, null);
                    } else {
                        n(a);
                    }
                });
            };
            if (!this._validators) {
                return e(null, true);
            }
            var r = this._validators.clone();
            n(r);
        }
    });
});

define("Widget/menu", [ "uiObject", "mustache", "tooltip" ], function(e, t, i) {
    var n = e.extend({
        template: [ "<li>", '<span class="itemIcon" style="background-image: url({{icon_path}})"></span>', '<div class="dropMenu">', '<div class="innerDropMenu">', '<span class="titleDropMenu">{{menuItems_name}}</span>', "<ul>", "</ul>", "</div>", "</div>", "</li>" ].join(""),
        textTemplate: [ "<li>", '<span class="itemIcon ">{{{menu_name}}}</span>', '<div class="dropMenu">', '<div class="innerDropMenu">', '<span class="titleDropMenu">{{menuItems_name}}</span>', "<ul>", "</ul>", "</div>", "</div>", "</li>" ].join(""),
        initialize: function(e) {
            var i = e.items, n = e.container;
            e.title = e.title || "noName";
            e.title = e.title.charAt(0).toUpperCase() + e.title.slice(1);
            if (e.icon) {
                var r = $(t.to_html(this.template, {
                    menu_name: e.title,
                    icon_path: e.icon,
                    menuItems_name: e.menuTitle || ""
                }));
            } else {
                var r = $(t.to_html(this.textTemplate, {
                    menu_name: e.title,
                    menuItems_name: e.menuTitle || ""
                }));
            }
            var a = r.find("ul");
            n.append(r);
            if (!e.menuTitle) {
                n.find(".titleDropMenu").hide();
            }
            for (var o in i) {
                this.addItem(i[o], a);
            }
        },
        addItem: function(e, t) {
            switch (e.type) {
              case "text":
                this.publish("uiPluginElementReady", {
                    plugin: e.action,
                    container: t,
                    params: e
                }, true);
                break;
            }
        }
    });
    return n;
});

define("Widget/select", [ "uiObject", "mustache" ], function(e, t) {
    var i = e.extend({
        initialize: function() {
            var e = this, i = "", n = "", r = "", a = "width: " + (this.config.width ? parseFloat(this.config.width) + "px;" : "100%;");
            this.config.callback = this.config.callback || function() {};
            this.options = document.createDocumentFragment();
            if (this.config.options) this.generateOptions();
            i += "picsioSelect";
            if (this.config.classList) {
                i += " " + this.config.classList.join(" ");
            }
            n += a;
            if (this.config.styleList) {
                for (style in this.config.styleList) {
                    n += " " + style + ": " + this.config.styleList[style] + ";";
                }
            }
            r = "";
            if (this.config.labelStyleList) {
                for (style in this.config.labelStyleList) {
                    r += " " + style + ": " + this.config.labelStyleList[style] + ";";
                }
            }
            this.template = t.to_html([ '<div class="{{classList}}" style="{{styleList}}">', '{{#label}}<span class="labelPicsioSelect">{{label}}</span>{{/label}}', '<div class="txtCheckedOption" style="{{labelStyleList}}">' + this.defaultOption + "</div>", '<div class="listOptions">', "<ul>", "</ul>", "</div>", "</div>" ].join(""), {
                classList: i,
                styleList: n,
                labelStyleList: r,
                label: this.config.label
            });
            this.render();
            if (this.config.options) {
                if (this.options.querySelector(".act") === null) {
                    this.options.querySelectorAll("li")[0].classList.add("act");
                }
                this.el.querySelector(".listOptions ul").appendChild(this.options);
            }
            this.toggleSelectHandler = this.toggleSelect.bind(this);
            this.el.querySelector(".txtCheckedOption").addEventListener("click", this.toggleSelectHandler, false);
            this.config.disabled ? this.disable() : this.enable();
        },
        setValue: function(e) {
            var t = this.el.querySelector('[data-value="' + e + '"]');
            if (!t) {
                console.warn("Seleced value wasn't found");
                return;
            }
            var i = this.el.querySelector(".act");
            if (i) {
                i.classList.remove("act");
            }
            t.classList.add("act");
            this.el.querySelector(".txtCheckedOption").innerHTML = t.textContent;
        },
        addOptions: function(e, t) {
            this.defaultOption = e[0].text || (!e[0].value ? e[0] : e[0].value);
            for (var i = 0; i < e.length; i++) {
                this.generateOption(e[i]);
            }
            if (this.options.querySelector(".act") === null) {
                this.options.querySelectorAll("li")[0].classList.add("act");
            }
            if (t) $(this.el).find(".listOptions ul").empty();
            this.el.querySelector(".listOptions ul").appendChild(this.options);
            this.el.querySelector(".txtCheckedOption").innerHTML = this.defaultOption;
        },
        generateOptions: function() {
            var e = this.config.options;
            this.defaultOption = e[0].text || (!e[0].value ? e[0] : e[0].value);
            for (var t = 0; t < e.length; t++) {
                this.generateOption(e[t]);
            }
        },
        generateOption: function(e) {
            var t = this;
            var i = document.createElement("li"), n = e.callback || function() {};
            if (typeof e === "string") {
                var r = document.createTextNode(e);
                var a = e;
            } else {
                var r = document.createTextNode(e.text || e.value);
                var a = e.value || e.text;
                if (e.checked === true) {
                    this.defaultOption = e.text || e.value;
                    i.classList.add("act");
                    this.activeOption = a;
                }
            }
            i.appendChild(r);
            i.setAttribute("data-value", a);
            var o = e.enabled !== false;
            if (!o) {
                i.style.display = "none";
            }
            if (this.config.optionStyleList) {
                for (style in this.config.optionStyleList) {
                    i.style[style] = this.config.optionStyleList[style];
                }
            }
            var s = this.chooseOption.bind(this);
            i.addEventListener("click", s, false);
            i.addEventListener("click", function(e) {
                t.config.callback && t.config.callback(e, this.dataset.value);
            }, false);
            i.addEventListener("click", function(e) {
                n(e, this.dataset.value);
            }, false);
            this.options.appendChild(i);
            if (e.beforeOnLoad) {
                e.beforeOnLoad();
            }
        },
        toggleSelect: function(e) {
            if (this.isDisabled()) {
                return;
            }
            this.el.classList.toggle("act");
            var t = this;
            setTimeout(function() {
                if (t.el.classList.contains("act")) {
                    t.closeSelectHandler = t.toggleSelect.bind(t);
                    t.selectContainerHandler = t.selectContainer.bind(t);
                    t.el.addEventListener("click", t.selectContainerHandler, false);
                    document.body.addEventListener("click", t.closeSelectHandler, false);
                } else {
                    t.el.removeEventListener("click", t.selectContainerHandler, false);
                    document.body.removeEventListener("click", t.closeSelectHandler, false);
                }
            }, 0);
        },
        chooseOption: function(e) {
            var t = e.currentTarget, i = t.parentNode.querySelector(".act") || null;
            if (i !== null) {
                i.classList.remove("act");
            }
            t.classList.add("act");
            this.el.querySelector(".txtCheckedOption").innerHTML = e.currentTarget.innerHTML;
            this.toggleSelect();
        },
        selectContainer: function(e) {
            e.stopPropagation();
        },
        destroy: function() {
            var e = this.el.querySelector(".txtCheckedOption");
            e.removeEventListener("click", this.toggleSelectHandler, false);
        },
        getValue: function() {
            return this.el.querySelector(".act").dataset.value;
        },
        getActiveText: function() {
            return this.el.querySelector(".act").innerHTML;
        },
        enabled: true,
        disable: function() {
            this.enabled = false;
            this.$el.addClass("disable");
        },
        enable: function() {
            this.enabled = true;
            this.$el.removeClass("disable");
        },
        toggleEnabling: function() {
            this.enabled ? this.disable() : this.enable();
        },
        isDisabled: function() {
            return !this.enabled;
        },
        isEnabled: function() {
            return this.enabled;
        }
    });
    return i;
});

define("Widget/tabControl", [ "uiObject", "mustache", "utils" ], function(e, t, i) {
    var n = e.extend({
        initialize: function() {
            var e = this, i = "";
            if (this.config.classList) {
                i = this.config.classList.join(" ");
            }
            this.template = t.to_html([ '<div class="picsioTabControl {{classList}}">', '<div class="tabList">', "<ul>", "</ul>", "</div>", '<div class="tabContent">', "</div>", "</div>" ].join(" "), {
                classList: i
            });
            var n = this.render();
            this.addTabs(this.config.tabs);
        },
        addTabs: function(e) {
            for (var t = 0; t < e.length; t++) {
                this.addTabBtn(e[t], t);
            }
        },
        addTabBtn: function(e, t) {
            var i = this, n = this.getContainer(), r = "";
            if (e.styleList) {
                for (style in e.styleList) {
                    r += style + ": " + e.styleList[style] + "; ";
                }
            }
            var a = document.createElement("LI"), o = document.createTextNode(e.label);
            a.appendChild(o);
            a.setAttribute("style", r);
            if (!e.contentItems) {
                e.contentItems = [];
            }
            a.addEventListener("click", function() {
                i.tabClick(this, t);
            }, false);
            n.querySelector(".tabList ul").appendChild(a);
            if (e.active === true) {
                this.tabClick(a);
                this.addTabContent(e.contentItems, true);
            } else {
                this.addTabContent(e.contentItems, false);
            }
        },
        addTabContent: function(e, t) {
            var i = this.getContainer().querySelector(".tabContent");
            var n = document.createElement("div");
            n.classList.add("someTabContent");
            if (t === true) {
                n.classList.add("act");
            }
            i.appendChild(n);
            this.addItems(n, e);
        },
        addItems: function(e, t) {
            for (var i = 0; i < t.length; i++) {
                this.addItem(t[i], e);
            }
        },
        addItem: function(e, t) {
            if (!this.items) {
                this.items = {};
            }
            i.mixin(e.config, {
                container: t
            });
            var n = new e.item(e.config);
            this.items[e.config.id] = n;
        },
        tabClick: function(e, t) {
            var i = this.getContainer().querySelector(".tabList .act"), n = this.getContainer().querySelector(".tabContent .act");
            if (i) {
                i.classList.remove("act");
                n.classList.remove("act");
                this.getContainer().querySelectorAll(".tabContent .someTabContent")[t].classList.add("act");
            }
            e.classList.add("act");
        },
        getContainer: function() {
            return this.config.container.querySelector(".picsioTabControl");
        },
        getItem: function(e) {
            return this.items[e];
        }
    });
    return n;
});

define("Widget/text", [ "uiObject", "mustache" ], function(e, t) {
    var i = e.extend({
        initialize: function() {
            var e = this, i = "", n = "", r = this.config.label;
            if (this.config.classList) {
                i += this.config.classList.join(" ");
            }
            if (this.config.styleList) {
                for (style in this.config.styleList) {
                    n += " " + style + ": " + this.config.styleList[style] + ";";
                }
            }
            this.template = t.to_html('<div class="{{classList}}" style="{{styleList}}">{{&label}}</div>', {
                classList: i,
                styleList: n,
                label: r
            });
            this.elem = this.render();
        },
        setText: function(e) {
            this.elem.html(e);
        }
    });
    return i;
});

define("Widget/toggle", [ "uiObject", "mustache" ], function(e, t) {
    var i = e.extend({
        mustacheTemplate: [ '<div class="picsioToggle {{#classList}} {{.}}{{/classList}}">', "{{#segments}}", '<div class="itemToggle" data-value="{{value}}" data-selected="{{#selected}}true{{/selected}}{{^selected}}false{{/selected}}">{{{title}}}</div>', "{{/segments}}", "</div>" ].join(""),
        initialize: function(e) {
            var i = {
                classList: e.classList,
                segments: e.segments
            };
            this.template = t.to_html(this.mustacheTemplate, i);
            this.render();
            this.clickHandler = this.click.bind(this);
            this.$el.find(".itemToggle").on("click", this.clickHandler);
        },
        setSelected: function(e) {
            var t = this.el.querySelectorAll(".itemToggle");
            for (var i = 0; i < t.length; i++) {
                var n = t[i].dataset;
                n.selected = n.value === e;
            }
        },
        click: function(e) {
            var t = e.currentTarget;
            var i = t.dataset.value;
            if (t.dataset.selected === "true") {
                return;
            }
            if (this.config.onBeforeChange && !this.config.onBeforeChange(i)) {
                return;
            }
            this.setSelected(i);
            this.config.onChange.call(this, i);
        },
        getValue: function() {
            var e = this.el.querySelector('[data-selected="true"]');
            return e && e.dataset.value;
        },
        destroy: function() {
            this.$el.off("click", this.clickHandler, false);
            this.$el.remove();
        }
    });
    return i;
});

define("Widget/toolbar", [ "uiObject" ], function(e) {
    var t = e.extend({
        initialize: function(e) {
            for (var t in e.items) {
                this.addItem(e.items[t], e.container);
            }
            this.$el = e.container;
        },
        remove: function() {
            this.$el.empty();
        },
        addItem: function(e, t) {
            if (typeof e.enabled == "undefined") {
                e.enabled = true;
            }
            if (e.enabled === false) {
                return;
            }
            switch (e.type) {
              case "icon":
                this.publish("uiPluginElementReady", {
                    plugin: e.action,
                    container: t,
                    params: e
                }, true);
                break;

              case "menu":
                this.publish("uiMenuElementReady", {
                    icon: e.icon,
                    items: e.items,
                    container: t,
                    title: e.title,
                    menuTitle: e.menuTitle
                }, true);
                break;

              case "html":
                e.container = t;
                this.publish("uiHtmlElementReady", e, true);
            }
        }
    });
    return t;
});

define("Widget/ui", [ "uiObject" ], function(e) {
    var t = e.extend({
        initialize: function() {
            this.logo = '<img src="{1}" />'.assign(this.config.logoSrc || "assets/img/logo_edit.gif");
            this.render();
            var e = this.config.container;
            e.style.height = "100%";
            e.style.position = "relative";
            e.style.overflow = "hidden";
        },
        template: [ '<div id="picsEdit" class="picsioEditor">', '<div id="rightSidebarEditorAdjustments" class="show"></div>', '<div id="rightSidebarEditorPresets">', '<span class="titleRightSidebar">Preset filters</span>', '<span class="contentRightSidebar"></span>', "</div>", '<div id="picsEdit-spiner" class="picsioEditor-spiner"></div>', '<a href="#" class="logoPicsioEditor"></a>', '<div id="firstPicsioToolbar" class="picsioToolbar"><ul></ul></div>', '<div id="secondPicsioToolbar" class="picsioToolbar"><ul></ul></div>', '<div id="thirdPicsioToolbar" class="picsioToolbar"><ul></ul></div>', '<div id="fourthPicsioToolbar" class="picsioToolbar"><ul></ul></div>', '<div id="fifthPicsioToolbar" class="picsioToolbar"><ul></ul></div>', '<div id="sixthPicsioToolbar" class="picsioToolbar"><ul></ul></div>', '<div class="bgTopToolbars"></div>', '<div id="picsEdit-canvas"></div>', '<div id="picsEdit-selector">', '<div class="picsEditCropTopOverlay"></div>', '<div id="picsEdit-selector-corner-container">', '<div id="picsEdit-selector-left-top"></div>', '<div id="picsEdit-selector-top-middle"></div>', '<div id="picsEdit-selector-left-middle"></div>', '<div id="picsEdit-selector-right-top"></div>', '<div id="picsEdit-selector-right-middle"></div>', '<div id="picsEdit-selector-bottom-middle"></div>', '<div id="picsEdit-selector-right-bottom"></div>', '<div id="picsEdit-selector-left-bottom"></div>', '<div class="picsEditCropHorizontalLine_top"></div>', '<div class="picsEditCropHorizontalLine_bottom"></div>', '<div class="picsEditCropVerticalLine_left"></div>', '<div class="picsEditCropVerticalLine_right"></div>', '<div class="picsEditCropBottomOverlay"></div>', "</div>", "</div>", "</div>", '<div class = "picsEdit-GradientFilter"></div>', "</div>" ].join(""),
        find: function(e) {
            return $("#picsEdit").find(e);
        },
        findNodes: function(e) {
            var t = {};
            for (var i in e) {
                t[i] = $("#picsEdit").find(e[i]);
            }
            return t;
        },
        getToolbarContainers: function(e) {
            if (e) {
                return $("#" + e + "PicsioToolbar ul");
            } else {
                return {
                    topLeft: $("#firstPicsioToolbar ul"),
                    topRight: $("#secondPicsioToolbar ul"),
                    left: $("#thirdPicsioToolbar ul"),
                    fourth: $("#fourthPicsioToolbar ul"),
                    fifth: $("#fifthPicsioToolbar ul"),
                    sixth: $("#sixthPicsioToolbar ul")
                };
            }
        }
    });
    return t;
});

define("Widget/dialogList", [ "./dialog", "mustache" ], function(e, t) {
    var e = e.extend({
        initialize: function() {
            this.__super__.initialize.call(this, {}, true);
            var e = this, i = this.config.list, n = this.config.textPattern, r = this.getItem("text"), a = function() {
                var o = i.shift();
                if (!o) {
                    e.config.onReady();
                    return e.destroy();
                }
                r.setText(t.to_html(n, o));
                var s = {
                    skip: function() {
                        var t = e.getItem("checkbox").isChecked();
                        e.config.onSkip && e.config.onSkip(o);
                        if (t) {
                            while (i.length) {
                                e.config.onSkip(i.shift());
                            }
                        }
                        this.unbind();
                        a();
                    },
                    add: function() {
                        var t = e.getItem("checkbox").isChecked();
                        e.config.onAdd && e.config.onAdd(o);
                        if (t) {
                            while (i.length) {
                                e.config.onAdd && e.config.onAdd(i.shift());
                            }
                        }
                        this.unbind();
                        a();
                    },
                    cancel: function() {
                        var t = e.getItem("checkbox").isChecked();
                        e.config.onCancel && e.config.onCancel();
                        this.unbind();
                        e.destroy();
                    },
                    ok: function() {
                        var t = e.getItem("checkbox").isChecked();
                        e.config.onOk(o);
                        if (t) {
                            while (i.length) {
                                e.config.onOk(i.shift());
                            }
                        }
                        this.unbind();
                        a();
                    },
                    unbind: function() {
                        if (!e.elem) return;
                        e.elem.off("click", ".okPicsioEditorPopup", this.ok);
                        e.elem.off("click", ".closePicsioEditorPopup", this.cancel);
                        e.elem.off("click", ".cancelPicsioEditorPopup", this.cancel);
                        e.elem.off("click", ".skipPicsioEditorPopup", this.skip);
                        e.elem.off("click", ".addPicsioEditorPopup", this.add);
                    },
                    bind: function() {
                        this.ok = this.ok.bind(this);
                        this.cancel = this.cancel.bind(this);
                        this.skip = this.skip.bind(this);
                        this.add = this.add.bind(this);
                        e.elem.on("click", ".okPicsioEditorPopup", this.ok);
                        e.elem.on("click", ".closePicsioEditorPopup", this.cancel);
                        e.elem.on("click", ".cancelPicsioEditorPopup", this.cancel);
                        e.elem.on("click", ".skipPicsioEditorPopup", this.skip);
                        e.elem.on("click", ".addPicsioEditorPopup", this.add);
                    }
                };
                s.bind();
            };
            this.unbindParent();
            a();
        },
        unbindParent: function() {},
        template: [ '<div class="layerUnderPicsioEditorPopup"></div>', '<div class="picsioEditorPopup {{classList}}" style="{{styleList}}">', '<div class="headerPicsioEditorPopup">', '<span class="closePicsioEditorPopup"></span>', '<span class="titlePicsioEditorPopup">{{plugin_title}}</span>', "</div>", '{{#plugin_icon}}<div class="iconPicsioEditorPopup"><img height = 85; src = "{{plugin_icon}}"/></div>{{/plugin_icon}}', '<div class="contentPicsioEditorPopup">', '{{#icon}}<div class="iconPicsioEditorPopup icon_{{icon.name}}" style="background-image:url({{icon.path}})"></div>{{/icon}}', '<div class="innerContentPicsioEditorPopup">', "</div>", "</div>", '<div class="footerPicsioEditorPopup">', '<span class="btnPicsioEditorPopup okPicsioEditorPopup">Replace</span>', '<span class="btnPicsioEditorPopup skipPicsioEditorPopup">Skip</span>', '<span class="btnPicsioEditorPopup addPicsioEditorPopup">Add</span>', '<span class="btnPicsioEditorPopup cancelPicsioEditorPopup">Cancel</span>', "</div>", "</div>" ].join(""),
        destroy: function() {
            this.config.onExit = this.config.onExit || function() {};
            this.config.onClose = this.config.onClose || function() {};
            this.config.onExit();
            this.config.onClose();
            this.elem && this.elem.remove();
            this._window && this._window.close();
            this.elem = null;
        }
    });
    return e;
});

define("Widget/html", [ "uiObject", "mustache" ], function(e, t) {
    var i = e.extend({
        initialize: function() {
            var e = this, i = this.config.styleList, n = this.config.classList, r = this.config.html, a = this.config.methods, o = this.config.tag || "div";
            var s = [];
            for (var l in i) {
                s.push({
                    key: l,
                    value: i[l]
                });
            }
            this.template = t.to_html('<{{tag}} {{#attr}} {{key}}="{{value}}"{{/attr}} class="{{#classList}}{{.}} {{/classList}}" style="{{#styleList}}{{key}}: {{value}};{{/styleList}}">{{{html}}}</{{tag}}>', {
                classList: n,
                styleList: s,
                html: r,
                attr: this.config.attr,
                tag: o
            });
            this.render();
            if (this.config.event) {
                this.$el.on(this.config.event.event, this.config.event.selector, function(t) {
                    e.config.event.handler(t);
                });
            }
            var c = this.config.events || [];
            c.each(function(e) {
                this.$el.on(e.event, e.selector, e.handler);
            }.bind(this));
        },
        setValue: function(e) {
            return this.$el.html(e);
        },
        destroy: function() {
            this.$el.remove();
        }
    });
    return i;
});

function MediumEditor(e, t) {
    return this.init(e, t);
}

if (typeof module === "object") {
    module.exports = MediumEditor;
} else if (typeof define === "function" && define.amd) {
    define("assets/js/lib/MediumEditor/1.9.13/MediumEditor", [], function() {
        return MediumEditor;
    });
}

(function(e, t) {
    function i(e, t) {
        var i;
        if (e === undefined) {
            return t;
        }
        for (i in t) {
            if (t.hasOwnProperty(i) && e.hasOwnProperty(i) === false) {
                e[i] = t[i];
            }
        }
        return e;
    }
    function n(e, t) {
        var i = t.parentNode;
        while (i !== null) {
            if (i === e) {
                return true;
            }
            i = i.parentNode;
        }
        return false;
    }
    function r() {
        var e, t, i, n = this.options.contentWindow.getSelection();
        if (n.getRangeAt && n.rangeCount) {
            i = [];
            for (e = 0, t = n.rangeCount; e < t; e += 1) {
                i.push(n.getRangeAt(e));
            }
            return i;
        }
        return null;
    }
    function a(e) {
        var t, i, n = this.options.contentWindow.getSelection();
        if (e) {
            n.removeAllRanges();
            for (t = 0, i = e.length; t < i; t += 1) {
                n.addRange(e[t]);
            }
        }
    }
    function o() {
        var e = this.options.ownerDocument.getSelection().anchorNode, t = e && e.nodeType === 3 ? e.parentNode : e;
        return t;
    }
    function s() {
        var e, t = "", i, n, r;
        if (this.options.contentWindow.getSelection !== undefined) {
            i = this.options.contentWindow.getSelection();
            if (i.rangeCount) {
                r = this.options.ownerDocument.createElement("div");
                for (e = 0, n = i.rangeCount; e < n; e += 1) {
                    r.appendChild(i.getRangeAt(e).cloneContents());
                }
                t = r.innerHTML;
            }
        } else if (this.options.ownerDocument.selection !== undefined) {
            if (this.options.ownerDocument.selection.type === "Text") {
                t = this.options.ownerDocument.selection.createRange().htmlText;
            }
        }
        return t;
    }
    function l(e) {
        return !!(e && e.nodeType === 1);
    }
    function c(t, i) {
        var n, r, a, o, s, l;
        if (t.queryCommandSupported("insertHTML")) {
            return t.execCommand("insertHTML", false, i);
        }
        n = e.getSelection();
        if (n.getRangeAt && n.rangeCount) {
            r = n.getRangeAt(0);
            r.deleteContents();
            a = t.createElement("div");
            a.innerHTML = i;
            o = t.createDocumentFragment();
            while (a.firstChild) {
                s = a.firstChild;
                l = o.appendChild(s);
            }
            r.insertNode(o);
            if (l) {
                r = r.cloneRange();
                r.setStartAfter(l);
                r.collapse(true);
                n.removeAllRanges();
                n.addRange(r);
            }
        }
    }
    MediumEditor.prototype = {
        defaults: {
            allowMultiParagraphSelection: true,
            anchorInputPlaceholder: "Paste or type a link",
            anchorPreviewHideDelay: 500,
            buttons: [ "bold", "italic", "underline", "anchor", "header1", "header2", "quote" ],
            buttonLabels: false,
            checkLinkFormat: false,
            cleanPastedHTML: false,
            delay: 0,
            diffLeft: 0,
            diffTop: -10,
            disableReturn: false,
            disableDoubleReturn: false,
            disableToolbar: false,
            disableEditing: false,
            elementsContainer: false,
            contentWindow: e,
            ownerDocument: t,
            firstHeader: "h3",
            forcePlainText: true,
            placeholder: "",
            secondHeader: "h4",
            targetBlank: false,
            anchorTarget: false,
            anchorButton: false,
            anchorButtonClass: "btn",
            extensions: {},
            activeButtonClass: "medium-editor-button-active",
            firstButtonClass: "medium-editor-button-first",
            lastButtonClass: "medium-editor-button-last"
        },
        isIE: navigator.appName === "Microsoft Internet Explorer" || navigator.appName === "Netscape" && new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(navigator.userAgent) !== null,
        init: function(e, n) {
            this.options = i(n, this.defaults);
            this.setElementSelection(e);
            if (this.elements.length === 0) {
                return;
            }
            this.parentElements = [ "p", "h1", "h2", "h3", "h4", "h5", "h6", "blockquote", "pre" ];
            if (!this.options.elementsContainer) {
                this.options.elementsContainer = t.body;
            }
            this.id = this.options.elementsContainer.querySelectorAll(".medium-editor-toolbar").length + 1;
            return this.setup();
        },
        setup: function() {
            this.events = [];
            this.isActive = true;
            this.initElements().bindSelect().bindPaste().setPlaceholders().bindElementActions().bindWindowActions().passInstance();
        },
        on: function(e, t, i, n) {
            e.addEventListener(t, i, n);
            this.events.push([ e, t, i, n ]);
        },
        off: function(e, t, i, n) {
            var r = this.events.indexOf([ e, t, i, n ]), a;
            if (r !== -1) {
                a = this.events.splice(r, 1);
                a[0].removeEventListener(a[1], a[2], a[3]);
            }
        },
        removeAllEvents: function() {
            var e = this.events.pop();
            while (e) {
                e[0].removeEventListener(e[1], e[2], e[3]);
                e = this.events.pop();
            }
        },
        initElements: function() {
            this.updateElementList();
            var e, t = false;
            for (e = 0; e < this.elements.length; e += 1) {
                if (!this.options.disableEditing && !this.elements[e].getAttribute("data-disable-editing")) {
                    this.elements[e].setAttribute("contentEditable", true);
                }
                if (!this.elements[e].getAttribute("data-placeholder")) {
                    this.elements[e].setAttribute("data-placeholder", this.options.placeholder);
                }
                this.elements[e].setAttribute("data-medium-element", true);
                this.bindParagraphCreation(e);
                if (!this.options.disableToolbar && !this.elements[e].getAttribute("data-disable-toolbar")) {
                    t = true;
                }
            }
            if (t) {
                this.initToolbar().bindButtons().bindAnchorForm().bindAnchorPreview();
            }
            return this;
        },
        setElementSelection: function(e) {
            this.elementSelection = e;
            this.updateElementList();
        },
        updateElementList: function() {
            this.elements = typeof this.elementSelection === "string" ? this.options.ownerDocument.querySelectorAll(this.elementSelection) : this.elementSelection;
            if (this.elements.nodeType === 1) {
                this.elements = [ this.elements ];
            }
        },
        bindBlur: function(e) {
            var i = this, r = function(e) {
                if (e.target !== i.toolbar && e.target !== i.elements[0] && !n(i.elements[0], e.target) && !n(i.toolbar, e.target) && !n(i.anchorPreview, e.target)) {
                    i.placeholderWrapper(i.elements[0], e);
                    setTimeout(function() {
                        if (!i.keepToolbarAlive) {
                            i.hideToolbarActions();
                        }
                    }, 200);
                }
            };
            t.body.addEventListener("click", r, true);
            t.body.addEventListener("focus", r, true);
            return this;
        },
        bindKeypress: function(e) {
            var t = this;
            this.elements[e].addEventListener("keypress", function(e) {
                t.placeholderWrapper(this, e);
            });
            return this;
        },
        bindClick: function(e) {
            var t = this;
            this.elements[e].addEventListener("click", function() {
                this.classList.remove("medium-editor-placeholder");
                if (t.options.staticToolbar) {
                    t.setToolbarPosition();
                }
            });
            return this;
        },
        bindElementActions: function() {
            var e;
            for (e = 0; e < this.elements.length; e += 1) {
                this.activatePlaceholder(this.elements[e]);
                this.bindReturn(e).bindTab(e).bindBlur(e).bindClick(e).bindKeypress(e);
            }
            return this;
        },
        activatePlaceholder: function(e) {
            if (!e.querySelector("img") && !e.querySelector("blockquote") && e.textContent.replace(/^\s+|\s+$/g, "") === "") {
                e.classList.add("medium-editor-placeholder");
            }
        },
        placeholderWrapper: function(e, t) {
            e.classList.remove("medium-editor-placeholder");
            if (t.type !== "keypress") {
                this.activatePlaceholder(e);
            }
        },
        serialize: function() {
            var e, t, i = {};
            for (e = 0; e < this.elements.length; e += 1) {
                t = this.elements[e].id !== "" ? this.elements[e].id : "element-" + e;
                i[t] = {
                    value: this.elements[e].innerHTML.trim()
                };
            }
            return i;
        },
        callExtensions: function(e) {
            if (arguments.length < 1) {
                return;
            }
            var t = Array.prototype.slice.call(arguments, 1), i, n;
            for (n in this.options.extensions) {
                if (this.options.extensions.hasOwnProperty(n)) {
                    i = this.options.extensions[n];
                    if (i[e] !== undefined) {
                        i[e].apply(i, t);
                    }
                }
            }
        },
        passInstance: function() {
            var e = this, t, i;
            for (i in e.options.extensions) {
                if (e.options.extensions.hasOwnProperty(i)) {
                    t = e.options.extensions[i];
                    if (t.parent) {
                        t.base = e;
                    }
                }
            }
            return e;
        },
        bindParagraphCreation: function(e) {
            var i = this;
            this.on(this.elements[e], "keypress", function(e) {
                var n = o.call(i), r;
                if (e.which === 32) {
                    r = n.tagName.toLowerCase();
                    if (r === "a") {
                        t.execCommand("unlink", false, null);
                    }
                }
            });
            this.on(this.elements[e], "keyup", function(e) {
                var n = o.call(i), r, a;
                if (n && n.getAttribute("data-medium-element") && n.children.length === 0 && !(i.options.disableReturn || n.getAttribute("data-disable-return"))) {
                    t.execCommand("formatBlock", false, "p");
                }
                if (e.which === 13) {
                    n = o.call(i);
                    r = n.tagName.toLowerCase();
                    a = i.getSelectionElement();
                    if (!(i.options.disableReturn || a.getAttribute("data-disable-return")) && r !== "li" && !i.isListItemChild(n)) {
                        if (!e.shiftKey) {
                            t.execCommand("formatBlock", false, "p");
                        }
                        if (r === "a") {
                            t.execCommand("unlink", false, null);
                        }
                    }
                }
            });
            return this;
        },
        isListItemChild: function(e) {
            var t = e.parentNode, i = t.tagName.toLowerCase();
            while (this.parentElements.indexOf(i) === -1 && i !== "div") {
                if (i === "li") {
                    return true;
                }
                t = t.parentNode;
                if (t && t.tagName) {
                    i = t.tagName.toLowerCase();
                } else {
                    return false;
                }
            }
            return false;
        },
        bindReturn: function(e) {
            var t = this;
            this.on(this.elements[e], "keypress", function(e) {
                if (e.which === 13) {
                    if (t.options.disableReturn || this.getAttribute("data-disable-return")) {
                        e.preventDefault();
                    } else if (t.options.disableDoubleReturn || this.getAttribute("data-disable-double-return")) {
                        var i = o.call(t);
                        if (i && i.textContent === "\n") {
                            e.preventDefault();
                        }
                    }
                }
            });
            return this;
        },
        bindTab: function(e) {
            var i = this;
            this.on(this.elements[e], "keydown", function(e) {
                if (e.which === 9) {
                    var n = o.call(i).tagName.toLowerCase();
                    if (n === "pre") {
                        e.preventDefault();
                        t.execCommand("insertHtml", null, "    ");
                    }
                    if (n === "li") {
                        e.preventDefault();
                        if (e.shiftKey) {
                            t.execCommand("outdent", e);
                        } else {
                            t.execCommand("indent", e);
                        }
                    }
                }
            });
            return this;
        },
        buttonTemplate: function(e) {
            var t = this.getButtonLabels(this.options.buttonLabels), i = {
                bold: '<button class="medium-editor-action medium-editor-action-bold" data-action="bold" data-element="b">' + t.bold + "</button>",
                italic: '<button class="medium-editor-action medium-editor-action-italic" data-action="italic" data-element="i">' + t.italic + "</button>",
                underline: '<button class="medium-editor-action medium-editor-action-underline" data-action="underline" data-element="u">' + t.underline + "</button>",
                strikethrough: '<button class="medium-editor-action medium-editor-action-strikethrough" data-action="strikethrough" data-element="strike">' + t.strikethrough + "</button>",
                superscript: '<button class="medium-editor-action medium-editor-action-superscript" data-action="superscript" data-element="sup">' + t.superscript + "</button>",
                subscript: '<button class="medium-editor-action medium-editor-action-subscript" data-action="subscript" data-element="sub">' + t.subscript + "</button>",
                anchor: '<button class="medium-editor-action medium-editor-action-anchor" data-action="anchor" data-element="a">' + t.anchor + "</button>",
                image: '<button class="medium-editor-action medium-editor-action-image" data-action="image" data-element="img">' + t.image + "</button>",
                header1: '<button class="medium-editor-action medium-editor-action-header1" data-action="append-' + this.options.firstHeader + '" data-element="' + this.options.firstHeader + '">' + t.header1 + "</button>",
                header2: '<button class="medium-editor-action medium-editor-action-header2" data-action="append-' + this.options.secondHeader + '" data-element="' + this.options.secondHeader + '">' + t.header2 + "</button>",
                quote: '<button class="medium-editor-action medium-editor-action-quote" data-action="append-blockquote" data-element="blockquote">' + t.quote + "</button>",
                orderedlist: '<button class="medium-editor-action medium-editor-action-orderedlist" data-action="insertorderedlist" data-element="ol">' + t.orderedlist + "</button>",
                unorderedlist: '<button class="medium-editor-action medium-editor-action-unorderedlist" data-action="insertunorderedlist" data-element="ul">' + t.unorderedlist + "</button>",
                pre: '<button class="medium-editor-action medium-editor-action-pre" data-action="append-pre" data-element="pre">' + t.pre + "</button>",
                indent: '<button class="medium-editor-action medium-editor-action-indent" data-action="indent" data-element="ul">' + t.indent + "</button>",
                outdent: '<button class="medium-editor-action medium-editor-action-outdent" data-action="outdent" data-element="ul">' + t.outdent + "</button>",
                justifyCenter: '<button class="medium-editor-action medium-editor-action-justifyCenter" data-action="justifyCenter" data-element="">' + t.justifyCenter + "</button>",
                justifyFull: '<button class="medium-editor-action medium-editor-action-justifyFull" data-action="justifyFull" data-element="">' + t.justifyFull + "</button>",
                justifyLeft: '<button class="medium-editor-action medium-editor-action-justifyLeft" data-action="justifyLeft" data-element="">' + t.justifyLeft + "</button>",
                justifyRight: '<button class="medium-editor-action medium-editor-action-justifyRight" data-action="justifyRight" data-element="">' + t.justifyRight + "</button>"
            };
            return i[e] || false;
        },
        getButtonLabels: function(e) {
            var t, i, n = {
                bold: "<b>B</b>",
                italic: "<b><i>I</i></b>",
                underline: "<b><u>U</u></b>",
                strikethrough: "<s>A</s>",
                superscript: "<b>x<sup>1</sup></b>",
                subscript: "<b>x<sub>1</sub></b>",
                anchor: "<b>#</b>",
                image: "<b>image</b>",
                header1: "<b>H1</b>",
                header2: "<b>H2</b>",
                quote: "<b>&ldquo;</b>",
                orderedlist: "<b>1.</b>",
                unorderedlist: "<b>&bull;</b>",
                pre: "<b>0101</b>",
                indent: "<b>&rarr;</b>",
                outdent: "<b>&larr;</b>",
                justifyCenter: "<b>C</b>",
                justifyFull: "<b>J</b>",
                justifyLeft: "<b>L</b>",
                justifyRight: "<b>R</b>"
            };
            if (e === "fontawesome") {
                t = {
                    bold: '<i class="fa fa-bold"></i>',
                    italic: '<i class="fa fa-italic"></i>',
                    underline: '<i class="fa fa-underline"></i>',
                    strikethrough: '<i class="fa fa-strikethrough"></i>',
                    superscript: '<i class="fa fa-superscript"></i>',
                    subscript: '<i class="fa fa-subscript"></i>',
                    anchor: '<i class="fa fa-link"></i>',
                    image: '<i class="fa fa-picture-o"></i>',
                    quote: '<i class="fa fa-quote-right"></i>',
                    orderedlist: '<i class="fa fa-list-ol"></i>',
                    unorderedlist: '<i class="fa fa-list-ul"></i>',
                    pre: '<i class="fa fa-code fa-lg"></i>',
                    indent: '<i class="fa fa-indent"></i>',
                    outdent: '<i class="fa fa-outdent"></i>',
                    justifyCenter: '<i class="fa fa-align-center"></i>',
                    justifyFull: '<i class="fa fa-align-justify"></i>',
                    justifyLeft: '<i class="fa fa-align-left"></i>',
                    justifyRight: '<i class="fa fa-align-right"></i>'
                };
            } else if (typeof e === "object") {
                t = e;
            }
            if (typeof t === "object") {
                for (i in t) {
                    if (t.hasOwnProperty(i)) {
                        n[i] = t[i];
                    }
                }
            }
            return n;
        },
        initToolbar: function() {
            if (this.toolbar) {
                return this;
            }
            this.toolbar = this.createToolbar();
            this.keepToolbarAlive = false;
            this.anchorForm = this.toolbar.querySelector(".medium-editor-toolbar-form-anchor");
            this.anchorInput = this.anchorForm.querySelector("input.medium-editor-toolbar-anchor-input");
            this.anchorTarget = this.anchorForm.querySelector("input.medium-editor-toolbar-anchor-target");
            this.anchorButton = this.anchorForm.querySelector("input.medium-editor-toolbar-anchor-button");
            this.toolbarActions = this.toolbar.querySelector(".medium-editor-toolbar-actions");
            this.anchorPreview = this.createAnchorPreview();
            return this;
        },
        createToolbar: function() {
            var e = t.createElement("div");
            e.id = "medium-editor-toolbar-" + this.id;
            e.className = "medium-editor-toolbar";
            if (this.options.staticToolbar) {
                e.className += " static-toolbar";
            } else {
                e.className += " stalker-toolbar";
            }
            e.appendChild(this.toolbarButtons());
            e.appendChild(this.toolbarFormAnchor());
            this.options.elementsContainer.appendChild(e);
            return e;
        },
        toolbarButtons: function() {
            var e = this.options.buttons, i = t.createElement("ul"), n, r, a, o;
            i.id = "medium-editor-toolbar-actions";
            i.className = "medium-editor-toolbar-actions clearfix";
            for (r = 0; r < e.length; r += 1) {
                if (this.options.extensions.hasOwnProperty(e[r])) {
                    o = this.options.extensions[e[r]];
                    a = o.getButton !== undefined ? o.getButton() : null;
                } else {
                    a = this.buttonTemplate(e[r]);
                }
                if (a) {
                    n = t.createElement("li");
                    if (l(a)) {
                        n.appendChild(a);
                    } else {
                        n.innerHTML = a;
                    }
                    i.appendChild(n);
                }
            }
            return i;
        },
        toolbarFormAnchor: function() {
            var e = t.createElement("div"), i = t.createElement("input"), n = t.createElement("label"), r = t.createElement("input"), a = t.createElement("label"), o = t.createElement("input"), s = t.createElement("a"), l = t.createElement("a");
            s.setAttribute("href", "#");
            s.className = "medium-editor-toobar-anchor-close";
            s.innerHTML = "&times;";
            l.setAttribute("href", "#");
            l.className = "medium-editor-toobar-anchor-save";
            l.innerHTML = "&#10003;";
            i.setAttribute("type", "text");
            i.className = "medium-editor-toolbar-anchor-input";
            i.setAttribute("placeholder", this.options.anchorInputPlaceholder);
            r.setAttribute("type", "checkbox");
            r.className = "medium-editor-toolbar-anchor-target";
            n.innerHTML = "Open in New Window?";
            n.insertBefore(r, n.firstChild);
            o.setAttribute("type", "checkbox");
            o.className = "medium-editor-toolbar-anchor-button";
            a.innerHTML = "Button";
            a.insertBefore(o, a.firstChild);
            e.className = "medium-editor-toolbar-form-anchor";
            e.id = "medium-editor-toolbar-form-anchor";
            e.appendChild(i);
            e.appendChild(l);
            e.appendChild(s);
            if (this.options.anchorTarget) {
                e.appendChild(n);
            }
            if (this.options.anchorButton) {
                e.appendChild(a);
            }
            return e;
        },
        bindSelect: function() {
            var e = this, i = "", n;
            this.checkSelectionWrapper = function(t) {
                if (t && e.clickingIntoArchorForm(t)) {
                    return false;
                }
                clearTimeout(i);
                i = setTimeout(function() {
                    e.checkSelection();
                }, e.options.delay);
            };
            this.on(t.documentElement, "mouseup", this.checkSelectionWrapper);
            for (n = 0; n < this.elements.length; n += 1) {
                this.on(this.elements[n], "keyup", this.checkSelectionWrapper);
                this.on(this.elements[n], "blur", this.checkSelectionWrapper);
                this.elements[n].addEventListener("click", this.checkSelectionWrapper);
            }
            return this;
        },
        checkSelection: function() {
            var e, t;
            if (this.keepToolbarAlive !== true && !this.options.disableToolbar) {
                e = this.options.contentWindow.getSelection();
                if (e.toString().trim() === "" || this.options.allowMultiParagraphSelection === false && this.hasMultiParagraphs() || this.selectionInContentEditableFalse()) {
                    if (!this.options.staticToolbar) {
                        this.hideToolbarActions();
                    } else if (this.anchorForm.style.display === "block") {
                        this.setToolbarButtonStates();
                        this.showToolbarActions();
                    }
                } else {
                    t = this.getSelectionElement();
                    if (!t || t.getAttribute("data-disable-toolbar")) {
                        if (!this.options.staticToolbar) {
                            this.hideToolbarActions();
                        }
                    } else {
                        this.checkSelectionElement(e, t);
                    }
                }
            }
            return this;
        },
        clickingIntoArchorForm: function(e) {
            var t = this;
            if (e.type && e.type.toLowerCase() === "blur" && e.relatedTarget && e.relatedTarget === t.anchorInput) {
                return true;
            }
            return false;
        },
        hasMultiParagraphs: function() {
            var e = s.call(this).replace(/<[\S]+><\/[\S]+>/gim, ""), t = e.match(/<(p|h[0-6]|blockquote)>([\s\S]*?)<\/(p|h[0-6]|blockquote)>/g);
            return t ? t.length : 0;
        },
        checkSelectionElement: function(e, t) {
            var i;
            this.selection = e;
            this.selectionRange = this.selection.getRangeAt(0);
            for (i = 0; i < this.elements.length; i += 1) {
                if (this.elements[i] === t) {
                    this.setToolbarButtonStates().setToolbarPosition().showToolbarActions();
                    return;
                }
            }
            if (!this.options.staticToolbar) {
                this.hideToolbarActions();
            }
        },
        findMatchingSelectionParent: function(e) {
            var t = this.options.contentWindow.getSelection(), i, n;
            if (t.rangeCount === 0) {
                return false;
            }
            i = t.getRangeAt(0);
            n = i.commonAncestorContainer;
            do {
                if (n.nodeType === 1) {
                    if (e(n)) {
                        return n;
                    }
                    if (n.getAttribute("data-medium-element")) {
                        return false;
                    }
                }
                n = n.parentNode;
            } while (n);
            return false;
        },
        getSelectionElement: function() {
            return this.findMatchingSelectionParent(function(e) {
                return e.getAttribute("data-medium-element");
            });
        },
        selectionInContentEditableFalse: function() {
            return this.findMatchingSelectionParent(function(e) {
                return e && e.nodeName !== "#text" && e.getAttribute("contenteditable") === "false";
            });
        },
        setToolbarPosition: function() {
            var i = t.documentElement && t.documentElement.scrollTop || t.body.scrollTop, n = this.elements[0], r = n.getBoundingClientRect(), a = r.top + i, o = 50, s = e.getSelection(), l, c, u, f = this.options.diffLeft - this.toolbar.offsetWidth / 2, d = this.toolbar.offsetWidth / 2;
            if (s.focusNode === null) {
                return this;
            }
            this.toolbar.classList.add("medium-editor-toolbar-active");
            if (this.options.staticToolbar) {
                if (this.options.stickyToolbar) {
                    if (i > a + this.elements[0].offsetHeight - this.toolbar.offsetHeight) {
                        this.toolbar.style.top = a + this.elements[0].offsetHeight + "px";
                    } else if (i > a - this.toolbar.offsetHeight) {
                        this.toolbar.classList.add("sticky-toolbar");
                        this.toolbar.style.top = "0px";
                    } else {
                        this.toolbar.classList.remove("sticky-toolbar");
                        this.toolbar.style.top = a - this.toolbar.offsetHeight + "px";
                    }
                } else {
                    this.toolbar.style.top = a - this.toolbar.offsetHeight + "px";
                }
                this.toolbar.style.left = r.left + "px";
            } else {
                l = s.getRangeAt(0);
                c = l.getBoundingClientRect();
                u = (c.left + c.right) / 2;
                if (c.top < o) {
                    this.toolbar.classList.add("medium-toolbar-arrow-over");
                    this.toolbar.classList.remove("medium-toolbar-arrow-under");
                    this.toolbar.style.top = o + c.bottom - this.options.diffTop + this.options.contentWindow.pageYOffset - this.toolbar.offsetHeight + "px";
                } else {
                    this.toolbar.classList.add("medium-toolbar-arrow-under");
                    this.toolbar.classList.remove("medium-toolbar-arrow-over");
                    this.toolbar.style.top = c.top + this.options.diffTop + this.options.contentWindow.pageYOffset - this.toolbar.offsetHeight + "px";
                }
                if (u < d) {
                    this.toolbar.style.left = f + d + "px";
                } else if (this.options.contentWindow.innerWidth - u < d) {
                    this.toolbar.style.left = this.options.contentWindow.innerWidth + f - d + "px";
                } else {
                    this.toolbar.style.left = f + u + "px";
                }
            }
            this.hideAnchorPreview();
            return this;
        },
        setToolbarButtonStates: function() {
            var e = this.toolbarActions.querySelectorAll("button"), t;
            for (t = 0; t < e.length; t += 1) {
                e[t].classList.remove(this.options.activeButtonClass);
            }
            this.checkActiveButtons();
            return this;
        },
        checkActiveButtons: function() {
            var e = Array.prototype.slice.call(this.elements), t = this.getSelectedParentElement();
            while (t.tagName !== undefined && this.parentElements.indexOf(t.tagName.toLowerCase) === -1) {
                this.activateButton(t.tagName.toLowerCase());
                this.callExtensions("checkState", t);
                if (e.indexOf(t) !== -1) {
                    break;
                }
                t = t.parentNode;
            }
        },
        activateButton: function(e) {
            var t = this.toolbar.querySelector('[data-element="' + e + '"]');
            if (t !== null && t.className.indexOf(this.options.activeButtonClass) === -1) {
                t.className += " " + this.options.activeButtonClass;
            }
        },
        bindButtons: function() {
            var e = this.toolbar.querySelectorAll("button"), t, i = this, n = function(e) {
                e.preventDefault();
                e.stopPropagation();
                if (i.selection === undefined) {
                    i.checkSelection();
                }
                if (this.className.indexOf(i.options.activeButtonClass) > -1) {
                    this.classList.remove(i.options.activeButtonClass);
                } else {
                    this.className += " " + i.options.activeButtonClass;
                }
                if (this.hasAttribute("data-action")) {
                    i.execAction(this.getAttribute("data-action"), e);
                }
            };
            for (t = 0; t < e.length; t += 1) {
                this.on(e[t], "click", n);
            }
            this.setFirstAndLastItems(e);
            return this;
        },
        setFirstAndLastItems: function(e) {
            if (e.length > 0) {
                e[0].className += " " + this.options.firstButtonClass;
                e[e.length - 1].className += " " + this.options.lastButtonClass;
            }
            return this;
        },
        execAction: function(e, t) {
            if (e.indexOf("append-") > -1) {
                this.execFormatBlock(e.replace("append-", ""));
                this.setToolbarPosition();
                this.setToolbarButtonStates();
            } else if (e === "anchor") {
                this.triggerAnchorAction(t);
            } else if (e === "image") {
                this.options.ownerDocument.execCommand("insertImage", false, this.options.contentWindow.getSelection());
            } else {
                this.options.ownerDocument.execCommand(e, false, null);
                this.setToolbarPosition();
            }
        },
        rangeSelectsSingleNode: function(e) {
            var t = e.startContainer;
            return t === e.endContainer && t.hasChildNodes() && e.endOffset === e.startOffset + 1;
        },
        getSelectedParentElement: function() {
            var e = null, t = this.selectionRange;
            if (this.rangeSelectsSingleNode(t)) {
                e = t.startContainer.childNodes[t.startOffset];
            } else if (t.startContainer.nodeType === 3) {
                e = t.startContainer.parentNode;
            } else {
                e = t.startContainer;
            }
            return e;
        },
        triggerAnchorAction: function() {
            var e = this.getSelectedParentElement();
            if (e.tagName && e.tagName.toLowerCase() === "a") {
                this.options.ownerDocument.execCommand("unlink", false, null);
            } else {
                if (this.anchorForm.style.display === "block") {
                    this.showToolbarActions();
                } else {
                    this.showAnchorForm();
                }
            }
            return this;
        },
        execFormatBlock: function(e) {
            var t = this.getSelectionData(this.selection.anchorNode);
            if (e === "blockquote" && t.el && t.el.parentNode.tagName.toLowerCase() === "blockquote") {
                return this.options.ownerDocument.execCommand("outdent", false, null);
            }
            if (t.tagName === e) {
                e = "p";
            }
            if (this.isIE) {
                if (e === "blockquote") {
                    return this.options.ownerDocument.execCommand("indent", false, e);
                }
                e = "<" + e + ">";
            }
            return this.options.ownerDocument.execCommand("formatBlock", false, e);
        },
        getSelectionData: function(e) {
            var t;
            if (e && e.tagName) {
                t = e.tagName.toLowerCase();
            }
            while (e && this.parentElements.indexOf(t) === -1) {
                e = e.parentNode;
                if (e && e.tagName) {
                    t = e.tagName.toLowerCase();
                }
            }
            return {
                el: e,
                tagName: t
            };
        },
        getFirstChild: function(e) {
            var t = e.firstChild;
            while (t !== null && t.nodeType !== 1) {
                t = t.nextSibling;
            }
            return t;
        },
        hideToolbarActions: function() {
            this.keepToolbarAlive = false;
            if (this.toolbar !== undefined) {
                this.toolbar.classList.remove("medium-editor-toolbar-active");
            }
        },
        showToolbarActions: function() {
            var e = this, t;
            this.anchorForm.style.display = "none";
            this.toolbarActions.style.display = "block";
            this.keepToolbarAlive = false;
            clearTimeout(t);
            t = setTimeout(function() {
                if (e.toolbar && !e.toolbar.classList.contains("medium-editor-toolbar-active")) {
                    e.toolbar.classList.add("medium-editor-toolbar-active");
                }
            }, 100);
        },
        saveSelection: function() {
            this.savedSelection = r.call(this);
        },
        restoreSelection: function() {
            a.call(this, this.savedSelection);
        },
        showAnchorForm: function(e) {
            this.toolbarActions.style.display = "none";
            this.saveSelection();
            this.anchorForm.style.display = "block";
            this.setToolbarPosition();
            this.keepToolbarAlive = true;
            this.anchorInput.focus();
            this.anchorInput.value = e || "";
        },
        bindAnchorForm: function() {
            var e = this.anchorForm.querySelector("a.medium-editor-toobar-anchor-close"), t = this.anchorForm.querySelector("a.medium-editor-toobar-anchor-save"), i = this;
            this.on(this.anchorForm, "click", function(e) {
                e.stopPropagation();
                i.keepToolbarAlive = true;
            });
            this.on(this.anchorInput, "keyup", function(e) {
                var t = null, n;
                if (e.keyCode === 13) {
                    e.preventDefault();
                    if (i.options.anchorTarget && i.anchorTarget.checked) {
                        n = "_blank";
                    } else {
                        n = "_self";
                    }
                    if (i.options.anchorButton && i.anchorButton.checked) {
                        t = i.options.anchorButtonClass;
                    }
                    i.createLink(this, n, t);
                }
            });
            this.on(t, "click", function(e) {
                var t = null, n;
                e.preventDefault();
                if (i.options.anchorTarget && i.anchorTarget.checked) {
                    n = "_blank";
                } else {
                    n = "_self";
                }
                if (i.options.anchorButton && i.anchorButton.checked) {
                    t = i.options.anchorButtonClass;
                }
                i.createLink(i.anchorInput, n, t);
            }, true);
            this.on(this.anchorInput, "click", function(e) {
                e.stopPropagation();
                i.keepToolbarAlive = true;
            });
            this.on(this.options.ownerDocument.body, "click", function(e) {
                if (e.target !== i.anchorForm && !n(i.anchorForm, e.target) && !n(i.toolbarActions, e.target)) {
                    i.keepToolbarAlive = false;
                    i.checkSelection();
                }
            }, true);
            this.on(this.options.ownerDocument.body, "focus", function(e) {
                if (e.target !== i.anchorForm && !n(i.anchorForm, e.target) && !n(i.toolbarActions, e.target)) {
                    i.keepToolbarAlive = false;
                    i.checkSelection();
                }
            }, true);
            this.on(e, "click", function(e) {
                e.preventDefault();
                i.showToolbarActions();
                a.call(i, i.savedSelection);
            });
            return this;
        },
        hideAnchorPreview: function() {
            this.anchorPreview.classList.remove("medium-editor-anchor-preview-active");
        },
        showAnchorPreview: function(e) {
            if (this.anchorPreview.classList.contains("medium-editor-anchor-preview-active") || e.getAttribute("data-disable-preview")) {
                return true;
            }
            var t = this, i = 40, n = e.getBoundingClientRect(), r = (n.left + n.right) / 2, a, o, s;
            t.anchorPreview.querySelector("i").textContent = e.href;
            a = t.anchorPreview.offsetWidth / 2;
            o = t.options.diffLeft - a;
            clearTimeout(s);
            s = setTimeout(function() {
                if (t.anchorPreview && !t.anchorPreview.classList.contains("medium-editor-anchor-preview-active")) {
                    t.anchorPreview.classList.add("medium-editor-anchor-preview-active");
                }
            }, 100);
            t.observeAnchorPreview(e);
            t.anchorPreview.classList.add("medium-toolbar-arrow-over");
            t.anchorPreview.classList.remove("medium-toolbar-arrow-under");
            t.anchorPreview.style.top = Math.round(i + n.bottom - t.options.diffTop + this.options.contentWindow.pageYOffset - t.anchorPreview.offsetHeight) + "px";
            if (r < a) {
                t.anchorPreview.style.left = o + a + "px";
            } else if (this.options.contentWindow.innerWidth - r < a) {
                t.anchorPreview.style.left = this.options.contentWindow.innerWidth + o - a + "px";
            } else {
                t.anchorPreview.style.left = o + r + "px";
            }
            return this;
        },
        observeAnchorPreview: function(e) {
            var t = this, i = new Date().getTime(), n = true, r = function() {
                i = new Date().getTime();
                n = true;
            }, a = function(e) {
                if (!e.relatedTarget || !/anchor-preview/.test(e.relatedTarget.className)) {
                    n = false;
                }
            }, o = setInterval(function() {
                if (n) {
                    return true;
                }
                var s = new Date().getTime() - i;
                if (s > t.options.anchorPreviewHideDelay) {
                    t.hideAnchorPreview();
                    clearInterval(o);
                    t.off(t.anchorPreview, "mouseover", r);
                    t.off(t.anchorPreview, "mouseout", a);
                    t.off(e, "mouseover", r);
                    t.off(e, "mouseout", a);
                }
            }, 200);
            this.on(t.anchorPreview, "mouseover", r);
            this.on(t.anchorPreview, "mouseout", a);
            this.on(e, "mouseover", r);
            this.on(e, "mouseout", a);
        },
        createAnchorPreview: function() {
            var e = this, t = this.options.ownerDocument.createElement("div");
            t.id = "medium-editor-anchor-preview-" + this.id;
            t.className = "medium-editor-anchor-preview";
            t.innerHTML = this.anchorPreviewTemplate();
            this.options.elementsContainer.appendChild(t);
            this.on(t, "click", function() {
                e.anchorPreviewClickHandler();
            });
            return t;
        },
        anchorPreviewTemplate: function() {
            return '<div class="medium-editor-toolbar-anchor-preview" id="medium-editor-toolbar-anchor-preview">' + '    <i class="medium-editor-toolbar-anchor-preview-inner"></i>' + "</div>";
        },
        anchorPreviewClickHandler: function(e) {
            if (this.activeAnchor) {
                var t = this, i = this.options.ownerDocument.createRange(), n = this.options.contentWindow.getSelection();
                i.selectNodeContents(t.activeAnchor);
                n.removeAllRanges();
                n.addRange(i);
                setTimeout(function() {
                    if (t.activeAnchor) {
                        t.showAnchorForm(t.activeAnchor.href);
                    }
                    t.keepToolbarAlive = false;
                }, 100 + t.options.delay);
            }
            this.hideAnchorPreview();
        },
        editorAnchorObserver: function(e) {
            var t = this, i = true, n = function() {
                i = false;
                t.off(t.activeAnchor, "mouseout", n);
            };
            if (e.target && e.target.tagName.toLowerCase() === "a") {
                if (!/href=["']\S+["']/.test(e.target.outerHTML) || /href=["']#\S+["']/.test(e.target.outerHTML)) {
                    return true;
                }
                if (this.toolbar.classList.contains("medium-editor-toolbar-active")) {
                    return true;
                }
                this.activeAnchor = e.target;
                this.on(this.activeAnchor, "mouseout", n);
                setTimeout(function() {
                    if (i) {
                        t.showAnchorPreview(e.target);
                    }
                }, t.options.delay);
            }
        },
        bindAnchorPreview: function(e) {
            var t, i = this;
            this.editorAnchorObserverWrapper = function(e) {
                i.editorAnchorObserver(e);
            };
            for (t = 0; t < this.elements.length; t += 1) {
                this.on(this.elements[t], "mouseover", this.editorAnchorObserverWrapper);
            }
            return this;
        },
        checkLinkFormat: function(e) {
            var t = /^(https?|ftps?|rtmpt?):\/\/|mailto:/;
            return (t.test(e) ? "" : "http://") + e;
        },
        setTargetBlank: function(e) {
            var t;
            e = e || o.call(this);
            if (e.tagName.toLowerCase() === "a") {
                e.target = "_blank";
            } else {
                e = e.getElementsByTagName("a");
                for (t = 0; t < e.length; t += 1) {
                    e[t].target = "_blank";
                }
            }
        },
        setButtonClass: function(e) {
            var t = o.call(this), i = e.split(" "), n, r;
            if (t.tagName.toLowerCase() === "a") {
                for (r = 0; r < i.length; r += 1) {
                    t.classList.add(i[r]);
                }
            } else {
                t = t.getElementsByTagName("a");
                for (n = 0; n < t.length; n += 1) {
                    for (r = 0; r < i.length; r += 1) {
                        t[n].classList.add(i[r]);
                    }
                }
            }
        },
        createLink: function(e, t, i) {
            var n, r;
            if (e.value.trim().length === 0) {
                this.hideToolbarActions();
                return;
            }
            a.call(this, this.savedSelection);
            if (this.options.checkLinkFormat) {
                e.value = this.checkLinkFormat(e.value);
            }
            this.options.ownerDocument.execCommand("createLink", false, e.value);
            if (this.options.targetBlank || t === "_blank") {
                this.setTargetBlank();
            }
            if (i) {
                this.setButtonClass(i);
            }
            if (this.options.targetBlank || t === "_blank" || i) {
                r = this.options.ownerDocument.createEvent("HTMLEvents");
                r.initEvent("input", true, true, this.options.contentWindow);
                for (n = 0; n < this.elements.length; n += 1) {
                    this.elements[n].dispatchEvent(r);
                }
            }
            this.checkSelection();
            this.showToolbarActions();
            e.value = "";
        },
        bindWindowActions: function() {
            var t, i = this;
            this.windowResizeHandler = function() {
                clearTimeout(t);
                t = setTimeout(function() {
                    if (i.toolbar && i.toolbar.classList.contains("medium-editor-toolbar-active")) {
                        i.setToolbarPosition();
                    }
                }, 100);
            };
            if (this.options.staticToolbar && this.options.stickyToolbar) {
                e.addEventListener("scroll", function() {
                    if (i.toolbar && i.toolbar.classList.contains("medium-editor-toolbar-active")) {
                        i.setToolbarPosition();
                    }
                }, true);
            }
            this.on(this.options.contentWindow, "resize", this.windowResizeHandler);
            return this;
        },
        activate: function() {
            if (this.isActive) {
                return;
            }
            this.setup();
        },
        deactivate: function() {
            var e;
            if (!this.isActive) {
                return;
            }
            this.isActive = false;
            if (this.toolbar !== undefined) {
                this.options.elementsContainer.removeChild(this.anchorPreview);
                this.options.elementsContainer.removeChild(this.toolbar);
                delete this.toolbar;
                delete this.anchorPreview;
            }
            for (e = 0; e < this.elements.length; e += 1) {
                this.elements[e].removeAttribute("contentEditable");
                this.elements[e].removeAttribute("data-medium-element");
            }
            this.removeAllEvents();
        },
        htmlEntities: function(e) {
            return String(e).replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;");
        },
        bindPaste: function() {
            var t, i = this;
            this.pasteWrapper = function(t) {
                var n, r = "", a, o = "text/html", s = "text/plain";
                this.classList.remove("medium-editor-placeholder");
                if (!i.options.forcePlainText && !i.options.cleanPastedHTML) {
                    return this;
                }
                if (e.clipboardData && t.clipboardData === undefined) {
                    t.clipboardData = e.clipboardData;
                    o = "Text";
                    s = "Text";
                }
                if (t.clipboardData && t.clipboardData.getData && !t.defaultPrevented) {
                    t.preventDefault();
                    if (i.options.cleanPastedHTML && t.clipboardData.getData(o)) {
                        return i.cleanPaste(t.clipboardData.getData(o));
                    }
                    if (!(i.options.disableReturn || this.getAttribute("data-disable-return"))) {
                        n = t.clipboardData.getData(s).split(/[\r\n]/g);
                        for (a = 0; a < n.length; a += 1) {
                            if (n[a] !== "") {
                                if (navigator.userAgent.match(/firefox/i) && a === 0) {
                                    r += i.htmlEntities(n[a]);
                                } else {
                                    r += "<p>" + i.htmlEntities(n[a]) + "</p>";
                                }
                            }
                        }
                        c(i.options.ownerDocument, r);
                    } else {
                        r = i.htmlEntities(t.clipboardData.getData(s));
                        c(i.options.ownerDocument, r);
                    }
                }
            };
            for (t = 0; t < this.elements.length; t += 1) {
                this.on(this.elements[t], "paste", this.pasteWrapper);
            }
            return this;
        },
        setPlaceholders: function() {
            var e, t = function(e) {
                if (!e.querySelector("img") && !e.querySelector("blockquote") && e.textContent.replace(/^\s+|\s+$/g, "") === "") {
                    e.classList.add("medium-editor-placeholder");
                }
            }, i = function(e) {
                this.classList.remove("medium-editor-placeholder");
                if (e.type !== "keypress") {
                    t(this);
                }
            };
            for (e = 0; e < this.elements.length; e += 1) {
                t(this.elements[e]);
                this.on(this.elements[e], "blur", i);
                this.on(this.elements[e], "keypress", i);
            }
            return this;
        },
        cleanPaste: function(e) {
            var t, i, n, r = this.getSelectionElement(), a = /<p|<br|<div/.test(e), o = [ [ new RegExp(/<[^>]*docs-internal-guid[^>]*>/gi), "" ], [ new RegExp(/<\/b>(<br[^>]*>)?$/gi), "" ], [ new RegExp(/<span class="Apple-converted-space">\s+<\/span>/g), " " ], [ new RegExp(/<br class="Apple-interchange-newline">/g), "<br>" ], [ new RegExp(/<span[^>]*(font-style:italic;font-weight:bold|font-weight:bold;font-style:italic)[^>]*>/gi), '<span class="replace-with italic bold">' ], [ new RegExp(/<span[^>]*font-style:italic[^>]*>/gi), '<span class="replace-with italic">' ], [ new RegExp(/<span[^>]*font-weight:bold[^>]*>/gi), '<span class="replace-with bold">' ], [ new RegExp(/&lt;(\/?)(i|b|a)&gt;/gi), "<$1$2>" ], [ new RegExp(/&lt;a\s+href=(&quot;|&rdquo;|&ldquo;||)([^&]+)(&quot;|&rdquo;|&ldquo;||)&gt;/gi), '<a href="$2">' ] ];
            for (t = 0; t < o.length; t += 1) {
                e = e.replace(o[t][0], o[t][1]);
            }
            if (a) {
                i = e.split("<br><br>");
                this.pasteHTML("<p>" + i.join("</p><p>") + "</p>");
                this.options.ownerDocument.execCommand("insertText", false, "\n");
                i = r.querySelectorAll("a,p,div,br");
                for (t = 0; t < i.length; t += 1) {
                    n = i[t];
                    switch (n.tagName.toLowerCase()) {
                      case "a":
                        if (this.options.targetBlank) {
                            this.setTargetBlank(n);
                        }
                        break;

                      case "p":
                      case "div":
                        this.filterCommonBlocks(n);
                        break;

                      case "br":
                        this.filterLineBreak(n);
                        break;
                    }
                }
            } else {
                this.pasteHTML(e);
            }
        },
        pasteHTML: function(e) {
            var t, i, n, r, a = this.options.ownerDocument.createDocumentFragment();
            a.appendChild(this.options.ownerDocument.createElement("body"));
            r = a.querySelector("body");
            r.innerHTML = e;
            this.cleanupSpans(r);
            t = r.querySelectorAll("*");
            for (n = 0; n < t.length; n += 1) {
                i = t[n];
                i.removeAttribute("class");
                i.removeAttribute("style");
                i.removeAttribute("dir");
                if (i.tagName.toLowerCase() === "meta") {
                    i.parentNode.removeChild(i);
                }
            }
            this.options.ownerDocument.execCommand("insertHTML", false, r.innerHTML.replace(/&nbsp;/g, " "));
        },
        isCommonBlock: function(e) {
            return e && (e.tagName.toLowerCase() === "p" || e.tagName.toLowerCase() === "div");
        },
        filterCommonBlocks: function(e) {
            if (/^\s*$/.test(e.textContent)) {
                e.parentNode.removeChild(e);
            }
        },
        filterLineBreak: function(e) {
            if (this.isCommonBlock(e.previousElementSibling)) {
                e.parentNode.removeChild(e);
            } else if (this.isCommonBlock(e.parentNode) && (e.parentNode.firstChild === e || e.parentNode.lastChild === e)) {
                e.parentNode.removeChild(e);
            } else if (e.parentNode.childElementCount === 1) {
                this.removeWithParent(e);
            }
        },
        removeWithParent: function(e) {
            if (e && e.parentNode) {
                if (e.parentNode.parentNode && e.parentNode.childElementCount === 1) {
                    e.parentNode.parentNode.removeChild(e.parentNode);
                } else {
                    e.parentNode.removeChild(e.parentNode);
                }
            }
        },
        cleanupSpans: function(e) {
            var t, i, n, r = e.querySelectorAll(".replace-with");
            for (t = 0; t < r.length; t += 1) {
                i = r[t];
                n = this.options.ownerDocument.createElement(i.classList.contains("bold") ? "b" : "i");
                if (i.classList.contains("bold") && i.classList.contains("italic")) {
                    n.innerHTML = "<i>" + i.innerHTML + "</i>";
                } else {
                    n.innerHTML = i.innerHTML;
                }
                i.parentNode.replaceChild(n, i);
            }
            r = e.querySelectorAll("span");
            for (t = 0; t < r.length; t += 1) {
                i = r[t];
                if (/^\s*$/.test()) {
                    i.parentNode.removeChild(i);
                } else {
                    i.parentNode.replaceChild(this.options.ownerDocument.createTextNode(i.textContent), i);
                }
            }
        }
    };
})(window, document);

define("Widget/textArea", [ "uiObject", "mustache", "../assets/js/lib/MediumEditor/1.9.13/MediumEditor" ], function(e, t, i) {
    return e.extend({
        initialize: function() {
            var e = this;
            this.config.container = this.config.container;
            var n = "", r = "";
            text = this.config.text, label = this.config.label || "", validity = this.config.validity || false, 
            width = "width: " + (typeof this.config.width !== "undefined" ? this.config.width : "auto");
            this.config.curValue = this.config.defaultValue;
            if (typeof this.config.styleList !== "undefined") {
                for (var a in this.config.styleList) {
                    r += a + ": " + this.config.styleList[a] + "; ";
                }
            }
            n += "picsioTextarea";
            if (this.config.title) {
                n += " " + this.config.title;
            }
            if (this.config.classList) {
                n += " " + this.config.classList.join(" ");
            }
            this.template = t.to_html([ '<div class="{{classList}}" style="{{styleList}}">', '<div class="labelPicsioTextarea">{{label}}</div>', '<div class="textAreaDiv" contenteditable="true">{{text}}</div>', "</div>" ].join(""), {
                text: text,
                width: width,
                classList: n,
                styleList: r,
                label: label
            });
            var o = this.render().find("div.textAreaDiv");
            this.elem = o;
            this.elem.on("input", function(t) {
                if (validity && validity.test(e.elem.val())) {
                    e.config.onChange && e.config.onChange(e.elem.val());
                } else {
                    console.log(false);
                }
            });
            this.config.wysiwyg && new i(o[0], {
                targetBlank: true
            });
            this.$el.on("keyup", ".textAreaDiv", this.removeSpanStyle.bind(this));
        },
        getValue: function() {
            return this.elem.html();
        },
        setValue: function(e) {
            return this.elem.html(e);
        },
        removeSpanStyle: function() {
            this.$el.find("[style]").each(function(e, t) {
                t.style.lineHeight = "";
                t.style.fontSize = "";
                t.getAttribute("style") === "" && t.removeAttribute("style");
            });
        }
    });
});

define("Widget/keywordsTextarea", [ "uiObject", "mustache" ], function(e, t) {
    return e.extend({
        separator: ",",
        templateKeyword: function() {
            return [ '<div class="keywordTextarea">', '<div class="removeKeywordTextarea icon_removeKeywordTextarea"></div>', '<div class="valueKeywordTextarea">{{value}}</div>', "</div>" ].join("");
        },
        initialize: function() {
            this.keywords = [];
            this.validators = [];
            var e = this, i = this.config.label || false, n = this.config.classList, r = this.config.placeholder ? this.config.placeholder : "", a = "";
            this.config.container = this.config.container;
            this.config.validations.each(function(t) {
                e.addValidator(t);
            });
            if (typeof this.config.styleList !== "undefined") {
                for (var o in this.config.styleList) {
                    a += o + ": " + this.config.styleList[o] + "; ";
                }
            }
            this.template = t.to_html([ '<div class="picsioKeywordsTextarea{{#classList}} {{.}}{{/classList}}" style="{{styleList}}">', '{{#label}}<div class="labelKeywordsTextarea">{{label}}</div>{{/label}}', '<label class="contentKeywordsTextarea">', '<textarea placeholder="{{placeholder}}"></textarea>', "</label>", "</div>" ].join(""), {
                label: i,
                classList: n,
                styleList: a,
                placeholder: r
            });
            this.render();
            this.$el.on("click", ".removeKeywordTextarea", this.remove.bind(this));
            var s = this.$el.find("textarea");
            s.on("keydown", function(t) {
                e.keydown.call(e, t);
            });
            s.on("paste", function(t) {
                setTimeout(function() {
                    var t = s.val();
                    var i = t.split(e.separator);
                    i = i.map(function(e) {
                        return e.trim();
                    });
                    e.pastedText(i);
                }, 0);
            });
            (this.config.keywords || []).each(this.add.bind(this));
        },
        pastedText: function(e) {
            e.each(this.addValidData.bind(this));
            var t = this.$el.find("textarea");
            var i = e.last();
            t.val(this.isValid(i) ? "" : i);
        },
        keydown: function(e) {
            var t = e.currentTarget.value, i = 13, n = 32, r = 188, a = [ i, n, r ];
            if (a.indexOf(e.keyCode) !== -1) {
                e.preventDefault();
                if (t) {
                    if (this.isValid(t)) {
                        this.add(t);
                        e.currentTarget.value = "";
                    } else {
                        console.log("not valid");
                    }
                }
            }
        },
        addValidData: function(e) {
            this.isValid(e) && this.add(e);
        },
        add: function(e) {
            if (this.keywords.indexOf(e) > -1) {
                return;
            }
            this.keywords.push(e);
            var i = t.to_html(this.templateKeyword(), {
                value: e
            });
            i = $(i);
            this.$el.find("textarea").before(i);
            this.$el.find("textarea").attr("placeholder", "");
            this.config.onAdd && this.config.onAdd(e, this.getValue());
        },
        clear: function() {
            this.keywords.length = 0;
            this.$el.find("textarea").val("");
            this.$el.find(".keywordTextarea").remove();
        },
        addItems: function(e) {
            var t = this;
            e.each(function(e) {
                t.add(e);
            });
        },
        remove: function(e) {
            var t = e.currentTarget.parentNode, i = t.querySelector(".valueKeywordTextarea").textContent, n = this.keywords.indexOf(i);
            n > -1 && this.keywords.splice(n, 1);
            t.remove();
            this.$el.find("textarea").select();
            this.config.onRemove && this.config.onRemove(i, this.getValue());
        },
        addLast: function() {
            var e = this.$el.find("textarea").val();
            if (typeof e === "string" && e.length) {
                this.isValid(e) && this.add(e);
            }
            this.$el.find("textarea").val("");
            return false;
        },
        getValue: function() {
            return this.keywords;
        },
        addValidator: function(e) {
            this.validators.push(e);
        },
        isValid: function(e) {
            var t = this, i = true;
            this.validators.each(function(n) {
                if (!n(e, t.getValue())) {
                    i = false;
                    return false;
                }
            });
            return i;
        }
    });
});

define("Widget/detailsBox", [ "uiObject", "mustache" ], function(e, t) {
    var i = e.extend({
        initialize: function() {
            var e = this, i = this.config.label, n = this.config.styleList, r = this.config.classList;
            var a = [];
            for (var o in n) {
                a.push({
                    key: o,
                    value: n[o]
                });
            }
            if (this.config.showContent) {
                r.push("showContentDetailsBox");
            }
            this.template = t.to_html('<div class="picsioDetailsBox{{#classList}} {{.}}{{/classList}}" style="{{#styleList}}{{key}}: {{value}};{{/styleList}}"><span class="labelDetailsBox"><span>{{label}}</span></span><div class="innerDetailsBox"></div></div>', {
                classList: r,
                styleList: a,
                label: i
            });
            var s = this.render();
            s.find(".labelDetailsBox").on("click", function() {
                s.toggleClass("showContentDetailsBox");
            });
        }
    });
    return i;
});

define("Widget/inputRadio", [ "uiObject", "mustache" ], function(e, t) {
    var i = e.extend({
        initialize: function() {
            var e = this, i = this.config.classList, n = "";
            list = this.config.list, name = this.config.name;
            this.config.container = this.config.customContainer || this.config.container;
            if (this.config.styleList) {
                for (style in this.config.styleList) {
                    n += style + ": " + this.config.styleList[style] + "; ";
                }
            }
            this.template = t.to_html([ "{{#list.length}}", '<div class="listPicsioInputRadio{{#classList}} {{.}}{{/classList}}" style="{{styleList}}">', "{{#list}}", '<div class="picsioInputRadio">', '<div class="innerPicsioInputRadio {{#checked}}checked{{/checked}}"  data-type="radio" data-name="{{name}}" data-value="{{value}}">', '<span class="iconPicsioInputRadio"></span>', '<span class="labelPicsioInputRadio">{{{label}}}</span>', "</div>", "</div>", "{{/list}}", "</div>", "{{/list.length}}" ].join(""), {
                classList: i,
                styleList: n,
                list: list,
                name: name
            });
            var r = this.$el = this.render(), a = r[0];
            r.find(".innerPicsioInputRadio").on("click", this.onClick.bind(this));
        },
        createTooltip: function() {
            this.config.list.each(function(e) {
                if (e.tooltip) {
                    var t = $('[data-type="radio"][data-value="' + e.value + '"]');
                    new Opentip(t, e.tooltip.title, {
                        tipJoint: e.tooltip.align || "top",
                        background: e.tooltip.background || "#000",
                        borderColor: e.tooltip.borderColor || "#000",
                        delay: e.tooltip.delay || null,
                        target: e.tooltip.target || true,
                        removeElementsOnHide: e.tooltip.removeElementsOnHide || true
                    });
                }
            });
        },
        onClick: function(e) {
            var t = e.currentTarget, i = this.config.list;
            for (var n = 0; n < i.length; n++) {
                i[n].checked = i[n].value === t.dataset.value ? true : false;
            }
            var r = document.querySelectorAll('[data-type="radio"][data-name="' + this.getName() + '"]');
            for (var n = 0; n < r.length; n++) {
                r[n].classList.remove("checked");
            }
            t.classList.add("checked");
            this.config.onChange && this.config.onChange(this.getValue());
        },
        getName: function() {
            return this.config.name;
        },
        getValue: function() {
            var e = document.querySelector('.checked[data-type="radio"][data-name="' + this.getName() + '"]');
            return e.dataset.value;
        },
        setValue: function(e) {
            var t = document.querySelectorAll('[data-type="radio"][data-name="' + this.getName() + '"]');
            for (var i = 0; i < t.length; i++) {
                t[i].classList.remove("checked");
            }
            var n = document.querySelector('[data-type="radio"][data-name="' + this.getName() + '"][data-value="' + e + '"]');
            n && n.classList.add("checked");
        },
        getCheckedEl: function() {
            var e = this.getValue();
            var t = $('[data-type="radio"][data-name="' + this.getName() + '"][data-value="' + e + '"]');
            return t;
        },
        destroy: function(e) {
            this.$el.remove();
        }
    });
    return i;
});

!function() {
    var e, t = function() {
        var e = /\-([a-z])/g, t = function(e, t) {
            return t.toUpperCase();
        };
        return function(i) {
            return i.replace(e, t);
        };
    }(), i = function(e, i) {
        var n, r, a, o, s, l;
        if (window.getComputedStyle ? n = window.getComputedStyle(e, null).getPropertyValue(i) : (r = t(i), 
        n = e.currentStyle ? e.currentStyle[r] : e.style[r]), "cursor" === i && (!n || "auto" === n)) for (a = e.tagName.toLowerCase(), 
        o = [ "a" ], s = 0, l = o.length; l > s; s++) if (a === o[s]) return "pointer";
        return n;
    }, n = function(e) {
        if (g.prototype._singleton) {
            e || (e = window.event);
            var t;
            this !== window ? t = this : e.target ? t = e.target : e.srcElement && (t = e.srcElement), 
            g.prototype._singleton.setCurrent(t);
        }
    }, r = function(e, t, i) {
        e.addEventListener ? e.addEventListener(t, i, !1) : e.attachEvent && e.attachEvent("on" + t, i);
    }, a = function(e, t, i) {
        e.removeEventListener ? e.removeEventListener(t, i, !1) : e.detachEvent && e.detachEvent("on" + t, i);
    }, o = function(e, t) {
        if (e.addClass) return e.addClass(t), e;
        if (t && "string" == typeof t) {
            var i = (t || "").split(/\s+/);
            if (1 === e.nodeType) if (e.className) {
                for (var n = " " + e.className + " ", r = e.className, a = 0, o = i.length; o > a; a++) n.indexOf(" " + i[a] + " ") < 0 && (r += " " + i[a]);
                e.className = r.replace(/^\s+|\s+$/g, "");
            } else e.className = t;
        }
        return e;
    }, s = function(e, t) {
        if (e.removeClass) return e.removeClass(t), e;
        if (t && "string" == typeof t || void 0 === t) {
            var i = (t || "").split(/\s+/);
            if (1 === e.nodeType && e.className) if (t) {
                for (var n = (" " + e.className + " ").replace(/[\n\t]/g, " "), r = 0, a = i.length; a > r; r++) n = n.replace(" " + i[r] + " ", " ");
                e.className = n.replace(/^\s+|\s+$/g, "");
            } else e.className = "";
        }
        return e;
    }, l = function() {
        var e, t, i, n = 1;
        return "function" == typeof document.body.getBoundingClientRect && (e = document.body.getBoundingClientRect(), 
        t = e.right - e.left, i = document.body.offsetWidth, n = Math.round(100 * (t / i)) / 100), 
        n;
    }, c = function(e) {
        var t = {
            left: 0,
            top: 0,
            width: 0,
            height: 0,
            zIndex: 999999999
        }, n = i(e, "z-index");
        if (n && "auto" !== n && (t.zIndex = parseInt(n, 10)), e.getBoundingClientRect) {
            var r, a, o, s = e.getBoundingClientRect();
            "pageXOffset" in window && "pageYOffset" in window ? (r = window.pageXOffset, a = window.pageYOffset) : (o = l(), 
            r = Math.round(document.documentElement.scrollLeft / o), a = Math.round(document.documentElement.scrollTop / o));
            var c = document.documentElement.clientLeft || 0, u = document.documentElement.clientTop || 0;
            t.left = s.left + r - c, t.top = s.top + a - u, t.width = "width" in s ? s.width : s.right - s.left, 
            t.height = "height" in s ? s.height : s.bottom - s.top;
        }
        return t;
    }, u = function(e, t) {
        var i = !(t && t.useNoCache === !1);
        return i ? (-1 === e.indexOf("?") ? "?" : "&") + "nocache=" + new Date().getTime() : "";
    }, f = function(e) {
        var t = [], i = [];
        return e.trustedOrigins && ("string" == typeof e.trustedOrigins ? i.push(e.trustedOrigins) : "object" == typeof e.trustedOrigins && "length" in e.trustedOrigins && (i = i.concat(e.trustedOrigins))), 
        e.trustedDomains && ("string" == typeof e.trustedDomains ? i.push(e.trustedDomains) : "object" == typeof e.trustedDomains && "length" in e.trustedDomains && (i = i.concat(e.trustedDomains))), 
        i.length && t.push("trustedOrigins=" + encodeURIComponent(i.join(","))), "string" == typeof e.amdModuleId && e.amdModuleId && t.push("amdModuleId=" + encodeURIComponent(e.amdModuleId)), 
        "string" == typeof e.cjsModuleId && e.cjsModuleId && t.push("cjsModuleId=" + encodeURIComponent(e.cjsModuleId)), 
        t.join("&");
    }, d = function(e, t) {
        if (t.indexOf) return t.indexOf(e);
        for (var i = 0, n = t.length; n > i; i++) if (t[i] === e) return i;
        return -1;
    }, h = function(e) {
        if ("string" == typeof e) throw new TypeError("ZeroClipboard doesn't accept query strings.");
        return e.length ? e : [ e ];
    }, p = function(e, t, i, n, r) {
        r ? window.setTimeout(function() {
            e.call(t, i, n);
        }, 0) : e.call(t, i, n);
    }, g = function(e, t) {
        if (e && (g.prototype._singleton || this).glue(e), g.prototype._singleton) return g.prototype._singleton;
        g.prototype._singleton = this, this.options = {};
        for (var i in y) this.options[i] = y[i];
        for (var n in t) this.options[n] = t[n];
        this.handlers = {}, g.detectFlashSupport() && C();
    }, m = [];
    g.prototype.setCurrent = function(t) {
        e = t, this.reposition();
        var n = t.getAttribute("title");
        n && this.setTitle(n);
        var r = this.options.forceHandCursor === !0 || "pointer" === i(t, "cursor");
        return v.call(this, r), this;
    }, g.prototype.setText = function(e) {
        return e && "" !== e && (this.options.text = e, this.ready() && this.flashBridge.setText(e)), 
        this;
    }, g.prototype.setTitle = function(e) {
        return e && "" !== e && this.htmlBridge.setAttribute("title", e), this;
    }, g.prototype.setSize = function(e, t) {
        return this.ready() && this.flashBridge.setSize(e, t), this;
    }, g.prototype.setHandCursor = function(e) {
        return e = "boolean" == typeof e ? e : !!e, v.call(this, e), this.options.forceHandCursor = e, 
        this;
    };
    var v = function(e) {
        this.ready() && this.flashBridge.setHandCursor(e);
    };
    g.version = "1.2.3";
    var y = {
        moviePath: "ZeroClipboard.swf",
        trustedOrigins: null,
        text: null,
        hoverClass: "zeroclipboard-is-hover",
        activeClass: "zeroclipboard-is-active",
        allowScriptAccess: "sameDomain",
        useNoCache: !0,
        forceHandCursor: !1
    };
    g.setDefaults = function(e) {
        for (var t in e) y[t] = e[t];
    }, g.destroy = function() {
        g.prototype._singleton.unglue(m);
        var e = g.prototype._singleton.htmlBridge;
        e.parentNode.removeChild(e), delete g.prototype._singleton;
    }, g.detectFlashSupport = function() {
        var e = !1;
        if ("function" == typeof ActiveXObject) try {
            new ActiveXObject("ShockwaveFlash.ShockwaveFlash") && (e = !0);
        } catch (t) {}
        return !e && navigator.mimeTypes["application/x-shockwave-flash"] && (e = !0), e;
    };
    var b = null, w = null, C = function() {
        var e, t, i = g.prototype._singleton, n = document.getElementById("global-zeroclipboard-html-bridge");
        if (!n) {
            var r = {};
            for (var a in i.options) r[a] = i.options[a];
            r.amdModuleId = b, r.cjsModuleId = w;
            var o = f(r), s = '      <object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" id="global-zeroclipboard-flash-bridge" width="100%" height="100%">         <param name="movie" value="' + i.options.moviePath + u(i.options.moviePath, i.options) + '"/>         <param name="allowScriptAccess" value="' + i.options.allowScriptAccess + '"/>         <param name="scale" value="exactfit"/>         <param name="loop" value="false"/>         <param name="menu" value="false"/>         <param name="quality" value="best" />         <param name="bgcolor" value="#ffffff"/>         <param name="wmode" value="transparent"/>         <param name="flashvars" value="' + o + '"/>         <embed src="' + i.options.moviePath + u(i.options.moviePath, i.options) + '"           loop="false" menu="false"           quality="best" bgcolor="#ffffff"           width="100%" height="100%"           name="global-zeroclipboard-flash-bridge"           allowScriptAccess="always"           allowFullScreen="false"           type="application/x-shockwave-flash"           wmode="transparent"           pluginspage="http://www.macromedia.com/go/getflashplayer"           flashvars="' + o + '"           scale="exactfit">         </embed>       </object>';
            n = document.createElement("div"), n.id = "global-zeroclipboard-html-bridge", n.setAttribute("class", "global-zeroclipboard-container"), 
            n.setAttribute("data-clipboard-ready", !1), n.style.position = "absolute", n.style.left = "-9999px", 
            n.style.top = "-9999px", n.style.width = "15px", n.style.height = "15px", n.style.zIndex = "9999", 
            n.innerHTML = s, document.body.appendChild(n);
        }
        i.htmlBridge = n, e = document["global-zeroclipboard-flash-bridge"], e && (t = e.length) && (e = e[t - 1]), 
        i.flashBridge = e || n.children[0].lastElementChild;
    };
    g.prototype.resetBridge = function() {
        return this.htmlBridge.style.left = "-9999px", this.htmlBridge.style.top = "-9999px", 
        this.htmlBridge.removeAttribute("title"), this.htmlBridge.removeAttribute("data-clipboard-text"), 
        s(e, this.options.activeClass), e = null, this.options.text = null, this;
    }, g.prototype.ready = function() {
        var e = this.htmlBridge.getAttribute("data-clipboard-ready");
        return "true" === e || e === !0;
    }, g.prototype.reposition = function() {
        if (!e) return !1;
        var t = c(e);
        return this.htmlBridge.style.top = t.top + "px", this.htmlBridge.style.left = t.left + "px", 
        this.htmlBridge.style.width = t.width + "px", this.htmlBridge.style.height = t.height + "px", 
        this.htmlBridge.style.zIndex = t.zIndex + 1, this.setSize(t.width, t.height), this;
    }, g.dispatch = function(e, t) {
        g.prototype._singleton.receiveEvent(e, t);
    }, g.prototype.on = function(e, t) {
        for (var i = e.toString().split(/\s/g), n = 0; n < i.length; n++) e = i[n].toLowerCase().replace(/^on/, ""), 
        this.handlers[e] || (this.handlers[e] = t);
        return this.handlers.noflash && !g.detectFlashSupport() && this.receiveEvent("onNoFlash", null), 
        this;
    }, g.prototype.addEventListener = g.prototype.on, g.prototype.off = function(e, t) {
        for (var i = e.toString().split(/\s/g), n = 0; n < i.length; n++) {
            e = i[n].toLowerCase().replace(/^on/, "");
            for (var r in this.handlers) r === e && this.handlers[r] === t && delete this.handlers[r];
        }
        return this;
    }, g.prototype.removeEventListener = g.prototype.off, g.prototype.receiveEvent = function(t, i) {
        t = t.toString().toLowerCase().replace(/^on/, "");
        var n = e, r = !0;
        switch (t) {
          case "load":
            if (i && parseFloat(i.flashVersion.replace(",", ".").replace(/[^0-9\.]/gi, "")) < 10) return this.receiveEvent("onWrongFlash", {
                flashVersion: i.flashVersion
            }), void 0;
            this.htmlBridge.setAttribute("data-clipboard-ready", !0);
            break;

          case "mouseover":
            o(n, this.options.hoverClass);
            break;

          case "mouseout":
            s(n, this.options.hoverClass), this.resetBridge();
            break;

          case "mousedown":
            o(n, this.options.activeClass);
            break;

          case "mouseup":
            s(n, this.options.activeClass);
            break;

          case "datarequested":
            var a = n.getAttribute("data-clipboard-target"), l = a ? document.getElementById(a) : null;
            if (l) {
                var c = l.value || l.textContent || l.innerText;
                c && this.setText(c);
            } else {
                var u = n.getAttribute("data-clipboard-text");
                u && this.setText(u);
            }
            r = !1;
            break;

          case "complete":
            this.options.text = null;
        }
        if (this.handlers[t]) {
            var f = this.handlers[t];
            "string" == typeof f && "function" == typeof window[f] && (f = window[f]), "function" == typeof f && p(f, n, this, i, r);
        }
    }, g.prototype.glue = function(e) {
        e = h(e);
        for (var t = 0; t < e.length; t++) -1 == d(e[t], m) && (m.push(e[t]), r(e[t], "mouseover", n));
        return this;
    }, g.prototype.unglue = function(e) {
        e = h(e);
        for (var t = 0; t < e.length; t++) {
            a(e[t], "mouseover", n);
            var i = d(e[t], m);
            -1 != i && m.splice(i, 1);
        }
        return this;
    }, "function" == typeof define && define.amd ? define("zeroClipboard", [ "require", "exports", "module" ], function(e, t, i) {
        return b = i && i.id || null, g;
    }) : "object" == typeof module && module && "object" == typeof module.exports && module.exports ? (w = module.id || null, 
    module.exports = g) : window.ZeroClipboard = g;
}();

define("Widget/copyToClipboard", [ "uiObject", "mustache", "zeroClipboard" ], function(e, t, i) {
    var n = e.extend({
        initialize: function() {
            var e = this, n = this.config.styleList, r = this.config.classList, a = this.config.label || "Copy", o = this.config.disabled;
            var s = [];
            for (var l in n) {
                s.push({
                    key: l,
                    value: n[l]
                });
            }
            this.template = t.to_html('<div class="copyToClipboard{{#classList}} {{.}}{{/classList}} {{#disabled}}disabled{{/disabled}}" style="{{#styleList}}{{key}}: {{value}};{{/styleList}}">{{label}}</div>', {
                classList: r,
                styleList: s,
                label: a,
                disabled: o
            });
            this.$el = this.render();
            var c = new i(this.$el, {
                moviePath: "assets/js/lib/zeroclipboard/1.2.3/ZeroClipboard.swf"
            });
            c.on("dataRequested", function(t, i) {
                if (e.isEnabled()) {
                    var n = document.querySelector(e.config.elForCopy);
                    if (n) {
                        t.setText(n.value);
                        e.animateLink(n, n.value);
                    }
                }
            });
        },
        animateLink: function(e, t) {
            var i = document.createElement("span");
            i.textContent = t;
            i.classList.add("animateLink");
            var n = this.config.classAnimateEl;
            if (n) {
                for (var r = 0; r < n.length; r++) {
                    i.classList.add(n[r]);
                }
            }
            e.parentNode.insertBefore(i, e.nextSibling);
            i.classList.add("copied");
            setTimeout(function() {
                i.remove();
            }, 3e3);
        },
        enable: function() {
            this.$el.removeClass("disabled");
        },
        disable: function() {
            this.$el.addClass("disabled");
        },
        isEnabled: function() {
            var e = this.$el.hasClass("disabled") ? false : true;
            return e;
        }
    });
    return n;
});

define("Widget/toolbox", [ "utils", "uiObject", "mustache" ], function(e, t, i) {
    var n = t.extend({
        initialize: function() {
            var e = this;
            this.tabsList = {};
            this.template = i.to_html([ '<div class="picsioToolbox {{classList}}">', '<div class="toolboxNavigation">', "<ul>", "</ul>", "</div>", '<div class="toolboxWrapperContents">', "</div>", "</div>" ].join(""), {
                classList: this.config.classList ? this.config.classList.join(" ") : ""
            });
            this.render();
            this.addTabs(this.config.tabs);
        },
        addTabs: function(e) {
            var t = this;
            if (this.config.partialRender) {
                e.each(function(e, i) {
                    t.config.partialRender.indexOf(i) !== -1 && t.addTab(e, i);
                });
            } else {
                e.each(function(e, i) {
                    t.addTab(e, i);
                });
            }
        },
        addTab: function(e, t) {
            !e.items && (e.items = []);
            this._generateTabBtn(e, t);
            this._generateTabContent(e);
            this._checkActTab();
        },
        showTab: function(e) {
            var t = this.getContainer();
            var i = t.querySelector(".toolboxNavigation .act");
            i && i.classList.remove("act");
            e.classList.add("act");
        },
        showContent: function(e) {
            var t = this.getContainer();
            var i = t.querySelector(".toolboxWrapperContents .toolboxSingleContent.act");
            i && i.classList.remove("act");
            e.classList.add("act");
        },
        _checkActTab: function() {
            var e = this.getContainer(), t = e.querySelector(".toolboxNavigation .act");
            if (!t) {
                e.querySelectorAll(".toolboxNavigation li")[0].classList.add("act");
                e.querySelectorAll(".toolboxWrapperContents .toolboxSingleContent")[0].classList.add("act");
            }
        },
        _generateTabBtn: function(e, t) {
            var i = this, n = document.createElement("li"), r = document.createElement("span");
            r.innerHTML = e.titleNavigation;
            r.classList.add("toolboxNavigationItem");
            n.appendChild(r);
            n.addEventListener("click", function() {
                i.tabClick(this, t);
            }, false);
            this.getContainer().querySelector(".toolboxNavigation ul").appendChild(n);
            i.tabsList[e.id] = {
                btn: n
            };
            e.active && this.showTab(n);
        },
        _generateTabContent: function(e) {
            var t = document.createElement("div");
            t.classList.add("toolboxSingleContent");
            e.titleContent && (t.innerHTML = '<span class="toolboxSingleContentTitle">' + e.titleContent + "</span>");
            this.getContainer().querySelector(".toolboxWrapperContents").appendChild(t);
            this._generateTabItems(t, e);
            e.active && this.showContent(t);
        },
        _generateTabItems: function(e, t) {
            var i = this;
            var n = i.tabsList[t.id];
            t.items.forEach(function(t, i) {
                t.config.container = e;
                var r = new t.item(t.config);
                n[t.config.id] = r;
            });
        },
        tabClick: function(e, t) {
            var i = this.getContainer(), n = i.querySelector(".toolboxNavigation .act"), r = i.querySelector(".toolboxWrapperContents .toolboxSingleContent.act"), a = e, o = i.querySelectorAll(".toolboxWrapperContents .toolboxSingleContent")[t];
            n && n.classList.remove("act");
            r && r.classList.remove("act");
            a && a.classList.add("act");
            o && o.classList.add("act");
        },
        getContainer: function() {
            return this.config.container.find(".picsioToolbox")[0];
        },
        getTab: function(e) {
            var t = this.tabsList[e];
            return {
                getItem: function(e) {
                    return t ? t[e] : false;
                },
                setHighlight: function() {
                    if (!t) return false;
                    t.btn.classList.add("highlight");
                },
                unsetHighlight: function() {
                    if (!t) return false;
                    t.btn.classList.remove("highlight");
                }
            };
        }
    });
    return n;
});

define("Widget/filmStrip", [ "uiObject", "mustache", "Spinner" ], function(e, t, i) {
    var n = [ '<div class="someImgScrollbar" data-uid="{{uid}}">', '<span class="numberImgScrollbar"></span>', '<span class="titleImgScrollbar">{{title}}</span>', "<span></span>", "</span>", '<span class="removeImgScrollbar"></span>', '<span class="textBottom"></span>', '<div class="renderPreviewImg" style="background-image: url(\'{{url}}\'); background-size:40px;"></div>', "</div>" ].join("");
    var r = "/assets/img/loading.yellow.gif";
    var a = e.extend({
        spiners: {},
        initialize: function() {
            var e = this;
            this.template = t.to_html('<div class="imagesScrollBar"></div>');
            this.render();
            this.$el.on("click", ".renderPreviewImg", function(t) {
                var i = $(t.target).parent();
                var n = i.data("uid");
                e.select(n, true);
            });
            this.$el.on("click", ".removeImgScrollbar", function(t) {
                var i = $(t.currentTarget).parent();
                var n = i.data("uid");
                if (i.hasClass("act")) {}
                i.remove();
                e.publish("filmStrip:removed", n);
            });
        },
        getSelectedItem: function() {
            return $(".imagesScrollBar .someImgScrollbar.act");
        },
        addItems: function(e) {
            var t = this;
            e.forEach(function(e) {
                t.addItem(e);
            });
        },
        addItem: function(e) {
            var i = this.config.container.find(".imagesScrollBar");
            if (!e.url) {
                e.url = r;
            }
            i.append(t.to_html(n, e));
        },
        updateItem: function(e) {
            var t = this.config.container.find(".imagesScrollBar");
            var i = $('.someImgScrollbar[data-uid="' + e.uid + '"]');
            var n = i.find(".renderPreviewImg");
            if (e.url) {
                n.css("background-image", "url(" + e.url + ")");
                n.css("background-size", "contain");
            }
            if (e.bottomText) i.find(".textBottom").text(e.bottomText);
            if (e.title) i.find(".titleImgScrollbar").text(e.title);
        },
        select: function(e, t) {
            var i = $('.someImgScrollbar[data-uid="' + e + '"]');
            $(".imagesScrollBar .someImgScrollbar").removeClass("act");
            i.addClass("act");
            if (t) this.publish("filmStrip:selected", i.data("uid"));
        },
        highlight: function(e) {
            if (e) {
                $(".imagesScrollBar").addClass("highlight");
            } else {
                $(".imagesScrollBar").removeClass("highlight");
            }
        },
        setSpinner: function(e, t) {
            var n = $('.someImgScrollbar[data-uid="' + e + '"]');
            if (!this.spiners[e]) {
                this.spiners[e] = new i({
                    parentEl: n,
                    text: t || "",
                    classList: [ "partial", "spinnerItemFilmStrip" ]
                });
            } else {
                this.updateSpinnerText(e, t);
            }
        },
        updateSpinnerText: function(e, t) {
            this.spiners[e] && this.spiners[e].setText(t);
        },
        destroySpinner: function(e) {
            if (this.spiners[e] && this.spiners[e].destroy) {
                this.spiners[e].destroy();
                delete this.spiners[e];
            }
        }
    });
    return a;
});

define("Widget/helpButton", [ "uiObject", "mustache" ], function(e, t) {
    var i = e.extend({
        initialize: function() {
            var e = this;
            var i = this.config.styleList, n = [];
            for (var r in i) {
                n.push({
                    key: r,
                    value: i[r]
                });
            }
            this.template = t.to_html([ '<div class="picsioHelpButton {{position}}{{#classList}} {{.}}{{/classList}}" style="{{#styleList}}{{key}}: {{value}};{{/styleList}}">', '<div class="picsioHelpButtonIcon">?</div>', '<div class="picsioHelpButtonPopup">', '<div class="picsioHelpButtonInnerPopup">', "{{{text}}}", "</div>", "</div>", "</div>" ].join(""), {
                text: this.config.text,
                classList: this.config.classList,
                styleList: n,
                position: this.config.position || "bottom"
            });
            this.render();
            this.el.addEventListener("mouseover", this.mouseover.bind(this), false);
            this.el.addEventListener("mouseleave", this.mouseleave.bind(this), false);
        },
        mouseover: function() {
            this.el.classList.add("showPopup");
        },
        mouseleave: function() {
            this.el.classList.remove("showPopup");
        },
        setValue: function(e) {
            return this.$el.find(".popupPicsioAsk").html(e);
        }
    });
    return i;
});

define("Widget/horizontalSelect", [ "uiObject", "mustache" ], function(e, t) {
    var i;
    var n = e.extend({
        templateItem: [ '<div class="item" data-value="{{value}}" style="width: {{width}}px;">', '{{#title}}<span class="title">{{title}}</span>{{/title}}', '{{#img}}<div class="img"><img src="{{img}}" /></div>{{/img}}', '{{#description}}<span class="description">{{description}}</span>{{/description}}', '{{#example}}<span class="example"><a href="{{example}}" target="_blank">Live Preview</a></span>{{/example}}', "</div>" ].join(""),
        initialize: function() {
            var e = i = this, n = "";
            if (this.config.styleList) {
                for (style in this.config.styleList) {
                    n += " " + style + ": " + this.config.styleList[style] + ";";
                }
            }
            this.template = t.to_html([ '<div class="picsioHorizontalSelect {{#classList}}{{.}} {{/classList}}" style="{{styleList}}">', '{{#label}}<span class="label">{{label}}</span>{{/label}}', '<div class="container">', '<div class="inner">', "</div>", '<div class="arrowPrev icon_regularPrevArrow"></div>', '<div class="arrowNext icon_regularNextArrow"></div>', "</div>", "</div>" ].join(""), {
                classList: this.config.classList,
                styleList: n,
                label: this.config.label
            });
            this.initialArrows();
            this.render();
            this.bindEvent();
        },
        bindEvent: function() {
            this.$el.find(".arrowPrev").on("click", this.onClickArrowPrev.bind(this));
            this.$el.find(".arrowNext").on("click", this.onClickArrowNext.bind(this));
        },
        addOptions: function(e, t) {
            for (var i = 0; i < e.length; i++) {
                this.addOption(e[i]);
            }
        },
        addOption: function(e) {
            e.width = this.$el.find(".inner").width();
            var i = $(t.to_html(this.templateItem, e));
            this.$el.find(".inner").append(i);
            this.$el.find(".inner .item").index(i) === 0 && i.addClass("act");
            this.arrows.next.show();
        },
        onClickArrowPrev: function() {
            var e = this.getCheckedEl().prev().data().value;
            this.setValue(e);
            this.config && this.config.callback && this.config.callback(this.getValue());
        },
        onClickArrowNext: function() {
            var e = this.getCheckedEl().next().data().value;
            this.setValue(e);
            this.config && this.config.callback && this.config.callback(this.getValue());
        },
        setValue: function(e) {
            this.$el.find(".item").removeClass("act");
            var t = this.$el.find('[data-value="' + e + '"]');
            t.addClass("act");
            t.parent().css({
                "margin-left": -t.position().left
            });
            this.arrows.hide();
            t.prev().length && this.arrows.prev.show();
            t.next().length && this.arrows.next.show();
        },
        initialArrows: function() {
            this.arrows = {
                prev: {
                    show: function() {
                        i.$el.find(".arrowPrev").css({
                            display: "block"
                        });
                    },
                    hide: function() {
                        i.$el.find(".arrowPrev").css({
                            display: "none"
                        });
                    }
                },
                next: {
                    show: function() {
                        i.$el.find(".arrowNext").css({
                            display: "block"
                        });
                    },
                    hide: function() {
                        i.$el.find(".arrowNext").css({
                            display: "none"
                        });
                    }
                },
                show: function() {
                    this.prev.show();
                    this.next.show();
                },
                hide: function() {
                    this.prev.hide();
                    this.next.hide();
                }
            };
        },
        getValue: function() {
            return this.$el.find(".item.act").data().value;
        },
        getCheckedEl: function() {
            return this.$el.find(".item.act");
        }
    });
    return n;
});

define("Widget/index.raw", [ "require", "./button", "./canvas", "./checkbox", "./colorPickerBox", "./confirmationDialog", "./dialog", "./dialogButton", "./gradientFilter", "./hr", "./inputFile", "./inputRange", "./inputText", "./menu", "./select", "./tabControl", "./text", "./toggle", "./toolbar", "./ui", "./dialogList", "./html", "./textArea", "./keywordsTextarea", "./detailsBox", "./inputRadio", "./copyToClipboard", "./toolbox", "./filmStrip", "./helpButton", "./horizontalSelect" ], function(e) {
    return {
        Button: e("./button"),
        CanvasUi: e("./canvas"),
        CheckBox: e("./checkbox"),
        ColorPickerBox: e("./colorPickerBox"),
        ConfirmationDialog: e("./confirmationDialog"),
        Dialog: e("./dialog"),
        DialogButton: e("./dialogButton"),
        GradientFilter: e("./gradientFilter"),
        Hr: e("./hr"),
        InputFile: e("./inputFile"),
        InputRange: e("./inputRange"),
        InputText: e("./inputText"),
        Menu: e("./menu"),
        Select: e("./select"),
        TabControl: e("./tabControl"),
        Text: e("./text"),
        Toggle: e("./toggle"),
        Toolbar: e("./toolbar"),
        UI: e("./ui"),
        DialogList: e("./dialogList"),
        Html: e("./html"),
        Textarea: e("./textArea"),
        KeywordsTextarea: e("./keywordsTextarea"),
        DetailsBox: e("./detailsBox"),
        InputRadio: e("./inputRadio"),
        CopyToClipboard: e("./copyToClipboard"),
        Toolbox: e("./toolbox"),
        FilmStrip: e("./filmStrip"),
        HelpButton: e("./helpButton"),
        HorizontalSelect: e("./horizontalSelect")
    };
});

define("Widget", [ "Widget/index.raw" ], function(e) {
    return e;
});

define("privateBrowsingDetector", [], function() {
    function e(e, t) {
        var i = 0, n = 50, r = 10, a = false;
        var o = window.setInterval(function() {
            if (e()) {
                window.clearInterval(o);
                t(a);
            }
            if (i++ > n) {
                window.clearInterval(o);
                a = true;
                t(a);
            }
        }, 10);
    }
    function t(e) {
        var t = e.toLowerCase();
        if (t.indexOf("msie") === 0 && t.indexOf("trident") === 0) {
            return false;
        }
        var i = /(?:msie|rv:)\s?([\d\.]+)/.exec(t);
        if (i && parseInt(i[1], 10) >= 10) {
            return true;
        }
        return false;
    }
    function i(i) {
        var n;
        if (window.webkitRequestFileSystem) {
            window.webkitRequestFileSystem(window.TEMPORARY, 1, function() {
                n = false;
            }, function(e) {
                console.log(e);
                n = true;
            });
        } else if (window.indexedDB && /Firefox/.test(window.navigator.userAgent)) {
            var r;
            try {
                r = window.indexedDB.open("test");
            } catch (a) {
                n = true;
            }
            if (typeof n === "undefined") {
                e(function o() {
                    return r.readyState === "done" ? true : false;
                }, function s(e) {
                    if (!e) {
                        n = r.result ? false : true;
                    }
                });
            }
        } else if (t(window.navigator.userAgent)) {
            n = false;
            try {
                if (!window.indexedDB) {
                    n = true;
                }
            } catch (a) {
                n = true;
            }
        } else if (window.localStorage && /Safari/.test(window.navigator.userAgent)) {
            try {
                window.localStorage.setItem("test", 1);
            } catch (a) {
                n = true;
            }
            if (typeof n === "undefined") {
                n = false;
                window.localStorage.removeItem("test");
            }
        }
        e(function l() {
            return typeof n !== "undefined" ? true : false;
        }, function c(e) {
            i(n);
        });
    }
    return {
        detect: i
    };
});

define("/assets/js/lib/gapi.js", [ "require" ], function(e) {
    var t = [];
    var i = function(e, i) {
        var n = this;
        var r = t.filter(function(t) {
            return t.name === e;
        });
        if (!r.length) return;
        r.forEach(function(e) {
            e.fn.call(n, i);
        });
    };
    return {
        init: function(t) {
            if (!(t && t.scopes && t.clientId)) {
                console.error("params.scopes and params.clientId is required");
                return;
            }
            this.config = t;
            var i = this;
            if (typeof gapi !== "undefined") {
                return this._loadApis();
            }
            e([ "https://apis.google.com/js/client.js?onload=define" ], function() {
                function e() {
                    if (gapi && gapi.client) {
                        i._loadApis();
                    } else {
                        setTimeout(e, 100);
                    }
                }
                e();
            });
        },
        _loadApis: function() {
            gapi.client.load("drive", "v2", function() {
                i("inited");
            });
        },
        authorize: function(e) {
            function t(e) {
                if (e && e.error) {
                    console.error("Unable to sign in:", e.error);
                }
                i("authorized", {
                    authorized: e && !e.error
                });
            }
            gapi.auth.authorize({
                client_id: this.config.clientId,
                scope: this.config.scopes,
                immediate: false,
                authuser: -1
            }, t);
        },
        on: function(e, i) {
            t.push({
                name: e,
                fn: i
            });
        }
    };
});

define("MetadataComponent/templates/index", [], function() {
    return [ '<div class="moduleMultiSetting">', '{{#isPending}}<div class="statusMetadataParser">Pending</div>{{/isPending}}', '{{#title}}<div class="title-moduleMultiSetting"><span>{{title}}</span></div>{{/title}}', '<div class="content-moduleMultiSetting">', "{{#textMetadata.length}}", '<div class="textMetadata">', "{{#textMetadata}}", '<div class="itemMetadata">', '<span class="keyMetadataItem"><span>{{name}}:</span></span>', '<span class="valueMetadataItem">{{value}}</span>', "</div>", "{{/textMetadata}}", "</div>", "{{/textMetadata.length}}", "{{#iconMetadata.length}}", '<div class="iconMetadata">', "{{#iconMetadata}}", '<div class="itemMetadata metadata{{name}}">', '<span class="keyMetadataItem"></span>', '<span class="valueMetadataItem">{{value}}</span>', "</div>", "{{/iconMetadata}}", "</div>", "{{/iconMetadata.length}}", "</div>", "</div>" ].join("");
});

define("MetadataComponent/views/index", [ "backbone", "mustache", "../templates/index", "Spinner", "q", "TrackingService" ], function(e, t, i, n, r, a) {
    return e.View.extend({
        className: "metadataView",
        params: {
            title: null,
            filter: [],
            parentEl: null,
            model: null
        },
        events: {
            "click .btnAutofill": "autofill"
        },
        initialize: function(e) {
            Object.merge(this.params, e);
            this.render(e.data);
        },
        render: function(e) {
            var n = this.filterData(e.text || {}, this.params.filter, false);
            var r = this.filterData(e.icon || {}, this.params.filter, true);
            var a = this.params.model;
            var o = a && (a.get("parsing") === "waiting" || a.get("parsing") === "running");
            this.$el.html(t.to_html(i, {
                title: this.params.title,
                textMetadata: n,
                iconMetadata: r,
                showAutofill: !!a,
                isPending: o
            }));
            this.params.parentEl.html(this.$el);
        },
        filterData: function(e, t, i) {
            var n = [];
            for (var r in e) {
                if (!t.length || t.some(r)) {
                    n.push({
                        name: i ? r.replace(" ", "").capitalize() : r.spacify().capitalize(true),
                        value: e[r]
                    });
                }
            }
            return n;
        },
        autofill: function() {
            a.push("Photo", "FillMetadata");
            var e = new n({
                parentEl: this.params.parentEl,
                classList: [ "partial" ],
                title: "Reading metadata"
            });
            var t = "/images/{1}/metadata/".assign(this.params.model.get("_id"));
            r($.getJSON(t)).then(function(t) {
                e.destroy();
                this.render({
                    text: t.data
                });
                this.model && this.model.set("meta", t.data);
            }.bind(this)).fail(function(t) {
                e.destroy();
                console.error(t);
            });
        },
        show: function() {
            this.$el.show();
        },
        hide: function() {
            this.$el.hide();
        },
        destroy: function() {
            this.undelegateEvents();
            this.$el.removeData().unbind();
            this.remove();
            e.View.prototype.remove.call(this);
        }
    });
});

define("MetadataComponent/index", [ "./views/index" ], function(e) {
    return function(t) {
        var i = new e(t);
        return {
            render: i.render.bind(i),
            show: i.show.bind(i),
            hide: i.hide.bind(i),
            destroyView: i.destroy.bind(i)
        };
    };
});

define("MetadataComponent", [ "MetadataComponent/index" ], function(e) {
    return e;
});

define("ExposureCompensationComponent/dispatcher", [ "require", "backbone", "underscore" ], function(e) {
    var t = e("backbone");
    var i = e("underscore");
    var n = i.clone(t.Events);
    return n;
});

define("ExposureCompensationComponent/templates/index", [], function() {
    return [ '<div class="headExposureCompensation">', '<span class="currentExposureCompensation">', '<span class="btnEVCorrection" data-delta="0">Reset</span>', '<span id="currentEV">{{currentEV}} EV</span>', "</span>", '<span class="titleExposureCompensation">Exposure</span>', "</div>", '<div class="btnsExposureCompensation">', '<div class="wrapBtnEVCorrection">', '<span class="btnEVCorrection btnLeftEVx2" data-delta="-1"><span></span></span>', '<span class="labelBtnEVCorrection">-1EV</span>', "</div>", '<div class="wrapBtnEVCorrection">', '<span class="btnEVCorrection btnLeftEVx1" data-delta="-0.33"><span></span></span>', '<span class="labelBtnEVCorrection">-&#8531;EV</span>', "</div>", '<div class="wrapBtnEVCorrection">', '<span class="btnEVCorrection btnRightEVx1" data-delta="+0.33"><span></span></span>', '<span class="labelBtnEVCorrection">+&#8531;EV</span>', "</div>", '<div class="wrapBtnEVCorrection">', '<span class="btnEVCorrection btnRightEVx2" data-delta="+1"><span></span></span>', '<span class="labelBtnEVCorrection">+1EV</span>', "</div>", "</div>" ].join("");
});

define("ExposureCompensationComponent/views/index", [ "require", "mustache", "backbone", "../templates/index", "../dispatcher", "Spinner" ], function(e) {
    var t = e("mustache");
    var i = e("backbone");
    var n = e("../templates/index");
    var r = e("../dispatcher");
    var a = e("Spinner");
    return i.View.extend({
        className: "exposureCompensation",
        events: {
            "click .btnEVCorrection": "evChanged"
        },
        params: {},
        evChanged: function(e) {
            var t = parseFloat(e.currentTarget.dataset.delta, 10);
            this.trigger("changed", t);
        },
        initialize: function(e) {
            Object.merge(this.params, e);
            this.render(e);
        },
        render: function(e) {
            this.$el.html(t.to_html(n, {
                currentEV: e.currentEV
            }));
            this.params.parentEl.html(this.$el);
        },
        renderEV: function(e) {
            this.$el.find("#currentEV").text((e || 0) + " EV");
        },
        setEV: function(e) {
            if (!e) {
                var t = "0";
            } else {
                t = (~~(100 * e) / 100).toFixed(2);
            }
            this.renderEV(t);
        },
        hide: function() {
            this.$el.hide();
        },
        show: function() {
            this.$el.show();
        },
        destroy: function() {
            this.undelegateEvents();
            this.$el.removeData().unbind();
            this.remove();
            i.View.prototype.remove.call(this);
        }
    });
});

define("ExposureCompensationComponent/controllers/index", [ "require", "../views/index", "../dispatcher" ], function(e) {
    var t = e("../views/index");
    var i = e("../dispatcher");
    var n, r;
    var a = 0;
    var o = [ -5, -4.66, -4.33, -4, -3.66, -3.33, -3, -2.66, -2.33, -2, -1.66, -1.33, -1, -.66, -.33, 0, .33, .66, 1, 1.33, 1.66, 2, 2.33, 2.66, 3, 3.33, 3.66, 4, 4.33, 4.66, 5 ];
    return {
        init: function(e) {
            var s = this;
            r = e.currentEV || 0;
            n = new t({
                currentEV: r,
                parentEl: e.parentEl
            });
            n.on("changed", function(e) {
                if (r === o[0] && e < 0) return false;
                if (r === o[o.length - 1] && e > 0) return false;
                if (e === 0) {
                    s.setEV(a);
                    i.trigger("change", a);
                } else {
                    var t = r + e;
                    var n = null;
                    _.each(o, function(e, i) {
                        if (n === null || Math.abs(e - t) < Math.abs(n - t)) {
                            n = e;
                        }
                    });
                    s.setEV(n);
                    i.trigger("change", n);
                }
            });
        },
        hideView: function() {
            n.hide();
        },
        showView: function() {
            n.show();
        },
        setEV: function(e) {
            r = e;
            n.setEV(e);
        },
        destroy: function() {
            n.destroy();
        }
    };
});

define("ExposureCompensationComponent/index", [ "require", "./dispatcher", "./controllers/index" ], function(e) {
    var t = e("./dispatcher");
    var i = e("./controllers/index");
    return {
        init: function(e) {
            i.init(e);
            return this;
        },
        dispatcher: t,
        hide: function() {
            i.hideView();
        },
        show: function() {
            i.showView();
        },
        setEV: function(e) {
            i.setEV(e);
        },
        destroy: function() {
            i.destroy();
        }
    };
});

define("ExposureCompensationComponent", [ "ExposureCompensationComponent/index" ], function(e) {
    return e;
});

define("PaymentComponent/configs/index", [ "require" ], function(e) {
    return {
        analyticsCategory: "Raw"
    };
});

define("PaymentComponent/templates/view", [], function() {
    return [ '<div class="overlayPopup">', '<div class="overlayPopupInner">', '{{#showCloseButton}}<div class="overlayPopupClose icon_lightX"></div>{{/showCloseButton}}', '<span class="textTrueRawDecoding">{{textTrueRawDecoding}}</span>', '<span class="textUnlimitedAccess">{{textUnlimitedAccess}}</span>', '<div class="titleTable">{{titleTable}}</div>', '<div class="tableOfPrices"></div>', '<span class="overlayPopupButtons">', "{{#btns}}", '<span class="{{#classList}}{{.}} {{/classList}}">{{{text}}}</span>', "{{/btns}}", "</span>", '<div class="textWeDontStore">{{textWeDontStore}}</div>', '<div class="textWhatHappensNext">{{textWhatHappensNext}}</div>', '<div class="footerPopup">', '<div class="textRefund">{{textRefund}}</div>', '<div class="btnRestorePrevPurchase">{{btnRestorePrevPurchase}}</div>', "</div>", "</div>", "</div>" ].join("");
});

define("PaymentComponent/templates/priceTable", [ "require" ], function(e) {
    return [ '<div class="secondTable">', '<div class="tr">', '<div class="td first">{{one_time_fee}}</div>', '<div class="td second">{{lifetime_value}}</div>', '<div class="td second">{{month_value}}</div>', "</div>", '<div class="tr">', '<div class="td first">{{urcair}}</div>', '<div class="td second">{{txt_lifetime}}</div>', '<div class="td second">{{txt_one_month}}</div>', "</div>", '<div class="tr trChoosePeriod">', '<div class="td first">{{choose_period}}</div>', "</div>", "</div>" ].join("");
});

define("PaymentComponent/configs/view", [ "require", "i18n!assets/js/picsio-raw/localization/strings" ], function(e) {
    var t = e("i18n!assets/js/picsio-raw/localization/strings");
    return function(e) {
        var i = {
            batch: t.PAYMENT_FORM.MESSAGE_BATCH,
            raw: t.PAYMENT_FORM.MESSAGE_RAW,
            too_many_files: t.PAYMENT_FORM.MESSAGE_MULTIPLE_FILES,
            private_browsing: t.PAYMENT_FORM.MESSAGE_PRIVATE_BROWSING
        };
        var n = i[e.type || "too_many_files"].TITLE;
        var r = i[e.type || "too_many_files"].TEXT;
        var a = e.type !== "private_browsing";
        return {
            textTrueRawDecoding: n,
            text: r,
            showCloseButton: e.showCloseButton && a,
            textUnlimitedAccess: t.PAYMENT_FORM.TEXT_UNLIMITED_ACCESS,
            titleTable: t.PAYMENT_FORM.TITLE_TABLE,
            textWeDontStore: t.PAYMENT_FORM.TEXT_WE_DONT_STORE,
            textWhatHappensNext: t.PAYMENT_FORM.TEXT_WHAT_HAPPENS_NEXT,
            textRefund: t.PAYMENT_FORM.TEXT_REFUND,
            btnRestorePrevPurchase: t.PAYMENT_FORM.BTN_RESTORE_PREV_PURCHASE,
            btns: [ {
                text: t.PAYMENT_FORM.BTN_PAY,
                classList: [ "btnStripe" ]
            }, {
                text: "",
                classList: [ "btnPaypal" ]
            }, {
                text: t.PAYMENT_FORM.BTN_BUY_LATER,
                classList: [ "btnBuyLater" ]
            } ]
        };
    };
});

define("PaymentComponent/configs/priceTable", [ "require", "i18n!assets/js/picsio-raw/localization/strings" ], function(e) {
    var t = e("i18n!assets/js/picsio-raw/localization/strings");
    return {
        one_time_fee: t.PAYMENT_FORM.SECOND_TABLE_OF_PRICES.ONE_TIME_FEE,
        lifetime_value: t.PAYMENT_FORM.SECOND_TABLE_OF_PRICES.LIFETIME_VALUE,
        month_value: t.PAYMENT_FORM.SECOND_TABLE_OF_PRICES.MONTH_VALUE,
        urcair: t.PAYMENT_FORM.SECOND_TABLE_OF_PRICES.URCAIR,
        txt_lifetime: t.PAYMENT_FORM.SECOND_TABLE_OF_PRICES.TXT_LIFETIME,
        txt_one_month: t.PAYMENT_FORM.SECOND_TABLE_OF_PRICES.TXT_ONE_MONTH,
        choose_period: t.PAYMENT_FORM.SECOND_TABLE_OF_PRICES.CHOOSE_PERIOD
    };
});

try {
    window.FB || function(window) {
        var apply = Function.prototype.apply;
        function bindContext(e, t) {
            return function i() {
                return apply.call(e, t, arguments);
            };
        }
        var global = {
            __type: "JS_SDK_SANDBOX"
        };
        var sandboxWhitelist = [ "setTimeout", "setInterval", "clearTimeout", "clearInterval" ];
        for (var i = 0; i < sandboxWhitelist.length; i++) {
            global[sandboxWhitelist[i]] = bindContext(window[sandboxWhitelist[i]], window);
        }
        (function() {
            var self = window;
            var __DEV__ = 0;
            function emptyFunction() {}
            var __transform_includes = {};
            var __annotator, __bodyWrapper;
            var __w, __t;
            var undefined;
            with (this) {
                (function() {
                    var e = {}, t = function(e, t) {
                        if (!e && !t) return null;
                        var i = {};
                        if (typeof e !== "undefined") i.type = e;
                        if (typeof t !== "undefined") i.signature = t;
                        return i;
                    }, i = function(e, i) {
                        return t(e && /^[A-Z]/.test(e) ? e : undefined, i && (i.params && i.params.length || i.returns) ? "function(" + (i.params ? i.params.map(function(e) {
                            return /\?/.test(e) ? "?" + e.replace("?", "") : e;
                        }).join(",") : "") + ")" + (i.returns ? ":" + i.returns : "") : undefined);
                    }, n = function(e, t, i) {
                        return e;
                    }, r = function(e, t, n) {
                        if ("sourcemeta" in __transform_includes) e.__SMmeta = t;
                        if ("typechecks" in __transform_includes) {
                            var r = i(t ? t.name : undefined, n);
                            if (r) __w(e, r);
                        }
                        return e;
                    }, a = function(e, t, i) {
                        return i.apply(e, t);
                    }, o = function(e, t, i, n) {
                        if (n && n.params) __t.apply(e, n.params);
                        var r = i.apply(e, t);
                        if (n && n.returns) __t([ r, n.returns ]);
                        return r;
                    }, s = function(t, i, n, r, a) {
                        if (a) {
                            if (!a.callId) a.callId = a.module + ":" + (a.line || 0) + ":" + (a.column || 0);
                            var o = a.callId;
                            e[o] = (e[o] || 0) + 1;
                        }
                        return n.apply(t, i);
                    };
                    if (typeof __transform_includes === "undefined") {
                        __annotator = n;
                        __bodyWrapper = a;
                    } else {
                        __annotator = r;
                        if ("codeusage" in __transform_includes) {
                            __annotator = n;
                            __bodyWrapper = s;
                            __bodyWrapper.getCodeUsage = function() {
                                return e;
                            };
                            __bodyWrapper.clearCodeUsage = function() {
                                e = {};
                            };
                        } else if ("typechecks" in __transform_includes) {
                            __bodyWrapper = o;
                        } else __bodyWrapper = a;
                    }
                })();
                __t = function(e) {
                    return e[0];
                };
                __w = function(e) {
                    return e;
                };
                var require, __d;
                (function(e) {
                    var t = {}, i = {}, n = [ "global", "require", "requireDynamic", "requireLazy", "module", "exports" ];
                    require = function(n, r) {
                        if (i.hasOwnProperty(n)) return i[n];
                        if (!t.hasOwnProperty(n)) {
                            if (r) return null;
                            throw new Error("Module " + n + " has not been defined");
                        }
                        var a = t[n], o = a.deps, s = a.factory.length, l, c = [];
                        for (var u = 0; u < s; u++) {
                            switch (o[u]) {
                              case "module":
                                l = a;
                                break;

                              case "exports":
                                l = a.exports;
                                break;

                              case "global":
                                l = e;
                                break;

                              case "require":
                                l = require;
                                break;

                              case "requireDynamic":
                                l = require;
                                break;

                              case "requireLazy":
                                l = null;
                                break;

                              default:
                                l = require.call(null, o[u]);
                            }
                            c.push(l);
                        }
                        a.factory.apply(e, c);
                        i[n] = a.exports;
                        return a.exports;
                    };
                    require.__markCompiled = function() {};
                    __d = function(e, r, a, o) {
                        if (typeof a == "function") {
                            t[e] = {
                                factory: a,
                                deps: n.concat(r),
                                exports: {}
                            };
                            if (o === 3) require.call(null, e);
                        } else i[e] = a;
                    };
                })(this);
                __d("ES5ArrayPrototype", [], function e(t, i, n, r, a, o) {
                    if (i.__markCompiled) i.__markCompiled();
                    var s = {};
                    s.map = function(e, t) {
                        if (typeof e != "function") throw new TypeError();
                        var i, n = this.length, r = new Array(n);
                        for (i = 0; i < n; ++i) if (i in this) r[i] = e.call(t, this[i], i, this);
                        return r;
                    };
                    s.forEach = function(e, t) {
                        s.map.call(this, e, t);
                    };
                    s.filter = function(e, t) {
                        if (typeof e != "function") throw new TypeError();
                        var i, n, r = this.length, a = [];
                        for (i = 0; i < r; ++i) if (i in this) {
                            n = this[i];
                            if (e.call(t, n, i, this)) a.push(n);
                        }
                        return a;
                    };
                    s.every = function(e, t) {
                        if (typeof e != "function") throw new TypeError();
                        var i = new Object(this), n = i.length;
                        for (var r = 0; r < n; r++) if (r in i) if (!e.call(t, i[r], r, i)) return false;
                        return true;
                    };
                    s.some = function(e, t) {
                        if (typeof e != "function") throw new TypeError();
                        var i = new Object(this), n = i.length;
                        for (var r = 0; r < n; r++) if (r in i) if (e.call(t, i[r], r, i)) return true;
                        return false;
                    };
                    s.indexOf = function(e, t) {
                        var i = this.length;
                        t |= 0;
                        if (t < 0) t += i;
                        for (;t < i; t++) if (t in this && this[t] === e) return t;
                        return -1;
                    };
                    a.exports = s;
                }, null);
                __d("ES5FunctionPrototype", [], function t(e, i, n, r, a, o) {
                    if (i.__markCompiled) i.__markCompiled();
                    var s = {};
                    s.bind = function(e) {
                        if (typeof this != "function") throw new TypeError("Bind must be called on a function");
                        var t = this, i = Array.prototype.slice.call(arguments, 1);
                        function n() {
                            return t.apply(e, i.concat(Array.prototype.slice.call(arguments)));
                        }
                        n.displayName = "bound:" + (t.displayName || t.name || "(?)");
                        n.toString = function r() {
                            return "bound: " + t;
                        };
                        return n;
                    };
                    a.exports = s;
                }, null);
                __d("ES5StringPrototype", [], function i(e, t, n, r, a, o) {
                    if (t.__markCompiled) t.__markCompiled();
                    var s = {};
                    s.trim = function() {
                        if (this == null) throw new TypeError("String.prototype.trim called on null or undefined");
                        return String.prototype.replace.call(this, /^\s+|\s+$/g, "");
                    };
                    s.startsWith = function(e) {
                        var t = String(this);
                        if (this == null) throw new TypeError("String.prototype.startsWith called on null or undefined");
                        var i = arguments.length > 1 ? Number(arguments[1]) : 0;
                        if (isNaN(i)) i = 0;
                        var n = Math.min(Math.max(i, 0), t.length);
                        return t.indexOf(String(e), i) == n;
                    };
                    s.endsWith = function(e) {
                        var t = String(this);
                        if (this == null) throw new TypeError("String.prototype.endsWith called on null or undefined");
                        var i = t.length, n = String(e), r = arguments.length > 1 ? Number(arguments[1]) : i;
                        if (isNaN(r)) r = 0;
                        var a = Math.min(Math.max(r, 0), i), o = a - n.length;
                        if (o < 0) return false;
                        return t.lastIndexOf(n, o) == o;
                    };
                    s.contains = function(e) {
                        if (this == null) throw new TypeError("String.prototype.contains called on null or undefined");
                        var t = String(this), i = arguments.length > 1 ? Number(arguments[1]) : 0;
                        if (isNaN(i)) i = 0;
                        return t.indexOf(String(e), i) != -1;
                    };
                    s.repeat = function(e) {
                        if (this == null) throw new TypeError("String.prototype.repeat called on null or undefined");
                        var t = String(this), i = e ? Number(e) : 0;
                        if (isNaN(i)) i = 0;
                        if (i < 0 || i === Infinity) throw RangeError();
                        if (i === 1) return t;
                        if (i === 0) return "";
                        var n = "";
                        while (i) {
                            if (i & 1) n += t;
                            if (i >>= 1) t += t;
                        }
                        return n;
                    };
                    a.exports = s;
                }, null);
                __d("ES5Array", [], function n(e, t, i, r, a, o) {
                    if (t.__markCompiled) t.__markCompiled();
                    var s = {};
                    s.isArray = function(e) {
                        return Object.prototype.toString.call(e) == "[object Array]";
                    };
                    a.exports = s;
                }, null);
                __d("ie8DontEnum", [], function r(e, t, i, n, a, o) {
                    if (t.__markCompiled) t.__markCompiled();
                    var s = [ "toString", "toLocaleString", "valueOf", "hasOwnProperty", "isPrototypeOf", "prototypeIsEnumerable", "constructor" ], l = {}.hasOwnProperty, c = function() {};
                    if ({
                        toString: true
                    }.propertyIsEnumerable("toString")) c = function(e, t) {
                        for (var i = 0; i < s.length; i++) {
                            var n = s[i];
                            if (l.call(e, n)) t(n);
                        }
                    };
                    a.exports = c;
                }, null);
                __d("ES5Object", [ "ie8DontEnum" ], function a(e, t, i, n, r, o, s) {
                    if (t.__markCompiled) t.__markCompiled();
                    var l = {}.hasOwnProperty, c = {};
                    function u() {}
                    c.create = function(e) {
                        var t = typeof e;
                        if (t != "object" && t != "function") throw new TypeError("Object prototype may only be a Object or null");
                        u.prototype = e;
                        return new u();
                    };
                    c.keys = function(e) {
                        var t = typeof e;
                        if (t != "object" && t != "function" || e === null) throw new TypeError("Object.keys called on non-object");
                        var i = [];
                        for (var n in e) if (l.call(e, n)) i.push(n);
                        s(e, function(e) {
                            return i.push(e);
                        });
                        return i;
                    };
                    r.exports = c;
                }, null);
                __d("ES5Date", [], function o(e, t, i, n, r, a) {
                    if (t.__markCompiled) t.__markCompiled();
                    var o = {};
                    o.now = function() {
                        return new Date().getTime();
                    };
                    r.exports = o;
                }, null);
                __d("JSON3", [], function s(e, t, i, n, r, a) {
                    t.__markCompiled && t.__markCompiled();
                    (function() {
                        var e = {}.toString, t, i, n, a = r.exports = {}, o = '{"A":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}', s, l, c, u, f, d, h, p, g, m, v, y, b, w, C, x = new Date(-0xc782b5b800cec), _, S, k;
                        try {
                            x = x.getUTCFullYear() == -109252 && x.getUTCMonth() === 0 && x.getUTCDate() == 1 && x.getUTCHours() == 10 && x.getUTCMinutes() == 37 && x.getUTCSeconds() == 6 && x.getUTCMilliseconds() == 708;
                        } catch (A) {}
                        if (!x) {
                            _ = Math.floor;
                            S = [ 0, 31, 59, 90, 120, 151, 181, 212, 243, 273, 304, 334 ];
                            k = function(e, t) {
                                return S[t] + 365 * (e - 1970) + _((e - 1969 + (t = +(t > 1))) / 4) - _((e - 1901 + t) / 100) + _((e - 1601 + t) / 400);
                            };
                        }
                        if (typeof JSON == "object" && JSON) {
                            a.stringify = JSON.stringify;
                            a.parse = JSON.parse;
                        }
                        if (s = typeof a.stringify == "function" && !k) {
                            (x = function() {
                                return 1;
                            }).toJSON = x;
                            try {
                                s = a.stringify(0) === "0" && a.stringify(new Number()) === "0" && a.stringify(new String()) == '""' && a.stringify(e) === n && a.stringify(n) === n && a.stringify() === n && a.stringify(x) === "1" && a.stringify([ x ]) == "[1]" && a.stringify([ n ]) == "[null]" && a.stringify(null) == "null" && a.stringify([ n, e, null ]) == "[null,null,null]" && a.stringify({
                                    result: [ x, true, false, null, "\x00\b\n\f\r	" ]
                                }) == o && a.stringify(null, x) === "1" && a.stringify([ 1, 2 ], null, 1) == "[\n 1,\n 2\n]" && a.stringify(new Date(-864e13)) == '"-271821-04-20T00:00:00.000Z"' && a.stringify(new Date(864e13)) == '"+275760-09-13T00:00:00.000Z"' && a.stringify(new Date(-621987552e5)) == '"-000001-01-01T00:00:00.000Z"' && a.stringify(new Date(-1)) == '"1969-12-31T23:59:59.999Z"';
                            } catch (A) {
                                s = false;
                            }
                        }
                        if (typeof a.parse == "function") try {
                            if (a.parse("0") === 0 && !a.parse(false)) {
                                x = a.parse(o);
                                if (d = x.A.length == 5 && x.A[0] == 1) {
                                    try {
                                        d = !a.parse('"	"');
                                    } catch (A) {}
                                    if (d) try {
                                        d = a.parse("01") != 1;
                                    } catch (A) {}
                                }
                            }
                        } catch (A) {
                            d = false;
                        }
                        x = o = null;
                        if (!s || !d) {
                            if (!(t = {}.hasOwnProperty)) t = function(i) {
                                var n = {}, r;
                                if ((n.__proto__ = null, n.__proto__ = {
                                    toString: 1
                                }, n).toString != e) {
                                    t = function(e) {
                                        var t = this.__proto__, i = e in (this.__proto__ = null, this);
                                        this.__proto__ = t;
                                        return i;
                                    };
                                } else {
                                    r = n.constructor;
                                    t = function(e) {
                                        var t = (this.constructor || r).prototype;
                                        return e in this && !(e in t && this[e] === t[e]);
                                    };
                                }
                                n = null;
                                return t.call(this, i);
                            };
                            i = function(i, n) {
                                var r = 0, a, o, s, l;
                                (a = function() {
                                    this.valueOf = 0;
                                }).prototype.valueOf = 0;
                                o = new a();
                                for (s in o) if (t.call(o, s)) r++;
                                a = o = null;
                                if (!r) {
                                    o = [ "valueOf", "toString", "toLocaleString", "propertyIsEnumerable", "isPrototypeOf", "hasOwnProperty", "constructor" ];
                                    l = function(i, n) {
                                        var r = e.call(i) == "[object Function]", a, s;
                                        for (a in i) if (!(r && a == "prototype") && t.call(i, a)) n(a);
                                        for (s = o.length; a = o[--s]; t.call(i, a) && n(a)) ;
                                    };
                                } else if (r == 2) {
                                    l = function(i, n) {
                                        var r = {}, a = e.call(i) == "[object Function]", o;
                                        for (o in i) if (!(a && o == "prototype") && !t.call(r, o) && (r[o] = 1) && t.call(i, o)) n(o);
                                    };
                                } else l = function(i, n) {
                                    var r = e.call(i) == "[object Function]", a, o;
                                    for (a in i) if (!(r && a == "prototype") && t.call(i, a) && !(o = a === "constructor")) n(a);
                                    if (o || t.call(i, a = "constructor")) n(a);
                                };
                                return l(i, n);
                            };
                            if (!s) {
                                l = {
                                    "\\": "\\\\",
                                    '"': '\\"',
                                    "\b": "\\b",
                                    "\f": "\\f",
                                    "\n": "\\n",
                                    "\r": "\\r",
                                    "	": "\\t"
                                };
                                c = function(e, t) {
                                    return ("000000" + (t || 0)).slice(-e);
                                };
                                u = function(e) {
                                    var t = '"', i = 0, n;
                                    for (;n = e.charAt(i); i++) t += '\\"\b\f\n\r	'.indexOf(n) > -1 ? l[n] : n < " " ? "\\u00" + c(2, n.charCodeAt(0).toString(16)) : n;
                                    return t + '"';
                                };
                                f = function(r, a, o, s, l, d, h) {
                                    var p = a[r], g, m, v, y, b, w, C, x, S, A, E, T, P, I, O;
                                    if (typeof p == "object" && p) {
                                        g = e.call(p);
                                        if (g == "[object Date]" && !t.call(p, "toJSON")) {
                                            if (p > -1 / 0 && p < 1 / 0) {
                                                if (k) {
                                                    y = _(p / 864e5);
                                                    for (m = _(y / 365.2425) + 1970 - 1; k(m + 1, 0) <= y; m++) ;
                                                    for (v = _((y - k(m, 0)) / 30.42); k(m, v + 1) <= y; v++) ;
                                                    y = 1 + y - k(m, v);
                                                    b = (p % 864e5 + 864e5) % 864e5;
                                                    w = _(b / 36e5) % 24;
                                                    C = _(b / 6e4) % 60;
                                                    x = _(b / 1e3) % 60;
                                                    S = b % 1e3;
                                                } else {
                                                    m = p.getUTCFullYear();
                                                    v = p.getUTCMonth();
                                                    y = p.getUTCDate();
                                                    w = p.getUTCHours();
                                                    C = p.getUTCMinutes();
                                                    x = p.getUTCSeconds();
                                                    S = p.getUTCMilliseconds();
                                                }
                                                p = (m <= 0 || m >= 1e4 ? (m < 0 ? "-" : "+") + c(6, m < 0 ? -m : m) : c(4, m)) + "-" + c(2, v + 1) + "-" + c(2, y) + "T" + c(2, w) + ":" + c(2, C) + ":" + c(2, x) + "." + c(3, S) + "Z";
                                            } else p = null;
                                        } else if (typeof p.toJSON == "function" && (g != "[object Number]" && g != "[object String]" && g != "[object Array]" || t.call(p, "toJSON"))) p = p.toJSON(r);
                                    }
                                    if (o) p = o.call(a, r, p);
                                    if (p === null) return "null";
                                    g = e.call(p);
                                    if (g == "[object Boolean]") {
                                        return "" + p;
                                    } else if (g == "[object Number]") {
                                        return p > -1 / 0 && p < 1 / 0 ? "" + p : "null";
                                    } else if (g == "[object String]") return u(p);
                                    if (typeof p == "object") {
                                        for (P = h.length; P--; ) if (h[P] === p) throw TypeError();
                                        h.push(p);
                                        A = [];
                                        I = d;
                                        d += l;
                                        if (g == "[object Array]") {
                                            for (T = 0, P = p.length; T < P; O || (O = true), T++) {
                                                E = f(T, p, o, s, l, d, h);
                                                A.push(E === n ? "null" : E);
                                            }
                                            return O ? l ? "[\n" + d + A.join(",\n" + d) + "\n" + I + "]" : "[" + A.join(",") + "]" : "[]";
                                        } else {
                                            i(s || p, function(e) {
                                                var t = f(e, p, o, s, l, d, h);
                                                if (t !== n) A.push(u(e) + ":" + (l ? " " : "") + t);
                                                O || (O = true);
                                            });
                                            return O ? l ? "{\n" + d + A.join(",\n" + d) + "\n" + I + "}" : "{" + A.join(",") + "}" : "{}";
                                        }
                                        h.pop();
                                    }
                                };
                                a.stringify = function(t, i, n) {
                                    var r, a, o, s, l, c;
                                    if (typeof i == "function" || typeof i == "object" && i) if (e.call(i) == "[object Function]") {
                                        a = i;
                                    } else if (e.call(i) == "[object Array]") {
                                        o = {};
                                        for (s = 0, l = i.length; s < l; c = i[s++], (e.call(c) == "[object String]" || e.call(c) == "[object Number]") && (o[c] = 1)) ;
                                    }
                                    if (n) if (e.call(n) == "[object Number]") {
                                        if ((n -= n % 1) > 0) for (r = "", n > 10 && (n = 10); r.length < n; r += " ") ;
                                    } else if (e.call(n) == "[object String]") r = n.length <= 10 ? n : n.slice(0, 10);
                                    return f("", (c = {}, c[""] = t, c), a, o, r, "", []);
                                };
                            }
                            if (!d) {
                                h = String.fromCharCode;
                                p = {
                                    "\\": "\\",
                                    '"': '"',
                                    "/": "/",
                                    b: "\b",
                                    t: "	",
                                    n: "\n",
                                    f: "\f",
                                    r: "\r"
                                };
                                g = function() {
                                    w = C = null;
                                    throw SyntaxError();
                                };
                                m = function() {
                                    var e = C, t = e.length, i, n, r, a, o;
                                    while (w < t) {
                                        i = e.charAt(w);
                                        if ("	\r\n ".indexOf(i) > -1) {
                                            w++;
                                        } else if ("{}[]:,".indexOf(i) > -1) {
                                            w++;
                                            return i;
                                        } else if (i == '"') {
                                            for (n = "@", w++; w < t; ) {
                                                i = e.charAt(w);
                                                if (i < " ") {
                                                    g();
                                                } else if (i == "\\") {
                                                    i = e.charAt(++w);
                                                    if ('\\"/btnfr'.indexOf(i) > -1) {
                                                        n += p[i];
                                                        w++;
                                                    } else if (i == "u") {
                                                        r = ++w;
                                                        for (a = w + 4; w < a; w++) {
                                                            i = e.charAt(w);
                                                            if (!(i >= "0" && i <= "9" || i >= "a" && i <= "f" || i >= "A" && i <= "F")) g();
                                                        }
                                                        n += h("0x" + e.slice(r, w));
                                                    } else g();
                                                } else {
                                                    if (i == '"') break;
                                                    n += i;
                                                    w++;
                                                }
                                            }
                                            if (e.charAt(w) == '"') {
                                                w++;
                                                return n;
                                            }
                                            g();
                                        } else {
                                            r = w;
                                            if (i == "-") {
                                                o = true;
                                                i = e.charAt(++w);
                                            }
                                            if (i >= "0" && i <= "9") {
                                                if (i == "0" && (i = e.charAt(w + 1), i >= "0" && i <= "9")) g();
                                                o = false;
                                                for (;w < t && (i = e.charAt(w), i >= "0" && i <= "9"); w++) ;
                                                if (e.charAt(w) == ".") {
                                                    a = ++w;
                                                    for (;a < t && (i = e.charAt(a), i >= "0" && i <= "9"); a++) ;
                                                    if (a == w) g();
                                                    w = a;
                                                }
                                                i = e.charAt(w);
                                                if (i == "e" || i == "E") {
                                                    i = e.charAt(++w);
                                                    if (i == "+" || i == "-") w++;
                                                    for (a = w; a < t && (i = e.charAt(a), i >= "0" && i <= "9"); a++) ;
                                                    if (a == w) g();
                                                    w = a;
                                                }
                                                return +e.slice(r, w);
                                            }
                                            if (o) g();
                                            if (e.slice(w, w + 4) == "true") {
                                                w += 4;
                                                return true;
                                            } else if (e.slice(w, w + 5) == "false") {
                                                w += 5;
                                                return false;
                                            } else if (e.slice(w, w + 4) == "null") {
                                                w += 4;
                                                return null;
                                            }
                                            g();
                                        }
                                    }
                                    return "$";
                                };
                                v = function(e) {
                                    var t, i, n;
                                    if (e == "$") g();
                                    if (typeof e == "string") {
                                        if (e.charAt(0) == "@") return e.slice(1);
                                        if (e == "[") {
                                            t = [];
                                            for (;;i || (i = true)) {
                                                e = m();
                                                if (e == "]") break;
                                                if (i) if (e == ",") {
                                                    e = m();
                                                    if (e == "]") g();
                                                } else g();
                                                if (e == ",") g();
                                                t.push(v(e));
                                            }
                                            return t;
                                        } else if (e == "{") {
                                            t = {};
                                            for (;;i || (i = true)) {
                                                e = m();
                                                if (e == "}") break;
                                                if (i) if (e == ",") {
                                                    e = m();
                                                    if (e == "}") g();
                                                } else g();
                                                if (e == "," || typeof e != "string" || e.charAt(0) != "@" || m() != ":") g();
                                                t[e.slice(1)] = v(m());
                                            }
                                            return t;
                                        }
                                        g();
                                    }
                                    return e;
                                };
                                b = function(e, t, i) {
                                    var r = y(e, t, i);
                                    if (r === n) {
                                        delete e[t];
                                    } else e[t] = r;
                                };
                                y = function(t, n, r) {
                                    var a = t[n], o;
                                    if (typeof a == "object" && a) if (e.call(a) == "[object Array]") {
                                        for (o = a.length; o--; ) b(a, o, r);
                                    } else i(a, function(e) {
                                        b(a, e, r);
                                    });
                                    return r.call(t, n, a);
                                };
                                a.parse = function(t, i) {
                                    w = 0;
                                    C = t;
                                    var n = v(m());
                                    if (m() != "$") g();
                                    w = C = null;
                                    return i && e.call(i) == "[object Function]" ? y((x = {}, x[""] = n, x), "", i) : n;
                                };
                            }
                        }
                    }).call(this);
                }, null);
                __d("ES6Object", [ "ie8DontEnum" ], function l(e, t, i, n, r, a, o) {
                    if (t.__markCompiled) t.__markCompiled();
                    var s = {}.hasOwnProperty, l = {
                        assign: function(e) {
                            if (e == null) throw new TypeError("Object.assign target cannot be null or undefined");
                            e = Object(e);
                            for (var t = arguments.length, i = Array(t > 1 ? t - 1 : 0), n = 1; n < t; n++) i[n - 1] = arguments[n];
                            for (var r = 0; r < i.length; r++) {
                                var a = i[r];
                                if (a == null) continue;
                                a = Object(a);
                                for (var l in a) if (s.call(a, l)) e[l] = a[l];
                                o(a, function(t) {
                                    return e[t] = a[t];
                                });
                            }
                            return e;
                        },
                        is: function(e, t) {
                            if (e === t) {
                                return e !== 0 || 1 / e === 1 / t;
                            } else return e !== e && t !== t;
                        }
                    };
                    r.exports = l;
                }, null);
                __d("ES6ArrayPrototype", [], function c(e, t, i, n, r, a) {
                    if (t.__markCompiled) t.__markCompiled();
                    var o = {
                        find: function(e, t) {
                            if (this == null) throw new TypeError("Array.prototype.find called on null or undefined");
                            if (typeof e !== "function") throw new TypeError("predicate must be a function");
                            var i = o.findIndex.call(this, e, t);
                            return i === -1 ? void 0 : this[i];
                        },
                        findIndex: function(e, t) {
                            if (this == null) throw new TypeError("Array.prototype.findIndex called on null or undefined");
                            if (typeof e !== "function") throw new TypeError("predicate must be a function");
                            var i = Object(this), n = i.length >>> 0;
                            for (var r = 0; r < n; r++) if (e.call(t, i[r], r, i)) return r;
                            return -1;
                        },
                        fill: function(e) {
                            if (this == null) throw new TypeError("Array.prototype.fill called on null or undefined");
                            var t = Object(this), i = t.length >>> 0, n = arguments[1], r = n >> 0, a = r < 0 ? Math.max(i + r, 0) : Math.min(r, i), o = arguments[2], s = o === undefined ? i : o >> 0, l = s < 0 ? Math.max(i + s, 0) : Math.min(s, i);
                            while (a < l) {
                                t[a] = e;
                                a++;
                            }
                            return t;
                        }
                    };
                    r.exports = o;
                }, null);
                __d("ES6DatePrototype", [], function u(e, t, i, n, r, a) {
                    if (t.__markCompiled) t.__markCompiled();
                    function o(e) {
                        return (e < 10 ? "0" : "") + e;
                    }
                    var s = {
                        toISOString: function() {
                            if (!isFinite(this)) throw new Error("Invalid time value");
                            var e = this.getUTCFullYear();
                            e = (e < 0 ? "-" : e > 9999 ? "+" : "") + ("00000" + Math.abs(e)).slice(0 <= e && e <= 9999 ? -4 : -6);
                            return e + "-" + o(this.getUTCMonth() + 1) + "-" + o(this.getUTCDate()) + "T" + o(this.getUTCHours()) + ":" + o(this.getUTCMinutes()) + ":" + o(this.getUTCSeconds()) + "." + (this.getUTCMilliseconds() / 1e3).toFixed(3).slice(2, 5) + "Z";
                        }
                    };
                    r.exports = s;
                }, null);
                __d("ES6Number", [], function f(e, t, i, n, r, a) {
                    if (t.__markCompiled) t.__markCompiled();
                    var o = Math.pow(2, -52), s = Math.pow(2, 53) - 1, l = -1 * s, c = {
                        isFinite: function(e) {
                            return typeof e == "number" && isFinite(e);
                        },
                        isNaN: function(e) {
                            return typeof e == "number" && isNaN(e);
                        },
                        isInteger: function(e) {
                            return this.isFinite(e) && Math.floor(e) === e;
                        },
                        isSafeInteger: function(e) {
                            return this.isFinite(e) && e >= this.MIN_SAFE_INTEGER && e <= this.MAX_SAFE_INTEGER && Math.floor(e) === e;
                        },
                        EPSILON: o,
                        MAX_SAFE_INTEGER: s,
                        MIN_SAFE_INTEGER: l
                    };
                    r.exports = c;
                }, null);
                __d("ES7StringPrototype", [], function d(e, t, i, n, r, a) {
                    if (t.__markCompiled) t.__markCompiled();
                    var o = {};
                    o.trimLeft = function() {
                        return this.replace(/^\s+/, "");
                    };
                    o.trimRight = function() {
                        return this.replace(/\s+$/, "");
                    };
                    r.exports = o;
                }, null);
                __d("ES", [ "ES5ArrayPrototype", "ES5FunctionPrototype", "ES5StringPrototype", "ES5Array", "ES5Object", "ES5Date", "JSON3", "ES6Object", "ES6ArrayPrototype", "ES6DatePrototype", "ES6Number", "ES7StringPrototype" ], function h(e, t, i, n, r, a, o, s, l, c, u, f, d, p, g, m, v, y) {
                    if (t.__markCompiled) t.__markCompiled();
                    var b = {}.toString, w = {
                        "JSON.stringify": d.stringify,
                        "JSON.parse": d.parse
                    }, C = {
                        "Array.prototype": o,
                        "Function.prototype": s,
                        "String.prototype": l,
                        Object: u,
                        Array: c,
                        Date: f
                    }, x = {
                        Object: p,
                        "Array.prototype": g,
                        "Date.prototype": m,
                        Number: v
                    }, _ = {
                        "String.prototype": y
                    };
                    function S(e) {
                        for (var t in e) {
                            if (!e.hasOwnProperty(t)) continue;
                            var i = e[t], n = t.split("."), r = n.length == 2 ? window[n[0]][n[1]] : window[t];
                            for (var a in i) {
                                if (!i.hasOwnProperty(a)) continue;
                                if (typeof i[a] !== "function") {
                                    w[t + "." + a] = i[a];
                                    continue;
                                }
                                var o = r[a];
                                w[t + "." + a] = o && /\{\s+\[native code\]\s\}/.test(o) ? o : i[a];
                            }
                        }
                    }
                    S(C);
                    S(x);
                    S(_);
                    function k(e, t, i) {
                        var n = i ? b.call(e).slice(8, -1) + ".prototype" : e, r = w[n + "." + t] || e[t];
                        if (typeof r === "function") {
                            for (var a = arguments.length, o = Array(a > 3 ? a - 3 : 0), s = 3; s < a; s++) o[s - 3] = arguments[s];
                            return r.apply(e, o);
                        } else if (r) return r;
                        throw new Error("Polyfill " + n + " does not have implementation of " + t);
                    }
                    r.exports = k;
                }, null);
                __d("sdk.babelHelpers", [ "ES5FunctionPrototype", "ES5Object", "ES6Object" ], function p(e, t, i, n, r, a, o, s, l) {
                    if (t.__markCompiled) t.__markCompiled();
                    var c = {}, u = Object.prototype.hasOwnProperty;
                    c.inherits = function(e, t) {
                        l.assign(e, t);
                        e.prototype = s.create(t && t.prototype);
                        e.prototype.constructor = e;
                        e.__superConstructor__ = t;
                        return t;
                    };
                    c._extends = l.assign;
                    c.objectWithoutProperties = function(e, t) {
                        var i = {};
                        for (var n in e) {
                            if (!u.call(e, n) || t.indexOf(n) >= 0) continue;
                            i[n] = e[n];
                        }
                        return i;
                    };
                    c.taggedTemplateLiteralLoose = function(e, t) {
                        e.raw = t;
                        return e;
                    };
                    c.bind = o.bind;
                    r.exports = c;
                }, null);
                var ES = require("ES");
                var babelHelpers = require("sdk.babelHelpers");
                __d("JSSDKRuntimeConfig", [], {
                    locale: "en_US",
                    rtl: false,
                    revision: "2063232"
                });
                __d("JSSDKConfig", [], {
                    bustCache: true,
                    tagCountLogRate: .01,
                    errorHandling: {
                        rate: 4
                    },
                    usePluginPipe: true,
                    features: {
                        dialog_resize_refactor: true,
                        one_comment_controller: true,
                        allow_non_canvas_app_events: false,
                        event_subscriptions_log: {
                            rate: .01,
                            value: 1e4
                        },
                        should_force_single_dialog_instance: true,
                        js_sdk_force_status_on_load: true,
                        kill_fragment: true,
                        xfbml_profile_pic_server: true,
                        error_handling: {
                            rate: 4
                        },
                        e2e_ping_tracking: {
                            rate: 1e-6
                        },
                        xd_timeout: {
                            rate: 4,
                            value: 3e4
                        },
                        use_bundle: true,
                        launch_payment_dialog_via_pac: {
                            rate: 100
                        },
                        plugin_tags_blacklist: [ "recommendations_bar", "registration", "activity", "recommendations", "facepile" ],
                        should_log_response_error: true
                    },
                    api: {
                        mode: "warn",
                        whitelist: [ "AppEvents", "AppEvents.EventNames", "AppEvents.ParameterNames", "AppEvents.activateApp", "AppEvents.logEvent", "AppEvents.logPurchase", "Canvas", "Canvas.Prefetcher", "Canvas.Prefetcher.addStaticResource", "Canvas.Prefetcher.setCollectionMode", "Canvas.getPageInfo", "Canvas.hideFlashElement", "Canvas.scrollTo", "Canvas.setAutoGrow", "Canvas.setDoneLoading", "Canvas.setSize", "Canvas.setUrlHandler", "Canvas.showFlashElement", "Canvas.startTimer", "Canvas.stopTimer", "Event", "Event.subscribe", "Event.unsubscribe", "Music.flashCallback", "Music.init", "Music.send", "Payment", "Payment.cancelFlow", "Payment.continueFlow", "Payment.init", "Payment.lockForProcessing", "Payment.parse", "Payment.setSize", "Payment.unlockForProcessing", "ThirdPartyProvider", "ThirdPartyProvider.init", "ThirdPartyProvider.sendData", "UA", "UA.nativeApp", "XFBML", "XFBML.RecommendationsBar", "XFBML.RecommendationsBar.markRead", "XFBML.parse", "addFriend", "api", "getAccessToken", "getAuthResponse", "getLoginStatus", "getUserID", "init", "login", "logout", "publish", "share", "ui" ]
                    },
                    initSitevars: {
                        enableMobileComments: 1,
                        iframePermissions: {
                            read_stream: false,
                            manage_mailbox: false,
                            manage_friendlists: false,
                            read_mailbox: false,
                            publish_checkins: true,
                            status_update: true,
                            photo_upload: true,
                            video_upload: true,
                            sms: false,
                            create_event: true,
                            rsvp_event: true,
                            offline_access: true,
                            email: true,
                            xmpp_login: false,
                            create_note: true,
                            share_item: true,
                            export_stream: false,
                            publish_stream: true,
                            publish_likes: true,
                            ads_management: false,
                            contact_email: true,
                            access_private_data: false,
                            read_insights: false,
                            read_requests: false,
                            read_friendlists: true,
                            manage_pages: false,
                            physical_login: false,
                            manage_groups: false,
                            read_deals: false
                        }
                    }
                });
                __d("UrlMapConfig", [], {
                    www: "www.facebook.com",
                    m: "m.facebook.com",
                    connect: "connect.facebook.net",
                    business: "business.facebook.com",
                    api_https: "api.facebook.com",
                    api_read_https: "api-read.facebook.com",
                    graph_https: "graph.facebook.com",
                    fbcdn_http: "fbstatic-a.akamaihd.net",
                    fbcdn_https: "fbstatic-a.akamaihd.net",
                    cdn_http: "static.ak.facebook.com",
                    cdn_https: "s-static.ak.facebook.com"
                });
                __d("JSSDKXDConfig", [], {
                    XdUrl: "/connect/xd_arbiter.php?version=41",
                    XdBundleUrl: "/connect/xd_arbiter/TlA_zCeMkxl.js?version=41",
                    Flash: {
                        path: "https://connect.facebook.net/rsrc.php/v1/yW/r/yOZN1vHw3Z_.swf"
                    },
                    useCdn: true
                });
                __d("JSSDKCssConfig", [], {
                    rules: '.fb_hidden{position:absolute;top:-10000px;z-index:10001}.fb_reposition{overflow-x:hidden;position:relative}.fb_invisible{display:none}.fb_reset{background:none;border:0;border-spacing:0;color:#000;cursor:auto;direction:ltr;font-family:"lucida grande", tahoma, verdana, arial, sans-serif;font-size:11px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:1;margin:0;overflow:visible;padding:0;text-align:left;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;visibility:visible;white-space:normal;word-spacing:normal}.fb_reset>div{overflow:hidden}.fb_link img{border:none}\n.fb_dialog{background:rgba(82, 82, 82, .7);position:absolute;top:-10000px;z-index:10001}.fb_reset .fb_dialog_legacy{overflow:visible}.fb_dialog_advanced{padding:10px;-moz-border-radius:8px;-webkit-border-radius:8px;border-radius:8px}.fb_dialog_content{background:#fff;color:#333}.fb_dialog_close_icon{background:url(https://static.xx.fbcdn.net/rsrc.php/v2/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 0 transparent;_background-image:url(https://static.xx.fbcdn.net/rsrc.php/v2/yL/r/s816eWC-2sl.gif);cursor:pointer;display:block;height:15px;position:absolute;right:18px;top:17px;width:15px}.fb_dialog_mobile .fb_dialog_close_icon{top:5px;left:5px;right:auto}.fb_dialog_padding{background-color:transparent;position:absolute;width:1px;z-index:-1}.fb_dialog_close_icon:hover{background:url(https://static.xx.fbcdn.net/rsrc.php/v2/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -15px transparent;_background-image:url(https://static.xx.fbcdn.net/rsrc.php/v2/yL/r/s816eWC-2sl.gif)}.fb_dialog_close_icon:active{background:url(https://static.xx.fbcdn.net/rsrc.php/v2/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -30px transparent;_background-image:url(https://static.xx.fbcdn.net/rsrc.php/v2/yL/r/s816eWC-2sl.gif)}.fb_dialog_loader{background-color:#f6f7f8;border:1px solid #606060;font-size:24px;padding:20px}.fb_dialog_top_left,.fb_dialog_top_right,.fb_dialog_bottom_left,.fb_dialog_bottom_right{height:10px;width:10px;overflow:hidden;position:absolute}.fb_dialog_top_left{background:url(https://static.xx.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 0;left:-10px;top:-10px}.fb_dialog_top_right{background:url(https://static.xx.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 -10px;right:-10px;top:-10px}.fb_dialog_bottom_left{background:url(https://static.xx.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 -20px;bottom:-10px;left:-10px}.fb_dialog_bottom_right{background:url(https://static.xx.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 -30px;right:-10px;bottom:-10px}.fb_dialog_vert_left,.fb_dialog_vert_right,.fb_dialog_horiz_top,.fb_dialog_horiz_bottom{position:absolute;background:#525252;filter:alpha(opacity=70);opacity:.7}.fb_dialog_vert_left,.fb_dialog_vert_right{width:10px;height:100%}.fb_dialog_vert_left{margin-left:-10px}.fb_dialog_vert_right{right:0;margin-right:-10px}.fb_dialog_horiz_top,.fb_dialog_horiz_bottom{width:100%;height:10px}.fb_dialog_horiz_top{margin-top:-10px}.fb_dialog_horiz_bottom{bottom:0;margin-bottom:-10px}.fb_dialog_iframe{line-height:0}.fb_dialog_content .dialog_title{background:#6d84b4;border:1px solid #3a5795;color:#fff;font-size:14px;font-weight:bold;margin:0}.fb_dialog_content .dialog_title>span{background:url(https://static.xx.fbcdn.net/rsrc.php/v2/yd/r/Cou7n-nqK52.gif) no-repeat 5px 50%;float:left;padding:5px 0 7px 26px}body.fb_hidden{-webkit-transform:none;height:100%;margin:0;overflow:visible;position:absolute;top:-10000px;left:0;width:100%}.fb_dialog.fb_dialog_mobile.loading{background:url(https://static.xx.fbcdn.net/rsrc.php/v2/ya/r/3rhSv5V8j3o.gif) white no-repeat 50% 50%;min-height:100%;min-width:100%;overflow:hidden;position:absolute;top:0;z-index:10001}.fb_dialog.fb_dialog_mobile.loading.centered{width:auto;height:auto;min-height:initial;min-width:initial;background:none}.fb_dialog.fb_dialog_mobile.loading.centered #fb_dialog_loader_spinner{width:100%}.fb_dialog.fb_dialog_mobile.loading.centered .fb_dialog_content{background:none}.loading.centered #fb_dialog_loader_close{color:#fff;display:block;padding-top:20px;clear:both;font-size:18px}#fb-root #fb_dialog_ipad_overlay{background:rgba(0, 0, 0, .45);position:absolute;left:0;top:0;width:100%;min-height:100%;z-index:10000}#fb-root #fb_dialog_ipad_overlay.hidden{display:none}.fb_dialog.fb_dialog_mobile.loading iframe{visibility:hidden}.fb_dialog_content .dialog_header{-webkit-box-shadow:white 0 1px 1px -1px inset;background:-webkit-gradient(linear, 0% 0%, 0% 100%, from(#738ABA), to(#2C4987));border-bottom:1px solid;border-color:#1d4088;color:#fff;font:14px Helvetica, sans-serif;font-weight:bold;text-overflow:ellipsis;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0;vertical-align:middle;white-space:nowrap}.fb_dialog_content .dialog_header table{-webkit-font-smoothing:subpixel-antialiased;height:43px;width:100%}.fb_dialog_content .dialog_header td.header_left{font-size:12px;padding-left:5px;vertical-align:middle;width:60px}.fb_dialog_content .dialog_header td.header_right{font-size:12px;padding-right:5px;vertical-align:middle;width:60px}.fb_dialog_content .touchable_button{background:-webkit-gradient(linear, 0% 0%, 0% 100%, from(#4966A6), color-stop(.5, #355492), to(#2A4887));border:1px solid #2f477a;-webkit-background-clip:padding-box;-webkit-border-radius:3px;-webkit-box-shadow:rgba(0, 0, 0, .117188) 0 1px 1px inset, rgba(255, 255, 255, .167969) 0 1px 0;display:inline-block;margin-top:3px;max-width:85px;line-height:18px;padding:4px 12px;position:relative}.fb_dialog_content .dialog_header .touchable_button input{border:none;background:none;color:#fff;font:12px Helvetica, sans-serif;font-weight:bold;margin:2px -12px;padding:2px 6px 3px 6px;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0}.fb_dialog_content .dialog_header .header_center{color:#fff;font-size:16px;font-weight:bold;line-height:18px;text-align:center;vertical-align:middle}.fb_dialog_content .dialog_content{background:url(https://static.xx.fbcdn.net/rsrc.php/v2/y9/r/jKEcVPZFk-2.gif) no-repeat 50% 50%;border:1px solid #555;border-bottom:0;border-top:0;height:150px}.fb_dialog_content .dialog_footer{background:#f6f7f8;border:1px solid #555;border-top-color:#ccc;height:40px}#fb_dialog_loader_close{float:left}.fb_dialog.fb_dialog_mobile .fb_dialog_close_button{text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0}.fb_dialog.fb_dialog_mobile .fb_dialog_close_icon{visibility:hidden}#fb_dialog_loader_spinner{animation:rotateSpinner 1.2s linear infinite;background-color:transparent;background-image:url(https://static.xx.fbcdn.net/rsrc.php/v2/yD/r/t-wz8gw1xG1.png);background-repeat:no-repeat;background-position:50% 50%;height:24px;width:24px}@keyframes rotateSpinner{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}\n.fb_iframe_widget{display:inline-block;position:relative}.fb_iframe_widget span{display:inline-block;position:relative;text-align:justify}.fb_iframe_widget iframe{position:absolute}.fb_iframe_widget_fluid_desktop,.fb_iframe_widget_fluid_desktop span,.fb_iframe_widget_fluid_desktop iframe{max-width:100%}.fb_iframe_widget_fluid_desktop iframe{min-width:220px;position:relative}.fb_iframe_widget_lift{z-index:1}.fb_hide_iframes iframe{position:relative;left:-10000px}.fb_iframe_widget_loader{position:relative;display:inline-block}.fb_iframe_widget_fluid{display:inline}.fb_iframe_widget_fluid span{width:100%}.fb_iframe_widget_loader iframe{min-height:32px;z-index:2;zoom:1}.fb_iframe_widget_loader .FB_Loader{background:url(https://static.xx.fbcdn.net/rsrc.php/v2/y9/r/jKEcVPZFk-2.gif) no-repeat;height:32px;width:32px;margin-left:-16px;position:absolute;left:50%;z-index:4}',
                    components: [ "css:fb.css.base", "css:fb.css.dialog", "css:fb.css.iframewidget" ]
                });
                __d("ApiClientConfig", [], {
                    FlashRequest: {
                        swfUrl: "https://connect.facebook.net/rsrc.php/v1/yd/r/mxzow1Sdmxr.swf"
                    }
                });
                __d("JSSDKCanvasPrefetcherConfig", [], {
                    blacklist: [ 0x83d70a64a992 ],
                    sampleRate: 500
                });
                __d("JSSDKPluginPipeConfig", [], {
                    threshold: 0,
                    enabledApps: {
                        "209753825810663": 1,
                        "187288694643718": 1
                    }
                });
                __d("QueryString", [], function g(e, t, i, n, r, a) {
                    if (t.__markCompiled) t.__markCompiled();
                    function o(e) {
                        var t = [];
                        ES(ES("Object", "keys", false, e).sort(), "forEach", true, function(i) {
                            var n = e[i];
                            if (typeof n === "undefined") return;
                            if (n === null) {
                                t.push(i);
                                return;
                            }
                            t.push(encodeURIComponent(i) + "=" + encodeURIComponent(n));
                        });
                        return t.join("&");
                    }
                    function s(e, t) {
                        var i = {};
                        if (e === "") return i;
                        var n = e.split("&");
                        for (var r = 0; r < n.length; r++) {
                            var a = n[r].split("=", 2), o = decodeURIComponent(a[0]);
                            if (t && i.hasOwnProperty(o)) throw new URIError("Duplicate key: " + o);
                            i[o] = a.length === 2 ? decodeURIComponent(a[1]) : null;
                        }
                        return i;
                    }
                    function l(e, t) {
                        return e + (ES(e, "indexOf", true, "?") !== -1 ? "&" : "?") + (typeof t === "string" ? t : c.encode(t));
                    }
                    var c = {
                        encode: o,
                        decode: s,
                        appendToUrl: l
                    };
                    r.exports = c;
                }, null);
                __d("ManagedError", [], function m(e, t, i, n, r, a) {
                    if (t.__markCompiled) t.__markCompiled();
                    function o(e, t) {
                        Error.prototype.constructor.call(this, e);
                        this.message = e;
                        this.innerError = t;
                    }
                    o.prototype = new Error();
                    o.prototype.constructor = o;
                    r.exports = o;
                }, null);
                __d("AssertionError", [ "ManagedError" ], function v(e, t, i, n, r, a, o) {
                    if (t.__markCompiled) t.__markCompiled();
                    function s(e) {
                        o.prototype.constructor.apply(this, arguments);
                    }
                    s.prototype = new o();
                    s.prototype.constructor = s;
                    r.exports = s;
                }, null);
                __d("sprintf", [], function y(e, t, i, n, r, a) {
                    if (t.__markCompiled) t.__markCompiled();
                    function o(e) {
                        for (var t = arguments.length, i = Array(t > 1 ? t - 1 : 0), n = 1; n < t; n++) i[n - 1] = arguments[n];
                        var r = 0;
                        return e.replace(/%s/g, function(e) {
                            return i[r++];
                        });
                    }
                    r.exports = o;
                }, null);
                __d("Assert", [ "AssertionError", "sprintf" ], function b(e, t, i, n, r, a, o, s) {
                    if (t.__markCompiled) t.__markCompiled();
                    function l(e, t) {
                        if (typeof e !== "boolean" || !e) throw new o(t);
                        return e;
                    }
                    function c(e, t, i) {
                        var n;
                        if (t === undefined) {
                            n = "undefined";
                        } else if (t === null) {
                            n = "null";
                        } else {
                            var r = Object.prototype.toString.call(t);
                            n = /\s(\w*)/.exec(r)[1].toLowerCase();
                        }
                        l(ES(e, "indexOf", true, n) !== -1, i || s("Expression is of type %s, not %s", n, e));
                        return t;
                    }
                    function u(e, t, i) {
                        l(t instanceof e, i || "Expression not instance of type");
                        return t;
                    }
                    function f(e, t) {
                        d["is" + e] = t;
                        d["maybe" + e] = function(e, i) {
                            if (e != null) t(e, i);
                        };
                    }
                    var d = {
                        isInstanceOf: u,
                        isTrue: l,
                        isTruthy: function(e, t) {
                            return l(!!e, t);
                        },
                        type: c,
                        define: function(e, t) {
                            e = e.substring(0, 1).toUpperCase() + e.substring(1).toLowerCase();
                            f(e, function(e, i) {
                                l(t(e), i);
                            });
                        }
                    };
                    ES([ "Array", "Boolean", "Date", "Function", "Null", "Number", "Object", "Regexp", "String", "Undefined" ], "forEach", true, function(e) {
                        f(e, ES(c, "bind", true, null, e.toLowerCase()));
                    });
                    r.exports = d;
                }, null);
                __d("Type", [ "Assert" ], function w(e, t, i, n, r, a, o) {
                    if (t.__markCompiled) t.__markCompiled();
                    function s() {
                        var e = this.__mixins;
                        if (e) for (var t = 0; t < e.length; t++) e[t].apply(this, arguments);
                    }
                    function l(e, t) {
                        if (t instanceof e) return true;
                        if (t instanceof s) for (var i = 0; i < t.__mixins.length; i++) if (t.__mixins[i] == e) return true;
                        return false;
                    }
                    function c(e, t) {
                        var i = e.prototype;
                        if (!ES("Array", "isArray", false, t)) t = [ t ];
                        for (var n = 0; n < t.length; n++) {
                            var r = t[n];
                            if (typeof r == "function") {
                                i.__mixins.push(r);
                                r = r.prototype;
                            }
                            ES(ES("Object", "keys", false, r), "forEach", true, function(e) {
                                i[e] = r[e];
                            });
                        }
                    }
                    function u(e, t, i) {
                        var n = t && t.hasOwnProperty("constructor") ? t.constructor : function() {
                            this.parent.apply(this, arguments);
                        };
                        o.isFunction(n);
                        if (e && e.prototype instanceof s === false) throw new Error("parent type does not inherit from Type");
                        e = e || s;
                        function r() {}
                        r.prototype = e.prototype;
                        n.prototype = new r();
                        if (t) ES("Object", "assign", false, n.prototype, t);
                        n.prototype.constructor = n;
                        n.parent = e;
                        n.prototype.__mixins = e.prototype.__mixins ? Array.prototype.slice.call(e.prototype.__mixins) : [];
                        if (i) c(n, i);
                        n.prototype.parent = function() {
                            this.parent = e.prototype.parent;
                            e.apply(this, arguments);
                        };
                        n.prototype.parentCall = function(t) {
                            return e.prototype[t].apply(this, Array.prototype.slice.call(arguments, 1));
                        };
                        n.extend = function(e, t) {
                            return u(this, e, t);
                        };
                        return n;
                    }
                    ES("Object", "assign", false, s.prototype, {
                        instanceOf: function(e) {
                            return l(e, this);
                        }
                    });
                    ES("Object", "assign", false, s, {
                        extend: function(e, t) {
                            return typeof e === "function" ? u.apply(null, arguments) : u(null, e, t);
                        },
                        instanceOf: l
                    });
                    r.exports = s;
                }, null);
                __d("ObservableMixin", [], function C(e, t, i, n, r, a) {
                    if (t.__markCompiled) t.__markCompiled();
                    function o() {
                        this.__observableEvents = {};
                    }
                    o.prototype = {
                        inform: function(e) {
                            var t = Array.prototype.slice.call(arguments, 1), i = Array.prototype.slice.call(this.getSubscribers(e));
                            for (var n = 0; n < i.length; n++) {
                                if (i[n] === null) continue;
                                try {
                                    i[n].apply(this, t);
                                } catch (r) {
                                    setTimeout(function() {
                                        throw r;
                                    }, 0);
                                }
                            }
                            return this;
                        },
                        getSubscribers: function(e) {
                            return this.__observableEvents[e] || (this.__observableEvents[e] = []);
                        },
                        clearSubscribers: function(e) {
                            if (e) this.__observableEvents[e] = [];
                            return this;
                        },
                        clearAllSubscribers: function() {
                            this.__observableEvents = {};
                            return this;
                        },
                        subscribe: function(e, t) {
                            var i = this.getSubscribers(e);
                            i.push(t);
                            return this;
                        },
                        unsubscribe: function(e, t) {
                            var i = this.getSubscribers(e);
                            for (var n = 0; n < i.length; n++) if (i[n] === t) {
                                i.splice(n, 1);
                                break;
                            }
                            return this;
                        },
                        monitor: function(e, t) {
                            if (!t()) {
                                var i = ES(function(n) {
                                    if (t.apply(t, arguments)) this.unsubscribe(e, i);
                                }, "bind", true, this);
                                this.subscribe(e, i);
                            }
                            return this;
                        }
                    };
                    r.exports = o;
                }, null);
                __d("sdk.Model", [ "Type", "ObservableMixin" ], function x(e, t, i, n, r, a, o, s) {
                    if (t.__markCompiled) t.__markCompiled();
                    var l = o.extend({
                        constructor: function(e) {
                            this.parent();
                            var t = {}, i = this;
                            ES(ES("Object", "keys", false, e), "forEach", true, function(n) {
                                t[n] = e[n];
                                i["set" + n] = function(e) {
                                    if (e === t[n]) return this;
                                    t[n] = e;
                                    i.inform(n + ".change", e);
                                    return i;
                                };
                                i["get" + n] = function() {
                                    return t[n];
                                };
                            });
                        }
                    }, s);
                    r.exports = l;
                }, null);
                __d("sdk.Runtime", [ "sdk.Model", "JSSDKRuntimeConfig" ], function _(e, t, i, n, r, a, o, s) {
                    if (t.__markCompiled) t.__markCompiled();
                    var l = {
                        UNKNOWN: 0,
                        PAGETAB: 1,
                        CANVAS: 2,
                        PLATFORM: 4
                    }, c = new o({
                        AccessToken: "",
                        ClientID: "",
                        CookieUserID: "",
                        Environment: l.UNKNOWN,
                        Initialized: false,
                        IsVersioned: false,
                        KidDirectedSite: undefined,
                        Locale: s.locale,
                        LoginStatus: undefined,
                        Revision: s.revision,
                        Rtl: s.rtl,
                        Scope: undefined,
                        Secure: undefined,
                        UseCookie: false,
                        UserID: "",
                        Version: undefined
                    });
                    ES("Object", "assign", false, c, {
                        ENVIRONMENTS: l,
                        isEnvironment: function(e) {
                            var t = this.getEnvironment();
                            return (e | t) === t;
                        },
                        isCanvasEnvironment: function() {
                            return this.isEnvironment(l.CANVAS) || this.isEnvironment(l.PAGETAB);
                        }
                    });
                    (function() {
                        var e = /app_runner/.test(window.name) ? l.PAGETAB : /iframe_canvas/.test(window.name) ? l.CANVAS : l.UNKNOWN;
                        if ((e | l.PAGETAB) === e) e = e | l.CANVAS;
                        c.setEnvironment(e);
                    })();
                    r.exports = c;
                }, null);
                __d("sdk.Cookie", [ "QueryString", "sdk.Runtime" ], function S(e, t, i, n, r, a, o, s) {
                    if (t.__markCompiled) t.__markCompiled();
                    var l = null;
                    function c(e, t, i) {
                        e = e + s.getClientID();
                        var n = l && l !== ".";
                        if (n) {
                            document.cookie = e + "=; expires=Wed, 04 Feb 2004 08:00:00 GMT;";
                            document.cookie = e + "=; expires=Wed, 04 Feb 2004 08:00:00 GMT;" + "domain=" + location.hostname + ";";
                        }
                        var r = new Date(i).toGMTString();
                        document.cookie = e + "=" + t + (t && i === 0 ? "" : "; expires=" + r) + "; path=/" + (n ? "; domain=" + l : "");
                    }
                    function u(e) {
                        e = e + s.getClientID();
                        var t = new RegExp("\\b" + e + "=([^;]*)\\b");
                        return t.test(document.cookie) ? RegExp.$1 : null;
                    }
                    var f = {
                        setDomain: function(e) {
                            l = e;
                            var t = o.encode({
                                base_domain: l && l !== "." ? l : ""
                            }), i = new Date();
                            i.setFullYear(i.getFullYear() + 1);
                            c("fbm_", t, i.getTime());
                        },
                        getDomain: function() {
                            return l;
                        },
                        loadMeta: function() {
                            var e = u("fbm_");
                            if (e) {
                                var t = o.decode(e);
                                if (!l) l = t.base_domain;
                                return t;
                            }
                        },
                        loadSignedRequest: function() {
                            return u("fbsr_");
                        },
                        setSignedRequestCookie: function(e, t) {
                            if (!e) throw new Error("Value passed to Cookie.setSignedRequestCookie " + "was empty.");
                            c("fbsr_", e, t);
                        },
                        clearSignedRequestCookie: function() {
                            c("fbsr_", "", 0);
                        },
                        setRaw: c
                    };
                    r.exports = f;
                }, null);
                __d("wrapFunction", [], function k(e, t, i, n, r, a) {
                    if (t.__markCompiled) t.__markCompiled();
                    var o = {};
                    function s(e, t, i) {
                        t = t || "default";
                        return function() {
                            var n = t in o ? o[t](e, i) : e;
                            return n.apply(this, arguments);
                        };
                    }
                    s.setWrapper = function(e, t) {
                        t = t || "default";
                        o[t] = e;
                    };
                    r.exports = s;
                }, null);
                __d("DOMEventListener", [ "wrapFunction" ], function A(e, t, i, n, r, a, o) {
                    if (t.__markCompiled) t.__markCompiled();
                    var s, l;
                    if (window.addEventListener) {
                        s = function(e, t, i) {
                            i.wrapper = o(i, "entry", "DOMEventListener.add " + t);
                            e.addEventListener(t, i.wrapper, false);
                        };
                        l = function(e, t, i) {
                            e.removeEventListener(t, i.wrapper, false);
                        };
                    } else if (window.attachEvent) {
                        s = function(e, t, i) {
                            i.wrapper = o(i, "entry", "DOMEventListener.add " + t);
                            e.attachEvent("on" + t, i.wrapper);
                        };
                        l = function(e, t, i) {
                            e.detachEvent("on" + t, i.wrapper);
                        };
                    } else l = s = function() {};
                    var c = {
                        add: function(e, t, i) {
                            s(e, t, i);
                            return {
                                remove: function() {
                                    l(e, t, i);
                                    e = null;
                                }
                            };
                        },
                        remove: l
                    };
                    r.exports = c;
                }, null);
                __d("sdk.UA", [], function E(e, t, i, n, r, a) {
                    if (t.__markCompiled) t.__markCompiled();
                    var o = navigator.userAgent, s = {
                        iphone: /\b(iPhone|iP[ao]d)/.test(o),
                        ipad: /\b(iP[ao]d)/.test(o),
                        android: /Android/i.test(o),
                        nativeApp: /FBAN\/\w+;/i.test(o)
                    }, l = /Mobile/i.test(o), c = {
                        ie: "",
                        firefox: "",
                        chrome: "",
                        webkit: "",
                        osx: ""
                    }, u = /(?:MSIE.(\d+\.\d+))|(?:(?:Firefox|GranParadiso|Iceweasel).(\d+\.\d+))|(?:AppleWebKit.(\d+(?:\.\d+)?))|(?:Trident\/\d+\.\d+.*rv:(\d+\.\d+))/.exec(o);
                    if (u) {
                        c.ie = u[1] ? parseFloat(u[1]) : u[4] ? parseFloat(u[4]) : "";
                        c.firefox = u[2] || "";
                        c.webkit = u[3] || "";
                        if (u[3]) {
                            var f = /(?:Chrome\/(\d+\.\d+))/.exec(o);
                            c.chrome = f ? f[1] : "";
                        }
                    }
                    var d = /(?:Mac OS X (\d+(?:[._]\d+)?))/.exec(o);
                    if (d) c.osx = d[1];
                    function h(e) {
                        return ES(e.split("."), "map", true, function(e) {
                            return parseFloat(e);
                        });
                    }
                    var p = {};
                    ES(ES("Object", "keys", false, c), "map", true, function(e) {
                        p[e] = function() {
                            return parseFloat(c[e]);
                        };
                        p[e].getVersionParts = function() {
                            return h(c[e]);
                        };
                    });
                    ES(ES("Object", "keys", false, s), "map", true, function(e) {
                        p[e] = function() {
                            return s[e];
                        };
                    });
                    p.mobile = function() {
                        return s.iphone || s.ipad || s.android || l;
                    };
                    r.exports = p;
                }, null);
                __d("getBlankIframeSrc", [ "sdk.UA" ], function T(e, t, i, n, r, a, o) {
                    if (t.__markCompiled) t.__markCompiled();
                    function s() {
                        return o.ie() < 10 ? "javascript:false" : "about:blank";
                    }
                    r.exports = s;
                }, null);
                __d("guid", [], function P(e, t, i, n, r, a) {
                    if (t.__markCompiled) t.__markCompiled();
                    function o() {
                        return "f" + (Math.random() * (1 << 30)).toString(16).replace(".", "");
                    }
                    r.exports = o;
                }, null);
                __d("UserAgent_DEPRECATED", [], function I(e, t, i, n, r, a) {
                    if (t.__markCompiled) t.__markCompiled();
                    var o = false, s, l, c, u, f, d, h, p, g, m, v, y, b, w, C;
                    function x() {
                        if (o) return;
                        o = true;
                        var e = navigator.userAgent, t = /(?:MSIE.(\d+\.\d+))|(?:(?:Firefox|GranParadiso|Iceweasel).(\d+\.\d+))|(?:Opera(?:.+Version.|.)(\d+\.\d+))|(?:AppleWebKit.(\d+(?:\.\d+)?))|(?:Trident\/\d+\.\d+.*rv:(\d+\.\d+))/.exec(e), i = /(Mac OS X)|(Windows)|(Linux)/.exec(e);
                        y = /\b(iPhone|iP[ao]d)/.exec(e);
                        b = /\b(iP[ao]d)/.exec(e);
                        m = /Android/i.exec(e);
                        w = /FBAN\/\w+;/i.exec(e);
                        C = /Mobile/i.exec(e);
                        v = !!/Win64/.exec(e);
                        if (t) {
                            s = t[1] ? parseFloat(t[1]) : t[5] ? parseFloat(t[5]) : NaN;
                            if (s && document && document.documentMode) s = document.documentMode;
                            var n = /(?:Trident\/(\d+.\d+))/.exec(e);
                            d = n ? parseFloat(n[1]) + 4 : s;
                            l = t[2] ? parseFloat(t[2]) : NaN;
                            c = t[3] ? parseFloat(t[3]) : NaN;
                            u = t[4] ? parseFloat(t[4]) : NaN;
                            if (u) {
                                t = /(?:Chrome\/(\d+\.\d+))/.exec(e);
                                f = t && t[1] ? parseFloat(t[1]) : NaN;
                            } else f = NaN;
                        } else s = l = c = f = u = NaN;
                        if (i) {
                            if (i[1]) {
                                var r = /(?:Mac OS X (\d+(?:[._]\d+)?))/.exec(e);
                                h = r ? parseFloat(r[1].replace("_", ".")) : true;
                            } else h = false;
                            p = !!i[2];
                            g = !!i[3];
                        } else h = p = g = false;
                    }
                    var _ = {
                        ie: function() {
                            return x() || s;
                        },
                        ieCompatibilityMode: function() {
                            return x() || d > s;
                        },
                        ie64: function() {
                            return _.ie() && v;
                        },
                        firefox: function() {
                            return x() || l;
                        },
                        opera: function() {
                            return x() || c;
                        },
                        webkit: function() {
                            return x() || u;
                        },
                        safari: function() {
                            return _.webkit();
                        },
                        chrome: function() {
                            return x() || f;
                        },
                        windows: function() {
                            return x() || p;
                        },
                        osx: function() {
                            return x() || h;
                        },
                        linux: function() {
                            return x() || g;
                        },
                        iphone: function() {
                            return x() || y;
                        },
                        mobile: function() {
                            return x() || (y || b || m || C);
                        },
                        nativeApp: function() {
                            return x() || w;
                        },
                        android: function() {
                            return x() || m;
                        },
                        ipad: function() {
                            return x() || b;
                        }
                    };
                    r.exports = _;
                }, null);
                __d("hasNamePropertyBug", [ "guid", "UserAgent_DEPRECATED" ], function O(e, t, i, n, r, a, o, s) {
                    if (t.__markCompiled) t.__markCompiled();
                    var l = s.ie() ? undefined : false;
                    function c() {
                        var e = document.createElement("form"), t = e.appendChild(document.createElement("input"));
                        t.name = o();
                        l = t !== e.elements[t.name];
                        e = t = null;
                        return l;
                    }
                    function u() {
                        return typeof l === "undefined" ? c() : l;
                    }
                    r.exports = u;
                }, null);
                __d("sdk.createIframe", [ "DOMEventListener", "getBlankIframeSrc", "guid", "hasNamePropertyBug" ], function D(e, t, i, n, r, a, o, s, l, c) {
                    if (t.__markCompiled) t.__markCompiled();
                    function u(e) {
                        e = ES("Object", "assign", false, {}, e);
                        var t, i = e.name || l(), n = e.root, r = e.style || {
                            border: "none"
                        }, a = e.url, u = e.onload, f = e.onerror;
                        if (c()) {
                            t = document.createElement('<iframe name="' + i + '"/>');
                        } else {
                            t = document.createElement("iframe");
                            t.name = i;
                        }
                        delete e.style;
                        delete e.name;
                        delete e.url;
                        delete e.root;
                        delete e.onload;
                        delete e.onerror;
                        var d = ES("Object", "assign", false, {
                            frameBorder: 0,
                            allowTransparency: true,
                            allowFullscreen: true,
                            scrolling: "no"
                        }, e);
                        if (d.width) t.width = d.width + "px";
                        if (d.height) t.height = d.height + "px";
                        delete d.height;
                        delete d.width;
                        for (var h in d) if (d.hasOwnProperty(h)) t.setAttribute(h, d[h]);
                        ES("Object", "assign", false, t.style, r);
                        t.src = s();
                        n.appendChild(t);
                        if (u) var p = o.add(t, "load", function() {
                            p.remove();
                            u();
                        });
                        if (f) var g = o.add(t, "error", function() {
                            g.remove();
                            f();
                        });
                        t.src = a;
                        return t;
                    }
                    r.exports = u;
                }, null);
                __d("DOMWrapper", [], function R(e, t, i, n, r, a) {
                    if (t.__markCompiled) t.__markCompiled();
                    var o, s, l = {
                        setRoot: function(e) {
                            o = e;
                        },
                        getRoot: function() {
                            return o || document.body;
                        },
                        setWindow: function(e) {
                            s = e;
                        },
                        getWindow: function() {
                            return s || self;
                        }
                    };
                    r.exports = l;
                }, null);
                __d("eprintf", [], function L(e, t, i, n, r, a) {
                    if (t.__markCompiled) t.__markCompiled();
                    var o = function(e) {
                        var t = ES(Array.prototype.slice.call(arguments), "map", true, function(e) {
                            return String(e);
                        }), i = e.split("%s").length - 1;
                        if (i !== t.length - 1) return o("eprintf args number mismatch: %s", ES("JSON", "stringify", false, t));
                        var n = 1;
                        return e.replace(/%s/g, function(e) {
                            return String(t[n++]);
                        });
                    };
                    r.exports = o;
                }, null);
                __d("ex", [ "eprintf" ], function F(e, t, i, n, r, a, o) {
                    if (t.__markCompiled) t.__markCompiled();
                    var s = function() {
                        for (var e = arguments.length, t = Array(e), i = 0; i < e; i++) t[i] = arguments[i];
                        t = ES(t, "map", true, function(e) {
                            return String(e);
                        });
                        if (t[0].split("%s").length !== t.length) return s("ex args number mismatch: %s", ES("JSON", "stringify", false, t));
                        return s._prefix + ES("JSON", "stringify", false, t) + s._suffix;
                    };
                    s._prefix = "<![EX[";
                    s._suffix = "]]>";
                    r.exports = s;
                }, null);
                __d("invariant", [ "ex", "sprintf" ], function M(e, t, i, n, r, a, o, s) {
                    if (t.__markCompiled) t.__markCompiled();
                    var l = o;
                    function c(e, t) {
                        if (!e) {
                            var i;
                            if (t === undefined) {
                                i = new Error("Minified exception occurred; use the non-minified dev environment " + "for the full error message and additional helpful warnings.");
                            } else {
                                var n = [ t ];
                                for (var r = 2, a = arguments.length; r < a; r++) n.push(arguments[r]);
                                i = new Error(l.apply(null, n));
                                i.name = "Invariant Violation";
                                i.messageWithParams = n;
                            }
                            i.framesToPop = 1;
                            throw i;
                        }
                    }
                    r.exports = c;
                }, null);
                __d("sdk.feature", [ "JSSDKConfig", "invariant" ], function N(e, t, i, n, r, a, o, s) {
                    if (t.__markCompiled) t.__markCompiled();
                    function l(e, t) {
                        !(arguments.length >= 2) ? s(0) : undefined;
                        if (o.features && e in o.features) {
                            var i = o.features[e];
                            if (typeof i === "object" && typeof i.rate === "number") {
                                if (i.rate && Math.random() * 100 <= i.rate) {
                                    return i.value || true;
                                } else return i.value ? null : false;
                            } else return i;
                        }
                        return t;
                    }
                    r.exports = l;
                }, null);
                __d("sdk.getContextType", [ "sdk.Runtime", "sdk.UA" ], function B(e, t, i, n, r, a, o, s) {
                    if (t.__markCompiled) t.__markCompiled();
                    function l() {
                        if (s.nativeApp()) return 3;
                        if (s.mobile()) return 2;
                        if (o.isEnvironment(o.ENVIRONMENTS.CANVAS)) return 5;
                        return 1;
                    }
                    r.exports = l;
                }, null);
                __d("Log", [ "sprintf" ], function j(e, t, i, n, r, a, o) {
                    if (t.__markCompiled) t.__markCompiled();
                    var s = {
                        DEBUG: 3,
                        INFO: 2,
                        WARNING: 1,
                        ERROR: 0
                    };
                    function l(e, t) {
                        var i = Array.prototype.slice.call(arguments, 2), n = o.apply(null, i), r = window.console;
                        if (r && c.level >= t) r[e in r ? e : "log"](n);
                    }
                    var c = {
                        level: -1,
                        Level: s,
                        debug: ES(l, "bind", true, null, "debug", s.DEBUG),
                        info: ES(l, "bind", true, null, "info", s.INFO),
                        warn: ES(l, "bind", true, null, "warn", s.WARNING),
                        error: ES(l, "bind", true, null, "error", s.ERROR)
                    };
                    r.exports = c;
                }, null);
                __d("sdk.domReady", [], function U(e, t, i, n, r, a) {
                    if (t.__markCompiled) t.__markCompiled();
                    var o, s = "readyState" in document ? /loaded|complete/.test(document.readyState) : !!document.body;
                    function l() {
                        if (!o) return;
                        var e;
                        while (e = o.shift()) e();
                        o = null;
                    }
                    function c(e) {
                        if (o) {
                            o.push(e);
                            return;
                        } else e();
                    }
                    if (!s) {
                        o = [];
                        if (document.addEventListener) {
                            document.addEventListener("DOMContentLoaded", l, false);
                            window.addEventListener("load", l, false);
                        } else if (document.attachEvent) {
                            document.attachEvent("onreadystatechange", l);
                            window.attachEvent("onload", l);
                        }
                        if (document.documentElement.doScroll && window == window.top) {
                            var u = function() {
                                try {
                                    document.documentElement.doScroll("left");
                                } catch (e) {
                                    setTimeout(u, 0);
                                    return;
                                }
                                l();
                            };
                            u();
                        }
                    }
                    r.exports = c;
                }, 3);
                __d("sdk.Content", [ "Log", "sdk.UA", "sdk.domReady" ], function z(e, t, i, n, r, a, o, s, l) {
                    if (t.__markCompiled) t.__markCompiled();
                    var c, u, f = {
                        append: function(e, t) {
                            if (!t) if (!c) {
                                c = t = document.getElementById("fb-root");
                                if (!t) {
                                    o.warn('The "fb-root" div has not been created, auto-creating');
                                    c = t = document.createElement("div");
                                    t.id = "fb-root";
                                    if (s.ie() || !document.body) {
                                        l(function() {
                                            document.body.appendChild(t);
                                        });
                                    } else document.body.appendChild(t);
                                }
                                t.className += " fb_reset";
                            } else t = c;
                            if (typeof e == "string") {
                                var i = document.createElement("div");
                                t.appendChild(i).innerHTML = e;
                                return i;
                            } else return t.appendChild(e);
                        },
                        appendHidden: function(e) {
                            if (!t) {
                                var t = document.createElement("div"), i = t.style;
                                i.position = "absolute";
                                i.top = "-10000px";
                                i.width = i.height = 0;
                                t = f.append(t);
                            }
                            return f.append(e, t);
                        },
                        submitToTarget: function(e, t) {
                            var i = document.createElement("form");
                            i.action = e.url;
                            i.target = e.target;
                            i.method = t ? "GET" : "POST";
                            f.appendHidden(i);
                            for (var n in e.params) if (e.params.hasOwnProperty(n)) {
                                var r = e.params[n];
                                if (r !== null && r !== undefined) {
                                    var a = document.createElement("input");
                                    a.name = n;
                                    a.value = r;
                                    i.appendChild(a);
                                }
                            }
                            i.submit();
                            i.parentNode.removeChild(i);
                        }
                    };
                    r.exports = f;
                }, null);
                __d("Miny", [], function q(e, t, i, n, r, a) {
                    if (t.__markCompiled) t.__markCompiled();
                    var o = "Miny1", s = "wxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-_".split(""), l = {
                        encode: function(e) {
                            if (/^$|[~\\]|__proto__/.test(e)) return e;
                            var t = e.match(/\w+|\W+/g), i, n = ES("Object", "create", false, null);
                            for (i = 0; i < t.length; i++) n[t[i]] = (n[t[i]] || 0) + 1;
                            var r = ES("Object", "keys", false, n);
                            r.sort(function(e, t) {
                                return n[t] - n[e];
                            });
                            for (i = 0; i < r.length; i++) {
                                var a = (i - i % 32) / 32;
                                n[r[i]] = a ? a.toString(32) + s[i % 32] : s[i % 32];
                            }
                            var l = "";
                            for (i = 0; i < t.length; i++) l += n[t[i]];
                            r.unshift(o, r.length);
                            r.push(l);
                            return r.join("~");
                        }
                    };
                    r.exports = l;
                }, null);
                __d("UrlMap", [ "UrlMapConfig" ], function W(e, t, i, n, r, a, o) {
                    if (t.__markCompiled) t.__markCompiled();
                    var s = {
                        resolve: function(e, t) {
                            var i = typeof t == "undefined" ? location.protocol.replace(":", "") : t ? "https" : "http";
                            if (e in o) return i + "://" + o[e];
                            if (typeof t == "undefined" && e + "_" + i in o) return i + "://" + o[e + "_" + i];
                            if (t !== true && e + "_http" in o) return "http://" + o[e + "_http"];
                            if (t !== false && e + "_https" in o) return "https://" + o[e + "_https"];
                        }
                    };
                    r.exports = s;
                }, null);
                __d("dotAccess", [], function H(e, t, i, n, r, a) {
                    if (t.__markCompiled) t.__markCompiled();
                    function o(e, t, i) {
                        var n = t.split(".");
                        do {
                            var r = n.shift();
                            e = e[r] || i && (e[r] = {});
                        } while (n.length && e);
                        return e;
                    }
                    r.exports = o;
                }, null);
                __d("GlobalCallback", [ "DOMWrapper", "dotAccess", "guid", "wrapFunction" ], function G(e, t, i, n, r, a, o, s, l, c) {
                    if (t.__markCompiled) t.__markCompiled();
                    var u, f, d = {
                        setPrefix: function(e) {
                            u = s(o.getWindow(), e, true);
                            f = e;
                        },
                        create: function(e, t) {
                            if (!u) this.setPrefix("__globalCallbacks");
                            var i = l();
                            u[i] = c(e, "entry", t || "GlobalCallback");
                            return f + "." + i;
                        },
                        remove: function(e) {
                            var t = e.substring(f.length + 1);
                            delete u[t];
                        }
                    };
                    r.exports = d;
                }, null);
                __d("insertIframe", [ "GlobalCallback", "getBlankIframeSrc", "guid" ], function V(e, t, i, n, r, a, o, s, l) {
                    if (t.__markCompiled) t.__markCompiled();
                    function c(e) {
                        e.id = e.id || l();
                        e.name = e.name || l();
                        var t = false, i = false, n = function() {
                            if (t && !i) {
                                i = true;
                                e.onload && e.onload(e.root.firstChild);
                            }
                        }, r = o.create(n);
                        if (document.attachEvent) {
                            var a = "<iframe" + ' id="' + e.id + '"' + ' name="' + e.name + '"' + (e.title ? ' title="' + e.title + '"' : "") + (e.className ? ' class="' + e.className + '"' : "") + ' style="border:none;' + (e.width ? "width:" + e.width + "px;" : "") + (e.height ? "height:" + e.height + "px;" : "") + '"' + ' src="' + s() + '"' + ' frameborder="0"' + ' scrolling="no"' + ' allowtransparency="true"' + ' onload="' + r + '()"' + "></iframe>";
                            e.root.innerHTML = '<iframe src="' + s() + '"' + ' frameborder="0"' + ' scrolling="no"' + ' style="height:1px"></iframe>';
                            t = true;
                            setTimeout(function() {
                                e.root.innerHTML = a;
                                e.root.firstChild.src = e.url;
                                e.onInsert && e.onInsert(e.root.firstChild);
                            }, 0);
                        } else {
                            var c = document.createElement("iframe");
                            c.id = e.id;
                            c.name = e.name;
                            c.onload = n;
                            c.scrolling = "no";
                            c.style.border = "none";
                            c.style.overflow = "hidden";
                            if (e.title) c.title = e.title;
                            if (e.className) c.className = e.className;
                            if (e.height !== undefined) c.style.height = e.height + "px";
                            if (e.width !== undefined) if (e.width == "100%") {
                                c.style.width = e.width;
                            } else c.style.width = e.width + "px";
                            e.root.appendChild(c);
                            t = true;
                            c.src = e.url;
                            e.onInsert && e.onInsert(c);
                        }
                    }
                    r.exports = c;
                }, null);
                __d("sdk.Impressions", [ "sdk.Content", "Miny", "QueryString", "sdk.Runtime", "UrlMap", "getBlankIframeSrc", "guid", "insertIframe" ], function $(e, t, i, n, r, a, o, s, l, c, u, f, d, h) {
                    if (t.__markCompiled) t.__markCompiled();
                    function p(e) {
                        var t = c.getClientID();
                        if (!e.api_key && t) e.api_key = t;
                        e.kid_directed_site = c.getKidDirectedSite();
                        var i = u.resolve("www", true) + "/impression.php/" + d() + "/", n = l.appendToUrl(i, e);
                        if (n.length > 2e3) if (e.payload && typeof e.payload === "string") {
                            var r = s.encode(e.payload);
                            if (r && r.length < e.payload.length) {
                                e.payload = r;
                                n = l.appendToUrl(i, e);
                            }
                        }
                        if (n.length <= 2e3) {
                            var a = new Image();
                            a.src = n;
                        } else {
                            var p = d(), g = o.appendHidden("");
                            h({
                                url: f(),
                                root: g,
                                name: p,
                                className: "fb_hidden fb_invisible",
                                onload: function() {
                                    g.parentNode.removeChild(g);
                                }
                            });
                            o.submitToTarget({
                                url: i,
                                target: p,
                                params: e
                            });
                        }
                    }
                    var g = {
                        log: function(e, t) {
                            if (!t.source) t.source = "jssdk";
                            p({
                                lid: e,
                                payload: ES("JSON", "stringify", false, t)
                            });
                        },
                        impression: p
                    };
                    r.exports = g;
                }, null);
                __d("Base64", [], function Y(e, t, i, n, r, a) {
                    if (t.__markCompiled) t.__markCompiled();
                    var o = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
                    function s(e) {
                        e = e.charCodeAt(0) << 16 | e.charCodeAt(1) << 8 | e.charCodeAt(2);
                        return String.fromCharCode(o.charCodeAt(e >>> 18), o.charCodeAt(e >>> 12 & 63), o.charCodeAt(e >>> 6 & 63), o.charCodeAt(e & 63));
                    }
                    var l = ">___?456789:;<=_______" + "\x00\b	\n\f\r" + "______ !\"#$%&'()*+,-./0123";
                    function c(e) {
                        e = l.charCodeAt(e.charCodeAt(0) - 43) << 18 | l.charCodeAt(e.charCodeAt(1) - 43) << 12 | l.charCodeAt(e.charCodeAt(2) - 43) << 6 | l.charCodeAt(e.charCodeAt(3) - 43);
                        return String.fromCharCode(e >>> 16, e >>> 8 & 255, e & 255);
                    }
                    var u = {
                        encode: function(e) {
                            e = unescape(encodeURI(e));
                            var t = (e.length + 2) % 3;
                            e = (e + "\x00\x00".slice(t)).replace(/[\s\S]{3}/g, s);
                            return e.slice(0, e.length + t - 2) + "==".slice(t);
                        },
                        decode: function(e) {
                            e = e.replace(/[^A-Za-z0-9+\/]/g, "");
                            var t = e.length + 3 & 3;
                            e = (e + "AAA".slice(t)).replace(/..../g, c);
                            e = e.slice(0, e.length + t - 3);
                            try {
                                return decodeURIComponent(escape(e));
                            } catch (i) {
                                throw new Error("Not valid UTF-8");
                            }
                        },
                        encodeObject: function(e) {
                            return u.encode(ES("JSON", "stringify", false, e));
                        },
                        decodeObject: function(e) {
                            return ES("JSON", "parse", false, u.decode(e));
                        },
                        encodeNums: function(e) {
                            return String.fromCharCode.apply(String, ES(e, "map", true, function(e) {
                                return o.charCodeAt((e | -(e > 63)) & -(e > 0) & 63);
                            }));
                        }
                    };
                    r.exports = u;
                }, null);
                __d("sdk.SignedRequest", [ "Base64" ], function X(e, t, i, n, r, a, o) {
                    if (t.__markCompiled) t.__markCompiled();
                    function s(e) {
                        if (!e) return null;
                        var t = e.split(".", 2)[1].replace(/\-/g, "+").replace(/\_/g, "/");
                        return o.decodeObject(t);
                    }
                    var l = {
                        parse: s
                    };
                    r.exports = l;
                }, null);
                __d("URIRFC3986", [], function J(e, t, i, n, r, a) {
                    if (t.__markCompiled) t.__markCompiled();
                    var o = new RegExp("^" + "([^:/?#]+:)?" + "(//" + "([^\\\\/?#@]*@)?" + "(" + "\\[[A-Fa-f0-9:.]+\\]|" + "[^\\/?#:]*" + ")" + "(:[0-9]*)?" + ")?" + "([^?#]*)" + "(\\?[^#]*)?" + "(#.*)?"), s = {
                        parse: function(e) {
                            if (ES(e, "trim", true) === "") return null;
                            var t = e.match(o), i = {};
                            i.uri = t[0] ? t[0] : null;
                            i.scheme = t[1] ? t[1].substr(0, t[1].length - 1) : null;
                            i.authority = t[2] ? t[2].substr(2) : null;
                            i.userinfo = t[3] ? t[3].substr(0, t[3].length - 1) : null;
                            i.host = t[2] ? t[4] : null;
                            i.port = t[5] ? t[5].substr(1) ? parseInt(t[5].substr(1), 10) : null : null;
                            i.path = t[6] ? t[6] : null;
                            i.query = t[7] ? t[7].substr(1) : null;
                            i.fragment = t[8] ? t[8].substr(1) : null;
                            i.isGenericURI = i.authority === null && !!i.scheme;
                            return i;
                        }
                    };
                    r.exports = s;
                }, null);
                __d("createObjectFrom", [], function K(e, t, i, n, r, a) {
                    if (t.__markCompiled) t.__markCompiled();
                    function o(e, t) {
                        var i = {}, n = ES("Array", "isArray", false, t);
                        if (t === undefined) t = true;
                        for (var r = e.length - 1; r >= 0; r--) i[e[r]] = n ? t[r] : t;
                        return i;
                    }
                    r.exports = o;
                }, null);
                __d("URISchemes", [ "createObjectFrom" ], function Q(e, t, i, n, r, a, o) {
                    if (t.__markCompiled) t.__markCompiled();
                    var s = o([ "blob", "fb", "fb-ama", "fb-messenger", "fbcf", "fbconnect", "fbmobilehome", "fbrpc", "file", "ftp", "http", "https", "mailto", "ms-app", "intent", "itms", "itms-apps", "itms-services", "market", "svn+ssh", "fbstaging", "tel", "sms", "pebblejs", "sftp" ]), l = {
                        isAllowed: function(e) {
                            if (!e) return true;
                            return s.hasOwnProperty(e.toLowerCase());
                        }
                    };
                    r.exports = l;
                }, null);
                __d("URIBase", [ "URIRFC3986", "URISchemes", "ex", "invariant" ], function Z(e, t, i, n, r, a, o, s, l, c) {
                    if (t.__markCompiled) t.__markCompiled();
                    var u = new RegExp("[\\x00-\\x2c\\x2f\\x3b-\\x40\\x5c\\x5e\\x60\\x7b-\\x7f" + "\\uFDD0-\\uFDEF\\uFFF0-\\uFFFF" + "\\u2047\\u2048\\uFE56\\uFE5F\\uFF03\\uFF0F\\uFF1F]"), f = new RegExp("^(?:[^/]*:|" + "[\\x00-\\x1f]*/[\\x00-\\x1f]*/)");
                    function d(e, t, i, n) {
                        if (!t) return true;
                        if (t instanceof p) {
                            e.setProtocol(t.getProtocol());
                            e.setDomain(t.getDomain());
                            e.setPort(t.getPort());
                            e.setPath(t.getPath());
                            e.setQueryData(n.deserialize(n.serialize(t.getQueryData())));
                            e.setFragment(t.getFragment());
                            e.setForceFragmentSeparator(t.getForceFragmentSeparator());
                            return true;
                        }
                        t = ES(t.toString(), "trim", true);
                        var r = o.parse(t) || {};
                        if (!i && !s.isAllowed(r.scheme)) return false;
                        e.setProtocol(r.scheme || "");
                        if (!i && u.test(r.host)) return false;
                        e.setDomain(r.host || "");
                        e.setPort(r.port || "");
                        e.setPath(r.path || "");
                        if (i) {
                            e.setQueryData(n.deserialize(r.query) || {});
                        } else try {
                            e.setQueryData(n.deserialize(r.query) || {});
                        } catch (a) {
                            return false;
                        }
                        e.setFragment(r.fragment || "");
                        if (r.fragment === "") e.setForceFragmentSeparator(true);
                        if (r.userinfo !== null) if (i) {
                            throw new Error(l("URI.parse: invalid URI (userinfo is not allowed in a URI): %s", e.toString()));
                        } else return false;
                        if (!e.getDomain() && ES(e.getPath(), "indexOf", true, "\\") !== -1) if (i) {
                            throw new Error(l("URI.parse: invalid URI (no domain but multiple back-slashes): %s", e.toString()));
                        } else return false;
                        if (!e.getProtocol() && f.test(t)) if (i) {
                            throw new Error(l("URI.parse: invalid URI (unsafe protocol-relative URLs): %s", e.toString()));
                        } else return false;
                        return true;
                    }
                    var h = [];
                    function p(e, t) {
                        !t ? c(0) : undefined;
                        this.$URIBase1 = t;
                        this.$URIBase2 = "";
                        this.$URIBase3 = "";
                        this.$URIBase4 = "";
                        this.$URIBase5 = "";
                        this.$URIBase6 = "";
                        this.$URIBase7 = {};
                        this.$URIBase8 = false;
                        d(this, e, true, t);
                    }
                    p.prototype.setProtocol = function(e) {
                        !s.isAllowed(e) ? c(0) : undefined;
                        this.$URIBase2 = e;
                        return this;
                    };
                    p.prototype.getProtocol = function(e) {
                        return this.$URIBase2;
                    };
                    p.prototype.setSecure = function(e) {
                        return this.setProtocol(e ? "https" : "http");
                    };
                    p.prototype.isSecure = function() {
                        return this.getProtocol() === "https";
                    };
                    p.prototype.setDomain = function(e) {
                        if (u.test(e)) throw new Error(l("URI.setDomain: unsafe domain specified: %s for url %s", e, this.toString()));
                        this.$URIBase3 = e;
                        return this;
                    };
                    p.prototype.getDomain = function() {
                        return this.$URIBase3;
                    };
                    p.prototype.setPort = function(e) {
                        this.$URIBase4 = e;
                        return this;
                    };
                    p.prototype.getPort = function() {
                        return this.$URIBase4;
                    };
                    p.prototype.setPath = function(e) {
                        this.$URIBase5 = e;
                        return this;
                    };
                    p.prototype.getPath = function() {
                        return this.$URIBase5;
                    };
                    p.prototype.addQueryData = function(e, t) {
                        if (Object.prototype.toString.call(e) === "[object Object]") {
                            ES("Object", "assign", false, this.$URIBase7, e);
                        } else this.$URIBase7[e] = t;
                        return this;
                    };
                    p.prototype.setQueryData = function(e) {
                        this.$URIBase7 = e;
                        return this;
                    };
                    p.prototype.getQueryData = function() {
                        return this.$URIBase7;
                    };
                    p.prototype.removeQueryData = function(e) {
                        if (!ES("Array", "isArray", false, e)) e = [ e ];
                        for (var t = 0, i = e.length; t < i; ++t) delete this.$URIBase7[e[t]];
                        return this;
                    };
                    p.prototype.setFragment = function(e) {
                        this.$URIBase6 = e;
                        this.setForceFragmentSeparator(false);
                        return this;
                    };
                    p.prototype.getFragment = function() {
                        return this.$URIBase6;
                    };
                    p.prototype.setForceFragmentSeparator = function(e) {
                        this.$URIBase8 = e;
                        return this;
                    };
                    p.prototype.getForceFragmentSeparator = function() {
                        return this.$URIBase8;
                    };
                    p.prototype.isEmpty = function() {
                        return !(this.getPath() || this.getProtocol() || this.getDomain() || this.getPort() || ES("Object", "keys", false, this.getQueryData()).length > 0 || this.getFragment());
                    };
                    p.prototype.toString = function() {
                        var e = this;
                        for (var t = 0; t < h.length; t++) e = h[t](e);
                        return e.$URIBase9();
                    };
                    p.prototype.$URIBase9 = function() {
                        var e = "", t = this.getProtocol();
                        if (t) e += t + "://";
                        var i = this.getDomain();
                        if (i) e += i;
                        var n = this.getPort();
                        if (n) e += ":" + n;
                        var r = this.getPath();
                        if (r) {
                            e += r;
                        } else if (e) e += "/";
                        var a = this.$URIBase1.serialize(this.getQueryData());
                        if (a) e += "?" + a;
                        var o = this.getFragment();
                        if (o) {
                            e += "#" + o;
                        } else if (this.getForceFragmentSeparator()) e += "#";
                        return e;
                    };
                    p.registerFilter = function(e) {
                        h.push(e);
                    };
                    p.prototype.getOrigin = function() {
                        var e = this.getPort();
                        return this.getProtocol() + "://" + this.getDomain() + (e ? ":" + e : "");
                    };
                    p.isValidURI = function(e, t) {
                        return d(new p(null, t), e, false, t);
                    };
                    r.exports = p;
                }, null);
                __d("sdk.URI", [ "Assert", "QueryString", "URIBase" ], function et(e, t, i, n, r, a, o, s, l) {
                    if (t.__markCompiled) t.__markCompiled();
                    var c, u, f = /\.facebook\.com$/, d = {
                        serialize: function(e) {
                            return e ? s.encode(e) : "";
                        },
                        deserialize: function(e) {
                            return e ? s.decode(e) : {};
                        }
                    };
                    c = babelHelpers.inherits(h, l);
                    u = c && c.prototype;
                    function h(e) {
                        o.isString(e, "The passed argument was of invalid type.");
                        u.constructor.call(this, e, d);
                    }
                    h.prototype.isFacebookURI = function() {
                        return f.test(this.getDomain());
                    };
                    h.prototype.valueOf = function() {
                        return this.toString();
                    };
                    r.exports = h;
                }, null);
                __d("sdk.Event", [], function tt(e, t, i, n, r, a) {
                    if (t.__markCompiled) t.__markCompiled();
                    var o = {
                        SUBSCRIBE: "event.subscribe",
                        UNSUBSCRIBE: "event.unsubscribe",
                        subscribers: function() {
                            if (!this._subscribersMap) this._subscribersMap = {};
                            return this._subscribersMap;
                        },
                        subscribe: function(e, t) {
                            var i = this.subscribers();
                            if (!i[e]) {
                                i[e] = [ t ];
                            } else if (ES(i[e], "indexOf", true, t) == -1) i[e].push(t);
                            if (e != this.SUBSCRIBE && e != this.UNSUBSCRIBE) this.fire(this.SUBSCRIBE, e, i[e]);
                        },
                        unsubscribe: function(e, t) {
                            var i = this.subscribers()[e];
                            if (i) ES(i, "forEach", true, function(e, n) {
                                if (e == t) i.splice(n, 1);
                            });
                            if (e != this.SUBSCRIBE && e != this.UNSUBSCRIBE) this.fire(this.UNSUBSCRIBE, e, i);
                        },
                        monitor: function(e, t) {
                            if (!t()) {
                                var i = this, n = function() {
                                    if (t.apply(t, arguments)) i.unsubscribe(e, n);
                                };
                                this.subscribe(e, n);
                            }
                        },
                        clear: function(e) {
                            delete this.subscribers()[e];
                        },
                        fire: function(e) {
                            var t = Array.prototype.slice.call(arguments, 1), i = this.subscribers()[e];
                            if (i) ES(i, "forEach", true, function(e) {
                                if (e) e.apply(this, t);
                            });
                        }
                    };
                    r.exports = o;
                }, null);
                __d("Queue", [], function it(e, t, i, n, r, a) {
                    if (t.__markCompiled) t.__markCompiled();
                    var o = {};
                    function s(e) {
                        this._opts = babelHelpers._extends({
                            interval: 0,
                            processor: null
                        }, e);
                        this._queue = [];
                        this._stopped = true;
                    }
                    s.prototype._dispatch = function(e) {
                        if (this._stopped || this._queue.length === 0) return;
                        if (!this._opts.processor) {
                            this._stopped = true;
                            throw new Error("No processor available");
                        }
                        if (this._opts.interval) {
                            this._opts.processor.call(this, this._queue.shift());
                            this._timeout = setTimeout(ES(this._dispatch, "bind", true, this), this._opts.interval);
                        } else while (this._queue.length) this._opts.processor.call(this, this._queue.shift());
                    };
                    s.prototype.enqueue = function(e) {
                        if (this._opts.processor && !this._stopped) {
                            this._opts.processor.call(this, e);
                        } else this._queue.push(e);
                        return this;
                    };
                    s.prototype.start = function(e) {
                        if (e) this._opts.processor = e;
                        this._stopped = false;
                        this._dispatch();
                        return this;
                    };
                    s.prototype.isStarted = function() {
                        return !this._stopped;
                    };
                    s.prototype.dispatch = function() {
                        this._dispatch(true);
                    };
                    s.prototype.stop = function(e) {
                        this._stopped = true;
                        if (e) clearTimeout(this._timeout);
                        return this;
                    };
                    s.prototype.merge = function(e, t) {
                        this._queue[t ? "unshift" : "push"].apply(this._queue, e._queue);
                        e._queue = [];
                        this._dispatch();
                        return this;
                    };
                    s.prototype.getLength = function() {
                        return this._queue.length;
                    };
                    s.get = function(e, t) {
                        var i;
                        if (e in o) {
                            i = o[e];
                        } else i = o[e] = new s(t);
                        return i;
                    };
                    s.exists = function(e) {
                        return e in o;
                    };
                    s.remove = function(e) {
                        return delete o[e];
                    };
                    r.exports = s;
                }, null);
                __d("JSONRPC", [ "Log" ], function nt(e, t, i, n, r, a, o) {
                    if (t.__markCompiled) t.__markCompiled();
                    function s(e) {
                        this.$JSONRPC1 = 0;
                        this.$JSONRPC2 = {};
                        this.remote = ES(function(e) {
                            this.$JSONRPC3 = e;
                            return this.remote;
                        }, "bind", true, this);
                        this.local = {};
                        this.$JSONRPC4 = e;
                    }
                    s.prototype.stub = function(e) {
                        this.remote[e] = ES(function() {
                            var t = {
                                jsonrpc: "2.0",
                                method: e
                            };
                            for (var i = arguments.length, n = Array(i), r = 0; r < i; r++) n[r] = arguments[r];
                            if (typeof n[n.length - 1] == "function") {
                                t.id = ++this.$JSONRPC1;
                                this.$JSONRPC2[t.id] = n.pop();
                            }
                            t.params = n;
                            this.$JSONRPC4(ES("JSON", "stringify", false, t), this.$JSONRPC3 || {
                                method: e
                            });
                        }, "bind", true, this);
                    };
                    s.prototype.read = function(e, t) {
                        var i = ES("JSON", "parse", false, e), n = i.id;
                        if (!i.method) {
                            if (!this.$JSONRPC2[n]) {
                                o.warn("Could not find callback %s", n);
                                return;
                            }
                            var r = this.$JSONRPC2[n];
                            delete this.$JSONRPC2[n];
                            delete i.id;
                            delete i.jsonrpc;
                            r(i);
                            return;
                        }
                        var a = this, s = this.local[i.method], l;
                        if (n) {
                            l = function(e, i) {
                                var r = {
                                    jsonrpc: "2.0",
                                    id: n
                                };
                                r[e] = i;
                                setTimeout(function() {
                                    a.$JSONRPC4(ES("JSON", "stringify", false, r), t);
                                }, 0);
                            };
                        } else l = function() {};
                        if (!s) {
                            o.error('Method "%s" has not been defined', i.method);
                            l("error", {
                                code: -32601,
                                message: "Method not found",
                                data: i.method
                            });
                            return;
                        }
                        i.params.push(ES(l, "bind", true, null, "result"));
                        i.params.push(ES(l, "bind", true, null, "error"));
                        try {
                            var c = s.apply(t || null, i.params);
                            if (typeof c !== "undefined") l("result", c);
                        } catch (u) {
                            o.error("Invokation of RPC method %s resulted in the error: %s", i.method, u.message);
                            l("error", {
                                code: -32603,
                                message: "Internal error",
                                data: u.message
                            });
                        }
                    };
                    r.exports = s;
                }, null);
                __d("sdk.RPC", [ "Assert", "JSONRPC", "Queue" ], function rt(e, t, i, n, r, a, o, s, l) {
                    if (t.__markCompiled) t.__markCompiled();
                    var c = new l(), u = new s(function(e) {
                        c.enqueue(e);
                    }), f = {
                        local: u.local,
                        remote: u.remote,
                        stub: ES(u.stub, "bind", true, u),
                        setInQueue: function(e) {
                            o.isInstanceOf(l, e);
                            e.start(function(e) {
                                u.read(e);
                            });
                        },
                        getOutQueue: function() {
                            return c;
                        }
                    };
                    r.exports = f;
                }, null);
                __d("sdk.Scribe", [ "QueryString", "sdk.Runtime", "UrlMap" ], function at(e, t, i, n, r, a, o, s, l) {
                    if (t.__markCompiled) t.__markCompiled();
                    function c(e, t) {
                        if (typeof t.extra == "object") t.extra.revision = s.getRevision();
                        new Image().src = o.appendToUrl(l.resolve("www", true) + "/common/scribe_endpoint.php", {
                            c: e,
                            m: ES("JSON", "stringify", false, t)
                        });
                    }
                    var u = {
                        log: c
                    };
                    r.exports = u;
                }, null);
                __d("emptyFunction", [], function ot(e, t, i, n, r, a) {
                    if (t.__markCompiled) t.__markCompiled();
                    function o(e) {
                        return function() {
                            return e;
                        };
                    }
                    function s() {}
                    s.thatReturns = o;
                    s.thatReturnsFalse = o(false);
                    s.thatReturnsTrue = o(true);
                    s.thatReturnsNull = o(null);
                    s.thatReturnsThis = function() {
                        return this;
                    };
                    s.thatReturnsArgument = function(e) {
                        return e;
                    };
                    r.exports = s;
                }, null);
                __d("htmlSpecialChars", [], function st(e, t, i, n, r, a) {
                    if (t.__markCompiled) t.__markCompiled();
                    var o = /&/g, s = /</g, l = />/g, c = /"/g, u = /'/g;
                    function f(e) {
                        if (typeof e == "undefined" || e === null || !e.toString) return "";
                        if (e === false) {
                            return "0";
                        } else if (e === true) return "1";
                        return e.toString().replace(o, "&amp;").replace(c, "&quot;").replace(u, "&#039;").replace(s, "&lt;").replace(l, "&gt;");
                    }
                    r.exports = f;
                }, null);
                __d("Flash", [ "DOMEventListener", "DOMWrapper", "QueryString", "UserAgent_DEPRECATED", "guid", "htmlSpecialChars" ], function lt(e, t, i, n, r, a, o, s, l, c, u, f) {
                    if (t.__markCompiled) t.__markCompiled();
                    var d = {}, h, p = s.getWindow().document;
                    function g(e) {
                        var t = p.getElementById(e);
                        if (t) t.parentNode.removeChild(t);
                        delete d[e];
                    }
                    function m() {
                        for (var e in d) if (d.hasOwnProperty(e)) g(e);
                    }
                    function v(e) {
                        return e.replace(/\d+/g, function(e) {
                            return "000".substring(e.length) + e;
                        });
                    }
                    function y(e) {
                        if (!h) {
                            if (c.ie() >= 9) o.add(window, "unload", m);
                            h = true;
                        }
                        d[e] = e;
                    }
                    var b = {
                        embed: function(e, t, i, n) {
                            var r = u();
                            e = f(e).replace(/&amp;/g, "&");
                            i = babelHelpers._extends({
                                allowscriptaccess: "always",
                                flashvars: n,
                                movie: e
                            }, i);
                            if (typeof i.flashvars == "object") i.flashvars = l.encode(i.flashvars);
                            var a = [];
                            for (var o in i) if (i.hasOwnProperty(o) && i[o]) a.push('<param name="' + f(o) + '" value="' + f(i[o]) + '">');
                            var s = t.appendChild(p.createElement("span")), d = "<object " + (c.ie() ? 'classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" ' : 'type="application/x-shockwave-flash"') + 'data="' + e + '" ' + (i.height ? 'height="' + i.height + '" ' : "") + (i.width ? 'width="' + i.width + '" ' : "") + 'id="' + r + '">' + a.join("") + "</object>";
                            s.innerHTML = d;
                            var h = s.firstChild;
                            y(r);
                            return h;
                        },
                        remove: g,
                        getVersion: function() {
                            var e = "Shockwave Flash", t = "application/x-shockwave-flash", i = "ShockwaveFlash.ShockwaveFlash", n;
                            if (navigator.plugins && typeof navigator.plugins[e] == "object") {
                                var r = navigator.plugins[e].description;
                                if (r && navigator.mimeTypes && navigator.mimeTypes[t] && navigator.mimeTypes[t].enabledPlugin) n = r.match(/\d+/g);
                            }
                            if (!n) try {
                                n = new ActiveXObject(i).GetVariable("$version").match(/(\d+),(\d+),(\d+),(\d+)/);
                                n = Array.prototype.slice.call(n, 1);
                            } catch (a) {}
                            return n;
                        },
                        getVersionString: function() {
                            var e = b.getVersion();
                            return e ? e.join(".") : "";
                        },
                        checkMinVersion: function(e) {
                            var t = b.getVersion();
                            if (!t) return false;
                            return v(t.join(".")) >= v(e);
                        },
                        isAvailable: function() {
                            return !!b.getVersion();
                        }
                    };
                    r.exports = b;
                }, null);
                __d("XDM", [ "DOMEventListener", "DOMWrapper", "emptyFunction", "Flash", "GlobalCallback", "guid", "Log", "UserAgent_DEPRECATED", "wrapFunction" ], function ct(e, t, i, n, r, a, o, s, l, c, u, f, d, h, p) {
                    if (t.__markCompiled) t.__markCompiled();
                    var g = {}, m = {
                        transports: []
                    }, v = s.getWindow();
                    function y(e) {
                        var t = {}, i = e.length, n = m.transports;
                        while (i--) t[e[i]] = 1;
                        i = n.length;
                        while (i--) {
                            var r = n[i], a = g[r];
                            if (!t[r] && a.isAvailable()) return r;
                        }
                    }
                    var b = {
                        register: function(e, t) {
                            d.debug("Registering %s as XDM provider", e);
                            m.transports.push(e);
                            g[e] = t;
                        },
                        create: function(e) {
                            if (!e.whenReady && !e.onMessage) {
                                d.error("An instance without whenReady or onMessage makes no sense");
                                throw new Error("An instance without whenReady or " + "onMessage makes no sense");
                            }
                            if (!e.channel) {
                                d.warn("Missing channel name, selecting at random");
                                e.channel = f();
                            }
                            if (!e.whenReady) e.whenReady = l;
                            if (!e.onMessage) e.onMessage = l;
                            var t = e.transport || y(e.blacklist || []), i = g[t];
                            if (i && i.isAvailable()) {
                                d.debug("%s is available", t);
                                i.init(e);
                                return t;
                            }
                        }
                    };
                    b.register("flash", function() {
                        var e = false, t, i = false, n = 15e3, r;
                        return {
                            isAvailable: function() {
                                return c.checkMinVersion("8.0.24");
                            },
                            init: function(a) {
                                d.debug("init flash: " + a.channel);
                                var o = {
                                    send: function(e, i, n, r) {
                                        d.debug("sending to: %s (%s)", i, r);
                                        t.postMessage(e, i, r);
                                    }
                                };
                                if (e) {
                                    a.whenReady(o);
                                    return;
                                }
                                var s = a.root.appendChild(v.document.createElement("div")), l = u.create(function() {
                                    u.remove(l);
                                    clearTimeout(r);
                                    d.info("xdm.swf called the callback");
                                    var e = u.create(function(e, t) {
                                        e = decodeURIComponent(e);
                                        t = decodeURIComponent(t);
                                        d.debug("received message %s from %s", e, t);
                                        a.onMessage(e, t);
                                    }, "xdm.swf:onMessage");
                                    t.init(a.channel, e);
                                    a.whenReady(o);
                                }, "xdm.swf:load");
                                t = c.embed(a.flashUrl, s, null, {
                                    protocol: location.protocol.replace(":", ""),
                                    host: location.host,
                                    callback: l,
                                    log: i
                                });
                                r = setTimeout(function() {
                                    d.warn("The Flash component did not load within %s ms - " + "verify that the container is not set to hidden or invisible " + "using CSS as this will cause some browsers to not load " + "the components", n);
                                }, n);
                                e = true;
                            }
                        };
                    }());
                    var w = /\.facebook\.com(\/|$)/;
                    b.register("postmessage", function() {
                        var e = false;
                        return {
                            isAvailable: function() {
                                return !!v.postMessage;
                            },
                            init: function(t) {
                                d.debug("init postMessage: " + t.channel);
                                var i = "_FB_" + t.channel, n = {
                                    send: function(e, t, i, n) {
                                        if (v === i) {
                                            d.error("Invalid windowref, equal to window (self)");
                                            throw new Error();
                                        }
                                        d.debug("sending to: %s (%s)", t, n);
                                        var r = function() {
                                            i.postMessage("_FB_" + n + e, t);
                                        };
                                        if (h.ie() == 8 || h.ieCompatibilityMode()) {
                                            setTimeout(r, 0);
                                        } else r();
                                    }
                                };
                                if (e) {
                                    t.whenReady(n);
                                    return;
                                }
                                o.add(v, "message", p(function(e) {
                                    var n = e.data, r = e.origin || "native";
                                    if (!/^(https?:\/\/|native$)/.test(r)) {
                                        d.debug("Received message from invalid origin type: %s", r);
                                        return;
                                    }
                                    if (r !== "native" && !(w.test(location.hostname) || w.test(e.origin))) return;
                                    if (typeof n != "string") {
                                        d.warn("Received message of type %s from %s, expected a string", typeof n, r);
                                        return;
                                    }
                                    d.debug("received message %s from %s", n, r);
                                    if (n.substring(0, i.length) == i) n = n.substring(i.length);
                                    t.onMessage(n, r);
                                }, "entry", "onMessage"));
                                t.whenReady(n);
                                e = true;
                            }
                        };
                    }());
                    r.exports = b;
                }, null);
                __d("isFacebookURI", [], function ut(e, t, i, n, r, a) {
                    if (t.__markCompiled) t.__markCompiled();
                    var o = null, s = [ "http", "https" ];
                    function l(e) {
                        if (!o) o = new RegExp("(^|\\.)facebook\\.com$", "i");
                        if (e.isEmpty() && e.toString() !== "#") return false;
                        if (!e.getDomain() && !e.getProtocol()) return true;
                        return ES(s, "indexOf", true, e.getProtocol()) !== -1 && o.test(e.getDomain());
                    }
                    l.setRegex = function(e) {
                        o = e;
                    };
                    r.exports = l;
                }, null);
                __d("sdk.XD", [ "sdk.Content", "sdk.Event", "Log", "QueryString", "Queue", "sdk.RPC", "sdk.Runtime", "sdk.Scribe", "sdk.URI", "UrlMap", "JSSDKXDConfig", "XDM", "isFacebookURI", "sdk.createIframe", "sdk.feature", "guid" ], function ft(e, t, i, n, r, a, o, s, l, c, u, f, d, h, p, g, m, v, y, b, w, C) {
                    if (t.__markCompiled) t.__markCompiled();
                    var x = new u(), _ = new u(), S = new u(), k, A, E = C(), T = m.useCdn ? "cdn" : "www", P = w("use_bundle", false) ? m.XdBundleUrl : m.XdUrl, I = g.resolve(T, false) + P, O = g.resolve(T, true) + P, D = C(), R = location.protocol + "//" + location.host, L, F = false, M = "Facebook Cross Domain Communication Frame", N = {}, B = new u();
                    f.setInQueue(B);
                    function j(e) {
                        l.info("Remote XD can talk to facebook.com (%s)", e);
                        d.setEnvironment(e === "canvas" ? d.ENVIRONMENTS.CANVAS : d.ENVIRONMENTS.PAGETAB);
                    }
                    function U(e, t) {
                        if (!t) {
                            l.error("No senderOrigin");
                            throw new Error();
                        }
                        var i = /^https?/.exec(t)[0];
                        switch (e.xd_action) {
                          case "proxy_ready":
                            var n, r;
                            if (i == "https") {
                                n = S;
                                r = A;
                            } else {
                                n = _;
                                r = k;
                            }
                            if (e.registered) {
                                j(e.registered);
                                x = n.merge(x);
                            }
                            l.info("Proxy ready, starting queue %s containing %s messages", i + "ProxyQueue", n.getLength());
                            n.start(function(e) {
                                L.send(typeof e === "string" ? e : c.encode(e), t, r.contentWindow, D + "_" + i);
                            });
                            break;

                          case "plugin_ready":
                            l.info("Plugin %s ready, protocol: %s", e.name, i);
                            N[e.name] = {
                                protocol: i
                            };
                            if (u.exists(e.name)) {
                                var a = u.get(e.name);
                                l.debug("Enqueuing %s messages for %s in %s", a.getLength(), e.name, i + "ProxyQueue");
                                (i == "https" ? S : _).merge(a);
                            }
                            break;
                        }
                        if (e.data) z(e.data, t);
                    }
                    function z(e, t) {
                        if (t && t !== "native" && !y(new p(t))) return;
                        if (typeof e == "string") {
                            if (/^FB_RPC:/.test(e)) {
                                B.enqueue(e.substring(7));
                                return;
                            }
                            if (e.substring(0, 1) == "{") {
                                try {
                                    e = ES("JSON", "parse", false, e);
                                } catch (i) {
                                    l.warn("Failed to decode %s as JSON", e);
                                    return;
                                }
                            } else e = c.decode(e);
                        }
                        if (!t) if (e.xd_sig == E) t = e.xd_origin;
                        if (e.xd_action) {
                            U(e, t);
                            return;
                        }
                        if (e.access_token) d.setSecure(/^https/.test(R));
                        if (e.cb) {
                            var n = H._callbacks[e.cb];
                            if (!H._forever[e.cb]) delete H._callbacks[e.cb];
                            if (n) n(e);
                        }
                    }
                    function q(e, t) {
                        if (e == "facebook") {
                            t.relation = "parent.parent";
                            x.enqueue(t);
                        } else {
                            t.relation = 'parent.frames["' + e + '"]';
                            var i = N[e];
                            if (i) {
                                l.debug("Enqueuing message for plugin %s in %s", e, i.protocol + "ProxyQueue");
                                (i.protocol == "https" ? S : _).enqueue(t);
                            } else {
                                l.debug("Buffering message for plugin %s", e);
                                u.get(e).enqueue(t);
                            }
                        }
                    }
                    f.getOutQueue().start(function(e) {
                        q("facebook", "FB_RPC:" + e);
                    });
                    function W(e) {
                        if (F) return;
                        var t = o.appendHidden(document.createElement("div")), i = v.create({
                            blacklist: null,
                            root: t,
                            channel: D,
                            flashUrl: m.Flash.path,
                            whenReady: function(n) {
                                L = n;
                                var r = {
                                    channel: D,
                                    origin: location.protocol + "//" + location.host,
                                    transport: i,
                                    xd_name: e
                                }, a = "#" + c.encode(r);
                                if (d.getSecure() !== true) k = b({
                                    url: I + a,
                                    name: "fb_xdm_frame_http",
                                    id: "fb_xdm_frame_http",
                                    root: t,
                                    "aria-hidden": true,
                                    title: M,
                                    tabindex: -1
                                });
                                A = b({
                                    url: O + a,
                                    name: "fb_xdm_frame_https",
                                    id: "fb_xdm_frame_https",
                                    root: t,
                                    "aria-hidden": true,
                                    title: M,
                                    tabindex: -1
                                });
                            },
                            onMessage: z
                        });
                        if (!i) h.log("jssdk_error", {
                            appId: d.getClientID(),
                            error: "XD_TRANSPORT",
                            extra: {
                                message: "Failed to create a valid transport"
                            }
                        });
                        F = true;
                    }
                    var H = {
                        rpc: f,
                        _callbacks: {},
                        _forever: {},
                        _channel: D,
                        _origin: R,
                        onMessage: z,
                        recv: z,
                        init: W,
                        sendToFacebook: q,
                        inform: function(e, t, i, n) {
                            q("facebook", {
                                method: e,
                                params: ES("JSON", "stringify", false, t || {}),
                                behavior: n || "p",
                                relation: i
                            });
                        },
                        handler: function(e, t, i, n) {
                            var r = "#" + c.encode({
                                cb: this.registerCallback(e, i, n),
                                origin: R + "/" + D,
                                domain: location.hostname,
                                relation: t || "opener"
                            });
                            return (location.protocol == "https:" ? O : I) + r;
                        },
                        registerCallback: function(e, t, i) {
                            i = i || C();
                            if (t) H._forever[i] = true;
                            H._callbacks[i] = e;
                            return i;
                        }
                    };
                    s.subscribe("init:post", function(e) {
                        W(e.xdProxyName);
                        var t = w("xd_timeout", false);
                        if (t) setTimeout(function() {
                            var e = A && (!!k == _.isStarted() && !!A == S.isStarted());
                            if (!e) h.log("jssdk_error", {
                                appId: d.getClientID(),
                                error: "XD_INITIALIZATION",
                                extra: {
                                    message: "Failed to initialize in " + t + "ms"
                                }
                            });
                        }, t);
                    });
                    r.exports = H;
                }, null);
                __d("sdk.Auth", [ "sdk.Cookie", "sdk.createIframe", "DOMWrapper", "sdk.feature", "sdk.getContextType", "guid", "sdk.Impressions", "Log", "ObservableMixin", "sdk.Runtime", "sdk.SignedRequest", "UrlMap", "sdk.URI", "sdk.XD" ], function dt(e, t, i, n, r, a, o, s, l, c, u, f, d, h, p, g, m, v, y, b) {
                    if (t.__markCompiled) t.__markCompiled();
                    var w, C, x = new p();
                    function _(e, t) {
                        var i = g.getUserID(), n = "";
                        if (e) if (e.userID) {
                            n = e.userID;
                        } else if (e.signedRequest) {
                            var r = m.parse(e.signedRequest);
                            if (r && r.user_id) n = r.user_id;
                        }
                        var a = g.getLoginStatus(), o = a === "unknown" && e || g.getUseCookie() && g.getCookieUserID() !== n, s = i && !e, l = e && i && i != n, c = e != w, u = t != (a || "unknown");
                        g.setLoginStatus(t);
                        g.setAccessToken(e && e.accessToken || null);
                        g.setUserID(n);
                        w = e;
                        var f = {
                            authResponse: e,
                            status: t
                        };
                        if (s || l) x.inform("logout", f);
                        if (o || l) x.inform("login", f);
                        if (c) x.inform("authresponse.change", f);
                        if (u) x.inform("status.change", f);
                        return f;
                    }
                    function S() {
                        return w;
                    }
                    function k(e, t, i) {
                        return function(n) {
                            var r;
                            if (n && n.access_token) {
                                var a = m.parse(n.signed_request);
                                t = {
                                    accessToken: n.access_token,
                                    userID: a.user_id,
                                    expiresIn: parseInt(n.expires_in, 10),
                                    signedRequest: n.signed_request
                                };
                                if (n.granted_scopes) t.grantedScopes = n.granted_scopes;
                                if (g.getUseCookie()) {
                                    var s = t.expiresIn === 0 ? 0 : ES("Date", "now", false) + t.expiresIn * 1e3, l = o.getDomain();
                                    if (!l && n.base_domain) o.setDomain("." + n.base_domain);
                                    o.setSignedRequestCookie(n.signed_request, s);
                                }
                                r = "connected";
                                _(t, r);
                            } else if (i === "logout" || i === "login_status") {
                                if (n.error && n.error === "not_authorized") {
                                    r = "not_authorized";
                                } else r = "unknown";
                                _(null, r);
                                if (g.getUseCookie()) o.clearSignedRequestCookie();
                            }
                            if (n && n.https == 1) g.setSecure(true);
                            if (e) e({
                                authResponse: t,
                                status: g.getLoginStatus()
                            });
                            return t;
                        };
                    }
                    function A(e) {
                        var t, i = ES("Date", "now", false);
                        if (C) {
                            clearTimeout(C);
                            C = null;
                        }
                        var n = k(e, w, "login_status"), r = new y(v.resolve("www", true) + "/connect/ping").setQueryData({
                            client_id: g.getClientID(),
                            response_type: "token,signed_request,code",
                            domain: location.hostname,
                            origin: u(),
                            redirect_uri: b.handler(function(e) {
                                if (c("e2e_ping_tracking", true)) {
                                    var r = {
                                        init: i,
                                        close: ES("Date", "now", false),
                                        method: "ping"
                                    };
                                    h.debug("e2e: %s", ES("JSON", "stringify", false, r));
                                    d.log(114, {
                                        payload: r
                                    });
                                }
                                t.parentNode.removeChild(t);
                                if (n(e)) C = setTimeout(function() {
                                    A(function() {});
                                }, 12e5);
                            }, "parent"),
                            sdk: "joey",
                            kid_directed_site: g.getKidDirectedSite()
                        });
                        t = s({
                            root: l.getRoot(),
                            name: f(),
                            url: r.toString(),
                            style: {
                                display: "none"
                            }
                        });
                    }
                    var E;
                    function T(e, t) {
                        if (!g.getClientID()) {
                            h.warn("FB.getLoginStatus() called before calling FB.init().");
                            return;
                        }
                        if (e) if (!t && E == "loaded") {
                            e({
                                status: g.getLoginStatus(),
                                authResponse: S()
                            });
                            return;
                        } else x.subscribe("FB.loginStatus", e);
                        if (!t && E == "loading") return;
                        E = "loading";
                        var i = function(e) {
                            E = "loaded";
                            x.inform("FB.loginStatus", e);
                            x.clearSubscribers("FB.loginStatus");
                        };
                        A(i);
                    }
                    ES("Object", "assign", false, x, {
                        getLoginStatus: T,
                        fetchLoginStatus: A,
                        setAuthResponse: _,
                        getAuthResponse: S,
                        parseSignedRequest: m.parse,
                        xdResponseWrapper: k
                    });
                    r.exports = x;
                }, null);
                __d("toArray", [ "invariant" ], function ht(e, t, i, n, r, a, o) {
                    if (t.__markCompiled) t.__markCompiled();
                    function s(e) {
                        var t = e.length;
                        !(!ES("Array", "isArray", false, e) && (typeof e === "object" || typeof e === "function")) ? o(0) : undefined;
                        !(typeof t === "number") ? o(0) : undefined;
                        !(t === 0 || t - 1 in e) ? o(0) : undefined;
                        if (e.hasOwnProperty) try {
                            return Array.prototype.slice.call(e);
                        } catch (i) {}
                        var n = Array(t);
                        for (var r = 0; r < t; r++) n[r] = e[r];
                        return n;
                    }
                    r.exports = s;
                }, null);
                __d("createArrayFromMixed", [ "toArray" ], function pt(e, t, i, n, r, a, o) {
                    if (t.__markCompiled) t.__markCompiled();
                    function s(e) {
                        return !!e && (typeof e == "object" || typeof e == "function") && "length" in e && !("setInterval" in e) && typeof e.nodeType != "number" && (ES("Array", "isArray", false, e) || "callee" in e || "item" in e);
                    }
                    function l(e) {
                        if (!s(e)) {
                            return [ e ];
                        } else if (ES("Array", "isArray", false, e)) {
                            return e.slice();
                        } else return o(e);
                    }
                    r.exports = l;
                }, null);
                __d("sdk.DOM", [ "Assert", "sdk.UA", "createArrayFromMixed", "sdk.domReady" ], function gt(e, t, i, n, r, a, o, s, l, c) {
                    if (t.__markCompiled) t.__markCompiled();
                    var u = {};
                    function f(e, t) {
                        var i = e.getAttribute(t) || e.getAttribute(t.replace(/_/g, "-")) || e.getAttribute(t.replace(/-/g, "_")) || e.getAttribute(t.replace(/-/g, "")) || e.getAttribute(t.replace(/_/g, "")) || e.getAttribute("data-" + t) || e.getAttribute("data-" + t.replace(/_/g, "-")) || e.getAttribute("data-" + t.replace(/-/g, "_")) || e.getAttribute("data-" + t.replace(/-/g, "")) || e.getAttribute("data-" + t.replace(/_/g, ""));
                        return i ? String(i) : null;
                    }
                    function d(e, t) {
                        var i = f(e, t);
                        return i ? /^(true|1|yes|on)$/.test(i) : null;
                    }
                    function h(e, t) {
                        o.isTruthy(e, "element not specified");
                        o.isString(t);
                        try {
                            return String(e[t]);
                        } catch (i) {
                            throw new Error("Could not read property " + t + " : " + i.message);
                        }
                    }
                    function p(e, t) {
                        o.isTruthy(e, "element not specified");
                        o.isString(t);
                        try {
                            e.innerHTML = t;
                        } catch (i) {
                            throw new Error("Could not set innerHTML : " + i.message);
                        }
                    }
                    function g(e, t) {
                        o.isTruthy(e, "element not specified");
                        o.isString(t);
                        var i = " " + h(e, "className") + " ";
                        return ES(i, "indexOf", true, " " + t + " ") >= 0;
                    }
                    function m(e, t) {
                        o.isTruthy(e, "element not specified");
                        o.isString(t);
                        if (!g(e, t)) e.className = h(e, "className") + " " + t;
                    }
                    function v(e, t) {
                        o.isTruthy(e, "element not specified");
                        o.isString(t);
                        var i = new RegExp("\\s*" + t, "g");
                        e.className = ES(h(e, "className").replace(i, ""), "trim", true);
                    }
                    function y(e, t, i) {
                        o.isString(e);
                        t = t || document.body;
                        i = i || "*";
                        if (t.querySelectorAll) return l(t.querySelectorAll(i + "." + e));
                        var n = t.getElementsByTagName(i), r = [];
                        for (var a = 0, s = n.length; a < s; a++) if (g(n[a], e)) r[r.length] = n[a];
                        return r;
                    }
                    function b(e, t) {
                        o.isTruthy(e, "element not specified");
                        o.isString(t);
                        t = t.replace(/-(\w)/g, function(e, t) {
                            return t.toUpperCase();
                        });
                        var i = e.currentStyle || document.defaultView.getComputedStyle(e, null), n = i[t];
                        if (/backgroundPosition?/.test(t) && /top|left/.test(n)) n = "0%";
                        return n;
                    }
                    function w(e, t, i) {
                        o.isTruthy(e, "element not specified");
                        o.isString(t);
                        t = t.replace(/-(\w)/g, function(e, t) {
                            return t.toUpperCase();
                        });
                        e.style[t] = i;
                    }
                    function C(e, t) {
                        var i = true;
                        for (var n = 0, r; r = t[n++]; ) if (!(r in u)) {
                            i = false;
                            u[r] = true;
                        }
                        if (i) return;
                        if (s.ie() < 11) {
                            try {
                                document.createStyleSheet().cssText = e;
                            } catch (a) {
                                if (document.styleSheets[0]) document.styleSheets[0].cssText += e;
                            }
                        } else {
                            var o = document.createElement("style");
                            o.type = "text/css";
                            o.textContent = e;
                            document.getElementsByTagName("head")[0].appendChild(o);
                        }
                    }
                    function x() {
                        var e = document.documentElement && document.compatMode == "CSS1Compat" ? document.documentElement : document.body;
                        return {
                            scrollTop: e.scrollTop || document.body.scrollTop,
                            scrollLeft: e.scrollLeft || document.body.scrollLeft,
                            width: window.innerWidth ? window.innerWidth : e.clientWidth,
                            height: window.innerHeight ? window.innerHeight : e.clientHeight
                        };
                    }
                    function _(e) {
                        o.isTruthy(e, "element not specified");
                        var t = 0, i = 0;
                        do {
                            t += e.offsetLeft;
                            i += e.offsetTop;
                        } while (e = e.offsetParent);
                        return {
                            x: t,
                            y: i
                        };
                    }
                    var S = {
                        containsCss: g,
                        addCss: m,
                        removeCss: v,
                        getByClass: y,
                        getStyle: b,
                        setStyle: w,
                        getAttr: f,
                        getBoolAttr: d,
                        getProp: h,
                        html: p,
                        addCssRules: C,
                        getViewportInfo: x,
                        getPosition: _,
                        ready: c
                    };
                    r.exports = S;
                }, null);
                __d("sdk.ErrorHandling", [ "ManagedError", "sdk.Runtime", "sdk.Scribe", "sdk.UA", "sdk.feature", "wrapFunction" ], function mt(e, t, i, n, r, a, o, s, l, c, u, f) {
                    if (t.__markCompiled) t.__markCompiled();
                    var d = u("error_handling", false), h = "";
                    function p(e) {
                        var t = e._originalError;
                        delete e._originalError;
                        l.log("jssdk_error", {
                            appId: s.getClientID(),
                            error: e.name || e.message,
                            extra: e
                        });
                        throw t;
                    }
                    function g(e) {
                        var t = {
                            line: e.lineNumber || e.line,
                            message: e.message,
                            name: e.name,
                            script: e.fileName || e.sourceURL || e.script,
                            stack: e.stackTrace || e.stack
                        };
                        t._originalError = e;
                        if (c.chrome() && /([\w:\.\/]+\.js):(\d+)/.test(e.stack)) {
                            t.script = RegExp.$1;
                            t.line = parseInt(RegExp.$2, 10);
                        }
                        for (var i in t) t[i] == null && delete t[i];
                        return t;
                    }
                    function m(e, t) {
                        return function() {
                            if (!d) return e.apply(this, arguments);
                            try {
                                h = t;
                                return e.apply(this, arguments);
                            } catch (i) {
                                if (i instanceof o) throw i;
                                var n = g(i);
                                n.entry = t;
                                var r = ES(Array.prototype.slice.call(arguments), "map", true, function(e) {
                                    var t = Object.prototype.toString.call(e);
                                    return /^\[object (String|Number|Boolean|Object|Date)\]$/.test(t) ? e : e.toString();
                                });
                                n.args = ES("JSON", "stringify", false, r).substring(0, 200);
                                p(n);
                            } finally {
                                h = "";
                            }
                        };
                    }
                    function v(e) {
                        if (!e.__wrapper) e.__wrapper = function() {
                            try {
                                return e.apply(this, arguments);
                            } catch (t) {
                                window.setTimeout(function() {
                                    throw t;
                                }, 0);
                                return false;
                            }
                        };
                        return e.__wrapper;
                    }
                    function y(e, t) {
                        return function(i, n) {
                            var r = t + ":" + (h || "[global]") + ":" + (i.name || "[anonymous]" + (arguments.callee.caller.name ? "(" + arguments.callee.caller.name + ")" : ""));
                            return e(f(i, "entry", r), n);
                        };
                    }
                    if (d) {
                        setTimeout = y(setTimeout, "setTimeout");
                        setInterval = y(setInterval, "setInterval");
                        f.setWrapper(m, "entry");
                    }
                    var b = {
                        guard: m,
                        unguard: v
                    };
                    r.exports = b;
                }, null);
                __d("sdk.Insights", [ "sdk.Impressions" ], function vt(e, t, i, n, r, a, o) {
                    if (t.__markCompiled) t.__markCompiled();
                    var s = {
                        TYPE: {
                            NOTICE: "notice",
                            WARNING: "warn",
                            ERROR: "error"
                        },
                        CATEGORY: {
                            DEPRECATED: "deprecated",
                            APIERROR: "apierror"
                        },
                        log: function(e, t, i) {
                            var n = {
                                source: "jssdk",
                                type: e,
                                category: t,
                                payload: i
                            };
                            o.log(113, n);
                        },
                        impression: o.impression
                    };
                    r.exports = s;
                }, null);
                __d("FB", [ "sdk.Auth", "JSSDKCssConfig", "dotAccess", "sdk.domReady", "sdk.DOM", "sdk.ErrorHandling", "sdk.Content", "DOMWrapper", "GlobalCallback", "sdk.Insights", "Log", "sdk.Runtime", "sdk.Scribe", "JSSDKConfig" ], function yt(e, t, i, n, r, a, o, s, l, c, u, f, d, h, p, g, m, v, y, b) {
                    if (t.__markCompiled) t.__markCompiled();
                    var w, C, x = l(b, "api.mode"), _ = {};
                    w = window.FB = {};
                    var S = {};
                    m.level = 0;
                    p.setPrefix("FB.__globalCallbacks");
                    var k = document.createElement("div");
                    h.setRoot(k);
                    c(function() {
                        m.info("domReady");
                        d.appendHidden(k);
                        if (s.rules) u.addCssRules(s.rules, s.components);
                    });
                    v.subscribe("AccessToken.change", function(e) {
                        if (!e && v.getLoginStatus() === "connected") o.getLoginStatus(null, true);
                    });
                    if (l(b, "api.whitelist.length")) {
                        C = {};
                        ES(b.api.whitelist, "forEach", true, function(e) {
                            C[e] = 1;
                        });
                    }
                    function A(e, t, i, n) {
                        var r;
                        if (/^_/.test(i)) {
                            r = "hide";
                        } else if (C && !C[t]) r = x;
                        switch (r) {
                          case "hide":
                            return;

                          case "stub":
                            return function() {
                                m.warn("The method FB.%s has been removed from the JS SDK.", t);
                            };

                          default:
                            return f.guard(function() {
                                if (r === "warn") {
                                    m.warn("The method FB.%s is not officially supported by " + "Facebook and access to it will soon be removed.", t);
                                    if (!_.hasOwnProperty(t)) {
                                        g.log(g.TYPE.WARNING, g.CATEGORY.DEPRECATED, "FB." + t);
                                        y.log("jssdk_error", {
                                            appId: v.getClientID(),
                                            error: "Private method used",
                                            extra: {
                                                args: t
                                            }
                                        });
                                        _[t] = true;
                                    }
                                }
                                function i(e) {
                                    if (ES("Array", "isArray", false, e)) return ES(e, "map", true, i);
                                    if (e && typeof e === "object" && e.__wrapped) return e.__wrapped;
                                    return typeof e === "function" && /^function/.test(e.toString()) ? f.unguard(e) : e;
                                }
                                var a = ES(Array.prototype.slice.call(arguments), "map", true, i), o = e.apply(n, a), s, l = true;
                                if (o && typeof o === "object") {
                                    s = ES("Object", "create", false, o);
                                    s.__wrapped = o;
                                    for (var c in o) {
                                        var u = o[c];
                                        if (typeof u !== "function" || c === "constructor") continue;
                                        l = false;
                                        s[c] = A(u, t + ":" + c, c, o);
                                    }
                                }
                                if (!l) return s;
                                return l ? o : s;
                            }, t);
                        }
                    }
                    function E(e, t) {
                        var i = e ? l(w, e, true) : w;
                        ES(ES("Object", "keys", false, t), "forEach", true, function(n) {
                            var r = t[n];
                            if (typeof r === "function") {
                                var a = (e ? e + "." : "") + n, o = A(r, a, n, t);
                                if (o) i[n] = o;
                            } else if (typeof r === "object") {
                                a = (e ? e + "." : "") + n;
                                if (C && C[a]) i[n] = r;
                            }
                        });
                    }
                    v.setSecure(function() {
                        var e = /iframe_canvas|app_runner/.test(window.name), t = /dialog/.test(window.name);
                        if (location.protocol == "https:" && (window == top || !(e || t))) return true;
                        if (/_fb_https?/.test(window.name)) return ES(window.name, "indexOf", true, "_fb_https") != -1;
                    }());
                    ES("Object", "assign", false, S, {
                        provide: E
                    });
                    r.exports = S;
                }, null);
                __d("ArgumentError", [ "ManagedError" ], function bt(e, t, i, n, r, a, o) {
                    if (t.__markCompiled) t.__markCompiled();
                    function s(e, t) {
                        o.prototype.constructor.apply(this, arguments);
                    }
                    s.prototype = new o();
                    s.prototype.constructor = s;
                    r.exports = s;
                }, null);
                __d("CORSRequest", [ "wrapFunction", "QueryString" ], function wt(e, t, i, n, r, a, o, s) {
                    if (t.__markCompiled) t.__markCompiled();
                    function l(e, t) {
                        if (!self.XMLHttpRequest) return null;
                        var i = new XMLHttpRequest(), n = function() {};
                        if ("withCredentials" in i) {
                            i.open(e, t, true);
                            i.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
                        } else if (self.XDomainRequest) {
                            i = new XDomainRequest();
                            try {
                                i.open(e, t);
                                i.onprogress = i.ontimeout = n;
                            } catch (r) {
                                return null;
                            }
                        } else return null;
                        var a = {
                            send: function(e) {
                                i.send(e);
                            }
                        }, s = o(function() {
                            s = n;
                            if ("onload" in a) a.onload(i);
                        }, "entry", "XMLHttpRequest:load"), l = o(function() {
                            l = n;
                            if ("onerror" in a) a.onerror(i);
                        }, "entry", "XMLHttpRequest:error");
                        i.onload = function() {
                            s();
                        };
                        i.onerror = function() {
                            l();
                        };
                        i.onreadystatechange = function() {
                            if (i.readyState == 4) if (i.status == 200) {
                                s();
                            } else l();
                        };
                        return a;
                    }
                    function c(e, t, i, n) {
                        i.suppress_http_code = 1;
                        var r = s.encode(i);
                        if (t != "post") {
                            e = s.appendToUrl(e, r);
                            r = "";
                        }
                        var a = l(t, e);
                        if (!a) return false;
                        a.onload = function(e) {
                            n(ES("JSON", "parse", false, e.responseText));
                        };
                        a.onerror = function(e) {
                            if (e.responseText) {
                                n(ES("JSON", "parse", false, e.responseText));
                            } else n({
                                error: {
                                    type: "http",
                                    message: "unknown error",
                                    status: e.status
                                }
                            });
                        };
                        a.send(r);
                        return true;
                    }
                    var u = {
                        execute: c
                    };
                    r.exports = u;
                }, null);
                __d("FlashRequest", [ "DOMWrapper", "Flash", "GlobalCallback", "QueryString", "Queue" ], function Ct(e, t, i, n, r, a, o, s, l, c, u) {
                    if (t.__markCompiled) t.__markCompiled();
                    var f, d = {}, h, p;
                    function g() {
                        if (!h) throw new Error("swfUrl has not been set");
                        var e = l.create(function() {
                            f.start(function(e) {
                                var t = p.execute(e.method, e.url, e.body);
                                if (!t) throw new Error("Could create request");
                                d[t] = e.callback;
                            });
                        }), t = l.create(function(e, t, i) {
                            var n;
                            try {
                                n = ES("JSON", "parse", false, decodeURIComponent(i));
                            } catch (r) {
                                n = {
                                    error: {
                                        type: "SyntaxError",
                                        message: r.message,
                                        status: t,
                                        raw: i
                                    }
                                };
                            }
                            d[e](n);
                            delete d[e];
                        });
                        p = s.embed(h, o.getRoot(), null, {
                            log: false,
                            initCallback: e,
                            requestCallback: t
                        });
                    }
                    function m(e, t, i, n) {
                        i.suppress_http_code = 1;
                        if (!i.method) i.method = t;
                        var r = c.encode(i);
                        if (t === "get" && e.length + r.length < 2e3) {
                            e = c.appendToUrl(e, r);
                            r = "";
                        } else t = "post";
                        if (!f) {
                            if (!s.isAvailable()) return false;
                            f = new u();
                            g();
                        }
                        f.enqueue({
                            method: t,
                            url: e,
                            body: r,
                            callback: n
                        });
                        return true;
                    }
                    var v = {
                        setSwfUrl: function(e) {
                            h = e;
                        },
                        execute: m
                    };
                    r.exports = v;
                }, null);
                __d("flattenObject", [], function xt(e, t, i, n, r, a) {
                    if (t.__markCompiled) t.__markCompiled();
                    function o(e) {
                        var t = {};
                        for (var i in e) if (e.hasOwnProperty(i)) {
                            var n = e[i];
                            if (null === n || undefined === n) {
                                continue;
                            } else if (typeof n == "string") {
                                t[i] = n;
                            } else t[i] = ES("JSON", "stringify", false, n);
                        }
                        return t;
                    }
                    r.exports = o;
                }, null);
                __d("JSONPRequest", [ "DOMWrapper", "GlobalCallback", "QueryString" ], function _t(e, t, i, n, r, a, o, s, l) {
                    if (t.__markCompiled) t.__markCompiled();
                    var c = 2e3;
                    function u(e, t, i, n) {
                        var r = document.createElement("script"), a = function(e) {
                            a = function() {};
                            s.remove(i.callback);
                            n(e);
                            r.parentNode.removeChild(r);
                        };
                        i.callback = s.create(a);
                        if (!i.method) i.method = t;
                        e = l.appendToUrl(e, i);
                        if (e.length > c) {
                            s.remove(i.callback);
                            return false;
                        }
                        r.onerror = function() {
                            a({
                                error: {
                                    type: "http",
                                    message: "unknown error"
                                }
                            });
                        };
                        var u = function() {
                            setTimeout(function() {
                                a({
                                    error: {
                                        type: "http",
                                        message: "unknown error"
                                    }
                                });
                            }, 0);
                        };
                        if (r.addEventListener) {
                            r.addEventListener("load", u, false);
                        } else r.onreadystatechange = function() {
                            if (/loaded|complete/.test(this.readyState)) u();
                        };
                        r.src = e;
                        o.getRoot().appendChild(r);
                        return true;
                    }
                    var f = {
                        execute: u,
                        MAX_QUERYSTRING_LENGTH: c
                    };
                    r.exports = f;
                }, null);
                __d("ApiClient", [ "ArgumentError", "Assert", "CORSRequest", "FlashRequest", "flattenObject", "JSONPRequest", "Log", "ObservableMixin", "QueryString", "sprintf", "sdk.URI", "UrlMap", "ApiClientConfig", "invariant" ], function St(e, t, i, n, r, a, o, s, l, c, u, f, d, h, p, g, m, v, y, b) {
                    if (t.__markCompiled) t.__markCompiled();
                    var w, C, x, _ = f.MAX_QUERYSTRING_LENGTH, S = {
                        get: true,
                        post: true,
                        "delete": true,
                        put: true
                    }, k = {
                        fql_query: true,
                        fql_multiquery: true,
                        friends_get: true,
                        notifications_get: true,
                        stream_get: true,
                        users_getinfo: true
                    }, A = [ "jsonp", "cors", "flash" ], E = [], T = [], P = null, I = 0, O = [], D = 0, R = 50, L = 105440539523;
                    function F(e, t, i, n) {
                        var r = D !== 0 && I >= D;
                        if (r) {
                            O.push(function() {
                                return F(e, t, i, n);
                            });
                            q.inform("request.queued", e, t, i);
                            return;
                        }
                        I++;
                        if (x) i = ES("Object", "assign", false, {}, x, i);
                        i.access_token = i.access_token || w;
                        i.pretty = i.pretty || 0;
                        i = u(i);
                        var a = {
                            jsonp: f,
                            cors: l,
                            flash: c
                        }, o;
                        if (i.transport) {
                            o = [ i.transport ];
                            delete i.transport;
                        } else o = A;
                        for (var s = 0; s < o.length; s++) {
                            var d = a[o[s]], h = ES("Object", "assign", false, {}, i);
                            if (d.execute(e, t, h, n)) return;
                        }
                        n({
                            error: {
                                type: "no-transport",
                                message: "Could not find a usable transport for request"
                            }
                        });
                    }
                    function M(e, t, i, n, r, a) {
                        if (a && a.error) q.inform("request.error", t, i, n, a, ES("Date", "now", false) - r);
                        q.inform("request.complete", t, i, n, a, ES("Date", "now", false) - r);
                        I--;
                        if (e) e(a);
                        var o = O.length > 0 && I < D;
                        if (o) {
                            var s = O.shift();
                            s();
                        }
                    }
                    function N(e) {
                        var t = e.shift();
                        s.isString(t, "Invalid path");
                        if (!/^https?/.test(t) && t.charAt(0) !== "/") t = "/" + t;
                        var i, n = {};
                        try {
                            i = new m(t);
                        } catch (r) {
                            throw new o(r.message, r);
                        }
                        ES(e, "forEach", true, function(e) {
                            return n[typeof e] = e;
                        });
                        var a = (n.string || "get").toLowerCase();
                        s.isTrue(S.hasOwnProperty(a), g("Invalid method passed to ApiClient: %s", a));
                        var l = n["function"];
                        if (!l) d.warn("No callback passed to the ApiClient");
                        if (n.object) i.addQueryData(u(n.object));
                        var c = i.getQueryData();
                        c.method = a;
                        return {
                            uri: i,
                            callback: l,
                            params: c
                        };
                    }
                    function B() {
                        for (var e = arguments.length, t = Array(e), i = 0; i < e; i++) t[i] = arguments[i];
                        var n = N(t), r = n.uri, a = n.callback, o = n.params, s = o.method;
                        if (W(r, s)) s = "post";
                        var l = r.getProtocol() && r.getDomain() ? r.setQueryData({}).toString() : v.resolve("graph") + r.getPath();
                        q.inform("request.prepare", l, o);
                        F(l, s == "get" ? "get" : "post", o, ES(M, "bind", true, null, a, r.getPath(), s, o, ES("Date", "now", false)));
                    }
                    function j() {
                        for (var e = arguments.length, t = Array(e), i = 0; i < e; i++) t[i] = arguments[i];
                        var n = N(t), r = n.uri, a = n.callback, o = n.params.method, s = {
                            method: o,
                            relative_url: r.removeQueryData("method").toString()
                        };
                        if (o.toLowerCase() == "post") {
                            s.body = p.encode(r.getQueryData());
                            s.relative_url = r.setQueryData({}).toString();
                        }
                        E.push(s);
                        T.push(a);
                        if (E.length == R) {
                            if (P) clearTimeout(P);
                            U();
                        } else if (!P) P = setTimeout(U, 0);
                    }
                    function U() {
                        !(E.length > 0) ? b(0) : undefined;
                        !(E.length === T.length) ? b(0) : undefined;
                        var e = E, t = T;
                        E = [];
                        T = [];
                        P = null;
                        if (e.length === 1) {
                            var i = e[0], n = t[0], r = i.body ? p.decode(i.body) : null;
                            B(i.relative_url, i.method, r, n);
                            return;
                        }
                        B("/", "POST", {
                            batch: e,
                            include_headers: false,
                            batch_app_id: C || L
                        }, function(e) {
                            if (ES("Array", "isArray", false, e)) {
                                ES(e, "forEach", true, function(e, i) {
                                    t[i](ES("JSON", "parse", false, e.body));
                                });
                            } else ES(t, "forEach", true, function(e) {
                                return e({
                                    error: {
                                        message: "Fatal: batch call failed."
                                    }
                                });
                            });
                        });
                    }
                    function z(e, t) {
                        s.isObject(e);
                        s.isString(e.method, "method missing");
                        if (!t) d.warn("No callback passed to the ApiClient");
                        var i = e.method.toLowerCase().replace(".", "_");
                        e.format = "json-strings";
                        e.api_key = C;
                        var n = i in k ? "api_read" : "api", r = v.resolve(n) + "/restserver.php", a = ES(M, "bind", true, null, t, "/restserver.php", "get", e, ES("Date", "now", false));
                        F(r, "get", e, a);
                    }
                    var q = ES("Object", "assign", false, new h(), {
                        setAccessToken: function(e) {
                            w = e;
                        },
                        setAccessTokenForClientID: function(e, t) {
                            if (!(w && C && C !== t)) w = e;
                        },
                        getAccessToken: function() {
                            return w;
                        },
                        setClientID: function(e) {
                            C = e;
                        },
                        setDefaultParams: function(e) {
                            x = e;
                        },
                        setDefaultTransports: function(e) {
                            A = e;
                        },
                        setMaxConcurrentRequests: function(e) {
                            D = e;
                        },
                        getCurrentlyExecutingRequestCount: function() {
                            return I;
                        },
                        getQueuedRequestCount: function() {
                            return O.length;
                        },
                        rest: z,
                        graph: B,
                        scheduleBatchCall: j
                    });
                    function W(e, t) {
                        return e.toString().length > _ && t === "get";
                    }
                    c.setSwfUrl(y.FlashRequest.swfUrl);
                    r.exports = q;
                }, null);
                __d("sdk.PlatformVersioning", [ "sdk.Runtime", "ManagedError" ], function kt(e, t, i, n, r, a, o, s) {
                    if (t.__markCompiled) t.__markCompiled();
                    var l = /^v\d+\.\d\d?$/, c = {
                        REGEX: l,
                        assertVersionIsSet: function() {
                            if (!o.getVersion()) throw new s("init not called with valid version");
                        },
                        assertValidVersion: function(e) {
                            if (!l.test(e)) throw new s("invalid version specified");
                        }
                    };
                    r.exports = c;
                }, null);
                __d("sdk.api", [ "ApiClient", "sdk.PlatformVersioning", "sdk.Runtime", "sdk.Scribe", "sdk.URI", "sdk.feature" ], function At(e, t, i, n, r, a, o, s, l, c, u, f) {
                    if (t.__markCompiled) t.__markCompiled();
                    var d = f("should_log_response_error", false), h;
                    l.subscribe("ClientID.change", function(e) {
                        return o.setClientID(e);
                    });
                    l.subscribe("AccessToken.change", function(e) {
                        h = e;
                        o.setAccessToken(e);
                    });
                    o.setDefaultParams({
                        sdk: "joey"
                    });
                    o.subscribe("request.complete", function(e, t, i, n) {
                        var r = false;
                        if (n && typeof n == "object") if (n.error) {
                            if (n.error == "invalid_token" || n.error.type == "OAuthException" && n.error.code == 190) r = true;
                        } else if (n.error_code) if (n.error_code == "190") r = true;
                        if (r && h === l.getAccessToken()) l.setAccessToken(null);
                    });
                    o.subscribe("request.complete", function(e, t, i, n) {
                        if ((e == "/me/permissions" && t === "delete" || e == "/restserver.php" && i.method == "Auth.revokeAuthorization") && n === true) l.setAccessToken(null);
                    });
                    o.subscribe("request.error", function(e, t, i, n) {
                        if (d && n.error.type === "http") c.log("jssdk_error", {
                            appId: l.getClientID(),
                            error: "transport",
                            extra: {
                                name: "transport",
                                message: ES("JSON", "stringify", false, n.error)
                            }
                        });
                    });
                    function p(e) {
                        if (typeof e === "string") {
                            if (l.getIsVersioned()) {
                                s.assertVersionIsSet();
                                if (!/https?/.test(e) && e.charAt(0) !== "/") e = "/" + e;
                                e = new u(e).setDomain(null).setProtocol(null).toString();
                                if (!s.REGEX.test(e.substring(1, ES(e, "indexOf", true, "/", 1)))) e = "/" + l.getVersion() + e;
                                var t = [ e ].concat(Array.prototype.slice.call(arguments, 1));
                                o.graph.apply(o, t);
                            } else o.graph.apply(o, arguments);
                        } else o.rest.apply(o, arguments);
                    }
                    r.exports = p;
                }, null);
                __d("legacy:fb.api", [ "FB", "sdk.api" ], function Et(e, t, i, n, r, a, o, s) {
                    if (t.__markCompiled) t.__markCompiled();
                    o.provide("", {
                        api: s
                    });
                }, 3);
                __d("sdk.AppEvents", [ "Assert", "sdk.Impressions", "sdk.Runtime" ], function Tt(e, t, i, n, r, a, o, s, l) {
                    if (t.__markCompiled) t.__markCompiled();
                    var c = {
                        COMPLETED_REGISTRATION: "fb_mobile_complete_registration",
                        VIEWED_CONTENT: "fb_mobile_content_view",
                        SEARCHED: "fb_mobile_search",
                        RATED: "fb_mobile_rate",
                        COMPLETED_TUTORIAL: "fb_mobile_tutorial_completion",
                        ADDED_TO_CART: "fb_mobile_add_to_cart",
                        ADDED_TO_WISHLIST: "fb_mobile_add_to_wishlist",
                        INITIATED_CHECKOUT: "fb_mobile_initiated_checkout",
                        ADDED_PAYMENT_INFO: "fb_mobile_add_payment_info",
                        ACHIEVED_LEVEL: "fb_mobile_level_achieved",
                        UNLOCKED_ACHIEVEMENT: "fb_mobile_achievement_unlocked",
                        SPENT_CREDITS: "fb_mobile_spent_credits"
                    }, u = {
                        ACTIVATED_APP: "fb_mobile_activate_app",
                        PURCHASED: "fb_mobile_purchase"
                    }, f = {
                        CURRENCY: "fb_currency",
                        REGISTRATION_METHOD: "fb_registration_method",
                        CONTENT_TYPE: "fb_content_type",
                        CONTENT_ID: "fb_content_id",
                        SEARCH_STRING: "fb_search_string",
                        SUCCESS: "fb_success",
                        MAX_RATING_VALUE: "fb_max_rating_value",
                        PAYMENT_INFO_AVAILABLE: "fb_payment_info_available",
                        NUM_ITEMS: "fb_num_items",
                        LEVEL: "fb_level",
                        DESCRIPTION: "fb_description"
                    }, d = 40, h = "^[0-9a-zA-Z_]+[0-9a-zA-Z _-]*$";
                    function p(e, t, i, n) {
                        o.isTrue(g(t), "Invalid event name: " + t + ". " + "It must be between 1 and " + d + " characters, " + "and must be contain only alphanumerics, _, - or spaces, " + "starting with alphanumeric or _.");
                        var r = {
                            ae: 1,
                            ev: t,
                            vts: i,
                            canvas: l.isCanvasEnvironment() ? 1 : 0
                        };
                        if (n) r.cd = n;
                        s.impression({
                            api_key: e,
                            payload: ES("JSON", "stringify", false, r)
                        });
                    }
                    function g(e) {
                        if (e === null || e.length === 0 || e.length > d || !new RegExp(h).test(e)) return false;
                        return true;
                    }
                    function m(e, t, i, n) {
                        var r = {};
                        r[f.CURRENCY] = i;
                        p(e, u.PURCHASED, t, babelHelpers._extends({}, n, r));
                    }
                    function v(e) {
                        p(e, u.ACTIVATED_APP);
                    }
                    r.exports = {
                        activateApp: v,
                        logEvent: p,
                        logPurchase: m,
                        isValidEventName: g,
                        EventNames: c,
                        ParameterNames: f
                    };
                }, null);
                __d("legacy:fb.appevents", [ "Assert", "sdk.AppEvents", "FB", "sdk.feature", "sdk.Runtime" ], function Pt(e, t, i, n, r, a, o, s, l, c, u) {
                    if (t.__markCompiled) t.__markCompiled();
                    l.provide("AppEvents", {
                        logEvent: function(e, t, i) {
                            o.isTrue(c("allow_non_canvas_app_events", false) || u.isCanvasEnvironment(), "You can only use this function in Facebook Canvas environment");
                            o.isString(e, "Invalid eventName");
                            o.maybeNumber(t, "Invalid valueToSum");
                            o.maybeObject(i, "Invalid params");
                            var n = u.getClientID();
                            o.isTrue(n !== null && n.length > 0, "You need to call FB.init() with App ID first.");
                            s.logEvent(n, e, t, i);
                        },
                        logPurchase: function(e, t, i) {
                            o.isTrue(c("allow_non_canvas_app_events", false) || u.isCanvasEnvironment(), "You can only use this function in Facebook Canvas environment");
                            o.isNumber(e, "Invalid purchaseAmount");
                            o.isString(t, "Invalid currency");
                            o.maybeObject(i, "Invalid params");
                            var n = u.getClientID();
                            o.isTrue(n !== null && n.length > 0, "You need to call FB.init() with App ID first.");
                            s.logPurchase(n, e, t, i);
                        },
                        activateApp: function() {
                            o.isTrue(c("allow_non_canvas_app_events", false) || u.isCanvasEnvironment(), "You can only use this function in Facebook Canvas environment");
                            var e = u.getClientID();
                            o.isTrue(e !== null && e.length > 0, "You need to call FB.init() with App ID first.");
                            s.activateApp(e);
                        },
                        EventNames: s.EventNames,
                        ParameterNames: s.ParameterNames
                    });
                }, 3);
                __d("sdk.Canvas.Environment", [ "sdk.RPC" ], function It(e, t, i, n, r, a, o) {
                    if (t.__markCompiled) t.__markCompiled();
                    function s(e) {
                        o.remote.getPageInfo(function(t) {
                            e(t.result);
                        });
                    }
                    function l(e, t) {
                        o.remote.scrollTo({
                            x: e || 0,
                            y: t || 0
                        });
                    }
                    o.stub("getPageInfo");
                    o.stub("scrollTo");
                    var c = {
                        getPageInfo: s,
                        scrollTo: l
                    };
                    r.exports = c;
                }, null);
                __d("sdk.fbt", [], function Ot(e, t, i, n, r, a) {
                    if (t.__markCompiled) t.__markCompiled();
                    var o = {
                        _: function(e) {
                            return typeof e === "string" ? e : e[0];
                        }
                    };
                    r.exports = o;
                }, null);
                __d("sdk.Dialog", [ "sdk.Canvas.Environment", "sdk.Content", "sdk.DOM", "DOMEventListener", "ObservableMixin", "sdk.Runtime", "Type", "sdk.UA", "sdk.fbt", "sdk.feature" ], function Dt(e, t, i, n, r, a, o, s, l, c, u, f, d, h, p, g) {
                    if (t.__markCompiled) t.__markCompiled();
                    var m = 30, v = 590, y = 500, b = 240, w = 575;
                    function C() {
                        if (g("dialog_resize_refactor", false)) {
                            var e = l.getViewportInfo();
                            if (e.height && e.width) return {
                                width: Math.min(e.width, y),
                                height: Math.min(e.height, v)
                            };
                        }
                        return null;
                    }
                    var x = d.extend({
                        constructor: function S(e, t) {
                            this.parent();
                            this.id = e;
                            this.display = t;
                            this._e2e = {};
                            if (!_._dialogs) {
                                _._dialogs = {};
                                _._addOrientationHandler();
                            }
                            _._dialogs[e] = this;
                            this.trackEvent("init");
                        },
                        trackEvent: function(e, t) {
                            if (this._e2e[e]) return this;
                            this._e2e[e] = t || ES("Date", "now", false);
                            if (e == "close") this.inform("e2e:end", this._e2e);
                            return this;
                        },
                        trackEvents: function(e) {
                            if (typeof e === "string") e = ES("JSON", "parse", false, e);
                            for (var t in e) if (e.hasOwnProperty(t)) this.trackEvent(t, e[t]);
                            return this;
                        }
                    }, u), _ = {
                        newInstance: function(e, t) {
                            return new x(e, t);
                        },
                        _dialogs: null,
                        _lastYOffset: 0,
                        _overlayListeners: [],
                        _loaderEl: null,
                        _overlayEl: null,
                        _stack: [],
                        _active: null,
                        _forceTabletStyle: null,
                        _closeOnOverlayTap: null,
                        get: function(e) {
                            return _._dialogs[e];
                        },
                        _findRoot: function(e) {
                            while (e) {
                                if (l.containsCss(e, "fb_dialog")) return e;
                                e = e.parentNode;
                            }
                        },
                        _createWWWLoader: function(e) {
                            e = e ? e : 460;
                            return _.create({
                                content: '<div class="dialog_title">' + '  <a id="fb_dialog_loader_close">' + '    <div class="fb_dialog_close_icon"></div>' + "  </a>" + "  <span>Facebook</span>" + '  <div style="clear:both;"></div>' + "</div>" + '<div class="dialog_content"></div>' + '<div class="dialog_footer"></div>',
                                width: e
                            });
                        },
                        _createMobileLoader: function() {
                            var e;
                            if (h.nativeApp()) {
                                e = '<div class="dialog_header"></div>';
                            } else if (_.isTabletStyle()) {
                                e = '<div class="overlayLoader">' + '<div id="fb_dialog_loader_spinner"></div>' + '<a id="fb_dialog_loader_close" href="#">' + p._("Cancel") + "</a>" + "</div>";
                            } else e = '<div class="dialog_header">' + "<table>" + "  <tbody>" + "    <tr>" + '      <td class="header_left">' + '        <label class="touchable_button">' + '          <input type="submit" value="' + p._("Cancel") + '"' + '            id="fb_dialog_loader_close"/>' + "        </label>" + "      </td>" + '      <td class="header_center">' + "        <div>" + "         " + p._("Loading...") + "        </div>" + "      </td>" + '      <td class="header_right">' + "      </td>" + "    </tr>" + "  </tbody>" + "</table>" + "</div>";
                            return _.create({
                                classes: "loading" + (_.isTabletStyle() ? " centered" : ""),
                                content: e
                            });
                        },
                        _restoreBodyPosition: function() {
                            var e = document.body;
                            if (_.isTabletStyle()) {
                                l.removeCss(e, "fb_reposition");
                            } else l.removeCss(e, "fb_hidden");
                        },
                        _showTabletOverlay: function(e) {
                            if (!_.isTabletStyle()) return;
                            if (!_._overlayEl) {
                                _._overlayEl = document.createElement("div");
                                _._overlayEl.setAttribute("id", "fb_dialog_ipad_overlay");
                                s.append(_._overlayEl, null);
                            }
                            if (_._closeOnOverlayTap) {
                                var t = false;
                                setTimeout(function() {
                                    return t = true;
                                }, 3e3);
                                var i = c.add(_._overlayEl, "click", function() {
                                    if (t) e();
                                });
                                _._overlayListeners.push(i);
                            }
                            _._overlayEl.className = "";
                        },
                        _hideTabletOverlay: function() {
                            if (_.isTabletStyle()) {
                                _._overlayEl.className = "hidden";
                                ES(_._overlayListeners, "forEach", true, function(e) {
                                    return e.remove();
                                });
                                _._overlayListeners = [];
                            }
                        },
                        showLoader: function(e, t) {
                            if (!e) e = function() {};
                            var i = function() {
                                _._hideLoader();
                                _._restoreBodyPosition();
                                _._hideTabletOverlay();
                                e();
                            };
                            _._showTabletOverlay(i);
                            if (!_._loaderEl) _._loaderEl = _._findRoot(h.mobile() ? _._createMobileLoader() : _._createWWWLoader(t));
                            var n = document.getElementById("fb_dialog_loader_close");
                            if (n) {
                                l.removeCss(n, "fb_hidden");
                                var r = c.add(n, "click", i);
                                _._overlayListeners.push(r);
                            }
                            _._makeActive(_._loaderEl);
                        },
                        setCloseOnOverlayTap: function(e) {
                            _._closeOnOverlayTap = !!e;
                        },
                        _hideLoader: function() {
                            if (_._loaderEl && _._loaderEl == _._active) _._loaderEl.style.top = "-10000px";
                        },
                        _makeActive: function(e) {
                            _._setDialogSizes();
                            _._lowerActive();
                            _._active = e;
                            if (f.isEnvironment(f.ENVIRONMENTS.CANVAS)) o.getPageInfo(function(e) {
                                _._centerActive(e);
                            });
                            _._centerActive();
                        },
                        _lowerActive: function() {
                            if (!_._active) return;
                            _._active.style.top = "-10000px";
                            _._active = null;
                        },
                        _removeStacked: function(e) {
                            _._stack = ES(_._stack, "filter", true, function(t) {
                                return t != e;
                            });
                        },
                        _centerActive: function(e) {
                            var t = _._active;
                            if (!t) return;
                            var i = l.getViewportInfo(), n = parseInt(t.offsetWidth, 10), r = parseInt(t.offsetHeight, 10), a = i.scrollLeft + (i.width - n) / 2, o = (i.height - r) / 2.5;
                            if (a < o) o = a;
                            var s = i.height - r - o, c = (i.height - r) / 2;
                            if (e) c = e.scrollTop - e.offsetTop + (e.clientHeight - r) / 2;
                            if (c < o) {
                                c = o;
                            } else if (c > s) c = s;
                            c += i.scrollTop;
                            if (h.mobile()) {
                                var u = 100, f = document.body;
                                if (_.isTabletStyle()) {
                                    u += (i.height - r) / 2;
                                    l.addCss(f, "fb_reposition");
                                } else {
                                    l.addCss(f, "fb_hidden");
                                    if (g("dialog_resize_refactor", false)) f.style.width = "auto";
                                    c = 1e4;
                                }
                                var d = l.getByClass("fb_dialog_padding", t);
                                if (d.length) d[0].style.height = u + "px";
                            }
                            t.style.left = (a > 0 ? a : 0) + "px";
                            t.style.top = (c > 0 ? c : 0) + "px";
                        },
                        _setDialogSizes: function() {
                            var e = arguments.length <= 0 || arguments[0] === undefined ? false : arguments[0];
                            if (!h.mobile()) return;
                            for (var t in _._dialogs) if (_._dialogs.hasOwnProperty(t)) {
                                var i = document.getElementById(t);
                                if (i) {
                                    i.style.width = _.getDefaultSize().width + "px";
                                    if (!e) i.style.height = _.getDefaultSize().height + "px";
                                }
                            }
                        },
                        getDefaultSize: function() {
                            if (h.mobile()) {
                                var e = C();
                                if (e) {
                                    if (l.getViewportInfo().width <= e.width) e.width = l.getViewportInfo().width - m;
                                    if (l.getViewportInfo().height <= e.height) e.height = l.getViewportInfo().height - m;
                                    return e;
                                }
                                if (h.ipad()) return {
                                    width: y,
                                    height: v
                                };
                                if (h.android()) {
                                    return {
                                        width: screen.availWidth,
                                        height: screen.availHeight
                                    };
                                } else {
                                    var t = window.innerWidth, i = window.innerHeight, n = t / i > 1.2;
                                    return {
                                        width: t,
                                        height: Math.max(i, n ? screen.width : screen.height)
                                    };
                                }
                            }
                            return {
                                width: w,
                                height: b
                            };
                        },
                        _handleOrientationChange: function() {
                            var e = g("dialog_resize_refactor", false) ? l.getViewportInfo().width : screen.availWidth;
                            _._availScreenWidth = e;
                            if (_.isTabletStyle()) {
                                _._setDialogSizes(true);
                                _._centerActive();
                            } else {
                                var t = _.getDefaultSize().width;
                                for (var i in _._dialogs) if (_._dialogs.hasOwnProperty(i)) {
                                    var n = document.getElementById(i);
                                    if (n) n.style.width = t + "px";
                                }
                            }
                        },
                        _addOrientationHandler: function() {
                            if (!h.mobile()) return;
                            var e = "onorientationchange" in window ? "orientationchange" : "resize";
                            _._availScreenWidth = g("dialog_resize_refactor", false) ? l.getViewportInfo().width : screen.availWidth;
                            c.add(window, e, function(e) {
                                return setTimeout(_._handleOrientationChange, 50);
                            });
                        },
                        create: function(e) {
                            e = e || {};
                            var t = document.createElement("div"), i = document.createElement("div"), n = "fb_dialog";
                            if (e.closeIcon && e.onClose) {
                                var r = document.createElement("a");
                                r.className = "fb_dialog_close_icon";
                                r.onclick = e.onClose;
                                t.appendChild(r);
                            }
                            n += " " + (e.classes || "");
                            if (h.ie()) {
                                n += " fb_dialog_legacy";
                                ES([ "vert_left", "vert_right", "horiz_top", "horiz_bottom", "top_left", "top_right", "bottom_left", "bottom_right" ], "forEach", true, function(e) {
                                    var i = document.createElement("span");
                                    i.className = "fb_dialog_" + e;
                                    t.appendChild(i);
                                });
                            } else n += h.mobile() ? " fb_dialog_mobile" : " fb_dialog_advanced";
                            if (e.content) s.append(e.content, i);
                            t.className = n;
                            var a = parseInt(e.width, 10);
                            if (!isNaN(a)) t.style.width = a + "px";
                            i.className = "fb_dialog_content";
                            t.appendChild(i);
                            if (h.mobile()) {
                                var o = document.createElement("div");
                                o.className = "fb_dialog_padding";
                                t.appendChild(o);
                            }
                            s.append(t);
                            if (e.visible) _.show(t);
                            return i;
                        },
                        show: function(e) {
                            var t = _._findRoot(e);
                            if (t) {
                                _._removeStacked(t);
                                _._hideLoader();
                                _._makeActive(t);
                                _._stack.push(t);
                                if ("fbCallID" in e) _.get(e.fbCallID).inform("iframe_show").trackEvent("show");
                            }
                        },
                        hide: function(e) {
                            var t = _._findRoot(e);
                            _._hideLoader();
                            if (t == _._active) {
                                _._lowerActive();
                                _._restoreBodyPosition();
                                _._hideTabletOverlay();
                                if ("fbCallID" in e) _.get(e.fbCallID).inform("iframe_hide").trackEvent("hide");
                            }
                        },
                        remove: function(e) {
                            e = _._findRoot(e);
                            if (e) {
                                var t = _._active == e;
                                _._removeStacked(e);
                                if (t) {
                                    _._hideLoader();
                                    if (_._stack.length > 0) {
                                        _.show(_._stack.pop());
                                    } else {
                                        _._lowerActive();
                                        _._restoreBodyPosition();
                                        _._hideTabletOverlay();
                                    }
                                } else if (_._active === null && _._stack.length > 0) _.show(_._stack.pop());
                                setTimeout(function() {
                                    e.parentNode.removeChild(e);
                                }, 3e3);
                            }
                        },
                        isActive: function(e) {
                            var t = _._findRoot(e);
                            return t && t === _._active;
                        },
                        setForceTabletStyle: function(e) {
                            _._forceTabletStyle = !!e;
                        },
                        isTabletStyle: function() {
                            var e;
                            if (!h.mobile()) return false;
                            if (_._forceTabletStyle) return true;
                            if (g("dialog_resize_refactor", false)) {
                                var t = C();
                                e = t && (t.height >= v || t.width >= y);
                            } else e = !!h.ipad();
                            return e;
                        }
                    };
                    r.exports = _;
                }, null);
                __d("sdk.Frictionless", [ "sdk.Auth", "sdk.api", "sdk.Event", "sdk.Dialog" ], function Rt(e, t, i, n, r, a, o, s, l, c) {
                    if (t.__markCompiled) t.__markCompiled();
                    var u = {
                        _allowedRecipients: {},
                        _useFrictionless: false,
                        _updateRecipients: function() {
                            u._allowedRecipients = {};
                            s("/me/apprequestformerrecipients", function(e) {
                                if (!e || e.error) return;
                                ES(e.data, "forEach", true, function(e) {
                                    u._allowedRecipients[e.recipient_id] = true;
                                });
                            });
                        },
                        init: function() {
                            u._useFrictionless = true;
                            o.getLoginStatus(function(e) {
                                if (e.status == "connected") u._updateRecipients();
                            });
                            l.subscribe("auth.login", function(e) {
                                if (e.authResponse) u._updateRecipients();
                            });
                        },
                        _processRequestResponse: function(e, t) {
                            return function(i) {
                                var n = i && i.updated_frictionless;
                                if (u._useFrictionless && n) u._updateRecipients();
                                if (i) {
                                    if (!t && i.frictionless) {
                                        c._hideLoader();
                                        c._restoreBodyPosition();
                                        c._hideIPadOverlay();
                                    }
                                    delete i.frictionless;
                                    delete i.updated_frictionless;
                                }
                                e && e(i);
                            };
                        },
                        isAllowed: function(e) {
                            if (!e) return false;
                            if (typeof e === "number") return e in u._allowedRecipients;
                            if (typeof e === "string") e = e.split(",");
                            e = ES(e, "map", true, function(e) {
                                return ES(String(e), "trim", true);
                            });
                            var t = true, i = false;
                            ES(e, "forEach", true, function(e) {
                                t = t && e in u._allowedRecipients;
                                i = true;
                            });
                            return t && i;
                        }
                    };
                    l.subscribe("init:post", function(e) {
                        if (e.frictionlessRequests) u.init();
                    });
                    r.exports = u;
                }, null);
                __d("sdk.Native", [ "Log", "sdk.UA" ], function Lt(e, t, i, n, r, a, o, s) {
                    if (t.__markCompiled) t.__markCompiled();
                    var l = "fbNativeReady", c = {
                        onready: function(e) {
                            if (!s.nativeApp()) {
                                o.error("FB.Native.onready only works when the page is rendered " + "in a WebView of the native Facebook app. Test if this is the " + "case calling FB.UA.nativeApp()");
                                return;
                            }
                            if (window.__fbNative && !this.nativeReady) ES("Object", "assign", false, this, window.__fbNative);
                            if (this.nativeReady) {
                                e();
                            } else {
                                var t = function(i) {
                                    window.removeEventListener(l, t);
                                    this.onready(e);
                                };
                                window.addEventListener(l, t, false);
                            }
                        }
                    };
                    r.exports = c;
                }, null);
                __d("resolveURI", [], function Ft(e, t, i, n, r, a) {
                    if (t.__markCompiled) t.__markCompiled();
                    function o(e) {
                        if (!e) return window.location.href;
                        e = e.replace(/&/g, "&amp;").replace(/"/g, "&quot;");
                        var t = document.createElement("div");
                        t.innerHTML = '<a href="' + e + '"></a>';
                        return t.firstChild.href;
                    }
                    r.exports = o;
                }, null);
                __d("sdk.UIServer", [ "sdk.Auth", "sdk.Content", "sdk.DOM", "sdk.Dialog", "sdk.Event", "sdk.Frictionless", "Log", "sdk.Native", "QueryString", "sdk.RPC", "sdk.Runtime", "JSSDKConfig", "sdk.UA", "UrlMap", "sdk.XD", "createObjectFrom", "sdk.feature", "sdk.fbt", "flattenObject", "sdk.getContextType", "guid", "insertIframe", "resolveURI" ], function Mt(e, t, i, n, r, a, o, s, l, c, u, f, d, h, p, g, m, v, y, b, w, C, x, _, S, k, A, E, T) {
                    if (t.__markCompiled) t.__markCompiled();
                    var P = {
                        transform: function(e) {
                            if (e.params.display === "touch" && L.canIframe(e.params) && window.postMessage) {
                                e.params.channel = L._xdChannelHandler(e.id, "parent");
                                if (!y.nativeApp()) e.params.in_iframe = 1;
                                return e;
                            } else return L.genericTransform(e);
                        },
                        getXdRelation: function(e) {
                            var t = e.display;
                            if (t === "touch" && window.postMessage && e.in_iframe) return "parent";
                            return L.getXdRelation(e);
                        }
                    }, I = {
                        "stream.share": {
                            size: {
                                width: 670,
                                height: 340
                            },
                            url: "sharer.php",
                            transform: function(e) {
                                if (!e.params.u) e.params.u = window.location.toString();
                                e.params.display = "popup";
                                return e;
                            }
                        },
                        apprequests: {
                            transform: function(e) {
                                e = P.transform(e);
                                e.params.frictionless = f && f._useFrictionless;
                                if (e.params.frictionless) {
                                    if (f.isAllowed(e.params.to)) {
                                        e.params.display = "iframe";
                                        e.params.in_iframe = true;
                                        e.hideLoader = true;
                                    }
                                    e.cb = f._processRequestResponse(e.cb, e.hideLoader);
                                }
                                e.closeIcon = false;
                                return e;
                            },
                            getXdRelation: P.getXdRelation
                        },
                        feed: P,
                        "permissions.oauth": {
                            url: "dialog/oauth",
                            size: {
                                width: y.mobile() ? null : 475,
                                height: y.mobile() ? null : 183
                            },
                            transform: function(e) {
                                if (!m.getClientID()) {
                                    d.error("FB.login() called before FB.init().");
                                    return;
                                }
                                if (o.getAuthResponse() && !e.params.scope && !e.params.auth_type) {
                                    d.error("FB.login() called when user is already connected.");
                                    e.cb && e.cb({
                                        status: m.getLoginStatus(),
                                        authResponse: o.getAuthResponse()
                                    });
                                    return;
                                }
                                var t = e.cb, i = e.id;
                                delete e.cb;
                                var n = ES("Object", "keys", false, ES("Object", "assign", false, e.params.response_type ? C(e.params.response_type.split(",")) : {}, {
                                    token: true,
                                    signed_request: true
                                })).join(",");
                                if (e.params.display === "async") {
                                    ES("Object", "assign", false, e.params, {
                                        client_id: m.getClientID(),
                                        origin: k(),
                                        response_type: n,
                                        domain: location.hostname
                                    });
                                    e.cb = o.xdResponseWrapper(t, o.getAuthResponse(), "permissions.oauth");
                                } else ES("Object", "assign", false, e.params, {
                                    client_id: m.getClientID(),
                                    redirect_uri: T(L.xdHandler(t, i, "opener", o.getAuthResponse(), "permissions.oauth")),
                                    origin: k(),
                                    response_type: n,
                                    domain: location.hostname
                                });
                                return e;
                            }
                        },
                        "auth.logout": {
                            url: "logout.php",
                            transform: function(e) {
                                if (!m.getClientID()) {
                                    d.error("FB.logout() called before calling FB.init().");
                                } else if (!o.getAuthResponse()) {
                                    d.error("FB.logout() called without an access token.");
                                } else {
                                    e.params.next = L.xdHandler(e.cb, e.id, "parent", o.getAuthResponse(), "logout");
                                    return e;
                                }
                            }
                        },
                        "login.status": {
                            url: "dialog/oauth",
                            transform: function(e) {
                                var t = e.cb, i = e.id;
                                delete e.cb;
                                ES("Object", "assign", false, e.params, {
                                    client_id: m.getClientID(),
                                    redirect_uri: L.xdHandler(t, i, "parent", o.getAuthResponse(), "login_status"),
                                    origin: k(),
                                    response_type: "token,signed_request,code",
                                    domain: location.hostname
                                });
                                return e;
                            }
                        },
                        pay: {
                            size: {
                                width: 555,
                                height: 120
                            },
                            connectDisplay: "popup"
                        }
                    }, O = {};
                    function D(e, t) {
                        O[t] = true;
                        return function(i) {
                            delete O[t];
                            e(i);
                        };
                    }
                    function R(e) {
                        if (!x("should_force_single_dialog_instance", true)) return false;
                        var t = e.method.toLowerCase();
                        if (t === "pay" && e.display === "async") return true;
                        return false;
                    }
                    var L = {
                        Methods: I,
                        _loadedNodes: {},
                        _defaultCb: {},
                        _resultToken: '"xxRESULTTOKENxx"',
                        genericTransform: function(e) {
                            if (e.params.display == "dialog" || e.params.display == "iframe") ES("Object", "assign", false, e.params, {
                                display: "iframe",
                                channel: L._xdChannelHandler(e.id, "parent.parent")
                            }, true);
                            return e;
                        },
                        checkOauthDisplay: function(e) {
                            var t = e.scope || e.perms || m.getScope();
                            if (!t) return e.display;
                            var i = t.split(/\s|,/g);
                            for (var n = 0; n < i.length; n++) if (!v.initSitevars.iframePermissions[ES(i[n], "trim", true)]) return "popup";
                            return e.display;
                        },
                        prepareCall: function(e, t) {
                            var i = e.method.toLowerCase(), n = L.Methods.hasOwnProperty(i) ? ES("Object", "assign", false, {}, L.Methods[i]) : {}, r = A(), a = m.getSecure() || i !== "auth.status" && i != "login.status";
                            ES("Object", "assign", false, e, {
                                app_id: m.getClientID(),
                                locale: m.getLocale(),
                                sdk: "joey",
                                access_token: a && m.getAccessToken() || undefined
                            });
                            if (i === "share" || i === "share_open_graph") if (e.iframe_test) n = ES("Object", "assign", false, {}, P);
                            e.display = L.getDisplayMode(n, e);
                            if (!n.url) n.url = "dialog/" + i;
                            if ((n.url == "dialog/oauth" || n.url == "dialog/permissions.request") && (e.display == "iframe" || e.display == "touch" && e.in_iframe)) e.display = L.checkOauthDisplay(e);
                            if (e.display == "popup") delete e.access_token;
                            if (m.getIsVersioned() && n.url.substring(0, 7) === "dialog/") n.url = e.version + "/" + n.url;
                            if (R(e)) {
                                if (O[i]) {
                                    var o = 'Dialog "' + i + '" is trying to run more than once.';
                                    d.warn(o);
                                    t({
                                        error_code: -100,
                                        error_message: o
                                    });
                                    return;
                                }
                                t = D(t, i);
                            }
                            var s = {
                                cb: t,
                                id: r,
                                size: n.size || L.getDefaultSize(),
                                url: b.resolve(e.display == "touch" ? "m" : "www", a) + "/" + n.url,
                                params: e,
                                name: i,
                                dialog: c.newInstance(r, e.display)
                            }, l = n.transform ? n.transform : L.genericTransform;
                            if (l) {
                                s = l(s);
                                if (!s) return;
                            }
                            if (e.display === "touch" && e.in_iframe) s.params.parent_height = window.innerHeight;
                            var u = n.getXdRelation || L.getXdRelation, f = u(s.params);
                            if (!(s.id in L._defaultCb) && !("next" in s.params) && !("redirect_uri" in s.params)) s.params.next = L._xdResult(s.cb, s.id, f, true);
                            if (f === "parent") ES("Object", "assign", false, s.params, {
                                channel_url: L._xdChannelHandler(r, "parent.parent")
                            }, true);
                            s = L.prepareParams(s);
                            return s;
                        },
                        prepareParams: function(e) {
                            if (e.params.display !== "async") delete e.params.method;
                            e.params = S(e.params);
                            var t = p.encode(e.params);
                            if (!y.nativeApp() && L.urlTooLongForIE(e.url + "?" + t)) {
                                e.post = true;
                            } else if (t) e.url += "?" + t;
                            return e;
                        },
                        urlTooLongForIE: function(e) {
                            return y.ie() && y.ie() <= 8 && e.length > 2048;
                        },
                        getDisplayMode: function(e, t) {
                            if (t.display === "hidden" || t.display === "none") return t.display;
                            var i = m.isEnvironment(m.ENVIRONMENTS.CANVAS) || m.isEnvironment(m.ENVIRONMENTS.PAGETAB);
                            if (i && !t.display) return "async";
                            if (y.mobile() || t.display === "touch") return "touch";
                            if (t.display == "iframe" || t.display == "dialog") if (!L.canIframe(t)) {
                                d.error('"dialog" mode can only be used when the user is connected.');
                                return "popup";
                            }
                            if (e.connectDisplay && !i) return e.connectDisplay;
                            return t.display || (L.canIframe(t) ? "dialog" : "popup");
                        },
                        canIframe: function(e) {
                            if (m.getAccessToken()) return true;
                            if (y.mobile() && m.getLoginStatus() === "not_authorized") return !!e.iframe_test;
                            return false;
                        },
                        getXdRelation: function(e) {
                            var t = e.display;
                            if (t === "popup" || t === "touch") return "opener";
                            if (t === "dialog" || t === "iframe" || t === "hidden" || t === "none") return "parent";
                            if (t === "async") return "parent.frames[" + window.name + "]";
                        },
                        popup: function(e) {
                            var t = typeof window.screenX != "undefined" ? window.screenX : window.screenLeft, i = typeof window.screenY != "undefined" ? window.screenY : window.screenTop, n = typeof window.outerWidth != "undefined" ? window.outerWidth : document.documentElement.clientWidth, r = typeof window.outerHeight != "undefined" ? window.outerHeight : document.documentElement.clientHeight - 22, a = y.mobile() ? null : e.size.width, o = y.mobile() ? null : e.size.height, l = t < 0 ? window.screen.width + t : t, c = parseInt(l + (n - a) / 2, 10), u = parseInt(i + (r - o) / 2.5, 10), f = [];
                            if (a !== null) f.push("width=" + a);
                            if (o !== null) f.push("height=" + o);
                            f.push("left=" + c);
                            f.push("top=" + u);
                            f.push("scrollbars=1");
                            if (e.name == "permissions.request" || e.name == "permissions.oauth") f.push("location=1,toolbar=0");
                            f = f.join(",");
                            var d;
                            if (e.post) {
                                d = window.open("about:blank", e.id, f);
                                if (d) {
                                    L.setLoadedNode(e, d, "popup");
                                    s.submitToTarget({
                                        url: e.url,
                                        target: e.id,
                                        params: e.params
                                    });
                                }
                            } else {
                                d = window.open(e.url, e.id, f);
                                if (d) L.setLoadedNode(e, d, "popup");
                            }
                            if (!d) return;
                            if (e.id in L._defaultCb) L._popupMonitor();
                        },
                        setLoadedNode: function(e, t, i) {
                            if (i === "iframe") t.fbCallID = e.id;
                            t = {
                                node: t,
                                type: i,
                                fbCallID: e.id
                            };
                            L._loadedNodes[e.id] = t;
                        },
                        getLoadedNode: function(e) {
                            var t = typeof e == "object" ? e.id : e, i = L._loadedNodes[t];
                            return i ? i.node : null;
                        },
                        hidden: function(e) {
                            e.className = "FB_UI_Hidden";
                            e.root = s.appendHidden("");
                            L._insertIframe(e);
                        },
                        iframe: function(e) {
                            e.className = "FB_UI_Dialog";
                            if (e.params.iframe_test) {
                                c.setForceTabletStyle(true);
                                c.setCloseOnOverlayTap(true);
                            }
                            var t = function() {
                                var t = ES("JSON", "stringify", false, {
                                    error_code: 4201,
                                    error_message: _._("User canceled the Dialog flow")
                                });
                                L._triggerDefault(e.id, t);
                            };
                            e.root = c.create({
                                onClose: t,
                                closeIcon: e.closeIcon === undefined ? true : e.closeIcon,
                                classes: c.isTabletStyle() ? "centered" : ""
                            });
                            if (!e.hideLoader) c.showLoader(t, e.size.width);
                            l.addCss(e.root, "fb_dialog_iframe");
                            L._insertIframe(e);
                        },
                        touch: function(e) {
                            if (e.params && e.params.in_iframe) {
                                if (e.ui_created) {
                                    c.showLoader(function() {
                                        L._triggerDefault(e.id, null);
                                    }, 0);
                                } else L.iframe(e);
                            } else if (y.nativeApp() && !e.ui_created) {
                                e.frame = e.id;
                                h.onready(function() {
                                    L.setLoadedNode(e, h.open(e.url + "#cb=" + e.frameName), "native");
                                });
                                L._popupMonitor();
                            } else if (!e.ui_created) L.popup(e);
                        },
                        async: function(e) {
                            e.params.redirect_uri = location.protocol + "//" + location.host + location.pathname;
                            delete e.params.access_token;
                            g.remote.showDialog(e.params, function(t) {
                                var i = t.result;
                                if (i && i.e2e) {
                                    var n = c.get(e.id);
                                    n.trackEvents(i.e2e);
                                    n.trackEvent("close");
                                    delete i.e2e;
                                }
                                e.cb(i);
                            });
                        },
                        getDefaultSize: function() {
                            return c.getDefaultSize();
                        },
                        _insertIframe: function(e) {
                            L._loadedNodes[e.id] = false;
                            var t = function(t) {
                                if (e.id in L._loadedNodes) L.setLoadedNode(e, t, "iframe");
                            };
                            if (e.post) {
                                E({
                                    url: "about:blank",
                                    root: e.root,
                                    className: e.className,
                                    width: e.size.width,
                                    height: e.size.height,
                                    id: e.id,
                                    onInsert: t,
                                    onload: function(t) {
                                        s.submitToTarget({
                                            url: e.url,
                                            target: t.name,
                                            params: e.params
                                        });
                                    }
                                });
                            } else E({
                                url: e.url,
                                root: e.root,
                                className: e.className,
                                width: e.size.width,
                                height: e.size.height,
                                id: e.id,
                                name: e.frameName,
                                onInsert: t
                            });
                        },
                        _handleResizeMessage: function(e, t) {
                            var i = L.getLoadedNode(e);
                            if (!i) return;
                            if (t.height) i.style.height = t.height + "px";
                            if (t.width) i.style.width = t.width + "px";
                            w.inform("resize.ack", t || {}, "parent.frames[" + i.name + "]");
                            if (!c.isActive(i)) {
                                c.show(i);
                            } else c._centerActive();
                        },
                        _triggerDefault: function(e, t) {
                            var i = {
                                frame: e
                            };
                            if (t) i.result = t;
                            L._xdRecv(i, L._defaultCb[e] || function() {});
                        },
                        _popupMonitor: function() {
                            var e;
                            for (var t in L._loadedNodes) if (L._loadedNodes.hasOwnProperty(t) && t in L._defaultCb) {
                                var i = L._loadedNodes[t];
                                if (i.type != "popup" && i.type != "native") continue;
                                var n = i.node;
                                try {
                                    if (n.closed) {
                                        L._triggerDefault(t, null);
                                    } else e = true;
                                } catch (r) {}
                            }
                            if (e && !L._popupInterval) {
                                L._popupInterval = setInterval(L._popupMonitor, 100);
                            } else if (!e && L._popupInterval) {
                                clearInterval(L._popupInterval);
                                L._popupInterval = null;
                            }
                        },
                        _xdChannelHandler: function(e, t) {
                            return w.handler(function(t) {
                                var i = L.getLoadedNode(e);
                                if (!i) return;
                                if (t.type == "resize") {
                                    L._handleResizeMessage(e, t);
                                } else if (t.type == "hide") {
                                    c.hide(i);
                                } else if (t.type == "rendered") {
                                    var n = c._findRoot(i);
                                    c.show(n);
                                } else if (t.type == "fireevent") u.fire(t.event);
                            }, t, true, null);
                        },
                        _xdNextHandler: function(e, t, i, n) {
                            if (n) L._defaultCb[t] = e;
                            return w.handler(function(t) {
                                L._xdRecv(t, e);
                            }, i) + "&frame=" + t;
                        },
                        _xdRecv: function(e, t) {
                            var i = L.getLoadedNode(e.frame);
                            if (i) if (i.close) {
                                try {
                                    i.close();
                                    if (/iPhone.*Version\/(5|6)/.test(navigator.userAgent) && RegExp.$1 !== "5") window.focus();
                                    L._popupCount--;
                                } catch (n) {}
                            } else if (l.containsCss(i, "FB_UI_Hidden")) {
                                setTimeout(function() {
                                    i.parentNode.parentNode.removeChild(i.parentNode);
                                }, 3e3);
                            } else if (l.containsCss(i, "FB_UI_Dialog")) c.remove(i);
                            delete L._loadedNodes[e.frame];
                            delete L._defaultCb[e.frame];
                            if (e.e2e) {
                                var r = c.get(e.frame);
                                r.trackEvents(e.e2e);
                                r.trackEvent("close");
                                delete e.e2e;
                            }
                            t(e);
                        },
                        _xdResult: function(e, t, i, n) {
                            return L._xdNextHandler(function(t) {
                                e && e(t.result && t.result != L._resultToken && ES("JSON", "parse", false, t.result));
                            }, t, i, n) + "&result=" + encodeURIComponent(L._resultToken);
                        },
                        xdHandler: function(e, t, i, n, r) {
                            return L._xdNextHandler(o.xdResponseWrapper(e, n, r), t, i, true);
                        }
                    };
                    g.stub("showDialog");
                    r.exports = L;
                }, null);
                __d("sdk.ui", [ "Assert", "sdk.Impressions", "Log", "sdk.PlatformVersioning", "sdk.Runtime", "sdk.UIServer", "sdk.feature" ], function Nt(e, t, i, n, r, a, o, s, l, c, u, f, d) {
                    if (t.__markCompiled) t.__markCompiled();
                    function h(e, t) {
                        o.isObject(e);
                        o.maybeFunction(t);
                        if (u.getIsVersioned()) {
                            c.assertVersionIsSet();
                            if (e.version) {
                                c.assertValidVersion(e.version);
                            } else e.version = u.getVersion();
                        }
                        e = ES("Object", "assign", false, {}, e);
                        if (!e.method) {
                            l.error('"method" is a required parameter for FB.ui().');
                            return null;
                        }
                        if (e.method == "pay.prompt") e.method = "pay";
                        var i = e.method;
                        if (e.redirect_uri) {
                            l.warn("When using FB.ui, you should not specify a redirect_uri.");
                            delete e.redirect_uri;
                        }
                        if ((i == "permissions.request" || i == "permissions.oauth") && (e.display == "iframe" || e.display == "dialog")) e.display = f.checkOauthDisplay(e);
                        var n = d("e2e_tracking", true);
                        if (n) e.e2e = {};
                        var r = f.prepareCall(e, t || function() {});
                        if (!r) return null;
                        var a = r.params.display;
                        if (a === "dialog") {
                            a = "iframe";
                        } else if (a === "none") a = "hidden";
                        var h = f[a];
                        if (!h) {
                            l.error('"display" must be one of "popup", ' + '"dialog", "iframe", "touch", "async", "hidden", or "none"');
                            return null;
                        }
                        if (n) r.dialog.subscribe("e2e:end", function(e) {
                            e.method = i;
                            e.display = a;
                            l.debug("e2e: %s", ES("JSON", "stringify", false, e));
                            s.log(114, {
                                payload: e
                            });
                        });
                        h(r);
                        return r.dialog;
                    }
                    r.exports = h;
                }, null);
                __d("legacy:fb.auth", [ "sdk.Auth", "sdk.Cookie", "sdk.Event", "FB", "Log", "sdk.Runtime", "sdk.SignedRequest", "sdk.ui" ], function Bt(e, t, i, n, r, a, o, s, l, c, u, f, d, h) {
                    if (t.__markCompiled) t.__markCompiled();
                    c.provide("", {
                        getLoginStatus: function() {
                            return o.getLoginStatus.apply(o, arguments);
                        },
                        getAuthResponse: function() {
                            return o.getAuthResponse();
                        },
                        getAccessToken: function() {
                            return f.getAccessToken() || null;
                        },
                        getUserID: function() {
                            return f.getUserID() || f.getCookieUserID();
                        },
                        login: function(e, t) {
                            if (t && t.perms && !t.scope) {
                                t.scope = t.perms;
                                delete t.perms;
                                u.warn("OAuth2 specification states that 'perms' " + "should now be called 'scope'.  Please update.");
                            }
                            var i = f.isEnvironment(f.ENVIRONMENTS.CANVAS) || f.isEnvironment(f.ENVIRONMENTS.PAGETAB);
                            h(babelHelpers._extends({
                                method: "permissions.oauth",
                                display: i ? "async" : "popup",
                                domain: location.hostname
                            }, t || {}), e);
                        },
                        logout: function(e) {
                            h({
                                method: "auth.logout",
                                display: "hidden"
                            }, e);
                        }
                    });
                    o.subscribe("logout", ES(l.fire, "bind", true, l, "auth.logout"));
                    o.subscribe("login", ES(l.fire, "bind", true, l, "auth.login"));
                    o.subscribe("authresponse.change", ES(l.fire, "bind", true, l, "auth.authResponseChange"));
                    o.subscribe("status.change", ES(l.fire, "bind", true, l, "auth.statusChange"));
                    l.subscribe("init:post", function(e) {
                        if (e.status) o.getLoginStatus();
                        if (f.getClientID()) if (e.authResponse) {
                            o.setAuthResponse(e.authResponse, "connected");
                        } else if (f.getUseCookie()) {
                            var t = s.loadSignedRequest(), i;
                            if (t) {
                                try {
                                    i = d.parse(t);
                                } catch (n) {
                                    s.clearSignedRequestCookie();
                                }
                                if (i && i.user_id) f.setCookieUserID(i.user_id);
                            }
                            s.loadMeta();
                        }
                    });
                }, 3);
                __d("sdk.Canvas.IframeHandling", [ "DOMWrapper", "sdk.RPC" ], function jt(e, t, i, n, r, a, o, s) {
                    if (t.__markCompiled) t.__markCompiled();
                    var l = null, c;
                    function u() {
                        var e = o.getWindow().document, t = e.body, i = e.documentElement, n = Math.max(t.offsetTop, 0), r = Math.max(i.offsetTop, 0), a = t.scrollHeight + n, s = t.offsetHeight + n, l = i.scrollHeight + r, c = i.offsetHeight + r;
                        return Math.max(a, s, l, c);
                    }
                    function f(e) {
                        if (typeof e != "object") e = {};
                        var t = 0, i = 0;
                        if (!e.height) {
                            e.height = u();
                            t = 16;
                            i = 4;
                        }
                        if (!e.frame) e.frame = window.name || "iframe_canvas";
                        if (c) {
                            var n = c.height, r = e.height - n;
                            if (r <= i && r >= -t) return false;
                        }
                        c = e;
                        s.remote.setSize(e);
                        return true;
                    }
                    function d(e, t) {
                        if (t === undefined && typeof e === "number") {
                            t = e;
                            e = true;
                        }
                        if (e || e === undefined) {
                            if (l === null) l = setInterval(function() {
                                f();
                            }, t || 100);
                            f();
                        } else if (l !== null) {
                            clearInterval(l);
                            l = null;
                        }
                    }
                    s.stub("setSize");
                    var h = {
                        setSize: f,
                        setAutoGrow: d
                    };
                    r.exports = h;
                }, null);
                __d("sdk.Canvas.Navigation", [ "sdk.RPC" ], function Ut(e, t, i, n, r, a, o) {
                    if (t.__markCompiled) t.__markCompiled();
                    function s(e) {
                        o.local.navigate = function(t) {
                            e({
                                path: t
                            });
                        };
                        o.remote.setNavigationEnabled(true);
                    }
                    o.stub("setNavigationEnabled");
                    var l = {
                        setUrlHandler: s
                    };
                    r.exports = l;
                }, null);
                __d("sdk.Canvas.Plugin", [ "Log", "sdk.RPC", "sdk.Runtime", "sdk.UA", "sdk.api", "createArrayFromMixed" ], function zt(e, t, i, n, r, a, o, s, l, c, u, f) {
                    if (t.__markCompiled) t.__markCompiled();
                    var d = "CLSID:D27CDB6E-AE6D-11CF-96B8-444553540000", h = "CLSID:444785F1-DE89-4295-863A-D46C3A781394", p = null, g = c.osx() && c.osx.getVersionParts(), m = !(g && g[0] > 10 && g[1] > 10 && (c.chrome() >= 31 || c.webkit() >= 537.71 || c.firefox() >= 25));
                    function v(e) {
                        e._hideunity_savedstyle = {};
                        e._hideunity_savedstyle.left = e.style.left;
                        e._hideunity_savedstyle.position = e.style.position;
                        e._hideunity_savedstyle.width = e.style.width;
                        e._hideunity_savedstyle.height = e.style.height;
                        e.style.left = "-10000px";
                        e.style.position = "absolute";
                        e.style.width = "1px";
                        e.style.height = "1px";
                    }
                    function y(e) {
                        if (e._hideunity_savedstyle) {
                            e.style.left = e._hideunity_savedstyle.left;
                            e.style.position = e._hideunity_savedstyle.position;
                            e.style.width = e._hideunity_savedstyle.width;
                            e.style.height = e._hideunity_savedstyle.height;
                        }
                    }
                    function b(e) {
                        e._old_visibility = e.style.visibility;
                        e.style.visibility = "hidden";
                    }
                    function w(e) {
                        e.style.visibility = e._old_visibility || "";
                        delete e._old_visibility;
                    }
                    function C(e) {
                        var t = e.type ? e.type.toLowerCase() : null, i = t === "application/x-shockwave-flash" || e.classid && e.classid.toUpperCase() == d;
                        if (!i) return false;
                        var n = /opaque|transparent/i;
                        if (n.test(e.getAttribute("wmode"))) return false;
                        for (var r = 0; r < e.childNodes.length; r++) {
                            var a = e.childNodes[r];
                            if (/param/i.test(a.nodeName) && /wmode/i.test(a.name) && n.test(a.value)) return false;
                        }
                        return true;
                    }
                    function x(e) {
                        var t = e.type ? e.type.toLowerCase() : null;
                        return t === "application/vnd.unity" || e.classid && e.classid.toUpperCase() == h;
                    }
                    function _(e) {
                        var t = f(window.document.getElementsByTagName("object"));
                        t = t.concat(f(window.document.getElementsByTagName("embed")));
                        var i = false, n = false;
                        ES(t, "forEach", true, function(t) {
                            var r = C(t), a = m && x(t);
                            if (!r && !a) return;
                            i = i || r;
                            n = n || a;
                            var s = function() {
                                if (e.state === "opened") {
                                    if (r) {
                                        b(t);
                                    } else v(t);
                                } else if (r) {
                                    w(t);
                                } else y(t);
                            };
                            if (p) {
                                o.info("Calling developer specified callback");
                                var l = {
                                    state: e.state,
                                    elem: t
                                };
                                p(l);
                                setTimeout(s, 200);
                            } else s();
                        });
                        if (Math.random() <= 1 / 1e3) {
                            var r = {
                                unity: n,
                                flash: i
                            };
                            u(l.getClientID() + "/occludespopups", "post", r);
                        }
                    }
                    s.local.hidePluginObjects = function() {
                        o.info("hidePluginObjects called");
                        _({
                            state: "opened"
                        });
                    };
                    s.local.showPluginObjects = function() {
                        o.info("showPluginObjects called");
                        _({
                            state: "closed"
                        });
                    };
                    s.local.showFlashObjects = s.local.showPluginObjects;
                    s.local.hideFlashObjects = s.local.hidePluginObjects;
                    function S() {
                        b();
                        v();
                    }
                    function k() {
                        w();
                        y();
                    }
                    var A = {
                        _setHidePluginCallback: function(e) {
                            p = e;
                        },
                        hidePluginElement: S,
                        showPluginElement: k
                    };
                    r.exports = A;
                }, null);
                __d("sdk.Canvas.Tti", [ "sdk.RPC", "sdk.Runtime" ], function qt(e, t, i, n, r, a, o, s) {
                    if (t.__markCompiled) t.__markCompiled();
                    function l(e, t) {
                        var i = {
                            appId: s.getClientID(),
                            time: ES("Date", "now", false),
                            name: t
                        }, n = [ i ];
                        if (e) n.push(function(t) {
                            e(t.result);
                        });
                        o.remote.logTtiMessage.apply(null, n);
                    }
                    function c() {
                        l(null, "StartIframeAppTtiTimer");
                    }
                    function u(e) {
                        l(e, "StopIframeAppTtiTimer");
                    }
                    function f(e) {
                        l(e, "RecordIframeAppTti");
                    }
                    o.stub("logTtiMessage");
                    var d = {
                        setDoneLoading: f,
                        startTimer: c,
                        stopTimer: u
                    };
                    r.exports = d;
                }, null);
                __d("legacy:fb.canvas", [ "Assert", "sdk.Canvas.Environment", "sdk.Event", "FB", "sdk.Canvas.IframeHandling", "sdk.Canvas.Navigation", "sdk.Canvas.Plugin", "sdk.RPC", "sdk.Runtime", "sdk.Canvas.Tti" ], function Wt(e, t, i, n, r, a, o, s, l, c, u, f, d, h, p, g) {
                    if (t.__markCompiled) t.__markCompiled();
                    c.provide("Canvas", {
                        setSize: function(e) {
                            o.maybeObject(e, "Invalid argument");
                            return u.setSize.apply(null, arguments);
                        },
                        setAutoGrow: function() {
                            return u.setAutoGrow.apply(null, arguments);
                        },
                        getPageInfo: function(e) {
                            o.isFunction(e, "Invalid argument");
                            return s.getPageInfo.apply(null, arguments);
                        },
                        scrollTo: function(e, t) {
                            o.maybeNumber(e, "Invalid argument");
                            o.maybeNumber(t, "Invalid argument");
                            return s.scrollTo.apply(null, arguments);
                        },
                        setDoneLoading: function(e) {
                            o.maybeFunction(e, "Invalid argument");
                            return g.setDoneLoading.apply(null, arguments);
                        },
                        startTimer: function() {
                            return g.startTimer.apply(null, arguments);
                        },
                        stopTimer: function(e) {
                            o.maybeFunction(e, "Invalid argument");
                            return g.stopTimer.apply(null, arguments);
                        },
                        getHash: function(e) {
                            o.isFunction(e, "Invalid argument");
                            return f.getHash.apply(null, arguments);
                        },
                        setHash: function(e) {
                            o.isString(e, "Invalid argument");
                            return f.setHash.apply(null, arguments);
                        },
                        setUrlHandler: function(e) {
                            o.isFunction(e, "Invalid argument");
                            return f.setUrlHandler.apply(null, arguments);
                        }
                    });
                    h.local.fireEvent = ES(l.fire, "bind", true, l);
                    l.subscribe("init:post", function(e) {
                        if (p.isEnvironment(p.ENVIRONMENTS.CANVAS)) {
                            o.isTrue(!e.hideFlashCallback || !e.hidePluginCallback, "cannot specify deprecated hideFlashCallback and new hidePluginCallback");
                            d._setHidePluginCallback(e.hidePluginCallback || e.hideFlashCallback);
                        }
                    });
                }, 3);
                __d("legacy:fb.canvas.syncrequests", [ "sdk.RPC", "sdk.Event" ], function Ht(e, t, i, n, r, a, o, s) {
                    if (t.__markCompiled) t.__markCompiled();
                    o.stub("initPendingSyncRequests");
                    function l(e, t) {
                        if (e != "canvas.syncRequestUpdated") return;
                        o.remote.initPendingSyncRequests();
                        s.unsubscribe(s.SUBSCRIBE, l);
                    }
                    s.subscribe(s.SUBSCRIBE, l);
                }, 3);
                __d("sdk.Canvas.Prefetcher", [ "sdk.api", "createArrayFromMixed", "JSSDKCanvasPrefetcherConfig", "sdk.Runtime" ], function Gt(e, t, i, n, r, a, o, s, l, c) {
                    if (t.__markCompiled) t.__markCompiled();
                    var u = {
                        AUTOMATIC: 0,
                        MANUAL: 1
                    }, f = l.sampleRate, d = l.blacklist, h = u.AUTOMATIC, p = [];
                    function g() {
                        var e = {
                            object: "data",
                            link: "href",
                            script: "src"
                        };
                        if (h == u.AUTOMATIC) ES(ES("Object", "keys", false, e), "forEach", true, function(t) {
                            var i = e[t];
                            ES(s(document.getElementsByTagName(t)), "forEach", true, function(e) {
                                if (e[i]) p.push(e[i]);
                            });
                        });
                        if (p.length === 0) return;
                        o(c.getClientID() + "/staticresources", "post", {
                            urls: ES("JSON", "stringify", false, p),
                            is_https: location.protocol === "https:"
                        });
                        p = [];
                    }
                    function m() {
                        if (!c.isEnvironment(c.ENVIRONMENTS.CANVAS) || !c.getClientID() || !f) return;
                        if (Math.random() > 1 / f || d == "*" || ~ES(d, "indexOf", true, c.getClientID())) return;
                        setTimeout(g, 3e4);
                    }
                    function v(e) {
                        h = e;
                    }
                    function y(e) {
                        p.push(e);
                    }
                    var b = {
                        COLLECT_AUTOMATIC: u.AUTOMATIC,
                        COLLECT_MANUAL: u.MANUAL,
                        addStaticResource: y,
                        setCollectionMode: v,
                        _maybeSample: m
                    };
                    r.exports = b;
                }, null);
                __d("legacy:fb.canvas.prefetcher", [ "FB", "sdk.Canvas.Prefetcher", "sdk.Event", "sdk.Runtime" ], function Vt(e, t, i, n, r, a, o, s, l, c) {
                    if (t.__markCompiled) t.__markCompiled();
                    o.provide("Canvas.Prefetcher", s);
                    l.subscribe("init:post", function(e) {
                        if (c.isEnvironment(c.ENVIRONMENTS.CANVAS)) s._maybeSample();
                    });
                }, 3);
                __d("legacy:fb.canvas.presence", [ "sdk.RPC", "sdk.Event" ], function $t(e, t, i, n, r, a, o, s) {
                    if (t.__markCompiled) t.__markCompiled();
                    s.subscribe(s.SUBSCRIBE, l);
                    s.subscribe(s.UNSUBSCRIBE, c);
                    o.stub("useFriendsOnline");
                    function l(e, t) {
                        if (e != "canvas.friendsOnlineUpdated") return;
                        if (t.length === 1) o.remote.useFriendsOnline(true);
                    }
                    function c(e, t) {
                        if (e != "canvas.friendsOnlineUpdated") return;
                        if (t.length === 0) o.remote.useFriendsOnline(false);
                    }
                }, 3);
                __d("legacy:fb.event", [ "FB", "sdk.Event", "sdk.Runtime", "sdk.Scribe", "sdk.feature" ], function Yt(e, t, i, n, r, a, o, s, l, c, u) {
                    if (t.__markCompiled) t.__markCompiled();
                    var f = [], d = null, h = u("event_subscriptions_log", false);
                    o.provide("Event", {
                        subscribe: function(e, t) {
                            if (h) {
                                f.push(e);
                                if (!d) d = setTimeout(function() {
                                    c.log("jssdk_error", {
                                        appId: l.getClientID(),
                                        error: "EVENT_SUBSCRIPTIONS_LOG",
                                        extra: {
                                            line: 0,
                                            name: "EVENT_SUBSCRIPTIONS_LOG",
                                            script: "N/A",
                                            stack: "N/A",
                                            message: f.sort().join(",")
                                        }
                                    });
                                    f.length = 0;
                                    d = null;
                                }, h);
                            }
                            return s.subscribe(e, t);
                        },
                        unsubscribe: ES(s.unsubscribe, "bind", true, s)
                    });
                }, 3);
                __d("legacy:fb.frictionless", [ "FB", "sdk.Frictionless" ], function Xt(e, t, i, n, r, a, o, s) {
                    if (t.__markCompiled) t.__markCompiled();
                    o.provide("Frictionless", s);
                }, 3);
                __d("sdk.init", [ "sdk.Cookie", "sdk.ErrorHandling", "sdk.Event", "Log", "ManagedError", "sdk.PlatformVersioning", "QueryString", "sdk.Runtime", "sdk.URI", "createArrayFromMixed", "sdk.feature" ], function Jt(e, t, i, n, r, a, o, s, l, c, u, f, d, h, p, g, m) {
                    if (t.__markCompiled) t.__markCompiled();
                    function v(e) {
                        var t = typeof e == "number" && e > 0 || typeof e == "string" && /^[0-9a-f]{21,}$|^[0-9]{1,21}$/.test(e);
                        if (t) return e.toString();
                        c.warn("Invalid App Id: Must be a number or numeric string representing " + "the application id.");
                        return null;
                    }
                    function y(e) {
                        if (h.getInitialized()) c.warn("FB.init has already been called - this could indicate a problem");
                        if (h.getIsVersioned()) {
                            if (Object.prototype.toString.call(e) !== "[object Object]") throw new u("Invalid argument");
                            if (e.authResponse) c.warn("Setting authResponse is not supported");
                            if (!e.version) e.version = new p(location.href).getQueryData().sdk_version;
                            f.assertValidVersion(e.version);
                            h.setVersion(e.version);
                        } else {
                            if (/number|string/.test(typeof e)) {
                                c.warn("FB.init called with invalid parameters");
                                e = {
                                    apiKey: e
                                };
                            }
                            e = ES("Object", "assign", false, {
                                status: true
                            }, e || {});
                        }
                        var t = v(e.appId || e.apiKey);
                        if (t !== null) h.setClientID(t);
                        if ("scope" in e) h.setScope(e.scope);
                        if (e.cookie) {
                            h.setUseCookie(true);
                            if (typeof e.cookie === "string") o.setDomain(e.cookie);
                        }
                        if (e.kidDirectedSite) h.setKidDirectedSite(true);
                        h.setInitialized(true);
                        if (m("js_sdk_force_status_on_load", false)) e.status = true;
                        l.fire("init:post", e);
                    }
                    setTimeout(function() {
                        var e = /(connect\.facebook\.net|\.facebook\.com\/assets.php).*?#(.*)/;
                        ES(g(document.getElementsByTagName("script")), "forEach", true, function(t) {
                            if (t.src) {
                                var i = e.exec(t.src);
                                if (i) {
                                    var n = d.decode(i[2]);
                                    for (var r in n) if (n.hasOwnProperty(r)) {
                                        var a = n[r];
                                        if (a == "0") n[r] = 0;
                                    }
                                    y(n);
                                }
                            }
                        });
                        if (window.fbAsyncInit && !window.fbAsyncInit.hasRun) {
                            window.fbAsyncInit.hasRun = true;
                            s.unguard(window.fbAsyncInit)();
                        }
                    }, 0);
                    r.exports = y;
                }, null);
                __d("legacy:fb.init", [ "FB", "sdk.init" ], function Kt(e, t, i, n, r, a, o, s) {
                    if (t.__markCompiled) t.__markCompiled();
                    o.provide("", {
                        init: s
                    });
                }, 3);
                __d("legacy:fb.ui", [ "FB", "sdk.ui" ], function Qt(e, t, i, n, r, a, o, s) {
                    if (t.__markCompiled) t.__markCompiled();
                    o.provide("", {
                        ui: s
                    });
                }, 3);
                __d("runOnce", [], function Zt(e, t, i, n, r, a) {
                    if (t.__markCompiled) t.__markCompiled();
                    function o(e) {
                        var t, i;
                        return function() {
                            if (!t) {
                                t = true;
                                i = e();
                            }
                            return i;
                        };
                    }
                    r.exports = o;
                }, null);
                __d("XFBML", [ "Assert", "sdk.DOM", "Log", "ObservableMixin", "sdk.UA", "createArrayFromMixed", "runOnce" ], function ei(e, t, i, n, r, a, o, s, l, c, u, f, d) {
                    if (t.__markCompiled) t.__markCompiled();
                    var h = {}, p = {}, g = 0, m = new c();
                    function v(e, t) {
                        return ES(e[t] + "", "trim", true);
                    }
                    function y(e) {
                        return e.scopeName ? e.scopeName + ":" + e.nodeName : "";
                    }
                    function b(e) {
                        return h[v(e, "nodeName").toLowerCase()] || h[y(e).toLowerCase()];
                    }
                    function w(e) {
                        var t = ES(v(e, "className").split(/\s+/), "filter", true, function(e) {
                            return p.hasOwnProperty(e);
                        });
                        if (t.length === 0) return undefined;
                        if (e.getAttribute("fb-xfbml-state") || !e.childNodes || e.childNodes.length === 0 || e.childNodes.length === 1 && e.childNodes[0].nodeType === 3 || e.children.length === 1 && v(e.children[0], "className") === "fb-xfbml-parse-ignore") return p[t[0]];
                    }
                    function C(e) {
                        var t = {};
                        ES(f(e.attributes), "forEach", true, function(e) {
                            t[v(e, "name")] = v(e, "value");
                        });
                        return t;
                    }
                    function x(e, t, i) {
                        var n = document.createElement("div");
                        s.addCss(e, t + "-" + i);
                        ES(f(e.childNodes), "forEach", true, function(e) {
                            n.appendChild(e);
                        });
                        ES(f(e.attributes), "forEach", true, function(e) {
                            n.setAttribute(e.name, e.value);
                        });
                        e.parentNode.replaceChild(n, e);
                        return n;
                    }
                    function _(e, t, i) {
                        o.isTrue(e && e.nodeType && e.nodeType === 1 && !!e.getElementsByTagName, "Invalid DOM node passed to FB.XFBML.parse()");
                        o.isFunction(t, "Invalid callback passed to FB.XFBML.parse()");
                        var n = ++g;
                        l.info("XFBML Parsing Start %s", n);
                        var r = 1, a = 0, s = function() {
                            r--;
                            if (r === 0) {
                                l.info("XFBML Parsing Finish %s, %s tags found", n, a);
                                t();
                                m.inform("render", n, a);
                            }
                            o.isTrue(r >= 0, "onrender() has been called too many times");
                        };
                        ES(f(e.getElementsByTagName("*")), "forEach", true, function(e) {
                            if (!i && e.getAttribute("fb-xfbml-state")) return;
                            if (e.nodeType !== 1) return;
                            var t = b(e) || w(e);
                            if (!t) return;
                            if (u.ie() < 9 && e.scopeName) e = x(e, t.xmlns, t.localName);
                            r++;
                            a++;
                            var n = new t.ctor(e, t.xmlns, t.localName, C(e));
                            n.subscribe("render", d(function() {
                                e.setAttribute("fb-xfbml-state", "rendered");
                                s();
                            }));
                            var o = function() {
                                if (e.getAttribute("fb-xfbml-state") == "parsed") {
                                    m.subscribe("render.queue", o);
                                } else {
                                    e.setAttribute("fb-xfbml-state", "parsed");
                                    n.process();
                                }
                            };
                            o();
                        });
                        m.inform("parse", n, a);
                        var c = 3e4;
                        setTimeout(function() {
                            if (r > 0) l.warn("%s tags failed to render in %s ms", r, c);
                        }, c);
                        s();
                    }
                    m.subscribe("render", function() {
                        var e = m.getSubscribers("render.queue");
                        m.clearSubscribers("render.queue");
                        ES(e, "forEach", true, function(e) {
                            e();
                        });
                    });
                    ES("Object", "assign", false, m, {
                        registerTag: function(e) {
                            var t = e.xmlns + ":" + e.localName;
                            o.isUndefined(h[t], t + " already registered");
                            h[t] = e;
                            p[e.xmlns + "-" + e.localName] = e;
                        },
                        parse: function(e, t) {
                            _(e || document.body, t || function() {}, true);
                        },
                        parseNew: function() {
                            _(document.body, function() {}, false);
                        }
                    });
                    r.exports = m;
                }, null);
                __d("PluginPipe", [ "sdk.Content", "sdk.feature", "guid", "insertIframe", "Miny", "ObservableMixin", "JSSDKPluginPipeConfig", "sdk.Runtime", "sdk.UA", "UrlMap", "XFBML" ], function ti(e, t, i, n, r, a, o, s, l, c, u, f, d, h, p, g, m) {
                    if (t.__markCompiled) t.__markCompiled();
                    var v = new f(), y = d.threshold, b = [];
                    function w() {
                        return !!(s("plugin_pipe", false) && h.getSecure() !== undefined && (p.chrome() || p.firefox()) && d.enabledApps[h.getClientID()]);
                    }
                    function C() {
                        var e = b;
                        b = [];
                        if (e.length <= y) {
                            ES(e, "forEach", true, function(e) {
                                c(e.config);
                            });
                            return;
                        }
                        var t = e.length + 1;
                        function i() {
                            t--;
                            if (t === 0) x(e);
                        }
                        ES(e, "forEach", true, function(e) {
                            var t = {};
                            for (var n in e.config) t[n] = e.config[n];
                            t.url = g.resolve("www", h.getSecure()) + "/plugins/plugin_pipe_shell.php";
                            t.onload = i;
                            c(t);
                        });
                        i();
                    }
                    m.subscribe("parse", C);
                    function x(e) {
                        var t = document.createElement("span");
                        o.appendHidden(t);
                        var i = {};
                        ES(e, "forEach", true, function(e) {
                            i[e.config.name] = {
                                plugin: e.tag,
                                params: e.params
                            };
                        });
                        var n = ES("JSON", "stringify", false, i), r = u.encode(n);
                        ES(e, "forEach", true, function(e) {
                            var t = document.getElementsByName(e.config.name)[0];
                            t.onload = e.config.onload;
                        });
                        var a = g.resolve("www", h.getSecure()) + "/plugins/pipe.php", s = l();
                        c({
                            url: "about:blank",
                            root: t,
                            name: s,
                            className: "fb_hidden fb_invisible",
                            onload: function() {
                                o.submitToTarget({
                                    url: a,
                                    target: s,
                                    params: {
                                        plugins: r.length < n.length ? r : n
                                    }
                                });
                            }
                        });
                    }
                    ES("Object", "assign", false, v, {
                        add: function(e) {
                            var t = w();
                            t && b.push({
                                config: e._config,
                                tag: e._tag,
                                params: e._params
                            });
                            return t;
                        }
                    });
                    r.exports = v;
                }, null);
                __d("IframePlugin", [ "sdk.Auth", "sdk.DOM", "sdk.Event", "Log", "ObservableMixin", "sdk.PlatformVersioning", "PluginPipe", "QueryString", "sdk.Runtime", "Type", "sdk.UA", "sdk.URI", "UrlMap", "sdk.XD", "sdk.createIframe", "sdk.feature", "guid", "resolveURI" ], function ii(e, t, i, n, r, a, o, s, l, c, u, f, d, h, p, g, m, v, y, b, w, C, x, _) {
                    if (t.__markCompiled) t.__markCompiled();
                    var S = {
                        skin: "string",
                        font: "string",
                        width: "px",
                        height: "px",
                        ref: "string",
                        color_scheme: "string"
                    };
                    function k(e, t, i) {
                        if (t || t === 0) if (t === "100%") {
                            e.style.width = "100%";
                        } else e.style.width = t + "px";
                        if (i || i === 0) e.style.height = i + "px";
                    }
                    function A(e) {
                        return function(t) {
                            var i = {
                                width: t.width,
                                height: t.height,
                                pluginID: e
                            };
                            l.fire("xfbml.resize", i);
                        };
                    }
                    var E = {
                        string: function(e) {
                            return e;
                        },
                        bool: function(e) {
                            return e ? /^(?:true|1|yes|on)$/i.test(e) : undefined;
                        },
                        url: function(e) {
                            return _(e);
                        },
                        url_maybe: function(e) {
                            return e ? _(e) : e;
                        },
                        hostname: function(e) {
                            return e || window.location.hostname;
                        },
                        px: function(e) {
                            return /^(\d+)(?:px)?$/.test(e) ? parseInt(RegExp.$1, 10) : undefined;
                        },
                        text: function(e) {
                            return e;
                        }
                    };
                    function T(e, t) {
                        var i = e[t] || e[t.replace(/_/g, "-")] || e[t.replace(/_/g, "")] || e["data-" + t] || e["data-" + t.replace(/_/g, "-")] || e["data-" + t.replace(/_/g, "")] || undefined;
                        return i;
                    }
                    function P(e, t, i, n) {
                        ES(ES("Object", "keys", false, e), "forEach", true, function(r) {
                            if (e[r] == "text" && !i[r]) {
                                i[r] = t.textContent || t.innerText || "";
                                t.setAttribute(r, i[r]);
                            }
                            n[r] = E[e[r]](T(i, r));
                        });
                    }
                    function I(e) {
                        if (e === "100%") return "100%";
                        return e || e === "0" || e === 0 ? parseInt(e, 10) : undefined;
                    }
                    function O(e) {
                        if (e) k(e, 0, 0);
                    }
                    var D = g.extend({
                        constructor: function(e, t, i, n) {
                            this.parent();
                            i = i.replace(/-/g, "_");
                            var r = T(n, "plugin_id");
                            this.subscribe("xd.resize", A(r));
                            this.subscribe("xd.resize.flow", A(r));
                            this.subscribe("xd.resize.flow", ES(function(e) {
                                ES("Object", "assign", false, this._iframeOptions.root.style, {
                                    verticalAlign: "bottom",
                                    overflow: ""
                                });
                                k(this._iframeOptions.root, I(e.width), I(e.height));
                                this.updateLift();
                                clearTimeout(this._timeoutID);
                            }, "bind", true, this));
                            this.subscribe("xd.resize", ES(function(e) {
                                ES("Object", "assign", false, this._iframeOptions.root.style, {
                                    verticalAlign: "bottom",
                                    overflow: ""
                                });
                                k(this._iframeOptions.root, I(e.width), I(e.height));
                                k(this._iframe, I(e.width), I(e.height));
                                this._isIframeResized = true;
                                this.updateLift();
                                clearTimeout(this._timeoutID);
                            }, "bind", true, this));
                            this.subscribe("xd.resize.iframe", ES(function(e) {
                                if (e.reposition === "true" && C("reposition_iframe", false)) this.reposition(I(e.width));
                                k(this._iframe, I(e.width), I(e.height));
                                this._isIframeResized = true;
                                this.updateLift();
                                clearTimeout(this._timeoutID);
                            }, "bind", true, this));
                            this.subscribe("xd.sdk_event", function(t) {
                                var i = ES("JSON", "parse", false, t.data);
                                i.pluginID = r;
                                l.fire(t.event, i, e);
                            });
                            var a = p.getSecure() || window.location.protocol == "https:", c = y.resolve("www", a) + "/plugins/" + i + ".php?", u = {};
                            P(this.getParams(), e, n, u);
                            P(S, e, n, u);
                            ES("Object", "assign", false, u, {
                                app_id: p.getClientID(),
                                locale: p.getLocale(),
                                sdk: "joey",
                                kid_directed_site: p.getKidDirectedSite(),
                                channel: b.handler(ES(function(e) {
                                    return this.inform("xd." + e.type, e);
                                }, "bind", true, this), "parent.parent", true)
                            });
                            u.container_width = e.offsetWidth;
                            s.addCss(e, "fb_iframe_widget");
                            var f = x();
                            this.subscribe("xd.verify", function(e) {
                                b.sendToFacebook(f, {
                                    method: "xd/verify",
                                    params: ES("JSON", "stringify", false, e.token)
                                });
                            });
                            this.subscribe("xd.refreshLoginStatus", ES(o.getLoginStatus, "bind", true, o, ES(this.inform, "bind", true, this, "login.status"), true));
                            var d = document.createElement("span");
                            ES("Object", "assign", false, d.style, {
                                verticalAlign: "top",
                                width: "0px",
                                height: "0px",
                                overflow: "hidden"
                            });
                            this._element = e;
                            this._ns = t;
                            this._tag = i;
                            this._params = u;
                            this._config = this.getConfig();
                            this._iframeOptions = {
                                root: d,
                                url: c + h.encode(u),
                                name: f,
                                width: this._config.mobile_fullsize && m.mobile() ? void 0 : u.width || 1e3,
                                height: u.height || 1e3,
                                style: {
                                    border: "none",
                                    visibility: "hidden"
                                },
                                title: this._ns + ":" + this._tag + " Facebook Social Plugin",
                                onload: ES(function() {
                                    return this.inform("render");
                                }, "bind", true, this),
                                onerror: ES(function() {
                                    return O(this._iframe);
                                }, "bind", true, this)
                            };
                            if (this.isFluid()) {
                                s.addCss(this._element, "fb_iframe_widget_fluid_desktop");
                                if (!u.width && this._config.full_width) {
                                    this._element.style.width = "100%";
                                    this._iframeOptions.root.style.width = "100%";
                                    this._iframeOptions.style.width = "100%";
                                    this._params.container_width = this._element.offsetWidth;
                                    this._iframeOptions.url = c + h.encode(this._params);
                                }
                            }
                        },
                        process: function() {
                            if (p.getIsVersioned()) {
                                f.assertVersionIsSet();
                                var e = new v(this._iframeOptions.url);
                                this._iframeOptions.url = e.setPath("/" + p.getVersion() + e.getPath()).toString();
                            }
                            var t = ES("Object", "assign", false, {}, this._params);
                            delete t.channel;
                            var i = h.encode(t);
                            if (this._element.getAttribute("fb-iframe-plugin-query") == i) {
                                c.info("Skipping render: %s:%s %s", this._ns, this._tag, i);
                                this.inform("render");
                                return;
                            }
                            this._element.setAttribute("fb-iframe-plugin-query", i);
                            this.subscribe("render", ES(function() {
                                this._iframe.style.visibility = "visible";
                                if (!this._isIframeResized) O(this._iframe);
                            }, "bind", true, this));
                            while (this._element.firstChild) this._element.removeChild(this._element.firstChild);
                            this._element.appendChild(this._iframeOptions.root);
                            var n = m.mobile() ? 120 : 45;
                            this._timeoutID = setTimeout(ES(function() {
                                O(this._iframe);
                                c.warn("%s:%s failed to resize in %ss", this._ns, this._tag, n);
                            }, "bind", true, this), n * 1e3);
                            if (!d.add(this)) this._iframe = w(this._iframeOptions);
                            if (m.mobile()) {
                                s.addCss(this._element, "fb_iframe_widget_fluid");
                                if (!this._iframeOptions.width) {
                                    ES("Object", "assign", false, this._element.style, {
                                        display: "block",
                                        width: "100%",
                                        height: "auto"
                                    });
                                    ES("Object", "assign", false, this._iframeOptions.root.style, {
                                        width: "100%",
                                        height: "auto"
                                    });
                                    var r = {
                                        height: "auto",
                                        position: "static",
                                        width: "100%"
                                    };
                                    if (m.iphone() || m.ipad()) ES("Object", "assign", false, r, {
                                        width: "220px",
                                        "min-width": "100%"
                                    });
                                    ES("Object", "assign", false, this._iframe.style, r);
                                }
                            }
                        },
                        getConfig: function() {
                            return {};
                        },
                        isFluid: function() {
                            var e = this.getConfig();
                            return e.fluid;
                        },
                        reposition: function(e) {
                            var t = s.getPosition(this._iframe).x, i = s.getViewportInfo().width, n = parseInt(s.getStyle(this._iframe, "width"), 10), r = {};
                            if (t + e > i && t > e) {
                                this._iframe.style.left = parseInt(s.getStyle(this._iframe, "width"), 10) - e + "px";
                                this._isRepositioned = true;
                                r.type = "reposition";
                            } else if (this._isRepositioned && n - e !== 0) {
                                this._iframe.style.left = "0px";
                                this._isRepositioned = false;
                                r.type = "restore";
                            } else return;
                            b.sendToFacebook(this._iframe.name, {
                                method: "xd/reposition",
                                params: ES("JSON", "stringify", false, r)
                            });
                        },
                        updateLift: function() {
                            var e = this._iframe.style.width === this._iframeOptions.root.style.width && this._iframe.style.height === this._iframeOptions.root.style.height;
                            s[e ? "removeCss" : "addCss"](this._iframe, "fb_iframe_widget_lift");
                        }
                    }, u);
                    D.getVal = T;
                    D.withParams = function(e, t) {
                        return D.extend({
                            getParams: function() {
                                return e;
                            },
                            getConfig: function() {
                                return t ? t : {};
                            }
                        });
                    };
                    r.exports = D;
                }, null);
                __d("PluginConfig", [ "sdk.feature" ], function ni(e, t, i, n, r, a, o) {
                    if (t.__markCompiled) t.__markCompiled();
                    var s = {
                        messengerpreconfirmation: {
                            mobile_fullsize: true
                        },
                        messengeraccountconfirmation: {
                            mobile_fullsize: true
                        },
                        messengerbusinesslink: {
                            mobile_fullsize: true
                        },
                        messengertoggle: {
                            mobile_fullsize: true
                        },
                        messengermessageus: {
                            mobile_fullsize: true
                        },
                        post: {
                            fluid: o("fluid_embed", false),
                            mobile_fullsize: true
                        }
                    };
                    r.exports = s;
                }, null);
                __d("PluginTags", [], function ri(e, t, i, n, r, a) {
                    if (t.__markCompiled) t.__markCompiled();
                    var o = {
                        composer: {
                            action_type: "string",
                            action_properties: "string"
                        },
                        create_event_button: {},
                        follow: {
                            href: "url",
                            layout: "string",
                            show_faces: "bool"
                        },
                        like: {
                            href: "url",
                            layout: "string",
                            show_faces: "bool",
                            share: "bool",
                            action: "string",
                            send: "bool"
                        },
                        like_box: {
                            href: "string",
                            show_faces: "bool",
                            header: "bool",
                            stream: "bool",
                            force_wall: "bool",
                            show_border: "bool",
                            id: "string",
                            connections: "string",
                            profile_id: "string",
                            name: "string"
                        },
                        page: {
                            href: "string",
                            hide_cta: "bool",
                            hide_cover: "bool",
                            small_header: "bool",
                            adapt_container_width: "bool",
                            show_facepile: "bool",
                            show_posts: "bool",
                            tabs: "string"
                        },
                        messengerpreconfirmation: {
                            messenger_app_id: "string"
                        },
                        messengeraccountconfirmation: {
                            messenger_app_id: "string",
                            state: "string"
                        },
                        messengerbusinesslink: {
                            messenger_app_id: "string",
                            state: "string"
                        },
                        messengertoggle: {
                            messenger_app_id: "string",
                            token: "string"
                        },
                        messengermessageus: {
                            messenger_app_id: "string",
                            color: "string",
                            size: "string"
                        },
                        page_events: {
                            href: "url"
                        },
                        post: {
                            href: "url",
                            show_border: "bool"
                        },
                        profile_pic: {
                            uid: "string",
                            linked: "bool",
                            href: "string",
                            size: "string",
                            facebook_logo: "bool"
                        },
                        send: {
                            href: "url"
                        },
                        send_to_mobile: {
                            max_rows: "string",
                            show_faces: "bool",
                            size: "string"
                        },
                        story: {
                            href: "url",
                            show_border: "bool"
                        }
                    }, s = {
                        subscribe: "follow",
                        fan: "like_box",
                        likebox: "like_box"
                    };
                    ES(ES("Object", "keys", false, s), "forEach", true, function(e) {
                        o[e] = o[s[e]];
                    });
                    r.exports = o;
                }, null);
                __d("sdk.Arbiter", [], function ai(e, t, i, n, r, a) {
                    if (t.__markCompiled) t.__markCompiled();
                    var o = {
                        BEHAVIOR_EVENT: "e",
                        BEHAVIOR_PERSISTENT: "p",
                        BEHAVIOR_STATE: "s"
                    };
                    r.exports = o;
                }, null);
                __d("sdk.XFBML.Element", [ "sdk.DOM", "Type", "ObservableMixin" ], function oi(e, t, i, n, r, a, o, s, l) {
                    if (t.__markCompiled) t.__markCompiled();
                    var c = s.extend({
                        constructor: function(e) {
                            this.parent();
                            this.dom = e;
                        },
                        fire: function() {
                            this.inform.apply(this, arguments);
                        },
                        getAttribute: function(e, t, i) {
                            var n = o.getAttr(this.dom, e);
                            return n ? i ? i(n) : n : t;
                        },
                        _getBoolAttribute: function(e, t) {
                            var i = o.getBoolAttr(this.dom, e);
                            return i === null ? t : i;
                        },
                        _getPxAttribute: function(e, t) {
                            return this.getAttribute(e, t, function(e) {
                                var i = parseInt(e, 10);
                                return isNaN(i) ? t : i;
                            });
                        },
                        _getLengthAttribute: function(e, t) {
                            return this.getAttribute(e, t, function(e) {
                                if (e === "100%") return e;
                                var i = parseInt(e, 10);
                                return isNaN(i) ? t : i;
                            });
                        },
                        _getAttributeFromList: function(e, t, i) {
                            return this.getAttribute(e, t, function(e) {
                                e = e.toLowerCase();
                                return ES(i, "indexOf", true, e) > -1 ? e : t;
                            });
                        },
                        isValid: function() {
                            for (var e = this.dom; e; e = e.parentNode) if (e == document.body) return true;
                        },
                        clear: function() {
                            o.html(this.dom, "");
                        }
                    }, l);
                    r.exports = c;
                }, null);
                __d("sdk.XFBML.IframeWidget", [ "sdk.Arbiter", "sdk.Auth", "sdk.Content", "sdk.DOM", "sdk.Event", "sdk.XFBML.Element", "guid", "insertIframe", "QueryString", "sdk.Runtime", "sdk.ui", "UrlMap", "sdk.XD" ], function si(e, t, i, n, r, a, o, s, l, c, u, f, d, h, p, g, m, v, y) {
                    if (t.__markCompiled) t.__markCompiled();
                    var b = f.extend({
                        _iframeName: null,
                        _showLoader: true,
                        _refreshOnAuthChange: false,
                        _allowReProcess: false,
                        _fetchPreCachedLoader: false,
                        _visibleAfter: "load",
                        _widgetPipeEnabled: false,
                        _borderReset: false,
                        _repositioned: false,
                        getUrlBits: function() {
                            throw new Error("Inheriting class needs to implement getUrlBits().");
                        },
                        setupAndValidate: function() {
                            return true;
                        },
                        oneTimeSetup: function() {},
                        getSize: function() {},
                        getIframeName: function() {
                            return this._iframeName;
                        },
                        getIframeTitle: function() {
                            return "Facebook Social Plugin";
                        },
                        getChannelUrl: function() {
                            if (!this._channelUrl) {
                                var e = this;
                                this._channelUrl = y.handler(function(t) {
                                    e.fire("xd." + t.type, t);
                                }, "parent.parent", true);
                            }
                            return this._channelUrl;
                        },
                        getIframeNode: function() {
                            return this.dom.getElementsByTagName("iframe")[0];
                        },
                        arbiterInform: function(e, t, i) {
                            y.sendToFacebook(this.getIframeName(), {
                                method: e,
                                params: ES("JSON", "stringify", false, t || {}),
                                behavior: i || o.BEHAVIOR_PERSISTENT
                            });
                        },
                        _arbiterInform: function(e, t, i) {
                            var n = 'parent.frames["' + this.getIframeNode().name + '"]';
                            y.inform(e, t, n, i);
                        },
                        getDefaultWebDomain: function() {
                            return v.resolve("www");
                        },
                        process: function(e) {
                            if (this._done) {
                                if (!this._allowReProcess && !e) return;
                                this.clear();
                            } else this._oneTimeSetup();
                            this._done = true;
                            this._iframeName = this.getIframeName() || this._iframeName || d();
                            if (!this.setupAndValidate()) {
                                this.fire("render");
                                return;
                            }
                            if (this._showLoader) this._addLoader();
                            c.addCss(this.dom, "fb_iframe_widget");
                            if (this._visibleAfter != "immediate") {
                                c.addCss(this.dom, "fb_hide_iframes");
                            } else this.subscribe("iframe.onload", ES(this.fire, "bind", true, this, "render"));
                            var t = this.getSize() || {}, i = this.getFullyQualifiedURL();
                            if (t.width == "100%") c.addCss(this.dom, "fb_iframe_widget_fluid");
                            this.clear();
                            h({
                                url: i,
                                root: this.dom.appendChild(document.createElement("span")),
                                name: this._iframeName,
                                title: this.getIframeTitle(),
                                className: g.getRtl() ? "fb_rtl" : "fb_ltr",
                                height: t.height,
                                width: t.width,
                                onload: ES(this.fire, "bind", true, this, "iframe.onload")
                            });
                            this._resizeFlow(t);
                            this.loaded = false;
                            this.subscribe("iframe.onload", ES(function() {
                                this.loaded = true;
                                if (!this._isResizeHandled) c.addCss(this.dom, "fb_hide_iframes");
                            }, "bind", true, this));
                        },
                        generateWidgetPipeIframeName: function() {
                            w++;
                            return "fb_iframe_" + w;
                        },
                        getFullyQualifiedURL: function() {
                            var e = this._getURL();
                            e += "?" + p.encode(this._getQS());
                            if (e.length > 2e3) {
                                e = "about:blank";
                                var t = ES(function() {
                                    this._postRequest();
                                    this.unsubscribe("iframe.onload", t);
                                }, "bind", true, this);
                                this.subscribe("iframe.onload", t);
                            }
                            return e;
                        },
                        _getWidgetPipeShell: function() {
                            return v.resolve("www") + "/common/widget_pipe_shell.php";
                        },
                        _oneTimeSetup: function() {
                            this.subscribe("xd.resize", ES(this._handleResizeMsg, "bind", true, this));
                            this.subscribe("xd.resize", ES(this._bubbleResizeEvent, "bind", true, this));
                            this.subscribe("xd.resize.iframe", ES(this._resizeIframe, "bind", true, this));
                            this.subscribe("xd.resize.flow", ES(this._resizeFlow, "bind", true, this));
                            this.subscribe("xd.resize.flow", ES(this._bubbleResizeEvent, "bind", true, this));
                            this.subscribe("xd.refreshLoginStatus", function() {
                                s.getLoginStatus(function() {}, true);
                            });
                            this.subscribe("xd.logout", function() {
                                m({
                                    method: "auth.logout",
                                    display: "hidden"
                                }, function() {});
                            });
                            if (this._refreshOnAuthChange) this._setupAuthRefresh();
                            if (this._visibleAfter == "load") this.subscribe("iframe.onload", ES(this._makeVisible, "bind", true, this));
                            this.subscribe("xd.verify", ES(function(e) {
                                this.arbiterInform("xd/verify", e.token);
                            }, "bind", true, this));
                            this.oneTimeSetup();
                        },
                        _makeVisible: function() {
                            this._removeLoader();
                            c.removeCss(this.dom, "fb_hide_iframes");
                            this.fire("render");
                        },
                        _setupAuthRefresh: function() {
                            s.getLoginStatus(ES(function(e) {
                                var t = e.status;
                                u.subscribe("auth.statusChange", ES(function(e) {
                                    if (!this.isValid()) return;
                                    if (t == "unknown" || e.status == "unknown") this.process(true);
                                    t = e.status;
                                }, "bind", true, this));
                            }, "bind", true, this));
                        },
                        _handleResizeMsg: function(e) {
                            if (!this.isValid()) return;
                            this._resizeIframe(e);
                            this._resizeFlow(e);
                            if (!this._borderReset) {
                                this.getIframeNode().style.border = "none";
                                this._borderReset = true;
                            }
                            this._isResizeHandled = true;
                            this._makeVisible();
                        },
                        _bubbleResizeEvent: function(e) {
                            var t = {
                                height: e.height,
                                width: e.width,
                                pluginID: this.getAttribute("plugin-id")
                            };
                            u.fire("xfbml.resize", t);
                        },
                        _resizeIframe: function(e) {
                            var t = this.getIframeNode();
                            if (e.reposition === "true") this._repositionIframe(e);
                            e.height && (t.style.height = e.height + "px");
                            e.width && (t.style.width = e.width + "px");
                            this._updateIframeZIndex();
                        },
                        _resizeFlow: function(e) {
                            var t = this.dom.getElementsByTagName("span")[0];
                            e.height && (t.style.height = e.height + "px");
                            e.width && (t.style.width = e.width + "px");
                            this._updateIframeZIndex();
                        },
                        _updateIframeZIndex: function() {
                            var e = this.dom.getElementsByTagName("span")[0], t = this.getIframeNode(), i = t.style.height === e.style.height && t.style.width === e.style.width, n = i ? "removeCss" : "addCss";
                            c[n](t, "fb_iframe_widget_lift");
                        },
                        _repositionIframe: function(e) {
                            var t = this.getIframeNode(), i = parseInt(c.getStyle(t, "width"), 10), n = c.getPosition(t).x, r = c.getViewportInfo().width, a = parseInt(e.width, 10);
                            if (n + a > r && n > a) {
                                t.style.left = i - a + "px";
                                this.arbiterInform("xd/reposition", {
                                    type: "horizontal"
                                });
                                this._repositioned = true;
                            } else if (this._repositioned) {
                                t.style.left = "0px";
                                this.arbiterInform("xd/reposition", {
                                    type: "restore"
                                });
                                this._repositioned = false;
                            }
                        },
                        _addLoader: function() {
                            if (!this._loaderDiv) {
                                c.addCss(this.dom, "fb_iframe_widget_loader");
                                this._loaderDiv = document.createElement("div");
                                this._loaderDiv.className = "FB_Loader";
                                this.dom.appendChild(this._loaderDiv);
                            }
                        },
                        _removeLoader: function() {
                            if (this._loaderDiv) {
                                c.removeCss(this.dom, "fb_iframe_widget_loader");
                                if (this._loaderDiv.parentNode) this._loaderDiv.parentNode.removeChild(this._loaderDiv);
                                this._loaderDiv = null;
                            }
                        },
                        _getQS: function() {
                            return ES("Object", "assign", false, {
                                api_key: g.getClientID(),
                                locale: g.getLocale(),
                                sdk: "joey",
                                kid_directed_site: g.getKidDirectedSite(),
                                ref: this.getAttribute("ref")
                            }, this.getUrlBits().params);
                        },
                        _getURL: function() {
                            var e = this.getDefaultWebDomain(), t = "";
                            return e + "/plugins/" + t + this.getUrlBits().name + ".php";
                        },
                        _postRequest: function() {
                            l.submitToTarget({
                                url: this._getURL(),
                                target: this.getIframeNode().name,
                                params: this._getQS()
                            });
                        }
                    }), w = 0, C = {};
                    function x() {
                        var e = {};
                        for (var t in C) {
                            var i = C[t];
                            e[t] = {
                                widget: i.getUrlBits().name,
                                params: i._getQS()
                            };
                        }
                        return e;
                    }
                    r.exports = b;
                }, null);
                __d("sdk.XFBML.Comments", [ "sdk.Event", "sdk.XFBML.IframeWidget", "QueryString", "sdk.Runtime", "JSSDKConfig", "sdk.UA", "UrlMap", "sdk.feature" ], function li(e, t, i, n, r, a, o, s, l, c, u, f, d, h) {
                    if (t.__markCompiled) t.__markCompiled();
                    var p = s.extend({
                        _visibleAfter: "immediate",
                        _refreshOnAuthChange: true,
                        setupAndValidate: function() {
                            var e = {
                                channel_url: this.getChannelUrl(),
                                colorscheme: this.getAttribute("colorscheme"),
                                skin: this.getAttribute("skin"),
                                numposts: this.getAttribute("num-posts", 10),
                                width: this._getLengthAttribute("width"),
                                href: this.getAttribute("href"),
                                permalink: this.getAttribute("permalink"),
                                publish_feed: this.getAttribute("publish_feed"),
                                order_by: this.getAttribute("order_by"),
                                mobile: this._getBoolAttribute("mobile"),
                                version: this.getAttribute("version")
                            };
                            if (!e.width && !e.permalink) e.width = 550;
                            if (u.initSitevars.enableMobileComments && f.mobile() && e.mobile !== false) {
                                e.mobile = true;
                                delete e.width;
                            }
                            if (!e.skin) e.skin = e.colorscheme;
                            if (!e.href) {
                                e.migrated = this.getAttribute("migrated");
                                e.xid = this.getAttribute("xid");
                                e.title = this.getAttribute("title", document.title);
                                e.url = this.getAttribute("url", document.URL);
                                e.quiet = this.getAttribute("quiet");
                                e.reverse = this.getAttribute("reverse");
                                e.simple = this.getAttribute("simple");
                                e.css = this.getAttribute("css");
                                e.notify = this.getAttribute("notify");
                                if (!e.xid) {
                                    var t = ES(document.URL, "indexOf", true, "#");
                                    if (t > 0) {
                                        e.xid = encodeURIComponent(document.URL.substring(0, t));
                                    } else e.xid = encodeURIComponent(document.URL);
                                }
                                if (e.migrated) e.href = d.resolve("www") + "/plugins/comments_v1.php?" + "app_id=" + c.getClientID() + "&xid=" + encodeURIComponent(e.xid) + "&url=" + encodeURIComponent(e.url);
                            } else {
                                var i = this.getAttribute("fb_comment_id");
                                if (!i) {
                                    i = l.decode(document.URL.substring(ES(document.URL, "indexOf", true, "?") + 1)).fb_comment_id;
                                    if (i && ES(i, "indexOf", true, "#") > 0) i = i.substring(0, ES(i, "indexOf", true, "#"));
                                }
                                if (i) {
                                    e.fb_comment_id = i;
                                    this.subscribe("render", ES(function() {
                                        if (!window.location.hash) window.location.hash = this.getIframeNode().id;
                                    }, "bind", true, this));
                                }
                            }
                            if (!e.version) e.version = c.getVersion();
                            this._attr = e;
                            return true;
                        },
                        oneTimeSetup: function() {
                            this.subscribe("xd.commentCreated", ES(this._handleCommentCreatedMsg, "bind", true, this));
                            this.subscribe("xd.commentRemoved", ES(this._handleCommentRemovedMsg, "bind", true, this));
                        },
                        getSize: function() {
                            if (!this._attr.permalink) return {
                                width: this._attr.mobile ? "100%" : this._attr.width,
                                height: 100
                            };
                        },
                        getUrlBits: function() {
                            return {
                                name: "comments",
                                params: this._attr
                            };
                        },
                        getDefaultWebDomain: function() {
                            if (this._attr.mobile && !h("one_comment_controller", false) && this._attr.version !== "v2.3") return d.resolve("m", true);
                            return d.resolve("www", true);
                        },
                        _handleCommentCreatedMsg: function(e) {
                            if (!this.isValid()) return;
                            var t = {
                                href: e.href,
                                commentID: e.commentID,
                                parentCommentID: e.parentCommentID,
                                message: e.message
                            };
                            o.fire("comment.create", t);
                        },
                        _handleCommentRemovedMsg: function(e) {
                            if (!this.isValid()) return;
                            var t = {
                                href: e.href,
                                commentID: e.commentID
                            };
                            o.fire("comment.remove", t);
                        }
                    });
                    r.exports = p;
                }, null);
                __d("sdk.XFBML.CommentsCount", [ "ApiClient", "sdk.DOM", "sdk.XFBML.Element", "sprintf" ], function ci(e, t, i, n, r, a, o, s, l, c) {
                    if (t.__markCompiled) t.__markCompiled();
                    var u = l.extend({
                        process: function() {
                            s.addCss(this.dom, "fb_comments_count_zero");
                            var e = this.getAttribute("href", window.location.href);
                            o.scheduleBatchCall("/v2.1/" + encodeURIComponent(e), {
                                fields: "share"
                            }, ES(function(e) {
                                var t = e.share && e.share.comment_count || 0;
                                s.html(this.dom, c('<span class="fb_comments_count">%s</span>', t));
                                if (t > 0) s.removeCss(this.dom, "fb_comments_count_zero");
                                this.fire("render");
                            }, "bind", true, this));
                        }
                    });
                    r.exports = u;
                }, null);
                __d("safeEval", [], function ui(e, t, i, n, r, a) {
                    if (t.__markCompiled) t.__markCompiled();
                    function o(e, t) {
                        if (e === null || typeof e === "undefined") return;
                        if (typeof e !== "string") return e;
                        if (/^\w+$/.test(e) && typeof window[e] === "function") return window[e].apply(null, t || []);
                        return Function('return eval("' + e.replace(/"/g, '\\"') + '");').apply(null, t || []);
                    }
                    r.exports = o;
                }, null);
                __d("sdk.Helper", [ "sdk.ErrorHandling", "sdk.Event", "UrlMap", "safeEval", "sprintf" ], function fi(e, t, i, n, r, a, o, s, l, c, u) {
                    if (t.__markCompiled) t.__markCompiled();
                    var f = {
                        isUser: function(e) {
                            return e < 22e8 || e >= 1e14 && e <= 0x5b0a58f100ef || e >= 89e12 && e <= 89999999999999 || e >= 6000001e7 && e <= 60000019999999;
                        },
                        upperCaseFirstChar: function(e) {
                            if (e.length > 0) {
                                return e.substr(0, 1).toUpperCase() + e.substr(1);
                            } else return e;
                        },
                        getProfileLink: function(e, t, i) {
                            if (!i && e) i = u("%s/profile.php?id=%s", l.resolve("www"), e.uid || e.id);
                            if (i) t = u('<a class="fb_link" href="%s">%s</a>', i, t);
                            return t;
                        },
                        invokeHandler: function(e, t, i) {
                            if (e) if (typeof e === "string") {
                                o.unguard(c)(e, i);
                            } else if (e.apply) o.unguard(e).apply(t, i || []);
                        },
                        fireEvent: function(e, t) {
                            var i = t._attr.href;
                            t.fire(e, i);
                            s.fire(e, i, t);
                        },
                        executeFunctionByName: function(e) {
                            var t = Array.prototype.slice.call(arguments, 1), i = e.split("."), n = i.pop(), r = window;
                            for (var a = 0; a < i.length; a++) r = r[i[a]];
                            return r[n].apply(this, t);
                        }
                    };
                    r.exports = f;
                }, null);
                __d("sdk.XFBML.LoginButton", [ "sdk.Helper", "IframePlugin", "sdk.ui" ], function di(e, t, i, n, r, a, o, s, l) {
                    if (t.__markCompiled) t.__markCompiled();
                    var c = s.extend({
                        constructor: function(e, t, i, n) {
                            this.parent(e, t, i, n);
                            var r = s.getVal(n, "on_login");
                            if (r) this.subscribe("login.status", function(e) {
                                o.invokeHandler(r, null, [ e ]);
                            });
                            this.subscribe("xd.login_button_native_open", function(e) {
                                l(ES("JSON", "parse", false, e.params));
                            });
                        },
                        getParams: function() {
                            return {
                                scope: "string",
                                perms: "string",
                                size: "string",
                                login_text: "text",
                                show_faces: "bool",
                                max_rows: "string",
                                show_login_face: "bool",
                                registration_url: "url_maybe",
                                auto_logout_link: "bool",
                                one_click: "bool",
                                show_banner: "bool",
                                auth_type: "string",
                                default_audience: "string"
                            };
                        }
                    });
                    r.exports = c;
                }, null);
                __d("escapeHTML", [], function hi(e, t, i, n, r, a) {
                    if (t.__markCompiled) t.__markCompiled();
                    var o = /[&<>"'\/]/g, s = {
                        "&": "&amp;",
                        "<": "&lt;",
                        ">": "&gt;",
                        '"': "&quot;",
                        "'": "&#039;",
                        "/": "&#x2F;"
                    };
                    function l(e) {
                        return e.replace(o, function(e) {
                            return s[e];
                        });
                    }
                    r.exports = l;
                }, null);
                __d("sdk.XFBML.Name", [ "ApiClient", "escapeHTML", "sdk.Event", "sdk.XFBML.Element", "sdk.Helper", "Log", "sdk.Runtime" ], function pi(e, t, i, n, r, a, o, s, l, c, u, f, d) {
                    if (t.__markCompiled) t.__markCompiled();
                    var h = {}.hasOwnProperty, p = c.extend({
                        process: function() {
                            ES("Object", "assign", false, this, {
                                _uid: this.getAttribute("uid"),
                                _firstnameonly: this._getBoolAttribute("first-name-only"),
                                _lastnameonly: this._getBoolAttribute("last-name-only"),
                                _possessive: this._getBoolAttribute("possessive"),
                                _reflexive: this._getBoolAttribute("reflexive"),
                                _objective: this._getBoolAttribute("objective"),
                                _linked: this._getBoolAttribute("linked", true),
                                _subjectId: this.getAttribute("subject-id")
                            });
                            if (!this._uid) {
                                f.error('"uid" is a required attribute for <fb:name>');
                                this.fire("render");
                                return;
                            }
                            var e = [];
                            if (this._firstnameonly) {
                                e.push("first_name");
                            } else if (this._lastnameonly) {
                                e.push("last_name");
                            } else e.push("name");
                            if (this._subjectId) {
                                e.push("gender");
                                if (this._subjectId == d.getUserID()) this._reflexive = true;
                            }
                            l.monitor("auth.statusChange", ES(function() {
                                if (!this.isValid()) {
                                    this.fire("render");
                                    return true;
                                }
                                if (!this._uid || this._uid == "loggedinuser") this._uid = d.getUserID();
                                if (!this._uid) return;
                                o.scheduleBatchCall("/v1.0/" + this._uid, {
                                    fields: e.join(",")
                                }, ES(function(e) {
                                    if (h.call(e, "error")) {
                                        f.warn("The name is not found for ID: " + this._uid);
                                        return;
                                    }
                                    if (this._subjectId == this._uid) {
                                        this._renderPronoun(e);
                                    } else this._renderOther(e);
                                    this.fire("render");
                                }, "bind", true, this));
                            }, "bind", true, this));
                        },
                        _renderPronoun: function(e) {
                            var t = "", i = this._objective;
                            if (this._subjectId) {
                                i = true;
                                if (this._subjectId === this._uid) this._reflexive = true;
                            }
                            if (this._uid == d.getUserID() && this._getBoolAttribute("use-you", true)) {
                                if (this._possessive) {
                                    if (this._reflexive) {
                                        t = "your own";
                                    } else t = "your";
                                } else if (this._reflexive) {
                                    t = "yourself";
                                } else t = "you";
                            } else switch (e.gender) {
                              case "male":
                                if (this._possessive) {
                                    t = this._reflexive ? "his own" : "his";
                                } else if (this._reflexive) {
                                    t = "himself";
                                } else if (i) {
                                    t = "him";
                                } else t = "he";
                                break;

                              case "female":
                                if (this._possessive) {
                                    t = this._reflexive ? "her own" : "her";
                                } else if (this._reflexive) {
                                    t = "herself";
                                } else if (i) {
                                    t = "her";
                                } else t = "she";
                                break;

                              default:
                                if (this._getBoolAttribute("use-they", true)) {
                                    if (this._possessive) {
                                        if (this._reflexive) {
                                            t = "their own";
                                        } else t = "their";
                                    } else if (this._reflexive) {
                                        t = "themselves";
                                    } else if (i) {
                                        t = "them";
                                    } else t = "they";
                                } else if (this._possessive) {
                                    if (this._reflexive) {
                                        t = "his/her own";
                                    } else t = "his/her";
                                } else if (this._reflexive) {
                                    t = "himself/herself";
                                } else if (i) {
                                    t = "him/her";
                                } else t = "he/she";
                                break;
                            }
                            if (this._getBoolAttribute("capitalize", false)) t = u.upperCaseFirstChar(t);
                            this.dom.innerHTML = t;
                        },
                        _renderOther: function(e) {
                            var t = "", i = "";
                            if (this._uid == d.getUserID() && this._getBoolAttribute("use-you", true)) {
                                if (this._reflexive) {
                                    if (this._possessive) {
                                        t = "your own";
                                    } else t = "yourself";
                                } else if (this._possessive) {
                                    t = "your";
                                } else t = "you";
                            } else if (e) {
                                if (null === e.first_name) e.first_name = "";
                                if (null === e.last_name) e.last_name = "";
                                if (this._firstnameonly && e.first_name !== undefined) {
                                    t = s(e.first_name);
                                } else if (this._lastnameonly && e.last_name !== undefined) t = s(e.last_name);
                                if (!t) t = s(e.name);
                                if (t !== "" && this._possessive) t += "'s";
                            }
                            if (!t) t = s(this.getAttribute("if-cant-see", "Facebook User"));
                            if (t) {
                                if (this._getBoolAttribute("capitalize", false)) t = u.upperCaseFirstChar(t);
                                if (e && this._linked) {
                                    i = u.getProfileLink(e, t, this.getAttribute("href", null));
                                } else i = t;
                            }
                            this.dom.innerHTML = i;
                        }
                    });
                    r.exports = p;
                }, null);
                __d("sdk.XFBML.ShareButton", [ "IframePlugin", "sdk.ui" ], function gi(e, t, i, n, r, a, o, s) {
                    if (t.__markCompiled) t.__markCompiled();
                    var l = o.extend({
                        constructor: function(e, t, i, n) {
                            this.parent(e, t, i, n);
                            this.subscribe("xd.shareTriggerIframe", function(e) {
                                var t = ES("JSON", "parse", false, e.data);
                                s({
                                    method: "share",
                                    href: t.href,
                                    iframe_test: true
                                });
                            });
                        },
                        getParams: function() {
                            return {
                                href: "url",
                                layout: "string",
                                type: "string"
                            };
                        }
                    });
                    r.exports = l;
                }, null);
                __d("sdk.XFBML.Video", [ "Assert", "sdk.Event", "IframePlugin", "ObservableMixin", "sdk.XD" ], function mi(e, t, i, n, r, a, o, s, l, c, u) {
                    if (t.__markCompiled) t.__markCompiled();
                    function f(e) {
                        this.$VideoCache1 = e.isMuted;
                        this.$VideoCache2 = e.volume;
                        this.$VideoCache3 = e.timePosition;
                        this.$VideoCache4 = e.duration;
                    }
                    f.prototype.update = function(e) {
                        if (e.isMuted !== undefined) this.$VideoCache1 = e.isMuted;
                        if (e.volume !== undefined) this.$VideoCache2 = e.volume;
                        if (e.timePosition !== undefined) this.$VideoCache3 = e.timePosition;
                        if (e.duration !== undefined) this.$VideoCache4 = e.duration;
                    };
                    f.prototype.isMuted = function() {
                        return this.$VideoCache1;
                    };
                    f.prototype.getVolume = function() {
                        return this.$VideoCache1 ? 0 : this.$VideoCache2;
                    };
                    f.prototype.getCurrentPosition = function() {
                        return this.$VideoCache3;
                    };
                    f.prototype.getDuration = function() {
                        return this.$VideoCache4;
                    };
                    function d(e, t, i) {
                        this.$VideoController1 = e;
                        this.$VideoController2 = t;
                        this.$VideoController3 = i;
                    }
                    d.prototype.play = function() {
                        u.sendToFacebook(this.$VideoController1, {
                            method: "play",
                            params: ES("JSON", "stringify", false, {})
                        });
                    };
                    d.prototype.pause = function() {
                        u.sendToFacebook(this.$VideoController1, {
                            method: "pause",
                            params: ES("JSON", "stringify", false, {})
                        });
                    };
                    d.prototype.seek = function(e) {
                        o.isNumber(e, "Invalid argument");
                        u.sendToFacebook(this.$VideoController1, {
                            method: "seek",
                            params: ES("JSON", "stringify", false, {
                                target: e
                            })
                        });
                    };
                    d.prototype.mute = function() {
                        u.sendToFacebook(this.$VideoController1, {
                            method: "mute",
                            params: ES("JSON", "stringify", false, {})
                        });
                    };
                    d.prototype.unmute = function() {
                        u.sendToFacebook(this.$VideoController1, {
                            method: "unmute",
                            params: ES("JSON", "stringify", false, {})
                        });
                    };
                    d.prototype.setVolume = function(e) {
                        o.isNumber(e, "Invalid argument");
                        u.sendToFacebook(this.$VideoController1, {
                            method: "setVolume",
                            params: ES("JSON", "stringify", false, {
                                volume: e
                            })
                        });
                    };
                    d.prototype.isMuted = function() {
                        return this.$VideoController3.isMuted();
                    };
                    d.prototype.getVolume = function() {
                        return this.$VideoController3.getVolume();
                    };
                    d.prototype.getCurrentPosition = function() {
                        return this.$VideoController3.getCurrentPosition();
                    };
                    d.prototype.getDuration = function() {
                        return this.$VideoController3.getDuration();
                    };
                    d.prototype.subscribe = function(e, t) {
                        o.isString(e, "Invalid argument");
                        o.isFunction(t, "Invalid argument");
                        this.$VideoController2.subscribe(e, t);
                        return {
                            release: ES(function() {
                                this.$VideoController2.unsubscribe(e, t);
                            }, "bind", true, this)
                        };
                    };
                    var h = l.extend({
                        constructor: function(e, t, i, n) {
                            this.parent(e, t, i, n);
                            this._videoController = null;
                            this._sharedObservable = null;
                            this._sharedVideoCache = null;
                            this.subscribe("xd.onVideoAPIReady", function(e) {
                                this._sharedObservable = new c();
                                this._sharedVideoCache = new f(ES("JSON", "parse", false, e.data));
                                this._videoController = new d(this._iframeOptions.name, this._sharedObservable, this._sharedVideoCache);
                                s.fire("xfbml.ready", {
                                    type: "video",
                                    id: n.id,
                                    instance: this._videoController
                                });
                            });
                            this.subscribe("xd.stateChange", function(e) {
                                this._sharedObservable.inform(e.state);
                            });
                            this.subscribe("xd.cachedStateUpdateRequest", function(e) {
                                this._sharedVideoCache.update(ES("JSON", "parse", false, e.data));
                            });
                        },
                        getParams: function() {
                            return {
                                allowfullscreen: "bool",
                                autoplay: "bool",
                                controls: "bool",
                                href: "url"
                            };
                        },
                        getConfig: function() {
                            return {
                                fluid: true,
                                full_width: true
                            };
                        }
                    });
                    r.exports = h;
                }, null);
                __d("legacy:fb.xfbml", [ "Assert", "sdk.Event", "FB", "IframePlugin", "PluginConfig", "PluginTags", "XFBML", "sdk.domReady", "sdk.feature", "wrapFunction", "sdk.XFBML.Comments", "sdk.XFBML.CommentsCount", "sdk.XFBML.LoginButton", "sdk.XFBML.Name", "sdk.XFBML.ShareButton", "sdk.XFBML.Video" ], function vi(e, t, i, n, r, a, o, s, l, c, u, f, d, h, p, g) {
                    if (t.__markCompiled) t.__markCompiled();
                    var m = {
                        comments: t("sdk.XFBML.Comments"),
                        comments_count: t("sdk.XFBML.CommentsCount"),
                        login_button: t("sdk.XFBML.LoginButton"),
                        name: t("sdk.XFBML.Name"),
                        share_button: t("sdk.XFBML.ShareButton"),
                        video: t("sdk.XFBML.Video")
                    }, v = p("plugin_tags_blacklist", []);
                    ES(ES("Object", "keys", false, f), "forEach", true, function(e) {
                        if (ES(v, "indexOf", true, e) !== -1) return;
                        d.registerTag({
                            xmlns: "fb",
                            localName: e.replace(/_/g, "-"),
                            ctor: c.withParams(f[e], u[e])
                        });
                    });
                    ES(ES("Object", "keys", false, m), "forEach", true, function(e) {
                        if (ES(v, "indexOf", true, e) !== -1) return;
                        d.registerTag({
                            xmlns: "fb",
                            localName: e.replace(/_/g, "-"),
                            ctor: m[e]
                        });
                    });
                    l.provide("XFBML", {
                        parse: function(e) {
                            o.maybeXfbml(e, "Invalid argument");
                            if (e && e.nodeType === 9) e = e.body;
                            return d.parse.apply(null, arguments);
                        }
                    });
                    d.subscribe("parse", ES(s.fire, "bind", true, s, "xfbml.parse"));
                    d.subscribe("render", ES(s.fire, "bind", true, s, "xfbml.render"));
                    s.subscribe("init:post", function(e) {
                        if (e.xfbml) setTimeout(g(ES(h, "bind", true, null, d.parse), "entry", "init:post:xfbml.parse"), 0);
                    });
                    o.define("Xfbml", function(e) {
                        return (e.nodeType === 1 || e.nodeType === 9) && typeof e.nodeName === "string";
                    });
                    try {
                        if (document.namespaces && !document.namespaces.item.fb) document.namespaces.add("fb");
                    } catch (y) {}
                }, 3);
                __d("legacy:fb.versioned-sdk", [ "sdk.Runtime" ], function yi(e, t, i, n, r, a, o) {
                    if (t.__markCompiled) t.__markCompiled();
                    o.setIsVersioned(true);
                }, 3);
            }
        }).call(global);
    }(window.inDapIF ? parent.window : window);
} catch (e) {
    new Image().src = "https://www.facebook.com/" + "common/scribe_endpoint.php?c=jssdk_error&m=" + encodeURIComponent('{"error":"LOAD", "extra": {"name":"' + e.name + '","line":"' + (e.lineNumber || e.line) + '","script":"' + (e.fileName || e.sourceURL || e.script) + '","stack":"' + (e.stackTrace || e.stack) + '","revision":"2063232","message":"' + e.message + '"}}');
}

define("facebook", function(e) {
    return function() {
        var t, i;
        return t || e.FB;
    };
}(this));

define("FacebookComponent/index", [ "require", "q", "facebook" ], function(e) {
    var t = e("q");
    var i = e("facebook");
    var n = {
        raw: {
            fb: {
                appId: "1391593031089139",
                version: "v2.3",
                channelURL: "//raw.pics.io",
                status: false,
                cookie: true,
                oauth: true,
                xfbml: false
            },
            link: "https://raw.pics.io"
        },
        edit: {
            fb: {
                appId: "636176809769806",
                version: "v2.3",
                channelURL: "//edit.pics.io",
                status: false,
                cookie: true,
                oauth: true,
                xfbml: false
            },
            link: "https://edit.pics.io"
        }
    };
    return {
        init: function(e) {
            this.config = n[e || "raw"] || n.raw;
            FB.init(this.config.fb);
            return t.resolve();
        },
        getLoginStatus: function() {
            var e = t.defer();
            FB.getLoginStatus(function(t) {
                if (t.status === "connected") e.resolve(t); else e.reject(t);
            });
            return e.promise;
        },
        login: function() {
            var e = t.defer();
            FB.login(function(t) {
                if (t && !t.error) e.resolve(t); else e.reject(t);
            }, {
                scope: "public_profile,email,publish_actions"
            });
            return e.promise;
        },
        postToFeed: function(e) {
            debugger;
            var i = t.defer();
            FB.api("/me/feed", "POST", {
                message: e,
                link: this.config.link
            }, function(e) {
                if (e && !e.error) i.resolve(e); else i.reject(e);
            });
            return i.promise;
        },
        checkPermissions: function() {
            var e = t.defer();
            FB.api("me/permissions", function(t) {
                if (t && !t.error && !!t.data[0].publish_actions) e.resolve(t); else e.reject(t);
            });
            return e.promise;
        },
        sharePost: function(e, t) {
            var i = this;
            return this.init(t && t.appName).then(this.getLoginStatus.bind(this)).then(this.checkPermissions.bind(this)).fail(this.login.bind(this)).then(function(n) {
                return i.postToFeed(e, t && t.appName === "edit" ? "https://edit.pics.io" : "https://raw.pics.io");
            });
        },
        shareImage: function(e, i) {
            var n = this;
            return this.init().then(this.getLoginStatus.bind(this)).then(this.checkPermissions.bind(this)).fail(this.login.bind(this)).then(function(n) {
                if (!(n && n.authResponse)) return t.reject(new Error("No FB auth response received."));
                var r = t.defer();
                var a;
                FB.api("me/", function(t) {
                    console.log("Userdata received", t);
                    a = t.id;
                    var n = new FormData();
                    n.append("access_token", FB.getAccessToken());
                    n.append("source", e);
                    n.append("message", i || "This photo was shared using https://raw.pics.io via @TopTechPhoto");
                    var o = $.ajax({
                        url: "https://graph.facebook.com/me/photos",
                        type: "POST",
                        data: n,
                        processData: false,
                        contentType: false,
                        cache: false
                    });
                    o.done(function(e) {
                        console.log("Photo uploaded: " + e.id);
                        return r.resolve(a);
                    });
                    o.error(function(e) {
                        console.log(e.name + ": " + e.message);
                        return r.reject("Cant share image");
                    });
                });
                return r.promise;
            });
        }
    };
});

define("FacebookComponent", [ "FacebookComponent/index" ], function(e) {
    return e;
});

define("PaymentComponent/views/index", [ "require", "mustache", "backbone", "stripe", "Widget", "i18n!assets/js/picsio-raw/localization/strings", "TrackingService", "environment", "utils", "LoggingService", "StorageService", "../configs/index", "../templates/view", "../templates/priceTable", "../configs/view", "../configs/priceTable", "FacebookComponent" ], function(e) {
    var t = e("mustache");
    var i = e("backbone");
    var n = e("stripe");
    var r = e("Widget");
    var a = e("i18n!assets/js/picsio-raw/localization/strings");
    var o = e("TrackingService");
    var s = e("environment");
    var Utils = e("utils");
    var l = e("LoggingService");
    var c = e("StorageService");
    var u = e("../configs/index");
    var f = e("../templates/view");
    var d = e("../templates/priceTable");
    var h = e("../configs/view");
    var p = e("../configs/priceTable");
    var g = e("FacebookComponent");
    return i.View.extend({
        formName: null,
        className: "overlayPopupWrapper paidPopup",
        events: {
            "click .btnPaypal": "openPaypal",
            "click .btnStripe": "openStripe",
            "click .btnRestorePrevPurchase": "restorePurchase",
            "click .btnBuyLater": "buyLater",
            "click .overlayPopupClose": "destroy"
        },
        initialize: function(e) {
            this.formName = "A1";
            this.render(e);
        },
        render: function(e) {
            this.$el.html(t.to_html(f, h({
                type: e.type,
                showCloseButton: e.showCloseButton
            })));
            $("body").append(this.$el);
            this.renderPriceRadioBtns();
            o.push(u.analyticsCategory, "PayFormOpen", e.type);
            o.push(u.analyticsCategory, "PayFormOpen" + this.formName, e.type);
        },
        openPaypal: function() {
            o.push(u.analyticsCategory, "WillingToPay", "PayPal");
            o.push(u.analyticsCategory, "WillingToPay" + this.formName, "PayPal");
            var e = {
                button: "buynow",
                item_name: "raw.pics.io",
                quantity: "1",
                amount: this.getPriceValue(),
                currency_code: "USD",
                shipping: "0",
                tax: "0",
                "return": "https://pics.io/payments/paypal/callback",
                rm: 2,
                cmd: "_xclick",
                business: "paypal@pics.io",
                env: "www",
                custom: "formName=" + this.formName
            };
            var t = Object.keys(e);
            var i = t.map(function(t) {
                return t + "=" + e[t];
            }).join("&");
            window.location.href = "https://www.paypal.com/cgi-bin/webscr?" + i;
        },
        openStripe: function() {
            var e = this;
            o.push(u.analyticsCategory, "WillingToPay", "CreditCard");
            o.push(u.analyticsCategory, "WillingToPay" + this.formName, "CreditCard");
            var t = StripeCheckout.configure({
                key: s.config.payments.stripe.PUBLISHABLE_KEY,
                image: s.config.payments.stripe.FORM_IMAGE,
                token: function(t) {
                    if (!t) {
                        o.push(u.analyticsCategory, "PaymentFailed", "CreditCard");
                        l.error(a.PAYMENT_FORM.ERROR_CANT_PROCEED_PAYMENT);
                        return;
                    }
                    t && c.set("stripe_token", t.id);
                    o.push(u.analyticsCategory, "ChargeTokenRecieved", "CreditCard");
                    t.amount = e.getPriceValue({
                        "int": true
                    });
                    $.post(s.config.payments.stripe.COMMIT_CHARGE_URL, t).done(function(t) {
                        c.set("paid", true, undefined, 30);
                        t && t.charge && c.set("stripe_charge", t.charge);
                        o.push(u.analyticsCategory, "PaymentComplete", "CreditCard", e.getPriceValue({
                            round: true
                        }));
                        o.push(u.analyticsCategory, "PaymentComplete" + e.formName, "CreditCard", e.getPriceValue({
                            round: true
                        }));
                        e.dialogOnSuccessStripe(t);
                        e.destroy();
                    }).fail(function(e) {
                        o.push(u.analyticsCategory, "PaymentFailed", "CreditCard");
                        var t = e.responseJSON && e.responseJSON.msg + " " || "";
                        l.error(t + a.PAYMENT_FORM.ERROR_CANT_PROCEED_PAYMENT);
                    });
                }
            });
            t.open({
                name: a.PAYMENT_FORM.PAYMENT_NAME_TPL.assign(e.getPriceValue()),
                description: a.PAYMENT_FORM.PAYMENT_DESCRIPTION,
                allowRememberMe: false,
                amount: e.getPriceValue({
                    "int": true
                }),
                panelLabel: a.PAYMENT_FORM.PAY_BUTTON_TPL
            });
            return;
        },
        buyLater: function() {
            o.push(u.analyticsCategory, "BuyLater");
            this.destroy();
        },
        dialogOnSuccessStripe: function(e) {
            var t = new r.Dialog({
                title: "Congratulation",
                onClose: function() {},
                onOk: function() {},
                onCancel: function() {},
                disableCancel: true,
                classList: [ "textPopup", "rawPurchaseComplite" ],
                items: [ {
                    item: r.Html,
                    config: {
                        html: a.PAYMENT_FORM.PAYMENT_COMPLETE_TPL.assign(e.charge, e.email)
                    }
                }, {
                    item: r.Html,
                    config: {
                        html: a.PAYMENT_FORM.TEXT_SHARE_FOR_SPREAD_WORLD,
                        styleList: {
                            "margin-top": "20px",
                            display: "block"
                        }
                    }
                } ]
            });
            t.$el.find(".btnTW").on("click", this.onTWHandler);
            t.$el.find(".btnFB").on("click", this.onFBHandler);
        },
        onTWHandler: function() {
            var e = "http://twitter.com/share?url=url=https://raw.pics.io/&text=" + a.PAYMENT_FORM.I_FOUND_PRETTY_CONVERTER;
            window.open(e, "Share on Twitter", "width=640, height=536");
        },
        onFBHandler: function() {
            var e = a.PAYMENT_FORM.I_FOUND_PRETTY_CONVERTER;
            g.sharePost(e);
        },
        restorePurchase: function() {
            this.trigger("restorePurchase");
        },
        renderPriceRadioBtns: function() {
            if (this.formName === "A1") {
                this.radioPrice = new r.InputRadio({
                    id: "inputRadioPrice",
                    name: "pay",
                    customContainer: ".tableOfPrices",
                    list: a.PAYMENT_FORM.TABLE_OF_PRICES
                });
            } else if (this.formName === "C") {
                this.$el.addClass("paymentDialogC");
                new r.Html({
                    id: "secondTable",
                    customContainer: ".tableOfPrices",
                    html: t.to_html(d, p)
                });
                this.radioPrice = new r.InputRadio({
                    id: "inputRadioPrice",
                    name: "pay",
                    customContainer: ".trChoosePeriod",
                    list: a.PAYMENT_FORM.TABLE_OF_PRICES
                });
            }
        },
        getPriceValue: function(e) {
            e = e || {};
            var t = this.radioPrice.getValue();
            if (e.int) {
                return parseInt(t.replace(".", "")) || 299;
            } else if (e.round) {
                return Math.round(parseFloat(t));
            } else {
                return t || "2.99";
            }
        },
        destroy: function() {
            this.$el.remove();
        }
    });
});

define("PaymentComponent/controllers/index", [ "require", "../views/index", "StorageService", "i18n!assets/js/picsio-raw/localization/strings", "TrackingService", "LoggingService", "environment", "../configs/index", "Widget" ], function(e) {
    var t = e("../views/index");
    var i = e("StorageService");
    var n = e("i18n!assets/js/picsio-raw/localization/strings");
    var r = e("TrackingService");
    var a = e("LoggingService");
    var o = e("environment");
    var s = e("../configs/index");
    var l = e("Widget");
    var c;
    return {
        render: function(e) {
            c = new t(e);
            c.on("restorePurchase", this.restorePurchase);
        },
        isTrial: function() {
            var e = ~~i.get("files_saved");
            return e >= 0 && e <= 5;
        },
        isPaid: function() {
            return !!i.get("paid");
        },
        restorePurchase: function() {
            var e = this.restorePurchaeDialog = new l.Dialog({
                styleList: {
                    width: "390px",
                    "margin-left": "-25px"
                },
                title: "Restore purchase",
                onClose: function() {},
                onOk: this.tryRestorePurchase.bind(this),
                onCancel: function() {},
                showCloseButton: false,
                items: [ {
                    item: l.Html,
                    config: {
                        html: n.PAYMENT_FORM.RESTORE_MESSAGE
                    }
                }, {
                    item: l.InputText,
                    config: {
                        id: "emailOrCode",
                        defaultValue: "",
                        placeholder: "",
                        styleList: {
                            display: "block",
                            "margin-top": "20px"
                        }
                    }
                } ]
            });
            e.getItem("emailOrCode").$el.find("input").focus();
        },
        tryRestorePurchase: function() {
            var e = this.restorePurchaeDialog.getItem("emailOrCode").getValue().trim();
            if (!e) {
                if (typeof e === "string") throw n.PAYMENT_FORM.ERROR_EMPTY_ORDER_NUMBER;
                return;
            }
            $.get(o.config.payments.stripe.RESTORE_PAYMENT_URL + "?order=" + e).done(function(e) {
                r.push(s.analyticsCategory, "PaymentRestoreSuccess", "coffee");
                if (e.error) {
                    r.push(s.analyticsCategory, "PaymentRestoreFailed", e.error.code || "coffee");
                    var t = n.PAYMENT_FORM.ERROR_CANT_RESTORE_PAYMENT;
                    if (e.error.code === "expired") t = n.PAYMENT_FORM.ERROR_CANT_RESTORE_PAYMENT_EXPIRED;
                    a.error(t);
                } else {
                    var o = e.expiredAt && new Date(e.expiredAt);
                    i.set("paid", true, undefined, o);
                    a.success(n.PAYMENT_FORM.PAYMENT_RESTORED);
                    r.push(s.analyticsCategory, "PaymentRestoreComplete", "coffee");
                    c && c.destroy();
                    $(".restorePreviousPurchase").hide();
                }
            }).fail(function(e) {
                var t = e && e.status;
                r.push(s.analyticsCategory, "PaymentRestoreFailed", t);
                if (t === 404) {
                    a.error(n.PAYMENT_FORM.ERROR_CANT_RESTORE_PAYMENT_SERVER_UNAVAILABLE);
                } else {
                    a.error(n.PAYMENT_FORM.ERROR_CANT_RESTORE_PAYMENT);
                }
            });
        }
    };
});

define("PaymentComponent/index", [ "require", "./controllers/index" ], function(e) {
    var t = e("./controllers/index");
    return {
        render: t.render,
        restorePurchase: t.restorePurchase.bind(t),
        isTrial: t.isTrial,
        isPaid: t.isPaid
    };
});

define("PaymentComponent", [ "PaymentComponent/index" ], function(e) {
    return e;
});

define("eConf", [], function() {
    var e = {
        toolbars: {
            left: [],
            topLeft: [ {
                type: "icon",
                action: "undo",
                tooltip: [ "Undo", "Redo" ]
            }, {
                type: "menu",
                title: "&#64257;le",
                items: [ {
                    type: "text",
                    action: "openFile"
                }, {
                    type: "text",
                    action: "saver"
                }, {
                    type: "text",
                    action: "xmp"
                }, {
                    type: "text",
                    action: "hotkeys"
                } ]
            }, {
                type: "icon",
                action: "colorGetter",
                tooltip: "Color"
            }, {
                type: "icon",
                action: "colorpicker",
                tooltip: "Color picker"
            } ],
            topRight: [ {
                id: "adjustments",
                type: "icon",
                action: "externalCaller",
                tooltip: "Adjustments",
                classList: [ "act" ],
                className: "iconEdit_adjustments",
                caller: function() {
                    e.btnAdjustmentsHandlers.toggle();
                }
            }, {
                type: "html",
                tag: "li",
                html: "",
                classList: [ "smallImgInfo" ]
            }, {
                type: "icon",
                action: "about",
                tooltip: "About Edit.pics.io"
            }, {
                type: "icon",
                action: "externalCaller",
                className: "iconEdit_exit",
                tooltip: "Close",
                caller: Function.prototype
            } ]
        },
        btnAdjustmentsHandlers: {
            show: function() {
                this.toggle(true);
            },
            hide: function() {
                this.toggle(false);
            },
            toggle: function(e) {
                var t = document.getElementById("rightSidebarEditorAdjustments"), i = document.getElementById("rightSidebarEditorPresets"), n = document.querySelector("#secondPicsioToolbar ul #adjustments"), r = document.querySelector("#secondPicsioToolbar ul #presets");
                t && (e ? t.classList.add("show") : e === false ? t.classList.remove("show") : t.classList.toggle("show"));
                e ? n.classList.add("act") : e === false ? n.classList.remove("act") : n.classList.toggle("act");
                i && i.classList.remove("show");
                r && r.classList.remove("act");
            }
        },
        btnPresetsHandlers: {
            show: function() {
                this.toggle(true);
            },
            hide: function() {
                this.toggle(false);
            },
            toggle: function(e) {
                var t = document.getElementById("rightSidebarEditorAdjustments"), i = document.getElementById("rightSidebarEditorPresets"), n = document.querySelector("#secondPicsioToolbar ul #adjustments"), r = document.querySelector("#secondPicsioToolbar ul #presets");
                i && (e ? i.classList.add("show") : e === false ? i.classList.remove("show") : i.classList.toggle("show"));
                e ? r.classList.add("act") : e === false ? r.classList.remove("act") : r.classList.toggle("act");
                t && t.classList.remove("show");
                n && n.classList.remove("act");
            }
        }
    };
    return e;
});

define("RawCounter/views/index", [ "require", "utils", "sugar" ], function(e) {
    var Utils = e("utils");
    var t = e("sugar");
    return {
        parentEl: null,
        alreadyConverted: {
            count: 25e5,
            date: "September 11th, 2015"
        },
        initialize: function(e) {
            this.parentEl = e.parentEl;
            this.parentEl.html(this.get(9));
            this.run();
        },
        run: function() {
            var e = Utils.randomIntBetween(5, 15) * 1e3;
            this.timer = setTimeout(function() {
                this.parentEl.html(this.get());
                this.run();
            }.bind(this), e);
        },
        getMinutesFromLastCalculate: function() {
            var e = 60 * 1e3;
            var t = Date.range(this.alreadyConverted.date, "now").duration() / e;
            return t;
        },
        getRandomPieces: function() {
            return Utils.randomIntBetween(5, 9);
        },
        get: function(e) {
            e = e || this.getRandomPieces();
            var t = this.alreadyConverted.count + this.getMinutesFromLastCalculate() * e;
            this.alreadyConverted.date = Date.create("now");
            this.alreadyConverted.count = t;
            return parseInt(t).format(0, " ");
        },
        destroy: function() {
            clearTimeout(this.timer);
        }
    };
});

define("RawCounter/controllers/index", [ "require", "../views/index" ], function(e) {
    var t = e("../views/index");
    var i;
    return {
        initialize: t.initialize.bind(t),
        destroy: t.destroy.bind(t)
    };
});

define("RawCounter/index", [ "require", "./controllers/index" ], function(e) {
    var t = e("./controllers/index");
    return {
        initialize: t.initialize,
        destroy: t.destroy
    };
});

define("RawCounter", [ "RawCounter/index" ], function(e) {
    return e;
});

define("SocialSharing/templates/index", [], function() {
    return [ '<dic class="socialSharing">', '<div class="btnSocialSharing iconRaw_btnFacebook" data-id="facebook" data-ga="FB"></div>', '<div class="btnSocialSharing iconRaw_btnTumblr" data-id="tumblr" data-ga="Tumblr"></div>', '<div class="btnSocialSharing iconRaw_btnGoogleplus" data-id="googleplus" data-ga="G+"></div>', '<div class="btnSocialSharing iconRaw_btnPinterest" data-id="pinterest" data-ga="Pinterest"></div>', "</div>" ].join("");
});

define("SocialSharing/configs/confirm", [ "require", "Widget" ], function(e) {
    var t = e("Widget");
    return {
        config: {
            title: "Share",
            cancelName: "No",
            okName: "Yes",
            onClose: function() {},
            onOk: function() {},
            onCancel: function() {},
            messages: {
                pinterest: "This will share your photo to Pinterest.<br><br> Are you sure?",
                facebook: "This will share your photo to Facebook.<br><br> Are you sure?",
                googleplus: "This will share your photo to Google+.<br><br> Are you sure?",
                tumblr: "This will share your photo to Tumblr.<br><br> Are you sure?",
                twitter: "This will share your photo to Twitter.<br><br> Are you sure?"
            }
        },
        items: [ {
            item: t.Html,
            config: {
                id: "textConfirmation",
                html: "Are you sure?"
            }
        } ]
    };
});

define("S3Uploader", [ "q", "utils", "environment" ], function(e, Utils, t) {
    return {
        upload: function(i) {
            var n = e.defer();
            var r = new XMLHttpRequest();
            var a = Utils.uuid("xyxyxyxyxyxyxyxyxy") + ".jpg";
            var o = t.config.s3.buckets.sharedImages + a;
            r.upload.addEventListener("progress", function(e) {
                if (e.lengthComputable) {
                    var t = e.loaded / e.total;
                    n.notify({
                        msg: "Uploading image... {1}%".assign(Math.round(t * 100)),
                        progress: t
                    });
                }
            });
            r.upload.addEventListener("load", function() {
                n.notify({
                    msg: "Image uploaded..."
                });
                n.resolve(o);
            });
            n.notify({
                msg: "Uploading image..."
            });
            r.open("PUT", o);
            r.setRequestHeader("x-amz-acl", "public-read");
            r.overrideMimeType("image/jpg");
            r.send(i);
            return n.promise;
        }
    };
});

define("SocialSharing/views/index", [ "require", "TrackingService", "LoggingService", "utils", "jquery", "ua", "FacebookComponent", "../templates/index", "../configs/confirm", "i18n!assets/js/picsio-raw/localization/strings", "S3Uploader", "q", "Widget" ], function(e) {
    var t = e("TrackingService");
    var i = e("LoggingService");
    var Utils = e("utils");
    var n = e("jquery");
    var r = e("ua");
    var a = e("FacebookComponent");
    var o = e("../templates/index");
    var s = e("../configs/confirm");
    var l = e("i18n!assets/js/picsio-raw/localization/strings");
    var c = e("S3Uploader");
    var u = e("q");
    var f = e("Widget");
    return {
        config: {
            imageUrl: null,
            parentEl: null,
            pageUrl: "https://raw.pics.io/",
            pageTitle: null,
            pageDesc: null,
            getUrlFromCanvas: function() {},
            photoDesc: "This photo was shared using https://raw.pics.io via @TopTechPhoto"
        },
        socialUrls: {
            twitter: {
                url: "https://twitter.com/share?url=|u|&text=|140|"
            },
            tumblr: {
                url: "http://www.tumblr.com/share?v=3&u=|u|"
            },
            googleplus: {
                url: "https://plusone.google.com/_/+1/confirm?hl=en&url=|u|"
            },
            pinterest: {
                url: "http://pinterest.com/pin/create/button/?url=raw.pics.io&media=|u|&description=|d|"
            },
            facebook: {
                url: "http://www.facebook.com/share.php?u=|u|"
            },
            linkedin: {
                url: "http://www.linkedin.com/shareArticle?mini=true&url=|u|&title=|t|&summary=|d|&source=in1.com"
            },
            in1: {
                url: "http://www.in1.com/cast?u=|u|",
                w: "490",
                h: "529"
            },
            digg: {
                url: "http://digg.com/submit?url=|u|&title=|t|"
            },
            reddit: {
                url: "http://reddit.com/submit?url=|u|"
            },
            posterous: {
                url: "http://posterous.com/share?linkto=|u|&title=|t|"
            },
            stumbleupon: {
                url: "http://www.stumbleupon.com/submit?url=|u|&title=|t|"
            },
            email: {
                url: "mailto:?subject=|t|"
            }
        },
        initialize: function(e) {
            Object.merge(this.config, e);
            this.config.pageTitle = n("head title").text().substring(0, 250);
            this.config.pageDesc = n('meta[name="description"]').attr("content").substring(0, 250);
            this.render();
            this.$el.on("click", ".btnSocialSharing", this.onClick.bind(this));
        },
        render: function() {
            this.$el = n(o);
            n(this.config.parentEl).append(this.$el);
        },
        onClick: function(e) {
            var i = this;
            var n = e.currentTarget.dataset.id;
            var r = e.currentTarget.dataset.ga;
            s.config.onOk = function() {
                t.push("Raw", "FileStartSharing", r);
                i.config.getUrlFromCanvas().then(function(e) {
                    if (n === "facebook") {
                        i.shareCurrentImageToFB(e.blob);
                        return;
                    }
                    i.saveToS3(e.blob).then(function(e) {
                        i.config.imageUrl = e;
                        var t = i.socialUrls[n].url.replace("|u|", i.config.imageUrl).replace("|t|", "").replace("|d|", i.config.photoDesc).replace("|140|", i.config.photoDesc);
                        window.open(t, "t", "toolbar=0, resizable=1, status=0, width=640, height=528");
                    }.bind(i)).fail(function() {});
                }.bind(i));
            };
            var a = new f.Dialog(s.config);
            a.addItems(s.items);
            var o = a.getItem("textConfirmation");
            o && o.setValue(a.config.messages[n]);
        },
        setImg: function(e) {
            this.imageUrl = e;
        },
        destroy: function() {},
        shareCurrentImageToFB: function(e) {
            var i = n(".btnSocialSharing.iconRaw_btnFacebook");
            if (Utils.isChromeApplication()) return;
            var o = this.config.filmStrip.getSelectedItem().data("uid");
            var s = this.config.workingList.findByUid(o);
            this.config.renderLeftBottomSpinner(l.SHARING_TO_FB);
            Utils.getBlobFromUrl(URL.createObjectURL(e), {
                browser: r.browser.family
            }).then(a.shareImage.bind(a)).then(function() {
                t.push("Raw", "FileShared", s.get("mimeType"));
            }).fail(function(e) {
                console.error(e);
            }).fin(function() {
                this.config.destroyLeftBottomSpinner();
            }.bind(this)).done();
        },
        saveToS3: function(e) {
            var t = this.config.filmStrip.getSelectedItem().data("uid");
            var n = this.config.workingList.findByUid(t);
            var r = u.defer();
            if (n.get("shareUrl")) {
                r.resolve(n.get("shareUrl"));
                return r.promise;
            }
            i.blockui("Uploading...");
            c.upload(e).then(function(e) {
                n.set("shareUrl", e);
                r.resolve(e);
            }).fail(function(e) {
                r.reject(e);
                console.error(e);
            }).done(i.unblockui);
            return r.promise;
        }
    };
});

define("SocialSharing/index", [ "require", "./views/index" ], function(e) {
    var t = e("./views/index");
    return function(e) {
        t.initialize(e);
        return {
            setImg: t.setImg,
            destroy: t.destroy
        };
    };
});

define("SocialSharing", [ "SocialSharing/index" ], function(e) {
    return e;
});

define("converter", [ "jquery", "underscore", "utils", "sugar", "WorkingList", "LoggingService", "MetadataService", "StorageService", "TrackingService", "RawImageDescriptor", "RawPdfImageDescriptor", "environment", "decode", "resizeImage", "mustache", "Widget", "signal", "q", "ua", "i18n!assets/js/picsio-raw/localization/strings", "privateBrowsingDetector", "/assets/js/lib/gapi.js", "Spinner", "MetadataComponent", "ExposureCompensationComponent", "PaymentComponent", "FacebookComponent", "eConf", "RawCounter", "SocialSharing" ], function(e, t, Utils, i, n, r, a, o, s, l, c, u, f, d, h, p, g, m, v, y, b, w, C, x, _, S, k, A, E, T) {
    var P = "Raw";
    var I = {};
    var O = "jpg";
    var D = "raw";
    var R = function() {
        return {
            workingList: null,
            storage: null,
            leftBottomSpinner: null,
            renderLeftBottomSpinner: function(e) {
                this.destroyLeftBottomSpinner();
                this.leftBottomSpinner = new C({
                    parentEl: I.leftSidebar,
                    title: e,
                    classList: [ "leftSidebarSpinner" ]
                });
            },
            destroyLeftBottomSpinner: function() {
                this.leftBottomSpinner && this.leftBottomSpinner.destroy();
                this.leftBottomSpinner = null;
            },
            bindOnErrorLogging: function() {
                var e = this;
                window.onerror = function(t, i, n, a, o) {
                    var l = s.trackableErrors;
                    if (l && l.length && l.indexOf(o && o.code) !== -1) {
                        s.push(P, o.code, o.data);
                    }
                    r.error(o || t);
                    e.destroyLeftBottomSpinner();
                };
            },
            updateData: function(e) {
                var t = this;
                return m(e).then(t.updateModeSwitcher(e)).then(t.updateMetadata(e)).then(t.updateWB(e)).then(t.updateExposure(e));
            },
            isRawData: function(e) {
                return e.get("decodingParams").selectedSourceSegment === D;
            },
            init: function() {
                e(".blockNumberAlreadyConverted").show();
                E.initialize({
                    parentEl: e(".blockNumberAlreadyConverted b")
                });
                var t = this;
                PDFJS.workerSrc = "/assets/js/lib/pdfjs/pdf.worker.js";
                s.setCategory(P);
                A.toolbars.topRight.last().caller = this.collapseEditor.bind(this);
                this.bindOnErrorLogging();
                w.init({
                    scopes: u.config.gdrive.SCOPES,
                    clientId: u.config.gdrive.CLIENT_ID
                });
                this.workingList = new n();
                g.subscribe("workingList:item:added", function(e) {
                    I.filmStrip.addItem({
                        uid: e.get("uid"),
                        title: e.get("name")
                    });
                    t.updateButtons();
                });
                g.subscribe("workingList:item:removed", function(e) {
                    t.updateButtons();
                });
                g.subscribe("filmStrip:selected", function(e) {
                    t.renderLeftBottomSpinner(y.DRAWING_IMAGE);
                    var i = t.workingList.findByUid(e);
                    t.updateData(i).then(function(e) {
                        t.isRawData(e) ? t.drawOriginalData(e.get("thumbnail")) : t.drawThumbnailObject(e.get("thumbnail"));
                    }).then(t.destroyLeftBottomSpinner()).fail(function(e) {
                        console.error(y.CANT_DRAW_IMAGE_TPL.assign(i.get("name")));
                    });
                });
                g.subscribe("filmStrip:removed", function(e) {
                    t.workingList.removeByUid(e);
                });
                g.subscribe("thumbnail:changed", function(e) {
                    I.filmStrip.updateItem({
                        uid: e.get("uid"),
                        url: e.get("thumbnail").small300.url
                    });
                });
                var i = function() {
                    var e = t.isWorkingListContainsPDF();
                    var i = S.isPaid();
                    if (!(e || i)) {
                        t.unpaid("raw", false);
                    }
                    return e || i;
                };
                var l = function(e) {
                    var n = t.getSelectedDescriptor();
                    n.get("decodingParams").selectedSourceSegment = e;
                    t.updateData(n).then(function(n) {
                        if (e === O) {
                            s.push(P, "SwitchToJpg", n.get("mimeType"));
                            return n.generateThumbnail().progress(function(e) {
                                r.blockui(e && e.msg);
                            }).then(function(e) {
                                t.renderLeftBottomSpinner(y.DRAWING_IMAGE);
                                return t.drawThumbnailObject(e.get("thumbnail"));
                            }.bind(t)).then(m.delay(200)).then(t.savePreview.bind(t, n));
                        } else if (e === D) {
                            s.push(P, "SwitchToRaw", n.get("mimeType"));
                            var o = a.readyForWhat(n.toJSON());
                            var l = !o.decoding;
                            if (l) return m.reject("format is not supported. force lambda");
                            return n.decodeImage({
                                skipIfDecoded: true
                            }).progress(function(e) {
                                r.blockui(e && e.msg);
                            }).then(function() {
                                i();
                                t.renderLeftBottomSpinner(y.DRAWING_IMAGE);
                                t.drawOriginalData(n.get("thumbnail")).then(m.delay(200)).then(t.savePreview.bind(t, n));
                            });
                        }
                    }).fail(function(e) {
                        console.error(e);
                        var i = n.hasOriginalDataFromLambda();
                        return (i ? m.resolve(true) : t.showAlertAboutFailed(n)).then(function(e) {
                            if (e) {
                                return n.decodeImage({
                                    skipIfDecoded: true,
                                    mode: "lambda"
                                }).progress(function(e) {
                                    r.blockui(e && e.msg);
                                }).then(function() {
                                    t.renderLeftBottomSpinner(y.DRAWING_IMAGE);
                                    t.drawImageData(n.get("originalData"));
                                    t.destroyLeftBottomSpinner();
                                    r.unblockui();
                                });
                            } else {
                                return m.resolve("skip");
                            }
                        });
                    }).fail(function(e) {
                        console.error(e);
                        r.error(y.CANT_CONVERT_FILE);
                    }).fin(function() {
                        t.destroyLeftBottomSpinner();
                        r.unblockui();
                    });
                };
                I.toggleSource = new p.Toggle({
                    onChange: l,
                    container: e(".wrapperThumbnailSwitchPanel"),
                    classList: [ "btnSwitchPanel" ],
                    segments: [ {
                        title: y.SHOW_JPG,
                        value: O,
                        selected: true
                    }, {
                        title: y.SHOW_RAW,
                        value: D
                    } ]
                });
                I.filmStrip = new p.FilmStrip({
                    container: e("#rightSidebarRawPicsio")
                });
                I.body = e("body");
                I.leftSidebar = document.getElementById("leftSidebarRawpicsio");
                I.rightSidebar = document.getElementById("rightSidebarRawPicsio");
                I.$contentSidebarLivePicsio = e("#contentRawpicsio");
                I.$saveButton = e(".btnDownloadConverted");
                I.$saveAllButton = e(".btnDownloadAllConverted");
                I.$savePDFButton = e(".btnDownloadPDF");
                I.$btnEdit = e(".btnEdit");
                g.subscribe("editor.execute.save", function(e) {
                    if (e.removeBlobAfterSave && e.blobUrl) {
                        URL.revokeObjectURL(e.blobUrl);
                    }
                    o.inc("files_saved");
                    !e.multiple && t.showAlertAboutSavedFiles();
                });
                I.$saveButton.on("click", t.save.bind(t));
                I.$saveAllButton.on("click", t.saveMultiple.bind(t));
                I.$savePDFButton.on("click", t.savePDF.bind(t));
                I.$btnEdit.on("click", t.extendEditor.bind(t));
                I.wb = new p.Select({
                    container: ".wrapperWhiteBalance",
                    id: "wb",
                    label: y.WHITE_BALANCE,
                    styleList: {
                        width: "100%"
                    },
                    options: [ {
                        text: "As Shot",
                        value: "asShot",
                        checked: true
                    } ],
                    callback: function(e, i) {
                        var n = t.getSelectedDescriptor();
                        if (n.get("decodingParams").selectedwb !== i) {
                            s.push(P, "WBSelected", i);
                            n.get("decodingParams").selectedwb = i;
                            var r = t.getDecodingParams();
                            n.decodeImage(r).then(function(e) {
                                t.drawOriginalData(n.get("thumbnail"));
                            });
                        }
                    }
                });
                I.wb.hide();
                I.exposureCompensation = _.init({
                    parentEl: e(".wrapperExposureCompensation")
                });
                I.exposureCompensation.hide();
                I.exposureCompensation.dispatcher.on("change", function(e) {
                    var i = t.getSelectedDescriptor();
                    i.get("decodingParams").exposureCompensationValue = e;
                    var n = t.getDecodingParams();
                    i.decodeImage(n).then(function(e) {
                        t.drawOriginalData(i.get("thumbnail"));
                    });
                });
                e(".lsBtnBuyNow").on("click", this.unpaid.bind(this, "raw"));
                e(".btnRestorePreviousPurchase").on("click", S.restorePurchase);
                I.$restorePurchase = e(".restorePreviousPurchase");
                var c = this.isWorkingListContainsPDF();
                var f = S.isPaid();
                if (!(c || f)) {
                    I.$restorePurchase.addClass("show");
                    I.leftSidebar.classList.add("restorePurchaseShowed");
                } else {
                    I.$restorePurchase.removeClass("show");
                }
                I.$downloadBtns = e(".btnOpenImage input, .btnUploadImagesPC input");
                I.$downloadBtns.on("change", function(e) {
                    var i = this;
                    t.openAndProcess(e.target.files).then(function() {
                        i.value = "";
                    }).done();
                });
                t._initDragAndDrop();
                t._initShortcuts();
                b.detect(function(e) {
                    var i = t.isWorkingListContainsPDF();
                    var n = S.isPaid();
                    if (!(i || n) && e) {
                        t.unpaid("private_browsing");
                    }
                });
                e(".linkShowVideo img").on("click", function() {
                    e(".popupVideo").addClass("showVideo");
                    e("#forVideo").html('<iframe width="640" height="360" src="//www.youtube.com/embed/QDzK4t7oqW4?rel=0&autoplay=1" frameborder="0" allowfullscreen></iframe>');
                });
                e(".popupVideo span").on("click", function() {
                    e(".popupVideo.showVideo").removeClass("showVideo");
                    e("#forVideo").empty();
                });
                e("#leftSidebarRawpicsio").on("mouseleave", function() {
                    e(this).find(".innerLeftSidebarRawpicsio").animate({
                        scrollTop: 0
                    }, 300);
                });
                this.metadataComponent = new x({
                    parentEl: e(".wrapperMetadataPanel"),
                    filter: [ "Aperture", "Create Date", "Exposure Program", "Exposure Time", "Flash", "Focal Length", "ISO" ],
                    data: {}
                });
                e(".btnCreateWebsite").on("click", function() {
                    s.push(P, "CreateWebsite");
                    var e = function(e) {
                        s.push(P, e);
                        new p.Dialog({
                            title: "Experimental",
                            disableCancel: true,
                            showCloseButton: false,
                            classList: [ "textPopup", "thankyouPopup" ],
                            onOk: function() {},
                            onCancel: function() {},
                            onClose: function() {},
                            items: [ {
                                item: p.Text,
                                config: {
                                    id: "text",
                                    label: "Thank you! "
                                }
                            } ]
                        });
                    };
                    var t = new p.Dialog({
                        title: "Experimental",
                        okName: "Yes",
                        cancelName: "No",
                        showCloseButton: false,
                        onOk: e.bind(null, "CreateWebsiteYes"),
                        onCancel: e.bind(null, "CreateWebsiteNo"),
                        onClose: function() {},
                        classList: [ "textPopup" ],
                        items: [ {
                            item: p.Text,
                            config: {
                                id: "text",
                                label: "We're checking demand on website creation functionality for raw.pics.io. Please click Yes if you think it would be cool to have this feature."
                            }
                        } ]
                    });
                });
                e(".btnHelp").on("click", function() {
                    s.push(P, "GetHelp");
                    window.open("http://support.pics.io/knowledgebase/articles/746544-raw-pics-io-frequently-asked-questions", "_blank");
                });
                new T({
                    parentEl: e(".btnWrapperSharing"),
                    getUrlFromCanvas: this.getUrlFromCanvas.bind(this),
                    filmStrip: I.filmStrip,
                    workingList: this.workingList,
                    renderLeftBottomSpinner: this.renderLeftBottomSpinner.bind(this),
                    destroyLeftBottomSpinner: this.destroyLeftBottomSpinner.bind(this)
                });
            },
            _initShortcuts: function() {
                var e = this;
                I.body.keydown(function(t) {
                    if ((t.metaKey || t.ctrlKey) && t.which == 85) {
                        e.shouldCalculateMemorycores().then(function(t) {
                            if (t) {
                                e.calculateMemoryscores();
                            }
                        });
                    }
                });
            },
            _initDragAndDrop: function() {
                var e = this;
                I.body.on("drop", function(t) {
                    I.filmStrip.highlight(false);
                    if (t.originalEvent.dataTransfer && t.originalEvent.dataTransfer.files.length) {
                        t.preventDefault();
                        t.stopPropagation();
                        e.openAndProcess(t.originalEvent.dataTransfer.files).done();
                    }
                }).on("dragenter", function(e) {
                    document.getElementsByClassName("dropPlace")[0].style.border = "1px dashed #ffcc00";
                    I.filmStrip.highlight(true);
                    e.preventDefault();
                    e.stopPropagation();
                }).on("dragover", function(e) {
                    e.stopPropagation();
                    e.preventDefault();
                    return false;
                }).on("dragstart", function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    return false;
                });
            },
            authorizeGD: function() {
                w.authorize();
            },
            layout: function(e) {
                I.body.addClass("innerPage");
                E.destroy();
            },
            unpaid: function(e, t) {
                t = t !== false;
                S.render({
                    type: e,
                    showCloseButton: t
                });
            },
            extendEditor: function() {
                s.push(P, "OpenEditor");
                I.leftSidebar.classList.add("smoothHide");
                I.rightSidebar.classList.add("smoothHide");
                e("#picsEdit").addClass("showedInEditor");
                I.$contentSidebarLivePicsio.css({
                    width: "100%",
                    margin: "0"
                });
                window.dispatchEvent(new Event("resize:end"));
                editor.startToolbar(undefined, A);
                var t = this.getSelectedDescriptor();
                var i = Utils.getImageSizeByUrl(t.get("thumbnail").original.url);
                m(i).then(function(e) {
                    editor.renderSmallData({
                        name: t.get("name"),
                        width: e.width,
                        height: e.height,
                        size: t.get("fileSize")
                    });
                });
            },
            savePreview: function(e) {
                editor.canvas.save({
                    notSave: true,
                    fileName: e.get("name"),
                    mimeType: e.get("mimeType"),
                    quality: 90,
                    resize: {
                        width: 300,
                        height: 300,
                        smartResize: true
                    }
                }, function(t) {
                    e.setThumbnail("small300", {
                        url: URL.createObjectURL(t.blob)
                    });
                    g.publish("thumbnail:changed", e);
                });
            },
            saveEditorChanges: function() {
                var e = this.getSelectedDescriptor();
                var t = this;
                editor.canvas.save({
                    notSave: true,
                    fileName: e.get("name"),
                    mimeType: e.get("mimeType"),
                    quality: 100
                }, function(i) {
                    if (t.isRawData(e)) {
                        e.setThumbnail("originalData", {
                            url: URL.createObjectURL(i.blob)
                        });
                    } else {
                        e.setThumbnail("original", {
                            url: URL.createObjectURL(i.blob)
                        });
                    }
                    t.savePreview(e);
                });
            },
            resetEditorChanges: function() {
                editor.reset();
            },
            collapseUI: function() {
                I.leftSidebar.classList.remove("smoothHide");
                I.rightSidebar.classList.remove("smoothHide");
                e("#picsEdit").removeClass("showedInEditor");
                I.$contentSidebarLivePicsio.css({
                    width: I.body.width() - 240,
                    margin: "0px"
                });
                editor.hideToolbars();
                window.dispatchEvent(new Event("resize:end"));
            },
            collapseEditor: function() {
                var e = this;
                editor.applyOpenedPlugin();
                new p.Dialog({
                    title: y.SAVE_CHANGES,
                    okName: "Yes",
                    cancelName: "No",
                    onOk: e.saveEditorChanges.bind(this),
                    onCancel: e.resetEditorChanges.bind(this),
                    onClose: e.collapseUI.bind(this),
                    items: [ {
                        item: p.Text,
                        config: {
                            id: "text",
                            label: y.SAVE_CHANGES_TEXT
                        }
                    } ]
                });
            },
            openFiles: function(e) {
                var t = this;
                var i = t.isWorkingListContainsPDF();
                var n = S.isPaid();
                var a = [];
                for (var o = 0; o < e.length; o++) {
                    var s = m.defer();
                    a.push(s.promise);
                    var l = e[o];
                    console.assert(l !== undefined, "No file selected");
                    console.log("filename/mimeType: %s/%s", l.name, l.getMimeType());
                    var c = l.getMimeType();
                    if (u.config.formats.PDF_FORMATS.indexOf(c) !== -1) {
                        m.when(t.openPdfFile(l), s.resolve);
                    } else if (u.config.formats.RAWPICSIO_SUPPORTED_FORMATS.indexOf(c) !== -1) {
                        m.when(t.openGenericFile(l), s.resolve);
                    } else {
                        var f = new Error(y.FORMAT_IS_NOT_SUPPORTED_YET_TPL.assign(l.name));
                        f.code = "UnsupportedFormat";
                        f.data = c;
                        r.error(f.message);
                        s.resolve();
                    }
                }
                return m.all(a);
            },
            openAndProcess: function(e) {
                var t = this;
                return this.openFiles(e).then(t.processWorkingList.bind(t), function(e) {
                    if (e === "unpaid") {
                        return t.unpaid("batch");
                    }
                });
            },
            openGenericFile: function(e) {
                var t = new l(e, {
                    parse: true,
                    src: "fs"
                });
                this.workingList.addItem(t);
                return m.resolve();
            },
            openPdfFile: function(e) {
                var t = this;
                var i = m.defer();
                var n = new FileReader();
                n.onload = function(n) {
                    var r = new Uint8Array(n.target.result);
                    PDFJS.getDocument(r).then(function(n) {
                        e.pdf = n;
                        for (var r = 1; r <= n.numPages; r++) {
                            var a = new c(e, {
                                parse: true,
                                src: "fs",
                                pageNumber: r
                            });
                            t.workingList.addItem(a);
                        }
                        i.resolve();
                    });
                };
                n.readAsArrayBuffer(e);
                return i.promise;
            },
            processItems: function(e, t) {
                var i = this;
                var n = [];
                var a = function(e) {
                    return function() {
                        return i.processWorkingListItem(e, t);
                    };
                };
                for (var o = 0; o < e.length; o++) {
                    var s = e[o];
                    if (t && t.parallel) {
                        n.push(i.processWorkingListItem(s, t));
                    } else {
                        n.push(a(s));
                    }
                }
                requestAnimationFrame(i.layout.bind(i, "preview"));
                var l;
                if (t && t.parallel) {
                    l = m.all(n);
                } else {
                    l = n.reduce(m.when, m(0));
                }
                return l.then(function() {
                    var t = e.last();
                    !t.get("failedStatus") && I.filmStrip.select(t.get("uid"), true);
                }).fail(function(e) {
                    r.error("Some files can't be processed");
                });
            },
            processWorkingList: function() {
                var e = this;
                return this.processItems(this.workingList.itemsWithoutThumbnail()).fin(function() {
                    var t = e.workingList.failedItems();
                    if (t && t.length) {
                        e.showAlertAboutFailed(t).then(function(i) {
                            if (i) {
                                e.processItems(t, {
                                    mode: "lambda",
                                    parallel: true
                                });
                            }
                        });
                    }
                });
            },
            processWorkingListItem: function(e, t) {
                var i = this;
                i.renderLeftBottomSpinner(y.CONVERTING_IMAGE);
                s.push(P, "FileDropped", e.get("mimeType"));
                return e.generateMetadata().then(e.generateThumbnail.bind(e, t)).progress(function(t) {
                    var i = e.get("uid");
                    I.filmStrip.setSpinner(i, t.message && t.message.msg);
                }).then(function() {
                    var n = e.get("uid");
                    I.filmStrip.destroySpinner(n);
                    i.renderLeftBottomSpinner(y.DRAWING_IMAGE);
                    I.filmStrip.updateItem({
                        uid: e.get("name"),
                        url: e.get("thumbnail").small300.url
                    });
                    i.destroyLeftBottomSpinner();
                    s.push(P, "FileConverted", t && t.mode || "frontend");
                    e.set("failedStatus", undefined);
                }).fail(function(t) {
                    var n = e.get("uid");
                    I.filmStrip.destroySpinner(n);
                    e.set("failedStatus", t.code || "failed");
                    var r = "/assets/img/cant_convert_file_raw_filmstrip.jpg";
                    if (t.code === "unsupported_camera") {
                        r = "/assets/img/camera_not_supported_raw_filmstrip.png";
                    }
                    I.filmStrip.updateItem({
                        uid: e.get("name"),
                        url: r
                    });
                    i.destroyLeftBottomSpinner();
                    console.error(t.message);
                });
            },
            shouldCalculateMemorycores: function() {
                var e = this;
                var t = this.workingList.itemsWithoutMemoryscore();
                if (t.length <= 0) return m.resolve(false);
                if (this.calculatememoryScoreDialog) return m.resolve(false);
                var i = m.defer();
                var n = {
                    title: "Memoryscore analyze",
                    okName: "Yes",
                    cancelName: "No",
                    showCloseButton: false,
                    onOk: function() {
                        return i.resolve(true);
                    },
                    onCancel: function() {
                        return i.resolve(false);
                    },
                    onClose: function() {
                        delete e.calculatememoryScoreDialog;
                    },
                    items: [ {
                        item: p.Text,
                        config: {
                            id: "text",
                            label: "Memoryscore will be calculated for {1} image(s). Continue?".assign(t.length)
                        }
                    } ]
                };
                this.calculatememoryScoreDialog = new p.Dialog(n);
                return i.promise;
            },
            calculateMemoryscores: function() {
                var e = this;
                s.push(P, "MemScoreStart", e.workingList.size());
                for (var t = 0; t < e.workingList.size(); t++) {
                    var i = e.workingList.at(t);
                    I.filmStrip.setSpinner(i.get("uid"), "Analyzing image...");
                    i.calculateMemoryscore().then(function(e) {
                        s.push(P, "MemScoreFinish", e.memoryscore);
                        console.log("Image analyzied for image {1}. Memoryscore = {2}".assign(e.uid, e.memoryscore));
                        I.filmStrip.updateItem({
                            uid: e.uid,
                            bottomText: "MemoryScore {memoryscore}".assign(e)
                        });
                        return e;
                    }).fail(function(e) {
                        I.filmStrip.updateItem({
                            uid: e.uid,
                            bottomText: "MemoryScore N/A"
                        });
                        console.error("Error analyzing image memoryscore", e.msg);
                        return e;
                    }).done(function(e) {
                        I.filmStrip.destroySpinner(e.uid);
                    });
                }
            },
            drawThumbnailObject: function(e) {
                var t = this;
                var i = m.defer();
                var n = e.original.url;
                var r = e.original.orientation;
                var a = new Image();
                a.onload = function() {
                    t.drawImageData(a);
                    i.resolve();
                };
                a.src = n;
                return i.promise;
            },
            drawOriginalData: function(e) {
                var t = this;
                var i = m.defer();
                var n = e.originalData.url;
                var r = e.originalData.orientation;
                var a = new Image();
                a.onload = function() {
                    t.drawImageData(a);
                    i.resolve();
                };
                a.onerror = function() {
                    i.reject();
                };
                a.src = n;
                return i.promise;
            },
            drawImageData: function(e) {
                var t = this;
                var i = this.getSelectedDescriptor();
                editor.init({
                    container: I.$contentSidebarLivePicsio[0],
                    supressExperimentalDisclaimer: true,
                    name: i.get("name"),
                    mimeType: "image/jpeg",
                    img: e,
                    logo: true,
                    reinit: {
                        changeTransform: true
                    },
                    toolbar: {
                        override: {}
                    },
                    additionalPlugins: [ "saver" ],
                    dragable: true,
                    zoom: true,
                    padding: 0,
                    converter: true
                });
                editor.hideLogo();
            },
            updateButtons: function() {
                if (this.workingList.size() === 1) {
                    I.$saveAllButton.hide();
                } else if (!this.workingList.size()) {
                    window.location.href = "/";
                } else {
                    I.$saveAllButton.show();
                }
            },
            updateModeSwitcher: function(t) {
                try {
                    if (t.isLambdaConvertableRawFormat()) {
                        e(".wrapperThumbnailSwitchPanel").show();
                        I.toggleSource.setSelected(t.get("decodingParams").selectedSourceSegment || "jpg");
                    } else {
                        e(".wrapperThumbnailSwitchPanel").hide();
                    }
                } catch (i) {
                    console.error(i);
                    e(".wrapperThumbnailSwitchPanel").hide();
                }
                return t;
            },
            updateMetadata: function(e) {
                if (e.get("metadata") && e.get("metadata").exif) {
                    var t = e.get("metadata").exif;
                    var i = {};
                    for (var n in t) {
                        t[n].value && (i[t[n].name] = t[n].value);
                    }
                    this.metadataComponent.render({
                        icon: i
                    });
                    this.metadataComponent.show();
                } else {
                    this.metadataComponent.hide();
                }
                return e;
            },
            updateExposure: function(e) {
                try {
                    var t = a.readyForWhat(e.toJSON());
                    if (!t.decoding) {
                        I.exposureCompensation.hide();
                        return e;
                    }
                    if (e.get("decodingParams").selectedSourceSegment === O) {
                        I.exposureCompensation.hide();
                        return e;
                    }
                    I.exposureCompensation.setEV(e.get("decodingParams").exposureCompensationValue);
                    I.exposureCompensation.show();
                } catch (i) {
                    console.error(i);
                    I.exposureCompensation.hide();
                }
                return e;
            },
            updateWB: function(e) {
                try {
                    var t = a.readyForWhat(e.toJSON());
                    if (!t.decoding) {
                        I.wb.hide();
                        return e;
                    }
                    if (e.get("decodingParams").selectedSourceSegment === O) {
                        I.wb.hide();
                        return e;
                    }
                    var i = e.get("metadata").exif && e.get("metadata").exif.ColorData;
                    if (i && Object.keys(i).length > 1) {
                        var n = Object.keys(i).map(function(e) {
                            return {
                                text: i[e].title,
                                value: e,
                                checked: false
                            };
                        });
                        n.each(function(t) {
                            if (t.text === e.get("decodingParams").selectedwb) {
                                t.checked = true;
                                e.get("decodingParams").selectedwb = t.text;
                            } else {
                                t.checked = false;
                            }
                            if (!e.get("decodingParams").selectedwb) {
                                e.get("decodingParams").selectedwb = n[0].text;
                                n[0].checked = true;
                            }
                        });
                        I.wb.addOptions(n, true);
                        I.wb.show();
                    } else {
                        I.wb.hide();
                    }
                } catch (r) {
                    console.error(r);
                    I.wb.hide();
                }
                return e;
            },
            getSelectedDescriptor: function() {
                var e = I.filmStrip.getSelectedItem().data("uid");
                return this.workingList.findByUid(e);
            },
            getDecodingParams: function() {
                var e = this.getSelectedDescriptor();
                try {
                    var t = e.get("metadata").exif.ColorData[e.get("decodingParams").selectedwb].levels;
                } catch (i) {
                    console.warn("No WB levels populated");
                }
                var n = e.get("decodingParams").exposureCompensationValue;
                var r = {};
                if (n) r.BaselineExposure = n;
                if (t) r.WBRGBLevels = t;
                return r;
            },
            isWorkingListContainsPDF: function() {
                var e = this.workingList.items.count(function(e) {
                    return !!e.get("file").pdf;
                });
                if (e > 0) return true;
            },
            showAlertAboutPopups: function() {
                var e = m.defer();
                var t = !!o.get("do_not_ask_about_popups");
                if (!t && v.browser.family === "Safari") {
                    var i = {
                        title: y.ENABLE_POPUPS_TTITLE,
                        okName: "OK",
                        cancelName: y.NEVER_ASK_AGAIN,
                        showCloseButton: false,
                        onOk: function() {
                            return e.resolve();
                        },
                        onCancel: function() {
                            o.set("do_not_ask_about_popups", true);
                            return e.resolve();
                        },
                        onClose: function() {},
                        items: [ {
                            item: p.Text,
                            config: {
                                id: "text",
                                label: y.ENABLE_POPUPS_TEXT
                            }
                        } ]
                    };
                    new p.Dialog(i);
                } else {
                    return m.resolve();
                }
                return e.promise;
            },
            showAlertAboutAlotOfFiles: function() {
                var e = m.defer();
                var t = !!o.get("do_not_ask_about_saving_many_files");
                var i = this.workingList.size() > 100;
                if (!t && i) {
                    var n = {
                        title: y.SAVE_MANY_FILES_POPUP_TITLE,
                        okName: "OK",
                        cancelName: y.NEVER_ASK_AGAIN,
                        showCloseButton: false,
                        onOk: function() {
                            return e.resolve();
                        },
                        onCancel: function() {
                            o.set("do_not_ask_about_saving_many_files", true);
                            return e.resolve();
                        },
                        onClose: function() {},
                        items: [ {
                            item: p.Text,
                            config: {
                                id: "text",
                                label: y.SAVE_MANY_FILES_POPUP_TEXT_TPL.assign(this.workingList.size())
                            }
                        } ]
                    };
                    new p.Dialog(n);
                } else {
                    return m.resolve();
                }
                return e.promise;
            },
            showAlertAboutFailed: function(e) {
                var t = m.defer();
                var i = y.DIALOGS.FAILED_TO_CONVERT.MSG_1_FILE;
                if (e.length > 1 && e.length < 10) {
                    var n = e.map(function(e) {
                        return e.get("name");
                    }).join("<br/>");
                    i = y.DIALOGS.FAILED_TO_CONVERT.MSG_10LESS_FILES_TPL.assign(e.length, n);
                } else if (e.length >= 10) {
                    var n = e.to(5).map(function(e) {
                        return e.get("name");
                    }).join("<br/>");
                    i = y.DIALOGS.FAILED_TO_CONVERT.MSG_10MORE_FILES_TPL.assign(e.length, n);
                }
                var r = {
                    title: y.DIALOGS.FAILED_TO_CONVERT.TITLE,
                    okName: y.DIALOGS.FAILED_TO_CONVERT.YES,
                    cancelName: y.DIALOGS.FAILED_TO_CONVERT.NO,
                    showCloseButton: false,
                    onOk: function() {
                        return t.resolve(true);
                    },
                    onCancel: function() {
                        return t.resolve(false);
                    },
                    onClose: function() {},
                    items: [ {
                        item: p.Text,
                        config: {
                            id: "text",
                            label: i
                        }
                    } ]
                };
                new p.Dialog(r);
                return t.promise;
            },
            showAlertAboutSavedFiles: function() {
                var e = m.defer();
                var t = v.browser.family == "Safari" ? y.DIALOGS.FILES_SAVED.TEXT_SAFARI : y.DIALOGS.FILES_SAVED.TEXT;
                var i = {
                    title: y.DIALOGS.FILES_SAVED.TITLE,
                    okName: y.DIALOGS.FILES_SAVED.YES,
                    showCloseButton: false,
                    disableCancel: true,
                    onOk: function() {
                        return e.resolve(true);
                    },
                    onClose: function() {},
                    items: [ {
                        item: p.Text,
                        config: {
                            id: "text",
                            label: t
                        }
                    } ]
                };
                new p.Dialog(i);
                return e;
            },
            save: function(e) {
                var t = this.getSelectedDescriptor();
                var i = this.isWorkingListContainsPDF();
                var n = S.isPaid();
                var r = S.isTrial();
                if (!(i || n || r)) {
                    this.unpaid("too_many_files");
                } else {
                    s.push(P, "FileDownloaded", t.get("mimeType"));
                    var a = {
                        multiple: true,
                        blob: t.get("thumbnail").original.blob,
                        authorizeGDCallback: this.authorizeGD
                    };
                    editor.getPlugin("saver").open(a);
                }
            },
            savePDF: function() {
                var e = this;
                var t = new jsPDF();
                var i = this.workingList.items.filter(function(e) {
                    var t = e.get("mimeType");
                    return t === "image/png" || t === "image/jpg" || t === "image/jpeg";
                });
                if (i.length !== this.workingList.items.length) {
                    r.warn("Some of images are in unsupported format and will be skipped");
                }
                if (i.length === 0) {
                    r.error("No pages will be saved to PDF");
                    return;
                }
                r.blockui("Creating PDF document");
                var n = [];
                i.each(function(e) {
                    var t = Utils.getImageSizeByUrl(e.get("thumbnail").original.url);
                    var i = Utils.getArrayBufferFromUrl(e.get("thumbnail").original.url);
                    var r = m.all([ t, i ]).spread(function(t, i) {
                        return {
                            array: i,
                            format: e.get("mimeType").replace("image/", ""),
                            width: t.width,
                            height: t.height
                        };
                    });
                    n.push(r);
                });
                m.all(n).then(function(e) {
                    e.each(function(e, i) {
                        r.blockui("Saving page " + (i + 1));
                        t.text(0, 0, "");
                        t.addPage(e.width, e.height);
                        var n = "page" + i;
                        t.addImage(e.array, e.format, 0, 0, e.width, e.height, n);
                        delete e.array;
                    });
                    t.deletePage(1);
                    try {
                        t.save();
                    } catch (i) {
                        r.error("Can't save PDF document.");
                        throw i;
                    }
                }).then(function() {
                    e.showAlertAboutSavedFiles();
                }).fail(function(e) {
                    console.error("Error happened", e);
                }).done(function() {
                    r.unblockui();
                });
            },
            saveMultiple: function(e) {
                s.push(P, "DownloadAllClicked", this.workingList.size());
                var t = this.isWorkingListContainsPDF();
                var i = S.isPaid();
                if (!(t || i)) {
                    this.unpaid("too_many_files");
                } else {
                    var n = this;
                    this.showAlertAboutPopups().then(this.showAlertAboutAlotOfFiles.bind(this)).then(function() {
                        s.push(P, "FilesDownloaded", n.workingList.size());
                        var e = function(e) {
                            var t = function(t) {
                                return function() {
                                    var i = function(e, i) {
                                        var n = Utils.resizeImage(e, undefined, {
                                            width: i.resize ? i.resize.width : t.get("metadata") && t.get("metadata").preview && t.get("metadata").preview.Width,
                                            height: i.resize ? i.resize.height : t.get("metadata") && t.get("metadata").preview && t.get("metadata").preview.Height,
                                            orientation: t.get("metadata") && t.get("metadata").preview && t.get("metadata").preview.Orientation || 1
                                        });
                                        return n.then(function(e) {
                                            return new Blob([ e.arraybuffer ]);
                                        });
                                    };
                                    if (t.get("decodingParams").selectedSourceSegment === O) {
                                        return i(t.get("thumbnail").original.url, e).then(function(e) {
                                            var t = URL.createObjectURL(e);
                                            var i = {
                                                browser: "Safari",
                                                type: "image/jpeg"
                                            };
                                            return [ Utils.getBlobFromUrl(t, i), t ];
                                        }).spread(function(i, n) {
                                            var r = e;
                                            r.fileName = t.get("name");
                                            r.doNotShowDialog = true;
                                            r.multiple = true;
                                            r.blob = i;
                                            r.blobUrl = n;
                                            r.removeBlobAfterSave = v.browser.family !== "Safari";
                                            s.push(P, "FileDownloaded", t.get("mimeType"));
                                            editor.getPlugin("saver").open(r);
                                        }).fail(function(e) {
                                            console.error(e);
                                            r.error(y.CANT_CONVERT_FILE);
                                        });
                                    } else {
                                        n.drawOriginalData(t.get("thumbnail"));
                                        var a = e;
                                        a.fileName = t.get("name");
                                        a.doNotShowDialog = true;
                                        a.multiple = true;
                                        delete a.blob;
                                        editor.getPlugin("saver").open(a);
                                        return;
                                    }
                                };
                            };
                            var i = [];
                            for (var a = 0; a < n.workingList.size(); a++) {
                                var o = n.workingList.at(a);
                                if (o.get("thumbnail")) {
                                    i.push(t(o));
                                }
                            }
                            return i.reduce(m.when, m(0)).then(function() {
                                n.showAlertAboutSavedFiles();
                            });
                        };
                        return editor.getPlugin("saver").open({
                            multiple: true,
                            optionsInsteadOfSaving: true,
                            optionsInsteadOfSavingCallback: e,
                            hideSaveToDriveOption: true
                        });
                    });
                }
            },
            getUrlFromCanvas: function() {
                var e = this.getSelectedDescriptor();
                var t = m.defer();
                editor.canvas.save({
                    notSave: true,
                    fileName: e.get("name"),
                    mimeType: "image/jpg",
                    quality: 85,
                    resize: {
                        width: 1024,
                        smartResize: true
                    }
                }, t.resolve);
                return t.promise;
            }
        };
    };
    return R;
});

(function(e, t) {
    var i = e.document, n;
    var n = function(e, t, i, n, r, a) {
        if (window.indexedDB && a !== false) {
            var o = e, s = this, l = a;
            var c = {
                snapshot: "snapshot",
                bigData: "bigdata"
            };
            if (indexedDB && r) {
                var u = indexedDB.deleteDatabase(o);
                u.onsuccess = function() {
                    f();
                    console.timeEnd("db");
                    console.time("dbOpen");
                };
                u.onerror = function() {
                    console.log("db fail");
                };
                u.onblocked = n;
            } else if (indexedDB) {
                f.call(this);
            }
            var f = function() {
                var e = indexedDB.open(o, 2);
                e.onupgradeneeded = function(e) {
                    var t = e.target.result;
                    for (var i in c) {
                        if (!t.objectStoreNames.contains(c[i])) {
                            t.createObjectStore(c[i]);
                        }
                    }
                };
                e.onsuccess = function(e) {
                    console.timeEnd("dbOpen");
                    s.db = e.target.result;
                    s.table = c;
                    t && t.call(s, e);
                    console.log("DB created");
                };
                e.onerror = function(e) {
                    console.log("fail on load");
                };
            };
        } else {
            t.call(this);
        }
    };
    n.prototype.saveSnapshot = function(e, t, i, n) {
        try {
            var r = this.db.transaction([ this.table.snapshot ], "readwrite");
            var a = r.objectStore(this.table.snapshot);
            var o = a.add(e, n || Date.now());
            o.onsuccess = t;
            o.onerror = i;
        } catch (s) {
            t();
        }
    };
    n.prototype.saveImage = function(e, t, i, n) {
        try {
            var r = this.db.transaction([ this.table.bigData ], "readwrite");
            var a = r.objectStore(this.table.bigData);
            var o = a.add(e, t);
            o.onsuccess = i;
            o.onerror = n;
        } catch (s) {
            i(s);
        }
    };
    n.prototype.getImageChunks = function(e, t) {
        try {
            var i = this.db.transaction([ this.table.bigData ], "readwrite");
            var n = i.objectStore(this.table.bigData);
            var r = n.openCursor(null, "next");
            r.onsuccess = e;
            r.onerror = t;
            var a = n.count();
            a.onsuccess = function(e) {
                console.log("count:" + e.target.result);
            };
        } catch (o) {
            e();
        }
    };
    n.prototype.getSnapshot = function(e, t) {
        try {
            var i = this.db.transaction([ this.table.snapshot ], "readwrite");
            var n = i.objectStore(this.table.snapshot);
            var r = n.get(e);
            r.onsuccess = function(e) {
                t(e);
            };
            r.onerror = function(e) {
                console.log("Error Getting: ", e);
            };
        } catch (a) {
            t();
        }
    };
    n.prototype.removeSnapshot = function(e) {
        try {
            var t = this.db.transaction([ this.table.snapshot ], "readwrite");
            var i = t.objectStore(this.table.snapshot);
            var n = i.delete(e);
            n.onsuccess = function(e) {};
            n.onerror = function(e) {
                console.log("Error Getting: ", e);
            };
        } catch (r) {}
    };
    n.prototype.cleanSnapshots = function() {
        return;
    };
    n.prototype.count = function(e, t) {
        try {
            var i = this.db.transaction([ this.table[e] ], "readwrite");
            var n = i.objectStore(this.table[e]);
            var r = n.count();
            r.onsuccess = function(e) {
                t && t(e.target.result);
            };
        } catch (a) {
            t(0);
        }
    };
    n.prototype.destroy = function() {
        try {
            indexedDB.deleteDatabase(db);
        } catch (e) {}
    };
    n.prototype.close = function() {
        try {
            this.db.close();
        } catch (e) {}
    };
    if (typeof define === "function") {
        define("indexeddb", [], function() {
            return n;
        });
    } else {
        if (typeof e.IndexedDb === "undefined") {
            e.IndexedDb = n;
        }
    }
})(this);

define("slicer", [], function(e) {
    const t = 4;
    var i = function() {
        this.sliceRGBA = function(e, i) {
            var n = e.height, r = e.width, a = r * i * t, o = e.data.length, s = 0, l = a, c = [];
            while (o > l - a > 0) {
                var u = e.data.subarray(s, l);
                if (u.constructor === Float32Array) {
                    var f = new Float32Array(u.length);
                } else if (u.constructor === Uint8ClampedArray) {
                    var f = new Uint8ClampedArray(u.length);
                }
                f.set(u);
                c.push({
                    data: f,
                    width: r,
                    height: u.length / r / 4
                });
                s += a;
                l += a;
            }
            return c;
        };
        this.sliceToSave = function(e) {
            var t = e.width, i = 3 * Math.pow(10, 7), n = e.data.length, r = 0, a = i, o = [];
            while (n > a - i > 0) {
                var s = e.data.subarray(r, a);
                var l = new Uint8ClampedArray(s.length);
                l.set(s);
                o.push({
                    data: l
                });
                r += i;
                a += i;
            }
            return o;
        };
    };
    return new i();
});

define("config", [], function() {
    var e = {
        toolbars: {
            left: [],
            topLeft: [ {
                type: "icon",
                action: "undo",
                tooltip: [ "Undo", "Redo" ]
            }, {
                type: "menu",
                title: "&#64257;le",
                items: [ {
                    type: "text",
                    action: "openFile"
                }, {
                    type: "text",
                    action: "saver"
                }, {
                    type: "text",
                    action: "xmp"
                }, {
                    type: "text",
                    action: "hotkeys"
                } ]
            }, {
                type: "icon",
                action: "colorGetter",
                tooltip: "Color"
            }, {
                type: "icon",
                action: "colorpicker",
                tooltip: "Color picker"
            } ],
            topRight: [ {
                id: "adjustments",
                type: "icon",
                action: "externalCaller",
                tooltip: "Adjustments",
                classList: [ "act" ],
                className: "iconEdit_adjustments",
                caller: function() {
                    e.btnAdjustmentsHandlers.toggle();
                }
            }, {
                type: "html",
                tag: "li",
                html: "",
                classList: [ "smallImgInfo" ]
            }, {
                type: "icon",
                action: "about",
                tooltip: "About Edit.pics.io"
            }, {
                type: "icon",
                action: "externalCaller",
                className: "iconEdit_exit",
                tooltip: "Close",
                caller: function() {
                    if (window.location.hostname != "pics.io") {
                        window.location = "http://edit.pics.io/online-photo-editor";
                    } else {
                        window.Backbone.history.navigate("catalog", {
                            trigger: true
                        });
                    }
                }
            } ]
        },
        converter: {
            RAW_PER_SLICE: 900
        },
        drawingImageSize: {
            width: 2500,
            height: 2500,
            orientation: 1
        },
        canvas: {
            padding: 100,
            dragable: true,
            zoom: true
        },
        reinit: {
            changeTransform: true
        },
        ui: {
            canvasContainer: "#picsEdit-canvas",
            toolbarContainer: {
                topLeft: "#firstPicsioToolbar ul",
                topRight: "#secondPicsioToolbar ul",
                left: "#thirdPicsioToolbar ul",
                fourth: "#fourthPicsioToolbar ul",
                fifth: "#fifthPicsioToolbar ul",
                sixth: "#sixthPicsioToolbar ul"
            }
        },
        btnAdjustmentsHandlers: {
            show: function() {
                this.toggle(true);
            },
            hide: function() {
                this.toggle(false);
            },
            toggle: function(t) {
                var i = e.ui.toolbarContainer.topRight, n = document.getElementById("rightSidebarEditorAdjustments"), r = document.getElementById("rightSidebarEditorPresets"), a = document.querySelector(i + " #adjustments"), o = document.querySelector(i + " #presets");
                n && (t ? n.classList.add("show") : t === false ? n.classList.remove("show") : n.classList.toggle("show"));
                t ? a.classList.add("act") : t === false ? a.classList.remove("act") : a.classList.toggle("act");
                r && r.classList.remove("show");
                o && o.classList.remove("act");
            }
        },
        btnPresetsHandlers: {
            show: function() {
                this.toggle(true);
            },
            hide: function() {
                this.toggle(false);
            },
            toggle: function(t) {
                var i = e.ui.toolbarContainer.topRight, n = document.getElementById("rightSidebarEditorAdjustments"), r = document.getElementById("rightSidebarEditorPresets"), a = document.querySelector(i + " #adjustments"), o = document.querySelector(i + " #presets");
                r && (t ? r.classList.add("show") : t === false ? r.classList.remove("show") : r.classList.toggle("show"));
                t ? o.classList.add("act") : t === false ? o.classList.remove("act") : o.classList.toggle("act");
                n && n.classList.remove("show");
                a && a.classList.remove("act");
            }
        }
    };
    return e;
});

define("slicedImage", [ "decode", "slicer", "config" ], function(e, t, i) {
    var n = function(n, r, a) {
        var o = r, s = a, l = i.converter.RAW_PER_SLICE;
        return {
            data: {
                slices: n,
                width: o,
                height: s
            },
            croppedData: null,
            getSlices: function() {
                return this.data;
            },
            getCroppedSlices: function() {
                return this.croppedData;
            },
            setCroppedDataFromImageData: function(e) {
                this.croppedData = this.imageDataToSlicedFloat32(e);
            },
            getCroppedData: function() {
                return this.croppedData;
            },
            getClamped8SliceList: function() {
                return this.data;
            },
            float32ToClamped8Array: function(e) {
                var t = Math.pow(2, 8) - 1;
                var i = e.data;
                var n = i.length;
                var r = new Uint8ClampedArray(n);
                while (n--) {
                    r[n] = i[n] * t;
                }
                return {
                    width: e.width,
                    height: e.height,
                    data: r
                };
            },
            getSliceList: function() {
                return this.data.slices;
            },
            copyFloat32Slices: function() {
                var e = this.data;
                var t = function(e) {
                    var t = new Float32Array(e.length);
                    t.set(e);
                    return t;
                };
                var i = [];
                for (var n = 0; n < e.slices.length; n++) {
                    i.push({
                        data: t(e.slices[n].data),
                        width: e.slices[n].width,
                        height: e.slices[n].height
                    });
                }
                return {
                    height: e.height,
                    width: e.width,
                    slices: i
                };
            },
            clone: function() {
                var e = this.data;
                var t = {
                    width: e.width,
                    height: e.height,
                    slices: []
                };
                var i = 0, n = 0;
                for (var r = 0; r < e.slices.length; r++) {
                    var a = e.slices[r];
                    var o = new Uint8ClampedArray(a.data.length);
                    o.set(a.data);
                    t.slices.push({
                        data: o,
                        width: a.width,
                        height: a.height
                    });
                    n += a.height;
                }
                i = e.slices[0].width;
                if (!t.width || !t.height) {
                    t.width = i;
                    t.height = n;
                }
                return t;
            },
            cloneCropped: function() {
                var e = this.croppedData;
                var t = {
                    width: e.width,
                    height: e.height,
                    slices: []
                };
                var i = 0, n = 0;
                for (var r = 0; r < e.slices.length; r++) {
                    var a = e.slices[r];
                    var o = new Float32Array(a.data.length);
                    o.set(a.data);
                    t.slices.push({
                        data: o,
                        width: a.width,
                        height: a.height
                    });
                    n += a.height;
                }
                i = e.slices[0].width;
                if (!t.width || !t.height) {
                    t.width = i;
                    t.height = n;
                }
                return t;
            },
            imageDataToSliced: function(e) {
                return {
                    slices: t.sliceRGBA({
                        data: e.data,
                        width: e.width,
                        height: e.height
                    }, l),
                    width: e.width,
                    height: e.height
                };
            },
            imageDataToSlicedFloat32: function(i) {
                return {
                    slices: t.sliceRGBA({
                        data: e.fromClampedArray8ToFloatArray32(i.data),
                        width: i.width,
                        height: i.height
                    }, l),
                    width: i.width,
                    height: i.height
                };
            },
            updateFromImageData: function(e) {
                this.data = this.imageDataToSliced(e);
            },
            update: function(e) {
                this.data = e;
            },
            getPixelsRange: function(e, t, i) {
                if (!r) {
                    return this.getPixel(e, t);
                } else {
                    var n = Math.ceil(i / 2), a = [], o = [];
                    for (var s = 1 - n; s < n; s++) {
                        for (var l = 1 - n; l < n; l++) {
                            o.push(this.getPixel(e + l, t + s));
                        }
                        a.push(o.slice(0));
                        o = [];
                    }
                }
                return a;
            },
            getPixel: function(e, t) {
                var i = this.data.width, n = this.data.height, r;
                var a = (t + 1) / l | 0;
                var o = i * 4 * t + e * 4 - a * l * i * 4;
                return [ this.data.slices[a].data[o], this.data.slices[a].data[o + 1], this.data.slices[a].data[o + 2], this.data.slices[a].data[o + 3] ];
            }
        };
    };
    return n;
});

define("cornerMatrix", [], function() {
    var e = {
        m: [ [ 1, 0 ], [ 0, 0 ] ],
        originalR: true,
        flipX: function() {
            var e = null;
            e = this.m[0][1];
            this.m[0][1] = this.m[0][0];
            this.m[0][0] = e;
            e = this.m[1][0];
            this.m[1][0] = this.m[1][1];
            this.m[1][1] = e;
        },
        flipY: function() {
            var e = null;
            e = this.m[0][0];
            this.m[0][0] = this.m[1][0];
            this.m[1][0] = e;
            e = this.m[0][1];
            this.m[0][1] = this.m[1][1];
            this.m[1][1] = e;
        },
        rotateC: function() {
            var e = this.findCornerCoordinate();
            this.m[e.i][e.j] = 0;
            if (e.i === 0 && e.j === 0) {
                this.m[0][1] = 1;
            } else if (e.i === 0 && e.j === 1) {
                this.m[1][1] = 1;
            } else if (e.i === 1 && e.j === 1) {
                this.m[1][0] = 1;
            } else if (e.i === 1 && e.j === 0) {
                this.m[0][0] = 1;
            }
            this.originalR = !this.originalR;
        },
        rotateA: function() {
            var e = this.findCornerCoordinate();
            this.m[e.i][e.j] = 0;
            if (e.i === 0 && e.j === 0) {
                this.m[1][0] = 1;
            } else if (e.i === 1 && e.j === 0) {
                this.m[1][1] = 1;
            } else if (e.i === 1 && e.j === 1) {
                this.m[0][1] = 1;
            } else if (e.i === 0 && e.j === 1) {
                this.m[0][0] = 1;
            }
            this.originalR = !this.originalR;
        },
        reset: function() {
            this.m = [ [ 1, 0 ], [ 0, 0 ] ];
        },
        findCornerCoordinate: function() {
            for (var e = 0; e < 2; e++) {
                for (var t = 0; t < 2; t++) {
                    if (this.m[e][t] == 1) {
                        return {
                            i: e,
                            j: t
                        };
                    }
                }
            }
        },
        getCorner: function() {
            if (this.m[0][0] == 1) {
                return "TL";
            } else if (this.m[0][1] == 1) {
                return "TR";
            } else if (this.m[1][0] == 1) {
                return "BL";
            } else if (this.m[1][1] == 1) {
                return "BR";
            }
        }
    };
    return e;
});

define("canvas", [ "signal", "utils", "slicedImage", "slicer", "cornerMatrix", "resizeImage", "config" ], function(e, t, i, n, r, a, o) {
    var s = function() {
        var t = this, s = 0, l, c = function() {
            s += 90;
            if (s === 360) s = 0;
        }, u = function() {
            s = 0;
        }, f;
        this.e = e;
        this.wasCropped = false;
        this.isCropMode = false;
        this.lastX = 0;
        this.lastY = 0;
        this.scale = 0;
        this.hScale = 1;
        this.vScale = 1;
        this.rotate = 0;
        this.isMoving = false;
        this.x = 0;
        this.y = 0;
        this.xLength = 0;
        this.yLength = 0;
        this.color = [ 255, 255, 255, 1 ];
        var d = null, h = null;
        var p = 1.01;
        var g = function() {
            var e = document.createElement("canvas");
            return e;
        };
        var m = function() {
            return S;
        };
        var v = function() {
            return S.getContext("2d");
        };
        var y = function(e) {
            if (!t.pointBelongImage({
                x: t.lastX,
                y: t.lastY
            })) return;
            var i = t.getContext();
            e.preventDefault();
            $(d).addClass("move");
            t.isMoving = true;
            t.x1 = e.pageX;
            t.y1 = e.pageY;
            t.lastX = e.offsetX || e.pageX - d.offsetLeft;
            t.lastY = e.offsetY || e.pageY - d.offsetTop;
            t.dragStart = i.transformedPoint(t.lastX, t.lastY);
            t.dragged = false;
        };
        var b = function(e) {
            var i = t.getContext();
            t.lastX = e.offsetX || e.pageX - d.offsetLeft;
            t.lastY = e.offsetY || e.pageY - d.offsetTop;
            t.dragged = true;
            if (t.dragStart) {
                var n = i.getTransform();
                var r = n.e, a = n.f;
                var o = i.transformedPoint(t.lastX, t.lastY);
                var s = o.x - t.dragStart.x;
                var l = o.y - t.dragStart.y;
                i.translate(s, l);
                t.quickDraw();
            }
        };
        var w = function(e) {
            if (t.isMoving) {
                t.xDif = e.pageX - t.x1;
                t.yDif = e.pageY - t.y1;
                t.xDifTotal += t.xDif;
                t.yDifTotal += t.yDif;
            }
            t.isMoving = false;
            $(d).removeClass("move");
            t.dragStart = null;
        };
        var C = function(e) {
            var i = t.getContext();
            var n = i.transformedPoint(t.lastX, t.lastY);
            i.translate(n.x, n.y);
            var r = Math.pow(p, e);
            t.scale = r;
            i.scale(r, r);
            i.translate(-n.x, -n.y);
            t.quickDraw();
        };
        var x = function(e) {
            if (!t.pointBelongImage({
                x: t.lastX,
                y: t.lastY
            })) return;
            var i = e.wheelDelta ? e.wheelDelta / 40 : e.detail ? -e.detail : 0;
            if (e.shiftKey) i *= 10;
            if (i) C(i);
            return e.preventDefault() && false;
        };
        var _ = function() {
            var e = t.vScale, i = t.hScale, n = t.getRotate(), r = k();
            if (!h) return;
            h.clear();
            d.height = r.height;
            d.width = r.width;
            h.resetTransform();
            t.cornerMatrix.reset();
            u();
            t.setRotate(n);
            h.clear();
            t.vScale = t.hScale = 1;
            h.scale(e, i);
            t.centerImage();
            h.drawImage(S, 0, 0);
        };
        (function(e) {
            var t, i, n, r, a, o, s, l;
            r = e.document;
            if (!(e.addEventListener && r.createEvent)) {
                return;
            }
            a = [ "resize:end", "resizeend" ].map(function(e) {
                var t;
                t = r.createEvent("Event");
                t.initEvent(e, false, false);
                return t;
            });
            n = function() {
                return a.forEach(e.dispatchEvent.bind(e));
            };
            o = function() {
                return Math.abs(+e.orientation || 0) % 180;
            };
            s = o();
            t = null;
            l = null;
            i = function() {
                t = o();
                if (t !== s) {
                    n();
                    return s = t;
                } else {
                    clearTimeout(l);
                    return l = setTimeout(n, 100);
                }
            };
            return e.addEventListener("resize", i, false);
        })(window);
        this.e.subscribe("setCanvasColor", function(e) {
            t.setColor(e.color);
        });
        this.e.subscribe("editor.execute.save", function(e) {
            t.save(e);
        });
        this.cloneContext = function(e) {
            var t = document.createElement("canvas");
            var i = t.getContext("2d");
            t.width = e.canvas.width;
            t.height = e.canvas.height;
            i.drawImage(e.canvas, 0, 0);
            return i;
        };
        this.save = function(e, r) {
            var s = function(i, n) {
                r && r({
                    blob: i,
                    name: n
                });
                !e.notSave && t.e.publish("canvas.save.blob.ready", {
                    blob: i,
                    name: n,
                    originalParams: e
                });
            };
            if (e.blob) {
                return s(e.blob, e.fileName);
            }
            var l = this.cloneContext(t.getCachedContext());
            if (t.wasResized && !t.wasCropped) {
                t.e.publish("loadingStart");
                var c = new i(n.sliceRGBA(editor.real, o.converter.RAW_PER_SLICE), editor.real.width, editor.real.height);
                editor.taskManager.executePixelOperationQueue({
                    slices: c.data,
                    queue: editor.undoManager.getQueue().slice(1)
                }, false).then(function(i) {
                    var n = t.virtualCachedDraw(i);
                    if (e.resize) {
                        n = a(n.canvas, {
                            orientation: 1,
                            width: e.resize.width,
                            height: e.resize.height,
                            smartResize: e.smartResize
                        }, "ctx");
                    }
                    n.downloadAs(e.fileName, e.mimeType, e.quality, t.cornerMatrix.getCorner(), s, e.density);
                    n = null;
                    t.e.publish("loadingFinish");
                });
            } else if (!t.wasCropped) {
                if (e.resize) {
                    var u = a(l.canvas, {
                        orientation: 1,
                        width: e.resize.width,
                        height: e.resize.height,
                        smartResize: e.smartResize
                    }, "ctx");
                    u.downloadAs(e.fileName, e.mimeType, e.quality, t.cornerMatrix.getCorner(), s, e.density);
                } else {
                    l.downloadAs(e.fileName, e.mimeType, e.quality, t.cornerMatrix.getCorner(), s, e.density);
                }
            } else if (t.wasCropped && !t.wasResized) {
                l.downloadAs(e.fileName, e.mimeType, e.quality, t.cornerMatrix.getCorner(), s, e.density);
            } else if (t.wasCropped && t.wasResized) {
                var c = new i(n.sliceRGBA(editor.real, o.converter.RAW_PER_SLICE), editor.real.width, editor.real.height);
                var l = t.getCachedContext();
                editor.taskManager.executePixelOperationQueue({
                    slices: c.data,
                    queue: editor.undoManager.getQueue().slice(1)
                }, false).then(function(i) {
                    var n = t.virtualCachedDraw(i);
                    var r = i.width / editor.getImageData().data.width;
                    var o = n.getImageData(Math.round(t.floatCoords.x * r), Math.round(t.floatCoords.y * r), Math.round(t.floatCoords.w * r), Math.round(t.floatCoords.h * r));
                    var l = document.createElement("canvas");
                    var c = l.getContext("2d");
                    l.width = o.width;
                    l.height = o.height;
                    c.putImageData(o, 0, 0);
                    if (e.resize) {
                        c = a(c.canvas, {
                            orientation: 1,
                            width: e.resize.width,
                            height: e.resize.height,
                            smartResize: e.smartResize
                        }, "ctx");
                    }
                    c.downloadAs(e.fileName, e.mimeType, e.quality, t.cornerMatrix.getCorner(), s, e.density);
                    t.e.publish("loadingFinish");
                });
            }
        };
        this.setColor = function(e) {
            t.color = e;
            t.e.publish("canvasColorChanged", {
                rgba: e
            }, true);
        };
        this.e.subscribe("canvas.rotateCw", function() {
            t.rotate();
        });
        var S = g();
        this.cornerMatrix = r;
        var k = function() {
            var e = l.parentNode;
            return {
                width: e.offsetWidth,
                height: e.offsetHeight
            };
        };
        this.create = function(e) {
            var t = document.createElement("canvas"), i = this;
            l = e.container;
            t.width = l.parentNode.offsetWidth;
            t.height = l.parentNode.offsetHeight;
            l.appendChild(t);
            d = t;
            h = t.getContext("2d");
            h.mozImageSmoothingEnabled = false;
            h.imageSmoothingEnabled = false;
            this.lastX = d.width;
            this.lastY = d.height;
            this.trackTransforms(h);
            d.addEventListener("mousemove", b, false);
            if (e.dragable !== false) {
                d.addEventListener("mousedown", y, false);
                d.addEventListener("mouseup", w, false);
                d.addEventListener("mouseout", w, false);
            }
            if (e.zoom !== false) {
                d.addEventListener("DOMMouseScroll", x, false);
                d.addEventListener("mousewheel", x, false);
            }
            f = e.padding;
            window.addEventListener("resize:end", _.bind(i), false);
        };
        this.getCanvas = function() {
            return d;
        };
        this.getContext = function() {
            return h;
        };
        this.createImageData = function(e) {
            var t = v();
            var i = t.createImageData(e.width, e.height);
            i.data.set(e.data);
            return i;
        };
        this.setScale = function(e) {
            var t = e.canvas, i = e.width, n = e.height;
            this.hScale = (t.width - f) / i;
            this.vScale = (t.height - f) / n;
        };
        this.quickDraw = function(e, t, i) {
            var n = e || 0;
            var r = t || 0;
            var i = i || m();
            this.getContext(true).clear();
            if (i instanceof ImageData) {
                this.cachedDraw({
                    width: i.width,
                    height: i.height,
                    slices: [ i ]
                });
            } else {
                this.getContext().drawImage(i, n, r);
            }
        };
        this.getRotate = function() {
            return s;
        };
        this.setRotate = function(e) {
            var t = e / 90;
            while (t) {
                this.rotate();
                t--;
            }
        };
        this.rotate = function() {
            var e = this.getContext();
            var t = e.getTransform();
            var i = this.getRelativeCenterCoordinate();
            var n = this.getRelativeImageSize();
            var r = this.getBeginOfCoordinates();
            var a;
            if (this.cornerMatrix.getCorner() == "TL") {
                a = e.transformedPoint(n.width / 2 + t.e, n.height / 2 + t.f);
                e.translate(a.x, a.y);
                e.rotate(Math.PI / 2);
                e.translate(-a.x, -a.y);
            } else if (this.cornerMatrix.getCorner() == "TR") {
                a = e.transformedPoint(t.e + n.height / 2, t.f + n.width / 2);
                e.translate(a.x, a.y);
                e.rotate(Math.PI / 2);
                e.translate(-a.x, -a.y);
            } else if (this.cornerMatrix.getCorner() == "BR") {
                a = e.transformedPoint(t.e + n.width / 2, t.f + n.height / 2);
                e.translate(a.x, a.y);
                e.rotate(Math.PI / 2);
                e.translate(-a.x, -a.y);
            } else if (this.cornerMatrix.getCorner() == "BL") {
                a = e.transformedPoint(t.e + n.height / 2, t.f + n.width / 2);
                e.translate(a.x, a.y);
                e.rotate(Math.PI / 2);
                e.translate(-a.x, -a.y);
            }
            this.quickDraw();
            this.cornerMatrix.rotateC();
            c();
        };
        this.getBeginOfCoordinates = function() {
            var e = this.getContext().getTransform();
            return {
                x: e.e,
                y: e.f
            };
        };
        this.getRelativeCenterCoordinate = function() {
            var e = this.getContext().getTransform();
            var t = this.vScale;
            var i = this.hScale;
            var n = e.e;
            var r = e.f;
            var a = this.getCachedCanvas().width;
            var o = this.getCachedCanvas().height;
            var s = a * t;
            var l = o * i;
            var c;
            if (this.cornerMatrix.getCorner() == "TL") {
                c = {
                    x: s / 2 + n,
                    y: l / 2 + r
                };
            } else if (this.cornerMatrix.getCorner() == "TR") {
                c = {
                    x: n - l / 2,
                    y: r + s / 2
                };
            } else if (this.cornerMatrix.getCorner() == "BR") {
                c = {
                    x: n - s / 2,
                    y: r - l / 2
                };
            } else if (this.cornerMatrix.getCorner() == "BL") {
                c = {
                    x: n + l / 2,
                    y: r - s / 2
                };
            }
            return c;
        };
        this.getImageCoordinates = function() {
            var e, t, i, n, r, a, o, s, l, c;
            e = this.getContext().getTransform();
            t = this.vScale;
            i = this.hScale;
            n = e.e;
            r = e.f;
            a = this.getCachedCanvas().width;
            o = this.getCachedCanvas().height;
            s = a * t;
            l = o * i;
            if (this.cornerMatrix.getCorner() === "TL") {
                c = {
                    x: n,
                    y: r,
                    width: s,
                    height: l
                };
            } else if (this.cornerMatrix.getCorner() === "TR") {
                c = {
                    x: n - l,
                    y: r,
                    width: l,
                    height: s
                };
            } else if (this.cornerMatrix.getCorner() === "BR") {
                c = {
                    x: n - s,
                    y: r - l,
                    width: s,
                    height: l
                };
            } else if (this.cornerMatrix.getCorner() === "BL") {
                c = {
                    x: n,
                    y: r - s,
                    width: l,
                    height: s
                };
            }
            return c;
        };
        this.getRelativeImageSize = function() {
            var e = this.getContext().getTransform();
            var t = this.vScale;
            var i = this.hScale;
            var n = this.getCachedCanvas().width;
            var r = this.getCachedCanvas().height;
            return {
                width: n * e.a + n * e.b,
                height: r * e.d + r * e.c
            };
        };
        this.resetCanvasTransforms = function() {
            var e = this.getContext();
            var t = e.getTransform();
            var i = e.transformedPoint(0, 0);
            e.translate(i.x, i.y);
            e.scale(1 / this.vScale, 1 / this.hScale);
        };
        this.resetScale = function() {
            var e = this.getContext();
            var i = this.getRelativeCenterCoordinate();
            var n = e.transformedPoint(i.x, i.y);
            e.translate(n.x, n.y);
            var r = t.minScale / t.vScale * 1.00000000001;
            e.scale(r, r);
            e.translate(-n.x, -n.y);
            t.vScale = t.hScale = t.minScale;
            this.centerImage();
            t.quickDraw();
        };
        this.changeScaleRelativeCenter = function() {
            t.lastX = document.body.clientWidth / 2;
            t.lastY = document.body.clientHeight / 2;
            C(1);
        };
        this.draw = function(e, i) {
            var n = e.slices, r = e.width, a = e.height, o = v(), s = m(), l = this.getContext(), c = this.getCanvas(), f = 0;
            var d = s.width / r;
            s.width = r;
            s.height = a;
            l.clear();
            l.resetTransform();
            t.cornerMatrix.reset();
            u();
            if (i) {
                this.setScale({
                    canvas: c,
                    width: r,
                    height: a
                });
                if (this.vScale < 1 && this.vScale < this.hScale) {
                    this.minScale = this.vScale;
                    this.hScale = 1;
                    this.vScale = 1;
                    l.scale(this.minScale, this.minScale);
                } else if (this.hScale < 1 && this.hScale < this.vScale) {
                    this.minScale = this.hScale;
                    this.hScale = 1;
                    this.vScale = 1;
                    l.scale(this.minScale, this.minScale);
                } else {
                    this.minScale = 1;
                    this.hScale = 1;
                    this.vScale = 1;
                }
            } else {
                this.minScale *= d;
                l.scale(d, d);
            }
            for (var h = 0; h < n.length; h++) {
                var p = this.createImageData(n[h]);
                o.putImageData(p, 0, f);
                f += p.height;
            }
            t.centerImage();
            l.drawImage(s, 0, 0);
        };
        this.fillCachedCanvas = function(e) {
            var t = m(), i = v(), n = 0, r = e.slices;
            t.width = e.width;
            t.height = e.height;
            if (e instanceof ImageData) {
                i.putImageData(e, 0, 0);
            } else {
                var a = new Uint8ClampedArray(e.width * e.height * 4);
                var o = 0;
                for (var s = 0; s < r.length; s++) {
                    a.set(r[s].data, o);
                    o += r[s].data.length;
                }
                var l = this.createImageData({
                    width: e.width,
                    height: e.height,
                    data: a
                });
                i.putImageData(l, 0, 0);
            }
            return t;
        };
        this.cachedDraw = function(e) {
            var t = this.fillCachedCanvas(e);
            this.getContext().clear();
            this.getContext().drawImage(t, 0, 0);
        };
        this.virtualCachedDraw = function(e) {
            var t = document.createElement("canvas"), i = t.getContext("2d"), n = 0, r = e.slices;
            t.width = e.width;
            t.height = e.height;
            t.width = e.width;
            t.height = e.height;
            for (var a = 0; a < r.length; a++) {
                var o = this.createImageData(r[a]);
                i.putImageData(o, 0, n);
                n += o.height;
            }
            e = null;
            return i;
        };
        this.trackTransforms = function(e) {
            var t = this;
            var i = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            e.xform = i.createSVGMatrix();
            e.getTransform = function() {
                return this.xform;
            };
            var n = [];
            var r = e.save;
            e.save = function() {
                n.push(this.xform.translate(0, 0));
                return r.call(e);
            };
            var a = e.restore;
            e.restore = function() {
                this.xform = n.pop();
                return a.call(e);
            };
            var o = e.scale;
            e.scale = function(i, n) {
                if ((t.hScale * i < t.minScale || t.vScale * n < t.minScale) && (i != -1 && n != -1)) {
                    console.log("Zoom limit reached. You can zoom between 100% and fit to screen.");
                    return;
                }
                t.hScale = t.hScale * i;
                t.vScale = t.vScale * n;
                this.xform = this.xform.scaleNonUniform(i, n);
                return o.call(e, i, n);
            };
            var s = e.rotate;
            e.rotate = function(t) {
                this.xform = this.xform.rotate(t * 180 / Math.PI);
                return s.call(e, t);
            };
            var l = e.translate;
            e.translate = function(t, i) {
                this.xform = this.xform.translate(t, i);
                return l.call(e, t, i);
            };
            var c = e.transform;
            e.transform = function(t, n, r, a, o, s) {
                var l = i.createSVGMatrix();
                l.a = t;
                l.b = n;
                l.c = r;
                l.d = a;
                l.e = o;
                l.f = s;
                this.xform = this.xform.multiply(l);
                return c.call(e, t, n, r, a, o, s);
            };
            var u = e.setTransform;
            e.setTransform = function(t, i, n, r, a, o) {
                this.xform.a = t;
                this.xform.b = i;
                this.xform.c = n;
                this.xform.d = r;
                this.xform.e = a;
                this.xform.f = o;
                return u.call(e, t, i, n, r, a, o);
            };
            var f = e.resetTransform;
            e.resetTransform = function() {
                return this.setTransform(1, 0, 0, 1, 0, 0);
            };
            var d = i.createSVGPoint();
            e.transformedPoint = function(e, t) {
                d.x = e;
                d.y = t;
                return d.matrixTransform(this.xform.inverse());
            };
        };
        this.getCachedImageData = function() {
            var e = m(), t = v();
            return t.getImageData(0, 0, e.width, e.height);
        };
        this.getCachedCanvas = function() {
            return m();
        };
        this.getCachedContext = function() {
            return v();
        };
        this.getTranformPoint = function(e, t) {
            return this.getContext().transformedPoint(e, t);
        };
        this.pointBelongImage = function(e) {
            var t = e.x, i = e.y, n = this.getRelativeImageSize(), r = this.getContext().getTransform(), a = r.e, o = r.f, s = null, l = null, c = this.cornerMatrix.getCorner();
            if (this.cornerMatrix.originalR) {
                s = a + n.width;
                l = o + n.height;
            } else {
                s = a + n.height;
                l = o + n.width;
            }
            return t >= Math.min(a, s) && t <= Math.max(a, s) && (i >= Math.min(o, l) && i <= Math.max(o, l));
        };
        this.cropPartOfImage = function(e, t) {
            return e.getImageData(t.x, t.y, t.w, t.h);
        };
        this.centerImage = function(e) {
            var i = this.vScale;
            var n = this.hScale;
            var r = t.getContext();
            var a, e = e || {};
            if (this.cornerMatrix.getCorner() === "TL") {
                var o = (e.w || this.getCachedCanvas().width) * i;
                var s = (e.h || this.getCachedCanvas().height) * n;
                var l = t.getCanvas().width;
                var c = t.getCanvas().height;
                var u = Math.round((l - o) / 2);
                var f = Math.round((c - s) / 2);
                a = r.transformedPoint(u, f);
            } else if (this.cornerMatrix.getCorner() === "TR") {
                var o = (e.h || this.getCachedCanvas().height) * i;
                var s = (e.w || this.getCachedCanvas().width) * n;
                var l = t.getCanvas().width;
                var c = t.getCanvas().height;
                var u = Math.round((l - o) / 2) + o;
                var f = Math.round((c - s) / 2);
                a = r.transformedPoint(u, f);
            } else if (this.cornerMatrix.getCorner() === "BR") {
                var o = (e.w || this.getCachedCanvas().width) * i;
                var s = (e.h || this.getCachedCanvas().height) * n;
                var l = t.getCanvas().width;
                var c = t.getCanvas().height;
                var u = Math.round((l - o) / 2) + o;
                var f = Math.round((c - s) / 2) + s;
                a = r.transformedPoint(u, f);
            } else {
                var o = (e.h || this.getCachedCanvas().height) * i;
                var s = (e.w || this.getCachedCanvas().width) * n;
                var l = t.getCanvas().width;
                var c = t.getCanvas().height;
                var u = Math.round((l - o) / 2);
                var f = Math.round((c - s) / 2) + s;
                a = r.transformedPoint(u, f);
            }
            r.translate(a.x, a.y);
        };
        this.swithOffCrop = function() {
            d.wasCropped = false;
        };
        this.resetCrop = function() {
            this.isCropMode = false;
            this.wasCropped = false;
        };
        this.setCachedCanvas = function() {
            var e = m();
        };
        this.e.subscribe("resetScale", this.resetScale.bind(t));
        this.e.subscribe("drawImageData", function(e) {
            t.cachedDraw(e);
        });
    };
    return new s();
});

define("crop", [ "signal", "canvas", "utils", "Widget" ], function(e, t, i, n) {
    var r = function() {
        var i = this;
        var r = false;
        var a, o, s, l, c, u = 0;
        var f, d, h, p, g = false;
        var m = 1;
        var v = $(window).width();
        var y = $(window).height();
        var b = 27;
        var w = 13;
        var C, x, _, S, k, A, E, T, P;
        var I;
        var O;
        var D;
        var R, L, F, M, N, B;
        var j, U, z, q;
        var W;
        var H = function(e, n) {
            I.hide();
            var r = t.getImageCoordinates();
            var a = C.getBoundingClientRect().left, o = C.getBoundingClientRect().top, s = C.getBoundingClientRect().width, l = C.getBoundingClientRect().height;
            r.x2 = r.x + r.width;
            r.y2 = r.y + r.height;
            var c = a + s;
            var u = o + l;
            var f = a;
            var d = o;
            var h = a + s;
            var p = o + l;
            var g = t.getTranformPoint(f, d);
            var m = t.getTranformPoint(h, p);
            i.pt1 = g;
            i.pt2 = m;
            var v = m.x - g.x;
            var y = m.y - g.y;
            var b = t.getImageCoordinates();
            i.lastLeft = f - b.x;
            i.lastTop = d - b.y;
            i.lastWidth = C.getBoundingClientRect().width;
            i.lastHeight = C.getBoundingClientRect().height;
            var w = e || t.getCachedContext();
            i.crop = {
                x: g.x,
                y: g.y,
                w: s / t.vScale,
                h: l / t.hScale
            };
            var x;
            var _, S, k, A;
            if (t.cornerMatrix.getCorner() == "TL") {
                _ = g.x;
                S = g.y;
                k = i.crop.w;
                A = i.crop.h;
            } else if (t.cornerMatrix.getCorner() == "TR") {
                _ = g.x;
                S = i.pt2.y;
                k = i.crop.h;
                A = i.crop.w;
            } else if (t.cornerMatrix.getCorner() == "BR") {
                _ = i.pt2.x;
                S = i.pt2.y;
                k = i.crop.w;
                A = i.crop.h;
            } else if (t.cornerMatrix.getCorner() == "BL") {
                _ = i.pt2.x;
                S = i.pt1.y;
                k = i.crop.h;
                A = i.crop.w;
            }
            t.floatCoords = {
                x: _,
                y: S,
                w: k,
                h: A
            };
            this.drawCoords = {
                x: Math.round(_),
                y: Math.round(S),
                w: Math.round(k),
                h: Math.round(A)
            };
            x = w.getImageData(this.drawCoords.x, this.drawCoords.y, this.drawCoords.w, this.drawCoords.h);
            t.centerImage(i.crop);
            W && W(t, C, x, this.drawCoords);
            t.x = g.x;
            t.y = g.y;
            t.xLength = v;
            t.yLength = y;
        };
        var G = function(i) {
            var n = editor.getImageData().getClamped8SliceList();
            t.fillCachedCanvas(n);
            var r = t.getCachedContext();
            var a = r.getImageData(i.x, i.y, i.w, i.h);
            var o = this;
            this.drawCoords = {
                x: i.x,
                y: i.y,
                w: i.w,
                h: i.h
            };
            t.floatCoords = {
                x: i.x,
                y: i.y,
                w: i.w,
                h: i.h
            };
            t.isCropMode = true;
            t.wasCropped = true;
            o.state = !o.state;
            t.centerImage(i);
            e.publish("drawImageData", a, true);
            e.publish("editor.update.imageData");
        };
        return {
            state: true,
            cropByCoords: G,
            drawCoords: undefined,
            eventHandler: null,
            attachListenersForOverlayCanvas: function(t) {
                var i = this;
                C = document.getElementById("picsEdit-selector"), x = document.getElementById("picsEdit-selector-left-top"), 
                _ = document.getElementById("picsEdit-selector-top-middle"), S = document.getElementById("picsEdit-selector-left-middle"), 
                k = document.getElementById("picsEdit-selector-right-top"), A = document.getElementById("picsEdit-selector-right-bottom"), 
                E = document.getElementById("picsEdit-selector-right-middle"), T = document.getElementById("picsEdit-selector-bottom-middle"), 
                P = document.getElementById("picsEdit-selector-left-bottom");
                _.addEventListener("mousedown", function() {
                    i.eventHandler = i.moveTCCornerHandler.bind(i);
                    document.addEventListener("mousemove", i.eventHandler);
                }, false);
                S.addEventListener("mousedown", function() {
                    i.eventHandler = i.moveLCCornerHandler.bind(i);
                    document.addEventListener("mousemove", i.eventHandler);
                }, false);
                T.addEventListener("mousedown", function() {
                    i.eventHandler = i.moveBCCornerHandler.bind(i);
                    document.addEventListener("mousemove", i.eventHandler);
                }, false);
                E.addEventListener("mousedown", function() {
                    i.eventHandler = i.moveRCCornerHandler.bind(i);
                    document.addEventListener("mousemove", i.eventHandler);
                }, false);
                x.addEventListener("mousedown", function() {
                    var e = function(e) {
                        i.moveTCCornerHandler(e);
                        i.moveLCCornerHandler(e);
                    };
                    i.eventHandler = e.bind(i);
                    document.addEventListener("mousemove", i.eventHandler);
                }, false);
                k.addEventListener("mousedown", function() {
                    var e = function(e) {
                        i.moveTCCornerHandler(e);
                        i.moveRCCornerHandler(e);
                    };
                    i.eventHandler = e.bind(i);
                    document.addEventListener("mousemove", i.eventHandler);
                }, false);
                A.addEventListener("mousedown", function() {
                    var e = function(e) {
                        i.moveBCCornerHandler(e);
                        i.moveRCCornerHandler(e);
                    };
                    i.eventHandler = e.bind(i);
                    document.addEventListener("mousemove", i.eventHandler);
                }, false);
                P.addEventListener("mousedown", function() {
                    var e = function(e) {
                        i.moveBCCornerHandler(e);
                        i.moveLCCornerHandler(e);
                    };
                    i.eventHandler = e.bind(i);
                    document.addEventListener("mousemove", i.eventHandler);
                }, false);
                C.addEventListener("mousedown", function(e) {
                    if (e.target.id === "picsEdit-selector-corner-container") {
                        N = e.clientX;
                        B = e.clientY;
                        i.eventHandler = i.moveSelectorHandler.bind(i);
                        document.addEventListener("mousemove", i.eventHandler);
                    }
                }, false);
                C.addEventListener("dblclick", i.proceedHandler.bind(i));
                document.addEventListener("mouseup", function(e) {
                    document.removeEventListener("mousemove", i.eventHandler);
                }, false);
                document.onkeydown = function(e) {
                    i.keyPressedHandler(e);
                };
                e.subscribe("editor.crop.start", function(e) {
                    W = e.callback;
                    i.startCropEventHandler();
                });
                e.subscribe("editor.crop.end", function(e) {
                    i.endCropEventHandler();
                });
                e.subscribe("restoreCrop", i.restoreCrop.bind(i));
                e.subscribe("cropByCoords", function(e) {
                    var t = e.coords;
                    i.cropByCoords(t);
                });
                e.subscribe("editor.crop.stop.crop.mode", function(e) {
                    I.hide();
                    i.stopCropModeHandler();
                });
                I = new n.ConfirmationDialog({
                    container: "#picsEdit",
                    onOk: function() {
                        i.proceedHandler();
                    },
                    onCancel: function() {
                        i.stopCropModeHandler();
                        e.publish("CloseCropMode");
                    },
                    title: "ok",
                    "class": "confirmationOk"
                });
                I.hide();
            },
            moveLCCornerHandler: function(e) {
                var i = this, n = this.config.left - e.pageX, r = t.getImageCoordinates();
                if (this.config.left - n < r.x) {
                    n = this.config.left - r.x;
                }
                if (this.config.width + n < 0) {
                    this.config.left = this.config.left + this.config.width;
                    this.config.width = 0;
                } else {
                    this.config.left = this.config.left - n;
                    this.config.width = this.config.width + n;
                }
                C.style.left = this.config.left + "px";
                C.style.width = this.config.width + "px";
            },
            moveTCCornerHandler: function(e) {
                var i = this, n = this.config.top - e.pageY, r = t.getImageCoordinates();
                if (this.config.top - n < r.y) {
                    n = this.config.top - r.y;
                }
                if (this.config.height + n < 0) {
                    this.config.top = this.config.top + this.config.height;
                    this.config.height = 0;
                } else {
                    this.config.top = this.config.top - n;
                    this.config.height = this.config.height + n;
                }
                C.style.top = this.config.top + "px";
                C.style.height = this.config.height + "px";
            },
            moveRCCornerHandler: function(e) {
                var i = this, n = e.pageX - (this.config.width + this.config.left), r = t.getImageCoordinates();
                if (this.config.width + this.config.left + n > r.width + r.x) {
                    n = r.width + r.x - (this.config.left + this.config.width);
                }
                if (this.config.width + n < 0) {
                    this.config.width = 0;
                } else {
                    this.config.width = this.config.width + n;
                }
                C.style.width = this.config.width + "px";
            },
            moveBCCornerHandler: function(e) {
                var i = this, n = e.pageY - (this.config.height + this.config.top), r = t.getImageCoordinates();
                if (this.config.height + this.config.top + n > r.height + r.y) {
                    n = r.height + r.y - (this.config.top + this.config.height);
                }
                if (this.config.height + n < 0) {
                    this.config.height = 0;
                } else {
                    this.config.height = this.config.height + n;
                }
                C.style.height = this.config.height + "px";
            },
            proceedHandler: function(e) {
                H.call(this);
                if (i.isSelectorOnImage) {
                    C.style.display = "none";
                }
                console.log("state switch");
                i.state = !i.state;
                editor.btnAdjustmentsHandlers.show();
            },
            moveSelectorHandler: function(e) {
                var i = this, n = N - e.pageX, r = B - e.pageY, a = t.getImageCoordinates();
                if (this.config.top - r < a.y) {
                    this.config.top = a.y;
                } else if (this.config.top + this.config.height - r > a.y + a.height) {
                    this.config.top = a.y + a.height - this.config.height;
                } else {
                    this.config.top = this.config.top - r;
                }
                if (this.config.left - n < a.x) {
                    this.config.left = a.x;
                } else if (this.config.left + this.config.width - n > a.x + a.width) {
                    this.config.left = a.x + a.width - this.config.width;
                } else {
                    this.config.left = this.config.left - n;
                }
                C.style.left = this.config.left + "px";
                C.style.top = this.config.top + "px";
                N = e.pageX;
                B = e.pageY;
            },
            placeSelectorAndOverlays: function() {
                var e = this;
                e.selectorWasPlaced = true;
                console.log("placeSelectorAndOverlays");
                var i = t.getImageCoordinates();
                if (!e.drawCoords) {
                    var n = e.lastTop + i.y || Math.round(t.getRelativeCenterCoordinate().y - i.height / 2);
                    var r = e.lastLeft + i.x || Math.round(t.getRelativeCenterCoordinate().x - i.width / 2);
                    var a = e.lastWidth || Math.round(i.width);
                    var o = e.lastHeight || Math.round(i.height);
                    C.style.top = n + "px";
                    C.style.left = r + "px";
                    C.style.width = a + "px";
                    C.style.height = o + "px";
                    C.style.display = "block";
                } else {
                    var s = t.getContext().getTransform();
                    var l = {
                        x: s.e,
                        y: s.f
                    };
                    if (t.cornerMatrix.getCorner() == "TL") {
                        var n = l.y + e.drawCoords.y * t.vScale;
                        var r = l.x + e.drawCoords.x * t.vScale;
                        var a = e.drawCoords.w * t.vScale;
                        var o = e.drawCoords.h * t.vScale;
                    } else if (t.cornerMatrix.getCorner() == "TR") {
                        var n = l.y + e.drawCoords.x * t.vScale;
                        var r = l.x - e.drawCoords.y * t.vScale - e.drawCoords.h * t.vScale;
                        var a = e.drawCoords.h * t.vScale;
                        var o = e.drawCoords.w * t.vScale;
                    } else if (t.cornerMatrix.getCorner() == "BR") {
                        var n = l.y - e.drawCoords.y * t.vScale - e.drawCoords.h * t.vScale;
                        var r = l.x - e.drawCoords.x * t.vScale - e.drawCoords.w * t.vScale;
                        var a = e.drawCoords.w * t.vScale;
                        var o = e.drawCoords.h * t.vScale;
                    } else if (t.cornerMatrix.getCorner() == "BL") {
                        var n = l.y - e.drawCoords.x * t.vScale - e.drawCoords.w * t.vScale;
                        var r = l.x + e.drawCoords.y * t.vScale;
                        var a = e.drawCoords.h * t.vScale;
                        var o = e.drawCoords.w * t.vScale;
                    }
                    C.style.top = n + "px";
                    C.style.left = r + "px";
                    C.style.width = a + "px";
                    C.style.height = o + "px";
                    C.style.display = "block";
                }
                this.config = {
                    left: r,
                    top: n,
                    width: a,
                    height: o
                };
            },
            startCropEventHandler: function(i) {
                var n = this;
                e.publish("resetScale", {}, true);
                I.show();
                r = !r;
                t.isCropMode = true;
                n.placeSelectorAndOverlays();
                O = t.getImageCoordinates();
            },
            stopCropModeHandler: function() {
                var e = this;
                var i = C.getBoundingClientRect();
                r = e.state;
                I.hide();
                C.style.width = "0px";
                C.style.display = "none";
                e.state = !e.state;
                e.selectorWasPlaced = false;
                t.isCropMode = false;
                t.wasCropped = false;
                editor.btnAdjustmentsHandlers.show();
            },
            endCropEventHandler: function() {
                var e = this;
                e.restoreCrop();
                I.show();
                e.placeSelectorAndOverlays();
                t.isCropMode = true;
            },
            restoreCrop: function() {
                var i = this;
                r = i.state;
                var n = C.getBoundingClientRect();
                editor.switchToSlices();
                e.publish("resetScale", {}, true);
                t.isCropMode = false;
                t.wasCropped = false;
                i.state = !i.state;
            },
            keyPressedHandler: function(e) {
                var i = this;
                var n = t.isCropMode && i.selectorWasPlaced;
                if (e.keyCode == b && n) {
                    i.state && i.stopCropModeHandler();
                } else if (e.keyCode == w && n) {
                    i.state && i.proceedHandler();
                }
            },
            swithOffCrop: function() {
                var e = this;
                if (t.isCropMode) e.stopCropModeHandler();
            },
            cropSlicedImageData: function(e, i) {
                var n = document.createElement("canvas"), r = n.getContext("2d"), a = e.slices, o = 0;
                n.width = e.width;
                n.height = e.height;
                for (var s = 0; s < a.length; s++) {
                    var l = t.createImageData(a[s]);
                    r.putImageData(l, 0, o);
                    o += l.height;
                }
                return r.getImageData(i.x, i.y, i.w, i.h);
            }
        };
    };
    return new r();
});

(function(e, t) {
    var i = {
        idbBlocked: "Editor was already opened in your browser. Please close tab with editor and reload the page",
        unsupportedFormat: "The format is unsupported. Please choose another file.",
        incorrectFileType: "The file is unsupported. Please choose another file.",
        incorrectXmpFile: "Adjustment File is not valid"
    };
    if (typeof define === "function") {
        define("lang", [], function() {
            return i;
        });
    } else {
        e.i18n = i;
    }
})(this);

define("modal", [ "Widget", "signal", "lang" ], function(e, t, i) {
    t.subscribe("dialog.alert.show", function(n) {
        t.publish("loadingFinish");
        var r = new e.Dialog({
            title: "Alert",
            text: i[n.key],
            onOk: function() {
                n.callback && n.callback();
            },
            onCancel: function() {
                n.callback && n.callback();
            }
        });
    });
});

define("undoManager", [ "signal", "utils", "indexeddb", "canvas", "q", "crop", "modal" ], function(e, t, i, n, r, a, o) {
    var s = function(n, o, s, l) {
        var c = 5;
        var u = this;
        var f = null;
        var d = [], h = [], p = 0, g = null;
        this.proceed = function() {
            if (b) {
                u.proceedUndo();
            } else {
                u.proceedRedo();
            }
        };
        this.proceedUndo = function() {
            var e = m(p);
            var i = d[e].timestamp;
            var n = function(e) {
                if (editor.canvas.isCropMode) {
                    var t = editor.canvas.virtualCachedDraw(e);
                    var i = editor.canvas.cropPartOfImage(t, a.drawCoords);
                    editor.canvas.quickDraw(0, 0, i);
                } else {
                    editor.canvas.cachedDraw(e);
                }
            };
            this.getSnapshot(i, function(i) {
                try {
                    var r = i.target.result;
                    if (p - 1 === e) {
                        u.publish("makeUndo", {
                            slices: r,
                            latest: d[p],
                            next: n
                        });
                    } else {
                        u.publish("makeUndo", {
                            slices: r,
                            queue: v(e, p),
                            latest: d[p],
                            next: n
                        });
                        u.publish("loadingFinish");
                    }
                    u.prevState();
                    u.stateListChanged();
                } catch (i) {
                    console.log(p);
                    if (p == 1) {
                        u.publish("drawUndo", {
                            slices: t.cloneSlices(g)
                        });
                        u.prevState();
                        u.stateListChanged();
                    } else {
                        var r = g;
                        var a = u.getQueue().slice(0, p - 1);
                        u.publish("makeUndo", {
                            slices: t.cloneSlices(r),
                            queue: a,
                            next: function(e) {
                                editor.canvas.cachedDraw(e);
                                u.prevState();
                                u.stateListChanged();
                            }
                        });
                    }
                }
            });
        };
        this.proceedRedo = function() {
            this.publish("makeRedo", d[p]);
        };
        var m = function(e) {
            if (e - e % c === 0) {
                return 0;
            } else if (e % c === 0) {
                return e - e % c - c;
            } else {
                return e - e % c;
            }
        };
        this.getLastSnapshotPosition = m;
        var v = function(e, t) {
            return d.slice(e + 1, t);
        };
        this.getTaskQueue = v;
        this.setTaskQueue = function(e) {
            if (d.length === 1) {
                d = d.concat(e);
                p += e.length;
            } else {
                console.warn("Imposible operation. TaskQueue is not empty.");
            }
        };
        this.nextState = function() {
            p++;
        };
        this.prevState = function() {
            p--;
        };
        this.undo = function() {
            var e = this;
            if (!p) return;
            if (!d[p]) {
                e.prevState();
            }
            b = true;
            e.proceed();
            return;
        };
        this.isRedoExist = function() {
            return p === d.length - 1;
        };
        this.redo = function() {
            if (this.isRedoExist()) return;
            var e = this;
            this.nextState();
            var t = d[p].title;
            b = false;
            e.proceed();
            e.stateListChanged();
        };
        this.getPosition = function() {
            return p;
        };
        this.checkSnapshot = function(e) {
            var t = p;
            return t !== 0 && t % c == 0;
        };
        this.add = function(e) {
            var t = this, i = r.defer();
            this.publish("editor.update.imageData", {
                next: function() {
                    t.checkClear();
                    t.nextState();
                    if (t.checkSnapshot(e)) {
                        var n = editor.getImageData().clone();
                        editor.hold();
                        t.saveSnapshot(n).then(function(t) {
                            var n = t.target.result;
                            e.timestamp = n;
                            d.push(e);
                            editor.unhold();
                            i.resolve(null, e);
                        }).fail(function(e) {
                            i.reject(e);
                            console.log("fail");
                        });
                    } else {
                        d.push(e);
                        i.resolve(null, e);
                    }
                },
                data: e
            });
            this.stateListChanged();
            return i.promise;
        };
        this.remove = function(e) {
            var t;
            for (var i = 0; i < d.length; i++) {
                if (d[i].title === e) {
                    t = i;
                }
            }
            if (~t) d.splice(t, 1);
            this.prevState();
            this.stateListChanged();
        };
        this.checkClear = function() {
            if (p < d.length - 1) {
                d.splice(p + 1, Number.MAX_VALUE);
                return false;
            }
            return true;
        };
        this.findPreviousOperationByTitle = function(e) {
            var t = p + 1;
            while (t--) {
                if (d[t] && d[t].title === e) {
                    return d[t];
                }
            }
            return false;
        };
        this.getQueue = function() {
            return d;
        };
        this.getQueueToJson = function() {
            var e = d.slice(1), t = [];
            for (var i = 0; i < e.length; i++) {
                var n = e[i].title;
                var r = {};
                delete e[i].title;
                delete e[i].timestamp;
                r[n] = e[i];
                t.push(r);
            }
            return t;
        };
        this.saveSnapshot = function(e, t) {
            y = y || t;
            var i = r.defer();
            r.stopUnhandledRejectionTracking();
            y.saveSnapshot(e, i.resolve, i.reject);
            return i.promise;
        };
        u.closeDb = function() {
            y.close();
        };
        this.getSnapshot = function(e, t) {
            y.getSnapshot(e, t);
        };
        this.popSnapShot = function(e) {};
        this.snapshotCount = function(e) {
            y.count(e);
        };
        this.subscribe("state.added", this.add.bind(this));
        this.subscribe("state.removed", function(e) {
            u.remove(e.title);
        });
        this.subscribe("undo", this.undo.bind(this));
        this.subscribe("redo", this.redo.bind(this));
        this.reset = function(e) {
            var t = r.defer();
            d.splice(0, Number.MAX_VALUE);
            p = 0;
            if (!e) return;
            u.saveSnapshot(e.clone()).then(function(e) {
                var i = e.target.result;
                d.push({
                    timestamp: i
                });
                t.resolve();
                console.log("resave");
            }).fail(function(e) {
                t.reject();
                console.log("fail");
            });
            return t.promise;
        };
        this.storeNoIndexdb = function(e) {
            g = e;
        };
        var y = new i(s || "picsEdit3", function() {
            picsEdit.db = this;
            var t = n.clone();
            u.saveSnapshot(t, this).then(function(t) {
                var i = t.target.result;
                d.push({
                    timestamp: i
                });
                o && o(y);
                e.publish("loadingFinish");
            }).fail(function(i) {
                console.log("Indexeddb works incorrect. Please see error below");
                console.log(i);
                u.storeNoIndexdb(t);
                e.publish("loadingFinish");
            });
        }, function(e) {
            console.log("Fail on opening");
        }, function(t) {
            e.publish("dialog.alert.show", {
                key: "idbBlocked",
                callback: function() {
                    location.reload();
                }
            });
        }, true, l);
        var b = false;
        this.stateListChanged = function() {
            u.publish("state.list:changed", {
                currentPosition: this.getPosition(),
                length: d.length - 1
            });
        };
    };
    s.extend = function(e, i) {
        var n = this;
        var r;
        if (e && hasOwnProperty.call(e, "constructor")) {
            r = e.constructor;
        } else {
            r = function() {
                return n.apply(this, arguments);
            };
        }
        t.mixin(r, n, i);
        var a = function() {
            this.constructor = r;
        };
        a.prototype = n.prototype;
        r.prototype = new a();
        if (e) t.mixin(r.prototype, e);
        r.__super__ = n.prototype;
        return r;
    };
    return s.extend(e);
});

(function(e) {
    e.tools = e.tools || {
        version: "@VERSION"
    };
    var t;
    t = e.tools.rangeinput = {
        config: {
            min: 0,
            max: 100,
            step: "any",
            steps: 0,
            value: 0,
            precision: undefined,
            vertical: 0,
            keyboard: true,
            progress: true,
            speed: 100,
            initTemp: true,
            css: {
                input: "range",
                slider: "slider",
                progress: "progress",
                handle: "handle"
            }
        }
    };
    var i, n;
    e.fn.drag = function(t) {
        document.ondragstart = function() {
            return false;
        };
        t = e.extend({
            x: true,
            y: true,
            drag: true
        }, t);
        i = i || e(document).on("mousedown mouseup", function(r) {
            var a = e(r.target);
            if (r.type == "mousedown" && a.data("drag")) {
                var o = a.position(), s = r.pageX - o.left, l = r.pageY - o.top, c = true;
                i.on("mousemove.drag", function(e) {
                    var i = e.pageX - s, r = e.pageY - l, o = {};
                    if (t.x) {
                        o.left = i;
                    }
                    if (t.y) {
                        o.top = r;
                    }
                    if (c) {
                        a.trigger("dragStart");
                        c = false;
                    }
                    if (t.drag) {
                        a.css(o);
                    }
                    a.trigger("drag", [ r, i ]);
                    n = a;
                });
                r.preventDefault();
            } else {
                try {
                    if (n) {
                        n.trigger("dragEnd");
                    }
                } finally {
                    i.off("mousemove.drag");
                    n = null;
                }
            }
        });
        return this.data("drag", true);
    };
    function r(e, t) {
        var i = Math.pow(10, t);
        return Math.round(e * i) / i;
    }
    function a(e, t) {
        var i = parseInt(e.css(t), 10);
        if (i) {
            return i;
        }
        var n = e[0].currentStyle;
        return n && n.width && parseInt(n.width, 10);
    }
    function o(e) {
        var t = e.data("events");
        return t && t.onSlide;
    }
    function s(t, i) {
        var n = this, s = i.css, l = e("<div><div/><a href='#'/></div>").data("rangeinput", n), c, u, f, d, h;
        t.before(l);
        var p = l.addClass(s.slider).css("background-image", i.bgProgress).find("a").addClass(s.handle).css("background-color", i.bgRangeHandle), g = l.find("div").addClass(s.progress);
        if (i.progress === false) {
            l.find("div").css("display", "none");
        }
        e.each("min,max,step,value".split(","), function(e, n) {
            var r = t.attr(n);
            if (parseFloat(r)) {
                i[n] = parseFloat(r, 10);
            }
        });
        var m = i.max - i.min, v = i.step == "any" ? 0 : i.step, y = i.precision;
        if (y === undefined) {
            y = v.toString().split(".");
            y = y.length === 2 ? y[1].length : 0;
        }
        if (t.attr("type") == "range") {
            var b = t.clone().wrap("<div/>").parent().html(), w = e(b.replace(/type/i, "type=text data-orig-type"));
            w.val(i.value);
            t.replaceWith(w);
            t = w;
            t.on("keydown", function(e) {
                var t = e.keyCode === 8;
                var i = e.keyCode === 13;
                var n = e.keyCode < 48 || e.keyCode > 57;
                if (n && !t && !i) {
                    console.log("only numbers, enter and backspace");
                    e.preventDefault();
                }
            });
        }
        t.addClass(s.input);
        var C = e(n).add(t), x = true;
        function _(e, a, o, s) {
            if (o === undefined) {
                o = a / d * m;
            } else if (s) {
                o -= i.min;
            }
            if (v) {
                o = Math.round(o / v) * v;
            }
            if (a === undefined || v) {
                a = o * d / m;
            }
            if (isNaN(o)) {
                return n;
            }
            a = Math.max(0, Math.min(a, d));
            o = a / d * m;
            if (s || !c) {
                o += i.min;
            }
            if (c) {
                if (s) {
                    a = d - a;
                } else {
                    o = i.max - o;
                }
            }
            o = r(o, y);
            var l = e.type == "click";
            if (u !== undefined && !l) {
                e.type = "onSlide";
                u != o && C.trigger(e, [ o, a ]);
                if (e.isDefaultPrevented()) {
                    return n;
                }
            }
            var f = l ? i.speed : 0, b = l ? function() {
                e.type = "change";
                C.trigger(e, [ o ]);
            } : null;
            if (c) {
                p.animate({
                    top: a
                }, f, b);
                if (i.progress) {
                    g.animate({
                        height: d - a + p.height() / 2
                    }, f);
                }
            } else {
                p.animate({
                    left: a
                }, f, b);
                if (i.progress) {
                    if (i.initTemp === true) {
                        i.initTemp = false;
                        i.initWidth = a === 0 ? a : a + 3 + p.width() / 2;
                        if (a === 0) {
                            g.addClass("progressRadius");
                        }
                        g.css({
                            left: i.initWidth
                        });
                    }
                    var w = a + p.width() / 2 - i.initWidth;
                    if (w < 0) {
                        w *= -1;
                        g.css({
                            width: w,
                            left: a + p.width() / 2
                        });
                    } else {
                        g.css({
                            width: w,
                            left: i.initWidth
                        });
                    }
                }
            }
            u = o;
            h = a;
            t.val(o);
            return n;
        }
        e.extend(n, {
            getValue: function() {
                return u;
            },
            setValue: function(t, i) {
                S();
                return _(i || e.Event("api"), undefined, t, true);
            },
            getconfig: function() {
                return i;
            },
            getProgress: function() {
                return g;
            },
            getHandle: function() {
                return p;
            },
            getInput: function() {
                return t;
            },
            step: function(t, r) {
                r = r || e.Event();
                var a = i.step == "any" ? 1 : i.step;
                n.setValue(u + a * (t || 1), r);
            },
            stepUp: function(e) {
                return n.step(e || 1);
            },
            stepDown: function(e) {
                return n.step(-e || -1);
            }
        });
        e.each("onSlide,change".split(","), function(t, r) {
            if (e.isFunction(i[r])) {
                e(n).on(r, i[r]);
            }
            n[r] = function(t) {
                if (t) {
                    e(n).on(r, t);
                }
                return n;
            };
        });
        p.drag({
            drag: false
        }).on("dragStart", function() {
            S();
            x = o(e(n)) || o(t);
        }).on("drag", function(e, i, n) {
            if (t.is(":disabled")) {
                return false;
            }
            _(e, c ? i : n);
        }).on("dragEnd", function(e) {
            if (!e.isDefaultPrevented()) {
                e.type = "change";
                C.trigger(e, [ u ]);
            }
        }).click(function(e) {
            return e.preventDefault();
        });
        l.click(function(e) {
            if (t.is(":disabled") || e.target == p[0]) {
                return e.preventDefault();
            }
            S();
            var i = c ? p.height() / 2 : p.width() / 2;
            _(e, c ? d - f - i + e.pageY : e.pageX - f - i);
        });
        if (i.keyboard) {
            t.keydown(function(i) {
                if (t.attr("readonly")) {
                    return;
                }
                var r = i.keyCode, a = e([ 75, 76, 38, 33, 39 ]).index(r) != -1, o = e([ 74, 72, 40, 34, 37 ]).index(r) != -1;
                if ((a || o) && !(i.shiftKey || i.altKey || i.ctrlKey)) {
                    if (a) {
                        n.step(r == 33 ? 10 : 1, i);
                    } else if (o) {
                        n.step(r == 34 ? -10 : -1, i);
                    }
                    return i.preventDefault();
                }
            });
        }
        t.blur(function(t) {
            var i = e(this).val();
            if (i !== u) {
                n.setValue(i, t);
            }
        });
        e.extend(t[0], {
            stepUp: n.stepUp,
            stepDown: n.stepDown
        });
        function S() {
            c = i.vertical || a(l, "height") > a(l, "width");
            if (c) {
                d = a(l, "height") - a(p, "height");
                f = l.offset().top + d;
            } else {
                d = a(l, "width") - a(p, "width");
                f = l.offset().left;
            }
        }
        function k() {
            S();
            n.setValue(i.value !== undefined ? i.value : i.min);
        }
        k();
        if (!d) {
            e(window).load(k);
        }
    }
    e.expr[":"].range = function(t) {
        var i = t.getAttribute("type");
        return i && i == "range" || !!e(t).filter("input").data("rangeinput");
    };
    e.fn.rangeinput = function(i) {
        if (this.data("rangeinput")) {
            return this;
        }
        i = e.extend(true, {}, t.config, i);
        var n;
        this.each(function() {
            var t = new s(e(this), e.extend(true, {}, i));
            var r = t.getInput().data("rangeinput", t);
            n = n ? n.add(r) : r;
        });
        return n ? n : this;
    };
})(jQuery);

define("rangeslider", [ "jquery" ], function() {});

define("ui", [ "uiObject" ], function(e) {
    var t = e.extend({
        initialize: function() {
            this.logo = '<img src="{1}" />'.assign(this.config.logoSrc || "assets/img/logo_edit.gif");
            this.render();
            var e = this.config.container;
            e.style.height = "100%";
            e.style.position = "relative";
            e.style.overflow = "hidden";
        },
        template: [ '<div id="picsEdit" class="picsioEditor">', '<div id="rightSidebarEditorAdjustments" class="show"></div>', '<div id="rightSidebarEditorPresets">', '<span class="titleRightSidebar">Preset filters</span>', '<span class="contentRightSidebar"></span>', "</div>", '<div id="picsEdit-spiner" class="picsioEditor-spiner"></div>', '<a href="#" class="logoPicsioEditor"></a>', '<div id="firstPicsioToolbar" class="picsioToolbar"><ul></ul></div>', '<div id="secondPicsioToolbar" class="picsioToolbar"><ul></ul></div>', '<div id="thirdPicsioToolbar" class="picsioToolbar"><ul></ul></div>', '<div id="fourthPicsioToolbar" class="picsioToolbar"><ul></ul></div>', '<div id="fifthPicsioToolbar" class="picsioToolbar"><ul></ul></div>', '<div id="sixthPicsioToolbar" class="picsioToolbar"><ul></ul></div>', '<div class="bgTopToolbars"></div>', '<div id="picsEdit-canvas"></div>', '<div id="picsEdit-selector">', '<div class="picsEditCropTopOverlay"></div>', '<div id="picsEdit-selector-corner-container">', '<div id="picsEdit-selector-left-top"></div>', '<div id="picsEdit-selector-top-middle"></div>', '<div id="picsEdit-selector-left-middle"></div>', '<div id="picsEdit-selector-right-top"></div>', '<div id="picsEdit-selector-right-middle"></div>', '<div id="picsEdit-selector-bottom-middle"></div>', '<div id="picsEdit-selector-right-bottom"></div>', '<div id="picsEdit-selector-left-bottom"></div>', '<div class="picsEditCropHorizontalLine_top"></div>', '<div class="picsEditCropHorizontalLine_bottom"></div>', '<div class="picsEditCropVerticalLine_left"></div>', '<div class="picsEditCropVerticalLine_right"></div>', '<div class="picsEditCropBottomOverlay"></div>', "</div>", "</div>", "</div>", '<div class = "picsEdit-GradientFilter"></div>', "</div>" ].join(""),
        find: function(e) {
            return $("#picsEdit").find(e);
        },
        findNodes: function(e) {
            var t = {};
            for (var i in e) {
                t[i] = $("#picsEdit").find(e[i]);
            }
            return t;
        },
        getToolbarContainers: function(e) {
            if (e) {
                return $("#" + e + "PicsioToolbar ul");
            } else {
                return {
                    topLeft: $("#firstPicsioToolbar ul"),
                    topRight: $("#secondPicsioToolbar ul"),
                    left: $("#thirdPicsioToolbar ul"),
                    fourth: $("#fourthPicsioToolbar ul"),
                    fifth: $("#fifthPicsioToolbar ul"),
                    sixth: $("#sixthPicsioToolbar ul")
                };
            }
        }
    });
    return t;
});

(function(e, t) {
    if (typeof define === "function" && define.amd) {
        define("WW", [ "q" ], t);
    } else {
        e.WW = t(e.Q);
    }
})(this, function(e) {
    var t = function(e, t) {
        this.data = null;
        this._workers = [];
        this._promises = [];
        this._options = t || {};
        this._createWorkers(this._options.length);
    };
    t.prototype._createWorkers = function(t) {
        var i = this.getWorkerSource();
        for (var n = 0; n < t; n++) {
            var r = new Blob([ i ], {
                type: "text/javascript"
            });
            var a = URL.createObjectURL(r);
            var o = new Worker(a);
            var s = e.defer();
            o.onmessage = function(e) {
                return function(t) {
                    e.resolve(t.data);
                };
            }(s);
            o.onerror = s.reject;
            this._workers.push(o);
            this._promises.push(s.promise);
        }
    };
    t.prototype.destroyWorkers = function() {
        this._workers.forEach(function(e) {
            this._workers.forEach(function(e) {
                e.terminate();
            });
        }.bind(this));
        this._promises.length = 0;
        this._workers.length = 0;
    };
    t.prototype.getWorkerSource = function() {
        return "self.onmessage = function(e){ 			var result = ( 			" + this._options.fn.toString() + ")(e.data); 			self.postMessage(result, [result.data.buffer]); 		};";
    };
    t.prototype._getWorkers = function() {
        return this._workers;
    };
    t.prototype.map = function(t, i) {
        this.data = t;
        Object.merge(this._options, i);
        var n = this._options.bufferRef;
        this.data.forEach(function(e, t) {
            var i = [ e ];
            var r = this._workers[t];
            n && i.push([ n[t] ]);
            r.postMessage.apply(r, i);
        }.bind(this));
        return e.all(this._promises);
    };
    t.prototype.continue = function() {
        this._promises.forEach(function(t, i) {
            var n = e.defer();
            var r = this._workers[i];
            r.onmessage = function(e) {
                n.resolve(e.data);
            };
            r.onerror = n.reject;
            this._promises[i] = n.promise;
        }.bind(this));
    };
    return t;
});

define("taskManager", [ "utils", "signal", "canvas", "slicedImage", "converter", "crop", "q", "WW" ], function(e, t, i, n, r, a, o, s) {
    var l = function() {
        this.slicedImage = n;
        this.e = t;
        this.started = false;
        this.task = [];
        var i = this;
        var s = function(e, i) {
            var n = 1 - e / i;
            t.publish("progressSet", {
                value: n * 100
            });
        };
        var l = function(t) {
            var i = e.cloneSlices(t);
            editor.getImageData().update(i);
        };
        var c = function(e, t) {
            t && t(e);
        };
        var u = function(e, t, i) {
            if (i) {
                l(e);
            }
            c(e, t);
        };
        this.execute = function(e, t) {
            var i = this, n = o.defer();
            if (!i.started) {
                i.startSingleTask(e, t).then(n.resolve);
            } else {
                i.task[0] = {
                    cb: e,
                    params: t
                };
            }
            return n.promise;
        };
        this.taskDictionary = {
            worker: function(e, i) {
                console.time("init time");
                var n = this;
                var r = editor.getPlugin(i.title);
                var s = r.getRunningMode();
                var l = function(e) {
                    t.publish("progressSet", {
                        value: e * 100
                    });
                };
                var c = o.defer();
                var u = r.getWorker();
                var f = editor.getImageData();
                var d = f.clone();
                var h = r.prepare(d.slices, i);
                u.map(h, {
                    bufferRef: h.map(function(e) {
                        return e.data.buffer;
                    })
                }).then(function(e) {
                    n.started = false;
                    var i = {
                        width: d.width,
                        height: d.height,
                        slices: e
                    };
                    if (editor.canvas.wasCropped) {
                        i = a.cropSlicedImageData(i, a.drawCoords);
                    }
                    t.publish("drawImageData", i, true);
                    d = null;
                    u.continue();
                    if (n.task.length) {
                        var r = n.task.pop();
                        n.startSingleTask(r.cb, r.params);
                    } else {
                        n.started = false;
                        c.resolve();
                    }
                }).catch(function() {
                    console.error("worker.map");
                });
                return c.promise;
            },
            mainThread: function(e, t) {
                var n = editor.getPlugin(t.title);
                e.apply(n, []);
                i.started = false;
                return o.resolve();
            }
        };
        this.startSingleTask = function(e, t) {
            var i = this, n = editor.getPlugin(t.title), r = n.getRunningMode(), a = o.defer();
            i.started = true;
            i.taskDictionary[r].apply(i, arguments).then(a.resolve);
            return a.promise;
        };
        this.executeMultiTaskQueue = function(e, i) {
            if (typeof i != "boolean") i = true;
            var n = e.next;
            delete e.next;
            var r = e.queue, a = e.slices, o = e.latest, f, d = this, h, p = function(e, t) {
                var r = e.shift();
                var a = editor.getPlugin(r.title), o = a.apply;
                s(e.length, f);
                if (a.isStateOperation()) {
                    if (e.length) {
                        p(e, t);
                        h = null;
                    } else {
                        u(t, n, i);
                    }
                    return;
                }
                var d = a.prepare(t.slices, r);
                var h = new Parallel(d);
                h.map(o).then(function(r) {
                    for (var a = 0; a < r.length; a++) {
                        delete r[a].params;
                    }
                    if (e.length) {
                        p(e, t);
                        h = null;
                    } else {
                        var o = {
                            width: t.width,
                            height: t.height,
                            slices: r
                        };
                        if (i) {
                            l(o);
                        }
                        c(t, n);
                    }
                });
            }, g = function(e) {
                var t = editor.getPlugin(e.title);
                t.apply.call(t, [ true ]);
            };
            if (!e.queue) {
                var m = editor.getPlugin(o.title);
                if (o && m.isStateOperation()) {
                    g(o);
                }
                u(a, n, i);
                return;
            }
            if (r.length) {
                f = r.length;
                t.publish("progressStart");
                var m = editor.getPlugin(o.title);
                if (o && m.isStateOperation()) {
                    s(0, r.length);
                    g(o);
                } else {
                    p(r, a);
                }
            } else {
                n && n(a);
            }
        };
        this.executePixelOperationQueue = function(e) {
            var i = e.next;
            var n = o.defer();
            delete e.next;
            var r = e.queue, a = e.slices, l, c = this, f, d = function(e, t) {
                var i = e.shift();
                var r = editor.getPlugin(i.title), a = r.apply;
                if (r.isStateOperation()) {
                    if (e.length) {
                        d(e, t);
                        c = null;
                    } else {
                        u(t, n.resolve, false);
                    }
                    return;
                }
                s(e.length, l);
                var o = r.prepare(t.slices, i);
                var c = new Parallel(o);
                c.map(a).then(function(i) {
                    for (var r = 0; r < i.length; r++) {
                        delete i[r].params;
                    }
                    if (e.length) {
                        d(e, t);
                        c = null;
                    } else {
                        u(t, n.resolve, false);
                    }
                });
            };
            if (r.length) {
                l = r.length;
                t.publish("progressStart");
                d(r, a);
            } else {
                var h = new Parallel();
                var p = {
                    width: a.width,
                    height: a.height,
                    slices: a.slices
                };
                i && i(p);
                n.resolve(p);
            }
            return n.promise;
        };
        this.runCommand = function(n, s, l, c) {
            var u = o.defer();
            var f = editor.getImageData().clone();
            var d = n;
            var h = editor.getPlugin(d.title);
            var p = h.apply;
            var g;
            c = c === undefined || c === true ? true : false;
            if (d.coords && d.title === "redEyes") {
                var m = e.slicesListToImageData(f.slices), v = d.coords;
                var y = document.createElement("canvas"), b = y.getContext("2d");
                y.width = m.width;
                y.height = m.height;
                b.putImageData(m, 0, 0);
                var w = b.getImageData(v.x, v.y, v.w, v.h);
                temporaryImageSlices = e.cloneSlices(f);
                f = r.imageDataToSlicedFloat32(w);
            }
            var g = h.prepare(f.slices, d);
            var C = new Parallel(g);
            if (h.isStateOperation()) {
                h.apply.apply(h, [ false, d ]);
                l && l();
                u.resolve();
            } else {
                C.map(p).then(function(e) {
                    var n = {
                        width: f.width,
                        height: f.height,
                        slices: e
                    };
                    if (editor.canvas.wasCropped) {
                        n = a.cropSlicedImageData(n, a.drawCoords);
                    }
                    if (c) {
                        t.publish("drawImageData", n, true);
                    }
                    i.e.publish("editor.update.imageData");
                    C = null;
                    l && l();
                    u.resolve();
                });
            }
            return u.promise;
        };
        this.runCommandStack = function(e) {
            var t = e.queue, i = t.shift(), n = this;
            this.e.publish("loadingStart", {
                zIndex: 2,
                opacity: .95
            });
            if (i) {
                editor.undoManager.add(i).then(function() {
                    return n.runCommand(i, false);
                }).then(function() {
                    n.runCommandStack({
                        queue: t
                    });
                }).fail(function(e) {
                    console.log(e);
                });
            } else {
                this.e.publish("loadingFinish");
            }
        };
        this.getProcessedImageData = function(t, n, r, a, o) {
            if (!i.started) {
                var s = e.cloneSlices(n);
                var l = i.prepareDataToProcessing(s.slices, r);
                var c = new Parallel(l);
                c.map(t).then(a).map(e.float32ToClamped8Array).then(o);
            } else {
                i.task[0] = {
                    cb: t,
                    params: r
                };
            }
        };
        this.prepareDataToProcessing = function(t, i) {
            for (var n = 0; n < t.length; n++) {
                t[n]["params"] = e.deepCopy(i);
            }
            if (i.additionalLines) {
                for (var n = 0; n < t.length; n++) {
                    var r, a;
                    t[n]["params"].lineList = {};
                    if (n === 0) {
                        r = null;
                    } else {
                        var o = t[n - 1];
                        r = o.data.subarray(o.data.length - o.width * 4, o.data.length);
                        r = r.slice(0);
                    }
                    if (n === t.length - 1) {
                        a = null;
                    } else {
                        var s = t[n + 1];
                        a = s.data.subarray(0, s.width * 4);
                        a = a.slice(0);
                    }
                    t[n]["params"].lineList = {
                        top: r,
                        bottom: a
                    };
                }
            }
            return t;
        };
        this.e.subscribe("makeUndo", function(e) {
            i.executeMultiTaskQueue(e, true);
        });
        this.e.subscribe("makeRedo", this.runCommand.bind(this));
        this.e.subscribe("runCommandStack", this.runCommandStack.bind(this));
    };
    return new l();
});

(function(e, t) {
    if (typeof exports == "object") module.exports = t(); else if (typeof define == "function" && define.amd) define("spin", t); else e.Spinner = t();
})(this, function() {
    var e = [ "webkit", "Moz", "ms", "O" ], t = {}, i;
    function n(e, t) {
        var i = document.createElement(e || "div"), n;
        for (n in t) i[n] = t[n];
        return i;
    }
    function r(e) {
        for (var t = 1, i = arguments.length; t < i; t++) e.appendChild(arguments[t]);
        return e;
    }
    var a = function() {
        var e = n("style", {
            type: "text/css"
        });
        r(document.getElementsByTagName("head")[0], e);
        return e.sheet || e.styleSheet;
    }();
    function o(e, n, r, o) {
        var s = [ "opacity", n, ~~(e * 100), r, o ].join("-"), l = .01 + r / o * 100, c = Math.max(1 - (1 - e) / n * (100 - l), e), u = i.substring(0, i.indexOf("Animation")).toLowerCase(), f = u && "-" + u + "-" || "";
        if (!t[s]) {
            a.insertRule("@" + f + "keyframes " + s + "{" + "0%{opacity:" + c + "}" + l + "%{opacity:" + e + "}" + (l + .01) + "%{opacity:1}" + (l + n) % 100 + "%{opacity:" + e + "}" + "100%{opacity:" + c + "}" + "}", a.cssRules.length);
            t[s] = 1;
        }
        return s;
    }
    function s(t, i) {
        var n = t.style, r, a;
        i = i.charAt(0).toUpperCase() + i.slice(1);
        for (a = 0; a < e.length; a++) {
            r = e[a] + i;
            if (n[r] !== undefined) return r;
        }
        if (n[i] !== undefined) return i;
    }
    function l(e, t) {
        for (var i in t) e.style[s(e, i) || i] = t[i];
        return e;
    }
    function c(e) {
        for (var t = 1; t < arguments.length; t++) {
            var i = arguments[t];
            for (var n in i) if (e[n] === undefined) e[n] = i[n];
        }
        return e;
    }
    function u(e) {
        var t = {
            x: e.offsetLeft,
            y: e.offsetTop
        };
        while (e = e.offsetParent) t.x += e.offsetLeft, t.y += e.offsetTop;
        return t;
    }
    function f(e, t) {
        return typeof e == "string" ? e : e[t % e.length];
    }
    var d = {
        lines: 12,
        length: 7,
        width: 5,
        radius: 10,
        rotate: 0,
        corners: 1,
        color: "#000",
        direction: 1,
        speed: 1,
        trail: 100,
        opacity: 1 / 4,
        fps: 20,
        zIndex: 2e9,
        className: "spinner",
        top: "auto",
        left: "auto",
        position: "relative"
    };
    function h(e) {
        if (typeof this == "undefined") return new h(e);
        this.opts = c(e || {}, h.defaults, d);
    }
    h.defaults = {};
    c(h.prototype, {
        spin: function(e) {
            this.stop();
            var t = this, r = t.opts, a = t.el = l(n(0, {
                className: r.className
            }), {
                position: r.position,
                width: 0,
                zIndex: r.zIndex
            }), o = r.radius + r.length + r.width, s, c;
            if (e) {
                e.insertBefore(a, e.firstChild || null);
                c = u(e);
                s = u(a);
                l(a, {
                    left: (r.left == "auto" ? c.x - s.x + (e.offsetWidth >> 1) : parseInt(r.left, 10) + o) + "px",
                    top: (r.top == "auto" ? c.y - s.y + (e.offsetHeight >> 1) : parseInt(r.top, 10) + o) + "px"
                });
            }
            a.setAttribute("role", "progressbar");
            t.lines(a, t.opts);
            if (!i) {
                var f = 0, d = (r.lines - 1) * (1 - r.direction) / 2, h, p = r.fps, g = p / r.speed, m = (1 - r.opacity) / (g * r.trail / 100), v = g / r.lines;
                (function y() {
                    f++;
                    for (var e = 0; e < r.lines; e++) {
                        h = Math.max(1 - (f + (r.lines - e) * v) % g * m, r.opacity);
                        t.opacity(a, e * r.direction + d, h, r);
                    }
                    t.timeout = t.el && setTimeout(y, ~~(1e3 / p));
                })();
            }
            return t;
        },
        stop: function() {
            var e = this.el;
            if (e) {
                clearTimeout(this.timeout);
                if (e.parentNode) e.parentNode.removeChild(e);
                this.el = undefined;
            }
            return this;
        },
        lines: function(e, t) {
            var a = 0, s = (t.lines - 1) * (1 - t.direction) / 2, c;
            function u(e, i) {
                return l(n(), {
                    position: "absolute",
                    width: t.length + t.width + "px",
                    height: t.width + "px",
                    background: e,
                    boxShadow: i,
                    transformOrigin: "left",
                    transform: "rotate(" + ~~(360 / t.lines * a + t.rotate) + "deg) translate(" + t.radius + "px" + ",0)",
                    borderRadius: (t.corners * t.width >> 1) + "px"
                });
            }
            for (;a < t.lines; a++) {
                c = l(n(), {
                    position: "absolute",
                    top: 1 + ~(t.width / 2) + "px",
                    transform: t.hwaccel ? "translate3d(0,0,0)" : "",
                    opacity: t.opacity,
                    animation: i && o(t.opacity, t.trail, s + a * t.direction, t.lines) + " " + 1 / t.speed + "s linear infinite"
                });
                if (t.shadow) r(c, l(u("#000", "0 0 4px " + "#000"), {
                    top: 2 + "px"
                }));
                r(e, r(c, u(f(t.color, a), "0 0 1px rgba(0,0,0,.1)")));
            }
            return e;
        },
        opacity: function(e, t, i) {
            if (t < e.childNodes.length) e.childNodes[t].style.opacity = i;
        }
    });
    function p() {
        function e(e, t) {
            return n("<" + e + ' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">', t);
        }
        a.addRule(".spin-vml", "behavior:url(#default#VML)");
        h.prototype.lines = function(t, i) {
            var n = i.length + i.width, a = 2 * n;
            function o() {
                return l(e("group", {
                    coordsize: a + " " + a,
                    coordorigin: -n + " " + -n
                }), {
                    width: a,
                    height: a
                });
            }
            var s = -(i.width + i.length) * 2 + "px", c = l(o(), {
                position: "absolute",
                top: s,
                left: s
            }), u;
            function d(t, a, s) {
                r(c, r(l(o(), {
                    rotation: 360 / i.lines * t + "deg",
                    left: ~~a
                }), r(l(e("roundrect", {
                    arcsize: i.corners
                }), {
                    width: n,
                    height: i.width,
                    left: i.radius,
                    top: -i.width >> 1,
                    filter: s
                }), e("fill", {
                    color: f(i.color, t),
                    opacity: i.opacity
                }), e("stroke", {
                    opacity: 0
                }))));
            }
            if (i.shadow) for (u = 1; u <= i.lines; u++) d(u, -2, "progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");
            for (u = 1; u <= i.lines; u++) d(u);
            return r(t, c);
        };
        h.prototype.opacity = function(e, t, i, n) {
            var r = e.firstChild;
            n = n.shadow && n.lines || 0;
            if (r && t + n < r.childNodes.length) {
                r = r.childNodes[t + n];
                r = r && r.firstChild;
                r = r && r.firstChild;
                if (r) r.opacity = i;
            }
        };
    }
    var g = l(n("group"), {
        behavior: "url(#default#VML)"
    });
    if (!s(g, "transform") && g.adj) p(); else i = s(g, "animation");
    return h;
});

define("spinner", [ "spin" ], function(e) {
    var t = function() {
        var t = {
            lines: 5,
            length: 0,
            width: 30,
            radius: 4,
            corners: 1,
            rotate: 55,
            direction: 1,
            color: "#fff",
            speed: 1.5,
            trail: 64,
            shadow: false,
            hwaccel: false,
            className: "spinner",
            zIndex: 2e9,
            top: "auto",
            left: "auto"
        };
        var i, n = document.getElementById("picsEdit-spiner");
        return {
            start: function(r, a) {
                a = a || {};
                if (!n) n = document.getElementById("picsEdit-spiner");
                n.style.display = "block";
                n.style.zIndex = a.zIndex || 9999;
                n.style.background = "rgba(0, 0, 0, " + (a.opacity || .5) + ")";
                i = new e(t).spin(n);
            },
            finish: function() {
                n.style.display = "none";
                i && i.stop();
            }
        };
    };
    return new t();
});

define("pProgress", [ "pProgress" ], function(e) {
    var t = function() {
        var e = document.createElement("div"), t = 0, i, n = [ '<span class="pProgressValue">0</span>', '<div class="pProgressAnimation">', '<div class="pProgressAnimatedElem">', '<div class="pProgressAnimatedInner"></div>', "</div>", "</div>" ].join("");
        e.classList.add("pProgressWrapper");
        e.innerHTML = n;
        var r = e.querySelector(".pProgressAnimatedElem"), a = e.querySelector(".pProgressValue"), o = e.querySelector(".pProgressAnimation");
        var s = function(n) {
            var s = setInterval(function() {
                t++;
                if (t <= 100) {
                    a.innerHTML = t;
                    r.style.WebkitTransform = "rotate(" + t * 3.6 + "deg)";
                    r.style.MozTransform = "rotate(" + t * 3.6 + "deg)";
                    if (t === 50) {
                        if (!o.classList.contains("alreadyCenter")) {
                            o.classList.add("alreadyCenter");
                            i = e.querySelector(".pProgressAnimatedElem").cloneNode(true);
                            i.style.position = "absolute";
                            i.style.top = "0";
                            i.style.WebkitTransform = "rotate(180deg)";
                            i.style.MozTransform = "rotate(180deg)";
                            i.className = "pProgressConstantElem";
                            e.querySelector(".pProgressAnimation").appendChild(i);
                        }
                    }
                    if (t + 1 > n) {
                        clearInterval(s);
                        if (t === 100) {
                            setTimeout(l, 300);
                        }
                    }
                } else {
                    clearInterval(s);
                    setTimeout(l, 300);
                }
            }, 8);
        };
        var l = function() {
            if (e.parentNode !== null) {
                e.parentNode.removeChild(e);
            }
        };
        var c = function(e) {
            s(e);
        };
        var u = function() {
            if (i && i.parentNode) {
                i.parentNode.removeChild(i);
            }
            t = 0;
            e.querySelector(".pProgressValue").innerHTML = 0;
            r.style.WebkitTransform = "rotate(0deg)";
            r.style.MozTransform = "rotate(0deg)";
            if (o) {
                o.classList.remove("alreadyCenter");
            }
            if (e.parentNode !== null) {
                e.parentNode.removeChild(e);
            }
            document.body.appendChild(e);
        };
        return {
            start: u,
            change: c,
            finish: l
        };
    };
    return new t();
});

(function(e, t) {
    if (typeof define === "function" && define.amd) {
        define("xmp", [ "" ], t);
    } else {
        e.xmp = t(e.b);
    }
})(this, function(e) {
    var t = function() {
        var e = [ '<x:xmpmeta xmlns:x="adobe:ns:meta/" x:xmptk="Adobe XMP Core 5.5-c002 1.148022, 2012/07/15-18:06:45        ">', '<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">', '<rdf:Description rdf:about="" ', 'xmlns:crs="http://ns.adobe.com/camera-raw-settings/1.0/">', "</rdf:Description>", "</rdf:RDF>", "</x:xmpmeta>" ].join("");
        var t = {
            x: "adobe:ns:meta/",
            xmptk: "Adobe XMP Core 5.5-c002 1.148022, 2012/07/15-18:06:45        ",
            rdf: "http://www.w3.org/1999/02/22-rdf-syntax-ns#",
            tiff: "http://ns.adobe.com/tiff/1.0/",
            exif: "http://ns.adobe.com/exif/1.0/",
            xmp: "http://ns.adobe.com/xap/1.0/",
            aux: "http://ns.adobe.com/exif/1.0/aux/",
            photoshop: "http://ns.adobe.com/photoshop/1.0/",
            xmpMM: "http://ns.adobe.com/xap/1.0/mm/",
            stEvt: "http://ns.adobe.com/xap/1.0/sType/ResourceEvent#",
            dc: "http://purl.org/dc/elements/1.1/",
            crs: "http://ns.adobe.com/camera-raw-settings/1.0/"
        };
        var i = {
            value: "http://www.w3.org/1999/02/22-rdf-syntax-ns#value"
        };
        var n = {};
        var r = new DOMParser();
        var a = r.parseFromString(e, "text/xml");
        var o = a.getElementsByTagNameNS("http://www.w3.org/1999/02/22-rdf-syntax-ns#", "Description")[0];
        var s = {
            value: function(e) {
                var t = l();
                var i = a.createElement([ "rdf", "value" ].join(":"));
                i.appendChild(document.createTextNode(e));
                t.appendChild(i);
                return t;
            }
        };
        var l = function(e) {
            var i = a.createElementNS(t["rdf"], [ "rdf", "Description" ].join(":"));
            i.setAttribute("rdf:about", "");
            if (e && typeof e === "object") {
                for (var n in e) {
                    i.setAttribute([ "crs", n ].join(":"), e[n]);
                }
            }
            return i;
        };
        var c = function(e, t, i) {
            var n, r;
            if (e) {
                n = a.createElement([ t, e ].join(":"));
            }
            r = l();
            if (u(i)) {
                for (var o in i) {
                    var s = d(o, t, i[o]);
                    r.appendChild(s);
                }
            } else {
                var h;
                for (var p in i) {
                    if (typeof i[p] === "object") {
                        if (Object.prototype.toString.call(i[p]) === "[object Array]") {
                            h = f(p, t, i[p]);
                        } else {
                            h = c(p, t, i[p]);
                        }
                    } else {
                        h = d(p, t, i[p]);
                    }
                    r.appendChild(h);
                }
            }
            if (e) {
                n.appendChild(r);
            } else {
                n = r;
            }
            return n;
        };
        var u = function(e) {
            for (var t in e) {
                if (typeof e[t] === "object") {
                    if (Object.prototype.toString.call(e[t]) === "[object Array]") {
                        for (var i = 0; i < e[t].length; i++) {
                            if (typeof e[t][i] === "object" && Object.prototype.toString.call(e[t][i]) !== "[object Array]") {
                                return false;
                            }
                        }
                        return true;
                    }
                    return false;
                }
            }
            return true;
        };
        var f = function(e, i, n) {
            var r, o = a.createElement([ "rdf", "Seq" ].join(":")), s;
            if (e) {
                r = a.createElement([ i, e ].join(":"));
            }
            for (var l = 0; l < n.length; l++) {
                s = a.createElementNS(t["rdf"], [ "rdf", "li" ].join(":"));
                if (Object.prototype.toString.call(n[l]) === "[object Array]") {
                    s.appendChild(document.createTextNode(n[l].join(",")));
                } else if (typeof n[l] === "object") {
                    s.appendChild(c(null, i, n[l]));
                } else {
                    s.appendChild(document.createTextNode(n[l]));
                }
                o.appendChild(s);
            }
            if (e) {
                r.appendChild(o);
            } else {
                r = o;
            }
            return r;
        };
        var d = function(e, i, n) {
            var r = a.createElementNS(t[i], [ i, e ].join(":"));
            if (Object.prototype.toString.call(n) !== "[object Array]") {
                var o = s.value(n);
                r.appendChild(o);
            } else {
                r.appendChild(f(null, i, n));
            }
            return r;
        };
        this.insertXmpProperty = function(e, t, i) {
            var n = f.apply(this, arguments);
            o.appendChild(n);
            return a.childNodes[0].outerHTML;
        };
        var h = function(e) {
            return e !== "rdf" ? true : false;
        };
        var p = function(e) {
            return e.childNodes.length === 1 && e.childNodes[0].tagName === "rdf:value" ? true : false;
        };
        var g = function(e) {
            return e.tagName === "rdf:Description" ? true : false;
        };
        var m = function(e) {
            return e.tagName === "rdf:Seq" ? true : false;
        };
        var v = function(e) {
            var t;
            if (e.nodeType === 3) {
                t = e.textContent;
                t = t.indexOf(",") !== -1 ? t.split(",").map(function(e) {
                    return parseFloat(e, 10);
                }) : parseFloat(t, 10);
            } else {
                var i = e.childNodes[0];
                t = parseFloat(i.textContent, 10);
            }
            return t;
        };
        var y = function(e) {
            var t = {}, i = e.childNodes;
            for (var n = 0; n < i.length; n++) {
                var r = i[n].tagName.split(":"), a = {
                    ns: r[0],
                    key: r[1]
                };
                if (a.ns !== "rdf") {
                    var o = i[n].childNodes[0];
                    if (p(o)) {
                        t[a.key] = v(o);
                    } else if (g(o)) {
                        t[a.key] = y(o);
                    } else if (m(o)) {
                        t[a.key] = b(o.childNodes);
                    }
                }
            }
            return t;
        };
        var b = function(e) {
            var t = [];
            for (var i = 0; i < e.length; i++) {
                if (e[i].childNodes[0].nodeType === 3) {
                    t.push(v(e[i].childNodes[0]));
                } else {
                    t.push(y(e[i].childNodes[0]));
                }
            }
            return t;
        };
        var w = function(e) {
            var t;
            var i = e[0];
            var n = i.tagName.split(":"), r = {
                ns: n[0],
                key: n[1]
            };
            if (r.key === "Seq") {
                t = b(i.childNodes);
            }
            return t;
        };
        this.getXmpProperties = function(e) {
            var t = new DOMParser();
            var i = t.parseFromString(e, "text/xml");
            var n = i.getElementsByTagNameNS("http://www.w3.org/1999/02/22-rdf-syntax-ns#", "Description")[0].childNodes[0];
            var r = {};
            var a = r;
            function o(e) {
                var t = e.tagName.split(":"), i = {
                    ns: t[0],
                    key: t[1]
                };
                if (h(i.ns)) {
                    return w(e.childNodes);
                }
            }
            return o(n);
        };
        this.toString = function() {
            return a.childNodes[0].outerHTML;
        };
    };
    return new t();
});

define("configPresets", [], function() {
    var e = "/assets/img/editor/presets/";
    var t = [ {
        name: "blurrr",
        title: "two",
        img: e + "preset.jpg",
        xmp: [ {
            brightness: .241,
            contrast: 3.82,
            title: "brightness"
        }, {
            intensity: .8,
            title: "sepia"
        } ]
    }, {
        name: "embosss",
        title: "first",
        img: e + "preset.jpg",
        xmp: [ {
            brightness: .241,
            contrast: 3.82,
            title: "brightness"
        } ]
    }, {
        name: "temperatureee",
        title: "second",
        img: e + "preset.jpg",
        xmp: [ {
            intensity: .8,
            title: "sepia"
        } ]
    } ];
    return t;
});

define("editor", [ "signal", "undoManager", "canvas", "slicer", "slicedImage", "ui", "utils", "decode", "taskManager", "q", "Widget", "spinner", "TrackingService", "config", "converter", "pProgress", "xmp", "resizeImage", "configPresets" ], function(e, t, i, n, r, a, o, s, l, c, u, f, d, h, p, g, m, v, y) {
    var b = h.converter.RAW_PER_SLICE;
    var w = h.drawingImageSize.width;
    var C = h.drawingImageSize.height;
    var x, _;
    var S = function() {
        var s = [], p = this, S = {
            realImage: {
                stored: false,
                index: null
            }
        }, k = {
            width: null,
            height: null
        }, A = false;
        var E = false;
        var T = false;
        var P = false;
        var I = h.toolbars;
        this.e = e;
        this.canvas = i;
        this.slicer = n;
        this.plugins = {};
        this.taskManager = l;
        this.toolbars = {};
        this.presets = y;
        this.btnAdjustmentsHandlers = h.btnAdjustmentsHandlers;
        this.btnPresetsHandlers = h.btnPresetsHandlers;
        this.e.subscribe("editor.update.imageData", function(e) {
            var t, i;
            if (typeof e == "function" || typeof e == "undefined") {
                t = e || function() {};
            } else {
                t = e.next, i = e.data;
            }
            if (!p.canvas.wasCropped) {
                var n = p.canvas.getCachedImageData();
                s.updateFromImageData(n);
                t && t();
            } else if (typeof i == "object" && i.title != "crop" && i.title != "transform") {
                var r = p.canvas.getCachedImageData();
                s.setCroppedDataFromImageData(r);
                var a = editor.getPlugin(i.title);
                var o = a.apply;
                var l = a.prepare(s.getSliceList(), i);
                var c = new Parallel(l);
                c.map(o).then(function(e) {
                    t && t();
                });
            } else {
                var r = p.canvas.getCachedImageData();
                s.setCroppedDataFromImageData(r);
                t && t();
            }
        });
        this.e.subscribe("state.cancel", function() {
            if (!p.canvas.wasCropped) {
                p.switchToSlices();
            } else {
                p.switchToCropped();
            }
        });
        this.e.subscribe("editor.switch.originalSlices", function() {
            p.switchToOriginalSlices();
        });
        this.e.subscribe("editor.switch.recentSlices", function() {
            p.switchToRecentSlices();
        });
        this.e.subscribe("editor.execute.start", function() {
            var e = s.clone();
            p.e.publish("task.imageData", s);
        });
        this.e.subscribe("editor.insertLocal", function(e) {
            p.insertLocal(e.coords, e.imageSlicesList);
        });
        this.e.subscribe("plugin.showed", function(e) {
            p.applyOpenedPlugin(e);
        });
        var O = function() {
            this.e.publish("saveToAnalitics", [ "Edit", "Start" ]);
            this.e.subscribe("loadingStart", f.start.bind(f));
            this.e.subscribe("progressStart", g.start.bind(g));
            this.e.subscribe("progressSet", function(e) {
                g.change.call(g, e.value);
            });
            this.e.subscribe("loadingFinish", f.finish.bind(f));
            this.e.subscribe("saveToAnalitics", this.saveToAnalitics.bind(this));
            this.e.subscribe("uiMenuElementReady", function(e) {
                new u.Menu(e);
            });
            this.e.subscribe("uiHtmlElementReady", function(e) {
                new u.Html(e);
            });
            this.e.subscribe("uiPluginElementReady", this.startPlugins.bind(this));
        };
        this.init = function(e) {
            if (this.isInited()) {
                this.reinit(e);
                return;
            }
            var i = e.img;
            var n = v(i, {
                orientation: h.drawingImageSize.orientation,
                width: h.drawingImageSize.width,
                height: h.drawingImageSize.height
            });
            var o = v(i, {
                orientation: h.drawingImageSize.orientation,
                width: i.width,
                height: i.height
            });
            e.real = o;
            e.rgba = n;
            k.width = e.real.width;
            k.height = e.real.height;
            x = e.name;
            _ = e.mimeType;
            h.toolbar = h.toolbar || {};
            O.call(this);
            this.ui = new a({
                container: e.container,
                logo: e.logo,
                logoSrc: e.logoSrc
            });
            this.e.publish("loadingStart");
            if (typeof e.padding !== "number") {
                e.padding = h.canvas.padding;
            }
            this.canvas.create({
                container: this.ui.find(h.ui.canvasContainer)[0],
                dragable: e.dragable || h.canvas.dragable,
                zoom: e.zoom || h.canvas.zoom,
                padding: e.padding
            });
            this.logError(e.rgba.data);
            s = new r(this.slicer.sliceRGBA(e.rgba, b), e.rgba.width, e.rgba.height);
            if (e.real.width > w || e.real.height > C) {
                this.real = e.real;
                this.canvas.wasResized = true;
            } else {
                delete e.real;
            }
            this.undoManager = new t(s, function() {}, "picsEdit3", e.undoManager);
            if (e.toolbar && e.toolbar.override) {
                I = this.overrideToolbar(e.toolbar.override || null);
            }
            if (e.toolbar && e.toolbar.bars) {
                I = this.updateToolbar(I, e.toolbar.bars);
            }
            this.startToolbar(I);
            this.initRightSidebarFilters();
            this.initRightSidebarPresets();
            this.renderSmallData({
                name: x,
                width: i.width,
                height: i.height,
                size: e.size
            });
            if (e.additionalPlugins) {
                e.additionalPlugins.map(function(e) {
                    p.startPlugins({
                        plugin: e
                    });
                });
            }
            this.canvas.draw(s.data, true);
            E = true;
            T = !!e.converter;
            P = !!e.skipFbOnSave;
        };
        this.showLogo = function() {
            $(".logoPicsioEditor").show();
        };
        this.hideLogo = function() {
            $(".logoPicsioEditor").hide();
        };
        this.startToolbar = function(e, t) {
            e || (e = h.toolbars);
            t && (e = Object.extended(e).clone().merge(t.toolbars));
            this.initToolbars(this.ui.findNodes(h.ui.toolbarContainer), e);
            this.showLogo();
        };
        this.hideToolbars = function() {
            Object.keys(this.toolbars).each(function(e) {
                this.toolbars[e].remove();
            }.bind(this));
            this.hideLogo();
        };
        this.initRightSidebarFilters = function() {
            var e = $("#rightSidebarEditorAdjustments");
            var t = [ "crop", "transform", "gradient", "hsl", "brightness", "saturation", "curves", "sepia", "temperature", "grayscale", "sharpen", "blur", "emboss", "invert" ];
            t.forEach(function(t) {
                var i = this.getPlugin(t);
                this.plugins[t] = new i(e);
            }.bind(this));
            var i = "; " + document.cookie;
            var n = i.split("; lastOpenedPlugin=");
            if (n.length === 2) {
                var r = n.pop().split(";").shift();
                this.plugins[r].onClickBtn();
            }
        };
        this.initRightSidebarPresets = function() {
            var e = this;
            this.presets.forEach(function(e) {
                new u.Html({
                    classList: [ "itemPreset" ],
                    html: [ '<div class="title"><span class="innerTitle">' + e.title + "</span></div>", '<div class="img"><img src="' + e.img + '" /></div>' ].join(""),
                    customContainer: $("#rightSidebarEditorPresets .contentRightSidebar"),
                    event: {
                        event: "click",
                        handler: function() {
                            editor.applyXmp(e.xmp.slice());
                        }
                    }
                });
            });
        };
        this.applyOpenedPlugin = function(e) {
            var t = this.getOpenedPlugin();
            if (t) {
                t.save && t.save();
                t.close();
            }
            var i = [ "hsl", "brightness", "saturation", "curves", "sepia", "temperature", "grayscale" ];
            if (e && !!~i.indexOf(e.title) && (!t || e.title !== t.title)) {
                document.cookie = "lastOpenedPlugin=" + e.title;
            } else {
                document.cookie = "lastOpenedPlugin" + "=;expires=Thu, 01 Jan 1970 00:00:01 GMT;";
            }
        };
        this.renderSmallData = function(e) {
            if (!this.toolbars.topRight) return;
            var t = this.toolbars.topRight.$el.find(".smallImgInfo");
            t.html([ "<div>" + e.name + "</div>", "<div>" + e.width + "x" + e.height + "</div>", "<div>" + o.bytesToSize(e.size) + "</div>" ].join(""));
        };
        this.reinit = function(e) {
            this.resetCrop();
            var t = this.getOpenedPlugin();
            t && t.close();
            s = [];
            var i = e.img;
            var n = v(i, {
                orientation: h.drawingImageSize.orientation,
                width: h.drawingImageSize.width,
                height: h.drawingImageSize.height
            });
            var a = v(i, {
                orientation: h.drawingImageSize.orientation,
                width: i.width,
                height: i.height
            });
            e.real = a;
            e.rgba = n;
            k.width = e.real.width;
            k.height = e.real.height;
            x = e.name;
            _ = e.mimeType;
            s = new r(this.slicer.sliceRGBA(e.rgba, b), e.rgba.width, e.rgba.height);
            this.e.publish("saveToAnalitics", [ "Edit", "File Open", o.pixelsToSizeString(e.real.width, e.real.height) ]);
            if (e.real.width > w || e.real.height > C) {
                this.real = e.real;
                this.canvas.wasResized = true;
            } else {
                this.canvas.wasResized = false;
                delete e.real;
                delete this.real;
            }
            if (e.undoManager !== false) {
                this.undoManager.reset(s);
            }
            if (e.reinit && typeof e.reinit.changeTransform !== "boolean") {
                e.reinit.changeTransform = h.reinit.changeTransform;
            } else if (!e.reinit) {
                e.reinit = h.reinit;
            }
            if (e.reinit.changeTransform) {
                this.canvas.resetCanvasTransforms();
            }
            this.canvas.draw(s.getClamped8SliceList(), e.reinit.changeTransform);
            this.e.publish("loadingFinish");
            this.renderSmallData({
                name: x,
                width: i.width,
                height: i.height,
                size: e.size
            });
            t && t.onClickBtn();
        };
        this.reset = function() {
            var e = this;
            var t = c.defer();
            var i = this.undoManager.getQueue().slice(0, 1)[0].timestamp;
            this.undoManager.getSnapshot(i, function(i) {
                var n = i.target.result, r = e.canvas.getContext();
                if (!n) {
                    t.reject(i);
                }
                s.update(n);
                r.resetTransform();
                r.scale(e.canvas.vScale, e.canvas.vScale);
                e.canvas.resetCrop();
                e.canvas.cornerMatrix.reset();
                e.canvas.centerImage();
                e.canvas.draw(s.getClamped8SliceList(), true);
                e.undoManager.reset(s).then(t.resolve);
            });
            return t.promise;
        };
        this.overrideToolbar = function(e) {
            if (e) {
                I = e;
            }
            return o.deepCopy(I);
        };
        this.saveChunk = function(e, t, i) {
            var n = c.defer();
            t.saveImage(e, i, function(e) {
                console.log(e.target.result);
                n.resolve(e);
            }, function(e) {
                n.reject(e);
            });
            return n.promise;
        };
        this.saveRealImage = function(e, t, i) {
            console.time("save original");
            var n = [], r = this;
            for (var a = 0; a < e.length; a++) {
                n.push(this.saveChunk(e[a], t, a + 1));
            }
            console.log(n.length);
            c.all(n).then(function(t) {
                console.timeEnd("save original");
                t = null;
                e = null;
                S.realImage = {
                    stored: true
                };
                r.e.publish("editor.readyToSave");
            }).fail(function(e) {
                console.log("Snapshot wasn't saved");
            });
        };
        this.initToolbars = function(e, t) {
            var i = t;
            for (var n in i) {
                if (e[n]) {
                    this.toolbars[n] = new u.Toolbar({
                        container: e[n],
                        items: i[n]
                    });
                }
            }
        };
        this.updateToolbar = function(e, t) {
            var i = o.deepCopy(e);
            for (var n in t) {
                i[n] = t[n].include.union(h.toolbars[n]);
            }
            return i;
        };
        this.startPlugins = function(e) {
            var t = e;
            if (typeof this.plugins[t.plugin] == "function") {
                this.plugins[t.plugin] = new this.plugins[t.plugin](t.container, t.params);
            } else {
                this.plugins[t.plugin].initialize(t.container, t.params);
            }
        };
        this.getImageData = function() {
            return s;
        };
        this.getPlugin = function(e) {
            return this.plugins[e] || undefined;
        };
        this.getOpenedPlugin = function() {
            return Object.values(this.plugins).find(function(e) {
                return e.isOpened === true;
            });
        };
        this.isPluginOpen = function() {
            for (var e in this.plugins) {
                if (this.plugins[e].isOpened === true) {
                    return true;
                }
            }
            return false;
        };
        this.switchToCropped = function() {
            var e = s.croppedData;
            p.canvas.cachedDraw({
                width: e.width,
                height: e.height,
                slices: o.float32ToClamped8ArraySlices(e.slices)
            });
        };
        this.switchToSlices = function() {
            p.canvas.cachedDraw(s.getClamped8SliceList());
        };
        this.saveToAnalitics = function(e) {
            var t = e;
            d.push.apply(d, t);
        };
        this.resetCrop = function() {
            this.canvas.resetCrop();
        };
        this.destroy = function() {
            var e = this.ui.getToolbarContainers();
            $.each(e, function(e, t) {
                t.remove();
            });
            this.e.unsubscribe("loadingStart");
            this.e.unsubscribe("loadingFinish");
            this.e.unsubscribe("saveToAnalitics");
            this.e.unsubscribe("uiMenuElementReady");
            this.e.unsubscribe("uiPluginElementReady");
            this.undoManager.reset();
            this.undoManager.closeDb();
            this.canvas.resetCanvasTransforms();
            this.resetCrop();
            s = [];
            E = false;
        };
        this.insertLocal = function(e, t, i) {
            if (i) {
                s.update(i);
            } else {
                s = this.getImageData();
            }
            var n = o.slicesListToFloat32Array(s.data.slices);
            var r = o.slicesListToFloat32Array(t.slices || t);
            var a = t.height;
            var l = t.width * 4;
            var c = s.data.width * 4;
            var u = c * e.y + e.x * 4;
            var f = 0;
            for (var d = 0; d < a; d++) {
                n.set(r.subarray(f, f + l), u);
                u += c;
                f += l;
            }
            s.update(T.float32ArrayToSlicedFloat32(n, s.data.width, s.data.height));
            p.canvas.cachedDraw(s.getClamped8SliceList());
            return s.data;
        };
        this.getRealSize = function() {
            var e = this.canvas.cornerMatrix.getCorner();
            if (e === "TR" || e === "BR") {
                return {
                    width: k.height,
                    height: k.width
                };
            } else {
                return k;
            }
        };
        this.getDrawSize = function() {
            return !this.canvas.wasCropped ? {
                width: s.data.width,
                height: s.data.height
            } : {
                width: s.croppedData.width,
                height: s.croppedData.height
            };
        };
        this.getFileName = function() {
            return x;
        };
        this.getMimeType = function() {
            return _;
        };
        this.saveXmp = function() {
            var e = this.undoManager, t = e.getQueueToJson();
            var i = m.insertXmpProperty("test", "crs", t);
            var n = new Blob([ i ], {
                type: "text/xml"
            });
            saveAs(n, this.getFileName().split(".")[0] + ".xmp");
        };
        this.loadXmp = function(e) {
            var t = c.defer();
            try {
                var i = m.getXmpProperties(e);
                var n = [];
                for (var r = 0; r < i.length; r++) {
                    var a = i[r];
                    var o;
                    for (var s in a) {
                        o = a[s];
                        o.title = s;
                    }
                    n.push(o);
                    t.resolve(n);
                }
            } catch (l) {
                t.reject(n);
            }
            return t.promise;
        };
        this.applyXmp = function(t) {
            var i = this;
            i.reset().then(function() {
                try {
                    e.publish("runCommandStack", {
                        queue: t
                    }, true);
                } catch (n) {
                    i.reset();
                    e.publish("loadingFinish");
                }
            });
        };
        var D = false;
        this.hold = function() {
            D = true;
        };
        this.unhold = function() {
            D = false;
        };
        this.isHold = function() {
            return D;
        };
        this.logError = function(e) {};
        this.isInited = function() {
            return E;
        };
        this.isConverter = function() {
            return T;
        };
        this.skipFbOnSave = function() {
            return P;
        };
    };
    return new S();
});

(function() {
    var e, t, i, n, r, a, o, s, l, c, u, f, d, h, p, g, m, v, y, b, w = {}.hasOwnProperty, C = [].indexOf || function(e) {
        for (var t = 0, i = this.length; t < i; t++) {
            if (t in this && this[t] === e) return t;
        }
        return -1;
    }, x;
    s = {
        is_unordered: false,
        is_counting: false,
        is_exclusive: false,
        is_solitary: false,
        prevent_default: false,
        prevent_repeat: false
    };
    y = [ "meta", "alt", "option", "ctrl", "shift", "cmd" ];
    m = "ctrl";
    x = {};
    x.debug = false;
    e = function() {
        function e(e) {
            var t, i;
            for (t in e) {
                if (!w.call(e, t)) continue;
                i = e[t];
                if (i !== false) {
                    this[t] = i;
                }
            }
            this.keys = this.keys || [];
            this.count = this.count || 0;
        }
        e.prototype.allows_key_repeat = function() {
            return !this.prevent_repeat && typeof this.on_keydown === "function";
        };
        e.prototype.reset = function() {
            this.count = 0;
            return this.keyup_fired = null;
        };
        return e;
    }();
    x.Listener = function() {
        function t(e, t) {
            var i, n, r, a = this;
            this.should_suppress_event_defaults = false;
            this.should_force_event_defaults = false;
            this.sequence_delay = 800;
            this._registered_combos = [];
            this._keys_down = [];
            this._active_combos = [];
            this._sequence = [];
            this._sequence_timer = null;
            this._prevent_capture = false;
            this._defaults = t || {};
            for (n in s) {
                if (!w.call(s, n)) continue;
                r = s[n];
                this._defaults[n] = this._defaults[n] || r;
            }
            e = e || document.body;
            i = function(e, t, i) {
                if (e.addEventListener) {
                    return e.addEventListener(t, i);
                } else if (e.attachEvent) {
                    return e.attachEvent("on" + t, i);
                }
            };
            i(e, "keydown", function(e) {
                e = e || window.event;
                a._receive_input(e, true);
                return a._bug_catcher(e);
            });
            i(e, "keyup", function(e) {
                e = e || window.event;
                return a._receive_input(e, false);
            });
            i(window, "blur", function() {
                var e, t, i, n;
                n = a._keys_down;
                for (t = 0, i = n.length; t < i; t++) {
                    e = n[t];
                    a._key_up(e, {});
                }
                return a._keys_down = [];
            });
        }
        t.prototype._bug_catcher = function(e) {
            var t;
            if (m === "cmd" && C.call(this._keys_down, "cmd") >= 0 && ((t = r(e.keyCode)) !== "cmd" && t !== "shift" && t !== "alt" && t !== "caps" && t !== "tab")) {
                return this._receive_input(e, false);
            }
        };
        t.prototype._cmd_bug_check = function(e) {
            if (m === "cmd" && C.call(this._keys_down, "cmd") >= 0 && C.call(e, "cmd") < 0) {
                return false;
            }
            return true;
        };
        t.prototype._prevent_default = function(e, t) {
            if ((t || this.should_suppress_event_defaults) && !this.should_force_event_defaults) {
                if (e.preventDefault) {
                    e.preventDefault();
                } else {
                    e.returnValue = false;
                }
                if (e.stopPropagation) {
                    return e.stopPropagation();
                }
            }
        };
        t.prototype._get_active_combos = function(e) {
            var t, i, n = this;
            t = [];
            i = l(this._keys_down, function(t) {
                return t !== e;
            });
            i.push(e);
            this._match_combo_arrays(i, function(e) {
                if (n._cmd_bug_check(e.keys)) {
                    return t.push(e);
                }
            });
            this._fuzzy_match_combo_arrays(i, function(e) {
                if (C.call(t, e) >= 0) {
                    return;
                }
                if (!(e.is_solitary || !n._cmd_bug_check(e.keys))) {
                    return t.push(e);
                }
            });
            return t;
        };
        t.prototype._get_potential_combos = function(e) {
            var t, i, n, r, a;
            i = [];
            a = this._registered_combos;
            for (n = 0, r = a.length; n < r; n++) {
                t = a[n];
                if (t.is_sequence) {
                    continue;
                }
                if (C.call(t.keys, e) >= 0 && this._cmd_bug_check(t.keys)) {
                    i.push(t);
                }
            }
            return i;
        };
        t.prototype._add_to_active_combos = function(e) {
            var t, i, n, r, a, o, s, l, c, u, f, d, h, p, g;
            l = false;
            s = true;
            r = false;
            if (C.call(this._active_combos, e) >= 0) {
                return true;
            } else if (this._active_combos.length) {
                for (o = c = 0, p = this._active_combos.length; 0 <= p ? c < p : c > p; o = 0 <= p ? ++c : --c) {
                    t = this._active_combos[o];
                    if (!(t && t.is_exclusive && e.is_exclusive)) {
                        continue;
                    }
                    n = t.keys;
                    if (!l) {
                        for (u = 0, d = n.length; u < d; u++) {
                            i = n[u];
                            l = true;
                            if (C.call(e.keys, i) < 0) {
                                l = false;
                                break;
                            }
                        }
                    }
                    if (s && !l) {
                        g = e.keys;
                        for (f = 0, h = g.length; f < h; f++) {
                            a = g[f];
                            s = false;
                            if (C.call(n, a) < 0) {
                                s = true;
                                break;
                            }
                        }
                    }
                    if (l) {
                        if (r) {
                            t = this._active_combos.splice(o, 1)[0];
                            if (t != null) {
                                t.reset();
                            }
                        } else {
                            t = this._active_combos.splice(o, 1, e)[0];
                            if (t != null) {
                                t.reset();
                            }
                            r = true;
                        }
                        s = false;
                    }
                }
            }
            if (s) {
                this._active_combos.unshift(e);
            }
            return l || s;
        };
        t.prototype._remove_from_active_combos = function(e) {
            var t, i, n, r;
            for (i = n = 0, r = this._active_combos.length; 0 <= r ? n < r : n > r; i = 0 <= r ? ++n : --n) {
                t = this._active_combos[i];
                if (t === e) {
                    e = this._active_combos.splice(i, 1)[0];
                    e.reset();
                    break;
                }
            }
        };
        t.prototype._get_possible_sequences = function() {
            var e, t, i, n, r, a, o, s, c, u, f, d, h;
            r = [];
            f = this._registered_combos;
            for (o = 0, u = f.length; o < u; o++) {
                e = f[o];
                for (i = s = 1, d = this._sequence.length; 1 <= d ? s <= d : s >= d; i = 1 <= d ? ++s : --s) {
                    a = this._sequence.slice(-i);
                    if (!e.is_sequence) {
                        continue;
                    }
                    if (C.call(e.keys, "shift") < 0) {
                        a = l(a, function(e) {
                            return e !== "shift";
                        });
                        if (!a.length) {
                            continue;
                        }
                    }
                    for (t = c = 0, h = a.length; 0 <= h ? c < h : c > h; t = 0 <= h ? ++c : --c) {
                        if (e.keys[t] === a[t]) {
                            n = true;
                        } else {
                            n = false;
                            break;
                        }
                    }
                    if (n) {
                        r.push(e);
                    }
                }
            }
            return r;
        };
        t.prototype._add_key_to_sequence = function(e, t) {
            var i, n, r, a;
            this._sequence.push(e);
            n = this._get_possible_sequences();
            if (n.length) {
                for (r = 0, a = n.length; r < a; r++) {
                    i = n[r];
                    this._prevent_default(t, i.prevent_default);
                }
                if (this._sequence_timer) {
                    clearTimeout(this._sequence_timer);
                }
                if (this.sequence_delay > -1) {
                    this._sequence_timer = setTimeout(function() {
                        return this._sequence = [];
                    }, this.sequence_delay);
                }
            } else {
                this._sequence = [];
            }
        };
        t.prototype._get_sequence = function(e) {
            var t, i, n, r, a, o, s, c, u, f, d, h, p;
            d = this._registered_combos;
            for (s = 0, f = d.length; s < f; s++) {
                t = d[s];
                if (!t.is_sequence) {
                    continue;
                }
                for (n = c = 1, h = this._sequence.length; 1 <= h ? c <= h : c >= h; n = 1 <= h ? ++c : --c) {
                    o = l(this._sequence, function(e) {
                        if (C.call(t.keys, "shift") >= 0) {
                            return true;
                        }
                        return e !== "shift";
                    }).slice(-n);
                    if (t.keys.length !== o.length) {
                        continue;
                    }
                    for (i = u = 0, p = o.length; 0 <= p ? u < p : u > p; i = 0 <= p ? ++u : --u) {
                        a = o[i];
                        if (C.call(t.keys, "shift") < 0 ? a === "shift" : void 0) {
                            continue;
                        }
                        if (e === "shift" && C.call(t.keys, "shift") < 0) {
                            continue;
                        }
                        if (t.keys[i] === a) {
                            r = true;
                        } else {
                            r = false;
                            break;
                        }
                    }
                }
                if (r) {
                    return t;
                }
            }
            return false;
        };
        t.prototype._receive_input = function(e, t) {
            var i;
            if (this._prevent_capture) {
                if (this._keys_down.length) {
                    this._keys_down = [];
                }
                return;
            }
            i = r(e.keyCode);
            if (!t && !this._keys_down.length && (i === "alt" || i === m)) {
                return;
            }
            if (!i) {
                return;
            }
            if (t) {
                return this._key_down(i, e);
            } else {
                return this._key_up(i, e);
            }
        };
        t.prototype._fire = function(e, t, i, n) {
            if (typeof t["on_" + e] === "function") {
                this._prevent_default(i, t["on_" + e].call(t["this"], i, t.count, n) !== true);
            }
            if (e === "release") {
                t.count = 0;
            }
            if (e === "keyup") {
                return t.keyup_fired = true;
            }
        };
        t.prototype._match_combo_arrays = function(e, t) {
            var r, a, o, s;
            s = this._registered_combos;
            for (a = 0, o = s.length; a < o; a++) {
                r = s[a];
                if (!r.is_unordered && n(e, r.keys) || r.is_unordered && i(e, r.keys)) {
                    t(r);
                }
            }
        };
        t.prototype._fuzzy_match_combo_arrays = function(e, t) {
            var i, n, r, a;
            a = this._registered_combos;
            for (n = 0, r = a.length; n < r; n++) {
                i = a[n];
                if (!i.is_unordered && u(i.keys, e) || i.is_unordered && c(i.keys, e)) {
                    t(i);
                }
            }
        };
        t.prototype._keys_remain = function(e) {
            var t, i, n, r, a;
            a = e.keys;
            for (n = 0, r = a.length; n < r; n++) {
                t = a[n];
                if (C.call(this._keys_down, t) >= 0) {
                    i = true;
                    break;
                }
            }
            return i;
        };
        t.prototype._key_down = function(e, t) {
            var i, n, r, o, s, l, c, u, f, d, h, p, g, y, b;
            f = a(e, t);
            if (f) {
                e = f;
            }
            this._add_key_to_sequence(e, t);
            u = this._get_sequence(e);
            if (u) {
                this._fire("keydown", u, t);
            }
            for (s in v) {
                r = v[s];
                if (!t[r]) {
                    continue;
                }
                if (s === e || C.call(this._keys_down, s) >= 0) {
                    continue;
                }
                this._keys_down.push(s);
            }
            for (s in v) {
                r = v[s];
                if (s === e) {
                    continue;
                }
                if (C.call(this._keys_down, s) >= 0 && !t[r]) {
                    if (s === "cmd" && m !== "cmd") {
                        continue;
                    }
                    for (o = d = 0, b = this._keys_down.length; 0 <= b ? d < b : d > b; o = 0 <= b ? ++d : --d) {
                        if (this._keys_down[o] === s) {
                            this._keys_down.splice(o, 1);
                        }
                    }
                }
            }
            n = this._get_active_combos(e);
            c = this._get_potential_combos(e);
            for (h = 0, g = n.length; h < g; h++) {
                i = n[h];
                this._handle_combo_down(i, c, e, t);
            }
            if (c.length) {
                for (p = 0, y = c.length; p < y; p++) {
                    l = c[p];
                    this._prevent_default(t, l.prevent_default);
                }
            }
            if (C.call(this._keys_down, e) < 0) {
                this._keys_down.push(e);
            }
        };
        t.prototype._handle_combo_down = function(e, t, i, n) {
            var r, a, o, s, l, c;
            if (C.call(e.keys, i) < 0) {
                return false;
            }
            this._prevent_default(n, e && e.prevent_default);
            r = false;
            if (C.call(this._keys_down, i) >= 0) {
                r = true;
                if (!e.allows_key_repeat()) {
                    return false;
                }
            }
            s = this._add_to_active_combos(e, i);
            e.keyup_fired = false;
            a = false;
            if (e.is_exclusive) {
                for (l = 0, c = t.length; l < c; l++) {
                    o = t[l];
                    if (o.is_exclusive && o.keys.length > e.keys.length) {
                        a = true;
                        break;
                    }
                }
            }
            if (!a) {
                if (e.is_counting && typeof e.on_keydown === "function") {
                    e.count += 1;
                }
                if (s) {
                    return this._fire("keydown", e, n, r);
                }
            }
        };
        t.prototype._key_up = function(e, t) {
            var i, n, r, o, s, l, c, u, f, d, h, g, m, v, y, b, w, x, _;
            u = e;
            c = a(e, t);
            if (c) {
                e = c;
            }
            c = p[u];
            if (t.shiftKey) {
                if (!(c && C.call(this._keys_down, c) >= 0)) {
                    e = u;
                }
            } else {
                if (!(u && C.call(this._keys_down, u) >= 0)) {
                    e = c;
                }
            }
            l = this._get_sequence(e);
            if (l) {
                this._fire("keyup", l, t);
            }
            if (C.call(this._keys_down, e) < 0) {
                return false;
            }
            for (s = f = 0, b = this._keys_down.length; 0 <= b ? f < b : f > b; s = 0 <= b ? ++f : --f) {
                if ((w = this._keys_down[s]) === e || w === c || w === u) {
                    this._keys_down.splice(s, 1);
                    break;
                }
            }
            n = this._active_combos.length;
            o = [];
            x = this._active_combos;
            for (d = 0, m = x.length; d < m; d++) {
                i = x[d];
                if (C.call(i.keys, e) >= 0) {
                    o.push(i);
                }
            }
            for (h = 0, v = o.length; h < v; h++) {
                r = o[h];
                this._handle_combo_up(r, t, e);
            }
            if (n > 1) {
                _ = this._active_combos;
                for (g = 0, y = _.length; g < y; g++) {
                    i = _[g];
                    if (i === void 0 || C.call(o, i) >= 0) {
                        continue;
                    }
                    if (!this._keys_remain(i)) {
                        this._remove_from_active_combos(i);
                    }
                }
            }
        };
        t.prototype._handle_combo_up = function(e, t, n) {
            var r, a;
            this._prevent_default(t, e && e.prevent_default);
            a = this._keys_remain(e);
            if (!e.keyup_fired) {
                r = this._keys_down.slice();
                r.push(n);
                if (!e.is_solitary || i(r, e.keys)) {
                    this._fire("keyup", e, t);
                    if (e.is_counting && typeof e.on_keyup === "function" && typeof e.on_keydown !== "function") {
                        e.count += 1;
                    }
                }
            }
            if (!a) {
                this._fire("release", e, t);
                this._remove_from_active_combos(e);
            }
        };
        t.prototype.simple_combo = function(e, t) {
            return this.register_combo({
                keys: e,
                on_keydown: t
            });
        };
        t.prototype.counting_combo = function(e, t) {
            return this.register_combo({
                keys: e,
                is_counting: true,
                is_unordered: false,
                on_keydown: t
            });
        };
        t.prototype.sequence_combo = function(e, t) {
            return this.register_combo({
                keys: e,
                on_keydown: t,
                is_sequence: true
            });
        };
        t.prototype.register_combo = function(t) {
            var i, n, r, a;
            if (typeof t["keys"] === "string") {
                t["keys"] = t["keys"].split(" ");
            }
            a = this._defaults;
            for (n in a) {
                if (!w.call(a, n)) continue;
                r = a[n];
                if (t[n] === void 0) {
                    t[n] = r;
                }
            }
            i = new e(t);
            if (b(i)) {
                this._registered_combos.push(i);
                return true;
            }
        };
        t.prototype.register_many = function(e) {
            var t, i, n, r;
            r = [];
            for (i = 0, n = e.length; i < n; i++) {
                t = e[i];
                r.push(this.register_combo(t));
            }
            return r;
        };
        t.prototype.unregister_combo = function(e) {
            var t, r, a, o, s, l = this;
            if (!e) {
                return false;
            }
            r = function(e) {
                var t, i, n, r;
                r = [];
                for (t = i = 0, n = l._registered_combos.length; 0 <= n ? i < n : i > n; t = 0 <= n ? ++i : --i) {
                    if (e === l._registered_combos[t]) {
                        l._registered_combos.splice(t, 1);
                        break;
                    } else {
                        r.push(void 0);
                    }
                }
                return r;
            };
            if (e.keys) {
                return r(e);
            } else {
                s = this._registered_combos;
                for (a = 0, o = s.length; a < o; a++) {
                    t = s[a];
                    if (!t) {
                        continue;
                    }
                }
                if (typeof e === "string") {
                    e = e.split(" ");
                }
                if (t.is_unordered && i(e, t.keys) || !t.is_unordered && n(e, t.keys)) {
                    return r(t);
                }
            }
        };
        t.prototype.unregister_many = function(e) {
            var t, i, n, r;
            r = [];
            for (i = 0, n = e.length; i < n; i++) {
                t = e[i];
                r.push(this.unregister_combo(t));
            }
            return r;
        };
        t.prototype.get_registered_combos = function() {
            return this._registered_combos;
        };
        t.prototype.reset = function() {
            return this._registered_combos = [];
        };
        t.prototype.listen = function() {
            return this._prevent_capture = false;
        };
        t.prototype.stop_listening = function() {
            return this._prevent_capture = true;
        };
        t.prototype.get_meta_key = function() {
            return m;
        };
        return t;
    }();
    o = function() {
        if (navigator.userAgent.indexOf("Mac OS X") !== -1) {
            m = "cmd";
        }
    };
    t = function() {
        if (navigator.userAgent.indexOf("Opera") !== -1) {
            h["17"] = "cmd";
        }
    };
    r = function(e) {
        return h[e];
    };
    l = function(e, t) {
        var i;
        if (e.filter) {
            return e.filter(t);
        } else {
            return function() {
                var n, r, a;
                a = [];
                for (n = 0, r = e.length; n < r; n++) {
                    i = e[n];
                    if (t(i)) {
                        a.push(i);
                    }
                }
                return a;
            }();
        }
    };
    i = function(e, t) {
        var i, n, r;
        if (e.length !== t.length) {
            return false;
        }
        for (n = 0, r = e.length; n < r; n++) {
            i = e[n];
            if (C.call(t, i) >= 0) {
                continue;
            }
            return false;
        }
        return true;
    };
    n = function(e, t) {
        var i, n, r;
        if (e.length !== t.length) {
            return false;
        }
        for (i = n = 0, r = e.length; 0 <= r ? n < r : n > r; i = 0 <= r ? ++n : --n) {
            if (e[i] !== t[i]) {
                return false;
            }
        }
        return true;
    };
    c = function(e, t) {
        var i, n, r;
        for (n = 0, r = e.length; n < r; n++) {
            i = e[n];
            if (C.call(t, i) < 0) {
                return false;
            }
        }
        return true;
    };
    u = function(e, t) {
        var i, n, r, a, o;
        r = 0;
        for (a = 0, o = e.length; a < o; a++) {
            n = e[a];
            i = t.indexOf(n);
            if (i >= r) {
                r = i;
            } else {
                return false;
            }
        }
        return true;
    };
    g = function() {
        if (x.debug) {
            return console.log.apply(console, arguments);
        }
    };
    f = function(e) {
        var t, i, n;
        t = false;
        for (n in h) {
            i = h[n];
            if (e === i) {
                t = true;
                break;
            }
        }
        if (!t) {
            for (n in p) {
                i = p[n];
                if (e === i) {
                    t = true;
                    break;
                }
            }
        }
        return t;
    };
    b = function(e) {
        var t, i, n, r, a, o, l, c, u, h, p, v, b, w, x;
        l = true;
        if (!e.keys.length) {
            g("You're trying to bind a combo with no keys:", e);
        }
        for (i = u = 0, w = e.keys.length; 0 <= w ? u < w : u > w; i = 0 <= w ? ++u : --u) {
            n = e.keys[i];
            t = d[n];
            if (t) {
                n = e.keys[i] = t;
            }
            if (n === "meta") {
                e.keys.splice(i, 1, m);
            }
            if (n === "cmd") {
                g('Warning: use the "meta" key rather than "cmd" for Windows compatibility');
            }
        }
        x = e.keys;
        for (h = 0, v = x.length; h < v; h++) {
            n = x[h];
            if (!f(n)) {
                g('Do not recognize the key "' + n + '"');
                l = false;
            }
        }
        if (C.call(e.keys, "meta") >= 0 || C.call(e.keys, "cmd") >= 0) {
            a = e.keys.slice();
            for (p = 0, b = y.length; p < b; p++) {
                r = y[p];
                if ((i = a.indexOf(r)) > -1) {
                    a.splice(i, 1);
                }
            }
            if (a.length > 1) {
                g("META and CMD key combos cannot have more than 1 non-modifier keys", e, a);
                l = false;
            }
        }
        for (o in e) {
            c = e[o];
            if (s[o] === "undefined") {
                g("The property " + o + " is not a valid combo property. Your combo has still been registered.");
            }
        }
        return l;
    };
    a = function(e, t) {
        var i;
        if (!t.shiftKey) {
            return false;
        }
        i = p[e];
        if (i != null) {
            return i;
        }
        return false;
    };
    v = {
        cmd: "metaKey",
        ctrl: "ctrlKey",
        shift: "shiftKey",
        alt: "altKey"
    };
    d = {
        escape: "esc",
        control: "ctrl",
        command: "cmd",
        "break": "pause",
        windows: "cmd",
        option: "alt",
        caps_lock: "caps",
        apostrophe: "'",
        semicolon: ";",
        tilde: "~",
        accent: "`",
        scroll_lock: "scroll",
        num_lock: "num"
    };
    p = {
        "/": "?",
        ".": ">",
        ",": "<",
        "'": '"',
        ";": ":",
        "[": "{",
        "]": "}",
        "\\": "|",
        "`": "~",
        "=": "+",
        "-": "_",
        "1": "!",
        "2": "@",
        "3": "#",
        "4": "$",
        "5": "%",
        "6": "^",
        "7": "&",
        "8": "*",
        "9": "(",
        "0": ")"
    };
    h = {
        0: "\\",
        8: "backspace",
        9: "tab",
        12: "num",
        13: "enter",
        16: "shift",
        17: "ctrl",
        18: "alt",
        19: "pause",
        20: "caps",
        27: "esc",
        32: "space",
        33: "pageup",
        34: "pagedown",
        35: "end",
        36: "home",
        37: "left",
        38: "up",
        39: "right",
        40: "down",
        44: "print",
        45: "insert",
        46: "delete",
        48: "0",
        49: "1",
        50: "2",
        51: "3",
        52: "4",
        53: "5",
        54: "6",
        55: "7",
        56: "8",
        57: "9",
        65: "a",
        66: "b",
        67: "c",
        68: "d",
        69: "e",
        70: "f",
        71: "g",
        72: "h",
        73: "i",
        74: "j",
        75: "k",
        76: "l",
        77: "m",
        78: "n",
        79: "o",
        80: "p",
        81: "q",
        82: "r",
        83: "s",
        84: "t",
        85: "u",
        86: "v",
        87: "w",
        88: "x",
        89: "y",
        90: "z",
        91: "cmd",
        92: "cmd",
        93: "cmd",
        96: "num_0",
        97: "num_1",
        98: "num_2",
        99: "num_3",
        100: "num_4",
        101: "num_5",
        102: "num_6",
        103: "num_7",
        104: "num_8",
        105: "num_9",
        106: "num_multiply",
        107: "num_add",
        108: "num_enter",
        109: "num_subtract",
        110: "num_decimal",
        111: "num_divide",
        124: "print",
        144: "num",
        145: "scroll",
        186: ";",
        187: "=",
        188: ",",
        189: "-",
        190: ".",
        191: "/",
        192: "`",
        219: "[",
        220: "\\",
        221: "]",
        222: "'",
        223: "`",
        224: "cmd",
        225: "alt",
        57392: "ctrl",
        63289: "num"
    };
    o();
    t();
    if (typeof define === "function" && define.amd) {
        define("keypress", [], function() {
            return x;
        });
    } else {
        window.keypress = x;
    }
}).call(this);

define("pluginManager", [ "utils", "signal", "keypress", "WW" ], function(e, t, i, n) {
    var r = function(e, t) {
        this.initialize(e, t);
        this.bindShortCut();
        this.isOpened = false;
    };
    r.prototype.keyListener = new i.Listener();
    r.prototype.initialize = function() {};
    r.prototype.open = function(e) {
        if (!editor.isPluginOpen()) {
            this.isOpened = true;
            typeof this.apply === "function" && this.initWorker();
            this.start(e);
        }
    };
    r.prototype.close = function() {
        this.onClose();
        if (this.isOpened) {
            this.isOpened = false;
        }
        if (this.btn) {
            this.btn.$el.find(".slideBtnContent").empty();
            this.btn.$el.removeClass("act");
        }
        typeof this.apply === "function" && this.removeWorker();
    };
    r.prototype.setWorker = function(e) {
        this.worker = e;
    };
    r.prototype.getWorker = function() {
        return this.worker;
    };
    r.prototype.removeWorker = function() {
        this.worker && this.worker.destroyWorkers();
        this.worker = null;
    };
    r.prototype.initWorker = function() {
        var e = editor.getImageData();
        var t = e.clone();
        var i = this.prepare(t.slices, {});
        var r = new n(null, {
            length: i.length,
            fn: this.apply
        });
        this.setWorker(r);
    };
    r.prototype.onClose = function() {};
    r.prototype.process = function() {};
    r.prototype.bindShortCut = function(e) {
        var t = this;
        if (t.shortcut) {
            t.keyListener.register_combo({
                keys: t.shortcut.value.toLowerCase(),
                on_keydown: function() {
                    return false;
                },
                on_keyup: function(e) {
                    if (e.type) {
                        t.open(this);
                    }
                },
                is_exclusive: t.shortcut.is_exclusive
            });
        }
    };
    r.prototype.unbindShortCut = function() {
        if (this.shortcut) {
            this.keyListener.unregister_combo(this.shortcut);
        }
    };
    r.prototype.prepareDataToProcessing = function(t, i) {
        for (var n = 0; n < t.length; n++) {
            t[n]["params"] = e.deepCopy(i);
        }
        if (i.additionalLines) {
            for (var n = 0; n < t.length; n++) {
                var r, a;
                t[n]["params"].lineList = {};
                if (n === 0) {
                    r = null;
                } else {
                    var o = t[n - 1];
                    r = o.data.subarray(o.data.length - o.width * 4, o.data.length);
                    r = new Uint8ClampedArray(r.length).set(r);
                }
                if (n === t.length - 1) {
                    a = null;
                } else {
                    var s = t[n + 1];
                    a = s.data.subarray(0, s.width * 4);
                    a = new Uint8ClampedArray(a.length).set(a);
                }
                t[n]["params"].lineList = {
                    top: r,
                    bottom: a
                };
            }
        }
        return t;
    };
    r.prototype.prepare = function(e, t) {
        return this.prepareDataToProcessing(e, t);
    };
    r.prototype.runningMode = "worker";
    r.prototype.getRunningMode = function() {
        return this.runningMode;
    };
    r.prototype.isStateOperation = function() {
        return this.modificationType === "state" ? true : false;
    };
    r.extend = function(t, i) {
        var n = this;
        var r;
        if (t && hasOwnProperty.call(t, "constructor")) {
            r = t.constructor;
        } else {
            r = function(e) {
                return n.apply(this, arguments, e);
            };
        }
        e.mixin(r, n, i);
        var a = function() {
            this.constructor = r;
        };
        a.prototype = n.prototype;
        r.prototype = new a();
        if (t) e.mixin(r.prototype, t);
        r.__super__ = n.prototype;
        return r;
    };
    var a = r.extend(t);
    return a;
});

define("shortcut", [], function() {
    var e = "alt", t = "ctrl", i = navigator.userAgent.toString().toLowerCase().indexOf("mac") != -1 ? true : false;
    if (i) {
        e = "option";
        t = "command";
    }
    var n = {
        file: {
            open: {
                value: t + " " + "O"
            },
            save: {
                value: t + " " + "S"
            }
        },
        color: {
            curves: {
                value: t + " " + "M"
            },
            "hsl tool": {
                value: t + " " + "U"
            }
        },
        autofilters: {
            sharpen: {
                value: e + " " + "S"
            },
            blur: {
                value: e + " " + "B"
            },
            emboss: {
                value: e + " " + "E"
            },
            invert: {
                value: e + " " + "I"
            }
        },
        other: {
            undo: {
                value: t + " " + "Z",
                is_exclusive: true
            },
            redo: {
                value: t + " " + "shift" + " " + "Z",
                is_exclusive: true
            },
            fullscreen: {
                value: t + " " + "F"
            }
        },
        transformations: {
            crop: {
                value: "shift" + " " + "C"
            }
        }
    };
    return n;
});

define("pluginInvert", [ "Widget", "pluginManager", "taskManager", "shortcut" ], function(e, t, i, n) {
    var r = t.extend({
        title: "invert",
        iconClass: "iconEdit_invert",
        shortcut: n.autofilters.invert,
        initialize: function(t) {
            var i = this;
            var n = new e.Html({
                classList: [ "slideBtn" ],
                html: [ '<div class="slideBtnTitle ' + this.iconClass + '">Invert</div>', '<div class="slideBtnContent"></div>' ].join(""),
                customContainer: t
            });
            n.$el.find(".slideBtnTitle").on("click", function() {
                i.publish("plugin.showed", {
                    title: i.title
                });
                i.open.call(i);
            });
        },
        start: function() {
            var e = this;
            e.publish("saveToAnalitics", [ "Edit", "Invert", "Open" ]);
            var t = {
                title: e.title
            };
            this.initWorker();
            i.execute(e.apply, t).then(function() {
                e.publish("state.added", {
                    title: e.title
                });
                this.removeWorker();
            });
            e.isOpened = false;
        },
        apply: function(e) {
            var t = e.data.length;
            while (t--) {
                e.data[t] = 255 - e.data[t];
                if (t % 4 === 3) e.data[t] = 255;
            }
            return e;
        }
    });
    return r;
});

define("pluginEmpty", [ "Widget", "pluginManager" ], function(e, t) {
    var i = function(e) {
        new Widget.Button({
            parentToolbar: e
        });
        return i;
    };
    return i;
});

define("pluginSepia", [ "Widget", "pluginManager", "taskManager", "shortcut" ], function(e, t, i, n) {
    var r = t.extend({
        title: "sepia",
        iconClass: "iconEdit_sepia",
        inputRange: null,
        shortcut: n.color.sepia,
        initialize: function(t) {
            var i = this;
            this.btn = new e.Html({
                classList: [ "slideBtn" ],
                html: [ '<div class="slideBtnTitle ' + this.iconClass + ' arrow">Sepia</div>', '<div class="slideBtnContent"></div>' ].join(""),
                customContainer: t
            });
            this.btn.$el.find(".slideBtnTitle").on("click", this.onClickBtn.bind(this));
        },
        onClickBtn: function() {
            var e = !this.isOpened;
            this.publish("plugin.showed", {
                title: this.title
            });
            if (e) {
                this.open.call(this);
                this.btn.$el.addClass("act");
            }
        },
        start: function() {
            var t = this;
            this.inputRange = new e.InputRange({
                id: "inputRange",
                onChange: function(e) {
                    i.execute(t.apply, {
                        intensity: e / 100,
                        title: t.title
                    });
                },
                defaultValue: 0,
                customContainer: this.btn.$el.find(".slideBtnContent")
            });
            this.btnReset = new e.DialogButton({
                customContainer: this.btn.$el.find(".slideBtnContent"),
                click: t.reset.bind(t),
                title: "Reset",
                classList: [ "simpleBtnRS" ]
            });
        },
        apply: function(e) {
            var t = e.params.intensity;
            var i = e.data;
            var n = 1 - t;
            for (var r = 0; r < i.length; r += 4) {
                var a = i[r];
                var o = i[r + 1];
                var s = i[r + 2];
                i[r] = a * .393 + o * .769 + s * .189;
                i[r + 1] = a * .349 + o * .686 + s * .168;
                i[r + 2] = a * .272 + o * .534 + s * .131;
                i[r + 3] = i[r + 3];
                i[r] = t * i[r] + n * a;
                i[r + 1] = t * i[r + 1] + n * o;
                i[r + 2] = t * i[r + 2] + n * s;
            }
            delete e.params;
            return e;
        },
        save: function() {
            this.publish("state.added", {
                title: this.title,
                intensity: this.inputRange.getValue() / 100
            });
        },
        reset: function() {
            this.inputRange.resetValue();
        }
    });
    return r;
});

define("pluginSaturation", [ "Widget", "pluginManager", "taskManager", "shortcut" ], function(e, t, i, n) {
    var r = t.extend({
        title: "saturation",
        iconClass: "picsEdit-saturationIcon",
        inputRange: null,
        initialize: function(t) {
            var i = this;
            this.btn = new e.Html({
                classList: [ "slideBtn" ],
                html: [ '<div class="slideBtnTitle ' + this.iconClass + ' arrow">Saturation</div>', '<div class="slideBtnContent"></div>' ].join(""),
                customContainer: t
            });
            this.btn.$el.find(".slideBtnTitle").on("click", this.onClickBtn.bind(this));
        },
        onClickBtn: function() {
            var e = !this.isOpened;
            this.publish("plugin.showed", {
                title: this.title
            });
            if (e) {
                this.open.call(this);
                this.btn.$el.addClass("act");
            }
        },
        start: function() {
            var t = this;
            this.inputRange = new e.InputRange({
                id: "inputRange",
                onChange: function(e) {
                    i.execute(t.apply, {
                        saturation: e / 100,
                        title: t.title
                    });
                },
                defaultValue: 100,
                min: 0,
                max: 200,
                customContainer: this.btn.$el.find(".slideBtnContent")
            });
            this.btnReset = new e.DialogButton({
                customContainer: this.btn.$el.find(".slideBtnContent"),
                click: t.reset.bind(t),
                title: "Reset",
                classList: [ "simpleBtnRS" ]
            });
        },
        apply: function(e) {
            var t = e.params.saturation;
            var i = e.data;
            var n = .3086;
            var r = .6094;
            var a = .082;
            var o = 1 - t;
            var s = o * n;
            var l = o * r;
            var c = o * a;
            for (var u = 0; u < i.length; u += 4) {
                var f = i[u];
                var d = i[u + 1];
                var h = i[u + 2];
                i[u] = f * (s + t) + d * l + h * c;
                i[u + 1] = f * s + d * (l + t) + h * c;
                i[u + 2] = f * s + d * l + h * (c + t);
            }
            return e;
        },
        save: function() {
            this.publish("state.added", {
                title: this.title,
                saturation: this.inputRange.getValue() / 100
            });
        },
        reset: function() {
            this.inputRange.resetValue();
        }
    });
    return r;
});

define("/assets/js/picsio-edit/localization/strings.js", {
    root: {
        plugins: {
            saver: {
                DIALOG_TITLE: "Save",
                FILENAME_LABEL: "File name and type",
                QUALITY_LABEL: "Quality",
                QUALITY_LOW: "Low",
                QUALITY_MEDIUM: "Medium",
                QUALITY_HIGH: "High",
                IMAGESIZE_LABEL: "Image size",
                WIDTH_LABEL: "W",
                HEIGHT_LABEL: "H",
                SAVE_TO_GD_LABEL: "Save to Google Drive",
                UPLOADING_FILE: "Uploading file...",
                FILE_UPLOADED_TPL: "File {1} uploaded!",
                CANT_UPLOAD_FILE: "Can't add file to Google Drive",
                CANCEL_BUTTON: "Cancel",
                OK_BUTTON: "OK",
                DENSITY_LABEL: "Density"
            }
        }
    },
    ru: true,
    it: true,
    pt: true,
    fr: true,
    es: true
});

define("pluginSaver", [ "Widget", "pluginManager", "signal", "utils", "canvas", "shortcut", "GDriveUploader", "LoggingService", "environment", "i18n!/assets/js/picsio-edit/localization/strings.js", "FacebookComponent" ], function(e, t, i, n, r, a, o, s, l, c, u) {
    var f = t.extend({
        type: "",
        size: undefined,
        realSize: undefined,
        currentSize: undefined,
        type: "image/jpeg",
        shortcut: a.file.save,
        initialize: function(t, n) {
            var r = this;
            n = n || {};
            this.items = {};
            i.subscribe("editor.readyToSave", r.enableIcon.bind(r));
            var a = new e.Button({
                click: this.open.bind(this),
                title: c.plugins.saver.DIALOG_TITLE,
                path: "saver",
                type: n.type || "icon",
                parentToolbar: t,
                menuIcon: "saver",
                tooltip: n.tooltip,
                classList: [ "iconEdit_download" ]
            });
            this.registerItem("icon", a);
        },
        open: function(t) {
            this.publish("plugin.showed");
            var r = function() {
                this.isOpened = true;
                console.count("SaverOpen");
                i.subscribeSingle("canvas.save.blob.ready", this.blobReady.bind(this));
                this.start(t);
            }.bind(this);
            if (!editor.isConverter() && !editor.skipFbOnSave() && !n.getCookie("sharedToFB")) {
                new e.Dialog({
                    title: "Share to Facebook",
                    okName: "Share",
                    cancelName: "Cancel",
                    text: "It seems you enjoy editing pictures. Please, help us to spread a word about this application. Share this message among your friends on FaceBook!",
                    onClose: function() {},
                    onOk: function() {
                        u.sharePost("I found pretty cool pictures editor. Check this if you need to edit your photos - http://edit.pics.io.", {
                            appName: "edit"
                        }).then(function() {
                            n.setCookie("sharedToFB", true);
                            r();
                        }).fail(function() {
                            n.setCookie("sharedToFB", true);
                            r();
                        });
                    },
                    onCancel: function() {},
                    classList: [ "textPopup" ]
                });
                return;
            }
            if (!!t.multiple || !editor.isPluginOpen() && !editor.isHold()) {
                r();
            }
        },
        start: function(t) {
            var i = this, a;
            if (!r.wasCropped) {
                a = n.deepCopy(editor.getRealSize());
                this.realSize = n.deepCopy(editor.getRealSize());
                this.currentSize = n.deepCopy(editor.getRealSize());
            } else if (r.wasCropped && !r.wasResized) {
                var o = editor.canvas.cornerMatrix.getCorner(), s, l;
                if (o === "TR" || o === "BR") {
                    s = Math.round(r.floatCoords.h);
                    l = Math.round(r.floatCoords.w);
                } else {
                    s = Math.round(r.floatCoords.w);
                    l = Math.round(r.floatCoords.h);
                }
                a = {
                    width: s,
                    height: l
                };
                this.realSize = {
                    width: s,
                    height: l
                };
                this.currentSize = {
                    width: s,
                    height: l
                };
            } else if (r.wasCropped && r.wasResized) {
                var u = editor.getRealSize().width / editor.getImageData().data.width, o = editor.canvas.cornerMatrix.getCorner(), s, l;
                if (o === "TR" || o === "BR") {
                    s = Math.round(r.floatCoords.h * u);
                    l = Math.round(r.floatCoords.w * u);
                } else {
                    s = Math.round(r.floatCoords.w * u);
                    l = Math.round(r.floatCoords.h * u);
                }
                a = {
                    width: s,
                    height: l
                };
                this.realSize = {
                    width: s,
                    height: l
                };
                this.currentSize = {
                    width: s,
                    height: l
                };
            }
            this.type = "image/jpeg";
            var f = editor.getFileName().split(".")[0];
            var d = function(e) {
                i.publish("editor.execute.save", {
                    resize: e.resize,
                    smartResize: true,
                    quality: e.quality,
                    density: e.density,
                    mimeType: e.type,
                    fileName: [ e.fileName, n.getMimeTypeExtension(e.type) ].join("."),
                    saveToDrive: e.saveToDrive,
                    blobUrl: e.blobUrl,
                    removeBlobAfterSave: e.removeBlobAfterSave,
                    blob: e.blob,
                    multiple: e.multiple
                }, true);
                i.publish("saveToAnalitics", [ "Edit", "SaveFile", "Open" ]);
            };
            if (t.doNotShowDialog === true) {
                var h = {
                    quality: t.quality || .9,
                    density: t.density || {
                        units: 1,
                        x: 72
                    },
                    fileName: t.fileName || "download",
                    type: t.type || "image/jpeg",
                    saveToDrive: t.saveToDrive || false,
                    resize: t.resize,
                    blob: t.blob,
                    blobUrl: t.blobUrl,
                    removeBlobAfterSave: t.removeBlobAfterSave,
                    multiple: t.multiple
                };
                d(h);
                this.close();
            } else {
                var p = this.dialog = new e.Dialog({
                    title: c.plugins.saver.DIALOG_TITLE,
                    onClose: this.close.bind(this),
                    onOk: function() {
                        var e = {
                            resize: i.currentSize.width == i.realSize.width && i.currentSize.height == i.realSize.height ? false : i.currentSize,
                            quality: p.getItem("quality").getValue() / 100 || .9,
                            density: {
                                units: ~~p.getItem("densityType").getValue(),
                                x: ~~p.getItem("inputDensity").getValue()
                            },
                            fileName: p.getItem("fileName").getValue() || "download",
                            type: p.getItem("type").getValue() || "image/jpeg",
                            saveToDrive: p.items.saveToDrive.isChecked()
                        };
                        if (t.optionsInsteadOfSaving && t.optionsInsteadOfSavingCallback) {
                            t.optionsInsteadOfSavingCallback(e);
                        } else {
                            d(e);
                        }
                    },
                    onCancel: function() {},
                    cancelName: c.plugins.saver.CANCEL_BUTTON,
                    okName: c.plugins.saver.OK_BUTTON
                });
                p.addItems([ {
                    item: e.Select,
                    config: {
                        id: "type",
                        label: "",
                        width: 73,
                        styleList: {
                            "float": "right",
                            "margin-top": "30px"
                        },
                        options: [ {
                            text: "jpg",
                            value: "image/jpeg",
                            checked: true,
                            callback: function(e, t) {
                                $(document.querySelector(".inputDensity")).show();
                                $(document.querySelector(".densityType")).show();
                            }
                        }, {
                            text: "png",
                            value: "image/png",
                            callback: function(e, t) {
                                var i = document.querySelector(".inputQuality");
                                i.querySelector(".range").value = 100;
                                $(i.querySelector(".range")).blur();
                                i.querySelector(".range").disabled = true;
                                i.classList.add("disabledInputRange");
                                i.querySelector(".btnsInputrange").classList.add("disabledBtnsInputRange");
                            }
                        }, {
                            text: "webp",
                            value: "image/webp",
                            enabled: navigator.userAgent.indexOf("Chrome") !== -1,
                            callback: function(e, t) {}
                        } ],
                        callback: function(e, t) {
                            i.type = t;
                            var n = document.querySelector(".inputQuality");
                            n.querySelector(".range").disabled = false;
                            n.classList.remove("disabledInputRange");
                            $(document.querySelector(".inputDensity")).hide();
                            $(document.querySelector(".densityType")).hide();
                        }
                    }
                }, {
                    item: e.InputText,
                    config: {
                        id: "fileName",
                        label: c.plugins.saver.FILENAME_LABEL,
                        defaultValue: f,
                        styleList: {
                            width: "225px"
                        }
                    }
                }, {
                    item: e.Hr,
                    config: {}
                }, {
                    item: e.InputRange,
                    config: {
                        id: "quality",
                        label: c.plugins.saver.QUALITY_LABEL,
                        defaultValue: 85,
                        progressStartValue: 0,
                        classList: [ "inputQuality" ],
                        min: 0,
                        max: 100,
                        onChange: function() {
                            for (var e in this.config) {}
                        },
                        chooseBtns: [ {
                            title: c.plugins.saver.QUALITY_LOW,
                            value: 30
                        }, {
                            title: c.plugins.saver.QUALITY_MEDIUM,
                            value: 60
                        }, {
                            title: c.plugins.saver.QUALITY_HIGH,
                            value: 90
                        } ]
                    }
                }, {
                    item: e.Hr,
                    config: {
                        styleList: {
                            "margin-top": "20px"
                        }
                    }
                }, {
                    item: e.Text,
                    config: {
                        label: c.plugins.saver.IMAGESIZE_LABEL,
                        styleList: {
                            "font-size": "16px",
                            color: "#919191",
                            "font-family": "fira_sansbold",
                            display: "block",
                            "margin-bottom": "10px"
                        }
                    }
                }, {
                    item: e.InputText,
                    config: {
                        id: "width",
                        label: c.plugins.saver.WIDTH_LABEL,
                        defaultValue: a.width,
                        classList: [ "imageSizeSaver", "proportionsLockSaver" ],
                        min: 0,
                        max: 1e5,
                        validity: /^\d+$/,
                        onChange: function(e) {
                            i.reCalculateValue.call(i, {
                                width: e
                            });
                        }
                    }
                }, {
                    item: e.InputText,
                    config: {
                        id: "height",
                        label: c.plugins.saver.HEIGHT_LABEL,
                        defaultValue: a.height,
                        classList: [ "imageSizeSaver", "proportionsPxSaver" ],
                        min: 0,
                        max: 1e5,
                        validity: /^\d+$/,
                        onChange: function(e) {
                            i.reCalculateValue.call(i, {
                                height: e
                            });
                        }
                    }
                }, {
                    item: e.Select,
                    config: {
                        id: "densityType",
                        label: "",
                        width: 73,
                        classList: [ "densityType" ],
                        styleList: {
                            "float": "right",
                            "margin-top": "30px",
                            "margin-right": "40px",
                            width: "100px"
                        },
                        options: [ {
                            text: "px/inch",
                            value: 1,
                            checked: true,
                            callback: function(e, t) {}
                        }, {
                            text: "px/cm",
                            value: 2,
                            callback: function(e, t) {}
                        } ],
                        callback: function(e, t) {
                            i.densityType = t;
                        }
                    }
                }, {
                    item: e.InputText,
                    config: {
                        id: "inputDensity",
                        classList: [ "inputDensity" ],
                        label: c.plugins.saver.DENSITY_LABEL,
                        defaultValue: 72,
                        styleList: {
                            width: "calc(100% - 150px)"
                        }
                    }
                }, {
                    item: e.Hr,
                    config: {
                        styleList: {
                            "margin-top": "20px"
                        }
                    }
                }, {
                    item: e.CheckBox,
                    config: {
                        id: "saveToDrive",
                        label: c.plugins.saver.SAVE_TO_GD_LABEL,
                        image: "/assets/img/gd_logo.small.png",
                        switcher: true,
                        styleList: {
                            width: "94%",
                            "margin-left": "3%"
                        },
                        onChange: function(e) {
                            if (e && t.authorizeGDCallback) {
                                t.authorizeGDCallback();
                            }
                        }
                    }
                } ]);
                if (t.hideSaveToDriveOption) {
                    p.getItem("saveToDrive").hide();
                }
            }
        },
        registerItem: function(e, t) {
            this.items[e] = t;
        },
        getItem: function(e) {
            return this.items[e];
        },
        enableIcon: function() {
            var e = this.getItem("icon");
            e.disable = false;
        },
        blobReady: function(e) {
            console.log("blobReady");
            if (e && e.originalParams && !!e.originalParams.saveToDrive) {
                this.saveToGoogleDrive(e);
            } else {
                window.saveAs(e.blob, e.exportName || e.name);
            }
        },
        saveToGoogleDrive: function(e) {
            s.blockui(c.plugins.saver.UPLOADING_FILE);
            var t = gapi.auth.getToken().access_token;
            var i = function(t) {
                s.unblockui();
                s.success(c.plugins.saver.FILE_UPLOADED_TPL.assign(e.name));
            };
            var n = function(e) {
                s.unblockui();
                s.error(c.plugins.saver.CANT_UPLOAD_FILE);
            };
            var r = {
                parent: "root",
                file: e.blob,
                token: t,
                filename: e.name,
                onComplete: i,
                onError: n
            };
            var a = new o(r).upload();
        },
        reCalculateValue: function(e) {
            var t = this, i = parseInt(this.dialog.getItem("width").getValue()), n = parseInt(this.dialog.getItem("height").getValue());
            if (e.width) {
                t.currentSize.width = parseInt(e.width);
                t.currentSize.height = t.realSize.height * parseInt(e.width) / t.realSize.width;
            } else if (e.height) {
                t.currentSize.height = parseInt(e.height);
                t.currentSize.width = t.realSize.width * parseInt(e.height) / t.realSize.height;
            }
            this.rePaint();
        },
        rePaint: function() {
            var e = this.dialog.getItem("width");
            var t = this.dialog.getItem("height");
            e.setValue(Math.round(this.currentSize.width));
            t.setValue(Math.round(this.currentSize.height));
        }
    });
    return f;
});

define("pluginContrast", [ "Widget", "pluginManager", "taskManager" ], function(e, t, i, n, r) {
    var a = t.extend({
        title: "contrast",
        initialize: function(e) {
            var t = this;
            new Widget.Button({
                click: function() {
                    t.publish("saveToAnalitics", [ "Edit", "Contrast", "Open" ]);
                    $(".picsEditPopup").trigger("destroy");
                    var e = this;
                    var i = new Widget.Dialog({
                        title: "contrast",
                        onOk: function() {
                            debugger;
                            t.publish("state.added", {
                                title: t.title,
                                intensity: this.getItem("inputRange").getValue() / 100
                            });
                        },
                        onCancel: function() {
                            debugger;
                            t.publish("state.cancel");
                        }
                    });
                    i.addItem(Widget.InputRange, {
                        id: "inputRange",
                        onChange: function(e) {
                            debugger;
                            r.execute(t.apply, {
                                intensity: e / 100
                            });
                        },
                        defaultValue: 0,
                        min: -99,
                        max: 99
                    });
                },
                title: "Contrast",
                parentToolbar: e,
                menuIcon: "contrast"
            });
        },
        apply: function(e) {
            debugger;
            var t = 1 + e.params.intensity;
            var i = e.data;
            var n = i.length / 4;
            for (var r = 0; r < n; r++) {
                var a = i[r * 4];
                var o = i[r * 4 + 1];
                var s = i[r * 4 + 2];
                var l = .299 * a + .587 * o + .114 * s;
                i[r * 4] = l + t * (a - l);
                i[r * 4 + 1] = l + t * (o - l);
                i[r * 4 + 2] = l + t * (s - l);
            }
            return e;
        },
        execute: function(e, t) {
            delete rgba.params;
            r.execute(this.apply);
        }
    });
    return a;
});

var Histogram = function(e, t) {
    var i = e.histCanvas, n = i.getContext("2d"), r = e.canvas;
    imgCtx = r.getContext("2d");
    var a = {
        red: n.createLinearGradient(0, 0, e.width, 0),
        green: n.createLinearGradient(0, 0, e.width, 0),
        blue: n.createLinearGradient(0, 0, e.width, 0),
        hue: n.createLinearGradient(0, 0, e.width, 0),
        val: n.createLinearGradient(0, 0, e.width, 0),
        cyan: n.createLinearGradient(0, 0, e.width, 0),
        magenta: n.createLinearGradient(0, 0, e.width, 0),
        yellow: n.createLinearGradient(0, 0, e.width, 0),
        kelvin: n.createLinearGradient(0, 0, e.width, 0)
    }, o = {
        red: [ "#000", "#f00" ],
        green: [ "#000", "#0f0" ],
        blue: [ "#000", "#00f" ],
        hue: [ "#f00", "#ff0", "#0f0", "#0ff", "#00f", "#f0f", "#f00" ],
        val: [ "#000", "#fff" ],
        kelvin: [ "#fff", "#000" ],
        cyan: [ "#000", "#0ff" ],
        yellow: [ "#000", "#ff0" ],
        magenta: [ "#000", "#f0f" ]
    }, s = Math.round(i.width / 255), l = null;
    var c = function(e) {
        accuracy = e.accuracy || 1;
        plotStyle = e.plotStyle || "continuous";
        plotColors = e.plotColors || "flat";
        plotFill = e.plotFill || true;
        histType = e.histType || "rgb";
        var t, i, n, r;
        for (t in a) {
            i = o[t];
            t = a[t];
            for (n = 0, r = i.length; n < r; n++) {
                t.addColorStop(n * 1 / (r - 1), i[n]);
            }
        }
    };
    var u = function() {
        console.log(e.width + "x" + e.height);
        l = imgCtx.getImageData(0, 0, e.width, e.height).data;
        h();
    };
    var f = function(e) {
        var t = [ [] ], i = 0, r, a = [ e ];
        if (e === "rgb") {
            t = [ [], [], [] ];
            a = [ "red", "green", "blue" ];
        } else if (e === "cmyk") {
            t = [ [], [], [], [] ];
            a = [ "cyan", "magenta", "yellow", "kelvin" ];
        }
        var o = parseInt(accuracy);
        if (isNaN(o) || o < 1) {
            o = 1;
        } else if (o > 50) {
            o = 50;
        }
        accuracy = o;
        o *= 4;
        for (var s = 0, c = l.length; s < c; s += o) {
            if (e === "rgb" || e === "red" || e === "green" || e === "blue") {
                r = [ l[s], l[s + 1], l[s + 2] ];
            }
            if (e === "red") {
                r = [ r[0] ];
            } else if (e === "green") {
                r = [ r[1] ];
            } else if (e === "blue") {
                r = [ r[2] ];
            }
            for (var u = 0, f = r.length; u < f; u++) {
                if (r[u] in t[u]) {
                    t[u][r[u]]++;
                } else {
                    t[u][r[u]] = 1;
                }
                if (t[u][r[u]] > i) {
                    i = t[u][r[u]];
                }
            }
        }
        if (i === 0) {
            return;
        }
        if (plotFill && t.length > 1) {
            n.globalCompositeOperation = "lighter";
        }
        for (var s = 0, c = t.length; s < c; s++) {
            d(a[s], t[s], i);
        }
        if (plotFill && t.length > 1) {
            n.globalCompositeOperation = "source-over";
        }
    };
    var d = function(e, t, r) {
        var l;
        if (plotFill || plotStyle === "discreet") {
            l = "fillStyle";
            n.strokeStyle = "#000";
        } else {
            l = "strokeStyle";
        }
        if (plotColors === "flat") {
            if (e === "hue") {
                n[l] = a.hue;
            } else if (e in o && e !== "val") {
                n[l] = o[e][1];
            } else {
                n[l] = "#000";
            }
        } else if (plotColors === "gradient") {
            if (e in a) {
                n[l] = a[e];
            } else {
                n[l] = "#000";
            }
        } else if (plotColors === "none") {
            n[l] = "#000";
        }
        if (plotStyle === "continuous") {
            n.beginPath();
            n.moveTo(0, i.height);
        }
        for (var c, u, f = 0; f <= 255; f++) {
            if (!(f in t)) {
                continue;
            }
            u = Math.round(t[f] / r * i.height);
            c = Math.round(f / 255 * i.width);
            if (plotStyle === "continuous") {
                n.lineTo(c, i.height - u);
            } else if (plotStyle === "discreet") {
                if (plotFill) {
                    n.fillRect(c, i.height - u, s, u);
                } else {
                    n.fillRect(c, i.height - u, s, 2);
                }
            }
        }
        if (plotStyle === "continuous") {
            n.lineTo(c, i.height);
            if (plotFill) {
                n.fill();
            }
            n.stroke();
            n.closePath();
        }
    };
    var h = function() {
        console.time("updateHist");
        f(histType);
        var e = new Date().getTime();
        console.timeEnd("updateHist");
    };
    c(e);
    u(e);
};

define("Histogram", [], function() {
    return Histogram;
});

var fn = function(e) {
    var t = function(e, t) {
        var i = {
            lineColor: {
                red: "#ff0000",
                green: "#00ff00",
                blue: "#0000ff",
                rgba: "#ffffff",
                gray: "#636363"
            },
            points: {
                color: {
                    active: "ffa500",
                    passive: "#b0b0b0"
                }
            },
            defaultPoints: [ {
                x: 0,
                y: 0
            }, {
                x: 1,
                y: 1
            } ],
            otherPoints: {}
        };
        if (e.points && e.points[e.color]) {}
        delete e.points[e.color];
        i.otherPoints = e.points;
        this.options = i;
        this.lineColor = i.lineColor[e.color];
        this.template = [ "<div style='display: none; margin-top: 10px;' class='picsEdit-dialog-box'>", '<div class="curvesAxisY"></div>', "<canvas height=260 width=260 style = 'background:#000000; display: block;' id = '" + e.id + "'></canvas>", '<div class="curvesAxisX"></div>', "</div>" ].join("");
        this.params = e;
        this.points = [];
        this.currentpoint = -1;
        this.redraw = 0;
        this.values = [];
        this.rgb = [];
        this.onchange = function() {
            t && t();
        };
        if (this.height != this.width) {
            console.log("ERROR: Canvas must have same width and height.");
            return;
        }
        this.pointLimit = 5;
        this.points = i.defaultPoints.slice();
        this.functions = [];
        this.append();
        var n = this;
        this.c.onmousedown = function(e) {
            n.MouseDown(e);
        };
        this.c.onmouseup = function(e) {
            n.MouseUp(e);
            n.Draw();
            n.onchange();
        };
        this.c.onmouseout = function(e) {
            n.MouseOut(e);
            n.Draw();
        };
        this.c.onmousemove = function(e) {
            n.MouseMove(e);
            if (n.redraw == 1) {
                n.Draw();
                n.redraw = 0;
            }
        };
        this.Draw();
        this.UpdateValues();
    };
    t.prototype.append = function() {
        var e = this.params.container;
        e.appendChild(this.createDocumentFragment(this.template));
        this.c = e.querySelector("#" + this.params.id);
        this.ctx = this.c.getContext("2d");
        this.height = this.c.height;
        this.width = this.c.width;
        this.container = this.c.parentNode;
    };
    t.prototype.addCurve = function(e, t) {
        this.options.otherPoints[e] = t;
        this.Draw();
    };
    t.prototype.getContainer = function() {
        return this.container;
    };
    t.prototype.show = function() {
        this.Draw();
        this.container.style.display = "block";
    };
    t.prototype.hide = function() {
        this.container.style.display = "none";
    };
    t.prototype.createDocumentFragment = function(e) {
        var t = document.createDocumentFragment(), i = document.createElement("div");
        i.innerHTML = e;
        while (i.firstChild) {
            t.appendChild(i.firstChild);
        }
        return t;
    };
    t.prototype.UpdateValues = function() {
        this.rgb.splice(0, this.rgb.length);
        for (var e = 0; e < 256; e++) {
            this.rgb.push(Math.round(this.GetY(e / 255) * 255));
        }
    };
    t.prototype.addPoint = function(e, t) {
        this.points.push({
            x: e,
            y: t
        });
        this.sortPoints({
            x: e,
            y: t
        });
    };
    t.prototype.sortPoints = function(e) {
        this.points = this.points.sort(function(e, t) {
            return e.x - t.x;
        });
        for (var t = 0; t < this.points.length; t++) {
            if (this.points[t].x == e.x && this.points[t].y == e.y) {
                this.activePoint = t;
            }
        }
    };
    t.prototype.IsEqual = function(e, t) {
        if (e.x == t.x && e.y == t.y) return true; else return false;
    };
    t.prototype.reset = function() {
        this.points = this.options.defaultPoints.slice();
        this.activePoint = undefined;
        this.Draw();
        this.onchange();
    };
    t.prototype.removePoint = function() {
        if (this.activePoint && this.activePoint != 0 && this.activePoint != this.points.length - 1) {
            this.points.splice(this.activePoint, 1);
            this.activePoint = undefined;
            this.Draw();
            this.onchange();
        }
    };
    t.prototype.Draw = function() {
        this.values.splice(0, this.values.length);
        this.ctx.clearRect(0, 0, this.width, this.height);
        this.DrawGrid();
        this.DrawHistogram();
        this.functions = [];
        this.DrawLine();
        for (i = 0; i < this.points.length - 1; i++) {
            if (i < 1) {
                p1 = this.points[0];
            } else {
                p1 = this.points[i - 1];
            }
            if (i + 2 > this.points.length - 1) {
                p4 = this.points[i + 1];
            } else {
                p4 = this.points[i + 2];
            }
            this.Quadratic(p1, this.points[i], this.points[i + 1], p4);
        }
        this.DrawPoints();
    };
    t.prototype.DrawLine = function(e) {
        for (var t in this.options.otherPoints) {
            var e = this.options.otherPoints[t];
            for (i = 0; i < e.length - 1; i++) {
                if (i < 1) {
                    p1 = e[0];
                } else {
                    p1 = e[i - 1];
                }
                if (i + 2 > e.length - 1) {
                    p4 = e[i + 1];
                } else {
                    p4 = e[i + 2];
                }
                this.DrawQuadratic(p1, e[i], e[i + 1], p4, t);
            }
        }
    };
    t.prototype.DrawGrid = function() {
        var e = this.width / 10;
        this.ctx.beginPath();
        this.ctx.lineWidth = .5;
        this.ctx.strokeStyle = "#ffffff";
        for (i = 0; i < this.height - e; i += e) {
            this.ctx.moveTo(0, i + e);
            this.ctx.lineTo(this.height, i + e);
        }
        for (i = 0; i < this.height - e; i += e) {
            for (j = 0; j < this.height; j += e) {
                this.ctx.moveTo(i + e, j + 1);
                this.ctx.lineTo(i + e, j + e - 1);
            }
        }
        this.ctx.stroke();
        this.ctx.fill();
    };
    t.prototype.DrawHistogram = function() {
        if (this.params.id == "selectorB") {
            var t = this.params.container.querySelector("#selectorB");
            var i = this.params.canvas;
            var n = new e({
                accuracy: 15,
                canvas: i,
                histCanvas: t,
                width: i.width,
                height: i.height,
                histType: "blue"
            });
        } else if (this.params.id == "selectorR") {
            var t = this.params.container.querySelector("#selectorR");
            var i = this.params.canvas;
            var n = new e({
                accuracy: 15,
                canvas: i,
                histCanvas: t,
                width: i.width,
                height: i.height,
                histType: "red"
            });
        } else if (this.params.id == "selectorG") {
            var t = this.params.container.querySelector("#selectorG");
            var i = this.params.canvas;
            var n = new e({
                accuracy: 15,
                canvas: i,
                histCanvas: t,
                width: i.width,
                height: i.height,
                histType: "green"
            });
        } else if (this.params.id == "selectorRGB") {
            var t = this.params.container.querySelector("#selectorRGB");
            var i = this.params.canvas;
            var n = new e({
                accuracy: 15,
                canvas: i,
                histCanvas: t,
                width: i.width,
                height: i.height,
                histType: "rgb"
            });
        }
    };
    t.prototype.Quadratic = function(e, t, i, n, r) {
        this.ctx.strokeStyle = this.options.lineColor.gray;
        this.ctx.lineWidth = 1.5;
        var a = 0;
        x0 = t.x;
        x3 = i.x;
        y0 = t.y;
        y3 = i.y;
        dx = x3 - x0;
        dy = y3 - y0;
        x1 = 2 * x0 / 3 + x3 / 3;
        x2 = x0 / 3 + 2 * x3 / 3;
        if (this.IsEqual(e, t) && this.IsEqual(i, n)) {
            y1 = y0 + dy / 3;
            y2 = y0 + dy * 2 / 3;
        }
        if (this.IsEqual(e, t) && !this.IsEqual(i, n)) {
            a = (n.y - y0) / (n.x - x0);
            y2 = y3 - a * dx / 3;
            y1 = y0 + (y2 - y0) / 2;
        }
        if (!this.IsEqual(e, t) && this.IsEqual(i, n)) {
            a = (y3 - e.y) / (x3 - e.x);
            y1 = y0 + a * dx / 3;
            y2 = y3 + (y1 - y3) / 2;
        }
        if (!this.IsEqual(e, t) && !this.IsEqual(i, n)) {
            a = (y3 - e.y) / (x3 - e.x);
            y1 = y0 + a * dx / 3;
            a = (n.y - y0) / (n.x - x0);
            y2 = y3 - a * dx / 3;
        }
        this.ctx.beginPath();
        this.ctx.moveTo(x0 * this.width, this.height - y0 * this.height);
        step = (x3 - x0) / 20;
        tx = x0;
        this.functions.push([ y0, y1, y2, y3 ]);
        for (var o = 0; o <= 1.05; o += .05) {
            ty = y0 * Math.pow(1 - o, 3) + 3 * y1 * Math.pow(1 - o, 2) * o + 3 * y2 * (1 - o) * o * o + y3 * o * o * o;
            this.ctx.lineTo(tx * this.width, this.height - ty * this.height);
            this.values.push({
                x: tx,
                y: ty
            });
            tx = tx + step;
        }
        this.ctx.stroke();
        this.ctx.fillStyle = "#00ff00";
        this.ctx.beginPath();
        this.ctx.fill();
        return true;
    };
    t.prototype.DrawQuadratic = function(e, t, i, n, r) {
        this.ctx.strokeStyle = this.options.lineColor[r] || this.lineColor;
        this.ctx.lineWidth = 1;
        var a = 0;
        x0 = t.x;
        x3 = i.x;
        y0 = t.y;
        y3 = i.y;
        dx = x3 - x0;
        dy = y3 - y0;
        x1 = 2 * x0 / 3 + x3 / 3;
        x2 = x0 / 3 + 2 * x3 / 3;
        if (this.IsEqual(e, t) && this.IsEqual(i, n)) {
            y1 = y0 + dy / 3;
            y2 = y0 + dy * 2 / 3;
        }
        if (this.IsEqual(e, t) && !this.IsEqual(i, n)) {
            a = (n.y - y0) / (n.x - x0);
            y2 = y3 - a * dx / 3;
            y1 = y0 + (y2 - y0) / 2;
        }
        if (!this.IsEqual(e, t) && this.IsEqual(i, n)) {
            a = (y3 - e.y) / (x3 - e.x);
            y1 = y0 + a * dx / 3;
            y2 = y3 + (y1 - y3) / 2;
        }
        if (!this.IsEqual(e, t) && !this.IsEqual(i, n)) {
            a = (y3 - e.y) / (x3 - e.x);
            y1 = y0 + a * dx / 3;
            a = (n.y - y0) / (n.x - x0);
            y2 = y3 - a * dx / 3;
        }
        this.ctx.beginPath();
        this.ctx.moveTo(x0 * this.width, this.height - y0 * this.height);
        step = (x3 - x0) / 20;
        tx = x0;
        for (var o = 0; o <= 1.05; o += .05) {
            ty = y0 * Math.pow(1 - o, 3) + 3 * y1 * Math.pow(1 - o, 2) * o + 3 * y2 * (1 - o) * o * o + y3 * o * o * o;
            this.ctx.lineTo(tx * this.width, this.height - ty * this.height);
            tx = tx + step;
        }
        this.ctx.stroke();
        this.ctx.fillStyle = "#00ff00";
        this.ctx.beginPath();
        this.ctx.fill();
        return true;
    };
    t.prototype.DrawPoints = function() {
        for (i = 0; i < this.points.length; i++) {
            if (i == this.activePoint) {
                this.ctx.beginPath();
                this.ctx.fillStyle = this.options.points.color.active;
                this.ctx.moveTo(this.points[i].x * this.width, this.height - this.points[i].y * this.height);
                this.ctx.arc(this.points[i].x * this.width, this.height - this.points[i].y * this.height, 3, 0, 2 * Math.PI, false);
                this.ctx.fill();
            } else {
                this.ctx.beginPath();
                this.ctx.fillStyle = this.options.points.color.passive;
                this.ctx.moveTo(this.points[i].x * this.width, this.height - this.points[i].y * this.height);
                this.ctx.arc(this.points[i].x * this.width, this.height - this.points[i].y * this.height, 3, 0, 2 * Math.PI, false);
                this.ctx.fill();
            }
        }
    };
    t.prototype.MouseDown = function(e) {
        var t = this;
        var n = function(e, i, n) {
            var r = t.points[n].x;
            var a = t.points[n].y;
            return Math.sqrt(Math.pow(r - e, 2) + Math.pow(a - i, 2));
        };
        if (!e) var e = window.event;
        var r = e.layerX / this.width, a = e.layerY / this.height;
        dis = 1e4;
        punto = -1;
        for (i = 0; i < this.points.length; i++) {
            x1 = r - this.points[i].x;
            y1 = a - (1 - this.points[i].y);
            tdis = x1 * x1 + y1 * y1;
            tdis = Math.sqrt(tdis);
            if (tdis < dis) {
                dis = tdis;
                punto = i;
            }
        }
        console.log("dist : " + n(r, 1 - a, punto));
        if (n(r, 1 - a, punto) > .05 && this.pointLimit > this.points.length) {
            this.addPoint(r, 1 - a);
            document.body.style.cursor = "move";
        } else if (dis < 8) {
            this.activePoint = this.currentpoint = punto;
        } else {
            console.log("newPoint");
        }
    };
    t.prototype.MouseUp = function(e) {
        this.UpdateValues();
        this.currentpoint = -1;
    };
    t.prototype.MouseOut = function(e) {
        if (this.currentpoint != -1) {
            this.UpdateValues();
        }
        this.currentpoint = -1;
    };
    t.prototype.MouseMove = function(e) {
        var t = e.layerX / this.width, i = 1 - e.layerY / this.height;
        var n, r, a, o = Infinity, s, l = this;
        var c = function(e, t, i) {
            var n = l.points[i].x;
            var r = l.points[i].y;
            return Math.sqrt(Math.pow(n - e, 2) + Math.pow(r - t, 2));
        };
        if (this.currentpoint == -1) {
            var u = 0;
            for (var f = 0; f < this.points.length; f++) {
                a = c(t, i, f);
                if (a < .05) {
                    document.body.style.cursor = "move";
                    u++;
                }
            }
            if (!u) {
                document.body.style.cursor = "";
            }
            return;
        }
        if (this.currentpoint > 0) prevx = this.points[this.currentpoint - 1].x; else prevx = 0;
        if (this.currentpoint == this.points.length - 1) {
            nextx = 1;
        } else {
            nextx = this.points[this.currentpoint + 1].x;
        }
        if (t > prevx && t < nextx) {
            this.points[this.currentpoint].x = t;
            this.points[this.currentpoint].y = i;
            this.redraw = 1;
        } else {
            this.currentpoint = -1;
            this.removePoint();
            return;
        }
    };
    t.prototype.GetY = function(e) {
        if (e < this.values[0].x) e = this.values[0].x;
        if (e > this.values[this.values.length - 1].x) e = this.values[this.values.length - 1].x;
        for (var t = 0; t < this.values.length - 2; t++) {
            if (e >= this.values[t].x && e < this.values[t + 1].x) break;
        }
        var i = (e - this.values[t].x) / (this.values[t + 1].x - this.values[t].x);
        var n = i * (this.values[t + 1].y - this.values[t].y);
        var r = this.values[t].y + n;
        if (r < 0) return 0;
        if (r > 1) return 1;
        return r;
    };
    return t;
};

define("ColorCurve", [ "Histogram" ], function(e) {
    return fn(e);
});

define("pluginCurves", [ "Widget", "pluginManager", "ColorCurve", "taskManager", "canvas", "utils", "shortcut" ], function(e, t, i, n, r, a, o) {
    var s = t.extend({
        title: "curves",
        iconClass: "iconEdit_curves",
        shortcut: o.color.curves,
        initialize: function(t) {
            var i = this;
            this.points = {};
            this.btn = new e.Html({
                classList: [ "slideBtn" ],
                html: [ '<div class="slideBtnTitle ' + this.iconClass + ' arrow">Curves</div>', '<div class="slideBtnContent"></div>' ].join(""),
                customContainer: t
            });
            this.btn.$el.find(".slideBtnTitle").on("click", this.onClickBtn.bind(this));
        },
        onClickBtn: function() {
            var e = !this.isOpened;
            this.publish("plugin.showed", {
                title: this.title
            });
            if (e) {
                this.open.call(this);
                this.btn.$el.addClass("act");
            }
        },
        start: function() {
            this.renderDialog();
        },
        preparePoint: function(e) {
            var t = this;
            return {
                title: t.title,
                functionsR: t.preparePointsArray(t.curves.red.functions, 4),
                pointsR: t.preparePointsArray(t.curves.red.points, 5),
                functionsG: t.preparePointsArray(t.curves.green.functions, 4),
                pointsG: t.preparePointsArray(t.curves.green.points, 5),
                functionsB: t.preparePointsArray(t.curves.blue.functions, 4),
                pointsB: t.preparePointsArray(t.curves.blue.points, 5),
                functionsT: t.preparePointsArray(t.curves.rgba.functions, 4),
                pointsT: t.preparePointsArray(t.curves.rgba.points, 5)
            };
        },
        getPoints: function() {
            var e = this;
            return {
                red: e.curves.red.points.slice(),
                green: e.curves.green.points.slice(),
                blue: e.curves.blue.points.slice(),
                rgba: e.curves.rgba.points.slice()
            };
        },
        addOtherCurvesPoints: function(e) {
            var t = this;
            if (e !== "red") {
                t.curves.red.addCurve(e, t.curves[e].points.slice());
            }
            if (e !== "green") {
                t.curves.green.addCurve(e, t.curves[e].points.slice());
            }
            if (e !== "blue") {
                t.curves.blue.addCurve(e, t.curves[e].points.slice());
            }
            if (e !== "rgba") {
                t.curves.rgba.addCurve(e, t.curves[e].points.slice());
            }
        },
        curves: {},
        renderDialog: function() {
            var t = this;
            this.select = new e.Select({
                id: "colorChannel",
                styleList: {
                    width: "80px",
                    position: "absolute",
                    right: "0",
                    bottom: "20px"
                },
                customContainer: this.btn.$el.find(".slideBtnContent"),
                options: [ {
                    text: "RGB",
                    value: "RGB",
                    checked: true,
                    beforeOnLoad: function() {
                        t.curves.rgba = new i({
                            id: "selectorRGB",
                            color: "rgba",
                            container: t.btn.$el.find(".slideBtnContent")[0],
                            canvas: r.getCachedCanvas(),
                            points: a.deepCopy(t.points)
                        }, function() {
                            if (!t.curves.rgba) return;
                            t.points = t.getPoints();
                            t.addOtherCurvesPoints("rgba");
                            n.execute(t.apply, t.preparePoint("rgba"));
                        });
                        new e.DialogButton({
                            container: t.curves.rgba.getContainer(),
                            click: t.curves.rgba.removePoint.bind(t.curves.rgba),
                            title: "Remove point",
                            classList: [ "simpleBtnRS" ]
                        });
                        new e.DialogButton({
                            container: t.curves.rgba.getContainer(),
                            click: t.curves.rgba.reset.bind(t.curves.rgba),
                            title: "Reset",
                            classList: [ "simpleBtnRS" ]
                        });
                        t.curves.rgba.show();
                    },
                    callback: function(e, i) {
                        for (var n in t.curves) {
                            var r = t.curves[n];
                            r.hide();
                        }
                        t.curves.rgba.show();
                    }
                }, {
                    text: "Red",
                    value: "R",
                    beforeOnLoad: function() {
                        t.curves.red = new i({
                            id: "selectorR",
                            color: "red",
                            container: t.btn.$el.find(".slideBtnContent")[0],
                            canvas: r.getCachedCanvas(),
                            points: a.deepCopy(t.points)
                        }, function() {
                            if (!t.curves.red) return;
                            t.points = t.getPoints();
                            t.addOtherCurvesPoints("red");
                            n.execute(t.apply, t.preparePoint("red"));
                        });
                        new e.DialogButton({
                            container: t.curves.red.getContainer(),
                            click: t.curves.red.removePoint.bind(t.curves.red),
                            title: "Remove point",
                            classList: [ "simpleBtnRS" ]
                        });
                        new e.DialogButton({
                            container: t.curves.red.getContainer(),
                            click: t.curves.red.reset.bind(t.curves.red),
                            title: "Reset",
                            classList: [ "simpleBtnRS" ]
                        });
                    },
                    callback: function(e, i) {
                        for (var n in t.curves) {
                            var r = t.curves[n];
                            r.hide();
                        }
                        t.curves.red.show();
                    }
                }, {
                    text: "Green",
                    value: "G",
                    beforeOnLoad: function() {
                        t.curves.green = new i({
                            id: "selectorG",
                            color: "green",
                            container: t.btn.$el.find(".slideBtnContent")[0],
                            canvas: r.getCachedCanvas(),
                            points: a.deepCopy(t.points)
                        }, function() {
                            if (!t.curves.green) return;
                            t.points = t.getPoints();
                            t.addOtherCurvesPoints("green");
                            n.execute(t.apply, t.preparePoint("green"));
                        });
                        new e.DialogButton({
                            container: t.curves.green.getContainer(),
                            click: t.curves.green.removePoint.bind(t.curves.green),
                            title: "Remove point",
                            classList: [ "simpleBtnRS" ]
                        });
                        new e.DialogButton({
                            container: t.curves.green.getContainer(),
                            click: t.curves.green.reset.bind(t.curves.green),
                            title: "Reset",
                            classList: [ "simpleBtnRS" ]
                        });
                    },
                    callback: function(e, i) {
                        for (var n in t.curves) {
                            var r = t.curves[n];
                            r.hide();
                        }
                        t.curves.green.show();
                    }
                }, {
                    text: "Blue",
                    value: "B",
                    beforeOnLoad: function() {
                        t.curves.blue = new i({
                            id: "selectorB",
                            color: "blue",
                            container: t.btn.$el.find(".slideBtnContent")[0],
                            canvas: r.getCachedCanvas(),
                            points: a.deepCopy(t.points)
                        }, function() {
                            if (!t.curves.blue) return;
                            t.points = t.getPoints();
                            t.addOtherCurvesPoints("blue");
                            n.execute(t.apply, t.preparePoint("blue"));
                        });
                        new e.DialogButton({
                            container: t.curves.blue.getContainer(),
                            click: t.curves.blue.removePoint.bind(t.curves.blue),
                            title: "Remove point",
                            classList: [ "simpleBtnRS" ]
                        });
                        new e.DialogButton({
                            container: t.curves.blue.getContainer(),
                            click: t.curves.blue.reset.bind(t.curves.blue),
                            title: "Reset",
                            classList: [ "simpleBtnRS" ]
                        });
                    },
                    callback: function(e, i) {
                        for (var n in t.curves) {
                            var r = t.curves[n];
                            r.hide();
                        }
                        t.curves.blue.show();
                    }
                } ],
                callback: function(e, t) {}
            });
        },
        preparePointsArray: function(e, t) {
            cArray = e.slice(0);
            while (cArray.length < t) {
                cArray.push(cArray[cArray.length - 1]);
            }
            return cArray;
        },
        clear: function() {
            this.points = {};
        },
        apply: function(e) {
            var t = e.data, i = e.params.functionsR, n = e.params.pointsR, r = e.params.functionsG, a = e.params.pointsG, o = e.params.functionsB, s = e.params.pointsB, l = e.params.functionsT, c = e.params.pointsT, u = t.length / 4;
            while (u--) {
                var f = t[u * 4] / 255;
                var d = 0;
                if (n[0].x <= f && f <= n[1].x) {
                    d = (f - n[0].x) / (n[1].x - n[0].x);
                    t[u * 4] = 255 * (i[0][0] * Math.pow(1 - d, 3) + 3 * i[0][1] * Math.pow(1 - d, 2) * d + 3 * i[0][2] * (1 - d) * d * d + i[0][3] * d * d * d);
                } else if (n[1].x <= f && f <= n[2].x) {
                    d = (f - n[1].x) / (n[2].x - n[1].x);
                    t[u * 4] = 255 * (i[1][0] * Math.pow(1 - d, 3) + 3 * i[1][1] * Math.pow(1 - d, 2) * d + 3 * i[1][2] * (1 - d) * d * d + i[1][3] * d * d * d);
                } else if (n[2].x <= f && f <= n[3].x) {
                    d = (f - n[2].x) / (n[3].x - n[2].x);
                    t[u * 4] = 255 * (i[2][0] * Math.pow(1 - d, 3) + 3 * i[2][1] * Math.pow(1 - d, 2) * d + 3 * i[2][2] * (1 - d) * d * d + i[2][3] * d * d * d);
                } else if (n[3].x <= f && f <= n[4].x) {
                    d = (f - n[3].x) / (n[4].x - n[3].x);
                    t[u * 4] = 255 * (i[3][0] * Math.pow(1 - d, 3) + 3 * i[3][1] * Math.pow(1 - d, 2) * d + 3 * i[3][2] * (1 - d) * d * d + i[3][3] * d * d * d);
                }
                f = t[u * 4 + 1] / 255;
                if (a[0].x <= f && f <= a[1].x) {
                    d = (f - a[0].x) / (a[1].x - a[0].x);
                    t[u * 4 + 1] = 255 * (r[0][0] * Math.pow(1 - d, 3) + 3 * r[0][1] * Math.pow(1 - d, 2) * d + 3 * r[0][2] * (1 - d) * d * d + r[0][3] * d * d * d);
                } else if (a[1].x <= f && f <= a[2].x) {
                    d = (f - a[1].x) / (a[2].x - a[1].x);
                    t[u * 4 + 1] = 255 * (r[1][0] * Math.pow(1 - d, 3) + 3 * r[1][1] * Math.pow(1 - d, 2) * d + 3 * r[1][2] * (1 - d) * d * d + r[1][3] * d * d * d);
                } else if (a[2].x <= f && f <= a[3].x) {
                    d = (f - a[2].x) / (a[3].x - a[2].x);
                    t[u * 4 + 1] = 255 * (r[2][0] * Math.pow(1 - d, 3) + 3 * r[2][1] * Math.pow(1 - d, 2) * d + 3 * r[2][2] * (1 - d) * d * d + r[2][3] * d * d * d);
                } else if (a[3].x <= f && f <= a[4].x) {
                    d = (f - a[3].x) / (a[4].x - a[3].x);
                    t[u * 4 + 1] = 255 * (r[3][0] * Math.pow(1 - d, 3) + 3 * r[3][1] * Math.pow(1 - d, 2) * d + 3 * r[3][2] * (1 - d) * d * d + r[3][3] * d * d * d);
                }
                f = t[u * 4 + 2] / 255;
                d = 0;
                if (s[0].x <= f && f <= s[1].x) {
                    d = (f - s[0].x) / (s[1].x - s[0].x);
                    t[u * 4 + 2] = 255 * (o[0][0] * Math.pow(1 - d, 3) + 3 * o[0][1] * Math.pow(1 - d, 2) * d + 3 * o[0][2] * (1 - d) * d * d + o[0][3] * d * d * d);
                } else if (s[1].x <= f && f <= s[2].x) {
                    d = (f - s[1].x) / (s[2].x - s[1].x);
                    t[u * 4 + 2] = 255 * (o[1][0] * Math.pow(1 - d, 3) + 3 * o[1][1] * Math.pow(1 - d, 2) * d + 3 * o[1][2] * (1 - d) * d * d + o[1][3] * d * d * d);
                } else if (s[2].x <= f && f <= s[3].x) {
                    d = (f - s[2].x) / (s[3].x - s[2].x);
                    t[u * 4 + 2] = 255 * (o[2][0] * Math.pow(1 - d, 3) + 3 * o[2][1] * Math.pow(1 - d, 2) * d + 3 * o[2][2] * (1 - d) * d * d + o[2][3] * d * d * d);
                } else if (s[3].x <= f && f <= s[4].x) {
                    d = (f - s[3].x) / (s[4].x - s[3].x);
                    t[u * 4 + 2] = 255 * (o[3][0] * Math.pow(1 - d, 3) + 3 * o[3][1] * Math.pow(1 - d, 2) * d + 3 * o[3][2] * (1 - d) * d * d + o[3][3] * d * d * d);
                }
            }
            u = t.length / 4;
            while (u--) {
                var f = t[u * 4] / 255;
                var d = 0;
                if (c[0].x <= f && f <= c[1].x) {
                    d = (f - c[0].x) / (c[1].x - c[0].x);
                    t[u * 4] = 255 * (l[0][0] * Math.pow(1 - d, 3) + 3 * l[0][1] * Math.pow(1 - d, 2) * d + 3 * l[0][2] * (1 - d) * d * d + l[0][3] * d * d * d);
                } else if (c[1].x <= f && f <= c[2].x) {
                    d = (f - c[1].x) / (c[2].x - c[1].x);
                    t[u * 4] = 255 * (l[1][0] * Math.pow(1 - d, 3) + 3 * l[1][1] * Math.pow(1 - d, 2) * d + 3 * l[1][2] * (1 - d) * d * d + l[1][3] * d * d * d);
                } else if (c[2].x <= f && f <= c[3].x) {
                    d = (f - c[2].x) / (c[3].x - c[2].x);
                    t[u * 4] = 255 * (l[2][0] * Math.pow(1 - d, 3) + 3 * l[2][1] * Math.pow(1 - d, 2) * d + 3 * l[2][2] * (1 - d) * d * d + l[2][3] * d * d * d);
                } else if (c[3].x <= f && f <= c[4].x) {
                    d = (f - c[3].x) / (c[4].x - c[3].x);
                    t[u * 4] = 255 * (l[3][0] * Math.pow(1 - d, 3) + 3 * l[3][1] * Math.pow(1 - d, 2) * d + 3 * l[3][2] * (1 - d) * d * d + l[3][3] * d * d * d);
                }
                f = t[u * 4 + 1] / 255;
                if (c[0].x <= f && f <= c[1].x) {
                    d = (f - c[0].x) / (c[1].x - c[0].x);
                    t[u * 4 + 1] = 255 * (l[0][0] * Math.pow(1 - d, 3) + 3 * l[0][1] * Math.pow(1 - d, 2) * d + 3 * l[0][2] * (1 - d) * d * d + l[0][3] * d * d * d);
                } else if (c[1].x <= f && f <= c[2].x) {
                    d = (f - c[1].x) / (c[2].x - c[1].x);
                    t[u * 4 + 1] = 255 * (l[1][0] * Math.pow(1 - d, 3) + 3 * l[1][1] * Math.pow(1 - d, 2) * d + 3 * l[1][2] * (1 - d) * d * d + l[1][3] * d * d * d);
                } else if (c[2].x <= f && f <= c[3].x) {
                    d = (f - c[2].x) / (c[3].x - c[2].x);
                    t[u * 4 + 1] = 255 * (l[2][0] * Math.pow(1 - d, 3) + 3 * l[2][1] * Math.pow(1 - d, 2) * d + 3 * l[2][2] * (1 - d) * d * d + l[2][3] * d * d * d);
                } else if (c[3].x <= f && f <= c[4].x) {
                    d = (f - c[3].x) / (c[4].x - c[3].x);
                    t[u * 4 + 1] = 255 * (l[3][0] * Math.pow(1 - d, 3) + 3 * l[3][1] * Math.pow(1 - d, 2) * d + 3 * l[3][2] * (1 - d) * d * d + l[3][3] * d * d * d);
                }
                f = t[u * 4 + 2] / 255;
                d = 0;
                if (c[0].x <= f && f <= c[1].x) {
                    d = (f - c[0].x) / (c[1].x - c[0].x);
                    t[u * 4 + 2] = 255 * (l[0][0] * Math.pow(1 - d, 3) + 3 * l[0][1] * Math.pow(1 - d, 2) * d + 3 * l[0][2] * (1 - d) * d * d + l[0][3] * d * d * d);
                } else if (c[1].x <= f && f <= c[2].x) {
                    d = (f - c[1].x) / (c[2].x - c[1].x);
                    t[u * 4 + 2] = 255 * (l[1][0] * Math.pow(1 - d, 3) + 3 * l[1][1] * Math.pow(1 - d, 2) * d + 3 * l[1][2] * (1 - d) * d * d + l[1][3] * d * d * d);
                } else if (c[2].x <= f && f <= c[3].x) {
                    d = (f - c[2].x) / (c[3].x - c[2].x);
                    t[u * 4 + 2] = 255 * (l[2][0] * Math.pow(1 - d, 3) + 3 * l[2][1] * Math.pow(1 - d, 2) * d + 3 * l[2][2] * (1 - d) * d * d + l[2][3] * d * d * d);
                } else if (c[3].x <= f && f <= c[4].x) {
                    d = (f - c[3].x) / (c[4].x - c[3].x);
                    t[u * 4 + 2] = 255 * (l[3][0] * Math.pow(1 - d, 3) + 3 * l[3][1] * Math.pow(1 - d, 2) * d + 3 * l[3][2] * (1 - d) * d * d + l[3][3] * d * d * d);
                }
            }
            return e;
        },
        save: function() {
            this.publish("state.added", {
                title: this.title,
                functionsR: this.preparePointsArray(this.curves.red.functions, 4),
                pointsR: this.preparePointsArray(this.curves.red.points, 5),
                functionsG: this.preparePointsArray(this.curves.green.functions, 4),
                pointsG: this.preparePointsArray(this.curves.green.points, 5),
                functionsB: this.preparePointsArray(this.curves.blue.functions, 4),
                pointsB: this.preparePointsArray(this.curves.blue.points, 5),
                functionsT: this.preparePointsArray(this.curves.rgba.functions, 4),
                pointsT: this.preparePointsArray(this.curves.rgba.points, 5)
            });
            this.clear();
        }
    });
    return s;
});

define("pluginCrop", [ "Widget", "pluginManager", "taskManager", "signal", "utils", "crop", "canvas", "shortcut" ], function(e, t, i, n, r, a, o, s) {
    return t.extend({
        title: "crop",
        iconClass: "iconEdit_crop",
        shortcut: s.transformations.crop,
        runningMode: "mainThread",
        modificationType: "state",
        cropped: false,
        initialize: function(t) {
            var i = this;
            this.cropCallback = function(e, t, r, a) {
                e.quickDraw(0, 0, r);
                i.cropped = true;
                t.style.setProperty("display", "none");
                e.wasCropped = true;
                i.publish("state.added", {
                    title: i.title,
                    coords: a
                }, true);
                n.publish("editor.update.imageData");
            };
            var r = new e.Html({
                classList: [ "slideBtn" ],
                html: [ '<div class="slideBtnTitle ' + this.iconClass + '">Crop</div>', '<div class="slideBtnContent"></div>' ].join(""),
                customContainer: t
            });
            r.$el.find(".slideBtnTitle").on("click", function() {
                i.publish("plugin.showed", {
                    title: i.title
                });
                i.start();
            });
            r.state = true;
            a.attachListenersForOverlayCanvas(r);
            n.subscribe("CloseCropMode", function() {
                if (i.cropped) {
                    i.cropped = false;
                    i.publish("state.added", {
                        title: i.title,
                        coords: 0
                    }, true);
                }
            });
        },
        start: function() {
            var e = this;
            e.publish("saveToAnalitics", [ "Edit", "Crop", "Open" ]);
            if (!o.wasCropped) {
                e.apply();
            } else {
                e.uncrop();
            }
            e.state = !e.state;
            this.isOpened = false;
        },
        state: true,
        crop: null,
        uncrop: function() {
            var e = this;
            n.publish("editor.crop.end");
        },
        apply: function(e, t) {
            var i = this;
            if (e === undefined) {
                n.publish("editor.crop.start", {
                    callback: i.cropCallback
                }, true);
            } else if (!e) {
                if (t && t.coords) {
                    n.publish("cropByCoords", t, true);
                } else {
                    n.publish("restoreCrop", {}, true);
                }
            } else {
                t = editor.undoManager.findPreviousOperationByTitle(i.title);
                if (t && t.coords) {
                    n.publish("cropByCoords", t, true);
                } else {
                    n.publish("restoreCrop", {}, true);
                }
            }
            editor.btnAdjustmentsHandlers.hide();
        }
    });
});

define("pluginUndo", [ "Widget", "pluginManager", "shortcut" ], function(e, t, i) {
    var n = t.extend({
        initialize: function(t, n) {
            var r = new e.Button({
                title: "undo",
                path: "undo",
                parentToolbar: t,
                click: this.undo.bind(this),
                type: "icon",
                className: "iconEdit_arrowUndo disabled",
                tooltip: n.tooltip[0]
            });
            var a = new e.Button({
                title: "undo",
                path: "undo",
                parentToolbar: t,
                click: this.redo.bind(this),
                type: "icon",
                className: "iconEdit_arrowRedo disabled",
                tooltip: n.tooltip[1]
            });
            this.keyListener.register_combo({
                keys: i.other.redo.value.toLowerCase(),
                on_keyup: this.redo.bind(this),
                is_exclusive: i.other.redo.is_exclusive
            });
            this.keyListener.register_combo({
                keys: i.other.undo.value.toLowerCase(),
                on_keyup: this.undo.bind(this),
                is_exclusive: i.other.undo.is_exclusive
            });
            this.subscribe("state.list:changed", function(e) {
                console.log(e.currentPosition);
                e.currentPosition === 0 ? r.$el.find(".itemIcon").addClass("disabled") : r.$el.find(".itemIcon").removeClass("disabled");
                e.currentPosition >= e.length ? a.$el.find(".itemIcon").addClass("disabled") : a.$el.find(".itemIcon").removeClass("disabled");
            });
        },
        undo: function(e) {
            console.log("undo");
            this.publish("undo", {}, true);
            this.publish("saveToAnalitics", [ "Edit", "Undo", "MakeUndo" ]);
        },
        redo: function() {
            console.log("redo");
            this.publish("redo", {}, true);
            this.publish("saveToAnalitics", [ "Edit", "Undo", "Make Redo" ]);
        }
    });
    return n;
});

define("color", [], function() {
    var e = function() {
        return {
            decimalColorToHex: function(e) {
                e[3] /= 255;
                var e = "rgba(" + e.join(",") + ")";
                return e;
            },
            parsePickerColorArray: function(e) {
                for (var t = 0; t < e.length; t++) {
                    var i = e[t];
                    for (var n = 0; n < i.length; n++) {
                        i[n] = this.decimalColorToHex(i[n].map(function(e) {
                            return Math.round(e);
                        }));
                    }
                }
                return e;
            },
            hexStringToArray: function(e) {
                e = e.substring(1);
                return [ parseInt(e.substring(0, 2), 16), parseInt(e.substring(2, 4), 16), parseInt(e.substring(4, 6), 16), 1 ];
            }
        };
    };
    return new e();
});

define("colorDropperUi", [ "uiObject", "mustache", "color", "signal" ], function(e, t, i, n) {
    return e.extend({
        initialize: function() {
            this.template = t.render(this.template, {
                bg: this.config.colors,
                r: this.config.mainColor.r || 255,
                g: this.config.mainColor.g || 255,
                b: this.config.mainColor.b || 255
            });
            this.config.container = this.config.parentToolbar;
            this.elem = this.render();
            this.elem.css("left", this.config.position.x);
            this.elem.css("top", this.config.position.y);
            var e = $(this.elem.find(".picker-cell")[12]).append("<img src ='assets/img/editor/presize.png' />");
            this.bindEvents();
            document.body.style.cursor = "crosshair";
        },
        changeColor: function(e) {
            var t = document.querySelectorAll(".color-dropper .picker-cell");
            for (var i = 0; i < t.length; i++) {
                t[i].style.background = e[i];
            }
        },
        mouseMove: function(e) {
            var t = this, n = editor.canvas, r = n.getTranformPoint(e.clientX, e.clientY), a = editor.getImageData();
            r.x = Math.floor(r.x);
            r.y = Math.floor(r.y);
            try {
                var o = this.mainColor = a.getPixel(r.x, r.y).map(function(e) {
                    return Math.round(e);
                });
                var s = a.getPixelsRange(r.x, r.y, 5);
            } catch (e) {
                return;
            }
            var l = i.parsePickerColorArray(s), c = [];
            for (var u = 0; u < l.length; u++) {
                c = c.concat(l[u]);
            }
            t.changeColor(c);
            t.elem.css("left", e.clientX + 10);
            t.elem.css("top", e.clientY + 10);
            if (o[0].toString() === "NaN") {
                o = o.map(function() {
                    return 255;
                });
            }
            t.elem.find(".red").text("R: " + o[0] || 255);
            t.elem.find(".green").text("G: " + o[1] || 255);
            t.elem.find(".blue").text("B: " + o[2] || 255);
        },
        mouseLeave: function() {
            n.publish("closeColorPicker");
        },
        mouseClick: function() {
            n.publish("setCanvasColor", {
                color: this.mainColor
            });
            n.publish("closeColorPicker");
        },
        bindEvents: function() {
            var e = editor.canvas;
            var t = e.getCanvas();
            var i = this;
            i.mouseMove = i.mouseMove.bind(i);
            i.mouseLeave = i.mouseLeave.bind(i);
            i.mouseClick = i.mouseClick.bind(i);
            t.addEventListener("mousemove", i.mouseMove);
            t.addEventListener("click", i.mouseClick);
        },
        remove: function() {
            this.elem.remove();
            var e = editor.canvas;
            var t = e.getCanvas();
            var i = this;
            t.removeEventListener("mousemove", i.mouseMove);
            t.removeEventListener("mouseleave", i.mouseLeave);
            t.removeEventListener("click", i.mouseClick);
            document.body.style.cursor = "default";
        },
        template: [ "<div class = 'color-dropper'>", "{{#bg}}", "<div class = 'picker-cell' style = 'background:{{.}};'></div>", "{{/bg}}", "<div class = 'rgb-field'>", "<span class = 'red'>R: {{r}}</span>", "<span class = 'green'>G: {{g}}</span>", "<span class = 'blue'>B: {{b}}</span>", "</div>", "</div>" ].join("")
    });
});

define("pluginColorPicker", [ "Widget", "pluginManager", "taskManager", "signal", "colorDropperUi", "color" ], function(e, t, i, n, r, a) {
    var o = t.extend({
        active: false,
        initialize: function(t, i) {
            var r = this;
            var a = new e.Button({
                click: function(e) {
                    r.toggleState();
                    if (r.isActive()) {
                        r.start(e);
                    } else {
                        r.remove();
                    }
                },
                title: "colorpicker",
                parentToolbar: t,
                type: "icon",
                className: "iconEdit_pipette",
                tooltip: i.tooltip || null
            });
            n.subscribe("closeColorPicker", function() {
                r.toggleState();
                r.remove();
            });
        },
        toggleState: function() {
            this.active = !this.active;
        },
        isActive: function() {
            return this.active;
        },
        start: function(e) {
            var t = editor.getImageData(), i = this;
            i.publish("saveToAnalitics", [ "Edit", "Colorpicker", "Open" ]);
            var n = t.getPixelsRange(0, 0, 5);
            var o = t.getPixel(2, 2).map(function(e) {
                return e;
            });
            var s = a.parsePickerColorArray(n), l = [];
            for (var c = 0; c < s.length; c++) {
                l = l.concat(s[c]);
            }
            i.colorDropper = new r({
                mainColor: {
                    r: Math.round(o[0]),
                    g: Math.round(o[1]),
                    b: Math.round(o[2])
                },
                colors: l,
                parentToolbar: document.body,
                position: {
                    x: e.clientX + 10,
                    y: e.clientY + 10
                }
            });
            this.handlerKeyup = this.keyup.bind(this);
            $(document).on("keyup", this.handlerKeyup);
        },
        keyup: function(e) {
            if (e.keyCode === 27) {
                this.toggleState();
                this.remove();
            }
        },
        remove: function() {
            this.colorDropper.remove();
            this.colorDropper = null;
            $(document).off("keyup", this.handlerKeyup);
        }
    });
    return o;
});

define("pluginBrightness", [ "Widget", "pluginManager", "taskManager", "shortcut" ], function(e, t, i, n) {
    var r = t.extend({
        title: "brightness",
        iconClass: "iconEdit_brightness",
        inputRangeBrightness: null,
        inputRangeContrast: null,
        initialize: function(t) {
            var i = this;
            this.btn = new e.Html({
                classList: [ "slideBtn" ],
                html: [ '<div class="slideBtnTitle ' + this.iconClass + ' arrow">Brightness/Contrast</div>', '<div class="slideBtnContent"></div>' ].join(""),
                customContainer: t
            });
            this.btn.$el.find(".slideBtnTitle").on("click", this.onClickBtn.bind(this));
        },
        onClickBtn: function() {
            var e = !this.isOpened;
            this.publish("plugin.showed", {
                title: this.title
            });
            if (e) {
                this.open.call(this);
                this.btn.$el.addClass("act");
            }
        },
        start: function() {
            var t = this;
            this.inputRangeBrightness = new e.InputRange({
                id: "brightness",
                onChange: function(e) {
                    i.execute(t.apply.bind(t), {
                        title: t.title,
                        brightness: t.inputRangeBrightness.getValue() / 1e3,
                        contrast: t.inputRangeContrast.getValue() / 100
                    });
                },
                defaultValue: 0,
                min: -300,
                max: 500,
                label: "Brightness",
                customContainer: this.btn.$el.find(".slideBtnContent")
            });
            this.inputRangeContrast = new e.InputRange({
                id: "contrast",
                onChange: function(e) {
                    i.execute(t.apply.bind(t), {
                        title: t.title,
                        brightness: t.inputRangeBrightness.getValue() / 1e3,
                        contrast: t.inputRangeContrast.getValue() / 100
                    });
                },
                defaultValue: 100,
                min: 0,
                max: 500,
                label: "Contrast",
                customContainer: this.btn.$el.find(".slideBtnContent")
            });
            this.btnReset = new e.DialogButton({
                customContainer: this.btn.$el.find(".slideBtnContent"),
                click: t.reset.bind(t),
                title: "Reset",
                classList: [ "simpleBtnRS" ]
            });
        },
        apply: function(e) {
            var t = e.params.contrast;
            var i = e.params.brightness;
            var n = 255;
            if (t == 1 && i == .1) return e;
            var r = -.5 * t + .5;
            var a = 1 * i;
            var o = (r + a) * 255;
            var s = e.data;
            var l = s.length / 4;
            for (var c = 0; c < l; c++) {
                s[c * 4] = s[c * 4] * t + o;
                s[c * 4 + 1] = s[c * 4 + 1] * t + o;
                s[c * 4 + 2] = s[c * 4 + 2] * t + o;
            }
            return e;
        },
        save: function() {
            this.publish("state.added", {
                title: this.title,
                brightness: this.inputRangeBrightness.getValue() / 1e3,
                contrast: this.inputRangeContrast.getValue() / 100
            });
        },
        reset: function() {
            this.inputRangeBrightness.resetValue();
            this.inputRangeContrast.resetValue();
        }
    });
    return r;
});

define("pluginGrayscale", [ "Widget", "pluginManager", "taskManager", "shortcut" ], function(e, t, i, n) {
    var r = t.extend({
        title: "grayscale",
        iconClass: "iconEdit_grayscale",
        inputRange: null,
        shortcut: n.color.grayscale,
        initialize: function(t) {
            var i = this;
            this.btn = new e.Html({
                classList: [ "slideBtn" ],
                html: [ '<div class="slideBtnTitle ' + this.iconClass + ' arrow">Grayscale</div>', '<div class="slideBtnContent"></div>' ].join(""),
                customContainer: t
            });
            this.btn.$el.find(".slideBtnTitle").on("click", this.onClickBtn.bind(this));
        },
        onClickBtn: function() {
            var e = !this.isOpened;
            this.publish("plugin.showed", {
                title: this.title
            });
            if (e) {
                this.open.call(this);
                this.btn.$el.addClass("act");
            }
        },
        start: function() {
            var t = this;
            this.inputRange = new e.InputRange({
                id: "inputRange",
                onChange: function(e) {
                    i.execute(t.apply, {
                        intensity: e / 100,
                        title: t.title
                    });
                },
                defaultValue: 0,
                min: 0,
                max: 100,
                customContainer: this.btn.$el.find(".slideBtnContent")
            });
            this.btnReset = new e.DialogButton({
                customContainer: this.btn.$el.find(".slideBtnContent"),
                click: t.reset.bind(t),
                title: "Reset",
                classList: [ "simpleBtnRS" ]
            });
        },
        apply: function(e) {
            var t = e.params.intensity;
            var i = e.data;
            var n = i.length / 4;
            var r = 1 - t;
            for (var a = 0; a < i.length; a += 4) {
                var o = i[a];
                var s = i[a + 1];
                var l = i[a + 2];
                var c = .3 * o + .59 * s + .11 * l;
                i[a] = i[a + 1] = i[a + 2] = c;
                i[a] = t * i[a] + r * o;
                i[a + 1] = t * i[a + 1] + r * s;
                i[a + 2] = t * i[a + 2] + r * l;
            }
            return e;
        },
        save: function() {
            this.publish("state.added", {
                title: this.title,
                intensity: this.inputRange.getValue() / 100
            });
        },
        reset: function() {
            this.inputRange.resetValue();
        }
    });
    return r;
});

define("pluginTemperature", [ "Widget", "pluginManager", "taskManager", "shortcut" ], function(e, t, i, n) {
    var r = t.extend({
        title: "temperature",
        iconClass: "iconEdit_temperature",
        inputRange: null,
        shortcut: n.temperature,
        initialize: function(t) {
            var i = this;
            this.btn = new e.Html({
                classList: [ "slideBtn" ],
                html: [ '<div class="slideBtnTitle ' + this.iconClass + ' arrow">Temperature</div>', '<div class="slideBtnContent"></div>' ].join(""),
                customContainer: t
            });
            this.btn.$el.find(".slideBtnTitle").on("click", this.onClickBtn.bind(this));
        },
        onClickBtn: function() {
            var e = !this.isOpened;
            this.publish("plugin.showed", {
                title: this.title
            });
            if (e) {
                this.open.call(this);
                this.btn.$el.addClass("act");
            }
        },
        start: function() {
            var t = this;
            this.inputRange = new e.InputRange({
                id: "inputRange",
                onChange: function(e) {
                    i.execute(t.apply, {
                        intensity: e / 100,
                        title: t.title
                    });
                },
                defaultValue: 5500,
                min: 1e3,
                max: 4e4,
                customContainer: this.btn.$el.find(".slideBtnContent")
            });
            this.btnReset = new e.DialogButton({
                customContainer: this.btn.$el.find(".slideBtnContent"),
                click: t.reset.bind(t),
                title: "Reset",
                classList: [ "simpleBtnRS" ]
            });
        },
        apply: function(e) {
            var t = e.params.intensity;
            var i;
            var n = e.data;
            var r = n.length / 4;
            var a = 0;
            var o = 0;
            var s = 0;
            if (t <= 66) {
                a = 255;
            } else {
                a = t - 60;
                a = 329.698727446 * Math.pow(a, -.1332047592);
                if (a < 0) a = 0;
                if (a > 255) a = 255;
            }
            if (t <= 66) {
                o = t;
                o = 99.4708025861 * Math.log(o) - 161.1195681661;
                if (o < 0) o = 0;
                if (o > 255) o = 255;
            } else {
                o = t - 60;
                o = 288.1221695283 * Math.pow(o, -.0755148492);
                if (o < 0) o = 0;
                if (o > 255) o = 255;
            }
            if (t >= 66) {
                s = 255;
            } else {
                if (t < 19) {
                    s = 0;
                } else {
                    s = t - 10;
                    s = 138.5177312231 * Math.log(s) - 305.0447927307;
                    if (s < 0) s = 0;
                    if (s > 255) s = 255;
                }
            }
            var l = {
                r: a,
                g: o,
                b: s
            };
            while (r--) {
                var a = n[r * 4], o = n[r * 4 + 1], s = n[r * 4 + 2];
                var c = (Math.max(a, o, s) + Math.min(a, o, s)) / 2;
                a = (1 - .5) * a + .5 * l.r;
                o = (1 - .5) * o + .5 * l.g;
                s = (1 - .5) * s + .5 * l.b;
                var u = Math.max(a, o, s), f = Math.min(a, o, s);
                var d, h, p = (u + f) / 2;
                if (u == f) {
                    d = h = 0;
                } else {
                    var g = u - f;
                    h = p > .5 ? g / (2 - u - f) : g / (u + f);
                    switch (u) {
                      case a:
                        d = (o - s) / g + (o < s ? 6 : 0);
                        break;

                      case o:
                        d = (s - a) / g + 2;
                        break;

                      case s:
                        d = (a - o) / g + 4;
                        break;
                    }
                    d /= 6;
                }
                var m = {
                    h: d,
                    s: h,
                    l: p
                };
                m.l = c;
                if (m.s == 0) {
                    n[r * 4] = n[r * 4 + 1] = n[r * 4 + 2] = p;
                } else {
                    function v(e, t, i) {
                        if (i < 0) i += 1;
                        if (i > 1) i -= 1;
                        if (i < 1 / 6) return e + (t - e) * 6 * i;
                        if (i < 1 / 2) return t;
                        if (i < 2 / 3) return e + (t - e) * (2 / 3 - i) * 6;
                        return e;
                    }
                    var y = m.l < .5 ? m.l * (1 + m.s) : m.l + m.s - m.l * m.s;
                    var b = 2 * m.l - y;
                    n[r * 4] = v(b, y, m.h + 1 / 3);
                    n[r * 4 + 1] = v(b, y, m.h);
                    n[r * 4 + 2] = v(b, y, m.h - 1 / 3);
                }
            }
            delete e.params;
            return e;
        },
        save: function() {
            this.publish("state.added", {
                title: this.title,
                intensity: this.inputRange.getValue() / 100
            });
        },
        reset: function() {
            this.inputRange.resetValue();
        }
    });
    return r;
});

define("pluginTransform", [ "Widget", "pluginManager", "signal", "taskManager" ], function(e, t, i, n) {
    var r = t.extend({
        title: "transform",
        iconClass: "iconEdit_rotateCkw",
        runningMode: "mainThread",
        modificationType: "state",
        initialize: function(t) {
            var i = this;
            var n = new e.Html({
                classList: [ "slideBtn" ],
                html: [ '<div class="slideBtnTitle ' + this.iconClass + '">Rotate 90 CW</div>', '<div class="slideBtnContent"></div>' ].join(""),
                customContainer: t
            });
            n.$el.find(".slideBtnTitle").on("click", function() {
                i.publish("plugin.showed", {
                    title: i.title
                });
                i.open.call(i);
            });
        },
        start: function() {
            var e = this, t = {
                title: e.title
            };
            e.publish("saveToAnalitics", [ "Edit", "Transform", "rotateCw" ]), e.publish("state.added", t, true);
            n.execute(e.apply, t);
            e.close();
        },
        apply: function(e) {
            var t = this;
            if (!e) {
                t.publish("canvas.rotateCw", null, true);
            } else {
                t.publish("canvas.rotateCw", null, true);
                t.publish("canvas.rotateCw", null, true);
                t.publish("canvas.rotateCw", null, true);
            }
        }
    });
    return r;
});

define("pluginHsl", [ "Widget", "pluginManager", "taskManager", "shortcut" ], function(e, t, i, n) {
    return t.extend({
        title: "hsl",
        iconClass: "iconEdit_hsl",
        shortcut: n.color["hsl tool"],
        getHueParams: function() {
            return {
                red: this.tabControl.getItem("redH").getValue() / 100,
                orange: this.tabControl.getItem("orangeH").getValue() / 100,
                yellow: this.tabControl.getItem("yellowH").getValue() / 100,
                green: this.tabControl.getItem("greenH").getValue() / 100,
                aqua: this.tabControl.getItem("aquaH").getValue() / 100,
                blue: this.tabControl.getItem("blueH").getValue() / 100,
                purple: this.tabControl.getItem("purpleH").getValue() / 100,
                magenta: this.tabControl.getItem("magentaH").getValue() / 100
            };
        },
        getSatParams: function(e) {
            return {
                red: this.tabControl.getItem("redS").getValue() / 100,
                orange: this.tabControl.getItem("orangeS").getValue() / 100,
                yellow: this.tabControl.getItem("yellowS").getValue() / 100,
                green: this.tabControl.getItem("greenS").getValue() / 100,
                aqua: this.tabControl.getItem("aquaS").getValue() / 100,
                blue: this.tabControl.getItem("blueS").getValue() / 100,
                purple: this.tabControl.getItem("purpleS").getValue() / 100,
                magenta: this.tabControl.getItem("magentaS").getValue() / 100
            };
        },
        getLightParams: function(e) {
            return {
                red: this.tabControl.getItem("redL").getValue() / 100,
                orange: this.tabControl.getItem("orangeL").getValue() / 100,
                yellow: this.tabControl.getItem("yellowL").getValue() / 100,
                green: this.tabControl.getItem("greenL").getValue() / 100,
                aqua: this.tabControl.getItem("aquaL").getValue() / 100,
                blue: this.tabControl.getItem("blueL").getValue() / 100,
                purple: this.tabControl.getItem("purpleL").getValue() / 100,
                magenta: this.tabControl.getItem("magentaL").getValue() / 100
            };
        },
        getParams: function() {
            var e = this;
            return {
                title: e.title,
                hue: this.getHueParams(),
                saturation: this.getSatParams(),
                lightness: this.getLightParams()
            };
        },
        reset: function() {
            var e = Object.values(this.tabControl.items);
            e.forEach(function(e) {
                e.resetValue();
            });
        },
        initialize: function(t) {
            var i = this;
            this.btn = new e.Html({
                classList: [ "slideBtn" ],
                html: [ '<div class="slideBtnTitle ' + this.iconClass + ' arrow">HSL</div>', '<div class="slideBtnContent"></div>' ].join(""),
                customContainer: t
            });
            this.btn.$el.find(".slideBtnTitle").on("click", this.onClickBtn.bind(this));
        },
        onClickBtn: function() {
            var e = !this.isOpened;
            this.publish("plugin.showed", {
                title: this.title
            });
            if (e) {
                this.open.call(this);
                this.btn.$el.addClass("act");
            }
        },
        start: function() {
            var t = this;
            var n = this;
            n.publish("saveToAnalitics", [ "Edit", "HSL", "Open" ]);
            var r = function() {
                i.execute(n.apply, n.getParams());
            };
            n.tabControl = new e.TabControl({
                customContainer: n.btn.$el.find(".slideBtnContent")[0],
                classList: [ "hslTabControl" ],
                tabs: [ {
                    active: true,
                    label: "",
                    styleList: {
                        background: "#ff0000"
                    },
                    contentItems: [ {
                        item: e.InputRange,
                        config: {
                            id: "redH",
                            label: "Hue",
                            onChange: r,
                            defaultValue: 0,
                            min: -100,
                            max: 100,
                            showProgress: false,
                            bgProgress: [ "#990066", "#ff6600" ],
                            bgRangeHandle: "#ff0000"
                        }
                    }, {
                        item: e.InputRange,
                        config: {
                            id: "redS",
                            label: "Saturation",
                            onChange: r,
                            defaultValue: 0,
                            min: -100,
                            max: 100,
                            showProgress: false,
                            bgProgress: [ "#919191", "#ff0000" ],
                            bgRangeHandle: "#ff0000"
                        }
                    }, {
                        item: e.InputRange,
                        config: {
                            id: "redL",
                            label: "Lightness",
                            onChange: r,
                            defaultValue: 0,
                            min: -100,
                            max: 100,
                            showProgress: false,
                            bgProgress: [ "#000", "#fff" ],
                            bgRangeHandle: "#ff0000"
                        }
                    } ]
                }, {
                    label: "",
                    styleList: {
                        background: "#ff6600"
                    },
                    contentItems: [ {
                        item: e.InputRange,
                        config: {
                            id: "orangeH",
                            label: "Hue",
                            onChange: r,
                            defaultValue: 0,
                            min: -100,
                            max: 100,
                            showProgress: false,
                            bgProgress: [ "#ff0000", "#ffcc00" ],
                            bgRangeHandle: "#ff6600"
                        }
                    }, {
                        item: e.InputRange,
                        config: {
                            id: "orangeS",
                            label: "Saturation",
                            onChange: r,
                            defaultValue: 0,
                            min: -100,
                            max: 100,
                            showProgress: false,
                            bgProgress: [ "#919191", "#ff6600" ],
                            bgRangeHandle: "#ff6600"
                        }
                    }, {
                        item: e.InputRange,
                        config: {
                            id: "orangeL",
                            label: "Lightness",
                            onChange: r,
                            defaultValue: 0,
                            min: -100,
                            max: 100,
                            showProgress: false,
                            bgProgress: [ "#000", "#fff" ],
                            bgRangeHandle: "#ff6600"
                        }
                    } ]
                }, {
                    label: "",
                    styleList: {
                        background: "#ffcc00"
                    },
                    contentItems: [ {
                        item: e.InputRange,
                        config: {
                            id: "yellowH",
                            label: "Hue",
                            onChange: r,
                            defaultValue: 0,
                            min: -100,
                            max: 100,
                            showProgress: false,
                            bgProgress: [ "#ff6600", "#99cc00" ],
                            bgRangeHandle: "#ffcc00"
                        }
                    }, {
                        item: e.InputRange,
                        config: {
                            id: "yellowS",
                            label: "Saturation",
                            onChange: r,
                            defaultValue: 0,
                            min: -100,
                            max: 100,
                            showProgress: false,
                            bgProgress: [ "#919191", "#ffcc00" ],
                            bgRangeHandle: "#ffcc00"
                        }
                    }, {
                        item: e.InputRange,
                        config: {
                            id: "yellowL",
                            label: "Lightness",
                            onChange: r,
                            defaultValue: 0,
                            min: -100,
                            max: 100,
                            showProgress: false,
                            bgProgress: [ "#000", "#fff" ],
                            bgRangeHandle: "#ffcc00"
                        }
                    } ]
                }, {
                    label: "",
                    styleList: {
                        background: "#99cc00"
                    },
                    contentItems: [ {
                        item: e.InputRange,
                        config: {
                            id: "greenH",
                            label: "Hue",
                            onChange: r,
                            defaultValue: 0,
                            min: -100,
                            max: 100,
                            showProgress: false,
                            bgProgress: [ "#ffcc00", "#33cc99" ],
                            bgRangeHandle: "#99cc00"
                        }
                    }, {
                        item: e.InputRange,
                        config: {
                            id: "greenS",
                            label: "Saturation",
                            onChange: r,
                            defaultValue: 0,
                            min: -100,
                            max: 100,
                            showProgress: false,
                            bgProgress: [ "#919191", "#99cc00" ],
                            bgRangeHandle: "#99cc00"
                        }
                    }, {
                        item: e.InputRange,
                        config: {
                            id: "greenL",
                            label: "Lightness",
                            onChange: r,
                            defaultValue: 0,
                            min: -100,
                            max: 100,
                            showProgress: false,
                            bgProgress: [ "#000", "#fff" ],
                            bgRangeHandle: "#99cc00"
                        }
                    } ]
                }, {
                    label: "",
                    styleList: {
                        background: "#33cc99"
                    },
                    contentItems: [ {
                        item: e.InputRange,
                        config: {
                            id: "aquaH",
                            label: "Hue",
                            onChange: r,
                            defaultValue: 0,
                            min: -100,
                            max: 100,
                            showProgress: false,
                            bgProgress: [ "#99cc00", "#3366ff" ],
                            bgRangeHandle: "#33cc99"
                        }
                    }, {
                        item: e.InputRange,
                        config: {
                            id: "aquaS",
                            label: "Saturation",
                            onChange: r,
                            defaultValue: 0,
                            min: -100,
                            max: 100,
                            showProgress: false,
                            bgProgress: [ "#919191", "#33cc99" ],
                            bgRangeHandle: "#33cc99"
                        }
                    }, {
                        item: e.InputRange,
                        config: {
                            id: "aquaL",
                            label: "Lightness",
                            onChange: r,
                            defaultValue: 0,
                            min: -100,
                            max: 100,
                            showProgress: false,
                            bgProgress: [ "#000", "#fff" ],
                            bgRangeHandle: "#33cc99"
                        }
                    } ]
                }, {
                    label: "",
                    styleList: {
                        background: "#3366ff"
                    },
                    contentItems: [ {
                        item: e.InputRange,
                        config: {
                            id: "blueH",
                            label: "Hue",
                            onChange: r,
                            defaultValue: 0,
                            min: -100,
                            max: 100,
                            showProgress: false,
                            bgProgress: [ "#33cc99", "#6600cc" ],
                            bgRangeHandle: "#3366ff"
                        }
                    }, {
                        item: e.InputRange,
                        config: {
                            id: "blueS",
                            label: "Saturation",
                            onChange: r,
                            defaultValue: 0,
                            min: -100,
                            max: 100,
                            showProgress: false,
                            bgProgress: [ "#919191", "#3366ff" ],
                            bgRangeHandle: "#3366ff"
                        }
                    }, {
                        item: e.InputRange,
                        config: {
                            id: "blueL",
                            label: "Lightness",
                            onChange: r,
                            defaultValue: 0,
                            min: -100,
                            max: 100,
                            showProgress: false,
                            bgProgress: [ "#000", "#fff" ],
                            bgRangeHandle: "#3366ff"
                        }
                    } ]
                }, {
                    label: "",
                    styleList: {
                        background: "#6600cc"
                    },
                    contentItems: [ {
                        item: e.InputRange,
                        config: {
                            id: "purpleH",
                            label: "Hue",
                            onChange: r,
                            defaultValue: 0,
                            min: -100,
                            max: 100,
                            showProgress: false,
                            bgProgress: [ "#3366ff", "#990066" ],
                            bgRangeHandle: "#6600cc"
                        }
                    }, {
                        item: e.InputRange,
                        config: {
                            id: "purpleS",
                            label: "Saturation",
                            onChange: r,
                            defaultValue: 0,
                            min: -100,
                            max: 100,
                            showProgress: false,
                            bgProgress: [ "#919191", "#6600cc" ],
                            bgRangeHandle: "#6600cc"
                        }
                    }, {
                        item: e.InputRange,
                        config: {
                            id: "purpleL",
                            label: "Lightness",
                            onChange: r,
                            defaultValue: 0,
                            min: -100,
                            max: 100,
                            showProgress: false,
                            bgProgress: [ "#000", "#fff" ],
                            bgRangeHandle: "#6600cc"
                        }
                    } ]
                }, {
                    label: "",
                    styleList: {
                        background: "#990066"
                    },
                    contentItems: [ {
                        item: e.InputRange,
                        config: {
                            id: "magentaH",
                            label: "Hue",
                            onChange: r,
                            defaultValue: 0,
                            min: -100,
                            max: 100,
                            showProgress: false,
                            bgProgress: [ "#6600cc", "#ff0000" ],
                            bgRangeHandle: "#990066"
                        }
                    }, {
                        item: e.InputRange,
                        config: {
                            id: "magentaS",
                            label: "Saturation",
                            onChange: r,
                            defaultValue: 0,
                            min: -100,
                            max: 100,
                            showProgress: false,
                            bgProgress: [ "#919191", "#990066" ],
                            bgRangeHandle: "#990066"
                        }
                    }, {
                        item: e.InputRange,
                        config: {
                            id: "magentaL",
                            label: "Lightness",
                            onChange: r,
                            defaultValue: 0,
                            min: -100,
                            max: 100,
                            showProgress: false,
                            bgProgress: [ "#000", "#fff" ],
                            bgRangeHandle: "#990066"
                        }
                    } ]
                } ]
            });
            new e.DialogButton({
                customContainer: this.btn.$el.find(".slideBtnContent"),
                click: n.reset.bind(n),
                title: "Reset",
                classList: [ "simpleBtnRS" ]
            });
        },
        apply: function(e) {
            console.time("apply hsl");
            var t = e.params.hue;
            var i = e.params.saturation;
            var n = e.params.lightness;
            var r = e.data;
            var a = r.length / 4;
            function o(e, t, i) {
                var n = Math.max(e, t, i), r = Math.min(e, t, i);
                var a, o, s = (n + r) / 2;
                if (n == r) {
                    a = o = 0;
                } else {
                    var l = n - r;
                    o = s > .5 ? l / (2 - n - r) : l / (n + r);
                    switch (n) {
                      case e:
                        a = (t - i) / l + (t < i ? 6 : 0);
                        break;

                      case t:
                        a = (i - e) / l + 2;
                        break;

                      case i:
                        a = (e - t) / l + 4;
                        break;
                    }
                    a /= 6;
                }
                return [ a, o, s ];
            }
            function s(e, t, i) {
                var n, r, a;
                if (t == 0) {
                    n = r = a = i;
                } else {
                    function o(e, t, i) {
                        if (i < 0) i += 1;
                        if (i > 1) i -= 1;
                        if (i < 1 / 6) return e + (t - e) * 6 * i;
                        if (i < 1 / 2) return t;
                        if (i < 2 / 3) return e + (t - e) * (2 / 3 - i) * 6;
                        return e;
                    }
                    var s = i < .5 ? i * (1 + t) : i + t - i * t;
                    var l = 2 * i - s;
                    n = o(l, s, e + 1 / 3);
                    r = o(l, s, e);
                    a = o(l, s, e - 1 / 3);
                }
                return [ n, r, a ];
            }
            var l = {
                red: {
                    start: 341 / 360,
                    end: 380 / 360,
                    negativeStart: true,
                    size: 39 / 360
                },
                orange: {
                    start: 21 / 360,
                    end: 40 / 360
                },
                yellow: {
                    start: 41 / 360,
                    end: 70 / 360
                },
                green: {
                    start: 71 / 360,
                    end: 150 / 360
                },
                aqua: {
                    start: 151 / 360,
                    end: 190 / 360
                },
                blue: {
                    start: 191 / 360,
                    end: 270 / 360
                },
                purple: {
                    start: 271 / 360,
                    end: 300 / 360
                },
                magenta: {
                    start: 301 / 360,
                    end: 340 / 360
                }
            };
            var c = 20 / 360;
            var u = .02;
            var f = .98;
            var d = .98;
            var h = .02;
            var p = .98;
            var g = .25;
            for (var m in l) {
                l[m].size = l[m].size || l[m].end - l[m].start;
                l[m].peak = l[m].start + l[m].size / 2;
                l[m].halfsize = l[m].size / 2;
                l[m].saturationStart = l[m].start - c;
                l[m].saturationEnd = l[m].end + c;
                l[m].saturationSize = l[m].size + c * 2;
                l[m].saturationHalfSize = l[m].saturationSize / 2;
            }
            for (var v = 0; v < a; v++) {
                var y = v * 4;
                var b = r[y] / 255;
                var w = r[y + 1] / 255;
                var C = r[y + 2] / 255;
                if (b === w && w === C) continue;
                {
                    var x = Math.max(b, w, C), _ = Math.min(b, w, C);
                    var S, k, A = (x + _) / 2;
                    if (x == _) {
                        S = k = 0;
                    } else {
                        var E = x - _;
                        k = A > .5 ? E / (2 - x - _) : E / (x + _);
                        switch (x) {
                          case b:
                            S = (w - C) / E + (w < C ? 6 : 0);
                            break;

                          case w:
                            S = (C - b) / E + 2;
                            break;

                          case C:
                            S = (b - w) / E + 4;
                            break;
                        }
                        S /= 6;
                    }
                }
                for (var m in l) {
                    if (!t[m] && !i[m] && !n[m]) continue;
                    var T = l[m].start;
                    var P = l[m].end;
                    var I = l[m].peak;
                    var O = l[m].halfsize;
                    var D = l[m].saturationStart;
                    var R = l[m].saturationEnd;
                    var L = l[m].saturationHalfSize;
                    var F = S;
                    if (l[m].negativeStart && S < 21 / 360) {
                        F = S + 1;
                    }
                    var M = F >= T && F <= P;
                    var N = S;
                    if (l[m].negativeStart && S < 21 / 360 + c) {
                        N = S + 1;
                    }
                    var B = N >= D && N <= R;
                    if (M) {
                        var j = 1 - Math.abs(I - F) / O;
                        if (t[m]) {
                            S = F + t[m] * l[m].size * j;
                            S = Math.min(Math.max(S, T), P);
                        }
                        if (n[m]) {
                            A += n[m] * j * g;
                            A = Math.min(Math.max(A, h), p);
                        }
                    }
                    if (B) {
                        var j = 1 - Math.abs(I - N) / L;
                        if (i[m]) {
                            k += i[m] * j * d;
                            k = Math.min(Math.max(k, u), f);
                        }
                    }
                }
                {
                    if (k == 0) {
                        r[y] = r[y + 1] = r[y + 2] = A * 255;
                    } else {
                        var U = A < .5 ? A * (1 + k) : A + k - A * k;
                        var z = 2 * A - U;
                        var q = (U - z) * 6;
                        var W = S + 1 / 3;
                        if (W < 0) W += 1;
                        if (W > 1) W -= 1;
                        if (W < 1 / 6) {
                            r[y] = (z + q * W) * 255;
                        } else if (W < 1 / 2) {
                            r[y] = U * 255;
                        } else if (W < 2 / 3) {
                            r[y] = (z + q * (2 / 3 - W)) * 255;
                        } else {
                            r[y] = z * 255;
                        }
                        var W = S;
                        if (W < 0) W += 1;
                        if (W > 1) W -= 1;
                        if (W < 1 / 6) {
                            r[y + 1] = (z + q * W) * 255;
                        } else if (W < 1 / 2) {
                            r[y + 1] = U * 255;
                        } else if (W < 2 / 3) {
                            r[y + 1] = (z + q * (2 / 3 - W)) * 255;
                        } else {
                            r[y + 1] = z * 255;
                        }
                        var W = S - 1 / 3;
                        if (W < 0) W += 1;
                        if (W > 1) W -= 1;
                        if (W < 1 / 6) {
                            r[y + 2] = (z + q * W) * 255;
                        } else if (W < 1 / 2) {
                            r[y + 2] = U * 255;
                        } else if (W < 2 / 3) {
                            r[y + 2] = (z + q * (2 / 3 - W)) * 255;
                        } else {
                            r[y + 2] = z * 255;
                        }
                    }
                }
            }
            console.timeEnd("apply hsl");
            return e;
        },
        save: function() {
            this.publish("state.added", Object.merge({
                title: this.title
            }, this.getParams()));
        }
    });
});

define("pluginOpenFile", [ "Widget", "pluginManager", "taskManager", "decode", "resizeImage", "shortcut" ], function(e, t, i, n, r, a) {
    var o = t.extend({
        title: "openFile",
        menuIcon: "contrast",
        shortcut: a.file.open,
        initialize: function(t) {
            var i = this;
            this.inpf = new e.InputFile({
                id: "loadFile",
                title: "Open",
                container: t,
                menuIcon: "openFile",
                type: "image",
                classList: [ "iconEdit_open" ],
                onReady: function(e, t) {
                    i.publish("saveToAnalitics", [ "Edit", "FileOpen", "LoadFile" ]);
                    i.publish("loadingStart");
                    editor.reinit({
                        name: t.name,
                        mimeType: t.type,
                        size: t.size,
                        img: e
                    });
                    e = null;
                }
            });
        },
        start: function() {
            this.inpf.open();
            this.isOpened = false;
        }
    });
    return o;
});

define("pluginAbout", [ "Widget", "pluginManager", "utils", "shortcut" ], function(e, t, i, n) {
    var r = [ "<p >This is an early version of photo editor by TopTechPhoto.</p>", "<p >Why is it exciting? Because it is capable to edit large photographs for up to 42Mpx with the largest colour preciseness of 32bits/channel. More info <a href='http://edit.pics.io/online-photo-editor' target='_blank'>here</a>.</p>", "<p >See it updating over time and check out other online solutions for photographers: <a href='http://pics.io'>Pics.io</a>, <a href='http://live.pics.io'>Live.pics.io</a> and <a href='http://raw.pics.io'>Raw.pics.io</a>.</p>" ].join("");
    if (i.isChromeApplication()) {
        r += "<p >If you have any questions or suggestions - wed love to hear from you in our <a href='http://support.pics.io/forums/220344-general'>support section</a >.</p>";
    } else {
        r += [ "<p >If you have any questions or suggestions - wed love to hear from you in our <a href='http://support.pics.io/forums/220344-general'>support section</a >.</p>" ].join("");
    }
    var a = t.extend({
        title: "about",
        shortcut: n.other.about,
        initialize: function(t, i) {
            var n = new e.Button({
                click: this.open.bind(this),
                title: self.title,
                type: i.type,
                className: "iconEdit_about",
                path: "about",
                parentToolbar: t,
                tooltip: i.tooltip
            });
        },
        start: function() {
            var t = new e.Dialog({
                title: "About",
                text: r,
                onClose: this.close.bind(this),
                onOk: function() {},
                onCancel: function() {},
                onRender: function() {
                    if (typeof FB !== "undefined") {
                        FB.XFBML.parse();
                    }
                    if (typeof twttr !== "undefined") {
                        twttr.widgets.load();
                    }
                }
            });
            this.publish("saveToAnalitics", [ "Edit", "About", "Open" ]);
        }
    });
    return a;
});

define("pluginFullscreen", [ "Widget", "pluginManager", "shortcut" ], function(e, t, i) {
    var n = t.extend({
        title: "fullscreen",
        shortcut: i.other["fullscreen"],
        initialize: function(t, i) {
            var n = this;
            this.fullscreen = false;
            this.fullScreenElem = document.documentElement;
            document.addEventListener("fullscreenchange", function() {
                n.fullscreen = !n.fullscreen;
            }, false);
            document.addEventListener("mozfullscreenchange", function() {
                n.fullscreen = !n.fullscreen;
            }, false);
            document.addEventListener("webkitfullscreenchange", function(e) {
                n.fullscreen = !n.fullscreen;
            }, false);
            var r = new e.Button({
                click: function() {
                    n.start();
                },
                title: n.title,
                type: i.type,
                icon: "/assets/img/editor/fullscreen.png",
                path: "fullscreen",
                parentToolbar: t,
                tooltip: i.tooltip
            });
        },
        fullScreen: function(e) {
            if (e.requestFullscreen) {
                e.requestFullscreen();
            } else if (e.webkitRequestFullscreen) {
                e.webkitRequestFullscreen();
            } else if (e.mozRequestFullScreen) {
                e.mozRequestFullScreen();
            }
        },
        fullScreenCancel: function() {
            if (document.exitFullscreen) {
                document.exitFullscreen();
            } else if (document.mozCancelFullScreen) {
                document.mozCancelFullScreen();
            } else if (document.webkitCancelFullScreen) {
                document.webkitCancelFullScreen();
            }
        },
        start: function() {
            var e = this;
            e.publish("saveToAnalitics", [ "Edit", "FullScreen", "Open" ]);
            !e.fullscreen ? e.fullScreen(document.documentElement) : e.fullScreenCancel();
            e.isOpened = false;
        }
    });
    return n;
});

define("pluginExternalCaller", [ "Widget", "pluginManager", "signal" ], function(e, t, i) {
    var n = t.extend({
        initialize: function(t, i) {
            var n = this;
            i = i || {};
            this.items = {};
            var r = new e.Button({
                click: function() {
                    i && i.caller && i.caller();
                    n.publish("saveToAnalitics", [ "Edit", "Back", "To catalog" ]);
                },
                id: i.id || "",
                title: i.title || "External Caller",
                path: i.title || "externalCaller",
                type: i.type || "icon",
                icon: i.icon,
                parentToolbar: t,
                menuIcon: i.menuIcon || "saver",
                tooltip: i.tooltip,
                classList: i.classList,
                className: i.className
            });
        }
    });
    return n;
});

define("pluginRedEyes", [ "Widget", "pluginManager", "taskManager", "signal", "converter", "utils" ], function(e, t, i, n, r, a) {
    return t.extend({
        title: "redEyes",
        initialize: function(t) {
            var o = this, s, l;
            var c = function(t, c, u, f) {
                n.publish("editor.crop.stop.crop.mode");
                o.publish("saveToAnalitics", [ "Edit", "RedEyes", "Open" ]);
                s = r.imageDataToSlicedFloat32(u);
                var d = new e.Dialog({
                    title: "redEye",
                    onOk: function() {
                        if (d.getItem("inputRange").getValue() == 0) {
                            o.publish("state.cancel");
                            return;
                        }
                        n.publish("editor.insertLocal", {
                            imageSlicesList: l,
                            coords: f
                        }, true);
                        o.publish("state.added", {
                            title: o.title,
                            threshold: this.getItem("inputRange").getValue() / 100,
                            coords: f
                        }, true);
                        o.publish("saveToAnalitics", [ "Edit", "RedEyes", "Ok" ]);
                    },
                    onCancel: function() {
                        o.publish("state.cancel");
                        o.publish("saveToAnalitics", [ "Edit", "RedEyes", "Cancel" ]);
                    }
                });
                d.addItem(e.InputRange, {
                    id: "inputRange",
                    onChange: function(e) {
                        i.getProcessedImageData(o.apply, s, {
                            threshold: e / 100
                        }, function(e) {
                            l = a.cloneSlices({
                                slices: e
                            });
                        }, function(e) {
                            var t = a.slicesListToImageData(e);
                            h.setImageData(t);
                        });
                    },
                    defaultValue: 0,
                    min: -100,
                    max: 100
                });
                var h = d.addItem(e.CanvasUi, {
                    id: "canvas",
                    imageData: u,
                    classList: [ "redEyeCanvas" ]
                });
            };
            new e.Button({
                click: function() {
                    n.publish("editor.crop.start", {
                        callback: c
                    });
                },
                defaultValue: 0,
                parentToolbar: t,
                title: "Red Eyes Removal",
                menuIcon: "redeye"
            });
        },
        apply: function(e) {
            const t = .5133333;
            const i = 1;
            const n = .1933333;
            var r = e.params.threshold;
            var a = e.data;
            var o = a.length;
            for (var s = 0; s < o; s += 4) {
                var l = a[s] * t;
                var c = a[s + 1] * i;
                var u = a[s + 2] * n;
                var f, d;
                if (s > e.width * 4) {
                    f = s - e.width * 4 - 12;
                }
                if (s < o - e.width * 4) {
                    d = s + e.width * 4 + 12;
                }
                if (l >= c - r && l >= u - r) {
                    a[s] = (c + u) / (2 * t);
                }
            }
            return e;
        }
    });
});

define("convolutionBase", [ "pluginManager", "taskManager", "Widget" ], function(e, t, i) {
    return e.extend({
        initialize: function(e) {
            var t = this;
            var n = new i.Html({
                classList: [ "slideBtn" ],
                html: [ '<div class="slideBtnTitle ' + this.iconClass + '">' + t.title + "</div>", '<div class="slideBtnContent"></div>' ].join(""),
                customContainer: e
            });
            n.$el.find(".slideBtnTitle").on("click", function() {
                t.publish("plugin.showed", {
                    title: t.title
                });
                t.open.call(t);
            });
        },
        title: "",
        kernel: [],
        divisor: undefined,
        opaque: undefined,
        offset: 0,
        start: function() {
            var e = this;
            e.publish("saveToAnalitics", [ "Edit", e.title, "Open" ]);
            var i = {
                title: e.title.toLowerCase(),
                kernel: e.kernel,
                opaque: e.opaque,
                divisor: e.divisor,
                offset: e.offset,
                additionalLines: Math.floor(Math.sqrt(e.kernel.length) / 2)
            };
            t.execute(e.apply, i).then(function() {
                e.close();
                e.publish("state.added", i);
            });
        },
        apply: function(e) {
            var t = e;
            var i = e.params.kernel;
            var n = e.params.opaque;
            var r = e.params.lineList;
            var a = e.params.offset;
            var o = e.params.divisor || i.reduce(function(e, t) {
                return e + t;
            }) || 1;
            var s = Math.round(Math.sqrt(i.length));
            var l = Math.floor(s / 2);
            var c = t.width;
            var u = t.height;
            var f;
            if (!r.top && r.bottom) {
                f = new Uint8ClampedArray(t.data.length + r.bottom.length);
                f.set(t.data, 0);
                f.set(r.bottom, t.data.length);
            } else if (!r.bottom && r.top) {
                f = new Uint8ClampedArray(t.data.length + r.top.length);
                f.set(r.top, 0);
                f.set(t.data, r.top.length);
            } else if (r.top && r.bottom) {
                f = new Uint8ClampedArray(t.data.length + r.top.length + r.bottom.length);
                f.set(r.top, 0);
                f.set(t.data, r.top.length);
                f.set(r.bottom, r.top.length + t.data.length);
            }
            if (f) t.data = f;
            var d = t.data;
            var h = t.width;
            var p = t.data.length / t.width / 4;
            var g = h;
            var m = p;
            var v = {
                width: h,
                height: p,
                data: new Uint8ClampedArray(t.data.length)
            };
            var y = v.data;
            var b = n ? 1 : 0;
            for (var w = 0; w < m; w++) {
                for (var C = 0; C < g; C++) {
                    var x = w;
                    var _ = C;
                    var S = (w * g + C) * 4;
                    var k = 0, A = 0, E = 0, T = 0;
                    for (var P = 0; P < s; P++) {
                        for (var I = 0; I < s; I++) {
                            var O = Math.min(p - 1, Math.max(0, x + P - l));
                            var D = Math.min(h - 1, Math.max(0, _ + I - l));
                            var R = (O * h + D) * 4;
                            var L = i[P * s + I];
                            k += d[R] * L;
                            A += d[R + 1] * L;
                            E += d[R + 2] * L;
                            T += d[R + 3] * L;
                        }
                    }
                    y[S] = k / o + a;
                    y[S + 1] = A / o + a;
                    y[S + 2] = E / o + a;
                    y[S + 3] = (T + b * (1 - T)) / o + a;
                }
            }
            var F;
            if (!r.top && r.bottom) {
                F = new Uint8ClampedArray(y.length - r.bottom.length);
                F.set(y.subarray(0, y.length - r.bottom.length));
            } else if (!r.bottom && r.top) {
                F = new Uint8ClampedArray(y.length - r.top.length);
                F.set(y.subarray(r.top.length, y.length));
            } else if (r.top && r.bottom) {
                F = new Uint8ClampedArray(y.length - r.top.length - r.bottom.length);
                F.set(y.subarray(r.top.length, y.length - r.bottom.length));
            }
            if (F) {
                v.data = F;
                v.height = u;
            }
            return v;
        }
    });
});

define("pluginSharpen", [ "convolutionBase", "shortcut" ], function(e, t) {
    return e.extend({
        title: "Sharpen",
        iconClass: "iconEdit_sharpen",
        shortcut: t.autofilters.sharpen,
        kernel: [ 0, -2, 0, -2, 11, -2, 0, -2, 0 ],
        menuIcon: "sharpen"
    });
});

define("pluginBlur", [ "convolutionBase", "shortcut" ], function(e, t) {
    return e.extend({
        title: "Blur",
        iconClass: "iconEdit_blur",
        kernel: [ 1, 2, 1, 2, 4, 2, 1, 2, 1 ],
        menuIcon: "blur",
        shortcut: t.autofilters.blur
    });
});

define("pluginEmboss", [ "convolutionBase", "shortcut" ], function(e, t) {
    return e.extend({
        title: "Emboss",
        iconClass: "picsEdit-embossIcon",
        kernel: [ 2, 0, 0, 0, -1, 0, 0, 0, -1 ],
        offset: 128,
        menuIcon: "emboss",
        shortcut: t.autofilters.emboss
    });
});

define("pluginEdge", [ "convolutionBase" ], function(e) {
    return e.extend({
        title: "Edge",
        iconClass: "picsEdit-edgeIcon",
        kernel: [ 1, 1, 1, 1, -7, 1, 1, 1, 1 ],
        menuIcon: "edge"
    });
});

define("colorBox", [ "uiObject", "signal" ], function(e, t) {
    return e.extend({
        template: '<li><span class = "picker-colorBox"></span></li>',
        initialize: function() {
            var e = this;
            this.config.container = this.config.parentToolbar;
            this.elem = this.render();
            this.elem.click(function(t) {
                e.config.click && e.config.click();
            });
        },
        setColor: function(e) {
            this.elem.find(".picker-colorBox").css("backgroundColor", "rgba(" + e.join(",") + ")");
        }
    });
});

define("pluginColorGetter", [ "pluginManager", "Widget", "signal", "color", "colorBox" ], function(e, t, i, n, r) {
    var a = e.extend({
        initialize: function(e, t) {
            var n = this;
            var a = this.colorBox = new r({
                parentToolbar: e,
                click: n.start.bind(n)
            });
            i.subscribe("canvasColorChanged", function(e) {
                n.colorBox.setColor(e.rgba);
            });
        },
        start: function() {
            var e = this;
            e.publish("saveToAnalitics", [ "Edit", "ColorGetter", "Open" ]);
            var i = new t.Dialog({
                title: "Select color",
                onClose: this.close.bind(this),
                classList: [ "colorPickerDialog" ],
                onOk: e.onOk.bind(e),
                onCancel: function() {
                    e.publish("saveToAnalitics", [ "Edit", "ColorGetter", "Cancel" ]);
                }
            });
            i.elem.find(".contentPicsioEditorPopup").append('<div id="picsEdit-colorDropper-box"></div>');
            this.colorPickerBox = new t.ColorPickerBox(editor.canvas.color);
        },
        onOk: function() {
            var e = this;
            i.publish("setCanvasColor", {
                color: this.colorPickerBox.currentValue
            }, true);
            e.publish("saveToAnalitics", [ "Edit", "ColorGetter", "Ok" ]);
        }
    });
    return a;
});

define("gradientGenerator", [ "slicedImage", "decode", "slicer", "config" ], function(e, t, i, n) {
    var r = function() {
        var t = document.createElement("canvas"), r = t.getContext("2d");
        return {
            createGradient: function(e, i, n) {
                t.width = e.width;
                t.height = e.height;
                grd = r.createLinearGradient(i.x * e.width, i.y * e.height, i.x1 * e.width, i.y1 * e.height);
                for (var a = 0; a < n.length; a++) {
                    var o = n[a].stop;
                    if (o > 1) o = 1;
                    if (o < 0) o = 0;
                    grd.addColorStop(o, "rgba(" + n[a].color.join(",") + ")");
                }
                r.fillStyle = grd;
                r.fillRect(0, 0, t.width, t.height);
                return r.getImageData(0, 0, t.width, t.height);
            },
            createGradient32: function(t, r, a) {
                var o = this.createGradient.apply(this, arguments);
                var s = new e(i.sliceRGBA({
                    width: o.width,
                    height: o.height,
                    data: o.data
                }, n.converter.RAW_PER_SLICE), o.width, o.height);
                return s;
            }
        };
    };
    return new r();
});

define("pluginGradient", [ "Widget", "pluginManager", "taskManager", "shortcut", "gradientGenerator", "signal", "crop", "config" ], function(e, t, i, n, r, a, o, s) {
    var l = {
        getLineRectIntersectionPoints: function(e, t, i) {
            var n = 0, r = 0, a = i.x, o = i.y, s, l, c = [], u = 0, f = 2;
            l = r;
            s = (l - e.y) / (t.y - e.y) * (t.x - e.x) + e.x;
            if (this.isInRange(s, n, a)) {
                c.push({
                    x: s,
                    y: l
                });
                u++;
                s = l = undefined;
            }
            s = n;
            l = (s - e.x) / (t.x - e.x) * (t.y - e.y) + e.y;
            if (this.isInRange(l, r, o)) {
                c.push({
                    x: s,
                    y: l
                });
                u++;
                s = l = undefined;
            }
            if (u == f) {
                if (this.getDistance(e, c[0]) < this.getDistance(t, c[0])) {
                    return c;
                } else {
                    return c.reverse();
                }
            }
            l = o;
            s = (l - e.y) / (t.y - e.y) * (t.x - e.x) + e.x;
            if (this.isInRange(s, n, a)) {
                c.push({
                    x: s,
                    y: l
                });
                u++;
                s = l = undefined;
            }
            if (u == f) {
                if (this.getDistance(e, c[0]) < this.getDistance(t, c[0])) {
                    return c;
                } else {
                    return c.reverse();
                }
            }
            s = a;
            l = (s - e.x) / (t.x - e.x) * (t.y - e.y) + e.y;
            if (this.isInRange(l, r, o)) {
                c.push({
                    x: s,
                    y: l
                });
                u++;
                s = l = undefined;
            }
            if (u == f) {
                if (this.getDistance(e, c[0]) < this.getDistance(t, c[0])) {
                    return c;
                } else {
                    return c.reverse();
                }
                return c;
            }
            return false;
        },
        getDistance: function(e, t) {
            return Math.sqrt(Math.pow(e.x - t.x, 2) + Math.pow(e.y - t.y, 2));
        },
        isInRange: function(e, t, i) {
            return e >= t && e <= i ? true : false;
        },
        getRelativePercentage: function(e, t, i) {
            var n = this.getDistance(i[0], i[1]), r = this.getDistance(e, i[0]), a = this.getDistance(t, i[0]);
            var o = r / n;
            var s = (r / n + a / n) / 2;
            var l = a / n;
            if (o < 0) o = 0;
            if (l > 1) l = 1;
            return [ o, s, l ];
        }
    };
    return t.extend({
        title: "gradient",
        iconClass: "iconEdit_gradient",
        shortcut: n.brightness,
        initialize: function(t) {
            var i = this;
            this.btn = new e.Html({
                classList: [ "slideBtn" ],
                html: [ '<div class="slideBtnTitle ' + this.iconClass + '">Gradient</div>', '<div class="slideBtnContent"></div>' ].join(""),
                customContainer: t
            });
            this.btn.$el.find(".slideBtnTitle").on("click", function() {
                i.publish("plugin.showed", {
                    title: i.title
                });
                i.open.call(i);
            });
            i.confirmationDialog = new e.ConfirmationDialog({
                container: "#picsEdit",
                onOk: function() {
                    i.close();
                    i.publish("state.added", i.commandOption);
                    i.publish("saveToAnalitics", [ "Edit", "Gradient", "Ok" ]);
                },
                onCancel: function() {
                    i.close();
                    i.publish("state.cancel");
                    i.publish("saveToAnalitics", [ "Edit", "Gradient", "Cancel" ]);
                },
                title: "ok",
                "class": "confirmationOk"
            });
            i.confirmationDialog.hide();
        },
        start: function() {
            var t = this;
            a.publish("resetScale", {});
            t.confirmationDialog.show();
            var i = editor.canvas.getRelativeCenterCoordinate(), n = editor.getDrawSize();
            t.publish("saveToAnalitics", [ "Edit", "Gradient", "Open" ]);
            var r = t.gUi = new e.GradientFilter({
                top: i.y - n.height / 4 * editor.canvas.hScale,
                height: n.height / 2 * editor.canvas.hScale,
                onChange: t.applyFilter.bind(t)
            });
            t.applyFilterHandler = t.applyFilterHandler.bind(t);
            editor.btnAdjustmentsHandlers.hide();
        },
        onClose: function() {
            self = this;
            self.gUi.destroy();
            self.confirmationDialog.hide();
            a.unsubscribe("canvasColorChanged", self.applyFilterHandler);
            editor.btnAdjustmentsHandlers.show();
        },
        applyFilterHandler: function() {
            this.applyFilter();
        },
        applyFilter: function() {
            var e = this;
            var t = e.gUi.getControlPoints();
            var n = editor.getRealSize();
            var r = t.start.y / n.height;
            var a = t.end.y / n.height;
            var o = l.getLineRectIntersectionPoints(t.start, t.end, {
                x: n.width,
                y: n.height
            });
            var s = l.getRelativePercentage(t.start, t.end, o);
            var c = editor.canvas.color;
            c.length = 3;
            e.commandOption = {
                title: e.title,
                prepare: 1,
                gradient: {
                    size: {
                        width: n.width,
                        height: n.height
                    },
                    gPoints: {
                        x: o[0].x / n.width,
                        y: o[0].y / n.height,
                        x1: o[1].x / n.width,
                        y1: o[1].y / n.height
                    },
                    colorStopList: [ {
                        stop: 0,
                        color: [ c[0], c[1], c[2], 1 ]
                    }, {
                        stop: s[0],
                        color: [ c[0], c[1], c[2], 1 ]
                    }, {
                        stop: s[1],
                        color: [ c[0], c[1], c[2], .5 ]
                    }, {
                        stop: s[2],
                        color: [ c[0], c[1], c[2], 0 ]
                    }, {
                        stop: 1,
                        color: [ c[0], c[1], c[2], 0 ]
                    } ]
                }
            };
            i.execute(e.apply, e.commandOption);
        },
        mergeSlices: function(e, t) {
            if (e.length !== t.length) {
                console.error("Incorrect merged data");
                return;
            }
            for (var i = 0; i < e.length; i++) {
                e[i]["params"] = {};
                e[i]["params"]["gradient"] = t[i].data;
            }
            return e;
        },
        prepare: function(e, t) {
            if (!t.gradient) {
                return this.prepareDataToProcessing.apply(this, arguments);
            }
            var i = this, n = o.drawCoords, a = e[0].width, l = s.converter.RAW_PER_SLICE * (e.length - 1) + e[e.length - 1].height;
            t.gradient.size.width = a;
            t.gradient.size.height = l;
            t = r.createGradient32(t.gradient.size, t.gradient.gPoints, t.gradient.colorStopList, n).getSliceList();
            return i.mergeSlices(e, t);
        },
        apply: function(e) {
            var t = function() {
                return {
                    overlay: function(e, t) {
                        var i = e;
                        var n = t;
                        for (var r = 0; r < i.length; r += 4) {
                            var a = i[r + 3] / 255;
                            var o = n[r + 3] / 255;
                            var s = a + o - a * o;
                            i[r + 3] = s * 255;
                            var l = i[r] / 255;
                            var c = i[r + 1] / 255;
                            var u = i[r + 2] / 255;
                            var f = n[r] / 255;
                            var d = n[r + 1] / 255;
                            var h = n[r + 2] / 255;
                            if (l < .5) {
                                i[r] = (2 * l * f * o + (1 - o) * l) * 255;
                            } else {
                                i[r] = ((1 - 2 * (1 - l) * (1 - f)) * o + (1 - o) * l) * 255;
                            }
                            if (c < .5) {
                                i[r + 1] = (2 * c * d * o + (1 - o) * c) * 255;
                            } else {
                                i[r + 1] = ((1 - 2 * (1 - c) * (1 - d)) * o + (1 - o) * c) * 255;
                            }
                            if (u < .5) {
                                i[r + 2] = (2 * u * h * o + (1 - o) * u) * 255;
                            } else {
                                i[r + 2] = ((1 - 2 * (1 - u) * (1 - h)) * o + (1 - o) * u) * 255;
                            }
                        }
                        return e;
                    }
                };
            };
            var i = new t();
            var n = e.data, r = e.params.gradient;
            n = i.overlay(n, r);
            delete e.params;
            return e;
        }
    });
});

define("pluginShortcuts", [ "Widget", "pluginManager", "utils", "shortcut", "mustache" ], function(e, t, i, n, r) {
    var a = t.extend({
        title: "Shortcuts",
        iconClass: "iconEdit_shortcuts",
        shortcut: n.other.shortcuts,
        initialize: function(t) {
            var i = [];
            for (var a in n) {
                var o = {
                    name: a,
                    list: []
                };
                var s = n[a];
                for (var l in s) {
                    var c = s[l].value.replace(/ /gi, " &#8226 ");
                    o.list.push({
                        shortcutName: l,
                        shortcutValue: c
                    });
                }
                i.push(o);
            }
            this.template = r.to_html([ '<div class="containerShortcuts">', "{{#container}}", '<div class="shortcutsCategory">', '<span class="titleShortcutsCategory">{{name}}</span>', '<div class="listShortcuts">', "{{#list}}", "<div>", "<span>{{{shortcutValue}}}</span>", "{{shortcutName}}", "</div>", "{{/list}}", "</div>", "</div>", "{{/container}}", "</div>" ].join(""), {
                container: i
            });
            var u = new e.Button({
                click: this.open.bind(this),
                title: "Shortcuts",
                parentToolbar: t,
                classList: [ this.iconClass ]
            });
        },
        start: function() {
            this.publish("plugin.showed", {
                title: this.title
            });
            var t = new e.Dialog({
                title: "Shortcuts",
                text: this.template,
                styleList: {},
                classList: [ "shortcutsPopup" ],
                disableOk: true,
                disableCancel: true,
                onClose: this.close.bind(this),
                onOk: function() {},
                onCancel: function() {},
                onRender: function() {}
            });
        },
        apply: function() {}
    });
    return a;
});

define("pluginXmp", [ "Widget", "pluginManager", "taskManager", "decode", "resizeImage", "shortcut", "signal" ], function(e, t, i, n, r, a, o) {
    return t.extend({
        title: "xmp",
        shortcut: a.file.xmp,
        initialize: function(t) {
            var i = this;
            i.xmpFile = new e.InputFile({
                id: "loadXmpFile",
                title: "Load Adjustments",
                container: t,
                classList: [ "iconEdit_loadAdj" ],
                mimetypes: [ "text/xml", "" ],
                type: "xml",
                onReady: function(e, t) {
                    i.publish("saveToAnalitics", [ "Edit", "Xmp", "Open" ]);
                    if (i.validate(t)) {
                        editor.loadXmp(e).then(function(e) {
                            editor.applyXmp(e);
                        }).fail(function() {
                            o.publish("dialog.alert.show", {
                                key: "incorrectXmpFile"
                            });
                        });
                    } else {
                        o.publish("dialog.alert.show", {
                            key: "incorrectFileType"
                        });
                    }
                }
            });
            i.saveFile = new e.Button({
                click: function() {
                    editor.saveXmp();
                    i.publish("saveToAnalitics", [ "Edit", "Xmp", "Save" ]);
                },
                title: "Save Adjustments",
                parentToolbar: t,
                classList: [ "iconEdit_saveAdj" ]
            });
        },
        start: function() {
            this.xmpFile.open();
            this.isOpened = false;
        },
        validate: function(e) {
            var t = e.name, i = t.split(".");
            if (i[i.length - 1] !== "xmp") {
                return false;
            }
            return true;
        }
    });
});

define("picsEdit", [ "editor", "pluginInvert", "pluginEmpty", "pluginSepia", "pluginSaturation", "pluginSaver", "pluginContrast", "pluginCurves", "pluginCrop", "pluginUndo", "pluginColorPicker", "pluginBrightness", "pluginGrayscale", "pluginTemperature", "pluginTransform", "pluginHsl", "pluginOpenFile", "pluginAbout", "pluginFullscreen", "pluginExternalCaller", "pluginRedEyes", "pluginSharpen", "pluginBlur", "pluginEmboss", "pluginEdge", "pluginColorGetter", "pluginGradient", "pluginShortcuts", "pluginXmp" ], function(e, t, i, n, r, a, o, s, l, c, u, f, d, h, p, g, m, v, y, b, w, C, x, _, S, k, A, E, T) {
    var P = {
        invert: t,
        empty: i,
        sepia: n,
        saturation: r,
        saver: a,
        contrast: o,
        curves: s,
        crop: l,
        undo: c,
        colorpicker: u,
        brightness: f,
        grayscale: d,
        temperature: h,
        transform: p,
        hsl: g,
        openFile: m,
        about: v,
        fullscreen: y,
        externalCaller: b,
        redEyes: w,
        sharpen: C,
        blur: x,
        emboss: _,
        edge: S,
        colorGetter: k,
        gradient: A,
        hotkeys: E,
        xmp: T
    };
    e.plugins = P;
    return e;
});

if (typeof PDFJS === "undefined") {
    (typeof window !== "undefined" ? window : this).PDFJS = {};
}

PDFJS.version = "1.1.222";

PDFJS.build = "18e1a14";

(function t() {
    var e = typeof window === "undefined" ? this : window;
    var t = typeof window === "undefined";
    var i = [ .001, 0, 0, .001, 0, 0 ];
    var n = {
        FILL: 0,
        STROKE: 1,
        FILL_STROKE: 2,
        INVISIBLE: 3,
        FILL_ADD_TO_PATH: 4,
        STROKE_ADD_TO_PATH: 5,
        FILL_STROKE_ADD_TO_PATH: 6,
        ADD_TO_PATH: 7,
        FILL_STROKE_MASK: 3,
        ADD_TO_PATH_FLAG: 4
    };
    var r = {
        GRAYSCALE_1BPP: 1,
        RGB_24BPP: 2,
        RGBA_32BPP: 3
    };
    var a = {
        WIDGET: 1,
        TEXT: 2,
        LINK: 3
    };
    var o = {
        UNKNOWN: 0,
        FLATE: 1,
        LZW: 2,
        DCT: 3,
        JPX: 4,
        JBIG: 5,
        A85: 6,
        AHX: 7,
        CCF: 8,
        RL: 9
    };
    var s = {
        UNKNOWN: 0,
        TYPE1: 1,
        TYPE1C: 2,
        CIDFONTTYPE0: 3,
        CIDFONTTYPE0C: 4,
        TRUETYPE: 5,
        CIDFONTTYPE2: 6,
        TYPE3: 7,
        OPENTYPE: 8,
        TYPE0: 9,
        MMTYPE1: 10
    };
    if (!e.PDFJS) {
        e.PDFJS = {};
    }
    e.PDFJS.pdfBug = false;
    PDFJS.VERBOSITY_LEVELS = {
        errors: 0,
        warnings: 1,
        infos: 5
    };
    var l = PDFJS.OPS = {
        dependency: 1,
        setLineWidth: 2,
        setLineCap: 3,
        setLineJoin: 4,
        setMiterLimit: 5,
        setDash: 6,
        setRenderingIntent: 7,
        setFlatness: 8,
        setGState: 9,
        save: 10,
        restore: 11,
        transform: 12,
        moveTo: 13,
        lineTo: 14,
        curveTo: 15,
        curveTo2: 16,
        curveTo3: 17,
        closePath: 18,
        rectangle: 19,
        stroke: 20,
        closeStroke: 21,
        fill: 22,
        eoFill: 23,
        fillStroke: 24,
        eoFillStroke: 25,
        closeFillStroke: 26,
        closeEOFillStroke: 27,
        endPath: 28,
        clip: 29,
        eoClip: 30,
        beginText: 31,
        endText: 32,
        setCharSpacing: 33,
        setWordSpacing: 34,
        setHScale: 35,
        setLeading: 36,
        setFont: 37,
        setTextRenderingMode: 38,
        setTextRise: 39,
        moveText: 40,
        setLeadingMoveText: 41,
        setTextMatrix: 42,
        nextLine: 43,
        showText: 44,
        showSpacedText: 45,
        nextLineShowText: 46,
        nextLineSetSpacingShowText: 47,
        setCharWidth: 48,
        setCharWidthAndBounds: 49,
        setStrokeColorSpace: 50,
        setFillColorSpace: 51,
        setStrokeColor: 52,
        setStrokeColorN: 53,
        setFillColor: 54,
        setFillColorN: 55,
        setStrokeGray: 56,
        setFillGray: 57,
        setStrokeRGBColor: 58,
        setFillRGBColor: 59,
        setStrokeCMYKColor: 60,
        setFillCMYKColor: 61,
        shadingFill: 62,
        beginInlineImage: 63,
        beginImageData: 64,
        endInlineImage: 65,
        paintXObject: 66,
        markPoint: 67,
        markPointProps: 68,
        beginMarkedContent: 69,
        beginMarkedContentProps: 70,
        endMarkedContent: 71,
        beginCompat: 72,
        endCompat: 73,
        paintFormXObjectBegin: 74,
        paintFormXObjectEnd: 75,
        beginGroup: 76,
        endGroup: 77,
        beginAnnotations: 78,
        endAnnotations: 79,
        beginAnnotation: 80,
        endAnnotation: 81,
        paintJpegXObject: 82,
        paintImageMaskXObject: 83,
        paintImageMaskXObjectGroup: 84,
        paintImageXObject: 85,
        paintInlineImageXObject: 86,
        paintInlineImageXObjectGroup: 87,
        paintImageXObjectRepeat: 88,
        paintImageMaskXObjectRepeat: 89,
        paintSolidColorImageMask: 90,
        constructPath: 91
    };
    function c(e) {
        if (PDFJS.verbosity >= PDFJS.VERBOSITY_LEVELS.infos) {
            console.log("Info: " + e);
        }
    }
    function u(e) {
        if (PDFJS.verbosity >= PDFJS.VERBOSITY_LEVELS.warnings) {
            console.log("Warning: " + e);
        }
    }
    function f(e) {
        if (PDFJS.verbosity >= PDFJS.VERBOSITY_LEVELS.errors) {
            console.log("Error: " + e);
            console.log(d());
        }
        g.notify(p.unknown);
        throw new Error(e);
    }
    function d() {
        try {
            throw new Error();
        } catch (e) {
            return e.stack ? e.stack.split("\n").slice(2).join("\n") : "";
        }
    }
    function h(e, t) {
        if (!e) {
            f(t);
        }
    }
    var p = PDFJS.UNSUPPORTED_FEATURES = {
        unknown: "unknown",
        forms: "forms",
        javaScript: "javaScript",
        smask: "smask",
        shadingPattern: "shadingPattern",
        font: "font"
    };
    var g = PDFJS.UnsupportedManager = function qt() {
        var e = [];
        return {
            listen: function(t) {
                e.push(t);
            },
            notify: function(t) {
                u('Unsupported feature "' + t + '"');
                for (var i = 0, n = e.length; i < n; i++) {
                    e[i](t);
                }
            }
        };
    }();
    function m(e, t) {
        if (!t) {
            return e;
        }
        if (/^[a-z][a-z0-9+\-.]*:/i.test(t)) {
            return t;
        }
        var i;
        if (t.charAt(0) === "/") {
            i = e.indexOf("://");
            if (t.charAt(1) === "/") {
                ++i;
            } else {
                i = e.indexOf("/", i + 3);
            }
            return e.substring(0, i) + t;
        } else {
            var n = e.length;
            i = e.lastIndexOf("#");
            n = i >= 0 ? i : n;
            i = e.lastIndexOf("?", n);
            n = i >= 0 ? i : n;
            var r = e.lastIndexOf("/", n);
            return e.substring(0, r + 1) + t;
        }
    }
    function v(e, t) {
        if (!e) {
            return false;
        }
        var i = /^[a-z][a-z0-9+\-.]*(?=:)/i.exec(e);
        if (!i) {
            return t;
        }
        i = i[0].toLowerCase();
        switch (i) {
          case "http":
          case "https":
          case "ftp":
          case "mailto":
          case "tel":
            return true;

          default:
            return false;
        }
    }
    PDFJS.isValidUrl = v;
    function y(e, t, i) {
        Object.defineProperty(e, t, {
            value: i,
            enumerable: true,
            configurable: true,
            writable: false
        });
        return i;
    }
    PDFJS.shadow = y;
    var b = PDFJS.PasswordResponses = {
        NEED_PASSWORD: 1,
        INCORRECT_PASSWORD: 2
    };
    var w = function Wt() {
        function e(e, t) {
            this.name = "PasswordException";
            this.message = e;
            this.code = t;
        }
        e.prototype = new Error();
        e.constructor = e;
        return e;
    }();
    PDFJS.PasswordException = w;
    var C = function Ht() {
        function e(e, t) {
            this.name = "UnknownErrorException";
            this.message = e;
            this.details = t;
        }
        e.prototype = new Error();
        e.constructor = e;
        return e;
    }();
    PDFJS.UnknownErrorException = C;
    var x = function Gt() {
        function e(e) {
            this.name = "InvalidPDFException";
            this.message = e;
        }
        e.prototype = new Error();
        e.constructor = e;
        return e;
    }();
    PDFJS.InvalidPDFException = x;
    var _ = function Vt() {
        function e(e) {
            this.name = "MissingPDFException";
            this.message = e;
        }
        e.prototype = new Error();
        e.constructor = e;
        return e;
    }();
    PDFJS.MissingPDFException = _;
    var S = function $t() {
        function e(e, t) {
            this.name = "UnexpectedResponseException";
            this.message = e;
            this.status = t;
        }
        e.prototype = new Error();
        e.constructor = e;
        return e;
    }();
    PDFJS.UnexpectedResponseException = S;
    var k = function Yt() {
        function e(e) {
            this.message = e;
        }
        e.prototype = new Error();
        e.prototype.name = "NotImplementedException";
        e.constructor = e;
        return e;
    }();
    var A = function Xt() {
        function e(e, t) {
            this.begin = e;
            this.end = t;
            this.message = "Missing data [" + e + ", " + t + ")";
        }
        e.prototype = new Error();
        e.prototype.name = "MissingDataException";
        e.constructor = e;
        return e;
    }();
    var E = function Jt() {
        function e(e) {
            this.message = e;
        }
        e.prototype = new Error();
        e.prototype.name = "XRefParseException";
        e.constructor = e;
        return e;
    }();
    function T(e) {
        h(e !== null && typeof e === "object" && e.length !== undefined, "Invalid argument for bytesToString");
        var t = e.length;
        var i = 8192;
        if (t < i) {
            return String.fromCharCode.apply(null, e);
        }
        var n = [];
        for (var r = 0; r < t; r += i) {
            var a = Math.min(r + i, t);
            var o = e.subarray(r, a);
            n.push(String.fromCharCode.apply(null, o));
        }
        return n.join("");
    }
    function P(e) {
        h(typeof e === "string", "Invalid argument for stringToBytes");
        var t = e.length;
        var i = new Uint8Array(t);
        for (var n = 0; n < t; ++n) {
            i[n] = e.charCodeAt(n) & 255;
        }
        return i;
    }
    function I(e) {
        return String.fromCharCode(e >> 24 & 255, e >> 16 & 255, e >> 8 & 255, e & 255);
    }
    function O(e) {
        var t = 1, i = 0;
        while (e > t) {
            t <<= 1;
            i++;
        }
        return i;
    }
    function D(e, t) {
        return e[t] << 24 >> 24;
    }
    function R(e, t) {
        return e[t] << 8 | e[t + 1];
    }
    function L(e, t) {
        return (e[t] << 24 | e[t + 1] << 16 | e[t + 2] << 8 | e[t + 3]) >>> 0;
    }
    function F() {
        var e = new Uint8Array(2);
        e[0] = 1;
        var t = new Uint16Array(e.buffer);
        return t[0] === 1;
    }
    Object.defineProperty(PDFJS, "isLittleEndian", {
        configurable: true,
        get: function Kt() {
            return y(PDFJS, "isLittleEndian", F());
        }
    });
    function M() {
        var e = document.createElement("canvas");
        e.width = e.height = 1;
        var t = e.getContext("2d");
        var i = t.createImageData(1, 1);
        return typeof i.data.buffer !== "undefined";
    }
    Object.defineProperty(PDFJS, "hasCanvasTypedArrays", {
        configurable: true,
        get: function Qt() {
            return y(PDFJS, "hasCanvasTypedArrays", M());
        }
    });
    var N = function Zt() {
        function e(e, t) {
            this.buffer = e;
            this.byteLength = e.length;
            this.length = t === undefined ? this.byteLength >> 2 : t;
            n(this.length);
        }
        e.prototype = Object.create(null);
        var t = 0;
        function i(e) {
            return {
                get: function() {
                    var t = this.buffer, i = e << 2;
                    return (t[i] | t[i + 1] << 8 | t[i + 2] << 16 | t[i + 3] << 24) >>> 0;
                },
                set: function(t) {
                    var i = this.buffer, n = e << 2;
                    i[n] = t & 255;
                    i[n + 1] = t >> 8 & 255;
                    i[n + 2] = t >> 16 & 255;
                    i[n + 3] = t >>> 24 & 255;
                }
            };
        }
        function n(n) {
            while (t < n) {
                Object.defineProperty(e.prototype, t, i(t));
                t++;
            }
        }
        return e;
    }();
    var B = [ 1, 0, 0, 1, 0, 0 ];
    var j = PDFJS.Util = function ei() {
        function e() {}
        var t = [ "rgb(", 0, ",", 0, ",", 0, ")" ];
        e.makeCssRgb = function i(e, n, r) {
            t[1] = e;
            t[3] = n;
            t[5] = r;
            return t.join("");
        };
        e.transform = function n(e, t) {
            return [ e[0] * t[0] + e[2] * t[1], e[1] * t[0] + e[3] * t[1], e[0] * t[2] + e[2] * t[3], e[1] * t[2] + e[3] * t[3], e[0] * t[4] + e[2] * t[5] + e[4], e[1] * t[4] + e[3] * t[5] + e[5] ];
        };
        e.applyTransform = function r(e, t) {
            var i = e[0] * t[0] + e[1] * t[2] + t[4];
            var n = e[0] * t[1] + e[1] * t[3] + t[5];
            return [ i, n ];
        };
        e.applyInverseTransform = function a(e, t) {
            var i = t[0] * t[3] - t[1] * t[2];
            var n = (e[0] * t[3] - e[1] * t[2] + t[2] * t[5] - t[4] * t[3]) / i;
            var r = (-e[0] * t[1] + e[1] * t[0] + t[4] * t[1] - t[5] * t[0]) / i;
            return [ n, r ];
        };
        e.getAxialAlignedBoundingBox = function o(t, i) {
            var n = e.applyTransform(t, i);
            var r = e.applyTransform(t.slice(2, 4), i);
            var a = e.applyTransform([ t[0], t[3] ], i);
            var o = e.applyTransform([ t[2], t[1] ], i);
            return [ Math.min(n[0], r[0], a[0], o[0]), Math.min(n[1], r[1], a[1], o[1]), Math.max(n[0], r[0], a[0], o[0]), Math.max(n[1], r[1], a[1], o[1]) ];
        };
        e.inverseTransform = function s(e) {
            var t = e[0] * e[3] - e[1] * e[2];
            return [ e[3] / t, -e[1] / t, -e[2] / t, e[0] / t, (e[2] * e[5] - e[4] * e[3]) / t, (e[4] * e[1] - e[5] * e[0]) / t ];
        };
        e.apply3dTransform = function l(e, t) {
            return [ e[0] * t[0] + e[1] * t[1] + e[2] * t[2], e[3] * t[0] + e[4] * t[1] + e[5] * t[2], e[6] * t[0] + e[7] * t[1] + e[8] * t[2] ];
        };
        e.singularValueDecompose2dScale = function c(e) {
            var t = [ e[0], e[2], e[1], e[3] ];
            var i = e[0] * t[0] + e[1] * t[2];
            var n = e[0] * t[1] + e[1] * t[3];
            var r = e[2] * t[0] + e[3] * t[2];
            var a = e[2] * t[1] + e[3] * t[3];
            var o = (i + a) / 2;
            var s = Math.sqrt((i + a) * (i + a) - 4 * (i * a - r * n)) / 2;
            var l = o + s || 1;
            var c = o - s || 1;
            return [ Math.sqrt(l), Math.sqrt(c) ];
        };
        e.normalizeRect = function u(e) {
            var t = e.slice(0);
            if (e[0] > e[2]) {
                t[0] = e[2];
                t[2] = e[0];
            }
            if (e[1] > e[3]) {
                t[1] = e[3];
                t[3] = e[1];
            }
            return t;
        };
        e.intersect = function f(t, i) {
            function n(e, t) {
                return e - t;
            }
            var r = [ t[0], t[2], i[0], i[2] ].sort(n), a = [ t[1], t[3], i[1], i[3] ].sort(n), o = [];
            t = e.normalizeRect(t);
            i = e.normalizeRect(i);
            if (r[0] === t[0] && r[1] === i[0] || r[0] === i[0] && r[1] === t[0]) {
                o[0] = r[1];
                o[2] = r[2];
            } else {
                return false;
            }
            if (a[0] === t[1] && a[1] === i[1] || a[0] === i[1] && a[1] === t[1]) {
                o[1] = a[1];
                o[3] = a[2];
            } else {
                return false;
            }
            return o;
        };
        e.sign = function d(e) {
            return e < 0 ? -1 : 1;
        };
        e.appendToArray = function h(e, t) {
            Array.prototype.push.apply(e, t);
        };
        e.prependToArray = function p(e, t) {
            Array.prototype.unshift.apply(e, t);
        };
        e.extendObj = function g(e, t) {
            for (var i in t) {
                e[i] = t[i];
            }
        };
        e.getInheritableProperty = function m(e, t) {
            while (e && !e.has(t)) {
                e = e.get("Parent");
            }
            if (!e) {
                return null;
            }
            return e.get(t);
        };
        e.inherit = function v(e, t, i) {
            e.prototype = Object.create(t.prototype);
            e.prototype.constructor = e;
            for (var n in i) {
                e.prototype[n] = i[n];
            }
        };
        e.loadScript = function y(e, t) {
            var i = document.createElement("script");
            var n = false;
            i.setAttribute("src", e);
            if (t) {
                i.onload = function() {
                    if (!n) {
                        t();
                    }
                    n = true;
                };
            }
            document.getElementsByTagName("head")[0].appendChild(i);
        };
        return e;
    }();
    var U = PDFJS.PageViewport = function ti() {
        function e(e, t, i, n, r, a) {
            this.viewBox = e;
            this.scale = t;
            this.rotation = i;
            this.offsetX = n;
            this.offsetY = r;
            var o = (e[2] + e[0]) / 2;
            var s = (e[3] + e[1]) / 2;
            var l, c, u, f;
            i = i % 360;
            i = i < 0 ? i + 360 : i;
            switch (i) {
              case 180:
                l = -1;
                c = 0;
                u = 0;
                f = 1;
                break;

              case 90:
                l = 0;
                c = 1;
                u = 1;
                f = 0;
                break;

              case 270:
                l = 0;
                c = -1;
                u = -1;
                f = 0;
                break;

              default:
                l = 1;
                c = 0;
                u = 0;
                f = -1;
                break;
            }
            if (a) {
                u = -u;
                f = -f;
            }
            var d, h;
            var p, g;
            if (l === 0) {
                d = Math.abs(s - e[1]) * t + n;
                h = Math.abs(o - e[0]) * t + r;
                p = Math.abs(e[3] - e[1]) * t;
                g = Math.abs(e[2] - e[0]) * t;
            } else {
                d = Math.abs(o - e[0]) * t + n;
                h = Math.abs(s - e[1]) * t + r;
                p = Math.abs(e[2] - e[0]) * t;
                g = Math.abs(e[3] - e[1]) * t;
            }
            this.transform = [ l * t, c * t, u * t, f * t, d - l * t * o - u * t * s, h - c * t * o - f * t * s ];
            this.width = p;
            this.height = g;
            this.fontScale = t;
        }
        e.prototype = {
            clone: function t(i) {
                i = i || {};
                var n = "scale" in i ? i.scale : this.scale;
                var r = "rotation" in i ? i.rotation : this.rotation;
                return new e(this.viewBox.slice(), n, r, this.offsetX, this.offsetY, i.dontFlip);
            },
            convertToViewportPoint: function i(e, t) {
                return j.applyTransform([ e, t ], this.transform);
            },
            convertToViewportRectangle: function n(e) {
                var t = j.applyTransform([ e[0], e[1] ], this.transform);
                var i = j.applyTransform([ e[2], e[3] ], this.transform);
                return [ t[0], t[1], i[0], i[1] ];
            },
            convertToPdfPoint: function r(e, t) {
                return j.applyInverseTransform([ e, t ], this.transform);
            }
        };
        return e;
    }();
    var z = [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 728, 711, 710, 729, 733, 731, 730, 732, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 8226, 8224, 8225, 8230, 8212, 8211, 402, 8260, 8249, 8250, 8722, 8240, 8222, 8220, 8221, 8216, 8217, 8218, 8482, 64257, 64258, 321, 338, 352, 376, 381, 305, 322, 339, 353, 382, 0, 8364 ];
    function q(e) {
        var t, i = e.length, n = [];
        if (e[0] === "" && e[1] === "") {
            for (t = 2; t < i; t += 2) {
                n.push(String.fromCharCode(e.charCodeAt(t) << 8 | e.charCodeAt(t + 1)));
            }
        } else {
            for (t = 0; t < i; ++t) {
                var r = z[e.charCodeAt(t)];
                n.push(r ? String.fromCharCode(r) : e.charAt(t));
            }
        }
        return n.join("");
    }
    function W(e) {
        return decodeURIComponent(escape(e));
    }
    function H(e) {
        return unescape(encodeURIComponent(e));
    }
    function G(e) {
        for (var t in e) {
            return false;
        }
        return true;
    }
    function V(e) {
        return typeof e === "boolean";
    }
    function $(e) {
        return typeof e === "number" && (e | 0) === e;
    }
    function Y(e) {
        return typeof e === "number";
    }
    function X(e) {
        return typeof e === "string";
    }
    function J(e) {
        return e instanceof Name;
    }
    function K(e, t) {
        return e instanceof Cmd && (t === undefined || e.cmd === t);
    }
    function Q(e, t) {
        if (!(e instanceof Dict)) {
            return false;
        }
        if (!t) {
            return true;
        }
        var i = e.get("Type");
        return J(i) && i.name === t;
    }
    function Z(e) {
        return e instanceof Array;
    }
    function et(e) {
        return typeof e === "object" && e !== null && e.getBytes !== undefined;
    }
    function tt(e) {
        return typeof e === "object" && e !== null && e.byteLength !== undefined;
    }
    function it(e) {
        return e instanceof Ref;
    }
    function nt() {
        var e = {};
        e.promise = new Promise(function(t, i) {
            e.resolve = t;
            e.reject = i;
        });
        return e;
    }
    PDFJS.createPromiseCapability = nt;
    (function ii() {
        if (e.Promise) {
            if (typeof e.Promise.all !== "function") {
                e.Promise.all = function(t) {
                    var i = 0, n = [], r, a;
                    var o = new e.Promise(function(e, t) {
                        r = e;
                        a = t;
                    });
                    t.forEach(function(e, t) {
                        i++;
                        e.then(function(e) {
                            n[t] = e;
                            i--;
                            if (i === 0) {
                                r(n);
                            }
                        }, a);
                    });
                    if (i === 0) {
                        r(n);
                    }
                    return o;
                };
            }
            if (typeof e.Promise.resolve !== "function") {
                e.Promise.resolve = function(t) {
                    return new e.Promise(function(e) {
                        e(t);
                    });
                };
            }
            if (typeof e.Promise.reject !== "function") {
                e.Promise.reject = function(t) {
                    return new e.Promise(function(e, i) {
                        i(t);
                    });
                };
            }
            if (typeof e.Promise.prototype.catch !== "function") {
                e.Promise.prototype.catch = function(t) {
                    return e.Promise.prototype.then(undefined, t);
                };
            }
            return;
        }
        var t = 0;
        var i = 1;
        var n = 2;
        var r = 500;
        var a = {
            handlers: [],
            running: false,
            unhandledRejections: [],
            pendingRejectionCheck: false,
            scheduleHandlers: function s(e) {
                if (e._status === t) {
                    return;
                }
                this.handlers = this.handlers.concat(e._handlers);
                e._handlers = [];
                if (this.running) {
                    return;
                }
                this.running = true;
                setTimeout(this.runHandlers.bind(this), 0);
            },
            runHandlers: function l() {
                var e = 1;
                var t = Date.now() + e;
                while (this.handlers.length > 0) {
                    var r = this.handlers.shift();
                    var a = r.thisPromise._status;
                    var o = r.thisPromise._value;
                    try {
                        if (a === i) {
                            if (typeof r.onResolve === "function") {
                                o = r.onResolve(o);
                            }
                        } else if (typeof r.onReject === "function") {
                            o = r.onReject(o);
                            a = i;
                            if (r.thisPromise._unhandledRejection) {
                                this.removeUnhandeledRejection(r.thisPromise);
                            }
                        }
                    } catch (s) {
                        a = n;
                        o = s;
                    }
                    r.nextPromise._updateStatus(a, o);
                    if (Date.now() >= t) {
                        break;
                    }
                }
                if (this.handlers.length > 0) {
                    setTimeout(this.runHandlers.bind(this), 0);
                    return;
                }
                this.running = false;
            },
            addUnhandledRejection: function c(e) {
                this.unhandledRejections.push({
                    promise: e,
                    time: Date.now()
                });
                this.scheduleRejectionCheck();
            },
            removeUnhandeledRejection: function f(e) {
                e._unhandledRejection = false;
                for (var t = 0; t < this.unhandledRejections.length; t++) {
                    if (this.unhandledRejections[t].promise === e) {
                        this.unhandledRejections.splice(t);
                        t--;
                    }
                }
            },
            scheduleRejectionCheck: function d() {
                if (this.pendingRejectionCheck) {
                    return;
                }
                this.pendingRejectionCheck = true;
                setTimeout(function e() {
                    this.pendingRejectionCheck = false;
                    var e = Date.now();
                    for (var t = 0; t < this.unhandledRejections.length; t++) {
                        if (e - this.unhandledRejections[t].time > r) {
                            var i = this.unhandledRejections[t].promise._value;
                            var n = "Unhandled rejection: " + i;
                            if (i.stack) {
                                n += "\n" + i.stack;
                            }
                            u(n);
                            this.unhandledRejections.splice(t);
                            t--;
                        }
                    }
                    if (this.unhandledRejections.length) {
                        this.scheduleRejectionCheck();
                    }
                }.bind(this), r);
            }
        };
        function o(e) {
            this._status = t;
            this._handlers = [];
            try {
                e.call(this, this._resolve.bind(this), this._reject.bind(this));
            } catch (i) {
                this._reject(i);
            }
        }
        o.all = function h(e) {
            var t, i;
            var r = new o(function(e, n) {
                t = e;
                i = n;
            });
            var a = e.length;
            var s = [];
            if (a === 0) {
                t(s);
                return r;
            }
            function l(e) {
                if (r._status === n) {
                    return;
                }
                s = [];
                i(e);
            }
            for (var c = 0, u = e.length; c < u; ++c) {
                var f = e[c];
                var d = function(e) {
                    return function(i) {
                        if (r._status === n) {
                            return;
                        }
                        s[e] = i;
                        a--;
                        if (a === 0) {
                            t(s);
                        }
                    };
                }(c);
                if (o.isPromise(f)) {
                    f.then(d, l);
                } else {
                    d(f);
                }
            }
            return r;
        };
        o.isPromise = function p(e) {
            return e && typeof e.then === "function";
        };
        o.resolve = function g(e) {
            return new o(function(t) {
                t(e);
            });
        };
        o.reject = function m(e) {
            return new o(function(t, i) {
                i(e);
            });
        };
        o.prototype = {
            _status: null,
            _value: null,
            _handlers: null,
            _unhandledRejection: null,
            _updateStatus: function v(e, t) {
                if (this._status === i || this._status === n) {
                    return;
                }
                if (e === i && o.isPromise(t)) {
                    t.then(this._updateStatus.bind(this, i), this._updateStatus.bind(this, n));
                    return;
                }
                this._status = e;
                this._value = t;
                if (e === n && this._handlers.length === 0) {
                    this._unhandledRejection = true;
                    a.addUnhandledRejection(this);
                }
                a.scheduleHandlers(this);
            },
            _resolve: function y(e) {
                this._updateStatus(i, e);
            },
            _reject: function b(e) {
                this._updateStatus(n, e);
            },
            then: function w(e, t) {
                var i = new o(function(e, t) {
                    this.resolve = e;
                    this.reject = t;
                });
                this._handlers.push({
                    thisPromise: this,
                    onResolve: e,
                    onReject: t,
                    nextPromise: i
                });
                a.scheduleHandlers(this);
                return i;
            },
            "catch": function C(e) {
                return this.then(undefined, e);
            }
        };
        e.Promise = o;
    })();
    var rt = function ni() {
        function e(e, t, i) {
            while (e.length < i) {
                e += t;
            }
            return e;
        }
        function t() {
            this.started = {};
            this.times = [];
            this.enabled = true;
        }
        t.prototype = {
            time: function i(e) {
                if (!this.enabled) {
                    return;
                }
                if (e in this.started) {
                    u("Timer is already running for " + e);
                }
                this.started[e] = Date.now();
            },
            timeEnd: function n(e) {
                if (!this.enabled) {
                    return;
                }
                if (!(e in this.started)) {
                    u("Timer has not been started for " + e);
                }
                this.times.push({
                    name: e,
                    start: this.started[e],
                    end: Date.now()
                });
                delete this.started[e];
            },
            toString: function r() {
                var t, i;
                var n = this.times;
                var r = "";
                var a = 0;
                for (t = 0, i = n.length; t < i; ++t) {
                    var o = n[t]["name"];
                    if (o.length > a) {
                        a = o.length;
                    }
                }
                for (t = 0, i = n.length; t < i; ++t) {
                    var s = n[t];
                    var l = s.end - s.start;
                    r += e(s["name"], " ", a) + " " + l + "ms\n";
                }
                return r;
            }
        };
        return t;
    }();
    PDFJS.createBlob = function ri(e, t) {
        if (typeof Blob !== "undefined") {
            return new Blob([ e ], {
                type: t
            });
        }
        var i = new MozBlobBuilder();
        i.append(e);
        return i.getBlob(t);
    };
    PDFJS.createObjectURL = function ai() {
        var e = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";
        return function t(i, n) {
            if (!PDFJS.disableCreateObjectURL && typeof URL !== "undefined" && URL.createObjectURL) {
                var r = PDFJS.createBlob(i, n);
                return URL.createObjectURL(r);
            }
            var a = "data:" + n + ";base64,";
            for (var o = 0, s = i.length; o < s; o += 3) {
                var l = i[o] & 255;
                var c = i[o + 1] & 255;
                var u = i[o + 2] & 255;
                var f = l >> 2, d = (l & 3) << 4 | c >> 4;
                var h = o + 1 < s ? (c & 15) << 2 | u >> 6 : 64;
                var p = o + 2 < s ? u & 63 : 64;
                a += e[f] + e[d] + e[h] + e[p];
            }
            return a;
        };
    }();
    function at(e, t) {
        this.name = e;
        this.comObj = t;
        this.callbackIndex = 1;
        this.postMessageTransfers = true;
        var i = this.callbacksCapabilities = {};
        var n = this.actionHandler = {};
        n["console_log"] = [ function r(e) {
            console.log.apply(console, e);
        } ];
        n["console_error"] = [ function a(e) {
            console.error.apply(console, e);
        } ];
        n["_unsupported_feature"] = [ function o(e) {
            g.notify(e);
        } ];
        t.onmessage = function s(e) {
            var r = e.data;
            if (r.isReply) {
                var a = r.callbackId;
                if (r.callbackId in i) {
                    var o = i[a];
                    delete i[a];
                    if ("error" in r) {
                        o.reject(r.error);
                    } else {
                        o.resolve(r.data);
                    }
                } else {
                    f("Cannot resolve callback " + a);
                }
            } else if (r.action in n) {
                var s = n[r.action];
                if (r.callbackId) {
                    Promise.resolve().then(function() {
                        return s[0].call(s[1], r.data);
                    }).then(function(e) {
                        t.postMessage({
                            isReply: true,
                            callbackId: r.callbackId,
                            data: e
                        });
                    }, function(e) {
                        t.postMessage({
                            isReply: true,
                            callbackId: r.callbackId,
                            error: e
                        });
                    });
                } else {
                    s[0].call(s[1], r.data);
                }
            } else {
                f("Unknown action from worker: " + r.action);
            }
        };
    }
    at.prototype = {
        on: function oi(e, t, i) {
            var n = this.actionHandler;
            if (n[e]) {
                f('There is already an actionName called "' + e + '"');
            }
            n[e] = [ t, i ];
        },
        send: function si(e, t, i) {
            var n = {
                action: e,
                data: t
            };
            this.postMessage(n, i);
        },
        sendWithPromise: function li(e, t, i) {
            var n = this.callbackIndex++;
            var r = {
                action: e,
                data: t,
                callbackId: n
            };
            var a = nt();
            this.callbacksCapabilities[n] = a;
            try {
                this.postMessage(r, i);
            } catch (o) {
                a.reject(o);
            }
            return a.promise;
        },
        postMessage: function(e, t) {
            if (t && this.postMessageTransfers) {
                this.comObj.postMessage(e, t);
            } else {
                this.comObj.postMessage(e);
            }
        }
    };
    function ot(e, t, i) {
        var n = new Image();
        n.onload = function r() {
            i.resolve(e, n);
        };
        n.onerror = function a() {
            i.resolve(e, null);
            u("Error during JPEG image loading");
        };
        n.src = t;
    }
    PDFJS.maxImageSize = PDFJS.maxImageSize === undefined ? -1 : PDFJS.maxImageSize;
    PDFJS.cMapUrl = PDFJS.cMapUrl === undefined ? null : PDFJS.cMapUrl;
    PDFJS.cMapPacked = PDFJS.cMapPacked === undefined ? false : PDFJS.cMapPacked;
    PDFJS.disableFontFace = PDFJS.disableFontFace === undefined ? false : PDFJS.disableFontFace;
    PDFJS.imageResourcesPath = PDFJS.imageResourcesPath === undefined ? "" : PDFJS.imageResourcesPath;
    PDFJS.disableWorker = PDFJS.disableWorker === undefined ? false : PDFJS.disableWorker;
    PDFJS.workerSrc = PDFJS.workerSrc === undefined ? null : PDFJS.workerSrc;
    PDFJS.disableRange = PDFJS.disableRange === undefined ? false : PDFJS.disableRange;
    PDFJS.disableStream = PDFJS.disableStream === undefined ? false : PDFJS.disableStream;
    PDFJS.disableAutoFetch = PDFJS.disableAutoFetch === undefined ? false : PDFJS.disableAutoFetch;
    PDFJS.pdfBug = PDFJS.pdfBug === undefined ? false : PDFJS.pdfBug;
    PDFJS.postMessageTransfers = PDFJS.postMessageTransfers === undefined ? true : PDFJS.postMessageTransfers;
    PDFJS.disableCreateObjectURL = PDFJS.disableCreateObjectURL === undefined ? false : PDFJS.disableCreateObjectURL;
    PDFJS.disableWebGL = PDFJS.disableWebGL === undefined ? true : PDFJS.disableWebGL;
    PDFJS.disableFullscreen = PDFJS.disableFullscreen === undefined ? false : PDFJS.disableFullscreen;
    PDFJS.useOnlyCssZoom = PDFJS.useOnlyCssZoom === undefined ? false : PDFJS.useOnlyCssZoom;
    PDFJS.verbosity = PDFJS.verbosity === undefined ? PDFJS.VERBOSITY_LEVELS.warnings : PDFJS.verbosity;
    PDFJS.maxCanvasPixels = PDFJS.maxCanvasPixels === undefined ? 16777216 : PDFJS.maxCanvasPixels;
    PDFJS.openExternalLinksInNewWindow = PDFJS.openExternalLinksInNewWindow === undefined ? false : PDFJS.openExternalLinksInNewWindow;
    PDFJS.getDocument = function ci(e, t, i, n) {
        var r = new st();
        if (t) {
            if (!(t instanceof lt)) {
                t = Object.create(t);
                t.length = e.length;
                t.initialData = e.initialData;
            }
            e = Object.create(e);
            e.range = t;
        }
        r.onPassword = i || null;
        r.onProgress = n || null;
        var a, o;
        var s;
        if (typeof e === "string") {
            s = {
                url: e
            };
        } else if (tt(e)) {
            s = {
                data: e
            };
        } else if (e instanceof lt) {
            s = {
                range: e
            };
        } else {
            if (typeof e !== "object") {
                f("Invalid parameter in getDocument, need either Uint8Array, " + "string or a parameter object");
            }
            if (!e.url && !e.data && !e.range) {
                f("Invalid parameter object: need either .data, .range or .url");
            }
            s = e;
        }
        var l = {};
        for (var c in s) {
            if (c === "url" && typeof window !== "undefined") {
                l[c] = m(window.location.href, s[c]);
                continue;
            } else if (c === "range") {
                continue;
            } else if (c === "data" && !(s[c] instanceof Uint8Array)) {
                var u = s[c];
                if (typeof u === "string") {
                    l[c] = P(u);
                } else if (typeof u === "object" && u !== null && !isNaN(u.length)) {
                    l[c] = new Uint8Array(u);
                } else {
                    f("Invalid PDF binary data: either typed array, string or " + "array-like object is expected in the data property.");
                }
                continue;
            }
            l[c] = s[c];
        }
        a = nt();
        o = new ft(a, s.range);
        a.promise.then(function d() {
            o.fetchDocument(r, l);
        });
        return r;
    };
    var st = function ui() {
        function e() {
            this._capability = nt();
            this.onPassword = null;
            this.onProgress = null;
        }
        e.prototype = {
            get promise() {
                return this._capability.promise;
            },
            then: function t(e, i) {
                return this.promise.then.apply(this.promise, arguments);
            }
        };
        return e;
    }();
    var lt = function fi() {
        function e(e, t) {
            this.length = e;
            this.initialData = t;
            this._rangeListeners = [];
            this._progressListeners = [];
            this._progressiveReadListeners = [];
            this._readyCapability = nt();
        }
        e.prototype = {
            addRangeListener: function t(e) {
                this._rangeListeners.push(e);
            },
            addProgressListener: function i(e) {
                this._progressListeners.push(e);
            },
            addProgressiveReadListener: function n(e) {
                this._progressiveReadListeners.push(e);
            },
            onDataRange: function r(e, t) {
                var i = this._rangeListeners;
                for (var n = 0, r = i.length; n < r; ++n) {
                    i[n](e, t);
                }
            },
            onDataProgress: function a(e) {
                this._readyCapability.promise.then(function() {
                    var t = this._progressListeners;
                    for (var i = 0, n = t.length; i < n; ++i) {
                        t[i](e);
                    }
                }.bind(this));
            },
            onDataProgressiveRead: function o(e) {
                this._readyCapability.promise.then(function() {
                    var t = this._progressiveReadListeners;
                    for (var i = 0, n = t.length; i < n; ++i) {
                        t[i](e);
                    }
                }.bind(this));
            },
            transportReady: function s() {
                this._readyCapability.resolve();
            },
            requestDataRange: function l(e, t) {
                throw new Error("Abstract method PDFDataRangeTransport.requestDataRange");
            }
        };
        return e;
    }();
    PDFJS.PDFDataRangeTransport = lt;
    var ct = function di() {
        function e(e, t) {
            this.pdfInfo = e;
            this.transport = t;
        }
        e.prototype = {
            get numPages() {
                return this.pdfInfo.numPages;
            },
            get fingerprint() {
                return this.pdfInfo.fingerprint;
            },
            getPage: function t(e) {
                return this.transport.getPage(e);
            },
            getPageIndex: function i(e) {
                return this.transport.getPageIndex(e);
            },
            getDestinations: function n() {
                return this.transport.getDestinations();
            },
            getDestination: function r(e) {
                return this.transport.getDestination(e);
            },
            getAttachments: function a() {
                return this.transport.getAttachments();
            },
            getJavaScript: function o() {
                return this.transport.getJavaScript();
            },
            getOutline: function s() {
                return this.transport.getOutline();
            },
            getMetadata: function l() {
                return this.transport.getMetadata();
            },
            getData: function c() {
                return this.transport.getData();
            },
            getDownloadInfo: function u() {
                return this.transport.downloadInfoCapability.promise;
            },
            getStats: function f() {
                return this.transport.getStats();
            },
            cleanup: function d() {
                this.transport.startCleanup();
            },
            destroy: function h() {
                this.transport.destroy();
            }
        };
        return e;
    }();
    var ut = function hi() {
        function t(t, i, n) {
            this.pageIndex = t;
            this.pageInfo = i;
            this.transport = n;
            this.stats = new rt();
            this.stats.enabled = !!e.PDFJS.enableStats;
            this.commonObjs = n.commonObjs;
            this.objs = new dt();
            this.cleanupAfterRender = false;
            this.pendingDestroy = false;
            this.intentStates = {};
        }
        t.prototype = {
            get pageNumber() {
                return this.pageIndex + 1;
            },
            get rotate() {
                return this.pageInfo.rotate;
            },
            get ref() {
                return this.pageInfo.ref;
            },
            get view() {
                return this.pageInfo.view;
            },
            getViewport: function i(e, t) {
                if (arguments.length < 2) {
                    t = this.rotate;
                }
                return new PDFJS.PageViewport(this.view, e, t, 0, 0);
            },
            getAnnotations: function n() {
                if (this.annotationsPromise) {
                    return this.annotationsPromise;
                }
                var e = this.transport.getAnnotations(this.pageIndex);
                this.annotationsPromise = e;
                return e;
            },
            render: function r(e) {
                var t = this.stats;
                t.time("Overall");
                this.pendingDestroy = false;
                var i = e.intent === "print" ? "print" : "display";
                if (!this.intentStates[i]) {
                    this.intentStates[i] = {};
                }
                var n = this.intentStates[i];
                if (!n.displayReadyCapability) {
                    n.receivingOperatorList = true;
                    n.displayReadyCapability = nt();
                    n.operatorList = {
                        fnArray: [],
                        argsArray: [],
                        lastChunk: false
                    };
                    this.stats.time("Page Request");
                    this.transport.messageHandler.send("RenderPageRequest", {
                        pageIndex: this.pageNumber - 1,
                        intent: i
                    });
                }
                var r = new pt(s, e, this.objs, this.commonObjs, n.operatorList, this.pageNumber);
                r.useRequestAnimationFrame = i !== "print";
                if (!n.renderTasks) {
                    n.renderTasks = [];
                }
                n.renderTasks.push(r);
                var a = r.task;
                if (e.continueCallback) {
                    a.onContinue = e.continueCallback;
                }
                var o = this;
                n.displayReadyCapability.promise.then(function l(e) {
                    if (o.pendingDestroy) {
                        s();
                        return;
                    }
                    t.time("Rendering");
                    r.initalizeGraphics(e);
                    r.operatorListChanged();
                }, function c(e) {
                    s(e);
                });
                function s(e) {
                    var i = n.renderTasks.indexOf(r);
                    if (i >= 0) {
                        n.renderTasks.splice(i, 1);
                    }
                    if (o.cleanupAfterRender) {
                        o.pendingDestroy = true;
                    }
                    o._tryDestroy();
                    if (e) {
                        r.capability.reject(e);
                    } else {
                        r.capability.resolve();
                    }
                    t.timeEnd("Rendering");
                    t.timeEnd("Overall");
                }
                return a;
            },
            getOperatorList: function a() {
                function e() {
                    if (i.operatorList.lastChunk) {
                        i.opListReadCapability.resolve(i.operatorList);
                    }
                }
                var t = "oplist";
                if (!this.intentStates[t]) {
                    this.intentStates[t] = {};
                }
                var i = this.intentStates[t];
                if (!i.opListReadCapability) {
                    var n = {};
                    n.operatorListChanged = e;
                    i.receivingOperatorList = true;
                    i.opListReadCapability = nt();
                    i.renderTasks = [];
                    i.renderTasks.push(n);
                    i.operatorList = {
                        fnArray: [],
                        argsArray: [],
                        lastChunk: false
                    };
                    this.transport.messageHandler.send("RenderPageRequest", {
                        pageIndex: this.pageIndex,
                        intent: t
                    });
                }
                return i.opListReadCapability.promise;
            },
            getTextContent: function o() {
                return this.transport.messageHandler.sendWithPromise("GetTextContent", {
                    pageIndex: this.pageNumber - 1
                });
            },
            destroy: function s() {
                this.pendingDestroy = true;
                this._tryDestroy();
            },
            _tryDestroy: function l() {
                if (!this.pendingDestroy || Object.keys(this.intentStates).some(function(e) {
                    var t = this.intentStates[e];
                    return t.renderTasks.length !== 0 || t.receivingOperatorList;
                }, this)) {
                    return;
                }
                Object.keys(this.intentStates).forEach(function(e) {
                    delete this.intentStates[e];
                }, this);
                this.objs.clear();
                this.annotationsPromise = null;
                this.pendingDestroy = false;
            },
            _startRenderPage: function c(e, t) {
                var i = this.intentStates[t];
                if (i.displayReadyCapability) {
                    i.displayReadyCapability.resolve(e);
                }
            },
            _renderPageChunk: function u(e, t) {
                var i = this.intentStates[t];
                var n, r;
                for (n = 0, r = e.length; n < r; n++) {
                    i.operatorList.fnArray.push(e.fnArray[n]);
                    i.operatorList.argsArray.push(e.argsArray[n]);
                }
                i.operatorList.lastChunk = e.lastChunk;
                for (n = 0; n < i.renderTasks.length; n++) {
                    i.renderTasks[n].operatorListChanged();
                }
                if (e.lastChunk) {
                    i.receivingOperatorList = false;
                    this._tryDestroy();
                }
            }
        };
        return t;
    }();
    var ft = function pi() {
        function t(t, i) {
            this.pdfDataRangeTransport = i;
            this.workerInitializedCapability = t;
            this.commonObjs = new dt();
            this.loadingTask = null;
            this.pageCache = [];
            this.pagePromises = [];
            this.downloadInfoCapability = nt();
            if (!e.PDFJS.disableWorker && typeof Worker !== "undefined") {
                var n = PDFJS.workerSrc;
                if (!n) {
                    f("No PDFJS.workerSrc specified");
                }
                try {
                    var r = new Worker(n);
                    var a = new at("main", r);
                    this.messageHandler = a;
                    a.on("test", function u(e) {
                        var i = e && e.supportTypedArray;
                        if (i) {
                            this.worker = r;
                            if (!e.supportTransfers) {
                                PDFJS.postMessageTransfers = false;
                            }
                            this.setupMessageHandler(a);
                            t.resolve();
                        } else {
                            this.setupFakeWorker();
                        }
                    }.bind(this));
                    var o = new Uint8Array([ PDFJS.postMessageTransfers ? 255 : 0 ]);
                    try {
                        a.send("test", o, [ o.buffer ]);
                    } catch (s) {
                        c("Cannot use postMessage transfers");
                        o[0] = 0;
                        a.send("test", o);
                    }
                    return;
                } catch (l) {
                    c("The worker has been disabled.");
                }
            }
            this.setupFakeWorker();
        }
        t.prototype = {
            destroy: function i() {
                this.pageCache = [];
                this.pagePromises = [];
                var e = this;
                this.messageHandler.sendWithPromise("Terminate", null).then(function() {
                    Lt.clear();
                    if (e.worker) {
                        e.worker.terminate();
                    }
                });
            },
            setupFakeWorker: function n() {
                e.PDFJS.disableWorker = true;
                if (!PDFJS.fakeWorkerFilesLoadedCapability) {
                    PDFJS.fakeWorkerFilesLoadedCapability = nt();
                    j.loadScript(PDFJS.workerSrc, function() {
                        PDFJS.fakeWorkerFilesLoadedCapability.resolve();
                    });
                }
                PDFJS.fakeWorkerFilesLoadedCapability.promise.then(function() {
                    u("Setting up fake worker.");
                    var e = {
                        postMessage: function i(t) {
                            e.onmessage({
                                data: t
                            });
                        },
                        terminate: function n() {}
                    };
                    var t = new at("main", e);
                    this.setupMessageHandler(t);
                    PDFJS.WorkerMessageHandler.setup(t);
                    this.workerInitializedCapability.resolve();
                }.bind(this));
            },
            setupMessageHandler: function r(e) {
                this.messageHandler = e;
                function t(t) {
                    e.send("UpdatePassword", t);
                }
                var i = this.pdfDataRangeTransport;
                if (i) {
                    i.addRangeListener(function(t, i) {
                        e.send("OnDataRange", {
                            begin: t,
                            chunk: i
                        });
                    });
                    i.addProgressListener(function(t) {
                        e.send("OnDataProgress", {
                            loaded: t
                        });
                    });
                    i.addProgressiveReadListener(function(t) {
                        e.send("OnDataRange", {
                            chunk: t
                        });
                    });
                    e.on("RequestDataRange", function n(e) {
                        i.requestDataRange(e.begin, e.end);
                    }, this);
                }
                e.on("GetDoc", function r(e) {
                    var t = e.pdfInfo;
                    this.numPages = e.pdfInfo.numPages;
                    var i = new ct(t, this);
                    this.pdfDocument = i;
                    this.loadingTask._capability.resolve(i);
                }, this);
                e.on("NeedPassword", function a(e) {
                    var i = this.loadingTask;
                    if (i.onPassword) {
                        return i.onPassword(t, b.NEED_PASSWORD);
                    }
                    i._capability.reject(new w(e.message, e.code));
                }, this);
                e.on("IncorrectPassword", function o(e) {
                    var i = this.loadingTask;
                    if (i.onPassword) {
                        return i.onPassword(t, b.INCORRECT_PASSWORD);
                    }
                    i._capability.reject(new w(e.message, e.code));
                }, this);
                e.on("InvalidPDF", function s(e) {
                    this.loadingTask._capability.reject(new x(e.message));
                }, this);
                e.on("MissingPDF", function l(e) {
                    this.loadingTask._capability.reject(new _(e.message));
                }, this);
                e.on("UnexpectedResponse", function c(e) {
                    this.loadingTask._capability.reject(new S(e.message, e.status));
                }, this);
                e.on("UnknownError", function d(e) {
                    this.loadingTask._capability.reject(new C(e.message, e.details));
                }, this);
                e.on("DataLoaded", function h(e) {
                    this.downloadInfoCapability.resolve(e);
                }, this);
                e.on("PDFManagerReady", function p(e) {
                    if (this.pdfDataRangeTransport) {
                        this.pdfDataRangeTransport.transportReady();
                    }
                }, this);
                e.on("StartRenderPage", function g(e) {
                    var t = this.pageCache[e.pageIndex];
                    t.stats.timeEnd("Page Request");
                    t._startRenderPage(e.transparency, e.intent);
                }, this);
                e.on("RenderPageChunk", function m(e) {
                    var t = this.pageCache[e.pageIndex];
                    t._renderPageChunk(e.operatorList, e.intent);
                }, this);
                e.on("commonobj", function v(e) {
                    var t = e[0];
                    var i = e[1];
                    if (this.commonObjs.hasData(t)) {
                        return;
                    }
                    switch (i) {
                      case "Font":
                        var n = e[2];
                        var r;
                        if ("error" in n) {
                            var a = n.error;
                            u("Error during font loading: " + a);
                            this.commonObjs.resolve(t, a);
                            break;
                        } else {
                            r = new Ft(n);
                        }
                        Lt.bind([ r ], function o(e) {
                            this.commonObjs.resolve(t, r);
                        }.bind(this));
                        break;

                      case "FontPath":
                        this.commonObjs.resolve(t, e[2]);
                        break;

                      default:
                        a("Got unknown common object type " + i);
                    }
                }, this);
                e.on("obj", function y(e) {
                    var t = e[0];
                    var i = e[1];
                    var n = e[2];
                    var r = this.pageCache[i];
                    var a;
                    if (r.objs.hasData(t)) {
                        return;
                    }
                    switch (n) {
                      case "JpegStream":
                        a = e[3];
                        ot(t, a, r.objs);
                        break;

                      case "Image":
                        a = e[3];
                        r.objs.resolve(t, a);
                        var o = 8e6;
                        if (a && "data" in a && a.data.length > o) {
                            r.cleanupAfterRender = true;
                        }
                        break;

                      default:
                        f("Got unknown object type " + n);
                    }
                }, this);
                e.on("DocProgress", function k(e) {
                    var t = this.loadingTask;
                    if (t.onProgress) {
                        t.onProgress({
                            loaded: e.loaded,
                            total: e.total
                        });
                    }
                }, this);
                e.on("PageError", function A(e) {
                    var t = this.pageCache[e.pageNum - 1];
                    var i = t.intentStates[e.intent];
                    if (i.displayReadyCapability) {
                        i.displayReadyCapability.reject(e.error);
                    } else {
                        f(e.error);
                    }
                }, this);
                e.on("JpegDecode", function(e) {
                    var t = e[0];
                    var i = e[1];
                    if (i !== 3 && i !== 1) {
                        return Promise.reject(new Error("Only 3 components or 1 component can be returned"));
                    }
                    return new Promise(function(e, n) {
                        var r = new Image();
                        r.onload = function() {
                            var t = r.width;
                            var n = r.height;
                            var a = t * n;
                            var o = a * 4;
                            var s = new Uint8Array(a * i);
                            var l = _t(t, n);
                            var c = l.getContext("2d");
                            c.drawImage(r, 0, 0);
                            var u = c.getImageData(0, 0, t, n).data;
                            var f, d;
                            if (i === 3) {
                                for (f = 0, d = 0; f < o; f += 4, d += 3) {
                                    s[d] = u[f];
                                    s[d + 1] = u[f + 1];
                                    s[d + 2] = u[f + 2];
                                }
                            } else if (i === 1) {
                                for (f = 0, d = 0; f < o; f += 4, d++) {
                                    s[d] = u[f];
                                }
                            }
                            e({
                                data: s,
                                width: t,
                                height: n
                            });
                        };
                        r.onerror = function() {
                            n(new Error("JpegDecode failed to load image"));
                        };
                        r.src = t;
                    });
                });
            },
            fetchDocument: function a(e, t) {
                this.loadingTask = e;
                t.disableAutoFetch = PDFJS.disableAutoFetch;
                t.disableStream = PDFJS.disableStream;
                t.chunkedViewerLoading = !!this.pdfDataRangeTransport;
                if (this.pdfDataRangeTransport) {
                    t.length = this.pdfDataRangeTransport.length;
                    t.initialData = this.pdfDataRangeTransport.initialData;
                }
                this.messageHandler.send("GetDocRequest", {
                    source: t,
                    disableRange: PDFJS.disableRange,
                    maxImageSize: PDFJS.maxImageSize,
                    cMapUrl: PDFJS.cMapUrl,
                    cMapPacked: PDFJS.cMapPacked,
                    disableFontFace: PDFJS.disableFontFace,
                    disableCreateObjectURL: PDFJS.disableCreateObjectURL,
                    verbosity: PDFJS.verbosity
                });
            },
            getData: function o() {
                return this.messageHandler.sendWithPromise("GetData", null);
            },
            getPage: function s(e, t) {
                if (e <= 0 || e > this.numPages || (e | 0) !== e) {
                    return Promise.reject(new Error("Invalid page request"));
                }
                var i = e - 1;
                if (i in this.pagePromises) {
                    return this.pagePromises[i];
                }
                var n = this.messageHandler.sendWithPromise("GetPage", {
                    pageIndex: i
                }).then(function(e) {
                    var t = new ut(i, e, this);
                    this.pageCache[i] = t;
                    return t;
                }.bind(this));
                this.pagePromises[i] = n;
                return n;
            },
            getPageIndex: function l(e) {
                return this.messageHandler.sendWithPromise("GetPageIndex", {
                    ref: e
                });
            },
            getAnnotations: function d(e) {
                return this.messageHandler.sendWithPromise("GetAnnotations", {
                    pageIndex: e
                });
            },
            getDestinations: function h() {
                return this.messageHandler.sendWithPromise("GetDestinations", null);
            },
            getDestination: function p(e) {
                return this.messageHandler.sendWithPromise("GetDestination", {
                    id: e
                });
            },
            getAttachments: function g() {
                return this.messageHandler.sendWithPromise("GetAttachments", null);
            },
            getJavaScript: function m() {
                return this.messageHandler.sendWithPromise("GetJavaScript", null);
            },
            getOutline: function v() {
                return this.messageHandler.sendWithPromise("GetOutline", null);
            },
            getMetadata: function y() {
                return this.messageHandler.sendWithPromise("GetMetadata", null).then(function e(t) {
                    return {
                        info: t[0],
                        metadata: t[1] ? new PDFJS.Metadata(t[1]) : null
                    };
                });
            },
            getStats: function k() {
                return this.messageHandler.sendWithPromise("GetStats", null);
            },
            startCleanup: function A() {
                this.messageHandler.sendWithPromise("Cleanup", null).then(function e() {
                    for (var e = 0, t = this.pageCache.length; e < t; e++) {
                        var i = this.pageCache[e];
                        if (i) {
                            i.destroy();
                        }
                    }
                    this.commonObjs.clear();
                    Lt.clear();
                }.bind(this));
            }
        };
        return t;
    }();
    var dt = function gi() {
        function e() {
            this.objs = {};
        }
        e.prototype = {
            ensureObj: function t(e) {
                if (this.objs[e]) {
                    return this.objs[e];
                }
                var t = {
                    capability: nt(),
                    data: null,
                    resolved: false
                };
                this.objs[e] = t;
                return t;
            },
            get: function i(e, t) {
                if (t) {
                    this.ensureObj(e).capability.promise.then(t);
                    return null;
                }
                var i = this.objs[e];
                if (!i || !i.resolved) {
                    f("Requesting object that isn't resolved yet " + e);
                }
                return i.data;
            },
            resolve: function n(e, t) {
                var i = this.ensureObj(e);
                i.resolved = true;
                i.data = t;
                i.capability.resolve(t);
            },
            isResolved: function r(e) {
                var t = this.objs;
                if (!t[e]) {
                    return false;
                } else {
                    return t[e].resolved;
                }
            },
            hasData: function a(e) {
                return this.isResolved(e);
            },
            getData: function o(e) {
                var t = this.objs;
                if (!t[e] || !t[e].resolved) {
                    return null;
                } else {
                    return t[e].data;
                }
            },
            clear: function s() {
                this.objs = {};
            }
        };
        return e;
    }();
    var ht = function mi() {
        function e(e) {
            this._internalRenderTask = e;
            this.onContinue = null;
        }
        e.prototype = {
            get promise() {
                return this._internalRenderTask.capability.promise;
            },
            cancel: function t() {
                this._internalRenderTask.cancel();
            },
            then: function i(e, t) {
                return this.promise.then.apply(this.promise, arguments);
            }
        };
        return e;
    }();
    var pt = function vi() {
        function t(e, t, i, n, r, a) {
            this.callback = e;
            this.params = t;
            this.objs = i;
            this.commonObjs = n;
            this.operatorListIdx = null;
            this.operatorList = r;
            this.pageNumber = a;
            this.running = false;
            this.graphicsReadyCallback = null;
            this.graphicsReady = false;
            this.useRequestAnimationFrame = false;
            this.cancelled = false;
            this.capability = nt();
            this.task = new ht(this);
            this._continueBound = this._continue.bind(this);
            this._scheduleNextBound = this._scheduleNext.bind(this);
            this._nextBound = this._next.bind(this);
        }
        t.prototype = {
            initalizeGraphics: function i(t) {
                if (this.cancelled) {
                    return;
                }
                if (PDFJS.pdfBug && "StepperManager" in e && e.StepperManager.enabled) {
                    this.stepper = e.StepperManager.create(this.pageNumber - 1);
                    this.stepper.init(this.operatorList);
                    this.stepper.nextBreakPoint = this.stepper.getNextBreakPoint();
                }
                var i = this.params;
                this.gfx = new Tt(i.canvasContext, this.commonObjs, this.objs, i.imageLayer);
                this.gfx.beginDrawing(i.viewport, t);
                this.operatorListIdx = 0;
                this.graphicsReady = true;
                if (this.graphicsReadyCallback) {
                    this.graphicsReadyCallback();
                }
            },
            cancel: function n() {
                this.running = false;
                this.cancelled = true;
                this.callback("cancelled");
            },
            operatorListChanged: function r() {
                if (!this.graphicsReady) {
                    if (!this.graphicsReadyCallback) {
                        this.graphicsReadyCallback = this._continueBound;
                    }
                    return;
                }
                if (this.stepper) {
                    this.stepper.updateOperatorList(this.operatorList);
                }
                if (this.running) {
                    return;
                }
                this._continue();
            },
            _continue: function a() {
                this.running = true;
                if (this.cancelled) {
                    return;
                }
                if (this.task.onContinue) {
                    this.task.onContinue.call(this.task, this._scheduleNextBound);
                } else {
                    this._scheduleNext();
                }
            },
            _scheduleNext: function o() {
                if (this.useRequestAnimationFrame) {
                    window.requestAnimationFrame(this._nextBound);
                } else {
                    Promise.resolve(undefined).then(this._nextBound);
                }
            },
            _next: function s() {
                if (this.cancelled) {
                    return;
                }
                this.operatorListIdx = this.gfx.executeOperatorList(this.operatorList, this.operatorListIdx, this._continueBound, this.stepper);
                if (this.operatorListIdx === this.operatorList.argsArray.length) {
                    this.running = false;
                    if (this.operatorList.lastChunk) {
                        this.gfx.endDrawing();
                        this.callback();
                    }
                }
            }
        };
        return t;
    }();
    var gt = PDFJS.Metadata = function yi() {
        function e(e) {
            return e.replace(/>\\376\\377([^<]+)/g, function(e, t) {
                var i = t.replace(/\\([0-3])([0-7])([0-7])/g, function(e, t, i, n) {
                    return String.fromCharCode(t * 64 + i * 8 + n * 1);
                });
                var n = "";
                for (var r = 0; r < i.length; r += 2) {
                    var a = i.charCodeAt(r) * 256 + i.charCodeAt(r + 1);
                    n += a >= 32 && a < 127 && a !== 60 && a !== 62 && a !== 38 && false ? String.fromCharCode(a) : "&#x" + (65536 + a).toString(16).substring(1) + ";";
                }
                return ">" + n;
            });
        }
        function t(t) {
            if (typeof t === "string") {
                t = e(t);
                var i = new DOMParser();
                t = i.parseFromString(t, "application/xml");
            } else if (!(t instanceof Document)) {
                f("Metadata: Invalid metadata object");
            }
            this.metaDocument = t;
            this.metadata = {};
            this.parse();
        }
        t.prototype = {
            parse: function i() {
                var e = this.metaDocument;
                var t = e.documentElement;
                if (t.nodeName.toLowerCase() !== "rdf:rdf") {
                    t = t.firstChild;
                    while (t && t.nodeName.toLowerCase() !== "rdf:rdf") {
                        t = t.nextSibling;
                    }
                }
                var i = t ? t.nodeName.toLowerCase() : null;
                if (!t || i !== "rdf:rdf" || !t.hasChildNodes()) {
                    return;
                }
                var n = t.childNodes, r, a, o, s, l, c, u;
                for (s = 0, c = n.length; s < c; s++) {
                    r = n[s];
                    if (r.nodeName.toLowerCase() !== "rdf:description") {
                        continue;
                    }
                    for (l = 0, u = r.childNodes.length; l < u; l++) {
                        if (r.childNodes[l].nodeName.toLowerCase() !== "#text") {
                            a = r.childNodes[l];
                            o = a.nodeName.toLowerCase();
                            this.metadata[o] = a.textContent.trim();
                        }
                    }
                }
            },
            get: function n(e) {
                return this.metadata[e] || null;
            },
            has: function r(e) {
                return typeof this.metadata[e] !== "undefined";
            }
        };
        return t;
    }();
    var mt = 16;
    var vt = 100;
    var yt = 4096;
    var bt = .65;
    var wt = true;
    var Ct = 1e3;
    var xt = 16;
    function _t(e, t) {
        var i = document.createElement("canvas");
        i.width = e;
        i.height = t;
        return i;
    }
    function St(e) {
        if (!e.mozCurrentTransform) {
            e._originalSave = e.save;
            e._originalRestore = e.restore;
            e._originalRotate = e.rotate;
            e._originalScale = e.scale;
            e._originalTranslate = e.translate;
            e._originalTransform = e.transform;
            e._originalSetTransform = e.setTransform;
            e._transformMatrix = e._transformMatrix || [ 1, 0, 0, 1, 0, 0 ];
            e._transformStack = [];
            Object.defineProperty(e, "mozCurrentTransform", {
                get: function t() {
                    return this._transformMatrix;
                }
            });
            Object.defineProperty(e, "mozCurrentTransformInverse", {
                get: function i() {
                    var e = this._transformMatrix;
                    var t = e[0], i = e[1], n = e[2], r = e[3], a = e[4], o = e[5];
                    var s = t * r - i * n;
                    var l = i * n - t * r;
                    return [ r / s, i / l, n / l, t / s, (r * a - n * o) / l, (i * a - t * o) / s ];
                }
            });
            e.save = function n() {
                var e = this._transformMatrix;
                this._transformStack.push(e);
                this._transformMatrix = e.slice(0, 6);
                this._originalSave();
            };
            e.restore = function r() {
                var e = this._transformStack.pop();
                if (e) {
                    this._transformMatrix = e;
                    this._originalRestore();
                }
            };
            e.translate = function a(e, t) {
                var i = this._transformMatrix;
                i[4] = i[0] * e + i[2] * t + i[4];
                i[5] = i[1] * e + i[3] * t + i[5];
                this._originalTranslate(e, t);
            };
            e.scale = function o(e, t) {
                var i = this._transformMatrix;
                i[0] = i[0] * e;
                i[1] = i[1] * e;
                i[2] = i[2] * t;
                i[3] = i[3] * t;
                this._originalScale(e, t);
            };
            e.transform = function s(t, i, n, r, a, o) {
                var s = this._transformMatrix;
                this._transformMatrix = [ s[0] * t + s[2] * i, s[1] * t + s[3] * i, s[0] * n + s[2] * r, s[1] * n + s[3] * r, s[0] * a + s[2] * o + s[4], s[1] * a + s[3] * o + s[5] ];
                e._originalTransform(t, i, n, r, a, o);
            };
            e.setTransform = function l(t, i, n, r, a, o) {
                this._transformMatrix = [ t, i, n, r, a, o ];
                e._originalSetTransform(t, i, n, r, a, o);
            };
            e.rotate = function c(e) {
                var t = Math.cos(e);
                var i = Math.sin(e);
                var n = this._transformMatrix;
                this._transformMatrix = [ n[0] * t + n[2] * i, n[1] * t + n[3] * i, n[0] * -i + n[2] * t, n[1] * -i + n[3] * t, n[4], n[5] ];
                this._originalRotate(e);
            };
        }
    }
    var kt = function bi() {
        var e = {};
        return {
            getCanvas: function t(i, n, r, a) {
                var o;
                if (e[i] !== undefined) {
                    o = e[i];
                    o.canvas.width = n;
                    o.canvas.height = r;
                    o.context.setTransform(1, 0, 0, 1, 0, 0);
                } else {
                    var s = _t(n, r);
                    var l = s.getContext("2d");
                    if (a) {
                        St(l);
                    }
                    e[i] = o = {
                        canvas: s,
                        context: l
                    };
                }
                return o;
            },
            clear: function() {
                for (var t in e) {
                    var i = e[t];
                    i.canvas.width = 0;
                    i.canvas.height = 0;
                    delete e[t];
                }
            }
        };
    }();
    function At(e) {
        var t = 1e3;
        var i = e.width, n = e.height;
        var r, a, o, s = i + 1;
        var l = new Uint8Array(s * (n + 1));
        var c = new Uint8Array([ 0, 2, 4, 0, 1, 0, 5, 4, 8, 10, 0, 8, 0, 2, 1, 0 ]);
        var u = i + 7 & ~7, f = e.data;
        var d = new Uint8Array(u * n), h = 0, p;
        for (r = 0, p = f.length; r < p; r++) {
            var g = 128, m = f[r];
            while (g > 0) {
                d[h++] = m & g ? 0 : 255;
                g >>= 1;
            }
        }
        var v = 0;
        h = 0;
        if (d[h] !== 0) {
            l[0] = 1;
            ++v;
        }
        for (a = 1; a < i; a++) {
            if (d[h] !== d[h + 1]) {
                l[a] = d[h] ? 2 : 1;
                ++v;
            }
            h++;
        }
        if (d[h] !== 0) {
            l[a] = 2;
            ++v;
        }
        for (r = 1; r < n; r++) {
            h = r * u;
            o = r * s;
            if (d[h - u] !== d[h]) {
                l[o] = d[h] ? 1 : 8;
                ++v;
            }
            var y = (d[h] ? 4 : 0) + (d[h - u] ? 8 : 0);
            for (a = 1; a < i; a++) {
                y = (y >> 2) + (d[h + 1] ? 4 : 0) + (d[h - u + 1] ? 8 : 0);
                if (c[y]) {
                    l[o + a] = c[y];
                    ++v;
                }
                h++;
            }
            if (d[h - u] !== d[h]) {
                l[o + a] = d[h] ? 2 : 4;
                ++v;
            }
            if (v > t) {
                return null;
            }
        }
        h = u * (n - 1);
        o = r * s;
        if (d[h] !== 0) {
            l[o] = 8;
            ++v;
        }
        for (a = 1; a < i; a++) {
            if (d[h] !== d[h + 1]) {
                l[o + a] = d[h] ? 4 : 8;
                ++v;
            }
            h++;
        }
        if (d[h] !== 0) {
            l[o + a] = 4;
            ++v;
        }
        if (v > t) {
            return null;
        }
        var b = new Int32Array([ 0, s, -1, 0, -s, 0, 0, 0, 1 ]);
        var w = [];
        for (r = 0; v && r <= n; r++) {
            var C = r * s;
            var x = C + i;
            while (C < x && !l[C]) {
                C++;
            }
            if (C === x) {
                continue;
            }
            var _ = [ C % s, r ];
            var S = l[C], k = C, A;
            do {
                var E = b[S];
                do {
                    C += E;
                } while (!l[C]);
                A = l[C];
                if (A !== 5 && A !== 10) {
                    S = A;
                    l[C] = 0;
                } else {
                    S = A & 51 * S >> 4;
                    l[C] &= S >> 2 | S << 2;
                }
                _.push(C % s);
                _.push(C / s | 0);
                --v;
            } while (k !== C);
            w.push(_);
            --r;
        }
        var T = function(e) {
            e.save();
            e.scale(1 / i, -1 / n);
            e.translate(0, -n);
            e.beginPath();
            for (var t = 0, r = w.length; t < r; t++) {
                var a = w[t];
                e.moveTo(a[0], a[1]);
                for (var o = 2, s = a.length; o < s; o += 2) {
                    e.lineTo(a[o], a[o + 1]);
                }
            }
            e.fill();
            e.beginPath();
            e.restore();
        };
        return T;
    }
    var Et = function wi() {
        function e(e) {
            this.alphaIsShape = false;
            this.fontSize = 0;
            this.fontSizeScale = 1;
            this.textMatrix = B;
            this.textMatrixScale = 1;
            this.fontMatrix = i;
            this.leading = 0;
            this.x = 0;
            this.y = 0;
            this.lineX = 0;
            this.lineY = 0;
            this.charSpacing = 0;
            this.wordSpacing = 0;
            this.textHScale = 1;
            this.textRenderingMode = n.FILL;
            this.textRise = 0;
            this.fillColor = "#000000";
            this.strokeColor = "#000000";
            this.patternFill = false;
            this.fillAlpha = 1;
            this.strokeAlpha = 1;
            this.lineWidth = 1;
            this.activeSMask = null;
            this.old = e;
        }
        e.prototype = {
            clone: function t() {
                return Object.create(this);
            },
            setCurrentPoint: function r(e, t) {
                this.x = e;
                this.y = t;
            }
        };
        return e;
    }();
    var Tt = function Ci() {
        var e = 15;
        var t = 10;
        function a(e, t, i, n) {
            this.ctx = e;
            this.current = new Et();
            this.stateStack = [];
            this.pendingClip = null;
            this.pendingEOFill = false;
            this.res = null;
            this.xobjs = null;
            this.commonObjs = t;
            this.objs = i;
            this.imageLayer = n;
            this.groupStack = [];
            this.processingType3 = null;
            this.baseTransform = null;
            this.baseTransformStack = [];
            this.groupLevel = 0;
            this.smaskStack = [];
            this.smaskCounter = 0;
            this.tempSMask = null;
            if (e) {
                St(e);
            }
            this.cachedGetSinglePixelWidth = null;
        }
        function o(e, t) {
            if (typeof ImageData !== "undefined" && t instanceof ImageData) {
                e.putImageData(t, 0, 0);
                return;
            }
            var i = t.height, n = t.width;
            var a = i % xt;
            var o = (i - a) / xt;
            var s = a === 0 ? o : o + 1;
            var l = e.createImageData(n, xt);
            var c = 0, u;
            var d = t.data;
            var h = l.data;
            var p, g, m, v;
            if (t.kind === r.GRAYSCALE_1BPP) {
                var y = d.byteLength;
                var b = PDFJS.hasCanvasTypedArrays ? new Uint32Array(h.buffer) : new N(h);
                var w = b.length;
                var C = n + 7 >> 3;
                var x = 4294967295;
                var _ = PDFJS.isLittleEndian || !PDFJS.hasCanvasTypedArrays ? 4278190080 : 255;
                for (p = 0; p < s; p++) {
                    m = p < o ? xt : a;
                    u = 0;
                    for (g = 0; g < m; g++) {
                        var S = y - c;
                        var k = 0;
                        var A = S > C ? n : S * 8 - 7;
                        var E = A & ~7;
                        var T = 0;
                        var P = 0;
                        for (;k < E; k += 8) {
                            P = d[c++];
                            b[u++] = P & 128 ? x : _;
                            b[u++] = P & 64 ? x : _;
                            b[u++] = P & 32 ? x : _;
                            b[u++] = P & 16 ? x : _;
                            b[u++] = P & 8 ? x : _;
                            b[u++] = P & 4 ? x : _;
                            b[u++] = P & 2 ? x : _;
                            b[u++] = P & 1 ? x : _;
                        }
                        for (;k < A; k++) {
                            if (T === 0) {
                                P = d[c++];
                                T = 128;
                            }
                            b[u++] = P & T ? x : _;
                            T >>= 1;
                        }
                    }
                    while (u < w) {
                        b[u++] = 0;
                    }
                    e.putImageData(l, 0, p * xt);
                }
            } else if (t.kind === r.RGBA_32BPP) {
                g = 0;
                v = n * xt * 4;
                for (p = 0; p < o; p++) {
                    h.set(d.subarray(c, c + v));
                    c += v;
                    e.putImageData(l, 0, g);
                    g += xt;
                }
                if (p < s) {
                    v = n * a * 4;
                    h.set(d.subarray(c, c + v));
                    e.putImageData(l, 0, g);
                }
            } else if (t.kind === r.RGB_24BPP) {
                m = xt;
                v = n * m;
                for (p = 0; p < s; p++) {
                    if (p >= o) {
                        m = a;
                        v = n * m;
                    }
                    u = 0;
                    for (g = v; g--; ) {
                        h[u++] = d[c++];
                        h[u++] = d[c++];
                        h[u++] = d[c++];
                        h[u++] = 255;
                    }
                    e.putImageData(l, 0, p * xt);
                }
            } else {
                f("bad image kind: " + t.kind);
            }
        }
        function s(e, t) {
            var i = t.height, n = t.width;
            var r = i % xt;
            var a = (i - r) / xt;
            var o = r === 0 ? a : a + 1;
            var s = e.createImageData(n, xt);
            var l = 0;
            var c = t.data;
            var u = s.data;
            for (var f = 0; f < o; f++) {
                var d = f < a ? xt : r;
                var h = 3;
                for (var p = 0; p < d; p++) {
                    var g = 0;
                    for (var m = 0; m < n; m++) {
                        if (!g) {
                            var v = c[l++];
                            g = 128;
                        }
                        u[h] = v & g ? 0 : 255;
                        h += 4;
                        g >>= 1;
                    }
                }
                e.putImageData(s, 0, f * xt);
            }
        }
        function d(e, t) {
            var i = [ "strokeStyle", "fillStyle", "fillRule", "globalAlpha", "lineWidth", "lineCap", "lineJoin", "miterLimit", "globalCompositeOperation", "font" ];
            for (var n = 0, r = i.length; n < r; n++) {
                var a = i[n];
                if (e[a] !== undefined) {
                    t[a] = e[a];
                }
            }
            if (e.setLineDash !== undefined) {
                t.setLineDash(e.getLineDash());
                t.lineDashOffset = e.lineDashOffset;
            } else if (e.mozDashOffset !== undefined) {
                t.mozDash = e.mozDash;
                t.mozDashOffset = e.mozDashOffset;
            }
        }
        function p(e, t, i, n) {
            var r = e.length;
            for (var a = 3; a < r; a += 4) {
                var o = e[a];
                if (o === 0) {
                    e[a - 3] = t;
                    e[a - 2] = i;
                    e[a - 1] = n;
                } else if (o < 255) {
                    var s = 255 - o;
                    e[a - 3] = e[a - 3] * o + t * s >> 8;
                    e[a - 2] = e[a - 2] * o + i * s >> 8;
                    e[a - 1] = e[a - 1] * o + n * s >> 8;
                }
            }
        }
        function g(e, t) {
            var i = e.length;
            var n = 1 / 255;
            for (var r = 3; r < i; r += 4) {
                var a = e[r];
                t[r] = t[r] * a * n | 0;
            }
        }
        function m(e, t) {
            var i = e.length;
            for (var n = 3; n < i; n += 4) {
                var r = e[n - 3] * 77 + e[n - 2] * 152 + e[n - 1] * 28;
                t[n] = t[n] * r >> 16;
            }
        }
        function v(e, t, i, n, r, a) {
            var o = !!a;
            var s = o ? a[0] : 0;
            var l = o ? a[1] : 0;
            var c = o ? a[2] : 0;
            var u;
            if (r === "Luminosity") {
                u = m;
            } else {
                u = g;
            }
            var f = 1048576;
            var d = Math.min(n, Math.ceil(f / i));
            for (var h = 0; h < n; h += d) {
                var v = Math.min(d, n - h);
                var y = e.getImageData(0, h, i, v);
                var b = t.getImageData(0, h, i, v);
                if (o) {
                    p(y.data, s, l, c);
                }
                u(y.data, b.data);
                e.putImageData(b, 0, h);
            }
        }
        function b(e, t, i) {
            var n = t.canvas;
            var r = t.context;
            e.setTransform(t.scaleX, 0, 0, t.scaleY, t.offsetX, t.offsetY);
            var a = t.backdrop || null;
            if (Pt.isEnabled) {
                var o = Pt.composeSMask(i.canvas, n, {
                    subtype: t.subtype,
                    backdrop: a
                });
                e.setTransform(1, 0, 0, 1, 0, 0);
                e.drawImage(o, t.offsetX, t.offsetY);
                return;
            }
            v(r, i, n.width, n.height, t.subtype, a);
            e.drawImage(n, 0, 0);
        }
        var w = [ "butt", "round", "square" ];
        var C = [ "miter", "round", "bevel" ];
        var x = {};
        var _ = {};
        a.prototype = {
            beginDrawing: function k(e, t) {
                var i = this.ctx.canvas.width;
                var n = this.ctx.canvas.height;
                if (t) {
                    this.ctx.clearRect(0, 0, i, n);
                } else {
                    this.ctx.mozOpaque = true;
                    this.ctx.save();
                    this.ctx.fillStyle = "rgb(255, 255, 255)";
                    this.ctx.fillRect(0, 0, i, n);
                    this.ctx.restore();
                }
                var r = e.transform;
                this.ctx.save();
                this.ctx.transform.apply(this.ctx, r);
                this.baseTransform = this.ctx.mozCurrentTransform.slice();
                if (this.imageLayer) {
                    this.imageLayer.beginLayout();
                }
            },
            executeOperatorList: function A(i, n, r, a) {
                var o = i.argsArray;
                var s = i.fnArray;
                var c = n || 0;
                var u = o.length;
                if (u === c) {
                    return c;
                }
                var f = u - c > t && typeof r === "function";
                var d = f ? Date.now() + e : 0;
                var h = 0;
                var p = this.commonObjs;
                var g = this.objs;
                var m;
                while (true) {
                    if (a !== undefined && c === a.nextBreakPoint) {
                        a.breakIt(c, r);
                        return c;
                    }
                    m = s[c];
                    if (m !== l.dependency) {
                        this[m].apply(this, o[c]);
                    } else {
                        var v = o[c];
                        for (var y = 0, b = v.length; y < b; y++) {
                            var w = v[y];
                            var C = w[0] === "g" && w[1] === "_";
                            var x = C ? p : g;
                            if (!x.isResolved(w)) {
                                x.get(w, r);
                                return c;
                            }
                        }
                    }
                    c++;
                    if (c === u) {
                        return c;
                    }
                    if (f && ++h > t) {
                        if (Date.now() > d) {
                            r();
                            return c;
                        }
                        h = 0;
                    }
                }
            },
            endDrawing: function E() {
                this.ctx.restore();
                kt.clear();
                Pt.clear();
                if (this.imageLayer) {
                    this.imageLayer.endLayout();
                }
            },
            setLineWidth: function T(e) {
                this.current.lineWidth = e;
                this.ctx.lineWidth = e;
            },
            setLineCap: function P(e) {
                this.ctx.lineCap = w[e];
            },
            setLineJoin: function I(e) {
                this.ctx.lineJoin = C[e];
            },
            setMiterLimit: function O(e) {
                this.ctx.miterLimit = e;
            },
            setDash: function D(e, t) {
                var i = this.ctx;
                if (i.setLineDash !== undefined) {
                    i.setLineDash(e);
                    i.lineDashOffset = t;
                } else {
                    i.mozDash = e;
                    i.mozDashOffset = t;
                }
            },
            setRenderingIntent: function R(e) {},
            setFlatness: function L(e) {},
            setGState: function F(e) {
                for (var t = 0, i = e.length; t < i; t++) {
                    var n = e[t];
                    var r = n[0];
                    var a = n[1];
                    switch (r) {
                      case "LW":
                        this.setLineWidth(a);
                        break;

                      case "LC":
                        this.setLineCap(a);
                        break;

                      case "LJ":
                        this.setLineJoin(a);
                        break;

                      case "ML":
                        this.setMiterLimit(a);
                        break;

                      case "D":
                        this.setDash(a[0], a[1]);
                        break;

                      case "RI":
                        this.setRenderingIntent(a);
                        break;

                      case "FL":
                        this.setFlatness(a);
                        break;

                      case "Font":
                        this.setFont(a[0], a[1]);
                        break;

                      case "CA":
                        this.current.strokeAlpha = n[1];
                        break;

                      case "ca":
                        this.current.fillAlpha = n[1];
                        this.ctx.globalAlpha = n[1];
                        break;

                      case "BM":
                        if (a && a.name && a.name !== "Normal") {
                            var o = a.name.replace(/([A-Z])/g, function(e) {
                                return "-" + e.toLowerCase();
                            }).substring(1);
                            this.ctx.globalCompositeOperation = o;
                            if (this.ctx.globalCompositeOperation !== o) {
                                u('globalCompositeOperation "' + o + '" is not supported');
                            }
                        } else {
                            this.ctx.globalCompositeOperation = "source-over";
                        }
                        break;

                      case "SMask":
                        if (this.current.activeSMask) {
                            this.endSMaskGroup();
                        }
                        this.current.activeSMask = a ? this.tempSMask : null;
                        if (this.current.activeSMask) {
                            this.beginSMaskGroup();
                        }
                        this.tempSMask = null;
                        break;
                    }
                }
            },
            beginSMaskGroup: function M() {
                var e = this.current.activeSMask;
                var t = e.canvas.width;
                var i = e.canvas.height;
                var n = "smaskGroupAt" + this.groupLevel;
                var r = kt.getCanvas(n, t, i, true);
                var a = this.ctx;
                var o = a.mozCurrentTransform;
                this.ctx.save();
                var s = r.context;
                s.scale(1 / e.scaleX, 1 / e.scaleY);
                s.translate(-e.offsetX, -e.offsetY);
                s.transform.apply(s, o);
                d(a, s);
                this.ctx = s;
                this.setGState([ [ "BM", "Normal" ], [ "ca", 1 ], [ "CA", 1 ] ]);
                this.groupStack.push(a);
                this.groupLevel++;
            },
            endSMaskGroup: function U() {
                var e = this.ctx;
                this.groupLevel--;
                this.ctx = this.groupStack.pop();
                b(this.ctx, this.current.activeSMask, e);
                this.ctx.restore();
            },
            save: function z() {
                this.ctx.save();
                var e = this.current;
                this.stateStack.push(e);
                this.current = e.clone();
                this.current.activeSMask = null;
            },
            restore: function q() {
                if (this.stateStack.length !== 0) {
                    if (this.current.activeSMask !== null) {
                        this.endSMaskGroup();
                    }
                    this.current = this.stateStack.pop();
                    this.ctx.restore();
                    this.cachedGetSinglePixelWidth = null;
                }
            },
            transform: function W(e, t, i, n, r, a) {
                this.ctx.transform(e, t, i, n, r, a);
                this.cachedGetSinglePixelWidth = null;
            },
            constructPath: function H(e, t) {
                var i = this.ctx;
                var n = this.current;
                var r = n.x, a = n.y;
                for (var o = 0, s = 0, c = e.length; o < c; o++) {
                    switch (e[o] | 0) {
                      case l.rectangle:
                        r = t[s++];
                        a = t[s++];
                        var u = t[s++];
                        var f = t[s++];
                        if (u === 0) {
                            u = this.getSinglePixelWidth();
                        }
                        if (f === 0) {
                            f = this.getSinglePixelWidth();
                        }
                        var d = r + u;
                        var h = a + f;
                        this.ctx.moveTo(r, a);
                        this.ctx.lineTo(d, a);
                        this.ctx.lineTo(d, h);
                        this.ctx.lineTo(r, h);
                        this.ctx.lineTo(r, a);
                        this.ctx.closePath();
                        break;

                      case l.moveTo:
                        r = t[s++];
                        a = t[s++];
                        i.moveTo(r, a);
                        break;

                      case l.lineTo:
                        r = t[s++];
                        a = t[s++];
                        i.lineTo(r, a);
                        break;

                      case l.curveTo:
                        r = t[s + 4];
                        a = t[s + 5];
                        i.bezierCurveTo(t[s], t[s + 1], t[s + 2], t[s + 3], r, a);
                        s += 6;
                        break;

                      case l.curveTo2:
                        i.bezierCurveTo(r, a, t[s], t[s + 1], t[s + 2], t[s + 3]);
                        r = t[s + 2];
                        a = t[s + 3];
                        s += 4;
                        break;

                      case l.curveTo3:
                        r = t[s + 2];
                        a = t[s + 3];
                        i.bezierCurveTo(t[s], t[s + 1], r, a, r, a);
                        s += 4;
                        break;

                      case l.closePath:
                        i.closePath();
                        break;
                    }
                }
                n.setCurrentPoint(r, a);
            },
            closePath: function G() {
                this.ctx.closePath();
            },
            stroke: function V(e) {
                e = typeof e !== "undefined" ? e : true;
                var t = this.ctx;
                var i = this.current.strokeColor;
                t.lineWidth = Math.max(this.getSinglePixelWidth() * bt, this.current.lineWidth);
                t.globalAlpha = this.current.strokeAlpha;
                if (i && i.hasOwnProperty("type") && i.type === "Pattern") {
                    t.save();
                    t.strokeStyle = i.getPattern(t, this);
                    t.stroke();
                    t.restore();
                } else {
                    t.stroke();
                }
                if (e) {
                    this.consumePath();
                }
                t.globalAlpha = this.current.fillAlpha;
            },
            closeStroke: function $() {
                this.closePath();
                this.stroke();
            },
            fill: function X(e) {
                e = typeof e !== "undefined" ? e : true;
                var t = this.ctx;
                var i = this.current.fillColor;
                var n = this.current.patternFill;
                var r = false;
                if (n) {
                    t.save();
                    t.fillStyle = i.getPattern(t, this);
                    r = true;
                }
                if (this.pendingEOFill) {
                    if (t.mozFillRule !== undefined) {
                        t.mozFillRule = "evenodd";
                        t.fill();
                        t.mozFillRule = "nonzero";
                    } else {
                        try {
                            t.fill("evenodd");
                        } catch (a) {
                            t.fill();
                        }
                    }
                    this.pendingEOFill = false;
                } else {
                    t.fill();
                }
                if (r) {
                    t.restore();
                }
                if (e) {
                    this.consumePath();
                }
            },
            eoFill: function J() {
                this.pendingEOFill = true;
                this.fill();
            },
            fillStroke: function K() {
                this.fill(false);
                this.stroke(false);
                this.consumePath();
            },
            eoFillStroke: function Q() {
                this.pendingEOFill = true;
                this.fillStroke();
            },
            closeFillStroke: function et() {
                this.closePath();
                this.fillStroke();
            },
            closeEOFillStroke: function tt() {
                this.pendingEOFill = true;
                this.closePath();
                this.fillStroke();
            },
            endPath: function it() {
                this.consumePath();
            },
            clip: function nt() {
                this.pendingClip = x;
            },
            eoClip: function rt() {
                this.pendingClip = _;
            },
            beginText: function at() {
                this.current.textMatrix = B;
                this.current.textMatrixScale = 1;
                this.current.x = this.current.lineX = 0;
                this.current.y = this.current.lineY = 0;
            },
            endText: function ot() {
                var e = this.pendingTextPaths;
                var t = this.ctx;
                if (e === undefined) {
                    t.beginPath();
                    return;
                }
                t.save();
                t.beginPath();
                for (var i = 0; i < e.length; i++) {
                    var n = e[i];
                    t.setTransform.apply(t, n.transform);
                    t.translate(n.x, n.y);
                    n.addToPath(t, n.fontSize);
                }
                t.restore();
                t.clip();
                t.beginPath();
                delete this.pendingTextPaths;
            },
            setCharSpacing: function st(e) {
                this.current.charSpacing = e;
            },
            setWordSpacing: function lt(e) {
                this.current.wordSpacing = e;
            },
            setHScale: function ct(e) {
                this.current.textHScale = e / 100;
            },
            setLeading: function ut(e) {
                this.current.leading = -e;
            },
            setFont: function ft(e, t) {
                var n = this.commonObjs.get(e);
                var r = this.current;
                if (!n) {
                    f("Can't find font for " + e);
                }
                r.fontMatrix = n.fontMatrix ? n.fontMatrix : i;
                if (r.fontMatrix[0] === 0 || r.fontMatrix[3] === 0) {
                    u("Invalid font matrix for font " + e);
                }
                if (t < 0) {
                    t = -t;
                    r.fontDirection = -1;
                } else {
                    r.fontDirection = 1;
                }
                this.current.font = n;
                this.current.fontSize = t;
                if (n.isType3Font) {
                    return;
                }
                var a = n.loadedName || "sans-serif";
                var o = n.black ? n.bold ? "900" : "bold" : n.bold ? "bold" : "normal";
                var s = n.italic ? "italic" : "normal";
                var l = '"' + a + '", ' + n.fallbackName;
                var c = t < mt ? mt : t > vt ? vt : t;
                this.current.fontSizeScale = t / c;
                var d = s + " " + o + " " + c + "px " + l;
                this.ctx.font = d;
            },
            setTextRenderingMode: function dt(e) {
                this.current.textRenderingMode = e;
            },
            setTextRise: function ht(e) {
                this.current.textRise = e;
            },
            moveText: function pt(e, t) {
                this.current.x = this.current.lineX += e;
                this.current.y = this.current.lineY += t;
            },
            setLeadingMoveText: function gt(e, t) {
                this.setLeading(-t);
                this.moveText(e, t);
            },
            setTextMatrix: function _t(e, t, i, n, r, a) {
                this.current.textMatrix = [ e, t, i, n, r, a ];
                this.current.textMatrixScale = Math.sqrt(e * e + t * t);
                this.current.x = this.current.lineX = 0;
                this.current.y = this.current.lineY = 0;
            },
            nextLine: function Tt() {
                this.moveText(0, this.current.leading);
            },
            paintChar: function It(e, t, i) {
                var r = this.ctx;
                var a = this.current;
                var o = a.font;
                var s = a.textRenderingMode;
                var l = a.fontSize / a.fontSizeScale;
                var c = s & n.FILL_STROKE_MASK;
                var u = !!(s & n.ADD_TO_PATH_FLAG);
                var f;
                if (o.disableFontFace || u) {
                    f = o.getPathGenerator(this.commonObjs, e);
                }
                if (o.disableFontFace) {
                    r.save();
                    r.translate(t, i);
                    r.beginPath();
                    f(r, l);
                    if (c === n.FILL || c === n.FILL_STROKE) {
                        r.fill();
                    }
                    if (c === n.STROKE || c === n.FILL_STROKE) {
                        r.stroke();
                    }
                    r.restore();
                } else {
                    if (c === n.FILL || c === n.FILL_STROKE) {
                        r.fillText(e, t, i);
                    }
                    if (c === n.STROKE || c === n.FILL_STROKE) {
                        r.strokeText(e, t, i);
                    }
                }
                if (u) {
                    var d = this.pendingTextPaths || (this.pendingTextPaths = []);
                    d.push({
                        transform: r.mozCurrentTransform,
                        x: t,
                        y: i,
                        fontSize: l,
                        addToPath: f
                    });
                }
            },
            get isFontSubpixelAAEnabled() {
                var e = document.createElement("canvas").getContext("2d");
                e.scale(1.5, 1);
                e.fillText("I", 0, 10);
                var t = e.getImageData(0, 0, 10, 10).data;
                var i = false;
                for (var n = 3; n < t.length; n += 4) {
                    if (t[n] > 0 && t[n] < 255) {
                        i = true;
                        break;
                    }
                }
                return y(this, "isFontSubpixelAAEnabled", i);
            },
            showText: function Ot(e) {
                var t = this.current;
                var i = t.font;
                if (i.isType3Font) {
                    return this.showType3Text(e);
                }
                var r = t.fontSize;
                if (r === 0) {
                    return;
                }
                var a = this.ctx;
                var o = t.fontSizeScale;
                var s = t.charSpacing;
                var l = t.wordSpacing;
                var c = t.fontDirection;
                var u = t.textHScale * c;
                var f = e.length;
                var d = i.vertical;
                var h = i.defaultVMetrics;
                var p = r * t.fontMatrix[0];
                var g = t.textRenderingMode === n.FILL && !i.disableFontFace;
                a.save();
                a.transform.apply(a, t.textMatrix);
                a.translate(t.x, t.y + t.textRise);
                if (c > 0) {
                    a.scale(u, -1);
                } else {
                    a.scale(u, 1);
                }
                var m = t.lineWidth;
                var v = t.textMatrixScale;
                if (v === 0 || m === 0) {
                    var y = t.textRenderingMode & n.FILL_STROKE_MASK;
                    if (y === n.STROKE || y === n.FILL_STROKE) {
                        this.cachedGetSinglePixelWidth = null;
                        m = this.getSinglePixelWidth() * bt;
                    }
                } else {
                    m /= v;
                }
                if (o !== 1) {
                    a.scale(o, o);
                    m /= o;
                }
                a.lineWidth = m;
                var b = 0, w;
                for (w = 0; w < f; ++w) {
                    var C = e[w];
                    if (C === null) {
                        b += c * l;
                        continue;
                    } else if (Y(C)) {
                        b += -C * r * .001;
                        continue;
                    }
                    var x = false;
                    var _ = C.fontChar;
                    var S = C.accent;
                    var k, A, E, T;
                    var P = C.width;
                    if (d) {
                        var I, O, D;
                        I = C.vmetric || h;
                        O = C.vmetric ? I[1] : P * .5;
                        O = -O * p;
                        D = I[2] * p;
                        P = I ? -I[0] : P;
                        k = O / o;
                        A = (b + D) / o;
                    } else {
                        k = b / o;
                        A = 0;
                    }
                    if (i.remeasure && P > 0 && this.isFontSubpixelAAEnabled) {
                        var R = a.measureText(_).width * 1e3 / r * o;
                        var L = P / R;
                        x = true;
                        a.save();
                        a.scale(L, 1);
                        k /= L;
                    }
                    if (g && !S) {
                        a.fillText(_, k, A);
                    } else {
                        this.paintChar(_, k, A);
                        if (S) {
                            E = k + S.offset.x / o;
                            T = A - S.offset.y / o;
                            this.paintChar(S.fontChar, E, T);
                        }
                    }
                    var F = P * p + s * c;
                    b += F;
                    if (x) {
                        a.restore();
                    }
                }
                if (d) {
                    t.y -= b * u;
                } else {
                    t.x += b * u;
                }
                a.restore();
            },
            showType3Text: function Lt(e) {
                var t = this.ctx;
                var r = this.current;
                var a = r.font;
                var o = r.fontSize;
                var s = r.fontDirection;
                var l = r.charSpacing;
                var c = r.wordSpacing;
                var f = r.textHScale * s;
                var d = r.fontMatrix || i;
                var h = e.length;
                var p = r.textRenderingMode === n.INVISIBLE;
                var g, m, v;
                if (p || o === 0) {
                    return;
                }
                this.cachedGetSinglePixelWidth = null;
                t.save();
                t.transform.apply(t, r.textMatrix);
                t.translate(r.x, r.y);
                t.scale(f, s);
                for (g = 0; g < h; ++g) {
                    m = e[g];
                    if (m === null) {
                        this.ctx.translate(c, 0);
                        r.x += c * f;
                        continue;
                    } else if (Y(m)) {
                        var y = -m * .001 * o;
                        this.ctx.translate(y, 0);
                        r.x += y * f;
                        continue;
                    }
                    var b = a.charProcOperatorList[m.operatorListId];
                    if (!b) {
                        u('Type3 character "' + m.operatorListId + '" is not available');
                        continue;
                    }
                    this.processingType3 = m;
                    this.save();
                    t.scale(o, o);
                    t.transform.apply(t, d);
                    this.executeOperatorList(b);
                    this.restore();
                    var w = j.applyTransform([ m.width, 0 ], d);
                    v = w[0] * o + l;
                    t.translate(v, 0);
                    r.x += v * f;
                }
                t.restore();
                this.processingType3 = null;
            },
            setCharWidth: function Ft(e, t) {},
            setCharWidthAndBounds: function Mt(e, t, i, n, r, a) {
                this.ctx.rect(i, n, r - i, a - n);
                this.clip();
                this.endPath();
            },
            getColorN_Pattern: function Nt(e) {
                var t;
                if (e[0] === "TilingPattern") {
                    var i = e[1];
                    t = new Rt(e, i, this.ctx, this.objs, this.commonObjs, this.baseTransform);
                } else {
                    t = Dt(e);
                }
                return t;
            },
            setStrokeColorN: function Bt() {
                this.current.strokeColor = this.getColorN_Pattern(arguments);
            },
            setFillColorN: function jt() {
                this.current.fillColor = this.getColorN_Pattern(arguments);
                this.current.patternFill = true;
            },
            setStrokeRGBColor: function Ut(e, t, i) {
                var n = j.makeCssRgb(e, t, i);
                this.ctx.strokeStyle = n;
                this.current.strokeColor = n;
            },
            setFillRGBColor: function zt(e, t, i) {
                var n = j.makeCssRgb(e, t, i);
                this.ctx.fillStyle = n;
                this.current.fillColor = n;
                this.current.patternFill = false;
            },
            shadingFill: function qt(e) {
                var t = this.ctx;
                this.save();
                var i = Dt(e);
                t.fillStyle = i.getPattern(t, this, true);
                var n = t.mozCurrentTransformInverse;
                if (n) {
                    var r = t.canvas;
                    var a = r.width;
                    var o = r.height;
                    var s = j.applyTransform([ 0, 0 ], n);
                    var l = j.applyTransform([ 0, o ], n);
                    var c = j.applyTransform([ a, 0 ], n);
                    var u = j.applyTransform([ a, o ], n);
                    var f = Math.min(s[0], l[0], c[0], u[0]);
                    var d = Math.min(s[1], l[1], c[1], u[1]);
                    var h = Math.max(s[0], l[0], c[0], u[0]);
                    var p = Math.max(s[1], l[1], c[1], u[1]);
                    this.ctx.fillRect(f, d, h - f, p - d);
                } else {
                    this.ctx.fillRect(-1e10, -1e10, 2e10, 2e10);
                }
                this.restore();
            },
            beginInlineImage: function Wt() {
                f("Should not call beginInlineImage");
            },
            beginImageData: function Ht() {
                f("Should not call beginImageData");
            },
            paintFormXObjectBegin: function Gt(e, t) {
                this.save();
                this.baseTransformStack.push(this.baseTransform);
                if (Z(e) && 6 === e.length) {
                    this.transform.apply(this, e);
                }
                this.baseTransform = this.ctx.mozCurrentTransform;
                if (Z(t) && 4 === t.length) {
                    var i = t[2] - t[0];
                    var n = t[3] - t[1];
                    this.ctx.rect(t[0], t[1], i, n);
                    this.clip();
                    this.endPath();
                }
            },
            paintFormXObjectEnd: function Vt() {
                this.restore();
                this.baseTransform = this.baseTransformStack.pop();
            },
            beginGroup: function $t(e) {
                this.save();
                var t = this.ctx;
                if (!e.isolated) {
                    c("TODO: Support non-isolated groups.");
                }
                if (e.knockout) {
                    u("Knockout groups not supported.");
                }
                var i = t.mozCurrentTransform;
                if (e.matrix) {
                    t.transform.apply(t, e.matrix);
                }
                h(e.bbox, "Bounding box is required.");
                var n = j.getAxialAlignedBoundingBox(e.bbox, t.mozCurrentTransform);
                var r = [ 0, 0, t.canvas.width, t.canvas.height ];
                n = j.intersect(n, r) || [ 0, 0, 0, 0 ];
                var a = Math.floor(n[0]);
                var o = Math.floor(n[1]);
                var s = Math.max(Math.ceil(n[2]) - a, 1);
                var l = Math.max(Math.ceil(n[3]) - o, 1);
                var f = 1, p = 1;
                if (s > yt) {
                    f = s / yt;
                    s = yt;
                }
                if (l > yt) {
                    p = l / yt;
                    l = yt;
                }
                var g = "groupAt" + this.groupLevel;
                if (e.smask) {
                    g += "_smask_" + this.smaskCounter++ % 2;
                }
                var m = kt.getCanvas(g, s, l, true);
                var v = m.context;
                v.scale(1 / f, 1 / p);
                v.translate(-a, -o);
                v.transform.apply(v, i);
                if (e.smask) {
                    this.smaskStack.push({
                        canvas: m.canvas,
                        context: v,
                        offsetX: a,
                        offsetY: o,
                        scaleX: f,
                        scaleY: p,
                        subtype: e.smask.subtype,
                        backdrop: e.smask.backdrop
                    });
                } else {
                    t.setTransform(1, 0, 0, 1, 0, 0);
                    t.translate(a, o);
                    t.scale(f, p);
                }
                d(t, v);
                this.ctx = v;
                this.setGState([ [ "BM", "Normal" ], [ "ca", 1 ], [ "CA", 1 ] ]);
                this.groupStack.push(t);
                this.groupLevel++;
            },
            endGroup: function Yt(e) {
                this.groupLevel--;
                var t = this.ctx;
                this.ctx = this.groupStack.pop();
                if (this.ctx.imageSmoothingEnabled !== undefined) {
                    this.ctx.imageSmoothingEnabled = false;
                } else {
                    this.ctx.mozImageSmoothingEnabled = false;
                }
                if (e.smask) {
                    this.tempSMask = this.smaskStack.pop();
                } else {
                    this.ctx.drawImage(t.canvas, 0, 0);
                }
                this.restore();
            },
            beginAnnotations: function Xt() {
                this.save();
                this.current = new Et();
            },
            endAnnotations: function Jt() {
                this.restore();
            },
            beginAnnotation: function Kt(e, t, i) {
                this.save();
                if (Z(e) && 4 === e.length) {
                    var n = e[2] - e[0];
                    var r = e[3] - e[1];
                    this.ctx.rect(e[0], e[1], n, r);
                    this.clip();
                    this.endPath();
                }
                this.transform.apply(this, t);
                this.transform.apply(this, i);
            },
            endAnnotation: function Qt() {
                this.restore();
            },
            paintJpegXObject: function Zt(e, t, i) {
                var n = this.objs.get(e);
                if (!n) {
                    u("Dependent image isn't ready yet");
                    return;
                }
                this.save();
                var r = this.ctx;
                r.scale(1 / t, -1 / i);
                r.drawImage(n, 0, 0, n.width, n.height, 0, -i, t, i);
                if (this.imageLayer) {
                    var a = r.mozCurrentTransformInverse;
                    var o = this.getCanvasPosition(0, 0);
                    this.imageLayer.appendImage({
                        objId: e,
                        left: o[0],
                        top: o[1],
                        width: t / a[0],
                        height: i / a[3]
                    });
                }
                this.restore();
            },
            paintImageMaskXObject: function ei(e) {
                var t = this.ctx;
                var i = e.width, n = e.height;
                var r = this.current.fillColor;
                var a = this.current.patternFill;
                var o = this.processingType3;
                if (wt && o && o.compiled === undefined) {
                    if (i <= Ct && n <= Ct) {
                        o.compiled = At({
                            data: e.data,
                            width: i,
                            height: n
                        });
                    } else {
                        o.compiled = null;
                    }
                }
                if (o && o.compiled) {
                    o.compiled(t);
                    return;
                }
                var l = kt.getCanvas("maskCanvas", i, n);
                var c = l.context;
                c.save();
                s(c, e);
                c.globalCompositeOperation = "source-in";
                c.fillStyle = a ? r.getPattern(c, this) : r;
                c.fillRect(0, 0, i, n);
                c.restore();
                this.paintInlineImageXObject(l.canvas);
            },
            paintImageMaskXObjectRepeat: function ti(e, t, i, n) {
                var r = e.width;
                var a = e.height;
                var o = this.current.fillColor;
                var l = this.current.patternFill;
                var c = kt.getCanvas("maskCanvas", r, a);
                var u = c.context;
                u.save();
                s(u, e);
                u.globalCompositeOperation = "source-in";
                u.fillStyle = l ? o.getPattern(u, this) : o;
                u.fillRect(0, 0, r, a);
                u.restore();
                var f = this.ctx;
                for (var d = 0, h = n.length; d < h; d += 2) {
                    f.save();
                    f.transform(t, 0, 0, i, n[d], n[d + 1]);
                    f.scale(1, -1);
                    f.drawImage(c.canvas, 0, 0, r, a, 0, -1, 1, 1);
                    f.restore();
                }
            },
            paintImageMaskXObjectGroup: function ii(e) {
                var t = this.ctx;
                var i = this.current.fillColor;
                var n = this.current.patternFill;
                for (var r = 0, a = e.length; r < a; r++) {
                    var o = e[r];
                    var l = o.width, c = o.height;
                    var u = kt.getCanvas("maskCanvas", l, c);
                    var f = u.context;
                    f.save();
                    s(f, o);
                    f.globalCompositeOperation = "source-in";
                    f.fillStyle = n ? i.getPattern(f, this) : i;
                    f.fillRect(0, 0, l, c);
                    f.restore();
                    t.save();
                    t.transform.apply(t, o.transform);
                    t.scale(1, -1);
                    t.drawImage(u.canvas, 0, 0, l, c, 0, -1, 1, 1);
                    t.restore();
                }
            },
            paintImageXObject: function ni(e) {
                var t = this.objs.get(e);
                if (!t) {
                    u("Dependent image isn't ready yet");
                    return;
                }
                this.paintInlineImageXObject(t);
            },
            paintImageXObjectRepeat: function ri(e, t, i, n) {
                var r = this.objs.get(e);
                if (!r) {
                    u("Dependent image isn't ready yet");
                    return;
                }
                var a = r.width;
                var o = r.height;
                var s = [];
                for (var l = 0, c = n.length; l < c; l += 2) {
                    s.push({
                        transform: [ t, 0, 0, i, n[l], n[l + 1] ],
                        x: 0,
                        y: 0,
                        w: a,
                        h: o
                    });
                }
                this.paintInlineImageXObjectGroup(r, s);
            },
            paintInlineImageXObject: function ai(e) {
                var t = e.width;
                var i = e.height;
                var n = this.ctx;
                this.save();
                n.scale(1 / t, -1 / i);
                var r = n.mozCurrentTransformInverse;
                var a = r[0], s = r[1];
                var l = Math.max(Math.sqrt(a * a + s * s), 1);
                var c = r[2], u = r[3];
                var f = Math.max(Math.sqrt(c * c + u * u), 1);
                var d, h;
                if (e instanceof HTMLElement || !e.data) {
                    d = e;
                } else {
                    h = kt.getCanvas("inlineImage", t, i);
                    var p = h.context;
                    o(p, e);
                    d = h.canvas;
                }
                var g = t, m = i;
                var v = "prescale1";
                while (l > 2 && g > 1 || f > 2 && m > 1) {
                    var y = g, b = m;
                    if (l > 2 && g > 1) {
                        y = Math.ceil(g / 2);
                        l /= g / y;
                    }
                    if (f > 2 && m > 1) {
                        b = Math.ceil(m / 2);
                        f /= m / b;
                    }
                    h = kt.getCanvas(v, y, b);
                    p = h.context;
                    p.clearRect(0, 0, y, b);
                    p.drawImage(d, 0, 0, g, m, 0, 0, y, b);
                    d = h.canvas;
                    g = y;
                    m = b;
                    v = v === "prescale1" ? "prescale2" : "prescale1";
                }
                n.drawImage(d, 0, 0, g, m, 0, -i, t, i);
                if (this.imageLayer) {
                    var w = this.getCanvasPosition(0, -i);
                    this.imageLayer.appendImage({
                        imgData: e,
                        left: w[0],
                        top: w[1],
                        width: t / r[0],
                        height: i / r[3]
                    });
                }
                this.restore();
            },
            paintInlineImageXObjectGroup: function oi(e, t) {
                var i = this.ctx;
                var n = e.width;
                var r = e.height;
                var a = kt.getCanvas("inlineImage", n, r);
                var s = a.context;
                o(s, e);
                for (var l = 0, c = t.length; l < c; l++) {
                    var u = t[l];
                    i.save();
                    i.transform.apply(i, u.transform);
                    i.scale(1, -1);
                    i.drawImage(a.canvas, u.x, u.y, u.w, u.h, 0, -1, 1, 1);
                    if (this.imageLayer) {
                        var f = this.getCanvasPosition(u.x, u.y);
                        this.imageLayer.appendImage({
                            imgData: e,
                            left: f[0],
                            top: f[1],
                            width: n,
                            height: r
                        });
                    }
                    i.restore();
                }
            },
            paintSolidColorImageMask: function si() {
                this.ctx.fillRect(0, 0, 1, 1);
            },
            markPoint: function li(e) {},
            markPointProps: function ci(e, t) {},
            beginMarkedContent: function ui(e) {},
            beginMarkedContentProps: function fi(e, t) {},
            endMarkedContent: function di() {},
            beginCompat: function hi() {},
            endCompat: function pi() {},
            consumePath: function gi() {
                var e = this.ctx;
                if (this.pendingClip) {
                    if (this.pendingClip === _) {
                        if (e.mozFillRule !== undefined) {
                            e.mozFillRule = "evenodd";
                            e.clip();
                            e.mozFillRule = "nonzero";
                        } else {
                            try {
                                e.clip("evenodd");
                            } catch (t) {
                                e.clip();
                            }
                        }
                    } else {
                        e.clip();
                    }
                    this.pendingClip = null;
                }
                e.beginPath();
            },
            getSinglePixelWidth: function mi(e) {
                if (this.cachedGetSinglePixelWidth === null) {
                    var t = this.ctx.mozCurrentTransformInverse;
                    this.cachedGetSinglePixelWidth = Math.sqrt(Math.max(t[0] * t[0] + t[1] * t[1], t[2] * t[2] + t[3] * t[3]));
                }
                return this.cachedGetSinglePixelWidth;
            },
            getCanvasPosition: function vi(e, t) {
                var i = this.ctx.mozCurrentTransform;
                return [ i[0] * e + i[2] * t + i[4], i[1] * e + i[3] * t + i[5] ];
            }
        };
        for (var S in l) {
            a.prototype[l[S]] = a.prototype[S];
        }
        return a;
    }();
    var Pt = function xi() {
        function e(e, t, i) {
            var n = e.createShader(i);
            e.shaderSource(n, t);
            e.compileShader(n);
            var r = e.getShaderParameter(n, e.COMPILE_STATUS);
            if (!r) {
                var a = e.getShaderInfoLog(n);
                throw new Error("Error during shader compilation: " + a);
            }
            return n;
        }
        function t(t, i) {
            return e(t, i, t.VERTEX_SHADER);
        }
        function i(t, i) {
            return e(t, i, t.FRAGMENT_SHADER);
        }
        function n(e, t) {
            var i = e.createProgram();
            for (var n = 0, r = t.length; n < r; ++n) {
                e.attachShader(i, t[n]);
            }
            e.linkProgram(i);
            var a = e.getProgramParameter(i, e.LINK_STATUS);
            if (!a) {
                var o = e.getProgramInfoLog(i);
                throw new Error("Error during program linking: " + o);
            }
            return i;
        }
        function r(e, t, i) {
            e.activeTexture(i);
            var n = e.createTexture();
            e.bindTexture(e.TEXTURE_2D, n);
            e.texParameteri(e.TEXTURE_2D, e.TEXTURE_WRAP_S, e.CLAMP_TO_EDGE);
            e.texParameteri(e.TEXTURE_2D, e.TEXTURE_WRAP_T, e.CLAMP_TO_EDGE);
            e.texParameteri(e.TEXTURE_2D, e.TEXTURE_MIN_FILTER, e.NEAREST);
            e.texParameteri(e.TEXTURE_2D, e.TEXTURE_MAG_FILTER, e.NEAREST);
            e.texImage2D(e.TEXTURE_2D, 0, e.RGBA, e.RGBA, e.UNSIGNED_BYTE, t);
            return n;
        }
        var a, o;
        function s() {
            if (a) {
                return;
            }
            o = document.createElement("canvas");
            a = o.getContext("webgl", {
                premultipliedalpha: false
            });
        }
        var l = "  attribute vec2 a_position;                                      attribute vec2 a_texCoord;                                                                                                      uniform vec2 u_resolution;                                                                                                      varying vec2 v_texCoord;                                                                                                        void main() {                                                     vec2 clipSpace = (a_position / u_resolution) * 2.0 - 1.0;       gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);                                                                              v_texCoord = a_texCoord;                                      }                                                             ";
        var c = "  precision mediump float;                                                                                                        uniform vec4 u_backdrop;                                        uniform int u_subtype;                                          uniform sampler2D u_image;                                      uniform sampler2D u_mask;                                                                                                       varying vec2 v_texCoord;                                                                                                        void main() {                                                     vec4 imageColor = texture2D(u_image, v_texCoord);               vec4 maskColor = texture2D(u_mask, v_texCoord);                 if (u_backdrop.a > 0.0) {                                         maskColor.rgb = maskColor.rgb * maskColor.a +                                   u_backdrop.rgb * (1.0 - maskColor.a);         }                                                               float lum;                                                      if (u_subtype == 0) {                                             lum = maskColor.a;                                            } else {                                                          lum = maskColor.r * 0.3 + maskColor.g * 0.59 +                        maskColor.b * 0.11;                                     }                                                               imageColor.a *= lum;                                            imageColor.rgb *= imageColor.a;                                 gl_FragColor = imageColor;                                    }                                                             ";
        var u = null;
        function f() {
            var e, r;
            s();
            e = o;
            o = null;
            r = a;
            a = null;
            var f = t(r, l);
            var d = i(r, c);
            var h = n(r, [ f, d ]);
            r.useProgram(h);
            var p = {};
            p.gl = r;
            p.canvas = e;
            p.resolutionLocation = r.getUniformLocation(h, "u_resolution");
            p.positionLocation = r.getAttribLocation(h, "a_position");
            p.backdropLocation = r.getUniformLocation(h, "u_backdrop");
            p.subtypeLocation = r.getUniformLocation(h, "u_subtype");
            var g = r.getAttribLocation(h, "a_texCoord");
            var m = r.getUniformLocation(h, "u_image");
            var v = r.getUniformLocation(h, "u_mask");
            var y = r.createBuffer();
            r.bindBuffer(r.ARRAY_BUFFER, y);
            r.bufferData(r.ARRAY_BUFFER, new Float32Array([ 0, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 1 ]), r.STATIC_DRAW);
            r.enableVertexAttribArray(g);
            r.vertexAttribPointer(g, 2, r.FLOAT, false, 0, 0);
            r.uniform1i(m, 0);
            r.uniform1i(v, 1);
            u = p;
        }
        function d(e, t, i) {
            var n = e.width, a = e.height;
            if (!u) {
                f();
            }
            var o = u, s = o.canvas, l = o.gl;
            s.width = n;
            s.height = a;
            l.viewport(0, 0, l.drawingBufferWidth, l.drawingBufferHeight);
            l.uniform2f(o.resolutionLocation, n, a);
            if (i.backdrop) {
                l.uniform4f(o.resolutionLocation, i.backdrop[0], i.backdrop[1], i.backdrop[2], 1);
            } else {
                l.uniform4f(o.resolutionLocation, 0, 0, 0, 0);
            }
            l.uniform1i(o.subtypeLocation, i.subtype === "Luminosity" ? 1 : 0);
            var c = r(l, e, l.TEXTURE0);
            var d = r(l, t, l.TEXTURE1);
            var h = l.createBuffer();
            l.bindBuffer(l.ARRAY_BUFFER, h);
            l.bufferData(l.ARRAY_BUFFER, new Float32Array([ 0, 0, n, 0, 0, a, 0, a, n, 0, n, a ]), l.STATIC_DRAW);
            l.enableVertexAttribArray(o.positionLocation);
            l.vertexAttribPointer(o.positionLocation, 2, l.FLOAT, false, 0, 0);
            l.clearColor(0, 0, 0, 0);
            l.enable(l.BLEND);
            l.blendFunc(l.ONE, l.ONE_MINUS_SRC_ALPHA);
            l.clear(l.COLOR_BUFFER_BIT);
            l.drawArrays(l.TRIANGLES, 0, 6);
            l.flush();
            l.deleteTexture(c);
            l.deleteTexture(d);
            l.deleteBuffer(h);
            return s;
        }
        var h = "  attribute vec2 a_position;                                      attribute vec3 a_color;                                                                                                         uniform vec2 u_resolution;                                      uniform vec2 u_scale;                                           uniform vec2 u_offset;                                                                                                          varying vec4 v_color;                                                                                                           void main() {                                                     vec2 position = (a_position + u_offset) * u_scale;              vec2 clipSpace = (position / u_resolution) * 2.0 - 1.0;         gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);                                                                              v_color = vec4(a_color / 255.0, 1.0);                         }                                                             ";
        var p = "  precision mediump float;                                                                                                        varying vec4 v_color;                                                                                                           void main() {                                                     gl_FragColor = v_color;                                       }                                                             ";
        var g = null;
        function m() {
            var e, r;
            s();
            e = o;
            o = null;
            r = a;
            a = null;
            var l = t(r, h);
            var c = i(r, p);
            var u = n(r, [ l, c ]);
            r.useProgram(u);
            var f = {};
            f.gl = r;
            f.canvas = e;
            f.resolutionLocation = r.getUniformLocation(u, "u_resolution");
            f.scaleLocation = r.getUniformLocation(u, "u_scale");
            f.offsetLocation = r.getUniformLocation(u, "u_offset");
            f.positionLocation = r.getAttribLocation(u, "a_position");
            f.colorLocation = r.getAttribLocation(u, "a_color");
            g = f;
        }
        function v(e, t, i, n, r) {
            if (!g) {
                m();
            }
            var a = g, o = a.canvas, s = a.gl;
            o.width = e;
            o.height = t;
            s.viewport(0, 0, s.drawingBufferWidth, s.drawingBufferHeight);
            s.uniform2f(a.resolutionLocation, e, t);
            var l = 0;
            var c, u, f;
            for (c = 0, u = n.length; c < u; c++) {
                switch (n[c].type) {
                  case "lattice":
                    f = n[c].coords.length / n[c].verticesPerRow | 0;
                    l += (f - 1) * (n[c].verticesPerRow - 1) * 6;
                    break;

                  case "triangles":
                    l += n[c].coords.length;
                    break;
                }
            }
            var d = new Float32Array(l * 2);
            var h = new Uint8Array(l * 3);
            var p = r.coords, v = r.colors;
            var y = 0, b = 0;
            for (c = 0, u = n.length; c < u; c++) {
                var w = n[c], C = w.coords, x = w.colors;
                switch (w.type) {
                  case "lattice":
                    var _ = w.verticesPerRow;
                    f = C.length / _ | 0;
                    for (var S = 1; S < f; S++) {
                        var k = S * _ + 1;
                        for (var A = 1; A < _; A++, k++) {
                            d[y] = p[C[k - _ - 1]];
                            d[y + 1] = p[C[k - _ - 1] + 1];
                            d[y + 2] = p[C[k - _]];
                            d[y + 3] = p[C[k - _] + 1];
                            d[y + 4] = p[C[k - 1]];
                            d[y + 5] = p[C[k - 1] + 1];
                            h[b] = v[x[k - _ - 1]];
                            h[b + 1] = v[x[k - _ - 1] + 1];
                            h[b + 2] = v[x[k - _ - 1] + 2];
                            h[b + 3] = v[x[k - _]];
                            h[b + 4] = v[x[k - _] + 1];
                            h[b + 5] = v[x[k - _] + 2];
                            h[b + 6] = v[x[k - 1]];
                            h[b + 7] = v[x[k - 1] + 1];
                            h[b + 8] = v[x[k - 1] + 2];
                            d[y + 6] = d[y + 2];
                            d[y + 7] = d[y + 3];
                            d[y + 8] = d[y + 4];
                            d[y + 9] = d[y + 5];
                            d[y + 10] = p[C[k]];
                            d[y + 11] = p[C[k] + 1];
                            h[b + 9] = h[b + 3];
                            h[b + 10] = h[b + 4];
                            h[b + 11] = h[b + 5];
                            h[b + 12] = h[b + 6];
                            h[b + 13] = h[b + 7];
                            h[b + 14] = h[b + 8];
                            h[b + 15] = v[x[k]];
                            h[b + 16] = v[x[k] + 1];
                            h[b + 17] = v[x[k] + 2];
                            y += 12;
                            b += 18;
                        }
                    }
                    break;

                  case "triangles":
                    for (var E = 0, T = C.length; E < T; E++) {
                        d[y] = p[C[E]];
                        d[y + 1] = p[C[E] + 1];
                        h[b] = v[x[c]];
                        h[b + 1] = v[x[E] + 1];
                        h[b + 2] = v[x[E] + 2];
                        y += 2;
                        b += 3;
                    }
                    break;
                }
            }
            if (i) {
                s.clearColor(i[0] / 255, i[1] / 255, i[2] / 255, 1);
            } else {
                s.clearColor(0, 0, 0, 0);
            }
            s.clear(s.COLOR_BUFFER_BIT);
            var P = s.createBuffer();
            s.bindBuffer(s.ARRAY_BUFFER, P);
            s.bufferData(s.ARRAY_BUFFER, d, s.STATIC_DRAW);
            s.enableVertexAttribArray(a.positionLocation);
            s.vertexAttribPointer(a.positionLocation, 2, s.FLOAT, false, 0, 0);
            var I = s.createBuffer();
            s.bindBuffer(s.ARRAY_BUFFER, I);
            s.bufferData(s.ARRAY_BUFFER, h, s.STATIC_DRAW);
            s.enableVertexAttribArray(a.colorLocation);
            s.vertexAttribPointer(a.colorLocation, 3, s.UNSIGNED_BYTE, false, 0, 0);
            s.uniform2f(a.scaleLocation, r.scaleX, r.scaleY);
            s.uniform2f(a.offsetLocation, r.offsetX, r.offsetY);
            s.drawArrays(s.TRIANGLES, 0, l);
            s.flush();
            s.deleteBuffer(P);
            s.deleteBuffer(I);
            return o;
        }
        function b() {
            if (u && u.canvas) {
                u.canvas.width = 0;
                u.canvas.height = 0;
            }
            if (g && g.canvas) {
                g.canvas.width = 0;
                g.canvas.height = 0;
            }
            u = null;
            g = null;
        }
        return {
            get isEnabled() {
                if (PDFJS.disableWebGL) {
                    return false;
                }
                var e = false;
                try {
                    s();
                    e = !!a;
                } catch (t) {}
                return y(this, "isEnabled", e);
            },
            composeSMask: d,
            drawFigures: v,
            clear: b
        };
    }();
    var It = {};
    It.RadialAxial = {
        fromIR: function _i(e) {
            var t = e[1];
            var i = e[2];
            var n = e[3];
            var r = e[4];
            var a = e[5];
            var o = e[6];
            return {
                type: "Pattern",
                getPattern: function s(e) {
                    var s;
                    if (t === "axial") {
                        s = e.createLinearGradient(n[0], n[1], r[0], r[1]);
                    } else if (t === "radial") {
                        s = e.createRadialGradient(n[0], n[1], a, r[0], r[1], o);
                    }
                    for (var l = 0, c = i.length; l < c; ++l) {
                        var u = i[l];
                        s.addColorStop(u[0], u[1]);
                    }
                    return s;
                }
            };
        }
    };
    var Ot = function Si() {
        function e(e, t, i, n, r, a, o, s) {
            var l = t.coords, c = t.colors;
            var u = e.data, f = e.width * 4;
            var d;
            if (l[i + 1] > l[n + 1]) {
                d = i;
                i = n;
                n = d;
                d = a;
                a = o;
                o = d;
            }
            if (l[n + 1] > l[r + 1]) {
                d = n;
                n = r;
                r = d;
                d = o;
                o = s;
                s = d;
            }
            if (l[i + 1] > l[n + 1]) {
                d = i;
                i = n;
                n = d;
                d = a;
                a = o;
                o = d;
            }
            var h = (l[i] + t.offsetX) * t.scaleX;
            var p = (l[i + 1] + t.offsetY) * t.scaleY;
            var g = (l[n] + t.offsetX) * t.scaleX;
            var m = (l[n + 1] + t.offsetY) * t.scaleY;
            var v = (l[r] + t.offsetX) * t.scaleX;
            var y = (l[r + 1] + t.offsetY) * t.scaleY;
            if (p >= y) {
                return;
            }
            var b = c[a], w = c[a + 1], C = c[a + 2];
            var x = c[o], _ = c[o + 1], S = c[o + 2];
            var k = c[s], A = c[s + 1], E = c[s + 2];
            var T = Math.round(p), P = Math.round(y);
            var I, O, D, R;
            var L, F, M, N;
            var B;
            for (var j = T; j <= P; j++) {
                if (j < m) {
                    B = j < p ? 0 : p === m ? 1 : (p - j) / (p - m);
                    I = h - (h - g) * B;
                    O = b - (b - x) * B;
                    D = w - (w - _) * B;
                    R = C - (C - S) * B;
                } else {
                    B = j > y ? 1 : m === y ? 0 : (m - j) / (m - y);
                    I = g - (g - v) * B;
                    O = x - (x - k) * B;
                    D = _ - (_ - A) * B;
                    R = S - (S - E) * B;
                }
                B = j < p ? 0 : j > y ? 1 : (p - j) / (p - y);
                L = h - (h - v) * B;
                F = b - (b - k) * B;
                M = w - (w - A) * B;
                N = C - (C - E) * B;
                var U = Math.round(Math.min(I, L));
                var z = Math.round(Math.max(I, L));
                var q = f * j + U * 4;
                for (var W = U; W <= z; W++) {
                    B = (I - W) / (I - L);
                    B = B < 0 ? 0 : B > 1 ? 1 : B;
                    u[q++] = O - (O - F) * B | 0;
                    u[q++] = D - (D - M) * B | 0;
                    u[q++] = R - (R - N) * B | 0;
                    u[q++] = 255;
                }
            }
        }
        function t(t, i, n) {
            var r = i.coords;
            var a = i.colors;
            var o, s;
            switch (i.type) {
              case "lattice":
                var l = i.verticesPerRow;
                var c = Math.floor(r.length / l) - 1;
                var u = l - 1;
                for (o = 0; o < c; o++) {
                    var d = o * l;
                    for (var h = 0; h < u; h++, d++) {
                        e(t, n, r[d], r[d + 1], r[d + l], a[d], a[d + 1], a[d + l]);
                        e(t, n, r[d + l + 1], r[d + 1], r[d + l], a[d + l + 1], a[d + 1], a[d + l]);
                    }
                }
                break;

              case "triangles":
                for (o = 0, s = r.length; o < s; o += 3) {
                    e(t, n, r[o], r[o + 1], r[o + 2], a[o], a[o + 1], a[o + 2]);
                }
                break;

              default:
                f("illigal figure");
                break;
            }
        }
        function i(e, i, n, r, a, o) {
            var s = 1.1;
            var l = 3e3;
            var c = Math.floor(e[0]);
            var u = Math.floor(e[1]);
            var f = Math.ceil(e[2]) - c;
            var d = Math.ceil(e[3]) - u;
            var h = Math.min(Math.ceil(Math.abs(f * i[0] * s)), l);
            var p = Math.min(Math.ceil(Math.abs(d * i[1] * s)), l);
            var g = f / h;
            var m = d / p;
            var v = {
                coords: n,
                colors: r,
                offsetX: -c,
                offsetY: -u,
                scaleX: 1 / g,
                scaleY: 1 / m
            };
            var y, b, w, C;
            if (Pt.isEnabled) {
                y = Pt.drawFigures(h, p, o, a, v);
                b = kt.getCanvas("mesh", h, p, false);
                b.context.drawImage(y, 0, 0);
                y = b.canvas;
            } else {
                b = kt.getCanvas("mesh", h, p, false);
                var x = b.context;
                var _ = x.createImageData(h, p);
                if (o) {
                    var S = _.data;
                    for (w = 0, C = S.length; w < C; w += 4) {
                        S[w] = o[0];
                        S[w + 1] = o[1];
                        S[w + 2] = o[2];
                        S[w + 3] = 255;
                    }
                }
                for (w = 0; w < a.length; w++) {
                    t(_, a[w], v);
                }
                x.putImageData(_, 0, 0);
                y = b.canvas;
            }
            return {
                canvas: y,
                offsetX: c,
                offsetY: u,
                scaleX: g,
                scaleY: m
            };
        }
        return i;
    }();
    It.Mesh = {
        fromIR: function ki(e) {
            var t = e[2];
            var i = e[3];
            var n = e[4];
            var r = e[5];
            var a = e[6];
            var o = e[8];
            return {
                type: "Pattern",
                getPattern: function s(e, l, c) {
                    var u;
                    if (c) {
                        u = j.singularValueDecompose2dScale(e.mozCurrentTransform);
                    } else {
                        u = j.singularValueDecompose2dScale(l.baseTransform);
                        if (a) {
                            var f = j.singularValueDecompose2dScale(a);
                            u = [ u[0] * f[0], u[1] * f[1] ];
                        }
                    }
                    var d = Ot(r, u, t, i, n, c ? null : o);
                    if (!c) {
                        e.setTransform.apply(e, l.baseTransform);
                        if (a) {
                            e.transform.apply(e, a);
                        }
                    }
                    e.translate(d.offsetX, d.offsetY);
                    e.scale(d.scaleX, d.scaleY);
                    return e.createPattern(d.canvas, "no-repeat");
                }
            };
        }
    };
    It.Dummy = {
        fromIR: function Ai() {
            return {
                type: "Pattern",
                getPattern: function e() {
                    return "hotpink";
                }
            };
        }
    };
    function Dt(e) {
        var t = It[e[0]];
        if (!t) {
            f("Unknown IR type: " + e[0]);
        }
        return t.fromIR(e);
    }
    var Rt = function Ei() {
        var e = {
            COLORED: 1,
            UNCOLORED: 2
        };
        var t = 3e3;
        function i(e, t, i, n, r, a) {
            this.operatorList = e[2];
            this.matrix = e[3] || [ 1, 0, 0, 1, 0, 0 ];
            this.bbox = e[4];
            this.xstep = e[5];
            this.ystep = e[6];
            this.paintType = e[7];
            this.tilingType = e[8];
            this.color = t;
            this.objs = n;
            this.commonObjs = r;
            this.baseTransform = a;
            this.type = "Pattern";
            this.ctx = i;
        }
        i.prototype = {
            createPatternCanvas: function n(e) {
                var i = this.operatorList;
                var n = this.bbox;
                var r = this.xstep;
                var a = this.ystep;
                var o = this.paintType;
                var s = this.tilingType;
                var l = this.color;
                var u = this.objs;
                var f = this.commonObjs;
                c("TilingType: " + s);
                var d = n[0], h = n[1], p = n[2], g = n[3];
                var m = [ d, h ];
                var v = [ d + r, h + a ];
                var y = v[0] - m[0];
                var b = v[1] - m[1];
                var w = j.singularValueDecompose2dScale(this.matrix);
                var C = j.singularValueDecompose2dScale(this.baseTransform);
                var x = [ w[0] * C[0], w[1] * C[1] ];
                y = Math.min(Math.ceil(Math.abs(y * x[0])), t);
                b = Math.min(Math.ceil(Math.abs(b * x[1])), t);
                var _ = kt.getCanvas("pattern", y, b, true);
                var S = _.context;
                var k = new Tt(S, f, u);
                k.groupLevel = e.groupLevel;
                this.setFillAndStrokeStyleToContext(S, o, l);
                this.setScale(y, b, r, a);
                this.transformToScale(k);
                var A = [ 1, 0, 0, 1, -m[0], -m[1] ];
                k.transform.apply(k, A);
                this.clipBbox(k, n, d, h, p, g);
                k.executeOperatorList(i);
                return _.canvas;
            },
            setScale: function r(e, t, i, n) {
                this.scale = [ e / i, t / n ];
            },
            transformToScale: function a(e) {
                var t = this.scale;
                var i = [ t[0], 0, 0, t[1], 0, 0 ];
                e.transform.apply(e, i);
            },
            scaleToContext: function o() {
                var e = this.scale;
                this.ctx.scale(1 / e[0], 1 / e[1]);
            },
            clipBbox: function s(e, t, i, n, r, a) {
                if (t && Z(t) && t.length === 4) {
                    var o = r - i;
                    var s = a - n;
                    e.ctx.rect(i, n, o, s);
                    e.clip();
                    e.endPath();
                }
            },
            setFillAndStrokeStyleToContext: function l(t, i, n) {
                switch (i) {
                  case e.COLORED:
                    var r = this.ctx;
                    t.fillStyle = r.fillStyle;
                    t.strokeStyle = r.strokeStyle;
                    break;

                  case e.UNCOLORED:
                    var a = j.makeCssRgb(n[0], n[1], n[2]);
                    t.fillStyle = a;
                    t.strokeStyle = a;
                    break;

                  default:
                    f("Unsupported paint type: " + i);
                }
            },
            getPattern: function u(e, t) {
                var i = this.createPatternCanvas(t);
                e = this.ctx;
                e.setTransform.apply(e, this.baseTransform);
                e.transform.apply(e, this.matrix);
                this.scaleToContext();
                return e.createPattern(i, "repeat");
            }
        };
        return i;
    }();
    PDFJS.disableFontFace = false;
    var Lt = {
        insertRule: function Ti(e) {
            var t = document.getElementById("PDFJS_FONT_STYLE_TAG");
            if (!t) {
                t = document.createElement("style");
                t.id = "PDFJS_FONT_STYLE_TAG";
                document.documentElement.getElementsByTagName("head")[0].appendChild(t);
            }
            var i = t.sheet;
            i.insertRule(e, i.cssRules.length);
        },
        clear: function Pi() {
            var e = document.getElementById("PDFJS_FONT_STYLE_TAG");
            if (e) {
                e.parentNode.removeChild(e);
            }
            this.nativeFontFaces.forEach(function(e) {
                document.fonts.delete(e);
            });
            this.nativeFontFaces.length = 0;
        },
        get loadTestFont() {
            return y(this, "loadTestFont", atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQ" + "AABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwA" + "AAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbm" + "FtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAA" + "AADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6A" + "ABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAA" + "MQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAA" + "AAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAA" + "AAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQ" + "AAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMA" + "AQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAA" + "EAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAA" + "AQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAA" + "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" + "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" + "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" + "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAA" + "AAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgc" + "A/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWF" + "hYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQA" + "AAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAg" + "ABAAAAAAAAAAAD6AAAAAAAAA=="));
        },
        loadTestFontId: 0,
        loadingContext: {
            requests: [],
            nextRequestId: 0
        },
        isSyncFontLoadingSupported: function Ii() {
            if (t) {
                return false;
            }
            var e = window.navigator.userAgent;
            var i = /Mozilla\/5.0.*?rv:(\d+).*? Gecko/.exec(e);
            if (i && i[1] >= 14) {
                return true;
            }
            if (e === "node") {
                return true;
            }
            return false;
        }(),
        nativeFontFaces: [],
        isFontLoadingAPISupported: !t && typeof document !== "undefined" && !!document.fonts,
        addNativeFontFace: function Oi(e) {
            this.nativeFontFaces.push(e);
            document.fonts.add(e);
        },
        bind: function Di(e, i) {
            h(!t, "bind() shall be called from main thread");
            var n = [];
            var r = [];
            var a = [];
            for (var o = 0, s = e.length; o < s; o++) {
                var l = e[o];
                if (l.attached || l.loading === false) {
                    continue;
                }
                l.attached = true;
                if (this.isFontLoadingAPISupported) {
                    var c = l.createNativeFontFace();
                    if (c) {
                        a.push(c.loaded);
                    }
                } else {
                    var u = l.bindDOM();
                    if (u) {
                        n.push(u);
                        r.push(l);
                    }
                }
            }
            var f = Lt.queueLoadingCallback(i);
            if (this.isFontLoadingAPISupported) {
                Promise.all(r).then(function() {
                    f.complete();
                });
            } else if (n.length > 0 && !this.isSyncFontLoadingSupported) {
                Lt.prepareFontLoadEvent(n, r, f);
            } else {
                f.complete();
            }
        },
        queueLoadingCallback: function Ri(e) {
            function t() {
                h(!r.end, "completeRequest() cannot be called twice");
                r.end = Date.now();
                while (i.requests.length > 0 && i.requests[0].end) {
                    var e = i.requests.shift();
                    setTimeout(e.callback, 0);
                }
            }
            var i = Lt.loadingContext;
            var n = "pdfjs-font-loading-" + i.nextRequestId++;
            var r = {
                id: n,
                complete: t,
                callback: e,
                started: Date.now()
            };
            i.requests.push(r);
            return r;
        },
        prepareFontLoadEvent: function Li(e, t, i) {
            function n(e, t) {
                return e.charCodeAt(t) << 24 | e.charCodeAt(t + 1) << 16 | e.charCodeAt(t + 2) << 8 | e.charCodeAt(t + 3) & 255;
            }
            function r(e, t, i, n) {
                var r = e.substr(0, t);
                var a = e.substr(t + i);
                return r + n + a;
            }
            var a, o;
            var s = document.createElement("canvas");
            s.width = 1;
            s.height = 1;
            var l = s.getContext("2d");
            var c = 0;
            function f(e, t) {
                c++;
                if (c > 30) {
                    u("Load test font never loaded.");
                    t();
                    return;
                }
                l.font = "30px " + e;
                l.fillText(".", 0, 20);
                var i = l.getImageData(0, 0, 1, 1);
                if (i.data[3] > 0) {
                    t();
                    return;
                }
                setTimeout(f.bind(null, e, t));
            }
            var d = "lt" + Date.now() + this.loadTestFontId++;
            var h = this.loadTestFont;
            var p = 976;
            h = r(h, p, d.length, d);
            var g = 16;
            var m = 1482184792;
            var v = n(h, g);
            for (a = 0, o = d.length - 3; a < o; a += 4) {
                v = v - m + n(d, a) | 0;
            }
            if (a < d.length) {
                v = v - m + n(d + "XXX", a) | 0;
            }
            h = r(h, g, 4, I(v));
            var y = "url(data:font/opentype;base64," + btoa(h) + ");";
            var b = '@font-face { font-family:"' + d + '";src:' + y + "}";
            Lt.insertRule(b);
            var w = [];
            for (a = 0, o = t.length; a < o; a++) {
                w.push(t[a].loadedName);
            }
            w.push(d);
            var C = document.createElement("div");
            C.setAttribute("style", "visibility: hidden;" + "width: 10px; height: 10px;" + "position: absolute; top: 0px; left: 0px;");
            for (a = 0, o = w.length; a < o; ++a) {
                var x = document.createElement("span");
                x.textContent = "Hi";
                x.style.fontFamily = w[a];
                C.appendChild(x);
            }
            document.body.appendChild(C);
            f(d, function() {
                document.body.removeChild(C);
                i.complete();
            });
        }
    };
    var Ft = function Fi() {
        function t(e, t, i) {
            this.compiledGlyphs = {};
            if (arguments.length === 1) {
                var n = arguments[0];
                for (var r in n) {
                    this[r] = n[r];
                }
                return;
            }
        }
        t.prototype = {
            createNativeFontFace: function i() {
                if (!this.data) {
                    return null;
                }
                if (PDFJS.disableFontFace) {
                    this.disableFontFace = true;
                    return null;
                }
                var t = new FontFace(this.loadedName, this.data, {});
                Lt.addNativeFontFace(t);
                if (PDFJS.pdfBug && "FontInspector" in e && e["FontInspector"].enabled) {
                    e["FontInspector"].fontAdded(this);
                }
                return t;
            },
            bindDOM: function n() {
                if (!this.data) {
                    return null;
                }
                if (PDFJS.disableFontFace) {
                    this.disableFontFace = true;
                    return null;
                }
                var t = T(new Uint8Array(this.data));
                var i = this.loadedName;
                var n = "url(data:" + this.mimetype + ";base64," + window.btoa(t) + ");";
                var r = '@font-face { font-family:"' + i + '";src:' + n + "}";
                Lt.insertRule(r);
                if (PDFJS.pdfBug && "FontInspector" in e && e["FontInspector"].enabled) {
                    e["FontInspector"].fontAdded(this, n);
                }
                return r;
            },
            getPathGenerator: function r(e, t) {
                if (!(t in this.compiledGlyphs)) {
                    var i = e.get(this.loadedName + "_path_" + t);
                    this.compiledGlyphs[t] = new Function("c", "size", i);
                }
                return this.compiledGlyphs[t];
            }
        };
        return t;
    }();
    var Mt = 10;
    var Nt = function Mi() {
        function e(e, t, i) {
            var n = e.style;
            n.fontSize = t.fontSize + "px";
            n.direction = t.fontDirection < 0 ? "rtl" : "ltr";
            if (!i) {
                return;
            }
            n.fontWeight = i.black ? i.bold ? "bolder" : "bold" : i.bold ? "bold" : "normal";
            n.fontStyle = i.italic ? "italic" : "normal";
            var r = i.loadedName;
            var a = r ? '"' + r + '", ' : "";
            var o = i.fallbackName || "Helvetica, sans-serif";
            n.fontFamily = a + o;
        }
        function t(e, t) {
            var i = document.createElement("section");
            var n = i.style;
            var r = e.rect[2] - e.rect[0];
            var a = e.rect[3] - e.rect[1];
            var o = e.borderWidth || 0;
            if (o) {
                r = r - 2 * o;
                a = a - 2 * o;
                n.borderWidth = o + "px";
                var s = e.color;
                if (t && s) {
                    n.borderStyle = "solid";
                    n.borderColor = j.makeCssRgb(Math.round(s[0] * 255), Math.round(s[1] * 255), Math.round(s[2] * 255));
                }
            }
            n.width = r + "px";
            n.height = a + "px";
            return i;
        }
        function i(t, i) {
            var n = document.createElement("div");
            var r = t.rect[2] - t.rect[0];
            var a = t.rect[3] - t.rect[1];
            n.style.width = r + "px";
            n.style.height = a + "px";
            n.style.display = "table";
            var o = document.createElement("div");
            o.textContent = t.fieldValue;
            var s = t.textAlignment;
            o.style.textAlign = [ "left", "center", "right" ][s];
            o.style.verticalAlign = "middle";
            o.style.display = "table-cell";
            var l = t.fontRefName ? i.getData(t.fontRefName) : null;
            e(o, t, l);
            n.appendChild(o);
            return n;
        }
        function n(e) {
            var i = e.rect;
            if (i[3] - i[1] < Mt) {
                i[3] = i[1] + Mt;
            }
            if (i[2] - i[0] < Mt) {
                i[2] = i[0] + (i[3] - i[1]);
            }
            var n = t(e, false);
            n.className = "annotText";
            var r = document.createElement("img");
            r.style.height = n.style.height;
            r.style.width = n.style.width;
            var a = e.name;
            r.src = PDFJS.imageResourcesPath + "annotation-" + a.toLowerCase() + ".svg";
            r.alt = "[{{type}} Annotation]";
            r.dataset.l10nId = "text_annotation_type";
            r.dataset.l10nArgs = JSON.stringify({
                type: a
            });
            var o = document.createElement("div");
            o.className = "annotTextContentWrapper";
            o.style.left = Math.floor(i[2] - i[0] + 5) + "px";
            o.style.top = "-10px";
            var s = document.createElement("div");
            s.className = "annotTextContent";
            s.setAttribute("hidden", true);
            var l, c;
            if (e.hasBgColor) {
                var u = e.color;
                var f = .7;
                var d = f * (1 - u[0]) + u[0];
                var h = f * (1 - u[1]) + u[1];
                var p = f * (1 - u[2]) + u[2];
                s.style.backgroundColor = j.makeCssRgb(d * 255 | 0, h * 255 | 0, p * 255 | 0);
            }
            var g = document.createElement("h1");
            var m = document.createElement("p");
            g.textContent = e.title;
            if (!e.content && !e.title) {
                s.setAttribute("hidden", true);
            } else {
                var v = document.createElement("span");
                var y = e.content.split(/(?:\r\n?|\n)/);
                for (l = 0, c = y.length; l < c; ++l) {
                    var b = y[l];
                    v.appendChild(document.createTextNode(b));
                    if (l < c - 1) {
                        v.appendChild(document.createElement("br"));
                    }
                }
                m.appendChild(v);
                var w = false;
                var C = function S(e) {
                    if (e) {
                        w = true;
                    }
                    if (s.hasAttribute("hidden")) {
                        n.style.zIndex += 1;
                        s.removeAttribute("hidden");
                    }
                };
                var x = function k(e) {
                    if (e) {
                        w = false;
                    }
                    if (!s.hasAttribute("hidden") && !w) {
                        n.style.zIndex -= 1;
                        s.setAttribute("hidden", true);
                    }
                };
                var _ = function A() {
                    if (w) {
                        x(true);
                    } else {
                        C(true);
                    }
                };
                r.addEventListener("click", function E() {
                    _();
                }, false);
                r.addEventListener("mouseover", function T() {
                    C();
                }, false);
                r.addEventListener("mouseout", function P() {
                    x();
                }, false);
                s.addEventListener("click", function I() {
                    x(true);
                }, false);
            }
            s.appendChild(g);
            s.appendChild(m);
            o.appendChild(s);
            n.appendChild(r);
            n.appendChild(o);
            return n;
        }
        function r(e) {
            var i = t(e, true);
            i.className = "annotLink";
            var n = document.createElement("a");
            n.href = n.title = e.url || "";
            if (e.url && PDFJS.openExternalLinksInNewWindow) {
                n.target = "_blank";
            }
            i.appendChild(n);
            return i;
        }
        function o(e, t) {
            switch (e.annotationType) {
              case a.WIDGET:
                return i(e, t);

              case a.TEXT:
                return n(e);

              case a.LINK:
                return r(e);

              default:
                throw new Error("Unsupported annotationType: " + e.annotationType);
            }
        }
        return {
            getHtmlElement: o
        };
    }();
    PDFJS.AnnotationUtils = Nt;
    var Bt = {
        fontStyle: "normal",
        fontWeight: "normal",
        fillColor: "#000000"
    };
    var jt = function Ni() {
        var e = new Uint8Array([ 137, 80, 78, 71, 13, 10, 26, 10 ]);
        var t = 12;
        var i = new Int32Array(256);
        for (var n = 0; n < 256; n++) {
            var a = n;
            for (var o = 0; o < 8; o++) {
                if (a & 1) {
                    a = 3988292384 ^ a >> 1 & 2147483647;
                } else {
                    a = a >> 1 & 2147483647;
                }
            }
            i[n] = a;
        }
        function s(e, t, n) {
            var r = -1;
            for (var a = t; a < n; a++) {
                var o = (r ^ e[a]) & 255;
                var s = i[o];
                r = r >>> 8 ^ s;
            }
            return r ^ -1;
        }
        function l(e, t, i, n) {
            var r = n;
            var a = t.length;
            i[r] = a >> 24 & 255;
            i[r + 1] = a >> 16 & 255;
            i[r + 2] = a >> 8 & 255;
            i[r + 3] = a & 255;
            r += 4;
            i[r] = e.charCodeAt(0) & 255;
            i[r + 1] = e.charCodeAt(1) & 255;
            i[r + 2] = e.charCodeAt(2) & 255;
            i[r + 3] = e.charCodeAt(3) & 255;
            r += 4;
            i.set(t, r);
            r += t.length;
            var o = s(i, n + 4, r);
            i[r] = o >> 24 & 255;
            i[r + 1] = o >> 16 & 255;
            i[r + 2] = o >> 8 & 255;
            i[r + 3] = o & 255;
        }
        function c(e, t, i) {
            var n = 1;
            var r = 0;
            for (var a = t; a < i; ++a) {
                n = (n + (e[a] & 255)) % 65521;
                r = (r + n) % 65521;
            }
            return r << 16 | n;
        }
        function u(i, n) {
            var a = i.width;
            var o = i.height;
            var s, u, f;
            var d = i.data;
            switch (n) {
              case r.GRAYSCALE_1BPP:
                u = 0;
                s = 1;
                f = a + 7 >> 3;
                break;

              case r.RGB_24BPP:
                u = 2;
                s = 8;
                f = a * 3;
                break;

              case r.RGBA_32BPP:
                u = 6;
                s = 8;
                f = a * 4;
                break;

              default:
                throw new Error("invalid format");
            }
            var h = new Uint8Array((1 + f) * o);
            var p = 0, g = 0;
            var m, v;
            for (m = 0; m < o; ++m) {
                h[p++] = 0;
                h.set(d.subarray(g, g + f), p);
                g += f;
                p += f;
            }
            if (n === r.GRAYSCALE_1BPP) {
                p = 0;
                for (m = 0; m < o; m++) {
                    p++;
                    for (v = 0; v < f; v++) {
                        h[p++] ^= 255;
                    }
                }
            }
            var y = new Uint8Array([ a >> 24 & 255, a >> 16 & 255, a >> 8 & 255, a & 255, o >> 24 & 255, o >> 16 & 255, o >> 8 & 255, o & 255, s, u, 0, 0, 0 ]);
            var b = h.length;
            var w = 65535;
            var C = Math.ceil(b / w);
            var x = new Uint8Array(2 + b + C * 5 + 4);
            var _ = 0;
            x[_++] = 120;
            x[_++] = 156;
            var S = 0;
            while (b > w) {
                x[_++] = 0;
                x[_++] = 255;
                x[_++] = 255;
                x[_++] = 0;
                x[_++] = 0;
                x.set(h.subarray(S, S + w), _);
                _ += w;
                S += w;
                b -= w;
            }
            x[_++] = 1;
            x[_++] = b & 255;
            x[_++] = b >> 8 & 255;
            x[_++] = ~b & 65535 & 255;
            x[_++] = (~b & 65535) >> 8 & 255;
            x.set(h.subarray(S), _);
            _ += h.length - S;
            var k = c(h, 0, h.length);
            x[_++] = k >> 24 & 255;
            x[_++] = k >> 16 & 255;
            x[_++] = k >> 8 & 255;
            x[_++] = k & 255;
            var A = e.length + t * 3 + y.length + x.length;
            var E = new Uint8Array(A);
            var T = 0;
            E.set(e, T);
            T += e.length;
            l("IHDR", y, E, T);
            T += t + y.length;
            l("IDATA", x, E, T);
            T += t + x.length;
            l("IEND", new Uint8Array(0), E, T);
            return PDFJS.createObjectURL(E, "image/png");
        }
        return function f(e) {
            var t = e.kind === undefined ? r.GRAYSCALE_1BPP : e.kind;
            return u(e, t);
        };
    }();
    var Ut = function Bi() {
        function e() {
            this.fontSizeScale = 1;
            this.fontWeight = Bt.fontWeight;
            this.fontSize = 0;
            this.textMatrix = B;
            this.fontMatrix = i;
            this.leading = 0;
            this.x = 0;
            this.y = 0;
            this.lineX = 0;
            this.lineY = 0;
            this.charSpacing = 0;
            this.wordSpacing = 0;
            this.textHScale = 1;
            this.textRise = 0;
            this.fillColor = Bt.fillColor;
            this.strokeColor = "#000000";
            this.fillAlpha = 1;
            this.strokeAlpha = 1;
            this.lineWidth = 1;
            this.lineJoin = "";
            this.lineCap = "";
            this.miterLimit = 0;
            this.dashArray = [];
            this.dashPhase = 0;
            this.dependencies = [];
            this.clipId = "";
            this.pendingClip = false;
            this.maskId = "";
        }
        e.prototype = {
            clone: function t() {
                return Object.create(this);
            },
            setCurrentPoint: function n(e, t) {
                this.x = e;
                this.y = t;
            }
        };
        return e;
    }();
    var zt = function ji() {
        function e(e, t) {
            var i = "http://www.w3.org/2000/svg";
            var n = document.createElementNS(i, "svg:svg");
            n.setAttributeNS(null, "version", "1.1");
            n.setAttributeNS(null, "width", e + "px");
            n.setAttributeNS(null, "height", t + "px");
            n.setAttributeNS(null, "viewBox", "0 0 " + e + " " + t);
            return n;
        }
        function t(e) {
            var t = [];
            var i = [];
            var n = e.length;
            for (var r = 0; r < n; r++) {
                if (e[r].fn === "save") {
                    t.push({
                        fnId: 92,
                        fn: "group",
                        items: []
                    });
                    i.push(t);
                    t = t[t.length - 1].items;
                    continue;
                }
                if (e[r].fn === "restore") {
                    t = i.pop();
                } else {
                    t.push(e[r]);
                }
            }
            return t;
        }
        function n(e) {
            if (e === (e | 0)) {
                return e.toString();
            }
            var t = e.toFixed(10);
            var i = t.length - 1;
            if (t[i] !== "0") {
                return t;
            }
            do {
                i--;
            } while (t[i] === "0");
            return t.substr(0, t[i] === "." ? i : i + 1);
        }
        function r(e) {
            if (e[4] === 0 && e[5] === 0) {
                if (e[1] === 0 && e[2] === 0) {
                    if (e[0] === 1 && e[3] === 1) {
                        return "";
                    }
                    return "scale(" + n(e[0]) + " " + n(e[3]) + ")";
                }
                if (e[0] === e[3] && e[1] === -e[2]) {
                    var t = Math.acos(e[0]) * 180 / Math.PI;
                    return "rotate(" + n(t) + ")";
                }
            } else {
                if (e[0] === 1 && e[1] === 0 && e[2] === 0 && e[3] === 1) {
                    return "translate(" + n(e[4]) + " " + n(e[5]) + ")";
                }
            }
            return "matrix(" + n(e[0]) + " " + n(e[1]) + " " + n(e[2]) + " " + n(e[3]) + " " + n(e[4]) + " " + n(e[5]) + ")";
        }
        function a(e, t) {
            this.current = new Ut();
            this.transformMatrix = B;
            this.transformStack = [];
            this.extraStack = [];
            this.commonObjs = e;
            this.objs = t;
            this.pendingEOFill = false;
            this.embedFonts = false;
            this.embeddedFonts = {};
            this.cssStyle = null;
        }
        var o = "http://www.w3.org/2000/svg";
        var s = "http://www.w3.org/XML/1998/namespace";
        var c = "http://www.w3.org/1999/xlink";
        var f = [ "butt", "round", "square" ];
        var d = [ "miter", "round", "bevel" ];
        var h = 0;
        var p = 0;
        a.prototype = {
            save: function g() {
                this.transformStack.push(this.transformMatrix);
                var e = this.current;
                this.extraStack.push(e);
                this.current = e.clone();
            },
            restore: function m() {
                this.transformMatrix = this.transformStack.pop();
                this.current = this.extraStack.pop();
                this.tgrp = document.createElementNS(o, "svg:g");
                this.tgrp.setAttributeNS(null, "transform", r(this.transformMatrix));
                this.pgrp.appendChild(this.tgrp);
            },
            group: function v(e) {
                this.save();
                this.executeOpTree(e);
                this.restore();
            },
            loadDependencies: function y(e) {
                var t = e.fnArray;
                var i = t.length;
                var n = e.argsArray;
                var r = this;
                for (var a = 0; a < i; a++) {
                    if (l.dependency === t[a]) {
                        var o = n[a];
                        for (var s = 0, c = o.length; s < c; s++) {
                            var u = o[s];
                            var f = u.substring(0, 2) === "g_";
                            var d;
                            if (f) {
                                d = new Promise(function(e) {
                                    r.commonObjs.get(u, e);
                                });
                            } else {
                                d = new Promise(function(e) {
                                    r.objs.get(u, e);
                                });
                            }
                            this.current.dependencies.push(d);
                        }
                    }
                }
                return Promise.all(this.current.dependencies);
            },
            transform: function b(e, t, i, n, a, s) {
                var l = [ e, t, i, n, a, s ];
                this.transformMatrix = PDFJS.Util.transform(this.transformMatrix, l);
                this.tgrp = document.createElementNS(o, "svg:g");
                this.tgrp.setAttributeNS(null, "transform", r(this.transformMatrix));
            },
            getSVG: function w(t, i) {
                this.svg = e(i.width, i.height);
                this.viewport = i;
                return this.loadDependencies(t).then(function() {
                    this.transformMatrix = B;
                    this.pgrp = document.createElementNS(o, "svg:g");
                    this.pgrp.setAttributeNS(null, "transform", r(i.transform));
                    this.tgrp = document.createElementNS(o, "svg:g");
                    this.tgrp.setAttributeNS(null, "transform", r(this.transformMatrix));
                    this.defs = document.createElementNS(o, "svg:defs");
                    this.pgrp.appendChild(this.defs);
                    this.pgrp.appendChild(this.tgrp);
                    this.svg.appendChild(this.pgrp);
                    var e = this.convertOpList(t);
                    this.executeOpTree(e);
                    return this.svg;
                }.bind(this));
            },
            convertOpList: function C(e) {
                var i = e.argsArray;
                var n = e.fnArray;
                var r = n.length;
                var a = [];
                var o = [];
                for (var s in l) {
                    a[l[s]] = s;
                }
                for (var c = 0; c < r; c++) {
                    var u = n[c];
                    o.push({
                        fnId: u,
                        fn: a[u],
                        args: i[c]
                    });
                }
                return t(o);
            },
            executeOpTree: function x(e) {
                var t = e.length;
                for (var i = 0; i < t; i++) {
                    var n = e[i].fn;
                    var r = e[i].fnId;
                    var a = e[i].args;
                    switch (r | 0) {
                      case l.beginText:
                        this.beginText();
                        break;

                      case l.setLeading:
                        this.setLeading(a);
                        break;

                      case l.setLeadingMoveText:
                        this.setLeadingMoveText(a[0], a[1]);
                        break;

                      case l.setFont:
                        this.setFont(a);
                        break;

                      case l.showText:
                        this.showText(a[0]);
                        break;

                      case l.showSpacedText:
                        this.showText(a[0]);
                        break;

                      case l.endText:
                        this.endText();
                        break;

                      case l.moveText:
                        this.moveText(a[0], a[1]);
                        break;

                      case l.setCharSpacing:
                        this.setCharSpacing(a[0]);
                        break;

                      case l.setWordSpacing:
                        this.setWordSpacing(a[0]);
                        break;

                      case l.setHScale:
                        this.setHScale(a[0]);
                        break;

                      case l.setTextMatrix:
                        this.setTextMatrix(a[0], a[1], a[2], a[3], a[4], a[5]);
                        break;

                      case l.setLineWidth:
                        this.setLineWidth(a[0]);
                        break;

                      case l.setLineJoin:
                        this.setLineJoin(a[0]);
                        break;

                      case l.setLineCap:
                        this.setLineCap(a[0]);
                        break;

                      case l.setMiterLimit:
                        this.setMiterLimit(a[0]);
                        break;

                      case l.setFillRGBColor:
                        this.setFillRGBColor(a[0], a[1], a[2]);
                        break;

                      case l.setStrokeRGBColor:
                        this.setStrokeRGBColor(a[0], a[1], a[2]);
                        break;

                      case l.setDash:
                        this.setDash(a[0], a[1]);
                        break;

                      case l.setGState:
                        this.setGState(a[0]);
                        break;

                      case l.fill:
                        this.fill();
                        break;

                      case l.eoFill:
                        this.eoFill();
                        break;

                      case l.stroke:
                        this.stroke();
                        break;

                      case l.fillStroke:
                        this.fillStroke();
                        break;

                      case l.eoFillStroke:
                        this.eoFillStroke();
                        break;

                      case l.clip:
                        this.clip("nonzero");
                        break;

                      case l.eoClip:
                        this.clip("evenodd");
                        break;

                      case l.paintSolidColorImageMask:
                        this.paintSolidColorImageMask();
                        break;

                      case l.paintJpegXObject:
                        this.paintJpegXObject(a[0], a[1], a[2]);
                        break;

                      case l.paintImageXObject:
                        this.paintImageXObject(a[0]);
                        break;

                      case l.paintInlineImageXObject:
                        this.paintInlineImageXObject(a[0]);
                        break;

                      case l.paintImageMaskXObject:
                        this.paintImageMaskXObject(a[0]);
                        break;

                      case l.paintFormXObjectBegin:
                        this.paintFormXObjectBegin(a[0], a[1]);
                        break;

                      case l.paintFormXObjectEnd:
                        this.paintFormXObjectEnd();
                        break;

                      case l.closePath:
                        this.closePath();
                        break;

                      case l.closeStroke:
                        this.closeStroke();
                        break;

                      case l.closeFillStroke:
                        this.closeFillStroke();
                        break;

                      case l.nextLine:
                        this.nextLine();
                        break;

                      case l.transform:
                        this.transform(a[0], a[1], a[2], a[3], a[4], a[5]);
                        break;

                      case l.constructPath:
                        this.constructPath(a[0], a[1]);
                        break;

                      case l.endPath:
                        this.endPath();
                        break;

                      case 92:
                        this.group(e[i].items);
                        break;

                      default:
                        u("Unimplemented method " + n);
                        break;
                    }
                }
            },
            setWordSpacing: function _(e) {
                this.current.wordSpacing = e;
            },
            setCharSpacing: function S(e) {
                this.current.charSpacing = e;
            },
            nextLine: function k() {
                this.moveText(0, this.current.leading);
            },
            setTextMatrix: function A(e, t, i, r, a, s) {
                var l = this.current;
                this.current.textMatrix = this.current.lineMatrix = [ e, t, i, r, a, s ];
                this.current.x = this.current.lineX = 0;
                this.current.y = this.current.lineY = 0;
                l.xcoords = [];
                l.tspan = document.createElementNS(o, "svg:tspan");
                l.tspan.setAttributeNS(null, "font-family", l.fontFamily);
                l.tspan.setAttributeNS(null, "font-size", n(l.fontSize) + "px");
                l.tspan.setAttributeNS(null, "y", n(-l.y));
                l.txtElement = document.createElementNS(o, "svg:text");
                l.txtElement.appendChild(l.tspan);
            },
            beginText: function E() {
                this.current.x = this.current.lineX = 0;
                this.current.y = this.current.lineY = 0;
                this.current.textMatrix = B;
                this.current.lineMatrix = B;
                this.current.tspan = document.createElementNS(o, "svg:tspan");
                this.current.txtElement = document.createElementNS(o, "svg:text");
                this.current.txtgrp = document.createElementNS(o, "svg:g");
                this.current.xcoords = [];
            },
            moveText: function T(e, t) {
                var i = this.current;
                this.current.x = this.current.lineX += e;
                this.current.y = this.current.lineY += t;
                i.xcoords = [];
                i.tspan = document.createElementNS(o, "svg:tspan");
                i.tspan.setAttributeNS(null, "font-family", i.fontFamily);
                i.tspan.setAttributeNS(null, "font-size", n(i.fontSize) + "px");
                i.tspan.setAttributeNS(null, "y", n(-i.y));
            },
            showText: function P(e) {
                var t = this.current;
                var i = t.font;
                var a = t.fontSize;
                if (a === 0) {
                    return;
                }
                var o = t.charSpacing;
                var l = t.wordSpacing;
                var c = t.fontDirection;
                var u = t.textHScale * c;
                var f = e.length;
                var d = i.vertical;
                var h = a * t.fontMatrix[0];
                var p = 0, g;
                for (g = 0; g < f; ++g) {
                    var m = e[g];
                    if (m === null) {
                        p += c * l;
                        continue;
                    } else if (Y(m)) {
                        p += -m * a * .001;
                        continue;
                    }
                    t.xcoords.push(t.x + p * u);
                    var v = m.width;
                    var y = m.fontChar;
                    var b = v * h + o * c;
                    p += b;
                    t.tspan.textContent += y;
                }
                if (d) {
                    t.y -= p * u;
                } else {
                    t.x += p * u;
                }
                t.tspan.setAttributeNS(null, "x", t.xcoords.map(n).join(" "));
                t.tspan.setAttributeNS(null, "y", n(-t.y));
                t.tspan.setAttributeNS(null, "font-family", t.fontFamily);
                t.tspan.setAttributeNS(null, "font-size", n(t.fontSize) + "px");
                if (t.fontStyle !== Bt.fontStyle) {
                    t.tspan.setAttributeNS(null, "font-style", t.fontStyle);
                }
                if (t.fontWeight !== Bt.fontWeight) {
                    t.tspan.setAttributeNS(null, "font-weight", t.fontWeight);
                }
                if (t.fillColor !== Bt.fillColor) {
                    t.tspan.setAttributeNS(null, "fill", t.fillColor);
                }
                t.txtElement.setAttributeNS(null, "transform", r(t.textMatrix) + " scale(1, -1)");
                t.txtElement.setAttributeNS(s, "xml:space", "preserve");
                t.txtElement.appendChild(t.tspan);
                t.txtgrp.appendChild(t.txtElement);
                this.tgrp.appendChild(t.txtElement);
            },
            setLeadingMoveText: function I(e, t) {
                this.setLeading(-t);
                this.moveText(e, t);
            },
            addFontStyle: function O(e) {
                if (!this.cssStyle) {
                    this.cssStyle = document.createElementNS(o, "svg:style");
                    this.cssStyle.setAttributeNS(null, "type", "text/css");
                    this.defs.appendChild(this.cssStyle);
                }
                var t = PDFJS.createObjectURL(e.data, e.mimetype);
                this.cssStyle.textContent += '@font-face { font-family: "' + e.loadedName + '";' + " src: url(" + t + "); }\n";
            },
            setFont: function D(e) {
                var t = this.current;
                var r = this.commonObjs.get(e[0]);
                var a = e[1];
                this.current.font = r;
                if (this.embedFonts && r.data && !this.embeddedFonts[r.loadedName]) {
                    this.addFontStyle(r);
                    this.embeddedFonts[r.loadedName] = r;
                }
                t.fontMatrix = r.fontMatrix ? r.fontMatrix : i;
                var s = r.black ? r.bold ? "bolder" : "bold" : r.bold ? "bold" : "normal";
                var l = r.italic ? "italic" : "normal";
                if (a < 0) {
                    a = -a;
                    t.fontDirection = -1;
                } else {
                    t.fontDirection = 1;
                }
                t.fontSize = a;
                t.fontFamily = r.loadedName;
                t.fontWeight = s;
                t.fontStyle = l;
                t.tspan = document.createElementNS(o, "svg:tspan");
                t.tspan.setAttributeNS(null, "y", n(-t.y));
                t.xcoords = [];
            },
            endText: function R() {
                if (this.current.pendingClip) {
                    this.cgrp.appendChild(this.tgrp);
                    this.pgrp.appendChild(this.cgrp);
                } else {
                    this.pgrp.appendChild(this.tgrp);
                }
                this.tgrp = document.createElementNS(o, "svg:g");
                this.tgrp.setAttributeNS(null, "transform", r(this.transformMatrix));
            },
            setLineWidth: function L(e) {
                this.current.lineWidth = e;
            },
            setLineCap: function F(e) {
                this.current.lineCap = f[e];
            },
            setLineJoin: function M(e) {
                this.current.lineJoin = d[e];
            },
            setMiterLimit: function N(e) {
                this.current.miterLimit = e;
            },
            setStrokeRGBColor: function U(e, t, i) {
                var n = j.makeCssRgb(e, t, i);
                this.current.strokeColor = n;
            },
            setFillRGBColor: function z(e, t, i) {
                var n = j.makeCssRgb(e, t, i);
                this.current.fillColor = n;
                this.current.tspan = document.createElementNS(o, "svg:tspan");
                this.current.xcoords = [];
            },
            setDash: function q(e, t) {
                this.current.dashArray = e;
                this.current.dashPhase = t;
            },
            constructPath: function W(e, t) {
                var i = this.current;
                var r = i.x, a = i.y;
                i.path = document.createElementNS(o, "svg:path");
                var s = [];
                var c = e.length;
                for (var u = 0, f = 0; u < c; u++) {
                    switch (e[u] | 0) {
                      case l.rectangle:
                        r = t[f++];
                        a = t[f++];
                        var d = t[f++];
                        var h = t[f++];
                        var p = r + d;
                        var g = a + h;
                        s.push("M", n(r), n(a), "L", n(p), n(a), "L", n(p), n(g), "L", n(r), n(g), "Z");
                        break;

                      case l.moveTo:
                        r = t[f++];
                        a = t[f++];
                        s.push("M", n(r), n(a));
                        break;

                      case l.lineTo:
                        r = t[f++];
                        a = t[f++];
                        s.push("L", n(r), n(a));
                        break;

                      case l.curveTo:
                        r = t[f + 4];
                        a = t[f + 5];
                        s.push("C", n(t[f]), n(t[f + 1]), n(t[f + 2]), n(t[f + 3]), n(r), n(a));
                        f += 6;
                        break;

                      case l.curveTo2:
                        r = t[f + 2];
                        a = t[f + 3];
                        s.push("C", n(r), n(a), n(t[f]), n(t[f + 1]), n(t[f + 2]), n(t[f + 3]));
                        f += 4;
                        break;

                      case l.curveTo3:
                        r = t[f + 2];
                        a = t[f + 3];
                        s.push("C", n(t[f]), n(t[f + 1]), n(r), n(a), n(r), n(a));
                        f += 4;
                        break;

                      case l.closePath:
                        s.push("Z");
                        break;
                    }
                }
                i.path.setAttributeNS(null, "d", s.join(" "));
                i.path.setAttributeNS(null, "stroke-miterlimit", n(i.miterLimit));
                i.path.setAttributeNS(null, "stroke-linecap", i.lineCap);
                i.path.setAttributeNS(null, "stroke-linejoin", i.lineJoin);
                i.path.setAttributeNS(null, "stroke-width", n(i.lineWidth) + "px");
                i.path.setAttributeNS(null, "stroke-dasharray", i.dashArray.map(n).join(" "));
                i.path.setAttributeNS(null, "stroke-dashoffset", n(i.dashPhase) + "px");
                i.path.setAttributeNS(null, "fill", "none");
                this.tgrp.appendChild(i.path);
                if (i.pendingClip) {
                    this.cgrp.appendChild(this.tgrp);
                    this.pgrp.appendChild(this.cgrp);
                } else {
                    this.pgrp.appendChild(this.tgrp);
                }
                i.element = i.path;
                i.setCurrentPoint(r, a);
            },
            endPath: function H() {
                var e = this.current;
                if (e.pendingClip) {
                    this.cgrp.appendChild(this.tgrp);
                    this.pgrp.appendChild(this.cgrp);
                } else {
                    this.pgrp.appendChild(this.tgrp);
                }
                this.tgrp = document.createElementNS(o, "svg:g");
                this.tgrp.setAttributeNS(null, "transform", r(this.transformMatrix));
            },
            clip: function G(e) {
                var t = this.current;
                t.clipId = "clippath" + h;
                h++;
                this.clippath = document.createElementNS(o, "svg:clipPath");
                this.clippath.setAttributeNS(null, "id", t.clipId);
                var i = t.element.cloneNode();
                if (e === "evenodd") {
                    i.setAttributeNS(null, "clip-rule", "evenodd");
                } else {
                    i.setAttributeNS(null, "clip-rule", "nonzero");
                }
                this.clippath.setAttributeNS(null, "transform", r(this.transformMatrix));
                this.clippath.appendChild(i);
                this.defs.appendChild(this.clippath);
                t.pendingClip = true;
                this.cgrp = document.createElementNS(o, "svg:g");
                this.cgrp.setAttributeNS(null, "clip-path", "url(#" + t.clipId + ")");
                this.pgrp.appendChild(this.cgrp);
            },
            closePath: function V() {
                var e = this.current;
                var t = e.path.getAttributeNS(null, "d");
                t += "Z";
                e.path.setAttributeNS(null, "d", t);
            },
            setLeading: function $(e) {
                this.current.leading = -e;
            },
            setTextRise: function X(e) {
                this.current.textRise = e;
            },
            setHScale: function J(e) {
                this.current.textHScale = e / 100;
            },
            setGState: function K(e) {
                for (var t = 0, i = e.length; t < i; t++) {
                    var n = e[t];
                    var r = n[0];
                    var a = n[1];
                    switch (r) {
                      case "LW":
                        this.setLineWidth(a);
                        break;

                      case "LC":
                        this.setLineCap(a);
                        break;

                      case "LJ":
                        this.setLineJoin(a);
                        break;

                      case "ML":
                        this.setMiterLimit(a);
                        break;

                      case "D":
                        this.setDash(a[0], a[1]);
                        break;

                      case "RI":
                        break;

                      case "FL":
                        break;

                      case "Font":
                        this.setFont(a);
                        break;

                      case "CA":
                        break;

                      case "ca":
                        break;

                      case "BM":
                        break;

                      case "SMask":
                        break;
                    }
                }
            },
            fill: function Q() {
                var e = this.current;
                e.element.setAttributeNS(null, "fill", e.fillColor);
            },
            stroke: function et() {
                var e = this.current;
                e.element.setAttributeNS(null, "stroke", e.strokeColor);
                e.element.setAttributeNS(null, "fill", "none");
            },
            eoFill: function tt() {
                var e = this.current;
                e.element.setAttributeNS(null, "fill", e.fillColor);
                e.element.setAttributeNS(null, "fill-rule", "evenodd");
            },
            fillStroke: function it() {
                this.stroke();
                this.fill();
            },
            eoFillStroke: function nt() {
                this.current.element.setAttributeNS(null, "fill-rule", "evenodd");
                this.fillStroke();
            },
            closeStroke: function rt() {
                this.closePath();
                this.stroke();
            },
            closeFillStroke: function at() {
                this.closePath();
                this.fillStroke();
            },
            paintSolidColorImageMask: function ot() {
                var e = this.current;
                var t = document.createElementNS(o, "svg:rect");
                t.setAttributeNS(null, "x", "0");
                t.setAttributeNS(null, "y", "0");
                t.setAttributeNS(null, "width", "1px");
                t.setAttributeNS(null, "height", "1px");
                t.setAttributeNS(null, "fill", e.fillColor);
                this.tgrp.appendChild(t);
            },
            paintJpegXObject: function st(e, t, i) {
                var r = this.current;
                var a = this.objs.get(e);
                var s = document.createElementNS(o, "svg:image");
                s.setAttributeNS(c, "xlink:href", a.src);
                s.setAttributeNS(null, "width", a.width + "px");
                s.setAttributeNS(null, "height", a.height + "px");
                s.setAttributeNS(null, "x", "0");
                s.setAttributeNS(null, "y", n(-i));
                s.setAttributeNS(null, "transform", "scale(" + n(1 / t) + " " + n(-1 / i) + ")");
                this.tgrp.appendChild(s);
                if (r.pendingClip) {
                    this.cgrp.appendChild(this.tgrp);
                    this.pgrp.appendChild(this.cgrp);
                } else {
                    this.pgrp.appendChild(this.tgrp);
                }
            },
            paintImageXObject: function lt(e) {
                var t = this.objs.get(e);
                if (!t) {
                    u("Dependent image isn't ready yet");
                    return;
                }
                this.paintInlineImageXObject(t);
            },
            paintInlineImageXObject: function ct(e, t) {
                var i = this.current;
                var r = e.width;
                var a = e.height;
                var s = jt(e);
                var l = document.createElementNS(o, "svg:rect");
                l.setAttributeNS(null, "x", "0");
                l.setAttributeNS(null, "y", "0");
                l.setAttributeNS(null, "width", n(r));
                l.setAttributeNS(null, "height", n(a));
                i.element = l;
                this.clip("nonzero");
                var u = document.createElementNS(o, "svg:image");
                u.setAttributeNS(c, "xlink:href", s);
                u.setAttributeNS(null, "x", "0");
                u.setAttributeNS(null, "y", n(-a));
                u.setAttributeNS(null, "width", n(r) + "px");
                u.setAttributeNS(null, "height", n(a) + "px");
                u.setAttributeNS(null, "transform", "scale(" + n(1 / r) + " " + n(-1 / a) + ")");
                if (t) {
                    t.appendChild(u);
                } else {
                    this.tgrp.appendChild(u);
                }
                if (i.pendingClip) {
                    this.cgrp.appendChild(this.tgrp);
                    this.pgrp.appendChild(this.cgrp);
                } else {
                    this.pgrp.appendChild(this.tgrp);
                }
            },
            paintImageMaskXObject: function ut(e) {
                var t = this.current;
                var i = e.width;
                var r = e.height;
                var a = t.fillColor;
                t.maskId = "mask" + p++;
                var s = document.createElementNS(o, "svg:mask");
                s.setAttributeNS(null, "id", t.maskId);
                var l = document.createElementNS(o, "svg:rect");
                l.setAttributeNS(null, "x", "0");
                l.setAttributeNS(null, "y", "0");
                l.setAttributeNS(null, "width", n(i));
                l.setAttributeNS(null, "height", n(r));
                l.setAttributeNS(null, "fill", a);
                l.setAttributeNS(null, "mask", "url(#" + t.maskId + ")");
                this.defs.appendChild(s);
                this.tgrp.appendChild(l);
                this.paintInlineImageXObject(e, s);
            },
            paintFormXObjectBegin: function ft(e, t) {
                this.save();
                if (Z(e) && e.length === 6) {
                    this.transform(e[0], e[1], e[2], e[3], e[4], e[5]);
                }
                if (Z(t) && t.length === 4) {
                    var i = t[2] - t[0];
                    var r = t[3] - t[1];
                    var a = document.createElementNS(o, "svg:rect");
                    a.setAttributeNS(null, "x", t[0]);
                    a.setAttributeNS(null, "y", t[1]);
                    a.setAttributeNS(null, "width", n(i));
                    a.setAttributeNS(null, "height", n(r));
                    this.current.element = a;
                    this.clip("nonzero");
                    this.endPath();
                }
            },
            paintFormXObjectEnd: function dt() {
                this.restore();
            }
        };
        return a;
    }();
    PDFJS.SVGGraphics = zt;
}).call(typeof window === "undefined" ? this : window);

if (!PDFJS.workerSrc && typeof document !== "undefined") {
    PDFJS.workerSrc = function() {
        var e = document.body || document.getElementsByTagName("head")[0];
        var t = e.lastChild.src;
        return t && t.replace(/\.js$/i, ".worker.js");
    }();
}

define("PDFJS", function(e) {
    return function() {
        var t, i;
        return t || e.PDFJS;
    };
}(this));

require.config({
    i18n: {
        nls: "localization"
    },
    packages: [ {
        name: "Widget",
        location: "./assets/js/ui/",
        main: "index.raw.js"
    }, {
        name: "IFDParsers",
        location: "./assets/js/decoders/",
        main: "parsers.js"
    }, {
        name: "Spinner",
        location: "./assets/js/components/spinner/",
        main: "index.js"
    }, {
        name: "MetadataComponent",
        location: "./assets/js/components/metadata/",
        main: "index.js"
    }, {
        name: "ExposureCompensationComponent",
        location: "./assets/js/components/exposureCompensation/",
        main: "index.js"
    }, {
        name: "PaymentComponent",
        location: "./assets/js/components/payment/",
        main: "index.js"
    }, {
        name: "FacebookComponent",
        location: "./assets/js/components/facebook/",
        main: "index.js"
    }, {
        name: "RawCounter",
        location: "./assets/js/components/rawCounter/",
        main: "index.js"
    }, {
        name: "SocialSharing",
        location: "./assets/js/components/socialSharing/",
        main: "index.js"
    } ],
    paths: {
        converter: "assets/js/converter",
        localeConfigurator: "assets/js/localeConfigurator",
        jquery: "assets/js/lib/jquery/2.0.3/jquery.min",
        utils: "assets/js/shared/utils",
        underscore: "assets/js/lib/underscore.js/1.5.2/underscore-min",
        sugar: "assets/js/lib/sugar/1.3.9/sugar.min",
        backbone: "assets/js/lib/backbone.js/1.1.1/backbone",
        mustache: "assets/js/lib/mustache",
        backboneNested: "assets/js/lib/backbone-nested/1.1.2/backbone-nested",
        jqueryCookie: "assets/js/lib/jquery.cookie",
        canvas2image: "assets/js/lib/canvas2image",
        glMatrix: "assets/js/lib/gl-matrix",
        FileSaver: "assets/js/lib/FileSaver",
        Canvas2Blob: "assets/js/lib/Canvas2Blob",
        environment: "assets/js/environment",
        LoggingService: "assets/js/services/LoggingService",
        TrackingService: "assets/js/services/TrackingService",
        User: "assets/js/model/User",
        StorageService: "assets/js/services/StorageService",
        TrackJS: "assets/js/lib/tracker",
        PageService: "assets/js/services/PageService",
        extensions: "assets/js/shared/extensions",
        Parallel: "assets/js/lib/parallel",
        jpg: "assets/js/shared/jpg",
        dngcolor: "assets/js/shared/dngcolor",
        deferred: "assets/js/shared/deferred",
        cameradata: "assets/js/shared/camera.data",
        ImageDescriptor: "assets/js/model/ImageDescriptor",
        ImportImageDescriptor: "assets/js/components/import/models/ImportImageDescriptor",
        RawImageDescriptor: "assets/js/model/RawImageDescriptor",
        RawPdfImageDescriptor: "assets/js/model/RawPdfImageDescriptor",
        WorkingList: "assets/js/picsio-raw/workingList",
        ImportList: "assets/js/model/ImportList",
        DNGColor: "assets/js/decoders/DNGColor",
        DNGColorSpace: "assets/js/decoders/DNGColorSpace",
        DNGTemperature: "assets/js/decoders/DNGTemperature",
        DNGMatrix: "assets/js/decoders/DNGMatrix",
        DNGTable: "assets/js/decoders/DNGTable",
        DNGDecoder: "assets/js/decoders/DNGDecoder",
        CR2Decoder: "assets/js/decoders/CR2Decoder",
        NEFDecoder: "assets/js/decoders/NEFDecoder",
        BitPumpJpeg: "assets/js/decoders/BitPumpJpeg",
        BitPumpMSB: "assets/js/decoders/BitPumpMSB",
        LJpegDecompressor: "assets/js/decoders/LJpegDecompressor",
        NEFJpegDecompressor: "assets/js/decoders/NEFJpegDecompressor",
        BaseStorage: "assets/js/storage/BaseStorage",
        FileSystemStorage: "assets/js/storage/FileSystemStorage",
        RetryHandler: "assets/js/storage/RetryHandler",
        GDriveUploader: "assets/js/storage/GDriveUploader",
        GDriveStorage: "assets/js/storage/GDriveStorage",
        FakeStorage: "assets/js/storage/FakeStorage",
        MetadataService: "assets/js/services/MetadataService",
        ThumbnailService: "assets/js/services/ThumbnailService",
        DecodeService: "assets/js/services/DecodeService",
        LambdaDecodeService: "assets/js/services/LambdaDecodeService",
        PaletteService: "assets/js/services/PaletteService",
        FiltersService: "assets/js/services/FiltersService",
        Deferred: "assets/js/shared/deferred",
        S3Uploader: "assets/js/shared/s3-uploader",
        config: "assets/js/picsio-edit/src/core/configuration",
        contextPrototype: "assets/js/picsio-edit/src/lib/context.prototype",
        histogram: "assets/js/picsio-edit/src/lib/histogram",
        colorSpace: "assets/js/picsio-edit/src/lib/colorSpace",
        signal: "assets/js/picsio-edit/src/mediator/signal",
        undoManager: "assets/js/picsio-edit/src/core/undoManager",
        canvas: "assets/js/picsio-edit/src/core/canvas",
        slicer: "assets/js/picsio-edit/src/core/slicer",
        rgba: "assets/js/picsio-edit/src/core/rgba",
        less: "assets/js/lib/less/less.min",
        pluginManager: "assets/js/picsio-edit/src/core/pluginManager",
        ui: "assets/js/ui/ui",
        uiObject: "assets/js/ui/uiObject",
        editor: "assets/js/picsio-edit/src/core/editor",
        picsEdit: "assets/js/picsio-edit/src/core/picsEdit",
        taskManager: "assets/js/picsio-edit/src/core/taskManager",
        slicedImage: "assets/js/picsio-edit/src/core/slicedImage",
        imageSlices: "assets/js/picsio-edit/src/core/imageSlices",
        resizeImage: "assets/js/picsio-edit/src/core/resizeImage",
        indexeddb: "assets/js/picsio-edit/src/lib/indexeddb",
        cornerMatrix: "assets/js/picsio-edit/src/core/helpers/cornerMatrix",
        analitics: "assets/js/picsio-edit/src/services/TrackingService",
        QueueService: "assets/js/services/QueueService",
        pluginContrast: "assets/js/picsio-edit/src/plugins/contrast/plugin",
        pluginCrop: "assets/js/picsio-edit/src/plugins/crop/plugin",
        pluginCurves: "assets/js/picsio-edit/src/plugins/curves/plugin",
        pluginEmpty: "assets/js/picsio-edit/src/plugins/empty/plugin",
        pluginInvert: "assets/js/picsio-edit/src/plugins/invert/plugin",
        pluginSaturation: "assets/js/picsio-edit/src/plugins/saturation/plugin",
        pluginSaver: "assets/js/picsio-edit/src/plugins/saver/plugin",
        pluginSepia: "assets/js/picsio-edit/src/plugins/sepia/plugin",
        pluginUndo: "assets/js/picsio-edit/src/plugins/undo/plugin",
        pluginColorPicker: "assets/js/picsio-edit/src/plugins/colorpicker/plugin",
        pluginBrightness: "assets/js/picsio-edit/src/plugins/brightness/plugin",
        pluginGrayscale: "assets/js/picsio-edit/src/plugins/grayscale/plugin",
        pluginTemperature: "assets/js/picsio-edit/src/plugins/temperature/plugin",
        pluginTransform: "assets/js/picsio-edit/src/plugins/transform/plugin",
        pluginHsl: "assets/js/picsio-edit/src/plugins/hsl/plugin",
        pluginOpenFile: "assets/js/picsio-edit/src/plugins/openFile/plugin",
        pluginAbout: "assets/js/picsio-edit/src/plugins/about/plugin",
        pluginFullscreen: "assets/js/picsio-edit/src/plugins/fullscreen/plugin",
        pluginExternalCaller: "assets/js/picsio-edit/src/plugins/externalCaller/plugin",
        pluginRedEyes: "assets/js/picsio-edit/src/plugins/redEyes/plugin",
        pluginShortcuts: "assets/js/picsio-edit/src/plugins/shortcuts/plugin",
        decode: "assets/js/picsio-edit/src/decoder/decode",
        q: "assets/js/lib/q",
        pep: "assets/js/picsio-edit/src/lib/jquery.pep",
        rangeslider: "assets/js/picsio-edit/src/lib/rangeslider.min",
        Histogram: "assets/js/picsio-edit/src/lib/histogram",
        ColorCurve: "assets/js/picsio-edit/src/plugins/curves/ui/ColorCurve",
        spin: "assets/js/picsio-edit/src/lib/spin",
        spinner: "assets/js/picsio-edit/src/core/helpers/spin",
        facebook: "assets/js/lib/facebook/sdk",
        chromeAnal: "empty:",
        convolutionBase: "assets/js/picsio-edit/src/plugins/tools/convolutionBase",
        pluginSharpen: "assets/js/picsio-edit/src/plugins/convolutionPlugins/sharpen/plugin",
        pluginBlur: "assets/js/picsio-edit/src/plugins/convolutionPlugins/blur/plugin",
        pluginEmboss: "assets/js/picsio-edit/src/plugins/convolutionPlugins/emboss/plugin",
        pluginEdge: "assets/js/picsio-edit/src/plugins/convolutionPlugins/edge/plugin",
        crop: "assets/js/picsio-edit/src/core/crop",
        modal: "assets/js/picsio-edit/src/core/helpers/modal",
        lang: "assets/js/picsio-edit/src/lang/en",
        keypress: "assets/js/lib/keypress",
        shortcut: "assets/js/picsio-edit/src/shortcut/shortcut",
        pProgress: "assets/js/picsio-edit/src/core/helpers/pProgress",
        tooltip: "assets/js/lib/opentip",
        color: "assets/js/picsio-edit/src/core/color",
        colorDropperUi: "assets/js/picsio-edit/src/plugins/colorpicker/colorDropper",
        colorBox: "assets/js/picsio-edit/src/plugins/colorpicker/colorBox",
        pluginColorGetter: "assets/js/picsio-edit/src/plugins/colorgetter/plugin",
        colorjoe: "assets/js/lib/colorjoe/colorjoe",
        onecolor: "assets/js/lib/colorjoe/onecolor",
        pluginGradient: "assets/js/picsio-edit/src/plugins/gradient/plugin",
        gradientGenerator: "assets/js/picsio-edit/src/lib/gradientGenerator",
        ua: "assets/js/ua",
        detect: "assets/js/lib/detect.min",
        xmp: "assets/js/lib/xmp",
        pluginXmp: "assets/js/picsio-edit/src/plugins/xmp/plugin",
        stripe: "https://checkout.stripe.com/checkout",
        queue: "assets/js/lib/queue",
        Notifications: "assets/js/lib/notifications/notifications",
        Alerts: "assets/js/lib/alerts/alerts",
        colorsHelper: "assets/js/helpers/colorsHelper",
        zeroClipboard: "assets/js/lib/zeroclipboard/1.2.3/ZeroClipboard.min",
        i18n: "assets/js/lib/requirejs/i18n",
        privateBrowsingDetector: "assets/js/lib/private-browsing-detector",
        localization: "assets/js/shared/strings",
        PDFJS: "assets/js/lib/pdfjs/pdf",
        PDFJSWorker: "assets/js/lib/pdfjs/pdf.worker",
        jspdf: "assets/js/lib/jspdf/1.1.135/jspdf",
        WW: "assets/js/picsio-edit/src/lib/ww",
        eConf: "./editor.conf",
        MemoryscoreService: "assets/js/services/MemoryscoreService",
        configPresets: "assets/js/picsio-edit/src/core/configPresets"
    },
    deps: [ "localeConfigurator" ],
    shim: {
        ThumbnailService: {
            deps: [ "environment" ]
        },
        DecodeService: {
            deps: [ "Parallel" ]
        },
        environment: {
            exports: "PicsIO"
        },
        underscore: {
            exports: "_"
        },
        jqueryCookie: {
            deps: [ "jquery" ]
        },
        backbone: {
            deps: [ "jquery", "underscore" ],
            exports: "Backbone"
        },
        Parallel: {
            exports: "Parallel"
        },
        PDFJS: {
            exports: "PDFJS"
        },
        jspdf: {
            exports: "jsPDF"
        },
        rangeslider: {
            deps: [ "jquery" ]
        },
        ui: {
            deps: [ "rangeslider", "Parallel" ]
        },
        toolbar: {
            override: {}
        },
        facebook: {
            exports: "FB"
        }
    }
});

require([ "converter", "picsEdit", "extensions", "PDFJS", "jspdf" ], function(e, t) {
    window.editor = t;
    var i = new e();
    i.init();
    function n() {
        return window.name.has("frame");
    }
    function r() {
        return window.name.has("app_runner_fb");
    }
    function a() {
        console.log("To use this app user should be login to FB and like page!");
        var e = $("body");
        e.empty();
        e.css("background-color", "white");
        e.css("text-align", "center");
        e.append("<img assets/js/picsio-edit/src='assets/img/fb/raw-empty.fb.png'></img>");
    }
    if (n() || r()) {
        window.fbAsyncInit = function() {
            FB.init({
                appId: "1391593031089139",
                status: true,
                xfbml: true,
                frictionlessRequests: true
            });
            if (r()) {
                var e = function(e) {
                    console.log(e);
                    if (e.authResponse) {
                        FB.api("me/likes/162422537141877", function(e) {
                            if (e.data.length === 0) {
                                a();
                            }
                        });
                    } else {
                        a();
                    }
                };
                FB.getLoginStatus(function(t) {
                    if (t.status === "connected") {
                        e(t);
                    } else {
                        FB.login(function(t) {
                            e(t);
                        }, {
                            scope: "email,user_likes,read_stream,publish_stream, photo_upload,user_photos"
                        });
                    }
                });
            }
        };
    }
}, function(e) {
    console.error(e);
});

define("main", function() {});1